/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
dojo.provide("dojox.secure.DOM"),dojo.require("dojox.lang.observable"),dojox.secure.DOM=function(e){function n(e){if(e){if(e.nodeType){var t=s(e);return 1==e.nodeType&&"function"==typeof t.style&&(t.style=p(e.style),t.ownerDocument=c,t.childNodes={__get__:function(t){return n(e.childNodes[t])},length:0}),t}if(e&&"object"==typeof e){if(e.__observable)return e.__observable;for(var r in t=e instanceof Array?[]:{},e.__observable=t,e)"__observable"!=r&&(t[r]=n(e[r]));return t.data__=e,t}if("function"==typeof e){var o=function(e){return"function"==typeof e?function(){for(var t=0;t<arguments.length;t++)arguments[t]=n(arguments[t]);return o(e.apply(n(this),arguments))}:dojox.secure.unwrap(e)};return function(){e.safetyCheck&&e.safetyCheck.apply(o(this),arguments);for(var t=0;t<arguments.length;t++)arguments[t]=o(arguments[t]);return n(e.apply(o(this),arguments))}}}return e}function t(n){if((n+="").match(/behavior:|content:|javascript:|binding|expression|\@import/))throw new Error("Illegal CSS");var t=e.id||(e.id="safe"+(""+Math.random()).substring(2));return n.replace(/(\}|^)\s*([^\{]*\{)/g,function(e,n,r){return n+" #"+t+" "+r})}function r(e){if(e.match(/:/)&&!e.match(/^(http|ftp|mailto)/))throw new Error("Unsafe URL "+e)}function o(e){if(e&&1==e.nodeType){if(e.tagName.match(/script/i)){var i=e.src;if(i&&""!=i)e.parentNode.removeChild(e),dojo.xhrGet({url:i,secure:!0}).addCallback(function(e){c.evaluate(e)});else{var l=e.innerHTML;e.parentNode.removeChild(e),n.evaluate(l)}}if(e.tagName.match(/link/i))throw new Error("illegal tag");if(e.tagName.match(/style/i)){var u=function(n){if(e.styleSheet)e.styleSheet.cssText=n;else{var t=a.createTextNode(n);e.childNodes[0]?e.replaceChild(t,e.childNodes[0]):e.appendChild(t)}};(i=e.src)&&""!=i&&(alert("src"+i),e.src=null,dojo.xhrGet({url:i,secure:!0}).addCallback(function(e){u(t(e))})),u(t(e.innerHTML))}e.style&&t(e.style.cssText),e.href&&r(e.href),e.src&&r(e.src);for(var d,f=0;d=e.attributes[f++];)if("on"==d.name.substring(0,2)&&"null"!=d.value&&""!=d.value)throw new Error("event handlers not allowed in the HTML, they must be set with element.addEventListener");for(var s=e.childNodes,h=(f=0,s.length);f<h;f++)o(s[f])}}function i(e){var n=document.createElement("div");if(e.match(/<object/i))throw new Error("The object tag is not allowed");return n.innerHTML=e,o(n),n}unwrap=dojox.secure.unwrap;var a=e.ownerDocument,c={getElementById:function(t){return function(t){if(!t)return t;var r=t;do{if(r==e)return n(t)}while(r=r.parentNode);return null}(a.getElementById(t))},createElement:function(e){return n(a.createElement(e))},createTextNode:function(e){return n(a.createTextNode(e))},write:function(n){for(var t=i(n);t.childNodes.length;)e.appendChild(t.childNodes[0])}};c.open=c.close=function(){};var l={innerHTML:function(e,n){console.log("setting innerHTML"),e.innerHTML=i(n).innerHTML}};function u(e,n){return function(t,r){return o(r[n]),t[e](r[0])}}l.outerHTML=function(e,n){throw new Error("Can not set this property")};var d={appendChild:u("appendChild",0),insertBefore:u("insertBefore",0),replaceChild:u("replaceChild",1),cloneNode:function(e,n){return e.cloneNode(n[0])},addEventListener:function(e,n){dojo.connect(e,"on"+n[0],this,function(e){e=s(e||window.event),n[1].call(this,e)})}};function f(e){return dojox.lang.makeObservable(function(e,n){return e[n]},e,function(e,t,r,o){for(var i=0;i<o.length;i++)o[i]=unwrap(o[i]);return d[r]?n(d[r].call(e,t,o)):n(t[r].apply(t,o))},d)}d.childNodes=d.style=d.ownerDocument=function(){};var s=f(function(e,n,t){l[n]&&l[n](e,t),e[n]=t}),h={behavior:1,MozBinding:1},p=f(function(e,n,r){h[n]||(e[n]=t(r))});return n.safeHTML=i,n.safeCSS=t,n},dojox.secure.unwrap=function(e){return e&&e.data__||e};
//# sourceMappingURL=../sourcemaps/secure/DOM.js.map
