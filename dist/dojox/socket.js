/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo/_base/array","dojo/_base/lang","dojo/_base/xhr","dojo/aspect","dojo/on","dojo/Evented","dojo/_base/url"],function(e,n,t,o,r,a,s){var c=window.WebSocket,i=function(e){return"string"==typeof e&&(e={url:e}),c?i.WebSocket(e,!0):i.LongPoll(e)};return i.WebSocket=function(e,n){var t,r=document.baseURI||window.location.href,a=new c(new s(r.replace(/^http/i,"ws"),e.url));return a.on=function(e,n){a.addEventListener(e,n,!0)},o.after(a,"onopen",function(e){t=!0},!0),o.after(a,"onclose",function(o){t||n&&i.replace(a,i.LongPoll(e),!0)},!0),a},i.replace=function(t,o,a){t.send=n.hitch(o,"send"),t.close=n.hitch(o,"close");var s=function(e){(o.addEventListener||o.on).call(o,e,function(e){r.emit(t,e.type,e)},!0)};a&&s("open"),e.forEach(["message","close","error"],s)},i.LongPoll=function(o){var s,c,i,l=!1,u=!0,d=[],f={send:function(t){var r=n.delegate(o);r.rawBody=t,clearTimeout(s);var a=u?(u=!1)||f.firstRequest(r):f.transport(r);return d.push(a),a.then(function(n){f.readyState=1,d.splice(e.indexOf(d,a),1),d.length||(s=setTimeout(i,o.interval)),n&&c("message",{data:n},a)},function(n){d.splice(e.indexOf(d,a),1),l||(c("error",{error:n},a),d.length||(f.readyState=3,c("close",{wasClean:!1},a)))}),a},close:function(){var e;for(f.readyState=2,l=!0,e=0;e<d.length;e++)d[e].cancel();f.readyState=3,c("close",{wasClean:!0})},transport:o.transport||t.post,args:o,url:o.url,readyState:0,CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3,on:a.prototype.on,firstRequest:function(e){var n=e.headers||(e.headers={});n.Pragma="start-long-poll";try{return this.transport(e)}finally{delete n.Pragma}}};return c=function(e,n,t){f["on"+e]&&(n.ioArgs=t&&t.ioArgs,n.type=e,r.emit(f,e,n))},i=function(){0==f.readyState&&c("open",{}),d.length||f.send()},f.connect=f.on,setTimeout(i),f},i});
//# sourceMappingURL=sourcemaps/socket.js.map
