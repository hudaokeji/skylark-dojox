/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo","dijit","dojox","dijit/_editor/_Plugin","dojo/_base/declare"],function(e,t,n,i){var a=e.declare("dojox.editor.plugins.NormalizeIndentOutdent",i,{indentBy:40,indentUnits:"px",setEditor:function(t){this.editor=t,t._indentImpl=e.hitch(this,this._indentImpl),t._outdentImpl=e.hitch(this,this._outdentImpl),t._indentoutdent_queryCommandEnabled||(t._indentoutdent_queryCommandEnabled=t.queryCommandEnabled),t.queryCommandEnabled=e.hitch(this,this._queryCommandEnabled),t.customUndo=!0},_queryCommandEnabled:function(e){var n,i,a,o,r,d,s=e.toLowerCase(),l="marginLeft";if(this._isLtr()||(l="marginRight"),"indent"===s){if(n=this.editor,(i=t.range.getSelection(n.window))&&i.rangeCount>0){for(o=(a=i.getRangeAt(0)).startContainer;o&&o!==n.document&&o!==n.editNode;){if("li"===(r=this._getTagName(o))){for(d=o.previousSibling;d&&1!==d.nodeType;)d=d.previousSibling;return!(!d||"li"!==this._getTagName(d))}if(this._isIndentableElement(r))return!0;o=o.parentNode}if(this._isRootInline(a.startContainer))return!0}}else{if("outdent"!==s)return this.editor._indentoutdent_queryCommandEnabled(e);if(n=this.editor,(i=t.range.getSelection(n.window))&&i.rangeCount>0){for(o=(a=i.getRangeAt(0)).startContainer;o&&o!==n.document&&o!==n.editNode;){if("li"===(r=this._getTagName(o)))return this.editor._indentoutdent_queryCommandEnabled(e);if(this._isIndentableElement(r)){var m=o.style?o.style[l]:"";return!!(m&&(m=this._convertIndent(m))/this.indentBy>=1)}o=o.parentNode}if(this._isRootInline(a.startContainer))return!1}}return!1},_indentImpl:function(n){var i=this.editor,a=t.range.getSelection(i.window);if(a&&a.rangeCount>0){var o,r,d,s,l=a.getRangeAt(0),m=l.startContainer;if(l.startContainer===l.endContainer)if(this._isRootInline(l.startContainer)){for(r=l.startContainer;r&&r.parentNode!==i.editNode;)r=r.parentNode;for(;r&&r.previousSibling&&(this._isTextElement(r)||1===r.nodeType&&this._isInlineFormat(this._getTagName(r)));)r=r.previousSibling;if(r&&1===r.nodeType&&!this._isInlineFormat(this._getTagName(r))&&(r=r.nextSibling),r){for(s=i.document.createElement("div"),e.place(s,r,"after"),s.appendChild(r),d=s.nextSibling;d&&(this._isTextElement(d)||1===d.nodeType&&this._isInlineFormat(this._getTagName(d)));)s.appendChild(d),d=s.nextSibling;this._indentElement(s),i._sCall("selectElementChildren",[s]),i._sCall("collapse",[!0])}}else for(;m&&m!==i.document&&m!==i.editNode;){if("li"===(o=this._getTagName(m)))return void this._indentList(m);if(this._isIndentableElement(o))return void this._indentElement(m);m=m.parentNode}else{var p;for(r=l.startContainer,d=l.endContainer;r&&this._isTextElement(r)&&r.parentNode!==i.editNode;)r=r.parentNode;for(;d&&this._isTextElement(d)&&d.parentNode!==i.editNode;)d=d.parentNode;if(d===i.editNode||d===i.document.body){for(p=r;p.nextSibling&&i._sCall("inSelection",[p]);)p=p.nextSibling;if((d=p)===i.editNode||d===i.document.body){if("li"===(o=this._getTagName(r)))this._indentList(r);else if(this._isIndentableElement(o))this._indentElement(r);else if(this._isTextElement(r)||this._isInlineFormat(o)){s=i.document.createElement("div"),e.place(s,r,"after");for(var h=r;h&&(this._isTextElement(h)||1===h.nodeType&&this._isInlineFormat(this._getTagName(h)));)s.appendChild(h),h=s.nextSibling;this._indentElement(s)}return}}for(d=d.nextSibling,p=r;p&&p!==d;){if(1===p.nodeType){if(o=this._getTagName(p),e.isIE&&"p"===o&&this._isEmpty(p)){p=p.nextSibling;continue}"li"===o?(s&&(this._isEmpty(s)?s.parentNode.removeChild(s):this._indentElement(s),s=null),this._indentList(p)):!this._isInlineFormat(o)&&this._isIndentableElement(o)?(s&&(this._isEmpty(s)?s.parentNode.removeChild(s):this._indentElement(s),s=null),p=this._indentElement(p)):this._isInlineFormat(o)&&(s?(s.appendChild(p),p=s):(s=i.document.createElement("div"),e.place(s,p,"after"),s.appendChild(p),p=s))}else this._isTextElement(p)&&(s?(s.appendChild(p),p=s):(s=i.document.createElement("div"),e.place(s,p,"after"),s.appendChild(p),p=s));p=p.nextSibling}s&&(this._isEmpty(s)?s.parentNode.removeChild(s):this._indentElement(s),s=null)}}},_indentElement:function(t){var n="marginLeft";this._isLtr()||(n="marginRight");var i=this._getTagName(t);if("ul"===i||"ol"===i){var a=this.editor.document.createElement("div");e.place(a,t,"after"),a.appendChild(t),t=a}var o=t.style?t.style[n]:"";return o?(o=this._convertIndent(o),o=parseInt(o,10)+this.indentBy+this.indentUnits):o=this.indentBy+this.indentUnits,e.style(t,n,o),t},_outdentElement:function(t){var n="marginLeft";this._isLtr()||(n="marginRight");var i=t.style?t.style[n]:"";i&&(i=(i=this._convertIndent(i))-this.indentBy>0?parseInt(i,10)-this.indentBy+this.indentUnits:"",e.style(t,n,i))},_outdentImpl:function(e){var n=this.editor,i=t.range.getSelection(n.window);if(i&&i.rangeCount>0){var a,o=i.getRangeAt(0),r=o.startContainer;if(o.startContainer===o.endContainer){for(;r&&r!==n.document&&r!==n.editNode;){if("li"===(a=this._getTagName(r)))return this._outdentList(r);if(this._isIndentableElement(a))return this._outdentElement(r);r=r.parentNode}n.document.execCommand("outdent",!1,e)}else{for(var d=o.startContainer,s=o.endContainer;d&&3===d.nodeType;)d=d.parentNode;for(;s&&3===s.nodeType;)s=s.parentNode;s=s.nextSibling;for(var l=d;l&&l!==s;)1===l.nodeType&&("li"===(a=this._getTagName(l))?this._outdentList(l):this._isIndentableElement(a)&&this._outdentElement(l)),l=l.nextSibling}}return null},_indentList:function(t){for(var n,i,a=this.editor,o=t.parentNode,r=t.previousSibling;r&&1!==r.nodeType;)r=r.previousSibling;var d=null,s=this._getTagName(o);if("ol"===s?d="ol":"ul"===s&&(d="ul"),d&&r&&"li"==r.tagName.toLowerCase()){var l,m;if(r.childNodes)for(m=0;m<r.childNodes.length;m++){var p=r.childNodes[m];if(3===p.nodeType){if(e.trim(p.nodeValue)&&l)break}else{if(1!==p.nodeType||l)break;d===p.tagName.toLowerCase()&&(l=p)}}l?l.appendChild(t):(n=a.document.createElement(d),e.style(n,{paddingTop:"0px",paddingBottom:"0px"}),i=a.document.createElement("li"),e.style(i,{listStyleImage:"none",listStyleType:"none"}),r.appendChild(n),n.appendChild(t)),a._sCall("selectElementChildren",[t]),a._sCall("collapse",[!0])}},_outdentList:function(t){var n,i=this.editor,a=t.parentNode,o=null,r=a.tagName?a.tagName.toLowerCase():"";"ol"===r?o="ol":"ul"===r&&(o="ul");var d=a.parentNode,s=this._getTagName(d);if("li"===s||"ol"===s||"ul"===s){if("ol"===s||"ul"===s){for(var l=a.previousSibling;l&&(1!==l.nodeType||1===l.nodeType&&"li"!==this._getTagName(l));)l=l.previousSibling;if(l)l.appendChild(a),d=l;else{n=t;for(var m=t;n.previousSibling;)1===(n=n.previousSibling).nodeType&&"li"===this._getTagName(n)&&(m=n);m!==t?(e.place(m,a,"before"),m.appendChild(a),d=m):(n=i.document.createElement("li"),e.place(n,a,"before"),n.appendChild(a),d=n),e.style(a,{paddingTop:"0px",paddingBottom:"0px"})}}for(var p=t.previousSibling;p&&1!==p.nodeType;)p=p.previousSibling;for(var h=t.nextSibling;h&&1!==h.nodeType;)h=h.nextSibling;if(p)if(h){var u=i.document.createElement(o);for(e.style(u,{paddingTop:"0px",paddingBottom:"0px"}),t.appendChild(u);t.nextSibling;)u.appendChild(t.nextSibling);e.place(t,d,"after")}else e.place(t,d,"after");else e.place(t,d,"after"),t.appendChild(a);a&&this._isEmpty(a)&&a.parentNode.removeChild(a),d&&this._isEmpty(d)&&d.parentNode.removeChild(d),i._sCall("selectElementChildren",[t]),i._sCall("collapse",[!0])}else i.document.execCommand("outdent",!1,null)},_isEmpty:function(t){if(t.childNodes){var n,i=!0;for(n=0;n<t.childNodes.length;n++){var a=t.childNodes[n];if(1===a.nodeType){if("p"===this._getTagName(a)&&!e.trim(a.innerHTML))continue;i=!1;break}if(!this._isTextElement(a)){i=!1;break}var o=e.trim(a.nodeValue);if(o&&"&nbsp;"!==o&&"Â "!==o){i=!1;break}}return i}return!0},_isIndentableElement:function(e){switch(e){case"p":case"div":case"h1":case"h2":case"h3":case"center":case"table":case"ul":case"ol":return!0;default:return!1}},_convertIndent:function(e){var t=(e=(e+="").toLowerCase()).indexOf("px")>0?"px":e.indexOf("em")>0?"em":"px";return e=e.replace(/(px;?|em;?)/gi,""),"px"===t?"em"===this.indentUnits&&(e=Math.ceil(e/12)):"px"===this.indentUnits&&(e*=12),e},_isLtr:function(){var t=this.editor.document.body,n=e.getComputedStyle(t);return!n||"ltr"==n.direction},_isInlineFormat:function(e){switch(e){case"a":case"b":case"strong":case"s":case"strike":case"i":case"u":case"em":case"sup":case"sub":case"span":case"font":case"big":case"cite":case"q":case"img":case"small":return!0;default:return!1}},_getTagName:function(e){var t="";return e&&1===e.nodeType&&(t=e.tagName?e.tagName.toLowerCase():""),t},_isRootInline:function(e){var t=this.editor;if(this._isTextElement(e)&&e.parentNode===t.editNode)return!0;if(1===e.nodeType&&this._isInlineFormat(e)&&e.parentNode===t.editNode)return!0;if(this._isTextElement(e)&&this._isInlineFormat(this._getTagName(e.parentNode))){for(e=e.parentNode;e&&e!==t.editNode&&this._isInlineFormat(this._getTagName(e));)e=e.parentNode;if(e===t.editNode)return!0}return!1},_isTextElement:function(e){return!!(e&&3===e.nodeType||4===e.nodeType)}});return e.subscribe(t._scopeName+".Editor.getPlugin",null,function(e){e.plugin||"normalizeindentoutdent"===e.args.name.toLowerCase()&&(e.plugin=new a({indentBy:"indentBy"in e.args&&e.args.indentBy>0?e.args.indentBy:40,indentUnits:"indentUnits"in e.args&&"em"==e.args.indentUnits.toLowerCase()?"em":"px"}))}),a});
//# sourceMappingURL=../../sourcemaps/editor/plugins/NormalizeIndentOutdent.js.map
