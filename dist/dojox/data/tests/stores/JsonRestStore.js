/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
dojo.provide("dojox.data.tests.stores.JsonRestStore"),dojo.require("dojox.rpc.Service"),dojo.require("dojox.data.JsonRestStore"),dojo.require("dojox.json.schema"),dojo.require("dojo.data.api.Read"),dojox.data.tests.stores.JsonRestStore.error=function(e,o,t){o.errback(t)},testServices=new dojox.rpc.Service(require.toUrl("dojox/rpc/tests/resources/test.smd")),testServices.jsonRestStore.servicePath="/jsonRest.Store/",jsonStore=new dojox.data.JsonRestStore({service:testServices.jsonRestStore}),doh.register("dojox.data.tests.stores.JsonRestStore",[{name:"Fetch some items",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"query",onComplete:function(t,r){e.is(4,t.length),o.callback(!0)},onError:dojo.partial(dojox.data.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"fetch by id",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"obj1",onComplete:function(t,r){e.is("Object 1",t.name),e.t(jsonStore.hasAttribute(t,"name")),e.is(jsonStore.getValues(t,"name").length,1),e.t(jsonStore.isItem(t)),o.callback(!0)},onError:dojo.partial(dojox.data.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"Modify,save, check by id",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"query",onComplete:function(t,r){var n=(new Date).getTime();jsonStore.setValue(t[0],"updated",n),jsonStore.setValue(t[0],"obj",{foo:"bar"}),jsonStore.setValue(t[0],"obj dup",t[0].obj),jsonStore.setValue(t[0],"testArray",[1,2,3,4]),jsonStore.save({onComplete:function(){jsonStore.fetchItemByIdentity({identity:"obj1",onItem:function(t,r){e.is("Object 1",t.name),e.is(n,t.updated),e.is("bar",t.obj.foo),e.is(t.obj,t["obj dup"]),o.callback(!0)},onError:dojo.partial(dojox.data.tests.stores.JsonRestStore.error,doh,o)})}})},onError:dojo.partial(dojox.data.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"Revert",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"obj1",onComplete:function(t,r){jsonStore.setValue(t,"name","new name"),jsonStore.setValue(t,"newProp","new value"),jsonStore.unsetAttribute(t,"updated"),e.is(jsonStore.getValue(t,"name"),"new name"),e.is(jsonStore.getValue(t,"newProp"),"new value"),e.is(jsonStore.getValue(t,"updated"),void 0),jsonStore.revert(),e.is(jsonStore.getValue(t,"name"),"Object 1"),e.is(jsonStore.getValue(t,"newProp"),void 0),e.t("number"==typeof jsonStore.getValue(t,"updated")),o.callback(!0)},onError:dojo.partial(dojox.data.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"Delete",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetchItemByIdentity({identity:"obj1",onItem:function(t,r){var n=jsonStore.newItem({directRef:t,name:"Foo"});jsonStore.setValue(n,"arrayRef",[1,{subobject:t},t]),jsonStore.deleteItem(t),e.is(jsonStore.getValue(n,"directRef"),void 0),e.is(jsonStore.getValue(n,"arrayRef").length,2),e.is(jsonStore.getValue(n,"arrayRef")[1].subobject,void 0),jsonStore.revert(),o.callback(!0)},onError:dojo.partial(dojox.data.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"Lazy loading",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"query",onComplete:function(t,r){var n=t[2];e.f(jsonStore.isItemLoaded(n)),jsonStore.getValue(n,"name"),e.is(t[2],n),e.is(n.name,"Object 3"),o.callback(!0)},onError:dojo.partial(dojox.data.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"Lazy loading 2",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"query",onComplete:function(t,r){e.f(jsonStore.isItemLoaded(t[3])),jsonStore.loadItem({item:t[3],onItem:function(r){e.t(jsonStore.isItemLoaded(t[3])),e.is(r,t[3]),e.is(r.name,"Object 4"),o.callback(!0)}})},onError:dojo.partial(dojox.data.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"IdentityAPI: fetchItemByIdentity and getIdentity",timeout:3e4,runTest:function(e){new doh.Deferred;jsonStore.fetchItemByIdentity({identity:"obj3",onItem:function(o,t){e.t(jsonStore.isItemLoaded(o)),e.is(jsonStore.getIdentity(o),"obj3")}})}},{name:"ReadAPI:  Fetch_20_Streaming",timeout:1e4,runTest:function(e){var o=new doh.Deferred,t=0;return jsonStore.fetch({query:"bigQuery",onBegin:null,count:20,onItem:function(o,r){e.assertTrue("number"==typeof o),t++},onComplete:function(r,n){e.is(20,t),o.callback(!0)},onError:dojo.partial(dojox.data.tests.stores.JsonRestStore.error,e,o)}),o}},function(e){var o=new doh.Deferred;jsonStore.fetchItemByIdentity({identity:"obj3",onItem:function(t,r){var n=!1;try{jsonStore.setValue(t,"name",333),n=!0}catch(e){console.log("Correctly blocked invalid property change by schema:",e)}try{jsonStore.setValue(t,"name","a"),n=!0}catch(e){console.log("Correctly blocked invalid property change by schema:",e)}e.f(n),o.callback(!0)}})},function(e){var o=new dojo.data.api.Read;for(i in o){if("_"!==i.toString().charAt(0))if("function"==typeof o[i])if("function"!=typeof jsonStore[i]){!1;break}}},function(e){e.is(dojox.data.JsonRestStore.getStore({target:"/something/"},dojox.data.JsonRestStore),dojox.data.JsonRestStore.getStore({target:"/something/"}))}]),performanceTest=function(){dojo.require("dojo.data.ItemFileReadStore"),jsonStore.fetch({query:"obj1",onComplete:function(e){for(var o,t=(new Date).getTime(),r=0;r<1e5;r++);for(console.log("Just Loop",(new Date).getTime()-t,o),t=(new Date).getTime(),r=0;r<1e5;r++)o=e.name;for(console.log("Direct Access",(new Date).getTime()-t,o),t=(new Date).getTime(),r=0;r<1e5;r++)o=jsonStore.getValue(e,"name");console.log("getValue",(new Date).getTime()-t);var n=new dojo.data.ItemFileReadStore({data:{identifier:"id",items:[{id:"1",name:"Fozzie Bear",wears:["hat","tie"]},{id:"2",name:"Miss Piggy",pets:"Foo-Foo"}]}});for(n.fetchItemByIdentity({identity:"1",onItem:function(o){e=o}}),t=(new Date).getTime(),r=0;r<1e5;r++)o=n.getValue(e,"name");console.log("ifrs.getValue",(new Date).getTime()-t,o)}})};
//# sourceMappingURL=../../../sourcemaps/data/tests/stores/JsonRestStore.js.map
