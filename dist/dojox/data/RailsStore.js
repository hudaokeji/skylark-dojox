/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo","dojox","dojox/data/JsonRestStore"],function(t,r){return t.declare("dojox.data.RailsStore",r.data.JsonRestStore,{constructor:function(){},preamble:function(e){if("string"==typeof e.target&&!e.service){var o=e.target.replace(/\/$/g,"");e.service=r.rpc.Rest(this.target,!0,null,function(e,i){i=i||{};var n,u,s=o;t.isObject(e)?(u="",n="?"+t.objectToQuery(e)):i.queryStr&&-1!=i.queryStr.indexOf("?")?(u=i.queryStr.replace(/\?.*/,""),n=i.queryStr.replace(/[^?]*\?/g,"?")):t.isString(i.query)&&-1!=i.query.indexOf("?")?(u=i.query.replace(/\?.*/,""),n=i.query.replace(/[^?]*\?/g,"?")):(u=e?e.toString():"",n=""),-1!=u.indexOf("=")&&(n=u,u=""),s=u?s+"/"+u+".json"+n:s+".json"+n;var a=r.rpc._sync;return r.rpc._sync=!1,{url:s,handleAs:"json",contentType:"application/json",sync:a,headers:{Accept:"application/json,application/javascript",Range:i&&(i.start>=0||i.count>=0)?"items="+(i.start||"0")+"-"+(i.count&&i.count+(i.start||0)-1||""):void 0}}})}},fetch:function(r){function e(e){null==r.queryStr&&(null==r.queryStr&&(r.queryStr=""),t.isObject(r.query)?r.queryStr="?"+t.objectToQuery(r.query):t.isString(r.query)&&(r.queryStr=r.query)),r.queryStr=r.queryStr+(-1==r.queryStr.indexOf("?")?"?":"&")+t.objectToQuery(e)}if((r=r||{}).start||r.count){if((r.start||0)%r.count)throw new Error("The start parameter must be a multiple of the count parameter");e({page:(r.start||0)/r.count+1,per_page:r.count})}if(r.sort){var o={sortBy:[],sortDir:[]};t.forEach(r.sort,function(t){o.sortBy.push(t.attribute),o.sortDir.push(t.descending?"DESC":"ASC")}),e(o),delete r.sort}return this.inherited(arguments)},_processResults:function(r,e){var o;if(void 0===this.rootAttribute&&r[0])if(r[0][this.idAttribute])this.rootAttribute=!1,console.debug("RailsStore: without root_in_json");else for(var i in r[0])r[0][i][this.idAttribute]&&(this.rootAttribute=i,console.debug("RailsStore: with root_in_json, attribute: "+i));o=this.rootAttribute?t.map(r,function(t){return t[this.rootAttribute]},this):r;var n=r.length;return{totalCount:e.fullLength||(e.request.count==n?(e.request.start||0)+2*n:n),items:o}}})});
//# sourceMappingURL=../sourcemaps/data/RailsStore.js.map
