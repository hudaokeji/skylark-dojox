/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo/_base/declare","dojox/gfx","./ScaleBase","./_circularUtils"],function(t,i,n,e){return t("dojox.dgauges.CircularScale",n,{originX:50,originY:50,radius:50,startAngle:0,endAngle:180,orientation:"clockwise",constructor:function(){this.labelPosition="inside",this.addInvalidatingProperties(["originX","originY","radius","startAngle","endAngle","orientation"])},_getOrientationNum:function(){return"cclockwise"==this.orientation?-1:1},positionForValue:function(t){var i=e.computeTotalAngle(this.startAngle,this.endAngle,this.orientation),n=this.scaler.positionForValue(t);return e.modAngle(this.startAngle+this._getOrientationNum()*i*n,360)},_positionForTickItem:function(t){var i=e.computeTotalAngle(this.startAngle,this.endAngle,this.orientation);return e.modAngle(this.startAngle+this._getOrientationNum()*i*t.position,360)},valueForPosition:function(t){if(this.positionInRange(t)){i=e.modAngle(this._getOrientationNum()*(t-this.startAngle),360)/e.computeTotalAngle(this.startAngle,this.endAngle,this.orientation)}else{var i,n=e.modAngle(this.startAngle-t,360),s=360-n,a=e.modAngle(this.endAngle-t,360),o=360-a;i=Math.min(n,s)<Math.min(a,o)?0:1}return this.scaler.valueForPosition(i)},positionInRange:function(t){return this.startAngle==this.endAngle||(t=e.modAngle(t,360),1==this._getOrientationNum()?this.startAngle<this.endAngle?t>=this.startAngle&&t<=this.endAngle:!(t>this.endAngle&&t<this.startAngle):this.startAngle<this.endAngle?!(t>this.startAngle&&t<this.endAngle):t>=this.endAngle&&t<=this.startAngle)},_distance:function(t,i,n,e){return Math.sqrt((n-t)*(n-t)+(e-i)*(e-i))},_layoutLabel:function(t,n,e,s,a,o,r){var h,l,g=this._getFont(),d=i._base._getTextBox(n,{font:i.makeFontString(i.makeParameters(i.defaultFont,g))}).w,c=g.size,u=i.normalizedLength(c),A=e+Math.cos(o)*a-d/2,m=s-Math.sin(o)*a-u/2,_=[],f=h=A,p=-Math.tan(o)*h+s+Math.tan(o)*e;if(p>=m&&p<=m+u&&_.push({x:f,y:p}),f=h=A+d,(p=-Math.tan(o)*h+s+Math.tan(o)*e)>=m&&p<=m+u&&_.push({x:f,y:p}),p=h=m,(f=-1/Math.tan(o)*h+e+1/Math.tan(o)*s)>=A&&f<=A+d&&_.push({x:f,y:p}),p=h=m+u,(f=-1/Math.tan(o)*h+e+1/Math.tan(o)*s)>=A&&f<=A+d&&_.push({x:f,y:p}),"inside"==r)for(var x=0;x<_.length;x++){var F=_[x];if((l=this._distance(F.x,F.y,e,s)-a)>=0){A=e+Math.cos(o)*(a-l)-d/2,m=s-Math.sin(o)*(a-l)-u/2;break}}else for(x=0;x<_.length;x++)if(F=_[x],(l=this._distance(F.x,F.y,e,s)-a)<=0){A=e+Math.cos(o)*(a-l)-d/2,m=s-Math.sin(o)*(a-l)-u/2;break}t&&t.setTransform([{dx:A+d/2,dy:m+u}])},refreshRendering:function(){if(this.inherited(arguments),this._gfxGroup&&this.scaler){var t,n,s;this.startAngle=e.modAngle(this.startAngle,360),this.endAngle=e.modAngle(this.endAngle,360),this._ticksGroup.clear();for(var a,o=this.scaler.computeTicks(),r=0;r<o.length;r++){var h,l=o[r];if(t=this.tickShapeFunc(this._ticksGroup,this,l),a=this._gauge._computeBoundingBox(t),h=l.position?this._positionForTickItem(l):this.positionForValue(l.value),t&&t.setTransform([{dx:this.originX,dy:this.originY},i.matrix.rotateg(h),{dx:this.radius-a.width-2*a.x,dy:0}]),s=this.tickLabelFunc(l)){n=this._ticksGroup.createText({x:0,y:0,text:s,align:"middle"}).setFont(this._getFont()).setFill(this._getFont().color?this._getFont().color:"black");var g=this.radius;"inside"==this.labelPosition?g-=a.width+this.labelGap:g+=this.labelGap,this._layoutLabel(n,s,this.originX,this.originY,g,e.toRadians(360-h),this.labelPosition)}}for(var d in this._indicatorsIndex)this._indicatorsRenderers[d]=this._indicatorsIndex[d].invalidateRendering()}}})});
//# sourceMappingURL=../sourcemaps/dgauges/CircularScale.js.map
