/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/fx","dojo/dom","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/dom-class","dojo/on","dojo/query","dojo/fx"],function(t,e,i,o,n,s,h,d,a,r,c,l){var _="visibility";return getViewport=function(){var t="BackCompat"==document.compatMode?document.body:document.documentElement,e=h.docScroll();return{w:t.clientWidth,h:t.clientHeight,l:e.x,t:e.y}},e("dojox.image.LightboxNano",null,{href:"",duration:500,preloadDelay:5e3,constructor:function(e,i){var o,h=this;t.mixin(h,e),(i=h._node=n.byId(i))&&(/a/i.test(i.tagName)||(o=s.create("a",{href:h.href,class:i.className},i,"after"),i.className="",o.appendChild(i),i=o),d.set(i,"position","relative"),s.create("div",{class:"nano-enlarge",style:{position:"absolute",display:"none"}},i),n.setSelectable(i,!1),h._onClickEvt=r(i,"click",t.hitch(h,"_load"))),h.href&&setTimeout(function(){(new Image).src=h.href,h._hideLoading()},h.preloadDelay)},destroy:function(){var t=this._connects||[];t.push(this._onClickEvt),i.forEach(t,function(t){t.remove()}),s.destroy(this._node)},_load:function(e){if(e&&e.preventDefault(),!this._loading){this._loading=!0,this._reset();var i,o=this._img=s.create("img",{class:"nano-image nano-image-hidden"},document.body),n=this._loadingNode,a=c("img",this._node)[0]||this._node,l=h.position(a,!0),_=h.getContentBox(a),g=h.getBorderExtents(a);null==n&&(this._loadingNode=n=s.create("div",{class:"nano-loading",style:{position:"absolute",display:""}},this._node,"after"),i=h.getMarginBox(n),d.set(n,{left:parseInt((_.w-i.w)/2)+"px",top:parseInt((_.h-i.h)/2)+"px"})),_.x=l.x-10+g.l,_.y=l.y-10+g.t,this._start=_,this._connects=[r(o,"load",t.hitch(this,"_show"))],o.src=this.href}},_hideLoading:function(){this._loadingNode&&d.set(this._loadingNode,"display","none"),this._loadingNode=!1},_show:function(){var e=getViewport(),i=this._img.width,o=this._img.height,n=parseInt(.9*(e.w-20)),h=parseInt(.9*(e.h-20)),c=this._bg=s.create("div",{class:"nano-background",style:{opacity:0}},document.body);this._loadingNode&&this._hideLoading(),a.remove(this._img,"nano-image-hidden"),d.set(this._node,_,"hidden"),this._loading=!1,this._connects=this._connects.concat([r(document,"mousedown",t.hitch(this,"_hide")),r(document,"keypress",t.hitch(this,"_key")),r(window,"resize",t.hitch(this,"_sizeBg"))]),i>n&&(o=o*n/i,i=n),o>h&&(i=i*h/o,o=h),this._end={x:(e.w-20-i)/2+e.l,y:(e.h-20-o)/2+e.t,w:i,h:o},this._sizeBg(),l.combine([this._anim(this._img,this._coords(this._start,this._end)),this._anim(c,{opacity:.5})]).play()},_sizeBg:function(){var t=document.documentElement;d.set(this._bg,{top:0,left:0,width:t.scrollWidth+"px",height:t.scrollHeight+"px"})},_key:function(t){t.preventDefault(),this._hide()},_coords:function(t,e){return{left:{start:t.x,end:e.x},top:{start:t.y,end:e.y},width:{start:t.w,end:e.w},height:{start:t.h,end:e.h}}},_hide:function(){i.forEach(this._connects,function(t){t.remove()}),this._connects=[],l.combine([this._anim(this._img,this._coords(this._end,this._start),"_reset"),this._anim(this._bg,{opacity:0})]).play()},_reset:function(){d.set(this._node,_,"visible"),s.destroy(this._img),s.destroy(this._bg),this._img=this._bg=null,this._node.focus()},_anim:function(e,i,n){return o.animateProperty({node:e,duration:this.duration,properties:i,onEnd:n?t.hitch(this,n):null})},show:function(t){t=t||{},this.href=t.href||this.href;var e=n.byId(t.origin),i=getViewport();this._node=e||s.create("div",{style:{position:"absolute",width:0,hieght:0,left:i.l+i.w/2+"px",top:i.t+i.h/2+"px"}},document.body),this._load(),e||s.destroy(this._node)}})});
//# sourceMappingURL=../sourcemaps/image/LightboxNano.js.map
