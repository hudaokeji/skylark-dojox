/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["./ViewBase","dijit/_TemplatedMixin","./_ScrollBarBase","dojo/text!./templates/ColumnView.html","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/_base/array","dojo/_base/sniff","dojo/_base/fx","dojo/_base/html","dojo/on","dojo/dom","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/dom-construct","dojo/mouse","dojo/query","dojox/html/metrics"],function(t,e,i,r,o,s,a,n,l,h,d,u,c,m,f,C,v,_,g,H){return o("dojox.calendar.SimpleColumnView",[t,e],{baseClass:"dojoxCalendarColumnView",templateString:r,viewKind:"columns",_setTabIndexAttr:"domNode",renderData:null,startDate:null,columnCount:7,subColumns:null,minHours:8,maxHours:18,hourSize:100,timeSlotDuration:15,rowHeaderGridSlotDuration:60,rowHeaderLabelSlotDuration:60,rowHeaderLabelOffset:2,rowHeaderFirstLabelOffset:2,verticalRenderer:null,verticalDecorationRenderer:null,minColumnWidth:-1,percentOverlap:70,horizontalGap:4,_showSecondarySheet:!1,_columnHeaderHandlers:null,constructor:function(){this.invalidatingProperties=["columnCount","startDate","minHours","maxHours","hourSize","verticalRenderer","verticalDecorationRenderer","rowHeaderTimePattern","columnHeaderDatePattern","timeSlotDuration","rowHeaderGridSlotDuration","rowHeaderLabelSlotDuration","rowHeaderLabelOffset","rowHeaderFirstLabelOffset","percentOverlap","horizontalGap","scrollBarRTLPosition","itemToRendererKindFunc","layoutPriorityFunction","formatItemTimeFunc","textDir","items","subColumns","minColumnWidth"],this._columnHeaderHandlers=[]},destroy:function(t){this._cleanupColumnHeader(),this.scrollBar&&this.scrollBar.destroy(t),this.inherited(arguments)},_scrollBar_onScroll:function(t){this._setScrollPosition(t)},_hscrollBar_onScroll:function(t){this._setHScrollPosition(t)},buildRendering:function(){this.inherited(arguments),this.vScrollBar&&(this.scrollBar=new i({content:this.vScrollBarContent},this.vScrollBar),this.scrollBar.on("scroll",a.hitch(this,this._scrollBar_onScroll))),this.hScrollBar&&(this.hScrollBarW=new i({content:this.hScrollBarContent,direction:"horizontal",value:0},this.hScrollBar),this.hScrollBarW.on("scroll",a.hitch(this,this._hscrollBar_onScroll)),this._hScrollNodes=[this.columnHeaderTable,this.subColumnHeaderTable,this.gridTable,this.itemContainerTable]),this._viewHandles.push(u(this.scrollContainer,_.wheel,dojo.hitch(this,this._mouseWheelScrollHander)))},postscript:function(){this.inherited(arguments),this._initialized=!0,this.invalidRendering||this.refreshRendering()},_setVerticalRendererAttr:function(t){this._destroyRenderersByKind("vertical"),this._set("verticalRenderer",t)},_createRenderData:function(){var t={};t.minHours=this.get("minHours"),t.maxHours=this.get("maxHours"),t.hourSize=this.get("hourSize"),t.hourCount=t.maxHours-t.minHours,t.slotDuration=this.get("timeSlotDuration"),t.rowHeaderGridSlotDuration=this.get("rowHeaderGridSlotDuration"),t.slotSize=Math.ceil(t.hourSize/(60/t.slotDuration)),t.hourSize=t.slotSize*(60/t.slotDuration),t.sheetHeight=t.hourSize*t.hourCount,this._rowHeaderWidth||(this._rowHeaderWidth=C.getMarginBox(this.rowHeader).w),t.rowHeaderWidth=this._rowHeaderWidth;var e=H.getScrollbar();t.scrollbarWidth=e.w+1,t.scrollbarHeight=e.h+1,t.dateLocaleModule=this.dateLocaleModule,t.dateClassObj=this.dateClassObj,t.dateModule=this.dateModule,t.dates=[],t.columnCount=this.get("columnCount"),t.subColumns=this.get("subColumns"),t.subColumnCount=t.subColumns?t.subColumns.length:1,t.hScrollPaneWidth=C.getMarginBox(this.grid).w,t.minSheetWidth=this.minColumnWidth<0?-1:this.minColumnWidth*t.subColumnCount*t.columnCount,t.hScrollBarEnabled=this.minColumnWidth>0&&t.hScrollPaneWidth<t.minSheetWidth;var i=this.get("startDate");null==i&&(i=new t.dateClassObj),i=this.floorToDay(i,!1,t),this.startDate=i;for(var r=0;r<t.columnCount;r++)t.dates.push(i),i=this.addAndFloor(i,"day",1);return t.startTime=new t.dateClassObj(t.dates[0]),t.startTime.setHours(t.minHours),t.endTime=new t.dateClassObj(t.dates[t.columnCount-1]),t.endTime.setHours(t.maxHours),this.displayedItemsInvalidated&&!this._isEditing?t.items=this.storeManager._computeVisibleItems(t):this.renderData&&(t.items=this.renderData.items),this.displayedDecorationItemsInvalidated?t.decorationItems=this.decorationStoreManager._computeVisibleItems(t):this.renderData&&(t.decorationItems=this.renderData.decorationItems),t},_validateProperties:function(){this.inherited(arguments);var t=this.minHours;if((t<0||t>23||isNaN(t))&&(this.minHours=0),((t=this.maxHours)<1||t>36||isNaN(t))&&(this.minHours=36),this.minHours>this.maxHours){var e=this.maxHours;this.maxHours=this.minHours,this.minHours=e}this.maxHours-this.minHours<1&&(this.minHours=0,this.maxHours=24),(this.columnCount<1||isNaN(this.columnCount))&&(this.columnCount=1),((t=this.percentOverlap)<0||t>100||isNaN(t))&&(this.percentOverlap=70),(this.hourSize<5||isNaN(this.hourSize))&&(this.hourSize=10),((t=this.timeSlotDuration)<1||t>60||isNaN(t))&&(this.timeSlotDuration=15)},_setStartDateAttr:function(t){this.displayedItemsInvalidated=!0,this._set("startDate",t)},_setColumnCountAttr:function(t){this.displayedItemsInvalidated=!0,this._set("columnCount",t)},__fixEvt:function(t){return t.sheet="primary",t.source=this,t},rowHeaderTimePattern:null,_formatRowHeaderLabel:function(t){return this.renderData.dateLocaleModule.format(t,{selector:"time",timePattern:this.rowHeaderTimePattern})},columnHeaderDatePattern:null,_formatColumnHeaderLabel:function(t){return this.renderData.dateLocaleModule.format(t,{selector:"date",datePattern:this.columnHeaderDatePattern,formatLength:"medium"})},scrollBarRTLPosition:"left",_getStartTimeOfDay:function(){var t=(this.get("maxHours")-this.get("minHours"))*this._getScrollPosition()/this.renderData.sheetHeight;return{hours:this.renderData.minHours+Math.floor(t),minutes:60*(t-Math.floor(t))}},_getEndTimeOfDay:function(){var t=(this.get("maxHours")-this.get("minHours"))*(this._getScrollPosition()+this.scrollContainer.offsetHeight)/this.renderData.sheetHeight;return{hours:this.renderData.minHours+Math.floor(t),minutes:60*(t-Math.floor(t))}},startTimeOfDay:0,_setStartTimeOfDayAttr:function(t){this.renderData?this._setStartTimeOfDay(t.hours,t.minutes,t.duration,t.easing):this._startTimeOfDayInvalidated=!0,this._set("startTimeOfDay",t)},_getStartTimeOfDayAttr:function(){return this.renderData?this._getStartTimeOfDay():this._get("startTimeOfDay")},_setStartTimeOfDay:function(t,e,i,r){var o=this.renderData;t=t||o.minHours,e=e||0,i=i||0,e<0?e=0:e>59&&(e=59),t<0?t=0:t>o.maxHours&&(t=o.maxHours);var s=60*t+e,a=60*o.minHours,n=60*o.maxHours;s<a?s=a:s>n&&(s=n);var l=(s-a)*o.sheetHeight/(n-a);l=Math.min(o.sheetHeight-this.scrollContainer.offsetHeight,l),this._scrollToPosition(l,i,r)},_scrollToPosition:function(t,e,i){if(e){this._scrollAnimation&&this._scrollAnimation.stop();var r=this._getScrollPosition(),o=Math.abs((t-r)*e/this.renderData.sheetHeight);this._scrollAnimation=new h.Animation({curve:[r,t],duration:o,easing:i,onAnimate:a.hitch(this,function(t){this._setScrollImpl(t)})}),this._scrollAnimation.play()}else this._setScrollImpl(t)},_setScrollImpl:function(t){this._setScrollPosition(t),this.scrollBar&&this.scrollBar.set("value",t)},ensureVisibility:function(t,e,i,r,o){if(r=void 0==r?this.renderData.slotDuration:r,this.scrollable&&this.autoScroll){var s=60*t.getHours()+t.getMinutes()-r,a=60*e.getHours()+e.getMinutes()+r,n=this._getStartTimeOfDay(),l=this._getEndTimeOfDay(),h=60*n.hours+n.minutes,d=60*l.hours+l.minutes,u=!1,c=null;switch(i){case"start":u=s>=h&&s<=d,c=s;break;case"end":u=a>=h&&a<=d,c=a-(d-h);break;case"both":u=s>=h&&a<=d,c=s}u||this._setStartTimeOfDay(Math.floor(c/60),c%60,o)}},scrollView:function(t){var e=this._getStartTimeOfDay();e=60*e.hours+e.minutes+t*this.timeSlotDuration,this._setStartTimeOfDay(Math.floor(e/60),e%60)},scrollViewHorizontal:function(t){this._setHScrollPosition(this._getHScrollPosition()+t*this.minColumnWidth),this.hScrollBarW&&this.hScrollBarW.set("value",this._getHScrollPosition())},_hScrollNodes:null,_setHScrollPositionImpl:function(t,e,i){var r=[this.columnHeaderTable,this.subColumnHeaderTable,this.gridTable,this.itemContainerTable],o=e?null:"translateX(-"+t+"px)";n.forEach(r,function(r){e?(r.scrollLeft=t,f.set(r,"left",-t+"px")):f.set(r,i,o)},this)},_mouseWheelScrollHander:function(t){this.renderData.hScrollBarEnabled&&t.altKey?this.scrollViewHorizontal(t.wheelDelta>0?-1:1):this.scrollView(t.wheelDelta>0?-1:1),s.stop(t)},refreshRendering:function(){if(this._initialized){this._validateProperties();var t=this.renderData,e=this._createRenderData();this.renderData=e,this._createRendering(e,t),this._layoutDecorationRenderers(e),this._layoutRenderers(e)}},_createRendering:function(t,e){f.set(this.sheetContainer,"height",t.sheetHeight+"px"),this._configureVisibleParts(t),this._configureScrollBar(t),this._buildColumnHeader(t,e),this._buildSubColumnHeader(t,e),this._buildRowHeader(t,e),this._buildGrid(t,e),this._buildItemContainer(t,e),this._layoutTimeIndicator(t),this._commitProperties(t)},_configureVisibleParts:function(t){this.secondarySheetNode&&f.set(this.secondarySheetNode,"display",this._showSecondarySheet?"block":"none"),m[null==this.subColumns?"remove":"add"](this.domNode,"subColumns"),m[this._showSecondarySheet?"add":"remove"](this.domNode,"secondarySheet")},_commitProperties:function(t){if(this._startTimeOfDayInvalidated){this._startTimeOfDayInvalidated=!1;var e=this.startTimeOfDay;null!=e&&this._setStartTimeOfDay(e.hours,void 0==e.minutes?0:e.minutes)}},_configureScrollBar:function(t){l("ie")&&this.scrollBar&&f.set(this.vScrollBar,"width",t.scrollbarWidth+1+"px");var e=!!this.isLeftToRight()||"right"==this.scrollBarRTLPosition,i=e?"right":"left",r=e?"left":"right";this.scrollBar&&(this.scrollBar.set("maximum",t.sheetHeight),f.set(this.vScrollBar,i,0),f.set(this.vScrollBar,e?"left":"right","auto"),f.set(this.vScrollBar,"bottom",t.hScrollBarEnabled?t.scrollbarHeight+"px":"0")),f.set(this.scrollContainer,i,t.scrollbarWidth+"px"),f.set(this.scrollContainer,r,"0"),f.set(this.header,i,t.scrollbarWidth+"px"),f.set(this.header,r,"0"),f.set(this.subHeader,i,t.scrollbarWidth+"px"),f.set(this.subHeader,r,"0"),this.buttonContainer&&null!=this.owner&&this.owner.currentView==this&&(f.set(this.buttonContainer,i,t.scrollbarWidth+"px"),f.set(this.buttonContainer,r,"0")),this.hScrollBar&&(n.forEach(this._hScrollNodes,function(e){m[t.hScrollBarEnabled?"add":"remove"](e.parentNode,"dojoxCalendarHorizontalScroll")},this),t.hScrollBarEnabled||(this._setHScrollPosition(0),this.hScrollBarW.set("value",0)),f.set(this.hScrollBar,{display:t.hScrollBarEnabled?"block":"none",height:t.scrollbarHeight+"px",left:(e?t.rowHeaderWidth:t.scrollbarWidth)+"px",right:(e?t.scrollbarWidth:t.rowHeaderWidth)+"px"}),f.set(this.scrollContainer,"bottom",t.hScrollBarEnabled?t.scrollbarHeight+1+"px":"0"),this._configureHScrollDomNodes(t.hScrollBarEnabled?t.minSheetWidth+"px":"100%"),this.hScrollBarW.set("maximum",t.minSheetWidth),this.hScrollBarW.set("containerSize",t.hScrollPaneWidth))},_configureHScrollDomNodes:function(t){n.forEach(this._hScrollNodes,function(e){f.set(e,"width",t)},this)},resize:function(t){this._resizeHandler(t)},_resizeHandler:function(t,e){var i=this.renderData;if(null!=i)if(e){var r=C.getMarginBox(this.grid).w;i.hScrollPaneWidth!=r&&(i.hScrollPaneWidth=r,i.minSheetWidth=this.minColumnWidth<0?-1:this.minColumnWidth*i.subColumnCount*i.columnCount,i.hScrollBarEnabled=this.minColumnWidth>0&&C.getMarginBox(this.grid).w<i.minSheetWidth),this._configureScrollBar(i)}else void 0!=this._resizeTimer&&clearTimeout(this._resizeTimer),this._resizeTimer=setTimeout(a.hitch(this,function(){this._resizeHandler(t,!0)}),100)},_columnHeaderClick:function(t){s.stop(t);var e=g("td",this.columnHeaderTable).indexOf(t.currentTarget);this._onColumnHeaderClick({index:e,date:this.renderData.dates[e],triggerEvent:t})},_buildColumnHeader:function(t,e){var i=this.columnHeaderTable;if(i){var r=t.columnCount-(e?e.columnCount:0);8==l("ie")&&(null==this._colTableSave?this._colTableSave=a.clone(i):r<0&&(this._cleanupColumnHeader(),this.columnHeader.removeChild(i),v.destroy(i),i=a.clone(this._colTableSave),this.columnHeaderTable=i,this.columnHeader.appendChild(i),r=t.columnCount));var o,n,h,c=g("tbody",i),f=g("tr",i);if(o=1==c.length?c[0]:d.create("tbody",null,i),n=1==f.length?f[0]:v.create("tr",null,o),r>0)for(var C=0;C<r;C++){h=v.create("td",null,n);var _=[];_.push(u(h,"click",a.hitch(this,this._columnHeaderClick))),l("touch-events")?(_.push(u(h,"touchstart",function(t){s.stop(t),m.add(t.currentTarget,"Active")})),_.push(u(h,"touchend",function(t){s.stop(t),m.remove(t.currentTarget,"Active")}))):(_.push(u(h,"mousedown",function(t){s.stop(t),m.add(t.currentTarget,"Active")})),_.push(u(h,"mouseup",function(t){s.stop(t),m.remove(t.currentTarget,"Active")})),_.push(u(h,"mouseover",function(t){s.stop(t),m.add(t.currentTarget,"Hover")})),_.push(u(h,"mouseout",function(t){s.stop(t),m.remove(t.currentTarget,"Hover")}))),this._columnHeaderHandlers.push(_)}else{r=-r;for(C=0;C<r;C++){h=n.lastChild,n.removeChild(h),v.destroy(h);for(var H=this._columnHeaderHandlers.pop();H.length>0;)H.pop().remove()}}if(g("td",i).forEach(function(e,i){e.className="",0==i?m.add(e,"first-child"):i==this.renderData.columnCount-1&&m.add(e,"last-child");var r=t.dates[i];this._setText(e,this._formatColumnHeaderLabel(r)),this.styleColumnHeaderCell(e,r,t)},this),this.yearColumnHeaderContent){var b=t.dates[0];this._setText(this.yearColumnHeaderContent,t.dateLocaleModule.format(b,{selector:"date",datePattern:"yyyy"}))}}},_cleanupColumnHeader:function(){for(;this._columnHeaderHandlers.length>0;)for(var t=this._columnHeaderHandlers.pop();t.length>0;)t.pop().remove()},styleColumnHeaderCell:function(t,e,i){m.add(t,this._cssDays[e.getDay()]),this.isToday(e)?m.add(t,"dojoxCalendarToday"):this.isWeekEnd(e)&&m.add(t,"dojoxCalendarWeekend")},_buildSubColumnHeader:function(t,e){var i=this.subColumnHeaderTable;if(i&&null!=this.subColumns){var r=t.columnCount-g("td",i).length;8==l("ie")&&(null==this._colSubTableSave?this._colSubTableSave=a.clone(i):r<0&&(this.subColumnHeader.removeChild(i),v.destroy(i),i=a.clone(this._colSubTableSave),this.subColumnHeaderTable=i,this.subColumnHeader.appendChild(i),r=t.columnCount));var o,s,n,h=g(">tbody",i);o=1==h.length?h[0]:d.create("tbody",null,i);var u=g(">tr",o);s=1==u.length?u[0]:v.create("tr",null,o);var c=t.subColumnCount;if(r>0)for(var C=0;C<r;C++)n=v.create("td",null,s),v.create("div",{className:"dojoxCalendarSubHeaderContainer"},n);else{r=-r;for(C=0;C<r;C++)n=s.lastChild,s.removeChild(n),v.destroy(n)}g("td",i).forEach(function(e,i){e.className="",0==i?m.add(e,"first-child"):i==this.renderData.columnCount-1&&m.add(e,"last-child"),g(".dojoxCalendarSubHeaderContainer",e).forEach(function(t,e){if(0!=g(".dojoxCalendarSubHeaderContainer",t).length-c){var i=t.childNodes.length;for(e=0;e<i;e++)t.removeChild(t.lastChild);for(var r=0;r<c;r++)v.create("div",{className:"dojoxCalendarSubHeaderCell dojoxCalendarSubHeaderLabel"},t)}var o=100/c+"%";g(".dojoxCalendarSubHeaderCell",t).forEach(function(t,e){t.className="dojoxCalendarSubHeaderCell dojoxCalendarSubHeaderLabel";var i=1==c?e:Math.floor(e/c);subColIdx=1==c?0:e-i*c,f.set(t,{width:o,left:100*subColIdx/c+"%"}),m[subColIdx<c-1&&1!==c?"add":"remove"](t,"subColumn"),m.add(t,this.subColumns[subColIdx]),this._setText(t,this.subColumnLabelFunc(this.subColumns[subColIdx]))},this)},this);var r=t.dates[i];this.styleSubColumnHeaderCell(e,r,t)},this)}},subColumnLabelFunc:function(t){return t},styleSubColumnHeaderCell:function(t,e,i){m.add(t,this._cssDays[e.getDay()]),this.isToday(e)?m.add(t,"dojoxCalendarToday"):this.isWeekEnd(e)&&m.add(t,"dojoxCalendarWeekend")},_addMinutesClasses:function(t,e){switch(e){case 0:m.add(t,"hour");break;case 30:m.add(t,"halfhour");break;case 15:case 45:m.add(t,"quarterhour")}},_buildRowHeader:function(t,e){var i=this.rowHeaderTable;if(i){null==this._rowHeaderLabelContainer&&(this._rowHeaderLabelContainer=v.create("div",{class:"dojoxCalendarRowHeaderLabelContainer"},this.rowHeader)),f.set(i,"height",t.sheetHeight+"px");var r,o,s=g("tbody",i);r=1==s.length?s[0]:v.create("tbody",null,i);var a=Math.floor(60/t.rowHeaderGridSlotDuration)*t.hourCount-(e?Math.floor(60/e.rowHeaderGridSlotDuration)*e.hourCount:0);if(a>0)for(var n=0;n<a;n++)o=v.create("tr",null,r),v.create("td",null,o);else{a=-a;for(n=0;n<a;n++)r.removeChild(r.lastChild)}var h=this.renderData,d=Math.ceil(t.hourSize/(60/t.rowHeaderGridSlotDuration)),u=new Date(2e3,0,1,0,0,0);g("tr",i).forEach(function(e,i){var r=g("td",e)[0];r.className="",f.set(e,"height",7==l("ie")?d-60/t.rowHeaderGridSlotDuration*2:d+"px");var o=t.minHours+i*this.renderData.rowHeaderGridSlotDuration/60,s=i*this.renderData.rowHeaderGridSlotDuration%60;this.styleRowHeaderCell(r,o,s,h),this._addMinutesClasses(r,s)},this);var c,C=this._rowHeaderLabelContainer;if((a=Math.floor(60/this.rowHeaderLabelSlotDuration)*t.hourCount-C.childNodes.length)>0)for(n=0;n<a;n++)c=v.create("span",null,C),m.add(c,"dojoxCalendarRowHeaderLabel");else{a=-a;for(n=0;n<a;n++)C.removeChild(C.lastChild)}d=Math.ceil(t.hourSize/(60/this.rowHeaderLabelSlotDuration)),g(">span",C).forEach(function(e,i){u.setHours(0),u.setMinutes(60*t.minHours+i*this.rowHeaderLabelSlotDuration),this._configureRowHeaderLabel(e,u,i,d*i,h)},this)}},_configureRowHeaderLabel:function(t,e,i,r,o){this._setText(t,this._formatRowHeaderLabel(e)),f.set(t,"top",r+(0==i?this.rowHeaderFirstLabelOffset:this.rowHeaderLabelOffset)+"px");var s=o.minHours+i*this.rowHeaderLabelSlotDuration/60,a=i*this.rowHeaderLabelSlotDuration%60;m.remove(t,["hour","halfhour","quarterhour"]),this._addMinutesClasses(t,a),this.styleRowHeaderCell(t,s,a,o)},styleRowHeaderCell:function(t,e,i,r){},_buildGrid:function(t,e){var i=this.gridTable;if(i){f.set(i,"height",t.sheetHeight+"px");var r=Math.floor(60/t.slotDuration)*t.hourCount,o=r-(e?Math.floor(60/e.slotDuration)*e.hourCount:0),s=o>0,n=t.columnCount-(e?e.columnCount:0);8==l("ie")&&(null==this._gridTableSave?this._gridTableSave=a.clone(i):n<0&&(this.grid.removeChild(i),v.destroy(i),i=a.clone(this._gridTableSave),this.gridTable=i,this.grid.appendChild(i),n=t.columnCount,o=r,s=!0));var h,d=g("tbody",i);if(h=1==d.length?d[0]:v.create("tbody",null,i),s)for(var u=0;u<o;u++)v.create("tr",null,h);else{o=-o;for(u=0;u<o;u++)h.removeChild(h.lastChild)}var c=Math.floor(60/t.slotDuration)*t.hourCount-o,C=s||n>0;n=C?n:-n,g("tr",i).forEach(function(e,i){if(C){var r=i>=c?t.columnCount:n;for(i=0;i<r;i++)v.create("td",null,e)}else for(i=0;i<n;i++)e.removeChild(e.lastChild)}),g("tr",i).forEach(function(e,i){f.set(e,"height",t.slotSize+"px"),0==i?m.add(e,"first-child"):i==r-1&&m.add(e,"last-child");var o=i*this.renderData.slotDuration%60,s=this.minHours+Math.floor(i*this.renderData.slotDuration/60);g("td",e).forEach(function(e,i){e.className="",0==i?m.add(e,"first-child"):i==this.renderData.columnCount-1&&m.add(e,"last-child");var r=t.dates[i];this.styleGridCell(e,r,s,o,t),this._addMinutesClasses(e,o)},this)},this)}},styleGridCellFunc:null,defaultStyleGridCell:function(t,e,i,r,o){return m.add(t,[this._cssDays[e.getDay()],"H"+i,"M"+r]),this.isToday(e)?m.add(t,"dojoxCalendarToday"):this.isWeekEnd(e)?m.add(t,"dojoxCalendarWeekend"):void 0},styleGridCell:function(t,e,i,r,o){this.styleGridCellFunc?this.styleGridCellFunc(t,e,i,r,o):this.defaultStyleGridCell(t,e,i,r,o)},_buildItemContainer:function(t,e){var i=this.itemContainerTable;if(i){var r=[],o=[];f.set(i,"height",t.sheetHeight+"px");var s=e?e.columnCount:0,n=t.columnCount-s;8==l("ie")&&(null==this._itemTableSave?this._itemTableSave=a.clone(i):n<0&&(this.itemContainer.removeChild(i),this._recycleItemRenderers(!0),v.destroy(i),i=a.clone(this._itemTableSave),this.itemContainerTable=i,this.itemContainer.appendChild(i),n=t.columnCount));var h,d,u,c=g("tbody",i),C=g("tr",i);h=1==c.length?c[0]:v.create("tbody",null,i),d=1==C.length?C[0]:v.create("tr",null,h);var _=t.subColumnCount;if(n>0)for(var H=0;H<n;H++)u=v.create("td",null,d),v.create("div",{className:"dojoxCalendarContainerColumn"},u);else{n=-n;for(H=0;H<n;H++)d.removeChild(d.lastChild)}g("td",i).forEach(function(e,i){g(".dojoxCalendarContainerColumn",e).forEach(function(i,r){if(f.set(i,"height",t.sheetHeight+"px"),0!=g(".dojoxCalendarSubContainerColumn",e).length-_){var o=i.childNodes.length;for(r=0;r<o;r++)i.removeChild(i.lastChild);for(var s=0;s<_;s++){var a=v.create("div",{className:"dojoxCalendarSubContainerColumn"},i);v.create("div",{className:"dojoxCalendarDecorationContainerColumn"},a),v.create("div",{className:"dojoxCalendarEventContainerColumn"},a)}}},this);var s=100/_+"%";g(".dojoxCalendarSubContainerColumn",e).forEach(function(t,e){var i=1==_?e:Math.floor(e/_);subColIdx=1==_?0:e-i*_,f.set(t,{width:s,left:100*subColIdx/_+"%"}),m[subColIdx<_-1&&1!==_?"add":"remove"](t,"subColumn"),g(".dojoxCalendarEventContainerColumn",t).forEach(function(t,e){r.push(t)},this),g(".dojoxCalendarDecorationContainerColumn",t).forEach(function(t,e){o.push(t)},this)},this)},this),t.cells=r,t.decorationCells=o}},showTimeIndicator:!0,timeIndicatorRefreshInterval:6e4,_setShowTimeIndicatorAttr:function(t){this._set("showTimeIndicator",t),this._layoutTimeIndicator(this.renderData)},_layoutTimeIndicator:function(t){if(t){if(this.showTimeIndicator){var e=new t.dateClassObj;if(this.isOverlapping(t,t.startTime,t.endTime,e,e)&&e.getHours()>=this.get("minHours")&&60*e.getHours()+e.getMinutes()<60*this.get("maxHours")){this._timeIndicator||(this._timeIndicator=v.create("div",{className:"dojoxCalendarTimeIndicator"}));for(var i=this._timeIndicator,r=0;r<this.renderData.columnCount&&!this.isSameDay(e,this.renderData.dates[r]);r++);var o=this.computeProjectionOnDate(t,this.floorToDay(e),e,t.sheetHeight);if(o!=t.sheetHeight){f.set(i,{top:o+"px",display:"block"});var s=t.cells[r*t.subColumnCount].parentNode.parentNode;return s!=i.parentNode&&(null!=i.parentNode&&i.parentNode.removeChild(i),s.appendChild(i)),void(null==this._timeIndicatorTimer&&(this._timeIndicatorTimer=setInterval(a.hitch(this,function(){this._layoutTimeIndicator(this.renderData)}),this.timeIndicatorRefreshInterval)))}}}this._timeIndicatorTimer&&(clearInterval(this._timeIndicatorTimer),this._timeIndicatorTimer=null),this._timeIndicator&&f.set(this._timeIndicator,"display","none")}},beforeDeactivate:function(){this._timeIndicatorTimer&&(clearInterval(this._timeIndicatorTimer),this._timeIndicatorTimer=null)},_overlapLayoutPass2:function(t){var e,i,r;for(i=t[t.length-1],o=0;o<i.length;o++)i[o].extent=1;for(e=0;e<t.length-1;e++){i=t[e];for(var o=0;o<i.length;o++)if(-1==(r=i[o]).extent){r.extent=1;for(var s=0,a=!1,n=e+1;n<t.length&&!a;n++){for(var l=t[n],h=0;h<l.length&&!a;h++){var d=l[h];r.start<d.end&&d.start<r.end&&(a=!0)}a||s++}r.extent+=s}}},_defaultItemToRendererKindFunc:function(t){return"vertical"},_layoutInterval:function(t,e,i,r,o,s){var a=[];if(t.colW=this.itemContainer.offsetWidth/t.columnCount,"dataItems"===s){for(var n=0;n<o.length;n++){var l=o[n];"vertical"===this._itemToRendererKind(l)&&a.push(l)}this._layoutRendererWithSubColumns(t,"vertical",!0,e,i,r,a,s)}else this._layoutRendererWithSubColumns(t,"decoration",!1,e,i,r,o,s)},_layoutRendererWithSubColumns:function(t,e,i,r,o,s,l,h){if(l.length>0)if(t.subColumnCount>1){var d={},u=this.subColumns;n.forEach(u,function(t){d[t]=[]}),n.forEach(l,function(t){"decorationItems"===h?t.subColumn?d[t.subColumn]&&d[t.subColumn].push(t):n.forEach(u,function(e){var i=a.mixin({},t);i.subColumn=e,d[e].push(i)}):t.subColumn&&d[t.subColumn]&&d[t.subColumn].push(t)});var c=0;n.forEach(this.subColumns,function(a){this._layoutVerticalItems(t,e,i,r,c++,o,s,d[a],h)},this)}else this._layoutVerticalItems(t,e,i,r,0,o,s,l,h)},_getColumn:function(t,e,i,r){return("dataItems"===r?t.cells:t.decorationCells)[e*t.subColumnCount+i]},_layoutVerticalItems:function(t,e,i,r,o,s,n,l,h){if(!("dataItems"===h&&null==this.verticalRenderer||"decorationItems"===h&&null==this.verticalDecorationRenderer)){for(var d=this._getColumn(t,r,o,h),u=[],c=0;c<l.length;c++){var m=l[c],C=this.computeRangeOverlap(t,m.startTime,m.endTime,s,n),_=this.computeProjectionOnDate(t,s,C[0],t.sheetHeight),g=this.computeProjectionOnDate(t,s,C[1],t.sheetHeight);if(g>_){var H=a.mixin({start:_,end:g,range:C,item:m},m);u.push(H)}}var b="dataItems"===h?this.computeOverlapping(u,this._overlapLayoutPass2).numLanes:1,p=this.percentOverlap/100;for(c=0;c<u.length;c++){var S,T,D,y;if(m=u[c],"dataItems"===h){var x=m.lane,w=m.extent;0==p?(T=x*((S=1==b?t.colW:(t.colW-(b-1)*this.horizontalGap)/b)+this.horizontalGap),S=100*(S=1==w?S:S*w+(w-1)*this.horizontalGap)/t.colW,T=100*T/t.colW):(T=x*((S=1==b?100:100/(b-(b-1)*p))-p*S),S=1==w?S:S*(w-(w-1)*p)),D=this._createRenderer(m,"vertical",this.verticalRenderer,"dojoxCalendarVertical");var I=this.isItemBeingEdited(m),M=this.isItemSelected(m),P=this.isItemHovered(m),j=this.isItemFocused(m);(y=D.renderer).set("hovered",P),y.set("selected",M),y.set("edited",I),y.set("focused",!!this.showFocus&&j),y.set("storeState",this.getItemStoreState(m)),y.set("moveEnabled",this.isItemMoveEnabled(m._item,"vertical")),y.set("resizeEnabled",this.isItemResizeEnabled(m._item,"vertical")),this.applyRendererZIndex(m,D,P,M,I,j)}else S=100,T=0,y=(D=this.decorationRendererManager.createRenderer(m,"vertical",this.verticalDecorationRenderer,"dojoxCalendarDecoration")).renderer;f.set(D.container,{top:m.start+"px",left:T+"%",width:S+"%",height:m.end-m.start+1+"px"}),y.updateRendering&&y.updateRendering(S,m.end-m.start+1),v.place(D.container,d),f.set(D.container,"display","block")}}},_sortItemsFunction:function(t,e){var i=this.dateModule.compare(t.startTime,e.startTime);return 0==i&&(i=-1*this.dateModule.compare(t.endTime,e.endTime)),this.isLeftToRight()?i:-i},_getNormalizedCoords:function(t,e,i,r){if(null!=t){var o=C.position(this.itemContainer,!0);t.touches?(r=void 0==r?0:r,e=t.touches[r].pageX-o.x,i=t.touches[r].pageY-o.y):(e=t.pageX-o.x,i=t.pageY-o.y)}var s=C.getContentBox(this.itemContainer);return this.isLeftToRight()||(e=s.w-e),e<0?e=0:e>s.w&&(e=s.w-1),i<0?i=0:i>s.h&&(i=s.h-1),{x:e,y:i}},getTime:function(t,e,i,r){var o=this._getNormalizedCoords(t,e,i,r),s=this.getTimeOfDay(o.y,this.renderData),a=C.getMarginBox(this.itemContainer).w/this.renderData.columnCount,n=Math.floor(o.x/a),l=null;return n<this.renderData.dates.length&&(l=this.newDate(this.renderData.dates[n]),(l=this.floorToDay(l,!0)).setHours(s.hours),l.setMinutes(s.minutes)),l},getSubColumn:function(t,e,i,r){if(null==this.subColumns||1==this.subColumns.length)return null;var o=this._getNormalizedCoords(t,e,i,r),s=this.renderData,a=C.getMarginBox(this.itemContainer).w/this.renderData.columnCount,n=Math.floor(o.x/a),l=Math.floor((o.x-n*a)/(a/s.subColumnCount));return this.subColumns[l]},_onGridMouseUp:function(t){this.inherited(arguments),this._gridMouseDown&&(this._gridMouseDown=!1,this._onGridClick({date:this.getTime(t),triggerEvent:t}))},_onGridTouchStart:function(t){this.inherited(arguments);var e=this._gridProps;e.moved=!1,e.start=t.touches[0].screenY,e.scrollTop=this._getScrollPosition()},_onGridTouchMove:function(t){if(this.inherited(arguments),t.touches.length>1&&!this._isEditing)s.stop(t);else if(this._gridProps&&!this._isEditing){var e={x:t.touches[0].screenX,y:t.touches[0].screenY},i=this._edProps;if(!i||i&&(Math.abs(e.x-i.start.x)>25||Math.abs(e.y-i.start.y)>25)){this._gridProps.moved=!0;var r=t.touches[0].screenY-this._gridProps.start,o=this._gridProps.scrollTop-r,a=this.itemContainer.offsetHeight-this.scrollContainer.offsetHeight;o<0?(this._gridProps.start=t.touches[0].screenY,this._setScrollImpl(0),this._gridProps.scrollTop=0):o>a?(this._gridProps.start=t.touches[0].screenY,this._setScrollImpl(a),this._gridProps.scrollTop=a):this._setScrollImpl(o)}}},_onGridTouchEnd:function(t){this.inherited(arguments);var e=this._gridProps;e&&(this._isEditing||e.moved||(e.fromItem||e.editingOnStart||this.selectFromEvent(t,null,null,!0),e.fromItem||(this._pendingDoubleTap&&this._pendingDoubleTap.grid?(this._onGridDoubleClick({date:this.getTime(this._gridProps.event),triggerEvent:this._gridProps.event}),clearTimeout(this._pendingDoubleTap.timer),delete this._pendingDoubleTap):(this._onGridClick({date:this.getTime(this._gridProps.event),triggerEvent:this._gridProps.event}),this._pendingDoubleTap={grid:!0,timer:setTimeout(a.hitch(this,function(){delete this._pendingDoubleTap}),this.doubleTapDelay)}))),this._gridProps=null)},_onColumnHeaderClick:function(t){this._dispatchCalendarEvt(t,"onColumnHeaderClick")},onColumnHeaderClick:function(t){},getTimeOfDay:function(t,e){var i=60*e.minHours,r=i+t*(60*e.maxHours-i)/e.sheetHeight;return{hours:Math.floor(r/60),minutes:Math.floor(r%60)}},_isItemInView:function(t){var e=this.inherited(arguments);if(e){var i=this.renderData;if(i.dateModule.difference(t.startTime,t.endTime,"millisecond")>36e5*(24-i.maxHours+i.minHours))return!0;var r=60*t.startTime.getHours()+t.startTime.getMinutes(),o=60*t.endTime.getHours()+t.endTime.getMinutes(),s=60*i.minHours,a=60*i.maxHours;if(r>0&&r<s||r>a&&r<=1440)return!1;if(o>0&&o<s||o>a&&o<=1440)return!1}return e},_ensureItemInView:function(t){var e,i=t.startTime,r=t.endTime,o=this.renderData,s=o.dateModule,a=Math.abs(s.difference(t.startTime,t.endTime,"millisecond"));if(a>36e5*(24-o.maxHours+o.minHours))return!1;var n=60*i.getHours()+i.getMinutes(),l=60*r.getHours()+r.getMinutes(),h=60*o.minHours,d=60*o.maxHours;return n>0&&n<h?(this.floorToDay(t.startTime,!0,o),t.startTime.setHours(o.minHours),t.endTime=s.add(t.startTime,"millisecond",a),e=!0):n>d&&n<=1440&&(this.floorToDay(t.startTime,!0,o),t.startTime=s.add(t.startTime,"day",1),t.startTime.setHours(o.minHours),t.endTime=s.add(t.startTime,"millisecond",a),e=!0),l>0&&l<h?(this.floorToDay(t.endTime,!0,o),t.endTime=s.add(t.endTime,"day",-1),t.endTime.setHours(o.maxHours),t.startTime=s.add(t.endTime,"millisecond",-a),e=!0):l>d&&l<=1440&&(this.floorToDay(t.endTime,!0,o),t.endTime.setHours(o.maxHours),t.startTime=s.add(t.endTime,"millisecond",-a),e=!0),e=e||this.inherited(arguments)},_onScrollTimer_tick:function(){this._scrollToPosition(this._getScrollPosition()+this._scrollProps.scrollStep)},snapUnit:"minute",snapSteps:15,minDurationUnit:"minute",minDurationSteps:15,liveLayout:!1,stayInView:!0,allowStartEndSwap:!0,allowResizeLessThan24H:!0})});
//# sourceMappingURL=../sourcemaps/calendar/SimpleColumnView.js.map
