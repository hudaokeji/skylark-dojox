/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/dom","dojo/dom-style","./_base","./TouchInteractionSupport","./Layer","./Patch"],function(e,r,a,t,n,s,o,y,i,l,L){return e.experimental("dojox.geo.openlayers.Map"),L.patchGFX(),r("dojox.geo.openlayers.Map",null,{olMap:null,_tp:null,constructor:function(e,r){r||(r={}),e=s.byId(e),this._tp={x:0,y:0};var a=r.openLayersMapOptions;if(a||(a={controls:[new OpenLayers.Control.ScaleLine({maxWidth:200}),new OpenLayers.Control.Navigation]}),r.accessible){var t=new OpenLayers.Control.KeyboardDefaults;a.controls||(a.controls=[]),a.controls.push(t)}var n=r.baseLayerType;n||(n=y.BaseLayerType.OSM);var o=new OpenLayers.Map(e,a);this.olMap=o,this._layerDictionary={olLayers:[],layers:[]},r.touchHandler&&(this._touchControl=new i(o));var l=this._createBaseLayer(r);this.addLayer(l),this.initialFit(r)},initialFit:function(e){var r=e.initialLocation;r||(r=[-160,70,160,-70]),this.fitTo(r)},setBaseLayerType:function(e){if(e==this.baseLayerType)return null;var r=null;"string"==typeof e?(r={baseLayerName:e,baseLayerType:e},this.baseLayerType=e):"object"==typeof e&&(r=e,this.baseLayerType=r.baseLayerType);var a=null;if(null!=r&&null!=(a=this._createBaseLayer(r))){var t=this.olMap,n=t.getZoom(),s=t.getCenter(),o=!!s&&!!t.baseLayer&&!!t.baseLayer.map;if(o){var i=t.getProjectionObject();null!=i&&(s=s.transform(i,y.EPSG4326))}var l=t.baseLayer;if(null!=l){var L=this._getLayer(l);this.removeLayer(L)}null!=a&&this.addLayer(a),o&&(null!=(i=t.getProjectionObject())&&(s=s.transform(y.EPSG4326,i)),t.setCenter(s,n))}return a},getBaseLayerType:function(){return this.baseLayerType},getScale:function(e){var r=null,a=this.olMap;if(e){if(!a.getUnits())return null;var t=OpenLayers.INCHES_PER_UNIT;r=(a.getGeodesicPixelSize().w||1e-6)*t.km*OpenLayers.DOTS_PER_INCH}else r=a.getScale();return r},getOLMap:function(){return this.olMap},_createBaseLayer:function(e){var r=null,a=e.baseLayerType,t=e.baseLayerUrl,n=e.baseLayerName,s=e.baseLayerOptions;switch(n||(n=a),s||(s={}),a){case y.BaseLayerType.OSM:s.transitionEffect="resize",r=new l(n,{olLayer:new OpenLayers.Layer.OSM(n,t,s)});break;case y.BaseLayerType.Transport:s.transitionEffect="resize",r=new l(n,{olLayer:new OpenLayers.Layer.OSM.TransportMap(n,t,s)});break;case y.BaseLayerType.WMS:t||(t="http://labs.metacarta.com/wms/vmap0",s.layers||(s.layers="basic")),r=new l(n,{olLayer:new OpenLayers.Layer.WMS(n,t,s,{transitionEffect:"resize"})});break;case y.BaseLayerType.GOOGLE:r=new l(n,{olLayer:new OpenLayers.Layer.Google(n,s)});break;case y.BaseLayerType.VIRTUAL_EARTH:r=new l(n,{olLayer:new OpenLayers.Layer.VirtualEarth(n,s)});break;case y.BaseLayerType.YAHOO:r=new l(n,{olLayer:new OpenLayers.Layer.Yahoo(n,s)});break;case y.BaseLayerType.ARCGIS:t||(t="http://server.arcgisonline.com/ArcGIS/rest/services/ESRI_StreetMap_World_2D/MapServer/export"),r=new l(n,{olLayer:new OpenLayers.Layer.ArcGIS93Rest(n,t,s,{})})}return null==r&&(a instanceof OpenLayers.Layer?r=a:(s.transitionEffect="resize",r=new l(n,{olLayer:new OpenLayers.Layer.OSM(n,t,s)}),this.baseLayerType=y.BaseLayerType.OSM)),r},removeLayer:function(e){var r=this.olMap,a=t.indexOf(this._layerDictionary.layers,e);a>0&&this._layerDictionary.layers.splice(a,1);var n=e.olLayer,s=t.indexOf(this._layerDictionary.olLayers,n);s>0&&this._layerDictionary.olLayers.splice(a,s),r.removeLayer(n,!1)},layerIndex:function(e,r){var a=this.olMap;return r?(a.setLayerIndex(e.olLayer,r),this._layerDictionary.layers.sort(function(e,r){return a.getLayerIndex(e.olLayer)-a.getLayerIndex(r.olLayer)}),this._layerDictionary.olLayers.sort(function(e,r){return a.getLayerIndex(e)-a.getLayerIndex(r)}),r):a.getLayerIndex(e.olLayer)},addLayer:function(e){e.dojoMap=this;var r=this.olMap,a=e.olLayer;this._layerDictionary.olLayers.push(a),this._layerDictionary.layers.push(e),r.addLayer(a),e.added()},_getLayer:function(e){var r=t.indexOf(this._layerDictionary.olLayers,e);return-1!=r?this._layerDictionary.layers[r]:null},getLayer:function(e,r){var a=this.olMap.getBy("layers",e,r),n=new Array;return t.forEach(a,function(e){n.push(this._getLayer(e))},this),n},getLayerCount:function(){var e=this.olMap;return null==e.layers?0:e.layers.length},fitTo:function(e){var r=this.olMap,a=y.EPSG4326;if(null!=e){var t,s,o=null;if("string"==typeof e)var i=n.fromJson(e);else i=e;if(i.hasOwnProperty("bounds")){var l=i.bounds;o=new OpenLayers.Bounds,t=this.transformXY(l[0],l[1],a),o.left=t.x,o.top=t.y,s=this.transformXY(l[2],l[3],a),o.right=s.x,o.bottom=s.y}if(null==o&&i.hasOwnProperty("position")){var L=i.position,p=i.hasOwnProperty("extent")?i.extent:1;"string"==typeof p&&(p=parseFloat(p)),o=new OpenLayers.Bounds,t=this.transformXY(L[0]-p,L[1]+p,a),o.left=t.x,o.top=t.y,s=this.transformXY(L[0]+p,L[1]-p,a),o.right=s.x,o.bottom=s.y}null==o&&4==e.length&&(o=new OpenLayers.Bounds,t=this.transformXY(e[0],e[1],a),o.left=t.x,o.top=t.y,s=this.transformXY(e[2],e[3],a),o.right=s.x,o.bottom=s.y),null!=o&&r.zoomToExtent(o,!0)}else{var c=this.transformXY(0,0,a);r.setCenter(new OpenLayers.LonLat(c.x,c.y))}},transform:function(e,r,a){return this.transformXY(e.x,e.y,r,a)},transformXY:function(e,r,a,t){var n=this._tp;return n.x=e,n.y=r,a||(a=y.EPSG4326),t||(t=this.olMap.getProjectionObject()),n=OpenLayers.Projection.transform(n,a,t)}})});
//# sourceMappingURL=../../sourcemaps/geo/openlayers/Map.js.map
