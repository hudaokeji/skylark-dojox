{"version":3,"sources":["string/BidiComplex.js"],"names":["define","dojo","lang","arr","hub","has","keys","experimental","bdc","getObject","dojox","_str0","attachInput","field","pattern","alt","connect","this","value","createDisplayString","str","stripSpecialCharacters","segmentsPointers","_parse","buf","shift","forEach","n","preStr","substring","postStr","length","replace","_ceKeyDown","event","elem","srcElement","target","_ceKeyUp","str1","ieKey","keyCode","HOME","END","SHIFT","cursorStart","cursorEnd","selection","_getCaretPos","cursorStart1","cursorEnd1","LEFT_ARROW","charAt","_setSelectedRange","RIGHT_ARROW","str2","window","status","DELETE","BACKSPACE","_processCopy","text","isReverse","document","createRange","selectionStart","selectionEnd","textToClipboard","clipboardData","setData","_ceCopyText","returnValue","_ceCutText","clear","curPos","setSelectionRange","position","range","duplicate","range2","rangeLength","type","moveToElementText","expand","compareEndPoints","moveStart","createTextRange","collapse","moveEnd","select","_isLatinChar","c","_isCharBeforeBiDiChar","buffer","i","previous","delimiters","FILE_PATH","URL","XPATH","EMAIL","ch","indexOf","push","i1"],"mappings":"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","file":"../../string/BidiComplex.js","sourcesContent":["// summary:\r\n//\t\tBiDiComplex module handles complex expression issues known when using BiDi characters\r\n//\t\tin File Paths, URLs, E-mail Address, XPATH, etc.\r\n//\t\tthis module adds property listeners to the text fields to correct the text representation\r\n//\t\tin both static text and dynamic text during user input.\r\n\r\ndefine([\"dojo/_base/kernel\", \"dojo/_base/lang\", \"dojo/_base/array\", \"dojo/_base/connect\", \"dojo/_base/sniff\",\r\n\t\t\"dojo/keys\"], \r\n  function(dojo, lang, arr, hub, has, keys){\r\n\tdojo.experimental(\"dojox.string.BidiComplex\");\r\n\tvar bdc = lang.getObject(\"string.BidiComplex\", true, dojox);\r\n\r\n\tvar _str0 = []; //FIXME: shared reference here among various functions means the functions can't be reused\r\n\r\n\tbdc.attachInput = function(/*DOMNode*/field, /*String*/pattern){\r\n\t\t// summary:\r\n\t\t//\t\tAttach key listeners to the INPUT field to accommodate dynamic complex BiDi expressions\r\n\t\t// field: INPUT DOM node\r\n\t\t// pattern: Complex Expression Pattern type. One of \"FILE_PATH\", \"URL\", \"EMAIL\", \"XPATH\"\r\n\r\n\t\tfield.alt = pattern;\r\n\r\n\t\thub.connect(field, \"onkeydown\",  this, \"_ceKeyDown\");\r\n\t\thub.connect(field, \"onkeyup\", this, \"_ceKeyUp\");\r\n\r\n\t\thub.connect(field, \"oncut\", this, \"_ceCutText\");\r\n\t\thub.connect(field, \"oncopy\", this, \"_ceCopyText\");\r\n\r\n\t\tfield.value = bdc.createDisplayString(field.value, field.alt);\r\n\t};\r\n\t\t\r\n\tbdc.createDisplayString = function(/*String*/str, /*String*/pattern){\r\n\t\t// summary:\r\n\t\t//\t\tCreate the display string by adding the Unicode direction Markers\r\n\t\t// pattern: Complex Expression Pattern type. One of \"FILE_PATH\", \"URL\", \"EMAIL\", \"XPATH\"\r\n\r\n\t\tstr = bdc.stripSpecialCharacters(str);\r\n\t\tvar segmentsPointers = bdc._parse(str, pattern);\r\n\t\t\r\n\t\tvar buf = '\\u202A'/*LRE*/ + str;\r\n\t\tvar shift = 1;\r\n\t\tarr.forEach(segmentsPointers, function(n){\r\n\t\t\tif(n != null){\r\n\t\t\t\tvar preStr = buf.substring(0, n + shift);\r\n\t\t\t\tvar postStr = buf.substring(n + shift, buf.length);\r\n\t\t\t\tbuf = preStr + '\\u200E'/*LRM*/ + postStr;\r\n\t\t\t\tshift++;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn buf;\r\n\t};\r\n\r\n\tbdc.stripSpecialCharacters = function(str){\r\n\t\t// summary:\r\n\t\t//\t\tremoves all Unicode directional markers from the string\r\n\r\n\t\treturn str.replace(/[\\u200E\\u200F\\u202A-\\u202E]/g, \"\"); // String\r\n\t};\r\n\r\n\tbdc._ceKeyDown = function(event){\r\n\t\tvar elem = has(\"ie\") ? event.srcElement : event.target;\r\n\t\t_str0 = elem.value;\r\n\t};\r\n\t\t\t\t\r\n\tbdc._ceKeyUp = function(event){\r\n\t\tvar LRM = '\\u200E';\r\n\t\tvar elem = has(\"ie\") ? event.srcElement : event.target;\r\n\r\n\t\tvar str1 = elem.value;\r\n\t\tvar ieKey = event.keyCode;\r\n\t\t\r\n\t\tif((ieKey == keys.HOME)\r\n\t\t\t|| (ieKey == keys.END)\r\n\t\t\t|| (ieKey == keys.SHIFT)){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar cursorStart, cursorEnd;\r\n\t\tvar selection = bdc._getCaretPos(event, elem);\r\n\t\tif(selection){\r\n\t\t\tcursorStart = selection[0];\r\n\t\t\tcursorEnd = selection[1];\r\n\t\t}\r\n\r\n\t//Jump over a cursor processing\r\n\t\tif(has(\"ie\")){\r\n\t\t\tvar cursorStart1 = cursorStart, cursorEnd1 = cursorEnd;\r\n\r\n\t\t\tif(ieKey == keys.LEFT_ARROW){\r\n\t\t\t\tif((str1.charAt(cursorEnd-1) == LRM)\r\n\t\t\t\t\t\t&& (cursorStart == cursorEnd)){\r\n\t\t\t\t\tbdc._setSelectedRange(elem,cursorStart - 1, cursorEnd - 1);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(ieKey == keys.RIGHT_ARROW){\r\n\t\t\t\tif(str1.charAt(cursorEnd-1) == LRM){\r\n\t\t\t\t\tcursorEnd1 = cursorEnd + 1;\r\n\t\t\t\t\tif(cursorStart == cursorEnd){\r\n\t\t\t\t\t\tcursorStart1 = cursorStart + 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbdc._setSelectedRange(elem, cursorStart1, cursorEnd1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}else{ //Firefox\r\n\t\t\tif(ieKey == keys.LEFT_ARROW){\r\n\t\t\t\tif(str1.charAt(cursorEnd-1) == LRM){\r\n\t\t\t\t\tbdc._setSelectedRange(elem, cursorStart - 1, cursorEnd - 1);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(ieKey == keys.RIGHT_ARROW){\r\n\t\t\t\tif(str1.charAt(cursorEnd-1) == LRM){\r\n\t\t\t\t\tbdc._setSelectedRange(elem, cursorStart + 1, cursorEnd + 1);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar str2 = bdc.createDisplayString(str1, elem.alt);\r\n\r\n\t\tif(str1 != str2)\r\n\t\t{\r\n\t\t\twindow.status = str1 + \" c=\" + cursorEnd;\r\n\t\t\telem.value = str2;\r\n\r\n\t\t\tif((ieKey == keys.DELETE) && (str2.charAt(cursorEnd)==LRM)){\r\n\t\t\t\telem.value = str2.substring(0, cursorEnd) + str2.substring(cursorEnd+2, str2.length);\r\n\t\t\t}\r\n\r\n\t\t\tif(ieKey == keys.DELETE){\r\n\t\t\t\tbdc._setSelectedRange(elem,cursorStart,cursorEnd);\r\n\t\t\t}else if(ieKey == keys.BACKSPACE){\r\n\t\t\t\tif((_str0.length >= cursorEnd) && (_str0.charAt(cursorEnd-1)==LRM)){\r\n\t\t\t\t\tbdc._setSelectedRange(elem, cursorStart - 1, cursorEnd - 1);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tbdc._setSelectedRange(elem, cursorStart, cursorEnd);\r\n\t\t\t\t}\r\n\t\t\t}else if(elem.value.charAt(cursorEnd) != LRM){\r\n\t\t\t\tbdc._setSelectedRange(elem, cursorStart + 1, cursorEnd + 1);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tbdc._processCopy = function(elem, text, isReverse){\r\n\t\t// summary:\r\n\t\t//\t\tThis function strips the unicode directional controls when the text copied to the Clipboard\r\n\r\n\t\tif(text == null){\r\n\t\t\tif(has(\"ie\")){\r\n\t\t\t\tvar range = document.selection.createRange();\r\n\t\t\t\ttext = range.text;\r\n\t\t\t}else{\r\n\t\t\t\ttext = elem.value.substring(elem.selectionStart, elem.selectionEnd);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar textToClipboard = bdc.stripSpecialCharacters(text);\r\n\t\r\n\t\tif(has(\"ie\")){\r\n\t\t\twindow.clipboardData.setData(\"Text\", textToClipboard);\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\r\n\tbdc._ceCopyText = function(elem){\r\n\t\tif(has(\"ie\")){\r\n\t\t\telem.returnValue = false;\r\n\t\t}\r\n\t\treturn bdc._processCopy(elem, null, false);\r\n\t};\r\n\r\n\tbdc._ceCutText = function(elem){\r\n\r\n\t\tvar ret = bdc._processCopy(elem, null, false);\r\n\t\tif(!ret){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif(has(\"ie\")){\r\n\t//\t\tcurPos = elem.selectionStart;\r\n\t\t\tdocument.selection.clear();\r\n\t\t}else{\r\n\t\t\tvar curPos = elem.selectionStart;\r\n\t\t\telem.value = elem.value.substring(0, curPos) + elem.value.substring(elem.selectionEnd);\r\n\t\t\telem.setSelectionRange(curPos, curPos);\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t};\r\n\r\n\t// is there dijit code to do this?\r\n\tbdc._getCaretPos = function(event, elem){\r\n\t\tif(has(\"ie\")){\r\n\t\t\tvar position = 0,\r\n\t\t\trange = document.selection.createRange().duplicate(),\r\n\t\t\trange2 = range.duplicate(),\r\n\t\t\trangeLength = range.text.length;\r\n\r\n\t\t\tif(elem.type == \"textarea\"){\r\n\t\t\t\trange2.moveToElementText(elem);\r\n\t\t\t}else{\r\n\t\t\t\trange2.expand('textedit');\r\n\t\t\t}\r\n\t\t\twhile(range.compareEndPoints('StartToStart', range2) > 0){\r\n\t\t\t\trange.moveStart('character', -1);\r\n\t\t\t\t++position;\r\n\t\t\t}\r\n\r\n\t\t\treturn [position, position + rangeLength];\r\n\t\t}\r\n\r\n\t\treturn [event.target.selectionStart, event.target.selectionEnd];\r\n\t};\r\n\r\n\t// is there dijit code to do this?\r\n\tbdc._setSelectedRange = function(elem,selectionStart,selectionEnd){\r\n\t\tif(has(\"ie\")){\r\n\t\t\tvar range = elem.createTextRange();\r\n\t\t\tif(range){\r\n\t\t\t\tif(elem.type == \"textarea\"){\r\n\t\t\t\t\trange.moveToElementText(elem);\r\n\t\t\t\t}else{\r\n\t\t\t\t\trange.expand('textedit');\r\n\t\t\t\t}\r\n\r\n\t\t\t\trange.collapse();\r\n\t\t\t\trange.moveEnd('character', selectionEnd);\r\n\t\t\t\trange.moveStart('character', selectionStart);\r\n\t\t\t\trange.select();\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\telem.selectionStart = selectionStart;\r\n\t\t\telem.selectionEnd = selectionEnd;\r\n\t\t}\r\n\t};\r\n\r\n\tvar _isBidiChar = function(c){\r\n\t\treturn (c >= '\\u0030' && c <= '\\u0039') || (c > '\\u00ff');\r\n\t};\r\n\r\n\tvar _isLatinChar = function(c){\r\n\t\treturn (c >= '\\u0041' && c <= '\\u005A') || (c >= '\\u0061' && c <= '\\u007A');\r\n\t};\r\n\r\n\tvar _isCharBeforeBiDiChar = function(buffer, i, previous){\r\n\t\twhile(i > 0){\r\n\t\t\tif(i == previous){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\ti--;\r\n\t\t\tif(_isBidiChar(buffer.charAt(i))){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif(_isLatinChar(buffer.charAt(i))){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\r\n\r\n\tbdc._parse = function(/*String*/str, /*String*/pattern){\r\n\t\tvar previous = -1, segmentsPointers = [];\r\n\t\tvar delimiters = {\r\n\t\t\tFILE_PATH: \"/\\\\:.\",\r\n\t\t\tURL: \"/:.?=&#\",\r\n\t\t\tXPATH: \"/\\\\:.<>=[]\",\r\n\t\t\tEMAIL: \"<>@.,;\"\r\n\t\t}[pattern];\r\n\r\n\t\tswitch(pattern){\r\n\t\t\tcase \"FILE_PATH\":\r\n\t\t\tcase \"URL\":\r\n\t\t\tcase \"XPATH\":\r\n\t\t\t\tarr.forEach(str, function(ch, i){\r\n\t\t\t\t\tif(delimiters.indexOf(ch) >= 0 && _isCharBeforeBiDiChar(str, i, previous)){\r\n\t\t\t\t\t\tprevious = i;\r\n\t\t\t\t\t\tsegmentsPointers.push(i);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"EMAIL\":\r\n\t\t\t\tvar inQuotes = false; // FIXME: unused?\r\n\t\r\n\t\t\t\tarr.forEach(str, function(ch, i){\r\n\t\t\t\t\tif(ch== '\\\"'){\r\n\t\t\t\t\t\tif(_isCharBeforeBiDiChar(str, i, previous)){\r\n\t\t\t\t\t\t\tprevious = i;\r\n\t\t\t\t\t\t\tsegmentsPointers.push(i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\tvar i1 = str.indexOf('\\\"', i);\r\n\t\t\t\t\t\tif(i1 >= i){\r\n\t\t\t\t\t\t\ti = i1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(_isCharBeforeBiDiChar(str, i, previous)){\r\n\t\t\t\t\t\t\tprevious = i;\r\n\t\t\t\t\t\t\tsegmentsPointers.push(i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tif(delimiters.indexOf(ch) >= 0 && _isCharBeforeBiDiChar(str, i, previous)){\r\n\t\t\t\t\t\t\t\tprevious = i;\r\n\t\t\t\t\t\t\t\tsegmentsPointers.push(i);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\t\treturn segmentsPointers;\r\n\t};\r\n\treturn bdc;\r\n});\r\n"]}