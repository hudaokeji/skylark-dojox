{"version":3,"sources":["wire/ml/Invocation.js"],"names":["dojo","provide","require","declare","dojox","wire","ml","Action","object","method","topic","parameters","result","error","_run","this","args","_getParameters","arguments","publish","onComplete","e","onError","scope","_getValue","global","func","callMethod","connected","getFeatures","features","arg","connect","r","apply","Deferred","self","addCallbacks","_setValue","message","list","split","length","parameter","trim","isArray","push","i"],"mappings":";;;;;;;AAAAA,KAAKC,QAAQ,4BAEbD,KAAKE,QAAQ,wBAEbF,KAAKG,QAAQ,2BAA4BC,MAAMC,KAAKC,GAAGC,QAStDC,OAAQ,GAIRC,OAAQ,GAIRC,MAAO,GAIPC,WAAY,GAIZC,OAAQ,GAIRC,MAAO,GAEPC,KAAM,WAaL,GAAGC,KAAKL,MAAM,CACb,IAAIM,EAAOD,KAAKE,eAAeC,WAC/B,IACClB,KAAKmB,QAAQJ,KAAKL,MAAOM,GACzBD,KAAKK,aACL,MAAMC,GACNN,KAAKO,QAAQD,SAET,GAAGN,KAAKN,OAAO,CACpB,IAAIc,EAASR,KAAKP,OAASJ,MAAMC,KAAKC,GAAGkB,UAAUT,KAAKP,QAAUR,KAAKyB,OACvE,IAAIF,EACH,OAEGP,EAAOD,KAAKE,eAAeC,WAA/B,IACIQ,EAAOH,EAAMR,KAAKN,QACtB,IAAIiB,EAAK,CAER,KADAA,EAAOH,EAAMI,YAEZ,OAEDX,GAAQD,KAAKN,OAAQO,GAEtB,IACC,IAAIY,GAAY,EAChB,GAAGL,EAAMM,YAAY,CACpB,IAAIC,EAAWP,EAAMM,cACrB,GAAmB,SAAfd,KAAKN,QAAqBqB,EAAS,uBACtB,QAAff,KAAKN,QAAoBqB,EAAS,uBAAwB,CAC3D,IAAIC,EAAMf,EAAK,GACXe,EAAIX,aACPW,EAAIX,WAAa,cAGlBL,KAAKiB,QAAQD,EAAK,aAAc,cAC5BA,EAAIT,UACPS,EAAIT,QAAU,cAGfP,KAAKiB,QAAQD,EAAK,UAAW,WAC7BH,GAAY,GAGd,IAAIK,EAAIP,EAAKQ,MAAMX,EAAOP,GAC1B,IAAIY,EACH,GAAGK,GAAMA,aAAajC,KAAKmC,SAAU,CACpC,IAAIC,EAAOrB,KACXkB,EAAEI,aACD,SAASzB,GAAQwB,EAAKhB,WAAWR,IACjC,SAASC,GAAOuB,EAAKd,QAAQT,UAG9BE,KAAKK,WAAWa,GAGlB,MAAMZ,GACNN,KAAKO,QAAQD,MAKhBD,WAAY,SAAqBR,GAS7BG,KAAKH,QACPR,MAAMC,KAAKC,GAAGgC,UAAUvB,KAAKH,OAAQA,GAEnCG,KAAKF,OACPT,MAAMC,KAAKC,GAAGgC,UAAUvB,KAAKF,MAAO,KAItCS,QAAS,SAAqBT,GAQ1BE,KAAKF,QACJA,GAASA,EAAM0B,UACjB1B,EAAQA,EAAM0B,SAEfnC,MAAMC,KAAKC,GAAGgC,UAAUvB,KAAKF,MAAOA,KAItCI,eAAgB,SAAkBD,GAWjC,IAAID,KAAKJ,WAER,OAAOK,EAER,IAAIL,KACA6B,EAAOzB,KAAKJ,WAAW8B,MAAM,KACjC,GAAkB,GAAfD,EAAKE,OAAY,CACnB,IAAIC,EAAYvC,MAAMC,KAAKC,GAAGkB,UAAUxB,KAAK4C,KAAKJ,EAAK,IAAKxB,GACzDhB,KAAK6C,QAAQF,GACfhC,EAAagC,EAEbhC,EAAWmC,KAAKH,QAGjB,IAAI,IAAII,KAAKP,EACZ7B,EAAWmC,KAAK1C,MAAMC,KAAKC,GAAGkB,UAAUxB,KAAK4C,KAAKJ,EAAKO,IAAK/B,IAG9D,OAAOL","file":"../../../wire/ml/Invocation.js","sourcesContent":["dojo.provide(\"dojox.wire.ml.Invocation\");\r\n\r\ndojo.require(\"dojox.wire.ml.Action\");\r\n\r\ndojo.declare(\"dojox.wire.ml.Invocation\", dojox.wire.ml.Action, {\r\n\t// summary:\r\n\t//\t\tA widget to invoke a method or publish a topic\r\n\t// description:\r\n\t//\t\tThis widget represents a controller task to invoke a method or\r\n\t//\t\tpublish a topic when an event (a function) or a topic is issued.\r\n\r\n\t// object:\r\n\t//\t\tA scope of a method to invoke\r\n\tobject: \"\",\r\n\r\n\t// method:\r\n\t//\t\tA name of a method to invoke\r\n\tmethod: \"\",\r\n\r\n\t// topic:\r\n\t//\t\tA name of a topic to publish\r\n\ttopic: \"\",\r\n\r\n\t// parameters:\r\n\t//\t\tArguments for the method or the topic\r\n\tparameters: \"\",\r\n\r\n\t// result:\r\n\t//\t\tA property to store a return value of the method call\r\n\tresult: \"\",\r\n\r\n\t// error:\r\n\t//\t\tA property to store an error on the method call\r\n\terror: \"\",\r\n\r\n\t_run: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInvoke a method or publish a topic\r\n\t\t// description:\r\n\t\t//\t\tIf 'topic' is specified, the topic is published with arguments\r\n\t\t//\t\tspecified to 'parameters'.\r\n\t\t//\t\tIf 'method' and 'object' are specified, the method is invoked\r\n\t\t//\t\twith arguments specified to 'parameters' and set the return\r\n\t\t//\t\tvalue to a property specified to 'result'.\r\n\t\t//\t\t'object', 'parameters' and 'result' can specify properties of\r\n\t\t//\t\ta widget or an DOM element with the dotted notation.\r\n\t\t//\t\tIf 'parameters' are omitted, the arguments to this method are\r\n\t\t//\t\tpassed as is.\r\n\t\tif(this.topic){\r\n\t\t\tvar args = this._getParameters(arguments);\r\n\t\t\ttry{\r\n\t\t\t\tdojo.publish(this.topic, args);\r\n\t\t\t\tthis.onComplete();\r\n\t\t\t}catch(e){\r\n\t\t\t\tthis.onError(e);\r\n\t\t\t}\r\n\t\t}else if(this.method){\r\n\t\t\tvar scope = (this.object ? dojox.wire.ml._getValue(this.object) : dojo.global);\r\n\t\t\tif(!scope){\r\n\t\t\t\treturn; //undefined\r\n\t\t\t}\r\n\t\t\tvar args = this._getParameters(arguments);\r\n\t\t\tvar func = scope[this.method];\r\n\t\t\tif(!func){\r\n\t\t\t\tfunc = scope.callMethod;\r\n\t\t\t\tif(!func){\r\n\t\t\t\t\treturn; //undefined\r\n\t\t\t\t}\r\n\t\t\t\targs = [this.method, args];\r\n\t\t\t}\r\n\t\t\ttry{\r\n\t\t\t\tvar connected = false;\r\n\t\t\t\tif(scope.getFeatures){\r\n\t\t\t\t\tvar features = scope.getFeatures();\r\n\t\t\t\t\tif((this.method == \"fetch\" && features[\"dojo.data.api.Read\"]) ||\r\n\t\t\t\t\t\t(this.method == \"save\" && features[\"dojo.data.api.Write\"])){\r\n\t\t\t\t\t\tvar arg = args[0];\r\n\t\t\t\t\t\tif(!arg.onComplete){\r\n\t\t\t\t\t\t\targ.onComplete = function(){};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//dojo.connect(arg, \"onComplete\", this, \"onComplete\");\r\n\t\t\t\t\t\tthis.connect(arg, \"onComplete\", \"onComplete\");\r\n\t\t\t\t\t\tif(!arg.onError){\r\n\t\t\t\t\t\t\targ.onError = function(){};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//dojo.connect(arg, \"onError\", this, \"onError\");\r\n\t\t\t\t\t\tthis.connect(arg, \"onError\", \"onError\");\r\n\t\t\t\t\t\tconnected = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar r = func.apply(scope, args);\r\n\t\t\t\tif(!connected){\r\n\t\t\t\t\tif(r && (r instanceof dojo.Deferred)){\r\n\t\t\t\t\t\tvar self = this;\r\n\t\t\t\t\t\tr.addCallbacks(\r\n\t\t\t\t\t\t\tfunction(result){self.onComplete(result);},\r\n\t\t\t\t\t\t\tfunction(error){self.onError(error);}\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.onComplete(r);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}catch(e){\r\n\t\t\t\tthis.onError(e);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tonComplete: function(/*anything*/result){\r\n\t\t// summary:\r\n\t\t//\t\tA function called when the method or the topic publish\r\n\t\t//\t\tcompleted\r\n\t\t// description:\r\n\t\t//\t\tIf 'result' attribute is specified, the result object also set\r\n\t\t//\t\tto the specified property.\r\n\t\t// result:\r\n\t\t//\t\tThe return value of a method or undefined for a topic\r\n\t\tif(this.result){\r\n\t\t\tdojox.wire.ml._setValue(this.result, result);\r\n\t\t}\r\n\t\tif(this.error){ // clear error\r\n\t\t\tdojox.wire.ml._setValue(this.error, \"\");\r\n\t\t}\r\n\t},\r\n\r\n\tonError: function(/*anything*/error){\r\n\t\t// summary:\r\n\t\t//\t\tA function called on an error occurs\r\n\t\t// description:\r\n\t\t//\t\tIf 'error' attribute is specified, the error object also set to\r\n\t\t//\t\tthe specified property.\r\n\t\t// error:\r\n\t\t//\t\tThe exception or error occurred\r\n\t\tif(this.error){\r\n\t\t\tif(error && error.message){\r\n\t\t\t\terror = error.message;\r\n\t\t\t}\r\n\t\t\tdojox.wire.ml._setValue(this.error, error);\r\n\t\t}\r\n\t},\r\n\r\n\t_getParameters: function(/*Array*/args){\r\n\t\t// summary:\r\n\t\t//\t\tReturns arguments to a method or topic to invoke\r\n\t\t// description:\r\n\t\t//\t\tThis method retunrs an array of arguments specified by\r\n\t\t//\t\t'parameters' attribute, a comma-separated list of IDs and\r\n\t\t//\t\ttheir properties in a dotted notation.\r\n\t\t//\t\tIf 'parameters' are omitted, the original arguments are\r\n\t\t//\t\tused.\r\n\t\t// args:\r\n\t\t//\t\tArguments to a trigger event or topic\r\n\t\tif(!this.parameters){\r\n\t\t \t// use arguments as is\r\n\t\t\treturn args; //Array\r\n\t\t}\r\n\t\tvar parameters = [];\r\n\t\tvar list = this.parameters.split(\",\");\r\n\t\tif(list.length == 1){\r\n\t\t\tvar parameter = dojox.wire.ml._getValue(dojo.trim(list[0]), args);\r\n\t\t\tif(dojo.isArray(parameter)){\r\n\t\t\t\tparameters = parameter;\r\n\t\t\t}else{\r\n\t\t\t\tparameters.push(parameter);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tfor(var i in list){\r\n\t\t\t\tparameters.push(dojox.wire.ml._getValue(dojo.trim(list[i]), args));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn parameters; //Array\r\n\t}\r\n});\r\n"]}