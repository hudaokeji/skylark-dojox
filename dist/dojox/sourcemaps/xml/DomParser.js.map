{"version":3,"sources":["xml/DomParser.js"],"names":["define","dojo","getObject","dojox","xml","DomParser","nodeTypes","ELEMENT","ATTRIBUTE","TEXT","CDATA_SECTION","PROCESSING_INSTRUCTION","COMMENT","DOCUMENT","reTags","reAttr","reEntity","reCData","reComments","trim","normalize","egt","elt","equot","eapos","eamp","dNs","byName","name","a","__","node","arr","forEach","childNodes","c","nodeType","push","nodeName","this","byNameNS","ns","ownerDocument","_nsPaths","namespace","localName","childrenByName","childrenByNameNS","_createTextNode","v","nodeValue","replace","getAttr","i","attributes","length","getAttrNS","setAttr","val","old","_remove","_add","setAttrNS","prev","p","parentNode","next","parse","str","root","all","namespaces","documentElement","obj","id","byId","getElementById","getElementsByTagName","getElementsByTagNameNS","indexOf","entity","eRe","test","lastIndex","exec","expression","RegExp","cdata","cdSections","comment","comments","res","charAt","text","substr","target","parseInt","attr","o","t","split","getAttribute","getAttributeNS","setAttribute","setAttributeNS","previous","previousSibling","nextSibling","ln","e"],"mappings":"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","file":"../../xml/DomParser.js","sourcesContent":["define([\r\n\t\"dojo/_base/kernel\",// dojo.getObject\r\n\t\"dojo/_base/array\"\t// dojo.forEach\r\n], function(dojo){\r\ndojo.getObject(\"xml\", true, dojox);\r\n\r\ndojox.xml.DomParser=new (function(){\r\n\t/**********************************************************\r\n\t *\tThe DomParser is a close-to (but not entirely)\r\n\t *\tconforming XML parser based on regular\r\n\t *\texpressions.  It will take any XML fragment\r\n\t *\tand return a lightweight JS structure that is\r\n\t *\tsimilar to (but not exactly) the DOM specification.\r\n\t *\r\n\t *\tGetter and setter methods are NOT available; the goal\r\n\t *\twas to keep the resulting object model entirely JS-like.\r\n\t *\r\n\t *\tAll node types but document fragments are supported;\r\n\t *\tall nodes support getElementsByTagName and\r\n\t *\tgetElementsByTagNameNS (with short names byName and\r\n\t *\tbyNameNS).  The document node supports getElementById\r\n\t *\t(byId), and all nodes support a supplimental\r\n\t *\tchildrenByName/childrenByNameNS method as well.\r\n\t *\r\n\t *\tThe object model is intended to be a READONLY format;\r\n\t *\tmutation events are NOT supported, and though you\r\n\t *\tcan change properties on a node-by-node basis, certain\r\n\t *\toperations are not supported (such as changing the ID\r\n\t *\tof an element).\r\n\t **********************************************************/\r\n\r\n\t//\tinternal use only.\r\n\tvar nodeTypes={ ELEMENT:1, ATTRIBUTE:2, TEXT:3, CDATA_SECTION:4, PROCESSING_INSTRUCTION:7, COMMENT:8, DOCUMENT:9 };\r\n\r\n\t//\tcompile the regular expressions once.\r\n\tvar reTags=/<([^>\\/\\s+]*)([^>]*)>([^<]*)/g;\r\n\tvar reAttr=/([^=]*)=((\"([^\"]*)\")|('([^']*)'))/g;\t//\tpatch from tdedischew AT gmail, with additional grouping\r\n\tvar reEntity=/<!ENTITY\\s+([^\"]*)\\s+\"([^\"]*)\">/g;\r\n\tvar reCData=/<!\\[CDATA\\[([\\u0001-\\uFFFF]*?)\\]\\]>/g;\r\n\tvar reComments=/<!--([\\u0001-\\uFFFF]*?)-->/g;\r\n\tvar trim=/^\\s+|\\s+$/g;\r\n\tvar normalize=/\\s+/g;\r\n\tvar egt=/\\&gt;/g;\r\n\tvar elt=/\\&lt;/g;\r\n\tvar equot=/\\&quot;/g;\r\n\tvar eapos=/\\&apos;/g;\r\n\tvar eamp=/\\&amp;/g;\r\n\tvar dNs=\"_def_\";\r\n\r\n\t//\tcreate a root node.\r\n\tfunction _doc(){\r\n\t\treturn new (function(){\r\n\t\t\tvar all={};\r\n\t\t\tthis.nodeType=nodeTypes.DOCUMENT;\r\n\t\t\tthis.nodeName=\"#document\";\r\n\t\t\tthis.namespaces={};\r\n\t\t\tthis._nsPaths={};\r\n\t\t\tthis.childNodes=[];\r\n\t\t\tthis.documentElement=null;\r\n\r\n\t\t\t//\tany element with an ID attribute will be added to the internal hashtable.\r\n\t\t\tthis._add=function(obj){\r\n\t\t\t\tif(typeof(obj.id)!=\"undefined\"){ all[obj.id]=obj; }\r\n\t\t\t};\r\n\t\t\tthis._remove=function(id){\r\n\t\t\t\tif(all[id]){ delete all[id]; }\r\n\t\t\t};\r\n\r\n\t\t\tthis.byId=this.getElementById=function(id){ return all[id]; };\r\n\t\t\tthis.byName=this.getElementsByTagName=byName;\r\n\t\t\tthis.byNameNS=this.getElementsByTagNameNS=byNameNS;\r\n\t\t\tthis.childrenByName=childrenByName;\r\n\t\t\tthis.childrenByNameNS=childrenByNameNS;\r\n\t\t})();\r\n\t}\r\n\r\n\t//\tfunctions attached to element nodes\r\n\tfunction byName(name){\r\n\t\t//\treturn all descendants with name.  Fully qualified (i.e. svg:svg)\r\n\t\tfunction __(node, name, arr){\r\n\t\t\tdojo.forEach(node.childNodes, function(c){\r\n\t\t\t\tif(c.nodeType==nodeTypes.ELEMENT){\r\n\t\t\t\t\tif(name==\"*\"){ arr.push(c); }\r\n\t\t\t\t\telse if(c.nodeName==name){ arr.push(c); }\r\n\t\t\t\t\t__(c, name, arr);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tvar a=[];\r\n\t\t__(this, name, a);\r\n\t\treturn a;\r\n\t}\r\n\tfunction byNameNS(name, ns){\r\n\t\t//\treturn all descendants with name by namespace.  If no namespace passed, the default is used.\r\n\t\tfunction __(node, name, ns, arr){\r\n\t\t\tdojo.forEach(node.childNodes, function(c){\r\n\t\t\t\tif(c.nodeType==nodeTypes.ELEMENT){\r\n\t\t\t\t\tif(name==\"*\"&&c.ownerDocument._nsPaths[ns]==c.namespace){ arr.push(c); }\r\n\t\t\t\t\telse if(c.localName==name&&c.ownerDocument._nsPaths[ns]==c.namespace){ arr.push(c); }\r\n\t\t\t\t\t__(c, name, ns, arr);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tif(!ns){ ns=dNs; }\r\n\t\tvar a=[];\r\n\t\t__(this, name, ns, a);\r\n\t\treturn a;\r\n\t}\r\n\t//\tOnly child nodes with name.\r\n\tfunction childrenByName(name){\r\n\t\tvar a=[];\r\n\t\tdojo.forEach(this.childNodes, function(c){\r\n\t\t\tif(c.nodeType==nodeTypes.ELEMENT){\r\n\t\t\t\tif(name==\"*\"){ a.push(c); }\r\n\t\t\t\telse if(c.nodeName==name){ a.push(c); }\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn a;\r\n\t}\r\n\r\n\tfunction childrenByNameNS(name, ns){\r\n\t\tvar a=[];\r\n\t\tdojo.forEach(this.childNodes, function(c){\r\n\t\t\tif(c.nodeType==nodeTypes.ELEMENT){\r\n\t\t\t\tif(name==\"*\"&&c.ownerDocument._nsPaths[ns]==c.namespace){ a.push(c); }\r\n\t\t\t\telse if(c.localName==name&&c.ownerDocument._nsPaths[ns]==c.namespace){ a.push(c); }\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn a;\r\n\t}\r\n\r\n\tfunction _createTextNode(v){\r\n\t\treturn {\r\n\t\t\tnodeType:nodeTypes.TEXT,\r\n\t\t\tnodeName:\"#text\",\r\n\t\t\tnodeValue:v.replace(normalize,\" \").replace(egt,\">\").replace(elt,\"<\").replace(eapos,\"'\").replace(equot,'\"').replace(eamp,\"&\")\r\n\t\t};\r\n\t}\r\n\r\n\t//\tattribute functions\r\n\tfunction getAttr(name){\r\n\t\tfor(var i=0; i<this.attributes.length; i++){\r\n\t\t\tif(this.attributes[i].nodeName==name){\r\n\t\t\t\treturn this.attributes[i].nodeValue;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\tfunction getAttrNS(name, ns){\r\n\t\tfor(var i=0; i<this.attributes.length; i++){\r\n\t\t\tif(this.ownerDocument._nsPaths[ns]==this.attributes[i].namespace\r\n\t\t\t\t&&this.attributes[i].localName==name\r\n\t\t\t){\r\n\t\t\t\treturn this.attributes[i].nodeValue;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\t//\tnote that you can only swap IDs using setAttribute, NOT with setAttributeNS.\r\n\tfunction setAttr(name, val){\r\n\t\tvar old=null;\r\n\t\tfor(var i=0; i<this.attributes.length; i++){\r\n\t\t\tif(this.attributes[i].nodeName==name){\r\n\t\t\t\told=this.attributes[i].nodeValue;\r\n\t\t\t\tthis.attributes[i].nodeValue=val;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(name==\"id\"){\r\n\t\t\tif(old!=null){ this.ownerDocument._remove(old); }\r\n\t\t\tthis.ownerDocument._add(this);\r\n\t\t}\r\n\t}\r\n\tfunction setAttrNS(name, val, ns){\r\n\t\tfor(var i=0; i<this.attributes.length; i++){\r\n\t\t\tif(this.ownerDocument._nsPaths[ns]==this.attributes[i].namespace\r\n\t\t\t\t&&this.attributes[i].localName==name\r\n\t\t\t){\r\n\t\t\t\tthis.attributes[i].nodeValue=val;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t//\tnavigation\r\n\tfunction prev(){\r\n\t\tvar p=this.parentNode;\r\n\t\tif(p){\r\n\t\t\tfor(var i=0;i<p.childNodes.length;i++){\r\n\t\t\t\tif(p.childNodes[i]==this&&i>0){\r\n\t\t\t\t\treturn p.childNodes[i-1];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\tfunction next(){\r\n\t\tvar p=this.parentNode;\r\n\t\tif(p){\r\n\t\t\tfor(var i=0;i<p.childNodes.length;i++){\r\n\t\t\t\tif(p.childNodes[i]==this&&(i+1)<p.childNodes.length){\r\n\t\t\t\t\treturn p.childNodes[i+1];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t//\tthe main method.\r\n\tthis.parse=function(/* String */str){\r\n\t\tvar root=_doc();\r\n\t\tif(str==null){ return root; }\r\n\t\tif(str.length==0){ return root; }\r\n\r\n\t\t//\tpreprocess custom entities\r\n\t\tif(str.indexOf(\"<!ENTITY\")>0){\r\n\t\t\tvar entity, eRe=[];\r\n\t\t\tif(reEntity.test(str)){\r\n\t\t\t\treEntity.lastIndex=0;\r\n\t\t\t\t//\tmatch entities\r\n\t\t\t\twhile((entity=reEntity.exec(str))!=null){\r\n\t\t\t\t\teRe.push({\r\n\t\t\t\t\t\tentity:\"&\"+entity[1].replace(trim,\"\")+\";\",\r\n\t\t\t\t\t\texpression:entity[2]\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t//\treplace instances in the document.\r\n\t\t\t\tfor(var i=0; i<eRe.length; i++){\r\n\t\t\t\t\tstr=str.replace(new RegExp(eRe[i].entity, \"g\"), eRe[i].expression);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\tpre-parse for CData, and tokenize.\r\n\t\tvar cdSections=[], cdata;\r\n\t\twhile((cdata=reCData.exec(str))!=null){ cdSections.push(cdata[1]); }\r\n\t\tfor(var i=0; i<cdSections.length; i++){ str=str.replace(cdSections[i], i); }\r\n\t\t\r\n\t\t//\tpre-parse for comments, and tokenize.\r\n\t\tvar comments=[], comment;\r\n\t\twhile((comment=reComments.exec(str))!=null){ comments.push(comment[1]); }\r\n\t\tfor(i=0; i<comments.length; i++){ str=str.replace(comments[i], i); }\r\n\r\n\t\t//\tparse the document\r\n\t\tvar res, obj=root;\r\n\t\twhile((res=reTags.exec(str))!=null){\r\n\t\t\t//\tclosing tags.\r\n\t\t\tif(res[2].charAt(0)==\"/\" && res[2].replace(trim, \"\").length>1){\r\n\t\t\t\tif(obj.parentNode){\r\n\t\t\t\t\tobj=obj.parentNode;\r\n\t\t\t\t}\r\n\t\t\t\tvar text=(res[3]||\"\").replace(trim, \"\");\r\n\t\t\t\tif(text.length>0) {\r\n\t\t\t\t\tobj.childNodes.push(_createTextNode(text));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//\topen tags.\r\n\t\t\telse if(res[1].length>0){\r\n\t\t\t\t//\tfigure out the type of node.\r\n\t\t\t\tif(res[1].charAt(0)==\"?\"){\r\n\t\t\t\t\t//\tprocessing instruction\r\n\t\t\t\t\tvar name=res[1].substr(1);\r\n\t\t\t\t\tvar target=res[2].substr(0,res[2].length-2);\r\n\t\t\t\t\tobj.childNodes.push({\r\n\t\t\t\t\t\tnodeType:nodeTypes.PROCESSING_INSTRUCTION,\r\n\t\t\t\t\t\tnodeName:name,\r\n\t\t\t\t\t\tnodeValue:target\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse if(res[1].charAt(0)==\"!\"){\r\n\t\t\t\t\t//\tCDATA; skip over any declaration elements.\r\n\t\t\t\t\tif(res[1].indexOf(\"![CDATA[\")==0){\r\n\t\t\t\t\t\tvar val=parseInt(res[1].replace(\"![CDATA[\",\"\").replace(\"]]\",\"\"));\r\n\t\t\t\t\t\tobj.childNodes.push({\r\n\t\t\t\t\t\t\tnodeType:nodeTypes.CDATA_SECTION,\r\n\t\t\t\t\t\t\tnodeName:\"#cdata-section\",\r\n\t\t\t\t\t\t\tnodeValue:cdSections[val]\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//\tComments.\r\n\t\t\t\t\telse if(res[1].substr(0,3)==\"!--\"){\r\n\t\t\t\t\t\tvar val=parseInt(res[1].replace(\"!--\",\"\").replace(\"--\",\"\"));\r\n\t\t\t\t\t\tobj.childNodes.push({\r\n\t\t\t\t\t\t\tnodeType:nodeTypes.COMMENT,\r\n\t\t\t\t\t\t\tnodeName:\"#comment\",\r\n\t\t\t\t\t\t\tnodeValue:comments[val]\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t//\tElements (with attribute and text)\r\n\t\t\t\t\tvar name=res[1].replace(trim,\"\");\r\n\t\t\t\t\tvar o={\r\n\t\t\t\t\t\tnodeType:nodeTypes.ELEMENT,\r\n\t\t\t\t\t\tnodeName:name,\r\n\t\t\t\t\t\tlocalName:name,\r\n\t\t\t\t\t\tnamespace:dNs,\r\n\t\t\t\t\t\townerDocument:root,\r\n\t\t\t\t\t\tattributes:[],\r\n\t\t\t\t\t\tparentNode:null,\r\n\t\t\t\t\t\tchildNodes:[]\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t//\tcheck to see if it's namespaced.\r\n\t\t\t\t\tif(name.indexOf(\":\")>-1){\r\n\t\t\t\t\t\tvar t=name.split(\":\");\r\n\t\t\t\t\t\to.namespace=t[0];\r\n\t\t\t\t\t\to.localName=t[1];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//\tset the function references.\r\n\t\t\t\t\to.byName=o.getElementsByTagName=byName;\r\n\t\t\t\t\to.byNameNS=o.getElementsByTagNameNS=byNameNS;\r\n\t\t\t\t\to.childrenByName=childrenByName;\r\n\t\t\t\t\to.childrenByNameNS=childrenByNameNS;\r\n\t\t\t\t\to.getAttribute=getAttr;\r\n\t\t\t\t\to.getAttributeNS=getAttrNS;\r\n\t\t\t\t\to.setAttribute=setAttr;\r\n\t\t\t\t\to.setAttributeNS=setAttrNS;\r\n\t\t\t\t\to.previous=o.previousSibling=prev;\r\n\t\t\t\t\to.next=o.nextSibling=next;\r\n\r\n\t\t\t\t\t//\tparse the attribute string.\r\n\t\t\t\t\tvar attr;\r\n\t\t\t\t\twhile((attr=reAttr.exec(res[2]))!=null){\r\n\t\t\t\t\t\tif(attr.length>0){\r\n\t\t\t\t\t\t\tvar name=attr[1].replace(trim,\"\");\r\n\t\t\t\t\t\t\tvar val=(attr[4]||attr[6]||\"\").replace(normalize,\" \")\r\n\t\t\t\t\t\t\t\t.replace(egt,\">\")\r\n\t\t\t\t\t\t\t\t.replace(elt,\"<\")\r\n\t\t\t\t\t\t\t\t.replace(eapos,\"'\")\r\n\t\t\t\t\t\t\t\t.replace(equot,'\"')\r\n\t\t\t\t\t\t\t\t.replace(eamp,\"&\");\r\n\t\t\t\t\t\t\tif(name.indexOf(\"xmlns\")==0){\r\n\t\t\t\t\t\t\t\tif(name.indexOf(\":\")>0){\r\n\t\t\t\t\t\t\t\t\tvar ns=name.split(\":\");\r\n\t\t\t\t\t\t\t\t\troot.namespaces[ns[1]]=val;\r\n\t\t\t\t\t\t\t\t\troot._nsPaths[val]=ns[1];\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\troot.namespaces[dNs]=val;\r\n\t\t\t\t\t\t\t\t\troot._nsPaths[val]=dNs;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tvar ln=name;\r\n\t\t\t\t\t\t\t\tvar ns=dNs;\r\n\t\t\t\t\t\t\t\tif(name.indexOf(\":\")>0){\r\n\t\t\t\t\t\t\t\t\tvar t=name.split(\":\");\r\n\t\t\t\t\t\t\t\t\tln=t[1];\r\n\t\t\t\t\t\t\t\t\tns=t[0];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\to.attributes.push({\r\n\t\t\t\t\t\t\t\t\tnodeType:nodeTypes.ATTRIBUTE,\r\n\t\t\t\t\t\t\t\t\tnodeName:name,\r\n\t\t\t\t\t\t\t\t\tlocalName:ln,\r\n\t\t\t\t\t\t\t\t\tnamespace:ns,\r\n\t\t\t\t\t\t\t\t\tnodeValue:val\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t//\tonly add id as a property.\r\n\t\t\t\t\t\t\t\tif(ln==\"id\"){ o.id=val; }\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\troot._add(o);\r\n\r\n\t\t\t\t\tif(obj){\r\n\t\t\t\t\t\tobj.childNodes.push(o);\r\n\t\t\t\t\t\to.parentNode=obj;\r\n\t\t\t\t\t\t//\tif it's not a self-closing node.\r\n\t\t\t\t\t\tif(res[2].charAt(res[2].length-1)!=\"/\"){\r\n\t\t\t\t\t\t\tobj=o;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar text=res[3];\r\n\t\t\t\t\tif(text.length>0){\r\n\t\t\t\t\t\tobj.childNodes.push(_createTextNode(text));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\tset the document element\r\n\t\tfor(var i=0; i<root.childNodes.length; i++){\r\n\t\t\tvar e=root.childNodes[i];\r\n\t\t\tif(e.nodeType==nodeTypes.ELEMENT){\r\n\t\t\t\troot.documentElement=e;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn root;\r\n\t};\r\n})();\r\nreturn dojox.xml.DomParser;\r\n});\r\n"]}