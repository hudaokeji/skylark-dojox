{"version":3,"sources":["app/main.js"],"names":["define","require","kernel","lang","declare","config","win","Evented","Deferred","when","has","on","ready","domConstruct","domAttr","model","nls","lifecycle","hash","constraints","configUtils","add","debugApp","Application","constructor","params","node","safeMixin","this","id","defaultView","controllers","children","loadedModels","loadedStores","setDomNode","create","style","appendChild","domNode","createDataStore","stores","item","charAt","type","mixin","storeCtor","e","Error","data","isString","getObject","observable","observableCtor","store","createControllers","requireItems","i","length","push","requireSignal","def","error","isResolved","isRejected","reject","remove","resolve","call","arguments","controllerDef","hitch","bind","trigger","event","deprecated","emit","start","createPromise","loadModelLoaderDeferred","models","promise","isArray","setupControllers","startup","oldNode","newNode","currentHash","window","location","_startView","getTarget","_startParams","getParams","selectedChildren","hasOwnProperty","register","constraint","emitLoad","viewId","initLoad","callback","forceTransitionNone","opts","setStatus","STARTED","template","app","name","parent","templateString","controller","view","generateApp","path","configProcessHas","loaderConfig","paths","pathname","split","pop","join","modules","concat","dependencies","indexOf","ext","App","body","log","msg","console","transitionToView","target","transitionOptions","triggerEvent","bubbles","cancelable","detail","STARTING","globalAppName","validate","schema","appSchema","dojox","json","ref","resolveJson"],"mappings":";;;;;;;AAAAA,QAAQ,UAAW,oBAAqB,kBAAmB,qBAAsB,oBAChF,oBAAqB,eAAgB,gBAAiB,YAAa,WAAY,UAAW,aAC1F,qBAAsB,gBAAiB,gBAAiB,cAAe,qBACvE,eAAgB,sBAAuB,kBACvC,SAASC,QAASC,EAAQC,EAAMC,EAASC,EAAQC,EAAKC,EAASC,EAAUC,EAAMC,EAAKC,EAAIC,EAAOC,EAAcC,EAC1GC,EAAOC,EAAKC,EAAWC,EAAMC,EAAaC,GAE7CV,EAAIW,IAAI,eAAgBhB,EAAY,SAASiB,UAE7C,IAAIC,EAAcnB,EAAQG,GACzBiB,YAAa,SAASC,EAAQC,GAC7BtB,EAAQuB,UAAUC,KAAMH,GACxBG,KAAKH,OAASA,EACdG,KAAKC,GAAKJ,EAAOI,GACjBD,KAAKE,YAAcL,EAAOK,YAC1BF,KAAKG,eACLH,KAAKI,YACLJ,KAAKK,gBACLL,KAAKM,gBAKLN,KAAKO,WAAWtB,EAAauB,OAAO,OACnCP,GAAID,KAAKC,GAAG,QACZQ,MAAO,oEAERX,EAAKY,YAAYV,KAAKW,UAGvBC,gBAAiB,SAASf,GAOzB,GAAGA,EAAOgB,OAET,IAAI,IAAIC,KAAQjB,EAAOgB,OACtB,GAAsB,MAAnBC,EAAKC,OAAO,GAAW,CACzB,IAAIC,EAAOnB,EAAOgB,OAAOC,GAAME,KAAOnB,EAAOgB,OAAOC,GAAME,KAAO,oBAC7DvC,KACDoB,EAAOgB,OAAOC,GAAMjB,QACtBtB,EAAK0C,MAAMxC,EAAQoB,EAAOgB,OAAOC,GAAMjB,QAGxC,IACC,IAAIqB,EAAY7C,QAAQ2C,GACxB,MAAMG,GACN,MAAM,IAAIC,MAAMJ,EAAK,uCAStB,GAPGvC,EAAO4C,MAAQ9C,EAAK+C,SAAS7C,EAAO4C,QAKtC5C,EAAO4C,KAAO9C,EAAKgD,UAAU9C,EAAO4C,OAElCxB,EAAOgB,OAAOC,GAAMU,WAAW,CACjC,IACC,IAAIC,EAAiBpD,QAAQ,yBAC7B,MAAM8C,GACN,MAAM,IAAIC,MAAM,4DAEjBvB,EAAOgB,OAAOC,GAAMY,MAAQD,EAAe,IAAIP,EAAUzC,SAEzDoB,EAAOgB,OAAOC,GAAMY,MAAQ,IAAIR,EAAUzC,GAE3CuB,KAAKM,aAAaQ,GAAQjB,EAAOgB,OAAOC,GAAMY,QAMlDC,kBAAmB,SAASxB,GAS3B,GAAGA,EAAY,CAEd,IADA,IAAIyB,KACIC,EAAI,EAAGA,EAAI1B,EAAY2B,OAAQD,IACtCD,EAAaG,KAAK5B,EAAY0B,IAG/B,IACIG,EADAC,EAAM,IAAIrD,EAEd,IACCoD,EAAgB3D,QAAQU,GAAKV,QAAQU,GAAG,QAAS,SAASmD,GACtDD,EAAIE,cAAgBF,EAAIG,eAG3BH,EAAII,OAAO,2BACRL,GACFA,EAAcM,YAEX,KACLjE,QAAQuD,EAAc,WACrBK,EAAIM,QAAQC,KAAKP,EAAKQ,WACnBT,GACFA,EAAcM,WAGhB,MAAMnB,GACNc,EAAII,OAAOlB,GACRa,GACFA,EAAcM,SAIhB,IAAII,EAAgB,IAAI9D,EAWxB,OAVAC,EAAKoD,EAAK1D,EAAKoE,MAAM3C,KAAM,WAC1B,IAAI,IAAI6B,EAAI,EAAGA,EAAIY,UAAU,GAAGX,OAAQD,IAEvC7B,KAAKG,YAAY4B,KAAK,IAAKU,UAAU,GAAGZ,GAAG7B,MAAO4C,QAEnDF,EAAcH,QAAQvC,QACnB,WAEH0C,EAAcL,OAAO,6BAEfK,IAITG,QAAS,SAASC,EAAOjD,GAQxBvB,EAAOyE,WAAW,gCAAiC,yCAA0C,OAC7F/C,KAAKgD,KAAKF,EAAOjD,IAIlBoD,MAAO,WAGNjD,KAAKY,gBAAgBZ,KAAKH,QAG1B,IACIqD,EADAC,EAA0B,IAAIvE,EAElC,IACCsE,EAAgB/D,EAAMa,KAAKH,OAAOuD,OAAQpD,KAAMA,MAChD,MAAMmB,GAEN,OADAgC,EAAwBd,OAAOlB,GACxBgC,EAAwBE,QAEhCxE,EAAKqE,EAAe3E,EAAKoE,MAAM3C,KAAM,SAASoD,GAG7CpD,KAAKK,aAAe9B,EAAK+E,QAAQF,GAAQA,EAAO,GAAGA,EACnDpD,KAAKuD,mBAEL1E,EAAKO,EAAIY,KAAKH,QAAStB,EAAKoE,MAAM3C,KAAM,SAASZ,GAC7CA,GACFb,EAAK0C,MAAMjB,KAAKZ,OAAUA,GAE3BY,KAAKwD,eAEH,WACHL,EAAwBd,OAAO,wBAIjC9B,WAAY,SAASI,GACpB,IAAI8C,EAAUzD,KAAKW,QACnBX,KAAKW,QAAUA,EACfX,KAAKgD,KAAK,eACTS,QAASA,EACTC,QAAS/C,KAIX4C,iBAAkB,WAGjB,IAAII,EAAcC,OAAOC,SAASvE,KAElCU,KAAK8D,WAAaxE,EAAKyE,UAAUJ,EAAa3D,KAAKE,aACnDF,KAAKgE,aAAe1E,EAAK2E,UAAUN,IAGpCH,QAAS,WAGRxD,KAAKkE,oBACL,IAAI/D,EAAcH,KAAK2B,kBAAkB3B,KAAKH,OAAOM,aAElDH,KAAKmE,eAAe,cACtB5E,EAAY6E,SAASpE,KAAKH,OAAON,aAEjCS,KAAKqE,WAAa,SAEnB,IAAIC,EAAW,WAEdtE,KAAKgD,KAAK,YACTuB,OAAQvE,KAAKE,YACbsE,UAAU,EACV3E,OAAQG,KAAKgE,aACbS,SAAUlG,EAAKoE,MAAM3C,KAAM,WAC1BA,KAAKgD,KAAK,kBACTuB,OAAQvE,KAAKE,YACbwE,qBAAqB,EACrBC,MAAQ9E,OAAQG,KAAKgE,gBAEnBhE,KAAKE,cAAgBF,KAAK8D,YAE5B9D,KAAKgD,KAAK,kBACTuB,OAAQvE,KAAK8D,WACba,MAAQ9E,OAAQG,KAAKgE,gBAGvBhE,KAAK4E,UAAU5E,KAAKX,UAAUwF,cAIjChG,EAAKsB,EAAa5B,EAAKoE,MAAM3C,KAAM,WAC/BA,KAAK8E,SAEP9E,KAAKgD,KAAK,YACT+B,IAAK/E,KACLgF,KAAMhF,KAAKgF,KACXhE,KAAMhB,KAAKgB,KACXiE,OAAQjF,KACRkF,eAAgBlF,KAAKkF,eACrBC,WAAYnF,KAAKmF,WACjBV,SAAUlG,EAAKoE,MAAM3C,KAAM,SAASoF,GACnCpF,KAAKO,WAAW6E,EAAKzE,SACrB2D,EAAS9B,KAAKxC,UAIhBsE,EAAS9B,KAAKxC,YAMlB,SAASqF,EAAY5G,EAAQqB,GAQ5B,IAAIwF,GAGJ7G,EAASe,EAAY+F,iBAAiB9G,IAE3B+G,eACV/G,EAAO+G,iBAEJ/G,EAAO+G,aAAaC,QACvBhH,EAAO+G,aAAaC,UAEjBhH,EAAO+G,aAAaC,MAAW,MAGH,MAD/BH,EAAO1B,OAAOC,SAAS6B,UACf3E,OAAOuE,EAAKxD,WACnBwD,EAAOA,EAAKK,MAAM,MACbC,MACLN,EAAOA,EAAKO,KAAK,MAElBpH,EAAO+G,aAAaC,MAAW,IAAIH,GAEpCjH,QAAQI,EAAO+G,cAEX/G,EAAOqH,UACVrH,EAAOqH,YAGRrH,EAAOqH,QAAQ/D,KAAK,sBACpB,IAAI+D,EAAUrH,EAAOqH,QAAQC,OAAOtH,EAAOuH,aAAavH,EAAOuH,iBAE5DvH,EAAOqG,WAEgB,IADzBQ,EAAO7G,EAAOqG,UACNmB,QAAQ,QACfX,EAAO,OAAOA,GAEfQ,EAAQ/D,KAAK,aAAeuD,IAG7BjH,QAAQyH,EAAS,WAEhB,IADA,IAAIA,GAAWnG,GACPkC,EAAI,EAAGA,EAAIpD,EAAOqH,QAAQhE,OAAQD,IACzCiE,EAAQ/D,KAAKU,UAAUZ,IAGxB,GAAGpD,EAAOqG,SACT,IAAIoB,GACHhB,eAAgBzC,UAAUA,UAAUX,OAAS,IAG/CqE,IAAM3H,EAAQsH,EAASI,GAEvBlH,EAAM,WACL,IAAI+F,EAAM,IAAIoB,IAAI1H,EAAQqB,GAAQpB,EAAI0H,QAEnCtH,EAAI,eACNiG,EAAIsB,IAAM,WAQT,IAAIC,EAAM,GACV,IACC,IAAI,IAAIzE,EAAI,EAAGA,EAAIY,UAAUX,OAAO,EAAGD,IACtCyE,GAAY7D,UAAUZ,GAEvB0E,QAAQF,IAAIC,EAAI7D,UAAUA,UAAUX,OAAO,IAC3C,MAAMX,MAGR4D,EAAIsB,IAAM,aAGXtB,EAAIyB,iBAAmB,SAAoBC,EAAkBC,EAA6BC,GAUzF,IAAIhC,GAAQiC,SAAQ,EAAMC,YAAW,EAAMC,OAAQJ,EAAmBC,aAAcA,GAAgB,MACpG5H,EAAGiE,KAAKyD,EAAO,kBAAmB9B,IAGnCI,EAAIH,UAAUG,EAAI1F,UAAU0H,UAG5B,IAAIC,EAAgBjC,EAAI9E,GACrB2D,OAAOoD,IACTxI,EAAQuB,UAAUgF,EAAKnB,OAAOoD,IAE/BpD,OAAOoD,GAAiBjC,EACxBA,EAAI9B,YAKP,OAAO,SAASxE,EAAQqB,GACvB,IAAIrB,EACH,MAAM,IAAI2C,MAAM,sBAGd3C,EAAOwI,SACT5I,SAAS,oBAAqB,iBAAkB,uDAAwD,SAAS6I,EAAQC,IACxHD,EAASE,MAAMC,KAAKC,IAAIC,YAAYL,IAC1BD,SAASxI,EAAQ0I,IAC1B9B,EAAY5G,EAAQqB,KAItBuF,EAAY5G,EAAQqB","file":"../../app/main.js","sourcesContent":["define([\"require\", \"dojo/_base/kernel\", \"dojo/_base/lang\", \"dojo/_base/declare\", \"dojo/_base/config\",\r\n\t\"dojo/_base/window\", \"dojo/Evented\", \"dojo/Deferred\", \"dojo/when\", \"dojo/has\", \"dojo/on\", \"dojo/ready\",\r\n\t\"dojo/dom-construct\", \"dojo/dom-attr\", \"./utils/model\", \"./utils/nls\", \"./module/lifecycle\",\r\n\t\"./utils/hash\", \"./utils/constraints\", \"./utils/config\"],\r\n\tfunction(require, kernel, lang, declare, config, win, Evented, Deferred, when, has, on, ready, domConstruct, domAttr,\r\n\t\t\t model, nls, lifecycle, hash, constraints, configUtils){\r\n\r\n\thas.add(\"app-log-api\", (config[\"app\"] || {}).debugApp);\r\n\r\n\tvar Application = declare(Evented, {\r\n\t\tconstructor: function(params, node){\r\n\t\t\tdeclare.safeMixin(this, params);\r\n\t\t\tthis.params = params;\r\n\t\t\tthis.id = params.id;\r\n\t\t\tthis.defaultView = params.defaultView;\r\n\t\t\tthis.controllers = [];\r\n\t\t\tthis.children = {};\r\n\t\t\tthis.loadedModels = {};\r\n\t\t\tthis.loadedStores = {};\r\n\t\t\t// Create a new domNode and append to body\r\n\t\t\t// Need to bind startTransition event on application domNode,\r\n\t\t\t// Because dojox/mobile/ViewController bind startTransition event on document.body\r\n\t\t\t// Make application's root domNode id unique because this id can be visited by window namespace on Chrome 18.\r\n\t\t\tthis.setDomNode(domConstruct.create(\"div\", {\r\n\t\t\t\tid: this.id+\"_Root\",\r\n\t\t\t\tstyle: \"width:100%; height:100%; overflow-y:hidden; overflow-x:hidden;\"\r\n\t\t\t}));\r\n\t\t\tnode.appendChild(this.domNode);\r\n\t\t},\r\n\r\n\t\tcreateDataStore: function(params){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreate data store instance\r\n\t\t\t//\r\n\t\t\t// params: Object\r\n\t\t\t//\t\tdata stores configuration.\r\n\r\n\t\t\tif(params.stores){\r\n\t\t\t\t//create stores in the configuration.\r\n\t\t\t\tfor(var item in params.stores){\r\n\t\t\t\t\tif(item.charAt(0) !== \"_\"){//skip the private properties\r\n\t\t\t\t\t\tvar type = params.stores[item].type ? params.stores[item].type : \"dojo/store/Memory\";\r\n\t\t\t\t\t\tvar config = {};\r\n\t\t\t\t\t\tif(params.stores[item].params){\r\n\t\t\t\t\t\t\tlang.mixin(config, params.stores[item].params);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// we assume the store is here through dependencies\r\n\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\tvar storeCtor = require(type);\r\n\t\t\t\t\t\t}catch(e){\r\n\t\t\t\t\t\t\tthrow new Error(type+\" must be listed in the dependencies\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(config.data && lang.isString(config.data)){\r\n\t\t\t\t\t\t\t//get the object specified by string value of data property\r\n\t\t\t\t\t\t\t//cannot assign object literal or reference to data property\r\n\t\t\t\t\t\t\t//because json.ref will generate __parent to point to its parent\r\n\t\t\t\t\t\t\t//and will cause infinitive loop when creating StatefulModel.\r\n\t\t\t\t\t\t\tconfig.data = lang.getObject(config.data);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(params.stores[item].observable){\r\n\t\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\t\tvar observableCtor = require(\"dojo/store/Observable\");\r\n\t\t\t\t\t\t\t}catch(e){\r\n\t\t\t\t\t\t\t\tthrow new Error(\"dojo/store/Observable must be listed in the dependencies\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tparams.stores[item].store = observableCtor(new storeCtor(config));\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tparams.stores[item].store = new storeCtor(config);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.loadedStores[item] = params.stores[item].store;\t\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcreateControllers: function(controllers){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreate controller instance\r\n\t\t\t//\r\n\t\t\t// controllers: Array\r\n\t\t\t//\t\tcontroller configuration array.\r\n\t\t\t// returns:\r\n\t\t\t//\t\tcontrollerDeferred object\r\n\r\n\t\t\tif(controllers){\r\n\t\t\t\tvar requireItems = [];\r\n\t\t\t\tfor(var i = 0; i < controllers.length; i++){\r\n\t\t\t\t\trequireItems.push(controllers[i]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar def = new Deferred();\r\n\t\t\t\tvar requireSignal;\r\n\t\t\t\ttry{\r\n\t\t\t\t\trequireSignal = require.on ? require.on(\"error\", function(error){\r\n\t\t\t\t\t\tif(def.isResolved() || def.isRejected()){\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdef.reject(\"load controllers error.\");\r\n\t\t\t\t\t\tif(requireSignal){\r\n\t\t\t\t\t\t\trequireSignal.remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}) : null;\r\n\t\t\t\t\trequire(requireItems, function(){\r\n\t\t\t\t\t\tdef.resolve.call(def, arguments);\r\n\t\t\t\t\t\tif(requireSignal){\r\n\t\t\t\t\t\t\trequireSignal.remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\tdef.reject(e);\r\n\t\t\t\t\tif(requireSignal){\r\n\t\t\t\t\t\trequireSignal.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar controllerDef = new Deferred();\r\n\t\t\t\twhen(def, lang.hitch(this, function(){\r\n\t\t\t\t\tfor(var i = 0; i < arguments[0].length; i++){\r\n\t\t\t\t\t\t// instantiate controllers, set Application object, and perform auto binding\r\n\t\t\t\t\t\tthis.controllers.push((new arguments[0][i](this)).bind());\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontrollerDef.resolve(this);\r\n\t\t\t\t}), function(){\r\n\t\t\t\t\t//require def error, reject loadChildDeferred\r\n\t\t\t\t\tcontrollerDef.reject(\"load controllers error.\");\r\n\t\t\t\t});\r\n\t\t\t\treturn controllerDef;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\ttrigger: function(event, params){\r\n\t\t\t// summary:\r\n\t\t\t//\t\ttrigger an event. Deprecated, use emit instead.\r\n\t\t\t//\r\n\t\t\t// event: String\r\n\t\t\t//\t\tevent name. The event is binded by controller.bind() method.\r\n\t\t\t// params: Object\r\n\t\t\t//\t\tevent params.\r\n\t\t\tkernel.deprecated(\"dojox.app.Application.trigger\", \"Use dojox.app.Application.emit instead\", \"2.0\");\r\n\t\t\tthis.emit(event, params);\r\n\t\t},\r\n\r\n\t\t// setup default view and Controllers and startup the default view\r\n\t\tstart: function(){\r\n\t\t\t//\r\n\t\t\t//create application level data store\r\n\t\t\tthis.createDataStore(this.params);\r\n\r\n\t\t\t// create application level data model\r\n\t\t\tvar loadModelLoaderDeferred = new Deferred();\r\n\t\t\tvar createPromise;\r\n\t\t\ttry{\r\n\t\t\t\tcreatePromise = model(this.params.models, this, this);\r\n\t\t\t}catch(e){\r\n\t\t\t\tloadModelLoaderDeferred.reject(e);\r\n\t\t\t\treturn loadModelLoaderDeferred.promise;\r\n\t\t\t}\r\n\t\t\twhen(createPromise, lang.hitch(this, function(models){\r\n\t\t\t\t// if models is an array it comes from dojo/promise/all. Each array slot contains the same result object\r\n\t\t\t\t// so pick slot 0.\r\n\t\t\t\tthis.loadedModels = lang.isArray(models)?models[0]:models;\r\n\t\t\t\tthis.setupControllers();\r\n\t\t\t\t// if available load root NLS\r\n\t\t\t\twhen(nls(this.params), lang.hitch(this, function(nls){\r\n\t\t\t\t\tif(nls){\r\n\t\t\t\t\t\tlang.mixin(this.nls = {}, nls);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.startup();\r\n\t\t\t\t}));\r\n\t\t\t}), function(){\r\n\t\t\t\tloadModelLoaderDeferred.reject(\"load model error.\")\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tsetDomNode: function(domNode){\r\n\t\t\tvar oldNode = this.domNode;\r\n\t\t\tthis.domNode = domNode;\r\n\t\t\tthis.emit(\"app-domNode\", {\r\n\t\t\t\toldNode: oldNode,\r\n\t\t\t\tnewNode: domNode\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tsetupControllers: function(){\r\n\t\t\t// create application controller instance\r\n\t\t\t// move set _startView operation from history module to application\r\n\t\t\tvar currentHash = window.location.hash;\r\n\t\t//\tthis._startView = (((currentHash && currentHash.charAt(0) == \"#\") ? currentHash.substr(1) : currentHash) || this.defaultView).split('&')[0];\r\n\t\t\tthis._startView = hash.getTarget(currentHash, this.defaultView);\r\n\t\t\tthis._startParams = hash.getParams(currentHash);\r\n\t\t},\r\n\r\n\t\tstartup: function(){\r\n\t\t\t// load controllers and views\r\n\t\t\t//\r\n\t\t\tthis.selectedChildren = {};\t\t\t\r\n\t\t\tvar controllers = this.createControllers(this.params.controllers);\r\n\t\t\t// constraint on app\r\n\t\t\tif(this.hasOwnProperty(\"constraint\")){\r\n\t\t\t\tconstraints.register(this.params.constraints);\r\n\t\t\t}else{\r\n\t\t\t\tthis.constraint = \"center\";\r\n\t\t\t}\r\n\t\t\tvar emitLoad = function(){\r\n\t\t\t\t// emit \"app-load\" event and let controller to load view.\r\n\t\t\t\tthis.emit(\"app-load\", {\r\n\t\t\t\t\tviewId: this.defaultView,\r\n\t\t\t\t\tinitLoad: true,\r\n\t\t\t\t\tparams: this._startParams,\r\n\t\t\t\t\tcallback: lang.hitch(this, function (){\r\n\t\t\t\t\t\tthis.emit(\"app-transition\", {\r\n\t\t\t\t\t\t\tviewId: this.defaultView,\r\n\t\t\t\t\t\t\tforceTransitionNone: true, // we want to avoid the transition on the first display for the defaultView\r\n\t\t\t\t\t\t\topts: { params: this._startParams }\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif(this.defaultView !== this._startView){\r\n\t\t\t\t\t\t\t// transition to startView. If startView==defaultView, that means initial the default view.\r\n\t\t\t\t\t\t\tthis.emit(\"app-transition\", {\r\n\t\t\t\t\t\t\t\tviewId: this._startView,\r\n\t\t\t\t\t\t\t\topts: { params: this._startParams }\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.setStatus(this.lifecycle.STARTED);\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\twhen(controllers, lang.hitch(this, function(){\r\n\t\t\t\tif(this.template){\r\n\t\t\t\t\t// emit \"app-init\" event so that the Load controller can initialize root view\r\n\t\t\t\t\tthis.emit(\"app-init\", {\r\n\t\t\t\t\t\tapp: this,\t// pass the app into the View so it can have easy access to app\r\n\t\t\t\t\t\tname: this.name,\r\n\t\t\t\t\t\ttype: this.type,\r\n\t\t\t\t\t\tparent: this,\r\n\t\t\t\t\t\ttemplateString: this.templateString,\r\n\t\t\t\t\t\tcontroller: this.controller,\r\n\t\t\t\t\t\tcallback: lang.hitch(this, function(view){\r\n\t\t\t\t\t\t\tthis.setDomNode(view.domNode);\r\n\t\t\t\t\t\t\temitLoad.call(this);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\temitLoad.call(this);\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\t\t\r\n\t});\r\n\r\n\tfunction generateApp(config, node){\r\n\t\t// summary:\r\n\t\t//\t\tgenerate the application\r\n\t\t//\r\n\t\t// config: Object\r\n\t\t//\t\tapp config\r\n\t\t// node: domNode\r\n\t\t//\t\tdomNode.\r\n\t\tvar path;\r\n\r\n\t\t// call configProcessHas to process any has blocks in the config\r\n\t\tconfig = configUtils.configProcessHas(config);\r\n\r\n\t\tif(!config.loaderConfig){\r\n\t\t\tconfig.loaderConfig = {};\r\n\t\t}\r\n\t\tif(!config.loaderConfig.paths){\r\n\t\t\tconfig.loaderConfig.paths = {};\r\n\t\t}\r\n\t\tif(!config.loaderConfig.paths[\"app\"]){\r\n\t\t\t// Register application module path\r\n\t\t\tpath = window.location.pathname;\r\n\t\t\tif(path.charAt(path.length) != \"/\"){\r\n\t\t\t\tpath = path.split(\"/\");\r\n\t\t\t\tpath.pop();\r\n\t\t\t\tpath = path.join(\"/\");\r\n\t\t\t}\r\n\t\t\tconfig.loaderConfig.paths[\"app\"] = path;\r\n\t\t}\r\n\t\trequire(config.loaderConfig);\r\n\r\n\t\tif(!config.modules){\r\n\t\t\tconfig.modules = [];\r\n\t\t}\r\n\t\t// add dojox/app lifecycle module by default\r\n\t\tconfig.modules.push(\"./module/lifecycle\");\r\n\t\tvar modules = config.modules.concat(config.dependencies?config.dependencies:[]);\r\n\r\n\t\tif(config.template){\r\n\t\t\tpath = config.template;\r\n\t\t\tif(path.indexOf(\"./\") == 0){\r\n\t\t\t\tpath = \"app/\"+path;\r\n\t\t\t}\r\n\t\t\tmodules.push(\"dojo/text!\" + path);\r\n\t\t}\r\n\r\n\t\trequire(modules, function(){\r\n\t\t\tvar modules = [Application];\r\n\t\t\tfor(var i = 0; i < config.modules.length; i++){\r\n\t\t\t\tmodules.push(arguments[i]);\r\n\t\t\t}\r\n\r\n\t\t\tif(config.template){\r\n\t\t\t\tvar ext = {\r\n\t\t\t\t\ttemplateString: arguments[arguments.length - 1]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tApp = declare(modules, ext);\r\n\r\n\t\t\tready(function(){\r\n\t\t\t\tvar app = new App(config, node || win.body());\r\n\r\n\t\t\t\tif(has(\"app-log-api\")){\r\n\t\t\t\t\tapp.log = function(){\r\n\t\t\t\t\t\t// summary:\r\n\t\t\t\t\t\t//\t\tIf config is set to turn on app logging, then log msg to the console\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\t// arguments: \r\n\t\t\t\t\t\t//\t\tthe message to be logged, \r\n\t\t\t\t\t\t//\t\tall but the last argument will be treated as Strings and be concatenated together, \r\n\t\t\t\t\t\t//      the last argument can be an object it will be added as an argument to the console.log \t\t\t\t\t\t\r\n\t\t\t\t\t\tvar msg = \"\";\r\n\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\tfor(var i = 0; i < arguments.length-1; i++){\r\n\t\t\t\t\t\t\t\tmsg = msg + arguments[i];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconsole.log(msg,arguments[arguments.length-1]);\r\n\t\t\t\t\t\t}catch(e){}\r\n\t\t\t\t\t};\r\n\t\t\t\t}else{\r\n\t\t\t\t\tapp.log = function(){}; // noop\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.transitionToView = function(/*DomNode*/target, /*Object*/transitionOptions, /*Event?*/triggerEvent){\r\n\t\t\t\t\t// summary:\r\n\t\t\t\t\t//\t\tA convenience function to fire the transition event to transition to the view.\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// target:\r\n\t\t\t\t\t//\t\tThe DOM node that initiates the transition (for example a ListItem).\r\n\t\t\t\t\t// transitionOptions:\r\n\t\t\t\t\t//\t\tContains the transition options.\r\n\t\t\t\t\t// triggerEvent:\r\n\t\t\t\t\t//\t\tThe event that triggered the transition (for example a touch event on a ListItem).\r\n\t\t\t\t\tvar opts = {bubbles:true, cancelable:true, detail: transitionOptions, triggerEvent: triggerEvent || null};\r\n\t\t\t\t\ton.emit(target,\"startTransition\", opts);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tapp.setStatus(app.lifecycle.STARTING);\r\n\t\t\t\t// Create global namespace for application.\r\n\t\t\t\t// The global name is application id. ie: modelApp\r\n\t\t\t\tvar globalAppName = app.id;\r\n\t\t\t\tif(window[globalAppName]){\r\n\t\t\t\t\tdeclare.safeMixin(app, window[globalAppName]);\r\n\t\t\t\t}\r\n\t\t\t\twindow[globalAppName] = app;\r\n\t\t\t\tapp.start();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\treturn function(config, node){\r\n\t\tif(!config){\r\n\t\t\tthrow new Error(\"App Config Missing\");\r\n\t\t}\r\n\r\n\t\tif(config.validate){\r\n\t\t\trequire([\"dojox/json/schema\", \"dojox/json/ref\", \"dojo/text!dojox/application/schema/application.json\"], function(schema, appSchema){\r\n\t\t\t\tschema = dojox.json.ref.resolveJson(schema);\r\n\t\t\t\tif(schema.validate(config, appSchema)){\r\n\t\t\t\t\tgenerateApp(config, node);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tgenerateApp(config, node);\r\n\t\t}\r\n\t}\r\n});\r\n"]}