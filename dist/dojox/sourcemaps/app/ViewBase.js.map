{"version":3,"sources":["app/ViewBase.js"],"names":["define","require","when","on","domAttr","domStyle","declare","lang","Deferred","model","constraints","constructor","params","this","id","name","children","selectedChildren","loadedStores","_started","mixin","parent","views","start","_startDef","load","hitch","_createDataStore","_setupModel","vcDef","_loadViewController","controller","safeMixin","stores","item","charAt","type","config","storeCtor","e","Error","data","isString","getObject","observable","observableCtor","store","loadedModels","_startup","createPromise","models","app","message","isArray","err","_initViewHidden","_needsResize","_startLayout","set","domNode","log","hasOwnProperty","constraint","get","register","emit","view","callback","startup","init","resolve","path","requireSignal","viewControllerDef","replace","loadFile","index","indexOf","substring","error","isResolved","isRejected","info","remove","reject","beforeActivate","afterActivate","beforeDeactivate","afterDeactivate","destroy"],"mappings":"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","file":"../../app/ViewBase.js","sourcesContent":["define([\"require\", \"dojo/when\", \"dojo/on\", \"dojo/dom-attr\", \"dojo/dom-style\", \"dojo/_base/declare\", \"dojo/_base/lang\",\r\n\t\"dojo/Deferred\", \"./utils/model\", \"./utils/constraints\"],\r\n\tfunction(require, when, on, domAttr, domStyle, declare, lang, Deferred, model, constraints){\r\n\treturn declare(\"dojox.app.ViewBase\", null, {\r\n\t\t// summary:\r\n\t\t//\t\tView base class with model & controller capabilities. Subclass must implement rendering capabilities.\r\n\t\tconstructor: function(params){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tConstructs a ViewBase instance.\r\n\t\t\t// params:\r\n\t\t\t//\t\tview parameters, include:\r\n\t\t\t//\r\n\t\t\t//\t\t- app: the app\r\n\t\t\t//\t\t- id: view id\r\n\t\t\t//\t\t- name: view name\r\n\t\t\t//\t\t- parent: parent view\r\n\t\t\t//\t\t- controller: view controller module identifier\r\n\t\t\t//\t\t- children: children views\r\n\t\t\tthis.id = \"\";\r\n\t\t\tthis.name = \"\";\r\n\t\t\tthis.children = {};\r\n\t\t\tthis.selectedChildren = {};\r\n\t\t\tthis.loadedStores = {};\r\n\t\t\t// private\r\n\t\t\tthis._started = false;\r\n\t\t\tlang.mixin(this, params);\r\n\t\t\t// mixin views configuration to current view instance.\r\n\t\t\tif(this.parent.views){\r\n\t\t\t\tlang.mixin(this, this.parent.views[this.name]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// start view\r\n\t\tstart: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tstart view object.\r\n\t\t\t//\t\tload view template, view controller implement and startup all widgets in view template.\r\n\t\t\tif(this._started){\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\tthis._startDef = new Deferred();\r\n\t\t\twhen(this.load(), lang.hitch(this, function(){\r\n\t\t\t\t// call setupModel, after setupModel startup will be called after startup the loadViewDeferred will be resolved\r\n\t\t\t\tthis._createDataStore(this);\r\n\t\t\t\tthis._setupModel();\r\n\t\t\t}));\r\n\t\t\treturn this._startDef;\r\n\t\t},\r\n\r\n\t\tload: function(){\r\n\t\t\tvar vcDef = this._loadViewController();\r\n\t\t\twhen(vcDef, lang.hitch(this, function(controller){\r\n\t\t\t\tif(controller){\r\n\t\t\t\t\t//lang.mixin(this, controller);\r\n\t\t\t\t\tdeclare.safeMixin(this, controller);\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t\treturn vcDef;\r\n\t\t},\r\n\r\n\t\t_createDataStore: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreate data store instance for View specific stores\r\n\t\t\t//\r\n\t\t\t// TODO: move this into a common place for use by main and ViewBase\r\n\t\t\t//\r\n\t\t\tif(this.parent.loadedStores){\r\n\t\t\t\tlang.mixin(this.loadedStores, this.parent.loadedStores);\r\n\t\t\t}\r\n\r\n\t\t\tif(this.stores){\r\n\t\t\t\t//create stores in the configuration.\r\n\t\t\t\tfor(var item in this.stores){\r\n\t\t\t\t\tif(item.charAt(0) !== \"_\"){//skip the private properties\r\n\t\t\t\t\t\tvar type = this.stores[item].type ? this.stores[item].type : \"dojo/store/Memory\";\r\n\t\t\t\t\t\tvar config = {};\r\n\t\t\t\t\t\tif(this.stores[item].params){\r\n\t\t\t\t\t\t\tlang.mixin(config, this.stores[item].params);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// we assume the store is here through dependencies\r\n\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\tvar storeCtor = require(type);\r\n\t\t\t\t\t\t}catch(e){\r\n\t\t\t\t\t\t\tthrow new Error(type+\" must be listed in the dependencies\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(config.data && lang.isString(config.data)){\r\n\t\t\t\t\t\t\t//get the object specified by string value of data property\r\n\t\t\t\t\t\t\t//cannot assign object literal or reference to data property\r\n\t\t\t\t\t\t\t//because json.ref will generate __parent to point to its parent\r\n\t\t\t\t\t\t\t//and will cause infinitive loop when creating StatefulModel.\r\n\t\t\t\t\t\t\tconfig.data = lang.getObject(config.data);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(this.stores[item].observable){\r\n\t\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\t\tvar observableCtor = require(\"dojo/store/Observable\");\r\n\t\t\t\t\t\t\t}catch(e){\r\n\t\t\t\t\t\t\t\tthrow new Error(\"dojo/store/Observable must be listed in the dependencies\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.stores[item].store = observableCtor(new storeCtor(config));\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tthis.stores[item].store = new storeCtor(config);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.loadedStores[item] = this.stores[item].store; // add this store to loadedStores for the view\t\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_setupModel: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tLoad views model if it is not already loaded then call _startup.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\t\t\t\t\r\n\t\t\tif(!this.loadedModels){\r\n\t\t\t\tvar createPromise;\r\n\t\t\t\ttry{\r\n\t\t\t\t\tcreatePromise = model(this.models, this.parent, this.app);\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\tthrow new Error(\"Error creating models: \"+e.message);\r\n\t\t\t\t}\r\n\t\t\t\twhen(createPromise, lang.hitch(this, function(models){\r\n\t\t\t\t\tif(models){\r\n\t\t\t\t\t\t// if models is an array it comes from dojo/promise/all. Each array slot contains the same result object\r\n\t\t\t\t\t\t// so pick slot 0.\r\n\t\t\t\t\t\tthis.loadedModels = lang.isArray(models)?models[0]:models;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._startup();\r\n\t\t\t\t}),\r\n\t\t\t\tfunction(err){\r\n\t\t\t\t\tthrow new Error(\"Error creating models: \"+err.message);\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t}else{ // loadedModels already created so call _startup\r\n\t\t\t\tthis._startup();\t\t\t\t\r\n\t\t\t}\t\t\r\n\t\t},\r\n\r\n\t\t_startup: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tstartup widgets in view template.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tthis._initViewHidden();\r\n\t\t\tthis._needsResize = true; // flag used to be sure resize has been called before transition\r\n\r\n\t\t\tthis._startLayout();\r\n\t\t},\r\n\r\n\t\t_initViewHidden: function(){\r\n\t\t\tdomStyle.set(this.domNode, \"visibility\", \"hidden\");\r\n\t\t},\r\n\r\n\t\t_startLayout: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tstartup widgets in view template.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tthis.app.log(\"  > in app/ViewBase _startLayout firing layout for name=[\",this.name,\"], parent.name=[\",this.parent.name,\"]\");\r\n\r\n\t\t\tif(!this.hasOwnProperty(\"constraint\")){\r\n\t\t\t\tthis.constraint = domAttr.get(this.domNode, \"data-app-constraint\") || \"center\";\r\n\t\t\t}\r\n\t\t\tconstraints.register(this.constraint);\r\n\r\n\r\n\t\t\tthis.app.emit(\"app-initLayout\", {\r\n\t\t\t\t\"view\": this, \r\n\t\t\t\t\"callback\": lang.hitch(this, function(){\r\n\t\t\t\t\t\t//start widget\r\n\t\t\t\t\t\tthis.startup();\r\n\r\n\t\t\t\t\t\t// call view assistant's init() method to initialize view\r\n\t\t\t\t\t\tthis.app.log(\"  > in app/ViewBase calling init() name=[\",this.name,\"], parent.name=[\",this.parent.name,\"]\");\r\n\t\t\t\t\t\tthis.init();\r\n\t\t\t\t\t\tthis._started = true;\r\n\t\t\t\t\t\tif(this._startDef){\r\n\t\t\t\t\t\t\tthis._startDef.resolve(this);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t},\r\n\r\n\r\n\t\t_loadViewController: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tLoad view controller by configuration or by default.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\t//\r\n\t\t\tvar viewControllerDef = new Deferred();\r\n\t\t\tvar path;\r\n\r\n\t\t\tif(!this.controller){ // no longer using this.controller === \"none\", if we dont have one it means none.\r\n\t\t\t\tthis.app.log(\"  > in app/ViewBase _loadViewController no controller set for view name=[\",this.name,\"], parent.name=[\",this.parent.name,\"]\");\r\n\t\t\t\tviewControllerDef.resolve(true);\r\n\t\t\t\treturn viewControllerDef;\r\n\t\t\t}else{\r\n\t\t\t\tpath = this.controller.replace(/(\\.js)$/, \"\");\r\n\t\t\t}\r\n\r\n\t\t\tvar requireSignal;\r\n\t\t\ttry{\r\n\t\t\t\tvar loadFile = path;\r\n\t\t\t\tvar index = loadFile.indexOf(\"./\");\r\n\t\t\t\tif(index >= 0){\r\n\t\t\t\t\tloadFile = path.substring(index+2);\r\n\t\t\t\t}\r\n\t\t\t\trequireSignal = require.on ? require.on(\"error\", function(error){\r\n\t\t\t\t\tif(viewControllerDef.isResolved() || viewControllerDef.isRejected()){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(error.info[0] && (error.info[0].indexOf(loadFile) >= 0)){\r\n\t\t\t\t\t\tviewControllerDef.resolve(false);\r\n\t\t\t\t\t\tif(requireSignal){\r\n\t\t\t\t\t\t\trequireSignal.remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}) : null;\r\n\r\n\t\t\t\tif(path.indexOf(\"./\") == 0){\r\n\t\t\t\t\tpath = \"app/\"+path;\r\n\t\t\t\t}\r\n\r\n\t\t\t\trequire([path], function(controller){\r\n\t\t\t\t\tviewControllerDef.resolve(controller);\r\n\t\t\t\t\tif(requireSignal){\r\n\t\t\t\t\t\trequireSignal.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}catch(e){\r\n\t\t\t\tviewControllerDef.reject(e);\r\n\t\t\t\tif(requireSignal){\r\n\t\t\t\t\trequireSignal.remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn viewControllerDef;\r\n\t\t},\r\n\r\n\t\tinit: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tview life cycle init()\r\n\t\t},\r\n\r\n\t\tbeforeActivate: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tview life cycle beforeActivate()\r\n\t\t},\r\n\r\n\t\tafterActivate: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tview life cycle afterActivate()\r\n\t\t},\r\n\r\n\t\tbeforeDeactivate: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tview life cycle beforeDeactivate()\r\n\t\t},\r\n\r\n\t\tafterDeactivate: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tview life cycle afterDeactivate()\r\n\t\t},\r\n\r\n\t\tdestroy: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tview life cycle destroy()\r\n\t\t}\r\n\t});\r\n});\r\n"]}