{"version":3,"sources":["app/View.js"],"names":["define","require","when","on","declare","lang","Deferred","Destroyable","_TemplatedMixin","_WidgetsInTemplateMixin","ViewBase","nls","constructor","params","connect","obj","event","method","this","own","hitch","_loadTemplate","templateString","tpl","template","deps","dependencies","indexOf","concat","requireSignal","def","length","error","isResolved","isRejected","info","resolve","remove","call","arguments","e","loadViewDeferred","load","tplDef","defDef","inherited","nlsDef","mixin","parent","value","_startup","buildRendering"],"mappings":";;;;;;;AAAAA,QAAQ,UAAW,YAAa,UAAW,qBAAsB,kBAAmB,gBAClF,oBAAqB,wBAAyB,gCAAiC,aAAc,eAC9F,SAASC,EAASC,EAAMC,EAAIC,EAASC,EAAMC,EAAUC,EAAaC,EAAiBC,EAAyBC,EAAUC,GAEtH,OAAOP,EAAQ,kBAAmBI,EAAiBC,EAAyBF,EAAaG,IAGxFE,YAAa,SAASC,KAmDtBC,QAAS,SAASC,EAAKC,EAAOC,GAC7B,OAAOC,KAAKC,IAAIhB,EAAGY,EAAKC,EAAOX,EAAKe,MAAMF,KAAMD,KAAU,IAG3DI,cAAe,WAOd,GAAGH,KAAKI,eACP,OAAO,EAEP,IAAIC,EAAML,KAAKM,SACXC,EAAOP,KAAKQ,aAAaR,KAAKQ,gBAC/BH,IACsB,GAArBA,EAAII,QAAQ,QACdJ,EAAM,OAAOA,GAEdE,EAAOA,EAAKG,QAAQ,aAAaL,KAElC,IAEKM,EAFDC,EAAM,IAAIxB,EACd,GAAGmB,EAAKM,OAAS,EAEhB,IACCF,EAAgB5B,EAAQE,GAAKF,EAAQE,GAAG,QAASE,EAAKe,MAAMF,KAAM,SAASc,GACvEF,EAAIG,cAAgBH,EAAII,cAGxBF,EAAMG,KAAK,IAAMH,EAAMG,KAAK,GAAGR,QAAQT,KAAKM,WAAa,IAC3DM,EAAIM,SAAQ,GACTP,GACFA,EAAcQ,aAGV,KACPpC,EAAQwB,EAAM,WACbK,EAAIM,QAAQE,KAAKR,EAAKS,WACnBV,GACFA,EAAcQ,WAGhB,MAAMG,GACNV,EAAIM,SAAQ,GACTP,GACFA,EAAcQ,cAIhBP,EAAIM,SAAQ,GAEb,IAAIK,EAAmB,IAAInC,EAK3B,OAJAJ,EAAK4B,EAAKzB,EAAKe,MAAMF,KAAM,WAC1BA,KAAKI,eAAiBJ,KAAKM,SAAWe,UAAU,GAAGA,UAAU,GAAGR,OAAS,GAAK,cAC9EU,EAAiBL,QAAQlB,SAEnBuB,GAKTC,KAAM,WACL,IAAIC,EAAS,IAAIrC,EACbsC,EAAS1B,KAAK2B,UAAUN,WACxBO,EAASnC,EAAIO,MAiBjB,OAbAhB,EAAK0C,EAAQvC,EAAKe,MAAMF,KAAM,WAC7BhB,EAAK4C,EAAQzC,EAAKe,MAAMF,KAAM,SAASP,GAEtCO,KAAKP,IAAMN,EAAK0C,SAAU7B,KAAK8B,OAAOrC,KACnCA,GAEFN,EAAK0C,MAAM7B,KAAKP,IAAKA,GAEtBT,EAAKgB,KAAKG,gBAAiB,SAAS4B,GACnCN,EAAOP,QAAQa,WAIXN,GAGRO,SAAU,WAKThC,KAAKiC,iBACLjC,KAAK2B,UAAUN","file":"../../app/View.js","sourcesContent":["define([\"require\", \"dojo/when\", \"dojo/on\", \"dojo/_base/declare\", \"dojo/_base/lang\", \"dojo/Deferred\",\r\n\t\t\"dijit/Destroyable\", \"dijit/_TemplatedMixin\", \"dijit/_WidgetsInTemplateMixin\", \"./ViewBase\", \"./utils/nls\"],\r\n\tfunction(require, when, on, declare, lang, Deferred, Destroyable, _TemplatedMixin, _WidgetsInTemplateMixin, ViewBase, nls){\r\n\r\n\treturn declare(\"dojox.app.View\", [_TemplatedMixin, _WidgetsInTemplateMixin, Destroyable, ViewBase], {\r\n\t\t// summary:\r\n\t\t//\t\tView class inheriting from ViewBase adding templating & globalization capabilities.\r\n\t\tconstructor: function(params){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tConstructs a View instance either from a configuration or programmatically.\r\n\t\t\t//\r\n\t\t\t// example:\r\n\t\t\t//\t\t|\tuse configuration file\r\n\t\t\t//\t\t|\r\n\t\t\t// \t\t|\t// load view controller from views/simple.js by default\r\n\t\t\t//\t\t|\t\"simple\":{\r\n\t\t\t//\t\t|\t\t\"template\": \"myapp/views/simple.html\",\r\n\t\t\t//\t\t|\t\t\"nls\": \"myapp/nls/simple\"\r\n\t\t\t//\t\t|\t\t\"dependencies\":[\"dojox/mobile/TextBox\"]\r\n\t\t\t//\t\t|\t}\r\n\t\t\t//\t\t|\r\n\t\t\t//\t\t|\t\"home\":{\r\n\t\t\t//\t\t|\t\t\"template\": \"myapp/views/home.html\", // no controller set to not use a view controller\r\n\t\t\t//\t\t|\t\t\"dependencies\":[\"dojox/mobile/TextBox\"]\r\n\t\t\t//\t\t|\t}\r\n\t\t\t//\t\t|\t\"main\":{\r\n\t\t\t//\t\t|\t\t\"template\": \"myapp/views/main.html\",\r\n\t\t\t//\t\t|\t\t\"controller\": \"myapp/views/main.js\", // identify load view controller from views/main.js\r\n\t\t\t//\t\t|\t\t\"dependencies\":[\"dojox/mobile/TextBox\"]\r\n\t\t\t//\t\t|\t}\r\n\t\t\t//\r\n\t\t\t// example:\r\n\t\t\t//\t\t|\tvar viewObj = new View({\r\n\t\t\t//\t\t|\t\tapp: this.app,\r\n\t\t\t//\t\t|\t\tid: this.id,\r\n\t\t\t//\t\t|\t\tname: this.name,\r\n\t\t\t//\t\t|\t\tparent: this,\r\n\t\t\t//\t\t|\t\ttemplateString: this.templateString,\r\n\t\t\t//\t\t|\t\ttemplate: this.template, \r\n\t\t\t//\t\t|\t\tcontroller: this.controller\r\n\t\t\t//\t\t|\t});\r\n\t\t\t//\t\t|\tviewObj.start(); // start view\r\n\t\t\t//\r\n\t\t\t// params:\r\n\t\t\t//\t\tview parameters, include:\r\n\t\t\t//\r\n\t\t\t//\t\t- app: the app\r\n\t\t\t//\t\t- id: view id\r\n\t\t\t//\t\t- name: view name\r\n\t\t\t//\t\t- template: view template identifier. If templateString is not empty, this parameter is ignored.\r\n\t\t\t//\t\t- templateString: view template string\r\n\t\t\t//\t\t- controller: view controller module identifier\r\n\t\t\t//\t\t- parent: parent view\r\n\t\t\t//\t\t- children: children views\r\n\t\t\t//\t\t- nls: nls definition module identifier\r\n\t\t},\r\n\r\n\t\t// _TemplatedMixin requires a connect method if data-dojo-attach-* are used\r\n\t\tconnect: function(obj, event, method){\r\n\t\t\treturn this.own(on(obj, event, lang.hitch(this, method)))[0]; // handle\r\n\t\t},\r\n\r\n\t\t_loadTemplate: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tload view HTML template and dependencies.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\t//\r\n\r\n\t\t\tif(this.templateString){\r\n\t\t\t\treturn true;\r\n\t\t\t}else{\r\n\t\t\t\tvar tpl = this.template;\r\n\t\t\t\tvar deps = this.dependencies?this.dependencies:[];\r\n\t\t\t\tif(tpl){\r\n\t\t\t\t\tif(tpl.indexOf(\"./\") == 0){\r\n\t\t\t\t\t\ttpl = \"app/\"+tpl;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdeps = deps.concat([\"dojo/text!\"+tpl]);\r\n\t\t\t\t}\r\n\t\t\t\tvar def = new Deferred();\r\n\t\t\t\tif(deps.length > 0){\r\n\t\t\t\t\tvar requireSignal;\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\trequireSignal = require.on ? require.on(\"error\", lang.hitch(this, function(error){\r\n\t\t\t\t\t\t\tif(def.isResolved() || def.isRejected()){\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(error.info[0] && error.info[0].indexOf(this.template) >= 0 ){\r\n\t\t\t\t\t\t\t\tdef.resolve(false);\r\n\t\t\t\t\t\t\t\tif(requireSignal){\r\n\t\t\t\t\t\t\t\t\trequireSignal.remove();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})) :  null;\r\n\t\t\t\t\t\trequire(deps, function(){\r\n\t\t\t\t\t\t\tdef.resolve.call(def, arguments);\r\n\t\t\t\t\t\t\tif(requireSignal){\r\n\t\t\t\t\t\t\t\trequireSignal.remove();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}catch(e){\r\n\t\t\t\t\t\tdef.resolve(false);\r\n\t\t\t\t\t\tif(requireSignal){\r\n\t\t\t\t\t\t\trequireSignal.remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdef.resolve(true);\r\n\t\t\t\t}\r\n\t\t\t\tvar loadViewDeferred = new Deferred();\r\n\t\t\t\twhen(def, lang.hitch(this, function(){\r\n\t\t\t\t\tthis.templateString = this.template ? arguments[0][arguments[0].length - 1] : \"<div></div>\";\r\n\t\t\t\t\tloadViewDeferred.resolve(this);\r\n\t\t\t\t}));\r\n\t\t\t\treturn loadViewDeferred;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// start view\r\n\t\tload: function(){\r\n\t\t\tvar tplDef = new Deferred();\r\n\t\t\tvar defDef = this.inherited(arguments);\r\n\t\t\tvar nlsDef = nls(this);\r\n\t\t\t// when parent loading is done (controller), proceed with template\r\n\t\t\t// (for data-dojo-* to work we need to wait for controller to be here, this is also\r\n\t\t\t// useful when the controller is used as a layer for the view)\r\n\t\t\twhen(defDef, lang.hitch(this, function(){\r\n\t\t\t\twhen(nlsDef, lang.hitch(this, function(nls){\r\n\t\t\t\t\t// we inherit from the parent NLS\r\n\t\t\t\t\tthis.nls = lang.mixin({}, this.parent.nls);\r\n\t\t\t\t\tif(nls){\r\n\t\t\t\t\t\t// make sure template can access nls doing ${nls.myprop}\r\n\t\t\t\t\t\tlang.mixin(this.nls, nls);\r\n\t\t\t\t\t}\r\n\t\t\t\t\twhen(this._loadTemplate(), function(value){\r\n\t\t\t\t\t\ttplDef.resolve(value);\r\n\t\t\t\t\t});\r\n\t\t\t\t}));\r\n\t\t\t}));\r\n\t\t\treturn tplDef;\r\n\t\t},\r\n\r\n\t\t_startup: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tstartup widgets in view template.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tthis.buildRendering();\r\n\t\t\tthis.inherited(arguments);\r\n\t\t}\r\n\t});\r\n});\r\n"]}