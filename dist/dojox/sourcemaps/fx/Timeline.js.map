{"version":3,"sources":["fx/Timeline.js"],"names":["define","lang","easingUtil","baseFx","dom","dojoxFx","connectUtil","htmlUtil","arrayUtil","Color","animateTimeline","options","node","_curve","Timeline","keys","ani","animateProperty","byId","duration","properties","_properties","easing","linear","onAnimate","v","connect","sty","curve","getValue","reversed","style","this","isArray","flatten","prototype","p","o","forEach","k","i","str","idx","step","undefined","length","parseInt","ease","nm","steps","values","eases","test","units","exec","join","push","start","end","_reversed","self","getProp","toCss","ns","next","n","beg","seg","blendColors","df","_Timeline"],"mappings":"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","file":"../../fx/Timeline.js","sourcesContent":["define([\"dojo/_base/lang\",\"dojo/fx/easing\",\"dojo/_base/fx\",\"dojo/dom\",\"./_base\",\"dojo/_base/connect\",\r\n\t\t\"dojo/_base/html\", \"dojo/_base/array\",\"dojo/_base/Color\"],\r\n function(lang, easingUtil, baseFx, dom, dojoxFx, connectUtil, htmlUtil, arrayUtil, Color){\r\n\r\ndojoxFx.animateTimeline = function(options, node){\r\n\t// summary:\r\n\t//\t\tAn add-on to dojo.fx that provides the ability to create\r\n\t//\t\ta complex property animation based on an array of \"keyframes\".\r\n\t// description:\r\n\t//\t\tThe Timeline is a replacement for the default dojo._Line.\r\n\t//\t\tInstead of _Line.getValue returning a float between 0-1,\r\n\t//\t\t_Timeline.getValue returns an object with all properties and\r\n\t//\t\ttheir current values.\r\n\t//\t\tA property does not have to appear in every keyframe.\r\n\t//\t\tAs in the example below, \"height\" is transitioned from the first\r\n\t//\t\tkeyframe to the third. \"width\" is transitioned from the first\r\n\t//\t\tto the second to the third.\r\n\t//\t\tEach keyframe can accept the following custom properties:\r\n\t//\r\n\t//\t\t- step: String:\r\n\t//\t\t  The start, finish or percentage that this keyframe represents.\r\n\t//\t\t  Allowed parameters are:\r\n\t//\t\t\t- 0%-100%\r\n\t//\t\t\t- from (same as 0%, used to conform with the Webkit animation spec)\r\n\t//\t\t\t- to (same as 100%, used to conform with the Webkit animation spec)\r\n\t//\t\t- ease: String:\r\n\t//\t\t  The string name of a dojo.fx.easing ease. Defaults to \"linear\". Use\r\n\t//\t\t  the suffix name of the ease, like: \"quadIn\", not: \"dojo.fx.quadIn\".\r\n\t// options: Object\r\n\t//\t\tThe parameters passed to the timeline animation. Includes:\r\n\t//\r\n\t//\t\t- keys: Array: An array of objects, with style properties and values.\r\n\t//\t\t- duration: Duration of the animation in milliseconds.  Defaults to 1000.\r\n\t// node: DomNode|String\r\n\t//\t\tThe DomNode or id to be animated.\r\n\t// example:\r\n\t//\t|\tvar keys = [\r\n\t//\t|\t{\r\n\t//\t|\t\tstep:\"0px\",\r\n\t//\t|\t\tease:\"quadInOut\",\r\n\t//\t|\t\twidth:\"50px\",\r\n\t//\t|\t\theight:\"50px\",\r\n\t//\t|\t},{\r\n\t//\t|\t\tstep:\"25%\",\r\n\t//\t|\t\twidth:\"190px\"\r\n\t//\t|\t},{\r\n\t//\t|\t\tstep:\"100%\",\r\n\t//\t|\t\twidth:\"10px\",\r\n\t//\t|\t\theight:\"200px\",\r\n\t//\t|\t}\r\n\t//\t|\t];\r\n\t//\t|\tani = dojox.fx.animateTimeline({keys:keys, duration:2000}, \"myDiv\").play();\r\n\r\n\tvar _curve = new Timeline(options.keys);\r\n\tvar ani = baseFx.animateProperty({\r\n\t\tnode:dom.byId(node || options.node),\r\n\t\tduration:options.duration || 1000,\r\n\t\tproperties:_curve._properties,\r\n\t\t// don't change! This easing is for the timeline,\r\n\t\t// not individual properties\r\n\t\teasing:easingUtil.linear,\r\n\t\tonAnimate: function(v){\r\n\t\t\t//console.log(\"   ani:\", v);\r\n\t\t}\r\n\t});\r\n\tconnectUtil.connect(ani, \"onEnd\", function(node){\r\n\t\t// Setting the final style. Hiccups in the browser\r\n\t\t// can cause the animation to lose track. This ensures\r\n\t\t// that it finishes in the proper location.\r\n\t\tvar sty = ani.curve.getValue(ani.reversed ? 0 : 1);\r\n\t\thtmlUtil.style(node, sty);\r\n\t});\r\n\tconnectUtil.connect(ani, \"beforeBegin\", function(){\r\n\t\t// remove default curve and replace it with Timeline\r\n\t\tif(ani.curve){ delete ani.curve; }\r\n\t\tani.curve = _curve;\r\n\t\t_curve.ani = ani;\r\n\t})\r\n\treturn ani; // dojo.Animation\r\n};\r\n\r\nvar Timeline = function(/* Array */keys){\r\n\t// summary:\r\n\t//\t\tThe dojox.fx._Timeline object from which an instance\r\n\t//\t\tis created\r\n\t// tags:\r\n\t//\t\tprivate\r\n\tthis.keys = lang.isArray(keys) ? this.flatten(keys) : keys;\r\n};\r\n\r\nTimeline.prototype.flatten = function(keys){\r\n\t// summary:\r\n\t//\t\tAn internally used function that converts the keyframes\r\n\t//\t\tas used in the example above into a series of key values\r\n\t//\t\twhich is what is used in the animation parsing.\r\n\tvar getPercent = function(str, idx){\r\n\t\tif(str == \"from\"){ return 0; }\r\n\t\tif(str == \"to\"){ return 1; }\r\n\t\tif(str === undefined){\r\n\t\t\treturn idx==0 ? 0 : idx / (keys.length - 1)\r\n\t\t}\r\n\t\treturn parseInt(str, 10) * .01\r\n\t};\r\n\tvar p = {}, o = {};\r\n\tarrayUtil.forEach(keys, function(k, i){\r\n\t\tvar step = getPercent(k.step, i);\r\n\t\tvar ease = easingUtil[k.ease] || easingUtil.linear;\r\n\t\t\r\n\t\tfor(var nm in k){\r\n\t\t\tif(nm == \"step\" || nm == \"ease\" || nm == \"from\" || nm == \"to\"){ continue; }\r\n\t\t\tif(!o[nm]){\r\n\t\t\t\to[nm] = {\r\n\t\t\t\t\tsteps:[],\r\n\t\t\t\t\tvalues:[],\r\n\t\t\t\t\teases:[],\r\n\t\t\t\t\tease:ease\r\n\t\t\t\t};\r\n\t\t\t\tp[nm] = {};\r\n\t\t\t\tif(!/#/.test(k[nm])){\r\n\t\t\t\t\tp[nm].units = o[nm].units = /\\D{1,}/.exec(k[nm]).join(\"\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tp[nm].units = o[nm].units = \"isColor\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\to[nm].eases.push(easingUtil[k.ease || \"linear\"]);\r\n\t\t\t\r\n\t\t\to[nm].steps.push(step);\r\n\t\t\tif(p[nm].units == \"isColor\"){\r\n\t\t\t\to[nm].values.push(new Color(k[nm]));\r\n\t\t\t}else{\r\n\t\t\t\to[nm].values.push(parseInt(/\\d{1,}/.exec(k[nm]).join(\"\")));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(p[nm].start === undefined){\r\n\t\t\t\tp[nm].start = o[nm].values[o[nm].values.length-1];\r\n\t\t\t}else{\r\n\t\t\t\tp[nm].end = o[nm].values[o[nm].values.length-1]\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\t\r\n\t\r\n\tthis._properties = p;\r\n\treturn o; // Object\r\n\t\r\n};\r\n\r\nTimeline.prototype.getValue = function(/*float*/ p){\r\n\t// summary:\r\n\t//\t\tReplaces the native getValue in dojo.fx.Animation.\r\n\t//\t\tReturns an object with all propeties used in the animation\r\n\t//\t\tand the property's current value\r\n\tp = this.ani._reversed ? 1-p : p;\r\n\tvar o = {}, self = this;\r\n\t\r\n\tvar getProp = function(nm, i){\r\n\t\treturn self._properties[nm].units!=\"isColor\" ?\r\n\t\t\tself.keys[nm].values[i] + self._properties[nm].units :\r\n\t\t\tself.keys[nm].values[i].toCss();\r\n\t};\r\n\t\r\n\tfor(var nm in this.keys){\r\n\t\tvar k = this.keys[nm];\r\n\t\tfor(var i=0; i<k.steps.length; i++){\r\n\t\t\t\r\n\t\t\tvar step = k.steps[i];\r\n\t\t\tvar ns = k.steps[i+1];\r\n\t\t\tvar next = i < k.steps.length ? true : false;\r\n\t\t\tvar ease = k.eases[i] || function(n){return n;};\r\n\t\t\t\r\n\t\t\tif(p == step){\r\n\t\t\t\t// first or last\r\n\t\t\t\to[nm] = getProp(nm, i);\r\n\t\t\t\tif(!next || (next &&  this.ani._reversed)) break;\r\n\t\t\t\r\n\t\t\t}else if(p > step){\r\n\t\t\t\t\r\n\t\t\t\tif(next && p < k.steps[i+1]){\r\n\t\t\t\t\t// inbetween steps\r\n\t\t\t\t\tvar end = k.values[i+1];\r\n\t\t\t\t\tvar beg = k.values[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar seg = (1 / (ns - step)) * (p - step);\r\n\t\t\t\t\tseg = ease(seg);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(beg instanceof Color){\r\n\t\t\t\t\t\to[nm] = Color.blendColors(beg, end, seg).toCss(false);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tvar df = end - beg;\r\n\t\t\t\t\t\to[nm] = beg + seg * df + this._properties[nm].units;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// completed keys before 100%\r\n\t\t\t\t\to[nm] = getProp(nm, i);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}else if((next && !this.ani._reversed) || (!next && this.ani._reversed)){\r\n\t\t\t\to[nm] = getProp(nm, i);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn o; // Object\r\n};\r\ndojoxFx._Timeline = Timeline;\r\nreturn dojoxFx;\r\n});\r\n"]}