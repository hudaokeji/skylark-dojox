{"version":3,"sources":["widget/FeedPortlet.js"],"names":["dojo","provide","require","declare","dojox","widget","Portlet","local","maxResults","url","openNew","showFeedTitle","postCreate","this","inherited","arguments","data","AtomReadStore","Error","declaredClass","onFeedError","containerNode","innerHTML","addChild","child","attr","set","_getTitle","item","t","store","getValue","text","_getLink","l","href","_getContent","c","split","join","_setUrlAttr","_started","load","startup","started","id","query","_resultList","destroy","GoogleFeedStore","request","count","onComplete","hitch","items","getFeedValue","title","generateResults","onError","fetch","timer","ul","create","class","forEach","li","connect","evt","clearTimeout","setTimeout","summary","content","target","dijit","hideTooltip","showTooltip","firstChild","isLeftToRight","resize","FeedPortlet","onlyOpenOne","iconCls","collapsedCls","upper","style","config","baseUrl","a","hasClass","parentNode","stopEvent","tagName","filter","removeClass","addClass","isExpanded","toggleClass","PortletSettings","urls","selectedIndex","buildRendering","s","length","console","log","srcNodeRef","place","value","label","div","appendChild","options","_setContentAttr","form","TextBox","domNode","Button","onClick","portlet","some","opt","idx","selected","toggle","index","get","_getFeedPortletUrlAttr"],"mappings":"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","file":"../../widget/FeedPortlet.js","sourcesContent":["dojo.provide(\"dojox.widget.FeedPortlet\");\r\ndojo.require(\"dojox.widget.Portlet\");\r\ndojo.require(\"dijit.Tooltip\");\r\ndojo.require(\"dijit.form.TextBox\");\r\ndojo.require(\"dijit.form.Button\");\r\ndojo.require(\"dojox.data.GoogleFeedStore\");\r\n\r\ndojo.declare(\"dojox.widget.FeedPortlet\", dojox.widget.Portlet, {\r\n\t// summary:\r\n\t//\t\tA Portlet that loads a XML feed.\r\n\t// description:\r\n\t//\t\tThe feed is displayed as\r\n\t//\t\tan unordered list of links.\tWhen a link is hovered over\r\n\t//\t\tby the mouse, it displays a summary in a tooltip.\r\n\r\n\t// local: Boolean\r\n\t//\t\tSpecifies whether the feed is to be loaded from the same domain as the\r\n\t//\t\tpage, or a remote domain.\tIf local is true, then the feed must be an\r\n\t//\t\tAtom feed.\tIf it is false, it can be an Atom or RSS feed.\r\n\tlocal: false,\r\n\r\n\t// maxResults: Number\r\n\t//\t\tThe number of results to display from the feed.\r\n\tmaxResults: 5,\r\n\r\n\t// url: String\r\n\t//\t\tThe URL of the feed to load.\tIf this is different to the domain\r\n\t//\t\tof the HTML page, local should be set to false.\r\n\turl: \"\",\r\n\r\n\t// openNew: Boolean\r\n\t//\t\tIf true, when a link is clicked it will open in a new window.\r\n\t//\t\tIf false, it will not.\r\n\topenNew: true,\r\n\r\n\t// useFeedTitle: Boolean\r\n\t//\t\tIf true, the title of the loaded feed is displayed in the title bar of the portlet.\r\n\t//\t\tIf false, the title remains unchanged.\r\n\tshowFeedTitle: true,\r\n\r\n\tpostCreate: function(){\r\n\t\tthis.inherited(arguments);\r\n\t\tif(this.local && !dojox.data.AtomReadStore){\r\n\t\t\tthrow Error(this.declaredClass + \": To use local feeds, you must include dojox.data.AtomReadStore on the page.\");\r\n\t\t}\r\n\t},\r\n\r\n\tonFeedError: function(){\r\n\t\t// summary:\r\n\t\t//\t\tCalled when a feed fails to load successfully.\r\n\t\tthis.containerNode.innerHTML = \"Error accessing the feed.\"\r\n\t},\r\n\r\n\taddChild: function(child){\r\n\t\tthis.inherited(arguments);\r\n\t\tvar url = child.attr(\"feedPortletUrl\");\r\n\t\tif(url){\r\n\t\t\tthis.set(\"url\", url);\r\n\t\t}\r\n\t},\r\n\r\n\t_getTitle: function(item){\r\n\t\t// summary:\r\n\t\t//\t\tGets the title of a feed item.\r\n\t\tvar t = this.store.getValue(item, \"title\");\r\n\t\treturn this.local ? t.text : t;\r\n\t},\r\n\r\n\t_getLink: function(item){\r\n\t\t// summary:\r\n\t\t//\t\tGets the href link of a feed item.\r\n\t\tvar l = this.store.getValue(item, \"link\");\r\n\t\treturn this.local ? l.href : l;\r\n\t},\r\n\r\n\t_getContent: function(item){\r\n\t\t// summary:\r\n\t\t//\t\tGets the summary of a feed item.\r\n\t\tvar c = this.store.getValue(item, \"summary\");\r\n\t\tif(!c){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif(this.local){\r\n\t\t\tc = c.text;\r\n\t\t}\r\n\t\t// Filter out any sneaky scripts in the code\r\n\t\tc = c.split(\"<script\").join(\"<!--\").split(\"</script>\").join(\"-->\");\r\n\t\tc = c.split(\"<iframe\").join(\"<!--\").split(\"</iframe>\").join(\"-->\");\r\n\t\treturn c;\r\n\r\n\t},\r\n\r\n\t_setUrlAttr: function(url){\r\n\t\t// summary:\r\n\t\t//\t\tSets the URL to load.\r\n\t\tthis.url = url;\r\n\t\tif(this._started){\r\n\t\t\tthis.load();\r\n\t\t}\r\n\t},\r\n\r\n\tstartup: function(){\r\n\t\t// summary:\r\n\t\t//\t\tLoads the widget.\r\n\t\tif(this.started || this._started){return;}\r\n\r\n\t\tthis.inherited(arguments);\r\n\r\n\t\tif(!this.url || this.url == \"\"){\r\n\t\t\tthrow new Error(this.id + \": A URL must be specified for the feed portlet\");\r\n\t\t}\r\n\t\tif(this.url && this.url != \"\"){\r\n\t\t\tthis.load();\r\n\t\t}\r\n\t},\r\n\r\n\tload: function(){\r\n\t\t// summary:\r\n\t\t//\t\tLoads the feed.\r\n\t\tif(this._resultList){\r\n\t\t\tdojo.destroy(this._resultList);\r\n\t\t}\r\n\t\tvar store, query;\r\n\r\n\t\t// If the feed is on the same domain, use the AtomReadStore,\r\n\t\t// as we cannot be guaranteed that it will be available to\r\n\t\t// Google services.\r\n\t\tif(this.local){\r\n\t\t\tstore = new dojox.data.AtomReadStore({\r\n\t\t\t\turl: this.url\r\n\t\t\t});\r\n\t\t\tquery = {};\r\n\r\n\t\t}else{\r\n\t\t\tstore = new dojox.data.GoogleFeedStore();\r\n\t\t\tquery = {url: this.url};\r\n\t\t}\r\n\t\tvar request = {\r\n\t\t\tquery: query,\r\n\t\t\tcount: this.maxResults,\r\n\t\t\tonComplete: dojo.hitch(this, function(items){\r\n\t\t\t\tif (this.showFeedTitle && store.getFeedValue) {\r\n\t\t\t\t\tvar title = this.store.getFeedValue(\"title\");\r\n\t\t\t\t\tif(title){\r\n\t\t\t\t\t\tthis.set(\"title\", title.text ? title.text : title);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.generateResults(items);\r\n\t\t\t}),\r\n\t\t\tonError: dojo.hitch(this, \"onFeedError\")\r\n\t\t};\r\n\r\n\t\tthis.store = store;\r\n\t\tstore.fetch(request);\r\n\t},\r\n\r\n\tgenerateResults: function (items){\r\n\t\t// summary:\r\n\t\t//\t\tGenerates a list of hyperlinks and displays a tooltip\r\n\t\t//\t\tcontaining a summary when the mouse hovers over them.\r\n\t\tvar store = this.store;\r\n\t\tvar timer;\r\n\t\tvar ul = (this._resultList =\r\n\t\t\tdojo.create(\"ul\", {\"class\" : \"dojoxFeedPortletList\"}, this.containerNode));\r\n\r\n\t\tdojo.forEach(items, dojo.hitch(this, function(item){\r\n\t\t\tvar li = dojo.create(\"li\", {\r\n\t\t\t\tinnerHTML: '<a href=\"'\r\n\t\t\t\t\t+ this._getLink(item)\r\n\t\t\t\t\t+ '\"'\r\n\t\t\t\t\t+ (this.openNew ? ' target=\"_blank\"' : '')\r\n\t\t\t\t\t+'>'\r\n\t\t\t\t\t+ this._getTitle(item) + '</a>'\r\n\t\t\t},ul);\r\n\r\n\t\t\tdojo.connect(li, \"onmouseover\", dojo.hitch(this, function(evt){\r\n\t\t\t\tif(timer){\r\n\t\t\t\t\tclearTimeout(timer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Show the tooltip after the mouse has been hovering\r\n\t\t\t\t// for a short time.\r\n\t\t\t\ttimer = setTimeout(dojo.hitch(this, function(){\r\n\t\t\t\t\ttimer = null;\r\n\t\t\t\t\tvar summary = this._getContent(item);\r\n\t\t\t\t\tif(!summary){return;}\r\n\t\t\t\t\tvar content = '<div class=\"dojoxFeedPortletPreview\">'\r\n\t\t\t\t\t\t+ summary + '</div>'\r\n\r\n\t\t\t\t\tdojo.query(\"li\", ul).forEach(function(item){\r\n\t\t\t\t\t\tif(item != evt.target){\r\n\t\t\t\t\t\t\tdijit.hideTooltip(item);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Hover the tooltip over the anchor tag\r\n\t\t\t\t\tdijit.showTooltip(content, li.firstChild, !this.isLeftToRight());\r\n\t\t\t\t}), 500);\r\n\r\n\r\n\t\t\t}));\r\n\r\n\t\t\t// Hide the tooltip when the mouse leaves a list item.\r\n\t\t\tdojo.connect(li, \"onmouseout\", function(){\r\n\t\t\t\tif(timer){\r\n\t\t\t\t\tclearTimeout(timer);\r\n\t\t\t\t\ttimer = null;\r\n\t\t\t\t}\r\n\t\t\t\tdijit.hideTooltip(li.firstChild);\r\n\t\t\t});\r\n\t\t}));\r\n\r\n\t\tthis.resize();\r\n\t}\r\n});\r\n\r\ndojo.declare(\"dojox.widget.ExpandableFeedPortlet\", dojox.widget.FeedPortlet, {\r\n\t// summary:\r\n\t//\t\tA FeedPortlet that uses an list of expandable links to display\r\n\t//\t\ta feed.\tAn icon is placed to the left of each item\r\n\t//\t\twhich, when clicked, toggles the visible state\r\n\t//\t\tof the item summary.\r\n\r\n\t// onlyOpenOne: Boolean\r\n\t//\t\tIf true, only a single item can be expanded at any given time.\r\n\tonlyOpenOne: false,\r\n\r\n\tgenerateResults: function(items){\r\n\t\t// summary:\r\n\t\t//\t\tGenerates a list of items, and places an icon beside them that\r\n\t\t//\t\tcan be used to show or hide a summary of that item.\r\n\r\n\t\tvar store = this.store;\r\n\t\tvar iconCls = \"dojoxPortletToggleIcon\";\r\n\t\tvar collapsedCls = \"dojoxPortletItemCollapsed\";\r\n\t\tvar expandedCls = \"dojoxPortletItemOpen\";\r\n\r\n\t\tvar timer;\r\n\t\tvar ul = (this._resultList = dojo.create(\"ul\", {\r\n\t\t\t\"class\": \"dojoxFeedPortletExpandableList\"\r\n\t\t}, this.containerNode));\r\n\r\n\t\t// Create the LI elements.\tEach LI has two DIV elements, the\r\n\t\t// top DIV contains the toggle icon and title, and the bottom\r\n\t\t// div contains the extended summary.\r\n\t\tdojo.forEach(items, dojo.hitch(this, dojo.hitch(this, function(item){\r\n\t\t\tvar li = dojo.create(\"li\", {\"class\": collapsedCls}, ul);\r\n\t\t\tvar upper = dojo.create(\"div\", {style: \"width: 100%;\"}, li);\r\n\t\t\tvar lower = dojo.create(\"div\", {\"class\": \"dojoxPortletItemSummary\", innerHTML: this._getContent(item)}, li);\r\n\t\t\tdojo.create(\"span\", {\r\n\t\t\t\t\"class\": iconCls,\r\n\t\t\t\tinnerHTML: \"<img src='\" + dojo.config.baseUrl + \"/resources/blank.gif'>\"}, upper);\r\n\t\t\tvar a = dojo.create(\"a\", {href: this._getLink(item), innerHTML: this._getTitle(item) }, upper);\r\n\r\n\t\t\tif(this.openNew){\r\n\t\t\t\tdojo.attr(a, \"target\", \"_blank\");\r\n\t\t\t}\r\n\t\t})));\r\n\r\n\t\t// Catch all clicks on the list. If a toggle icon is clicked,\r\n\t\t// toggle the visible state of the summary DIV.\r\n\t\tdojo.connect(ul, \"onclick\", dojo.hitch(this, function(evt){\r\n\t\t\tif(dojo.hasClass(evt.target, iconCls) || dojo.hasClass(evt.target.parentNode, iconCls)){\r\n\t\t\t\tdojo.stopEvent(evt);\r\n\t\t\t\tvar li = evt.target.parentNode;\r\n\t\t\t\twhile(li.tagName != \"LI\"){\r\n\t\t\t\t\tli = li.parentNode;\r\n\t\t\t\t}\r\n\t\t\t\tif(this.onlyOpenOne){\r\n\t\t\t\t\tdojo.query(\"li\", ul).filter(function(item){\r\n\t\t\t\t\t\treturn item != li;\r\n\t\t\t\t\t}).removeClass(expandedCls).addClass(collapsedCls);\r\n\t\t\t\t}\r\n\t\t\t\tvar isExpanded = dojo.hasClass(li, expandedCls);\r\n\t\t\t\tdojo.toggleClass(li, expandedCls, !isExpanded);\r\n\t\t\t\tdojo.toggleClass(li, collapsedCls, isExpanded);\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n});\r\n\r\n\r\ndojo.declare(\"dojox.widget.PortletFeedSettings\",\r\n\tdojox.widget.PortletSettings, {\r\n\r\n\t// summary:\r\n\t//\t\tA Settings widget designed to be used with a dojox.widget.FeedPortlet\r\n\t// description:\r\n\t//\t\tIt provides form items that the user can use to change the URL\r\n\t//\t\tfor a feed to load into the FeedPortlet.\r\n\t//\t\tThere are two forms that it can take.\r\n\t//\r\n\t//\t\tThe first is to display a text field, with Load and Cancel buttons,\r\n\t//\t\twhich is prepopulated with the enclosing FeedPortlet's URL.\r\n\t//\t\tIf a `<select>` DOM node is used as the source node for this widget,\r\n\t//\t\tit displays a list of predefined URLs that the user can select from\r\n\t//\t\tto load into the enclosing FeedPortlet.\r\n\t//\r\n\t// example:\r\n\t// |\t<div dojoType=\"dojox.widget.PortletFeedSettings\"></div>\r\n\t//\r\n\t// example:\r\n\t// |\t<select dojoType=\"dojox.widget.PortletFeedSettings\">\r\n\t// |\t\t<option>http://www.dojotoolkit.org/aggregator/rss</option>\r\n\t// |\t\t<option>http://dojocampus.org/content/category/podcast/feed/</option>\r\n\t// |\t</select>\r\n\r\n\t\"class\" : \"dojoxPortletFeedSettings\",\r\n\r\n\t// urls: Array\r\n\t//\t\tAn array of JSON object specifying URLs to display in the\r\n\t//\t\tPortletFeedSettings object. Each object contains a 'url' and 'label'\r\n\t//\t\tattribute, e.g.\r\n\t//\t\t[{url:'http:google.com', label:'Google'}, {url:'http://dojotoolkit.org', label: 'Dojo'}]\r\n\turls: null,\r\n\r\n\t// selectedIndex: Number\r\n\t//\t\tThe selected URL. Defaults to zero.\r\n\tselectedIndex: 0,\r\n\r\n\tbuildRendering: function(){\r\n\t\t// If JSON URLs have been specified, create a SELECT DOM node,\r\n\t\t// and insert the required OPTION elements.\r\n\t\tvar s;\r\n\t\tif(this.urls && this.urls.length > 0){\r\n\t\t\tconsole.log(this.id + \" -> creating select with urls \", this.urls)\r\n\t\t\ts = dojo.create(\"select\");\r\n\t\t\tif(this.srcNodeRef){\r\n\t\t\t\tdojo.place(s, this.srcNodeRef, \"before\");\r\n\t\t\t\tdojo.destroy(this.srcNodeRef);\r\n\t\t\t}\r\n\t\t\tthis.srcNodeRef = s;\r\n\t\t\tdojo.forEach(this.urls, function(url){\r\n\t\t\t\tdojo.create(\"option\", {value: url.url || url, innerHTML: url.label || url}, s);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// If the srcNodeRef is a SELECT node, then replace it with a DIV, and insert\r\n\t\t// the SELECT node into that div.\r\n\t\tif(this.srcNodeRef.tagName == \"SELECT\"){\r\n\t\t\tthis.text = this.srcNodeRef;\r\n\t\t\tvar div = dojo.create(\"div\", {}, this.srcNodeRef, \"before\");\r\n\t\t\tdiv.appendChild(this.text);\r\n\t\t\tthis.srcNodeRef = div;\r\n\t\t\tdojo.query(\"option\", this.text).filter(\"return !item.value;\").forEach(\"item.value = item.innerHTML\");\r\n\t\t\tif(!this.text.value){\r\n\t\t\t\tif(this.content && this.text.options.length == 0){\r\n\t\t\t\t\tthis.text.appendChild(this.content);\r\n\t\t\t\t}\r\n\t\t\t\tdojo.attr(s || this.text, \"value\", this.text.options[this.selectedIndex].value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\r\n\t_setContentAttr: function(){\r\n\r\n\t},\r\n\r\n\tpostCreate: function(){\r\n\t\tconsole.log(this.id + \" -> postCreate\");\r\n\t\tif(!this.text){\r\n\t\t\t// If a select node is not being used, create a new TextBox to\r\n\t\t\t// edit the URL.\r\n\t\t\tvar text = this.text = new dijit.form.TextBox({});\r\n\t\t\tdojo.create(\"span\", {\r\n\t\t\t\tinnerHTML: \"Choose Url: \"\r\n\t\t\t}, this.domNode);\r\n\t\t\tthis.addChild(text);\r\n\t\t}\r\n\r\n\t\t// Add a LOAD button\r\n\t\tthis.addChild(new dijit.form.Button({\r\n\t\t\tlabel: \"Load\",\r\n\t\t\tonClick: dojo.hitch(this, function(){\r\n\t\t\t\t// Set the URL of the containing Portlet with the selected URL.\r\n\t\t\t\tthis.portlet.attr(\"url\",\r\n\t\t\t\t\t(this.text.tagName == \"SELECT\") ? this.text.value : this.text.attr('value'));\r\n\t\t\t\tif(this.text.tagName == \"SELECT\"){\r\n\t\t\t\t\t// Set the selected index on the Select node.\r\n\t\t\t\t\tdojo.some(this.text.options, dojo.hitch(this, function(opt, idx){\r\n\t\t\t\t\t\tif(opt.selected){\r\n\t\t\t\t\t\t\tthis.set(\"selectedIndex\", idx);\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t\t// Hide the widget.\r\n\t\t\t\tthis.toggle();\r\n\t\t\t})\r\n\t\t}));\r\n\r\n\t\t// Add a CANCEL button, which hides this widget\r\n\t\tthis.addChild(new dijit.form.Button({\r\n\t\t\tlabel: \"Cancel\",\r\n\t\t\tonClick: dojo.hitch(this, \"toggle\")\r\n\t\t}));\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\r\n\tstartup: function(){\r\n\t\t// summary:\r\n\t\t//\t\tSets the portlet associated with this PortletSettings object.\r\n\t\tif(this._started){return;}\r\n\t\tconsole.log(this.id + \" -> startup\");\r\n\t\tthis.inherited(arguments);\r\n\r\n\t\tif(!this.portlet){\r\n\t\t\tthrow Error(this.declaredClass + \": A PortletFeedSettings widget cannot exist without a Portlet.\");\r\n\t\t}\r\n\t\tif(this.text.tagName == \"SELECT\"){\r\n\t\t\t// Set the initial selected option.\r\n\t\t\tdojo.forEach(this.text.options, dojo.hitch(this, function(opt, index){\r\n\t\t\t\tdojo.attr(opt, \"selected\", index == this.selectedIndex);\r\n\t\t\t}));\r\n\t\t}\r\n\t\tvar url = this.portlet.attr(\"url\");\r\n\t\tif(url){\r\n\t\t\t// If a SELECT node is used to choose a URL, ensure that the Portlet's URL\r\n\t\t\t// is one of the options.\r\n\t\t\tif(this.text.tagName == \"SELECT\"){\r\n\t\t\t\tif(!this.urls && dojo.query(\"option[value='\" + url + \"']\", this.text).length < 1){\r\n\t\t\t\t\tdojo.place(dojo.create(\"option\", {\r\n\t\t\t\t\t\tvalue: url,\r\n\t\t\t\t\t\tinnerHTML: url,\r\n\t\t\t\t\t\tselected: \"true\"\r\n\t\t\t\t\t}), this.text, \"first\");\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tthis.text.attr(\"value\", url);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tthis.portlet.attr(\"url\", this.get(\"feedPortletUrl\"));\r\n\t\t}\r\n\t},\r\n\r\n\t_getFeedPortletUrlAttr: function(){\r\n\t\treturn this.text.value;\r\n\t}\r\n});"]}