{"version":3,"sources":["sketch/SingleArrowAnnotation.js"],"names":["define","dojo","getObject","dojox","ta","sketch","SingleArrowAnnotation","figure","id","Annotation","call","this","transform","dx","dy","start","x","y","control","end","textPosition","textOffset","textYOffset","rotation","pathShape","arrowhead","arrowheadGroup","labelShape","anchors","Anchor","prototype","p","constructor","type","getType","_rot","opp","adj","Math","atan2","_pos","offset","slope","calculate","textAlign","abs","apply","obj","documentElement","readCommonAttrs","i","childNodes","length","c","localName","property","nodeValue","d","getAttribute","split","s","parseFloat","substr","stroke","style","m","match","color","width","initialize","labelFont","rot","gfx","matrix","rotate","shape","group","createGroup","getEventSource","setAttribute","createPath","createText","text","align","draw","destroy","remove","tRot","setTransform","setShape","applyTransform","setFill","zoom","pct","zoomFactor","_curPct","l","floor","w","h","getBBox","min","max","height","serialize","r","PI","round","pow","writeCommonAttrs","register"],"mappings":"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","file":"../../sketch/SingleArrowAnnotation.js","sourcesContent":["define([\"dojo/_base/kernel\", \"dojo/_base/lang\", \"./Annotation\", \"./Anchor\"], function(dojo){\r\n\tdojo.getObject(\"sketch\", true, dojox);\r\n\r\n\tvar ta=dojox.sketch;\r\n\tta.SingleArrowAnnotation=function(figure, id){\r\n\t\tta.Annotation.call(this, figure, id);\r\n\t\tthis.transform={ dx:0, dy:0 };\r\n\t\tthis.start={x:0, y:0};\r\n\t\tthis.control={x:100, y:-50};\r\n\t\tthis.end={x:200, y:0};\r\n\t\tthis.textPosition={ x:0, y:0 };\r\n\t\tthis.textOffset=4;\r\n\t\t//this.textAlign=\"middle\";\r\n\t\tthis.textYOffset=10;\r\n\t\tthis.rotation=0;\r\n\r\n//\t\tthis.property('label',this.id);\r\n//\t\tthis.label=this.id;\r\n\t\tthis.pathShape=null;\r\n\t\tthis.arrowhead=null;\r\n\t\tthis.arrowheadGroup=null;\r\n\t\tthis.labelShape=null;\r\n\r\n\t\tthis.anchors.start=new ta.Anchor(this, \"start\");\r\n\t\tthis.anchors.control=new ta.Anchor(this, \"control\");\r\n\t\tthis.anchors.end=new ta.Anchor(this, \"end\");\r\n\t};\r\n\tta.SingleArrowAnnotation.prototype=new ta.Annotation;\r\n\tvar p=ta.SingleArrowAnnotation.prototype;\r\n\tp.constructor=ta.SingleArrowAnnotation;\r\n\r\n\tp.type=function(){ return 'SingleArrow'; };\r\n\tp.getType=function(){ return ta.SingleArrowAnnotation; };\r\n\r\n\t//\thelper functions\r\n\tp._rot=function(){\r\n\t\t//\tarrowhead rotation\r\n\t\tvar opp=this.control.y-this.start.y;\r\n\t\tvar adj=this.control.x-this.start.x;\r\n\t\t//if(!adj){ adj=1; }\r\n\t\tthis.rotation=Math.atan2(opp,adj);\r\n\t};\r\n\tp._pos=function(){\r\n\t\t//\ttext position\r\n\t\tvar offset=this.textOffset, x=0, y=0;\r\n\t\tvar slope=this.calculate.slope(this.control, this.end);\r\n\t\tthis.textAlign=\"middle\";\r\n\t\tif(Math.abs(slope)>=1){\r\n\t\t\tx=this.end.x+this.calculate.dx(this.control, this.end, offset);\r\n\t\t\tif(this.control.y>this.end.y){ y=this.end.y-offset; }\r\n\t\t\telse{ y=this.end.y+offset+this.textYOffset; }\r\n\t\t} else if(slope==0){\r\n\t\t\tx=this.end.x+offset;\r\n\t\t\ty=this.end.y+this.textYOffset;\r\n\t\t} else {\r\n\t\t\tif(this.start.x>this.end.x){\r\n\t\t\t\tx=this.end.x-offset;\r\n\t\t\t\tthis.textAlign=\"end\";\r\n\t\t\t} else {\r\n\t\t\t\tx=this.end.x+offset;\r\n\t\t\t\tthis.textAlign=\"start\";\r\n\t\t\t}\r\n\t\t\tif(this.start.y<this.end.y){\r\n\t\t\t\ty=this.end.y+this.calculate.dy(this.control, this.end, offset)+this.textYOffset;\r\n\t\t\t} else {\r\n\t\t\t\ty=this.end.y+this.calculate.dy(this.control, this.end, -offset);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.textPosition={ x:x, y:y };\r\n\t};\r\n\t\r\n\tp.apply=function(obj){\r\n\t\tif(!obj){ return; }\r\n\t\tif(obj.documentElement){ obj=obj.documentElement; }\r\n\t\tthis.readCommonAttrs(obj);\r\n\t\t\r\n\t\tfor(var i=0; i<obj.childNodes.length; i++){\r\n\t\t\tvar c=obj.childNodes[i];\r\n\t\t\tif(c.localName==\"text\"){\r\n\t\t\t\tthis.property('label',c.childNodes.length?c.childNodes[0].nodeValue:'');\r\n\t\t\t}\r\n\t\t\telse if(c.localName==\"path\"){\r\n\t\t\t\t//\tthe line\r\n\t\t\t\tvar d=c.getAttribute('d').split(\" \");\r\n\t\t\t\tvar s=d[0].split(\",\");\r\n\t\t\t\tthis.start.x=parseFloat(s[0].substr(1),10);\r\n\t\t\t\tthis.start.y=parseFloat(s[1],10);\r\n\t\t\t\ts=d[1].split(\",\");\r\n\t\t\t\tthis.control.x=parseFloat(s[0].substr(1),10);\r\n\t\t\t\tthis.control.y=parseFloat(s[1],10);\r\n\t\t\t\ts=d[2].split(\",\");\r\n\t\t\t\tthis.end.x=parseFloat(s[0],10);\r\n\t\t\t\tthis.end.y=parseFloat(s[1],10);\r\n\t\t\t\tvar stroke=this.property('stroke');\r\n\t\t\t\tvar style=c.getAttribute('style');\r\n\t\t\t\tvar m=style.match(/stroke:([^;]+);/);\r\n\t\t\t\tif(m){\r\n\t\t\t\t\tstroke.color=m[1];\r\n\t\t\t\t\tthis.property('fill',m[1]);\r\n\t\t\t\t}\r\n\t\t\t\tm=style.match(/stroke-width:([^;]+);/);\r\n\t\t\t\tif(m){\r\n\t\t\t\t\tstroke.width=m[1];\r\n\t\t\t\t}\r\n\t\t\t\tthis.property('stroke',stroke);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tp.initialize=function(obj){\r\n\t\t//\tcreate, based on passed DOM node if available.\r\n\t\tvar font=(ta.Annotation.labelFont)?ta.Annotation.labelFont:{family:\"Times\", size:\"16px\"};\r\n\t\tthis.apply(obj);\r\n\r\n\t\t//\tcalculate the other positions\r\n\t\tthis._rot();\r\n\t\tthis._pos();\r\n\r\n\t\t//\trotation matrix\r\n\t\tvar rot=this.rotation;\r\n\t\tvar tRot=dojox.gfx.matrix.rotate(rot);\r\n\r\n\t\t//\tdraw the shapes\r\n\t\tthis.shape=this.figure.group.createGroup();\r\n\t\tthis.shape.getEventSource().setAttribute(\"id\", this.id);\r\n\t\t//if(this.transform.dx||this.transform.dy){ this.shape.setTransform(this.transform); }\r\n\r\n\t\tthis.pathShape=this.shape.createPath(\"M\"+this.start.x+\",\"+this.start.y+\" Q\"+this.control.x+\",\"+this.control.y+\" \"+this.end.x+\",\"+this.end.y+\" l0,0\")\r\n\t\t\t//.setStroke(this.property('stroke'));\r\n\r\n\t\tthis.arrowheadGroup=this.shape.createGroup();//.setTransform({ dx:this.start.x, dy:this.start.y }).applyTransform(tRot);\r\n\t\tthis.arrowhead=this.arrowheadGroup.createPath();//\"M0,0 l50,-10 -6,10 6,10 Z\").setFill(this.property('fill'));\r\n\r\n\t\tthis.labelShape=this.shape.createText({\r\n\t\t\t\tx:this.textPosition.x,\r\n\t\t\t\ty:this.textPosition.y,\r\n\t\t\t\ttext:this.property('label'),\r\n\t\t\t\talign:this.textAlign\r\n\t\t\t})\r\n\t\t\t//.setFont(font)\r\n\t\t\t//.setFill(this.property('fill'));\r\n\t\tthis.labelShape.getEventSource().setAttribute('id',this.id+\"-labelShape\");\r\n\t\tthis.draw();\r\n\t};\r\n\r\n\tp.destroy=function(){\r\n\t\tif(!this.shape){ return; }\r\n\t\tthis.arrowheadGroup.remove(this.arrowhead);\r\n\t\tthis.shape.remove(this.arrowheadGroup);\r\n\t\tthis.shape.remove(this.pathShape);\r\n\t\tthis.shape.remove(this.labelShape);\r\n\t\tthis.figure.group.remove(this.shape);\r\n\t\tthis.shape=this.pathShape=this.labelShape=this.arrowheadGroup=this.arrowhead=null;\r\n\t};\r\n\r\n\tp.draw=function(obj){\r\n\t\tthis.apply(obj);\r\n\t\tthis._rot();\r\n\t\tthis._pos();\r\n\r\n\t\t//\trotation matrix\r\n\t\tvar rot=this.rotation;\r\n\t\tvar tRot=dojox.gfx.matrix.rotate(rot);\r\n\r\n\t\tthis.shape.setTransform(this.transform);\r\n\t\tthis.pathShape.setShape(\"M\"+this.start.x+\",\"+this.start.y+\" Q\"+this.control.x+\",\"+this.control.y+\" \"+this.end.x+\",\"+this.end.y+\" l0,0\")\r\n\t\t\t//.setStroke(this.property('stroke'));\r\n\r\n\t\tthis.arrowheadGroup.setTransform({dx:this.start.x,dy:this.start.y}).applyTransform(tRot);\r\n\t\tthis.arrowhead.setFill(this.property('fill'));\r\n\r\n\t\tthis.labelShape.setShape({\r\n\t\t\t\tx:this.textPosition.x,\r\n\t\t\t\ty:this.textPosition.y,\r\n\t\t\t\ttext:this.property('label'),\r\n\t\t\t\talign:this.textAlign\r\n\t\t\t})\r\n\t\t\t.setFill(this.property('fill'));\r\n\t\tthis.zoom();\r\n\t};\r\n\r\n\tp.zoom=function(pct){\r\n\t\tif(this.arrowhead){\r\n\t\t\tpct = pct || this.figure.zoomFactor;\r\n\t\t\tta.Annotation.prototype.zoom.call(this,pct);\r\n\t\t\t//pct = dojox.gfx.renderer=='vml'?1:pct;\r\n\t\t\tif(this._curPct!==pct){\r\n\t\t\t\tthis._curPct=pct;\r\n\t\t\t\tvar l=pct>1?20:Math.floor(20/pct), w=pct>1?5:Math.floor(5/pct),h=pct>1?3:Math.floor(3/pct);\r\n\t\t\t\tthis.arrowhead.setShape(\"M0,0 l\"+l+\",-\"+w+\" -\"+h+\",\"+w+\" \"+h+\",\"+w+\" Z\");\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tp.getBBox=function(){\r\n\t\tvar x=Math.min(this.start.x, this.control.x, this.end.x);\r\n\t\tvar y=Math.min(this.start.y, this.control.y, this.end.y);\r\n\t\tvar w=Math.max(this.start.x, this.control.x, this.end.x)-x;\r\n\t\tvar h=Math.max(this.start.y, this.control.y, this.end.y)-y;\r\n\t\treturn { x:x, y:y, width:w, height:h };\r\n\t};\r\n\r\n\tp.serialize=function(){\r\n\t\tvar s=this.property('stroke');\r\n\t\tvar r=this.rotation*(180/Math.PI);\r\n\t\tr=Math.round(r*Math.pow(10,4))/Math.pow(10,4);\r\n\t\treturn '<g '+this.writeCommonAttrs()+'>'\r\n\t\t\t+ '<path style=\"stroke:'+s.color+';stroke-width:'+s.width+';fill:none;\" d=\"'\r\n\t\t\t+ \"M\"+this.start.x+\",\"+this.start.y+\" \"\r\n\t\t\t+ \"Q\"+this.control.x+\",\"+this.control.y+\" \"\r\n\t\t\t+ this.end.x+\",\"+this.end.y\r\n\t\t\t+ '\" />'\r\n\t\t\t+ '<g transform=\"translate(' + this.start.x + \",\" + this.start.y + \") \"\r\n\t\t\t+ 'rotate(' + r + ')\">'\r\n\t\t\t+ '<path style=\"fill:'+s.color+';\" d=\"M0,0 l20,-5, -3,5, 3,5 Z\" />'\r\n\t\t\t+ '</g>'\r\n\t\t\t+ '<text style=\"fill:'+s.color+';text-anchor:'+this.textAlign+'\" font-weight=\"bold\" '\r\n\t\t\t+ 'x=\"' + this.textPosition.x + '\" '\r\n\t\t\t+ 'y=\"' + this.textPosition.y + '\">'\r\n\t\t\t+ this.property('label')\r\n\t\t\t+ '</text>'\r\n\t\t\t+ '</g>';\r\n\t};\r\n\r\n\tta.Annotation.register(\"SingleArrow\");\r\n\treturn dojox.sketch.SingleArrowAnnotation;\r\n});\r\n"]}