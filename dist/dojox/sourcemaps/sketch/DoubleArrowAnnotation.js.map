{"version":3,"sources":["sketch/DoubleArrowAnnotation.js"],"names":["define","dojo","getObject","dojox","ta","sketch","console","log","DoubleArrowAnnotation","figure","id","Annotation","call","this","transform","dx","dy","start","x","y","control","end","textPosition","textOffset","textYOffset","textAlign","startRotation","endRotation","labelShape","pathShape","startArrow","startArrowGroup","endArrow","endArrowGroup","anchors","Anchor","prototype","p","constructor","type","getType","_rot","opp","adj","Math","atan2","_pos","offset","ab","bc","apply","obj","documentElement","readCommonAttrs","i","childNodes","length","c","localName","property","nodeValue","d","getAttribute","split","s","parseFloat","substr","stroke","style","m","match","color","width","initialize","labelFont","rot","startRot","gfx","matrix","rotate","endRot","rotateAt","shape","group","createGroup","getEventSource","setAttribute","createPath","setTransform","applyTransform","createText","text","align","setFill","draw","destroy","remove","setShape","zoom","pct","zoomFactor","l","floor","w","h","getBBox","min","max","height","serialize","writeCommonAttrs","round","PI","pow","register"],"mappings":"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","file":"../../sketch/DoubleArrowAnnotation.js","sourcesContent":["define([\"dojo/_base/kernel\", \"dojo/_base/lang\", \"./Annotation\", \"./Anchor\"], function(dojo){\r\n\tdojo.getObject(\"sketch\", true, dojox);\r\n\tvar ta=dojox.sketch;\r\n\tconsole.log(ta);\r\n\tta.DoubleArrowAnnotation=function(figure, id){\r\n\t\tta.Annotation.call(this, figure, id);\r\n\t\tthis.transform={ dx:0, dy:0 };\r\n\t\tthis.start={x:0, y:0};\r\n\t\tthis.control={x:100, y:-50};\r\n\t\tthis.end={x:200, y:0};\r\n\t\tthis.textPosition={ x:0, y:0 };\r\n\t\tthis.textOffset=6;\r\n\t\tthis.textYOffset=10;\r\n\t\tthis.textAlign=\"middle\";\r\n\t\tthis.startRotation=0;\r\n\t\tthis.endRotation=0;\r\n\r\n//\t\tthis.property('label',this.id);\r\n\t\tthis.labelShape=null;\r\n\t\tthis.pathShape=null;\r\n\t\tthis.startArrow=null;\r\n\t\tthis.startArrowGroup=null;\r\n\t\tthis.endArrow=null;\r\n\t\tthis.endArrowGroup=null;\r\n\r\n\t\tthis.anchors.start=new ta.Anchor(this, \"start\");\r\n\t\tthis.anchors.control=new ta.Anchor(this, \"control\");\r\n\t\tthis.anchors.end=new ta.Anchor(this, \"end\");\r\n\t};\r\n\tta.DoubleArrowAnnotation.prototype=new ta.Annotation;\r\n\tvar p=ta.DoubleArrowAnnotation.prototype;\r\n\tp.constructor=ta.DoubleArrowAnnotation;\r\n\r\n\tp.type=function(){ return 'DoubleArrow'; };\r\n\tp.getType=function(){ return ta.DoubleArrowAnnotation; };\r\n\r\n\tp._rot=function(){\r\n\t\t//\tarrowhead rotation\r\n\t\tvar opp=this.control.y-this.start.y;\r\n\t\tvar adj=this.control.x-this.start.x;\r\n\t\tthis.startRotation=Math.atan2(opp,adj);\r\n\r\n\t\topp=this.end.y-this.control.y;\r\n\t\tadj=this.end.x-this.control.x;\r\n\t\tthis.endRotation=Math.atan2(opp,adj);\r\n\t};\r\n\tp._pos=function(){\r\n\t\t//\ttext position\r\n\t\tvar offset=this.textOffset;\r\n\r\n\t\t//\tfigure out the pull of the curve and place accordingly\r\n\t\tif(this.control.y<this.end.y){ offset*=-1; }\r\n\t\telse { offset+=this.textYOffset; }\r\n\t\tvar ab={\r\n\t\t\tx:((this.control.x-this.start.x)*.5)+this.start.x,\r\n\t\t\ty:((this.control.y-this.start.y)*.5)+this.start.y\r\n\t\t};\r\n\t\tvar bc={\r\n\t\t\tx:((this.end.x-this.control.x)*.5)+this.control.x,\r\n\t\t\ty:((this.end.y-this.control.y)*.5)+this.control.y\r\n\t\t};\r\n\t\tthis.textPosition={\r\n\t\t\tx:((bc.x-ab.x)*.5)+ab.x,\r\n\t\t\ty:(((bc.y-ab.y)*.5)+ab.y)+offset\r\n\t\t};\r\n\t};\r\n\t\r\n\tp.apply=function(obj){\r\n\t\tif(!obj){ return; }\r\n\t\tif(obj.documentElement){ obj=obj.documentElement; }\r\n\t\tthis.readCommonAttrs(obj);\r\n\t\t\r\n\t\tfor(var i=0; i<obj.childNodes.length; i++){\r\n\t\t\tvar c=obj.childNodes[i];\r\n\t\t\tif(c.localName==\"text\"){ this.property('label',c.childNodes.length?c.childNodes[0].nodeValue:''); }\r\n\t\t\telse if(c.localName==\"path\"){\r\n\t\t\t\t//\tthe line\r\n\t\t\t\tvar d=c.getAttribute('d').split(\" \");\r\n\t\t\t\tvar s=d[0].split(\",\");\r\n\t\t\t\tthis.start.x=parseFloat(s[0].substr(1),10);\r\n\t\t\t\tthis.start.y=parseFloat(s[1],10);\r\n\t\t\t\ts=d[1].split(\",\");\r\n\t\t\t\tthis.control.x=parseFloat(s[0].substr(1),10);\r\n\t\t\t\tthis.control.y=parseFloat(s[1],10);\r\n\t\t\t\ts=d[2].split(\",\");\r\n\t\t\t\tthis.end.x=parseFloat(s[0],10);\r\n\t\t\t\tthis.end.y=parseFloat(s[1],10);\r\n\t\t\t\tvar stroke=this.property('stroke');\r\n\t\t\t\tvar style=c.getAttribute('style');\r\n\t\t\t\tvar m=style.match(/stroke:([^;]+);/);\r\n\t\t\t\tif(m){\r\n\t\t\t\t\tstroke.color=m[1];\r\n\t\t\t\t\tthis.property('fill',m[1]);\r\n\t\t\t\t}\r\n\t\t\t\tm=style.match(/stroke-width:([^;]+);/);\r\n\t\t\t\tif(m){\r\n\t\t\t\t\tstroke.width=m[1];\r\n\t\t\t\t}\r\n\t\t\t\tthis.property('stroke',stroke);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tp.initialize=function(obj){\r\n\t\t//\tcreate, based on passed DOM node if available.\r\n\t\tvar font=(ta.Annotation.labelFont)?ta.Annotation.labelFont:{family:\"Times\", size:\"16px\"};\r\n\t\tthis.apply(obj);\r\n\r\n\t\t//\tcalculate the other positions\r\n\t\tthis._rot();\r\n\t\tthis._pos();\r\n\r\n\t\t//\trotation matrix\r\n\t\tvar rot=this.startRotation;\r\n\t\tvar startRot=dojox.gfx.matrix.rotate(rot);\r\n\r\n\t\trot=this.endRotation;\r\n\t\tvar endRot=dojox.gfx.matrix.rotateAt(rot, this.end.x, this.end.y);\r\n\r\n\t\t//\tdraw the shapes\r\n\t\tthis.shape=this.figure.group.createGroup();\r\n\t\tthis.shape.getEventSource().setAttribute(\"id\", this.id);\r\n\t\t//if(this.transform.dx||this.transform.dy){ this.shape.setTransform(this.transform); }\r\n\r\n\t\tthis.pathShape=this.shape.createPath(\"M\"+this.start.x+\" \"+this.start.y+\"Q\"+this.control.x+\" \"+this.control.y+\" \"+this.end.x+\" \"+this.end.y + \" l0,0\")\r\n\t\t\t//.setStroke(this.property('stroke'));\r\n\t\t\r\n\t\tthis.startArrowGroup=this.shape.createGroup().setTransform({ dx:this.start.x, dy:this.start.y });\r\n\t\tthis.startArrowGroup.applyTransform(startRot);\r\n\t\tthis.startArrow=this.startArrowGroup.createPath();//\"M0,0 l20,-5 -3,5 3,5 Z\").setFill(this.property('fill'));\r\n\t\t\r\n\t\tthis.endArrowGroup=this.shape.createGroup().setTransform(endRot);\r\n\t\tthis.endArrow=this.endArrowGroup.createPath();//(\"M\" + this.end.x + \",\" + this.end.y + \" l-20,-5 3,5 -3,5 Z\").setFill(this.property('fill'));\r\n\r\n\t\tthis.labelShape=this.shape.createText({\r\n\t\t\t\tx:this.textPosition.x,\r\n\t\t\t\ty:this.textPosition.y,\r\n\t\t\t\ttext:this.property('label'),\r\n\t\t\t\talign:this.textAlign\r\n\t\t\t})\r\n\t\t\t//.setFont(font)\r\n\t\t\t.setFill(this.property('fill'));\r\n\t\tthis.labelShape.getEventSource().setAttribute('id',this.id+\"-labelShape\");\r\n\t\tthis.draw();\r\n\t};\r\n\tp.destroy=function(){\r\n\t\tif(!this.shape){ return; }\r\n\t\tthis.startArrowGroup.remove(this.startArrow);\r\n\t\tthis.endArrowGroup.remove(this.endArrow);\r\n\t\tthis.shape.remove(this.startArrowGroup);\r\n\t\tthis.shape.remove(this.endArrowGroup);\r\n\t\tthis.shape.remove(this.pathShape);\r\n\t\tthis.shape.remove(this.labelShape);\r\n\t\tthis.figure.group.remove(this.shape);\r\n\t\tthis.shape=this.pathShape=this.labelShape=this.startArrowGroup=this.startArrow=this.endArrowGroup=this.endArrow=null;\r\n\t};\r\n\tp.draw=function(obj){\r\n\t\tthis.apply(obj);\r\n\t\tthis._rot();\r\n\t\tthis._pos();\r\n\r\n\t\t//\trotation matrix\r\n\t\tvar rot=this.startRotation;\r\n\t\tvar startRot=dojox.gfx.matrix.rotate(rot);\r\n\t\trot=this.endRotation;\r\n\t\tvar endRot=dojox.gfx.matrix.rotateAt(rot, this.end.x, this.end.y);\r\n\r\n\t\tthis.shape.setTransform(this.transform);\r\n\t\tthis.pathShape.setShape(\"M\"+this.start.x+\" \"+this.start.y+\" Q\"+this.control.x+\" \"+this.control.y+\" \"+this.end.x+\" \"+this.end.y + \" l0,0\")\r\n\t\t\t//.setStroke(this.property('stroke'));\r\n\t\tthis.startArrowGroup.setTransform({ dx:this.start.x, dy:this.start.y }).applyTransform(startRot);\r\n\t\tthis.startArrow.setFill(this.property('fill'));\r\n\t\t\r\n\t\tthis.endArrowGroup.setTransform(endRot);\r\n\t\tthis.endArrow.setFill(this.property('fill'));\r\n\t\tthis.labelShape.setShape({\r\n\t\t\t\tx:this.textPosition.x,\r\n\t\t\t\ty:this.textPosition.y,\r\n\t\t\t\ttext:this.property('label')\r\n\t\t\t})\r\n\t\t\t.setFill(this.property('fill'));\r\n\t\tthis.zoom();\r\n\t};\r\n\r\n\tp.zoom=function(pct){\r\n\t\tif(this.startArrow){\r\n\t\t\tpct = pct || this.figure.zoomFactor;\r\n\t\t\tta.Annotation.prototype.zoom.call(this,pct);\r\n\r\n\t\t\tvar l=pct>1?20:Math.floor(20/pct), w=pct>1?5:Math.floor(5/pct),h=pct>1?3:Math.floor(3/pct);\r\n\t\t\tthis.startArrow.setShape(\"M0,0 l\"+l+\",-\"+w+\" -\"+h+\",\"+w+\" \"+h+\",\"+w+\" Z\");//.setFill(this.property('fill'));\r\n\r\n\t\t\tthis.endArrow.setShape(\"M\" + this.end.x + \",\" + this.end.y + \" l-\"+l+\",-\"+w+\" \"+h+\",\"+w+\" -\"+h+\",\"+w+\" Z\");\r\n\t\t}\r\n\t};\r\n\t\r\n\tp.getBBox=function(){\r\n\t\tvar x=Math.min(this.start.x, this.control.x, this.end.x);\r\n\t\tvar y=Math.min(this.start.y, this.control.y, this.end.y);\r\n\t\tvar w=Math.max(this.start.x, this.control.x, this.end.x)-x;\r\n\t\tvar h=Math.max(this.start.y, this.control.y, this.end.y)-y;\r\n\t\treturn { x:x, y:y, width:w, height:h };\r\n\t};\r\n\r\n\tp.serialize=function(){\r\n\t\tvar s=this.property('stroke');\r\n\t\treturn '<g '+this.writeCommonAttrs()+'>'\r\n\t\t\t+ '<path style=\"stroke:'+s.color+';stroke-width:'+s.width+';fill:none;\" d=\"'\r\n\t\t\t+ \"M\"+this.start.x+\",\"+this.start.y+\" \"\r\n\t\t\t+ \"Q\"+this.control.x+\",\"+this.control.y+\" \"\r\n\t\t\t+ this.end.x+\",\"+this.end.y\r\n\t\t\t+ '\" />'\r\n\t\t\t+ '<g transform=\"translate(' + this.start.x + \",\" + this.start.y + \") \"\r\n\t\t\t+ 'rotate(' + (Math.round((this.startRotation*(180/Math.PI))*Math.pow(10,4))/Math.pow(10,4)) + ')\">'\r\n\t\t\t+ '<path style=\"fill:'+s.color+';\" d=\"M0,0 l20,-5, -3,5, 3,5 Z\" />'\r\n\t\t\t+ '</g>'\r\n\t\t\t+ '<g transform=\"rotate('\r\n\t\t\t+ (Math.round((this.endRotation*(180/Math.PI))*Math.pow(10,4))/Math.pow(10,4))\r\n\t\t\t+ \", \"+this.end.x+\", \"+this.end.y\r\n\t\t\t+ ')\">'\r\n\t\t\t+ '<path style=\"fill:'+s.color+';\" d=\"M'+this.end.x+\",\"+this.end.y+' l-20,-5, 3,5, -3,5 Z\" />'\r\n\t\t\t+ '</g>'\r\n\t\t\t+ '<text style=\"fill:'+s.color+';text-anchor:'+this.textAlign+'\" font-weight=\"bold\" '\r\n\t\t\t+ 'x=\"' + this.textPosition.x + '\" '\r\n\t\t\t+ 'y=\"' + this.textPosition.y + '\">'\r\n\t\t\t+ this.property('label')\r\n\t\t\t+ '</text>'\r\n\t\t\t+ '</g>';\r\n\t};\r\n\r\n\tta.Annotation.register(\"DoubleArrow\");\r\n\treturn dojox.sketch.DoubleArrowAnnotation;\r\n});\r\n"]}