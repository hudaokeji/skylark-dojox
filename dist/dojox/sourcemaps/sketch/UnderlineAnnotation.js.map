{"version":3,"sources":["sketch/UnderlineAnnotation.js"],"names":["define","ta","dojox","sketch","UnderlineAnnotation","figure","id","Annotation","call","this","transform","dx","dy","start","x","y","property","labelShape","lineShape","prototype","p","constructor","type","getType","apply","obj","documentElement","readCommonAttrs","i","childNodes","length","c","localName","nodeValue","m","getAttribute","match","stroke","collor","initialize","shape","group","createGroup","getEventSource","setAttribute","createText","text","decoration","align","createLine","x1","x2","getTextWidth","y1","y2","draw","destroy","remove","getBBox","b","getTextBox","z","zoomFactor","h","width","w","height","setTransform","setShape","setFill","zoom","pct","textwidthadj","gfx","renderer","setStroke","color","mode","Modes","Edit","drawBBox","serialize","writeCommonAttrs","dojo","declare","AnnotationTool","onMouseDown","onMouseUp","f","_start","_end","_create","onMouseMove","register","UnderlineAnnotationTool"],"mappings":"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","file":"../../sketch/UnderlineAnnotation.js","sourcesContent":["define([\"./Annotation\", \"./Anchor\"], function(){\r\n\tvar ta=dojox.sketch;\r\n\tta.UnderlineAnnotation=function(figure, id){\r\n\t\tta.Annotation.call(this, figure, id);\r\n\t\tthis.transform={dx:0, dy:0};\r\n\t\tthis.start={x:0, y:0};\r\n\t\tthis.property('label','#');\r\n\t\tthis.labelShape=null;\r\n\t\tthis.lineShape=null;\r\n\t\t//this.anchors.start=new ta.Anchor(this, \"start\");\r\n\t};\r\n\tta.UnderlineAnnotation.prototype=new ta.Annotation;\r\n\tvar p=ta.UnderlineAnnotation.prototype;\r\n\tp.constructor=ta.UnderlineAnnotation;\r\n\r\n\tp.type=function(){ return 'Underline'; };\r\n\tp.getType=function(){ return ta.UnderlineAnnotation; };\r\n\r\n\tp.apply=function(obj){\r\n\t\tif(!obj){ return; }\r\n\t\tif(obj.documentElement){ obj=obj.documentElement; }\r\n\t\tthis.readCommonAttrs(obj);\r\n\t\t\r\n\t\tfor(var i=0; i<obj.childNodes.length; i++){\r\n\t\t\tvar c=obj.childNodes[i];\r\n\t\t\tif(c.localName==\"text\"){\r\n\t\t\t\tthis.property('label',c.childNodes[0].nodeValue);\r\n\t\t\t\tvar style=c.getAttribute('style');\r\n\t\t\t\tvar m=style.match(/fill:([^;]+);/);\r\n\t\t\t\tif(m){\r\n\t\t\t\t\tvar stroke=this.property('stroke');\r\n\t\t\t\t\tstroke.collor=m[1];\r\n\t\t\t\t\tthis.property('stroke',stroke);\r\n\t\t\t\t\tthis.property('fill',stroke.collor);\r\n\t\t\t\t}\r\n\t\t\t}/*else if(c.localName==\"line\"){\r\n\t\t\t\tvar stroke=this.property('stroke');\r\n\t\t\t\tvar style=c.getAttribute('style');\r\n\t\t\t\tvar m=style.match(/stroke:([^;]+);/)[1];\r\n\t\t\t\tif(m){\r\n\t\t\t\t\tstroke.color=m;\r\n\t\t\t\t\tthis.property('fill',m);\r\n\t\t\t\t}\r\n\t\t\t\tm=style.match(/stroke-width:([^;]+);/)[1];\r\n\t\t\t\tif(m){\r\n\t\t\t\t\tstroke.width=m;\r\n\t\t\t\t}\r\n\t\t\t\tthis.property('stroke',stroke);\r\n\t\t\t}*/\r\n\t\t}\r\n\t};\r\n\t\r\n\tp.initialize=function(obj){\r\n\t\t//var font=(ta.Annotation.labelFont)?ta.Annotation.labelFont:{family:\"Times\", size:\"16px\"};\r\n\t\tthis.apply(obj);\r\n\r\n\t\t//\tcreate either from scratch or based on the passed node\r\n\t\tthis.shape=this.figure.group.createGroup();\r\n\t\tthis.shape.getEventSource().setAttribute(\"id\", this.id);\r\n\t\t//if(this.transform.dx || this.transform.dy){ this.shape.setTransform(this.transform); }\r\n\r\n\t\tthis.labelShape=this.shape.createText({\r\n\t\t\t\tx:0,\r\n\t\t\t\ty:0,\r\n\t\t\t\ttext:this.property('label'),\r\n\t\t\t\tdecoration:\"underline\",\r\n\t\t\t\talign:\"start\"\r\n\t\t\t})\r\n\t\t\t//.setFont(font)\r\n\t\t\t//.setFill(this.property('fill'));\r\n\t\tthis.labelShape.getEventSource().setAttribute('id',this.id+\"-labelShape\");\r\n\r\n\t\tthis.lineShape=this.shape.createLine({\r\n\t\t\t\tx1:1,\r\n\t\t\t\tx2:this.labelShape.getTextWidth(),\r\n\t\t\t\ty1:2,\r\n\t\t\t\ty2:2\r\n\t\t\t})\r\n\t\t\t//.setStroke({ color:this.property('fill'), width:1 });\r\n\t\tthis.lineShape.getEventSource().setAttribute(\"shape-rendering\",\"crispEdges\");\r\n\t\tthis.draw();\r\n\t};\r\n\tp.destroy=function(){\r\n\t\tif(!this.shape){ return; }\r\n\t\tthis.shape.remove(this.labelShape);\r\n\t\tthis.shape.remove(this.lineShape);\r\n\t\tthis.figure.group.remove(this.shape);\r\n\t\tthis.shape=this.lineShape=this.labelShape=null;\r\n\t};\r\n\tp.getBBox=function(){\r\n\t\tvar b=this.getTextBox();\r\n\t\tvar z=this.figure.zoomFactor;\r\n\r\n\t\treturn { x:0, y:(b.h*-1+4)/z, width:(b.w+2)/z, height:b.h/z };\r\n\t};\r\n\tp.draw=function(obj){\r\n\t\tthis.apply(obj);\r\n\t\tthis.shape.setTransform(this.transform);\r\n\t\tthis.labelShape.setShape({ x:0, y:0, text:this.property('label') })\r\n\t\t\t.setFill(this.property('fill'));\r\n\t\tthis.zoom();\r\n\t};\r\n\tp.zoom=function(pct){\r\n\t\tif(this.labelShape){\r\n\t\t\tpct = pct || this.figure.zoomFactor;\r\n\t\t\tvar textwidthadj=dojox.gfx.renderer=='vml'?0:2/pct;\r\n\t\t\tta.Annotation.prototype.zoom.call(this,pct);\r\n\t\t\tpct = dojox.gfx.renderer=='vml'?1:pct;\r\n\t\t\tthis.lineShape.setShape({ x1:0, x2:this.getBBox().width-textwidthadj, y1:2, y2:2 })\r\n\t\t\t\t.setStroke({ color:this.property('fill'), width:1/pct });\r\n\t\t\tif(this.mode==ta.Annotation.Modes.Edit){\r\n\t\t\t\tthis.drawBBox(); //the bbox is dependent on the size of the text, so need to update it here\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tp.serialize=function(){\r\n\t\tvar s=this.property('stroke');\r\n\t\treturn '<g '+this.writeCommonAttrs()+'>'\r\n\t\t\t//+ '<line x1=\"1\" x2=\"'+this.labelShape.getTextWidth()+1+'\" y1=\"5\" y2=\"5\" style=\"stroke:'+s.color+';stroke-width:'+s.width+';\" />'\r\n\t\t\t+ '<text style=\"fill:'+this.property('fill')+';\" font-weight=\"bold\" text-decoration=\"underline\" '\r\n\t\t\t+ 'x=\"0\" y=\"0\">'\r\n\t\t\t+ this.property('label')\r\n\t\t\t+ '</text>'\r\n\t\t\t+ '</g>';\r\n\t};\r\n    \r\n    //customize AnnotationTool to place a underlilne shape onmouseup, no need\r\n\t//to drag a box (like other shapes)\r\n    dojo.declare(\"dojox.sketch.UnderlineAnnotationTool\", ta.AnnotationTool, {\r\n\t\tonMouseDown: function(){},\r\n\t\tonMouseUp: function(){\r\n\t\t\tvar f=this.figure;\r\n\t\t\tif(!f._start){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//zero out end so that the clickover is shown at the right pos\r\n\t\t\tf._end={x:0,y:0};\r\n\t\t\tthis._create(f._start,{x:f._start.x+10,y:f._start.y+10});\r\n\t\t},\r\n\t\tonMouseMove: function(){}\r\n\t});\r\n\tta.Annotation.register(\"Underline\", ta.UnderlineAnnotationTool);\r\n\treturn dojox.sketch.UnderlineAnnotation;\r\n});\r\n"]}