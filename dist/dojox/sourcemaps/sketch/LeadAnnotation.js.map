{"version":3,"sources":["sketch/LeadAnnotation.js"],"names":["define","dojo","getObject","dojox","ta","sketch","LeadAnnotation","figure","id","Annotation","call","this","transform","dx","dy","start","x","y","control","end","textPosition","textOffset","textYOffset","pathShape","labelShape","anchors","Anchor","prototype","p","constructor","type","getType","_pos","offset","slope","calculate","textAlign","Math","abs","apply","obj","documentElement","readCommonAttrs","i","childNodes","length","c","localName","property","nodeValue","d","getAttribute","split","s","parseFloat","substr","stroke","style","m","match","color","width","initialize","shape","group","createGroup","getEventSource","setAttribute","createPath","createText","text","align","draw","destroy","remove","getBBox","min","max","height","setTransform","setShape","setFill","zoom","serialize","writeCommonAttrs","register"],"mappings":"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","file":"../../sketch/LeadAnnotation.js","sourcesContent":["define([\"dojo/_base/kernel\", \"dojo/_base/lang\", \"./Annotation\", \"./Anchor\"], function(dojo){\r\n\tdojo.getObject(\"sketch\", true, dojox);\r\n\r\n\tvar ta=dojox.sketch;\r\n\tta.LeadAnnotation=function(figure, id){\r\n\t\tta.Annotation.call(this, figure, id);\r\n\t\tthis.transform={dx:0, dy:0 };\r\n\t\tthis.start={ x:0, y:0 };\r\n\t\tthis.control={x:100, y:-50};\r\n\t\tthis.end={ x:200, y:0 };\r\n\t\tthis.textPosition={ x:0, y:0 };\r\n\t\tthis.textOffset=4;\r\n\t\t//this.textAlign=\"middle\";\r\n\t\tthis.textYOffset=10;\r\n\r\n//\t\tthis.property('label',this.id);\r\n\t\tthis.pathShape=null;\r\n\t\tthis.labelShape=null;\r\n\r\n\t\tthis.anchors.start=new ta.Anchor(this, \"start\");\r\n\t\tthis.anchors.control=new ta.Anchor(this, \"control\");\r\n\t\tthis.anchors.end=new ta.Anchor(this, \"end\");\r\n\t};\r\n\tta.LeadAnnotation.prototype=new ta.Annotation;\r\n\tvar p=ta.LeadAnnotation.prototype;\r\n\tp.constructor=ta.LeadAnnotation;\r\n\r\n\tp.type=function(){ return 'Lead'; }\r\n\tp.getType=function(){ return ta.LeadAnnotation; };\r\n\r\n\tp._pos=function(){\r\n\t\tvar offset=this.textOffset, x=0, y=0;\r\n\t\tvar slope=this.calculate.slope(this.control, this.end);\r\n\t\tthis.textAlign=\"middle\";\r\n\t\tif(Math.abs(slope)>=1){\r\n\t\t\tx=this.end.x+this.calculate.dx(this.control, this.end, offset);\r\n\t\t\tif(this.control.y>this.end.y){\r\n\t\t\t\ty=this.end.y-offset;\r\n\t\t\t} else {\r\n\t\t\t\ty=this.end.y+offset+this.textYOffset;\r\n\t\t\t}\r\n\t\t} else if(slope==0){\r\n\t\t\tx=this.end.x+offset;\r\n\t\t\ty=this.end.y+this.textYOffset;\r\n\t\t} else {\r\n\t\t\tif(this.start.x>this.end.x){\r\n\t\t\t\tx=this.end.x-offset;\r\n\t\t\t\tthis.textAlign=\"end\";\r\n\t\t\t} else {\r\n\t\t\t\tx=this.end.x+offset;\r\n\t\t\t\tthis.textAlign=\"start\";\r\n\t\t\t}\r\n\t\t\tif(this.start.y<this.end.y){\r\n\t\t\t\ty=this.end.y+this.calculate.dy(this.control, this.end, offset)+this.textYOffset;\r\n\t\t\t} else {\r\n\t\t\t\ty=this.end.y+this.calculate.dy(this.control, this.end, -offset);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.textPosition={ x:x, y:y };\r\n\t};\r\n\tp.apply=function(obj){\r\n\t\tif(!obj){ return; }\r\n\t\tif(obj.documentElement){ obj=obj.documentElement; }\r\n\t\tthis.readCommonAttrs(obj);\r\n\t\t\r\n\t\tfor(var i=0; i<obj.childNodes.length; i++){\r\n\t\t\tvar c=obj.childNodes[i];\r\n\t\t\tif(c.localName==\"text\"){\r\n\t\t\t\tthis.property('label',c.childNodes.length?c.childNodes[0].nodeValue:'');\r\n\t\t\t}\r\n\t\t\telse if(c.localName==\"path\"){\r\n\t\t\t\t//\tthe line\r\n\t\t\t\tvar d=c.getAttribute('d').split(\" \");\r\n\t\t\t\tvar s=d[0].split(\",\");\r\n\t\t\t\tthis.start.x=parseFloat(s[0].substr(1),10);\r\n\t\t\t\tthis.start.y=parseFloat(s[1],10);\r\n\t\t\t\ts=d[1].split(\",\");\r\n\t\t\t\tthis.control.x=parseFloat(s[0].substr(1),10);\r\n\t\t\t\tthis.control.y=parseFloat(s[1],10);\r\n\t\t\t\ts=d[2].split(\",\");\r\n\t\t\t\tthis.end.x=parseFloat(s[0],10);\r\n\t\t\t\tthis.end.y=parseFloat(s[1],10);\r\n\t\t\t\tvar stroke=this.property('stroke');\r\n\t\t\t\tvar style=c.getAttribute('style');\r\n\t\t\t\tvar m=style.match(/stroke:([^;]+);/);\r\n\t\t\t\tif(m){\r\n\t\t\t\t\tstroke.color=m[1];\r\n\t\t\t\t\tthis.property('fill',m[1]);\r\n\t\t\t\t}\r\n\t\t\t\tm=style.match(/stroke-width:([^;]+);/);\r\n\t\t\t\tif(m){\r\n\t\t\t\t\tstroke.width=m[1];\r\n\t\t\t\t}\r\n\t\t\t\tthis.property('stroke',stroke);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tp.initialize=function(obj){\r\n\t\tthis.apply(obj);\r\n\t\tthis._pos();\r\n\r\n\t\t//\tcreate either from scratch or based on the passed node\r\n\t\tthis.shape=this.figure.group.createGroup();\r\n\t\tthis.shape.getEventSource().setAttribute(\"id\", this.id);\r\n\t\tthis.pathShape=this.shape.createPath(\"M\"+this.start.x+\",\"+this.start.y+\" Q\"+this.control.x+\",\"+this.control.y+\" \"+this.end.x+\",\"+this.end.y+\" l0,0\");\r\n\t\tthis.labelShape=this.shape.createText({\r\n\t\t\t\tx:this.textPosition.x,\r\n\t\t\t\ty:this.textPosition.y,\r\n\t\t\t\ttext:this.property('label'),\r\n\t\t\t\talign:this.textAlign\r\n\t\t\t});\r\n\t\tthis.labelShape.getEventSource().setAttribute('id',this.id+\"-labelShape\");\r\n\t\tthis.draw();\r\n\t};\r\n\tp.destroy=function(){\r\n\t\tif(!this.shape){ return; }\r\n\t\tthis.shape.remove(this.pathShape);\r\n\t\tthis.shape.remove(this.labelShape);\r\n\t\tthis.figure.group.remove(this.shape);\r\n\t\tthis.shape=this.pathShape=this.labelShape=null;\r\n\t};\r\n\tp.getBBox=function(){\r\n\t\tvar x=Math.min(this.start.x, this.control.x, this.end.x);\r\n\t\tvar y=Math.min(this.start.y, this.control.y, this.end.y);\r\n\t\tvar w=Math.max(this.start.x, this.control.x, this.end.x)-x;\r\n\t\tvar h=Math.max(this.start.y, this.control.y, this.end.y)-y;\r\n\t\treturn { x:x, y:y, width:w, height:h };\r\n\t};\r\n\tp.draw=function(obj){\r\n\t\tthis.apply(obj);\r\n\t\tthis._pos();\r\n\t\tthis.shape.setTransform(this.transform);\r\n\t\tthis.pathShape.setShape(\"M\"+this.start.x+\",\"+this.start.y+\" Q\"+this.control.x+\",\"+this.control.y+\" \"+this.end.x+\",\"+this.end.y+\" l0,0\");\r\n\t\tthis.labelShape.setShape({\r\n\t\t\t\tx:this.textPosition.x,\r\n\t\t\t\ty:this.textPosition.y,\r\n\t\t\t\ttext:this.property('label')\r\n\t\t\t})\r\n\t\t\t.setFill(this.property('fill'));\r\n\t\tthis.zoom();\r\n\t};\r\n\tp.serialize=function(){\r\n\t\tvar stroke=this.property('stroke');\r\n\t\treturn '<g '+this.writeCommonAttrs()+'>'\r\n\t\t\t+ '<path style=\"stroke:'+stroke.color+';stroke-width:'+stroke.width+';fill:none;\" d=\"'\r\n\t\t\t+ \"M\"+this.start.x+\",\"+this.start.y+\" \"\r\n\t\t\t+ \"Q\"+this.control.x+\",\"+this.control.y+\" \"\r\n\t\t\t+ this.end.x+\",\"+this.end.y\r\n\t\t\t+ '\" />'\r\n\t\t\t+ '<text style=\"fill:'+stroke.color+';text-anchor:'+this.textAlign+'\" font-weight=\"bold\" '\r\n\t\t\t+ 'x=\"' + this.textPosition.x + '\" '\r\n\t\t\t+ 'y=\"' + this.textPosition.y + '\">'\r\n\t\t\t+ this.property('label')\r\n\t\t\t+ '</text>'\r\n\t\t\t+ '</g>';\r\n\t};\r\n\r\n\tta.Annotation.register(\"Lead\");\r\n\treturn dojox.sketch.LeadAnnotation;\r\n});\r\n"]}