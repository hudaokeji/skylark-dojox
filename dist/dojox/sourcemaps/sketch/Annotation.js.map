{"version":3,"sources":["sketch/Annotation.js"],"names":["define","dojo","declare","dojox","sketch","_Plugin","onMouseDown","e","this","_omd","onMouseMove","rect","_cshape","setShape","figure","surface","createRect","setStroke","color","width","style","setFill","getEventSource","setAttribute","onMouseUp","f","remove","_startPoint","x","pageX","y","pageY","Math","max","abs","_absEnd","_start","_create","_end","start","end","_","nextKey","a","transform","dx","_calCol","zoomFactor","dy","control","onBeforeCreateShape","initialize","select","onCreateShape","history","add","CommandTypes","Create","Annotation","id","_key","mode","Modes","View","shape","boundingBox","hasAnchors","anchors","_properties","stroke","font","family","size","weight","fill","label","p","prototype","constructor","type","getType","onRemove","noundo","Delete","serialize","property","name","value","r","toLowerCase","undefined","arguments","length","onPropertyChange","oldvalue","onCreate","onDblClick","l","prompt","beginEdit","Modify","draw","endEdit","destroy","apply","obj","getBBox","_type","Move","_prevState","calculate","slope","p1","p2","s","drawBBox","moveToBack","_add","setBinding","pt","getTextBox","zoomfactor","fp","fontFamily","fontSize","fontWeight","floor","gfx","_base","_getTextBox","setMode","m","method","Edit","zoom","pct","labelShape","clone","ceil","setFont","n","renderer","pathShape","writeCommonAttrs","data","toJson","readCommonAttrs","c","i","cs","childNodes","nodeType","nodeValue","substr","fromJson","console","error","getAttribute","replace","split","parseFloat","register","toolclass","cls","registerTool","mixin","annotation","AnnotationTool"],"mappings":";;;;;;;AAAAA,QACC,oBACA,kBACA,qBACA,kBACA,WACA,aACE,SAASC,GACXA,EAAKC,QAAQ,8BAA+BC,MAAMC,OAAOC,SACxDC,YAAa,SAASC,GACrBC,KAAKC,MAAK,GAEXC,YAAa,SAASH,EAAEI,GACnBH,KAAKC,OAGND,KAAKI,QACPJ,KAAKI,QAAQC,SAASF,IAEtBH,KAAKI,QAAQJ,KAAKM,OAAOC,QAAQC,WAAWL,GAC1CM,WAAWC,MAAM,OAAQC,MAAM,EAAGC,MAAM,aACxCC,SAAS,IAAI,IAAI,IAAI,KACvBb,KAAKI,QAAQU,iBAAiBC,aAAa,kBAAkB,iBAG/DC,UAAW,SAASjB,GACnB,GAAIC,KAAKC,KAAT,CAGAD,KAAKC,MAAK,EACV,IAAIgB,EAAEjB,KAAKM,OAKX,GAJGN,KAAKI,UACPa,EAAEV,QAAQW,OAAOlB,KAAKI,gBACfJ,KAAKI,SAERa,EAAEE,YAAYC,GAAGrB,EAAEsB,OAAOJ,EAAEE,YAAYG,GAAGvB,EAAEwB,MAAO,CAIrDC,KAAKC,IADE,GAGTD,KAAKE,IAAIT,EAAEU,QAAQP,EAAEH,EAAEW,OAAOR,GAC9BI,KAAKE,IAAIT,EAAEU,QAAQL,EAAEL,EAAEW,OAAON,IAJrB,IAMTtB,KAAK6B,QAAQZ,EAAEW,OAAQX,EAAEa,SAI5BD,QAAS,SAASE,EAAMC,GAGvB,IAAIf,EAAEjB,KAAKM,OACP2B,EAAEhB,EAAEiB,UACJC,EAAE,IAAKnC,KAAe,WAAEiB,EAAGgB,GAC/BE,EAAEC,WACDC,GAAGpB,EAAEqB,QAAQP,EAAMX,EAAEH,EAAEsB,YACvBC,GAAGvB,EAAEqB,QAAQP,EAAMT,EAAEL,EAAEsB,aAExBJ,EAAEH,KACDZ,EAAEH,EAAEqB,QAAQN,EAAIZ,EAAEH,EAAEsB,YACpBjB,EAAEL,EAAEqB,QAAQN,EAAIV,EAAEL,EAAEsB,aAElBJ,EAAEM,UACJN,EAAEM,SACDrB,EAAEH,EAAEqB,QAASN,EAAIZ,EAAE,EAAGH,EAAEsB,YACxBjB,EAAEL,EAAEqB,QAASN,EAAIV,EAAE,EAAGL,EAAEsB,cAG1BtB,EAAEyB,oBAAoBP,GACtBA,EAAEQ,aACF1B,EAAE2B,OAAOT,GACTlB,EAAE4B,cAAcV,GAChBlB,EAAE6B,QAAQC,IAAIpD,MAAMC,OAAOoD,aAAaC,OAAOd,MAIjDxC,MAAMC,OAAOsD,WAAW,SAAS5C,EAAQ6C,GAExCnD,KAAKmD,GAAGnD,KAAKoD,KAAKD,EAClBnD,KAAKM,OAAOA,EACZN,KAAKqD,KAAK1D,MAAMC,OAAOsD,WAAWI,MAAMC,KACxCvD,KAAKwD,MAAM,KACXxD,KAAKyD,YAAY,KACjBzD,KAAK0D,YAAW,EAChB1D,KAAK2D,WACL3D,KAAK4D,aACJC,QAAWnD,MAAM,OAAQC,MAAM,GAC/BmD,MAASC,OAAO,QAASC,KAAK,GAAIC,OAAO,QACzCC,KAAQ,OACRC,MAAS,IAGPnE,KAAKM,QACPN,KAAKM,OAAOyC,IAAI/C,OAIlB,IAAIoE,EAAEzE,MAAMC,OAAOsD,WAAWmB,UAgL9B,OA/KAD,EAAEE,YAAY3E,MAAMC,OAAOsD,WAC3BkB,EAAEG,KAAK,WAAY,MAAO,IAC1BH,EAAEI,QAAQ,WAAY,OAAO7E,MAAMC,OAAOsD,YAC1CkB,EAAEK,SAAS,SAASC,GAEnB1E,KAAKM,OAAOwC,QAAQC,IAAIpD,MAAMC,OAAOoD,aAAa2B,OAAQ3E,KAAMA,KAAK4E,cAEtER,EAAES,SAAS,SAASC,EAAUC,GAC7B,IAAIC,EAWJ,OAVAF,EAAKA,EAAKG,mBACkBC,IAAzBlF,KAAK4D,YAAYkB,KACnBE,EAAEhF,KAAK4D,YAAYkB,IAEjBK,UAAUC,OAAO,IACnBpF,KAAK4D,YAAYkB,GAAMC,EACpBC,GAAGD,GACL/E,KAAKqF,iBAAiBP,EAAKE,IAGtBA,GAERZ,EAAEiB,iBAAiB,SAASP,EAAKQ,KACjClB,EAAEmB,SAAS,WACVvF,KAAKM,OAAOwC,QAAQC,IAAIpD,MAAMC,OAAOoD,aAAaC,OAAOjD,OAE1DoE,EAAEoB,WAAW,SAASzF,GACrB,IAAI0F,EAAEC,OAAO,gBAAgB1F,KAAK6E,SAAS,WACpC,IAAJY,IACFzF,KAAK2F,UAAUhG,MAAMC,OAAOoD,aAAa4C,QACzC5F,KAAK6E,SAAS,QAAQY,GACtBzF,KAAK6F,OACL7F,KAAK8F,YAGP1B,EAAEzB,WAAW,aACbyB,EAAE2B,QAAQ,aACV3B,EAAEyB,KAAK,aACPzB,EAAE4B,MAAM,SAASC,KACjB7B,EAAEQ,UAAU,aACZR,EAAE8B,QAAQ,aACV9B,EAAEuB,UAAU,SAASpB,GAChBvE,KAAKmG,QACRnG,KAAKmG,MAAM5B,GAAM5E,MAAMC,OAAOoD,aAAaoD,KAC3CpG,KAAKqG,WAAWrG,KAAK4E,cAGvBR,EAAE0B,QAAQ,WACN9F,KAAKqG,YAAYrG,KAAK4E,aACxB5E,KAAKM,OAAOwC,QAAQC,IAAI/C,KAAKmG,MAAMnG,KAAKA,KAAKqG,YAE9CrG,KAAKmG,MAAMnG,KAAKqG,WAAW,IAE5BjC,EAAEkC,WACDC,MAAM,SAASC,EAAIC,GAClB,OAAKD,EAAGpF,EAAEqF,EAAGrF,GACJoF,EAAGlF,EAAEmF,EAAGnF,IAAIkF,EAAGpF,EAAEqF,EAAGrF,GADJ,GAG1BiB,GAAG,SAASmE,EAAIC,EAAIjE,GACnB,IAAIkE,EAAE1G,KAAKuG,MAAMC,EAAGC,GACpB,OAAM,GAAHC,EAAcA,EACVlE,EAAGkE,GAEXlE,GAAG,SAASgE,EAAIC,EAAIpE,GACnB,OAAOrC,KAAKuG,MAAMC,EAAGC,GAAIpE,IAG3B+B,EAAEuC,SAAS,WACV,IAAI3B,EAAEhF,KAAKkG,UACPlG,KAAKyD,YASRzD,KAAKyD,YAAYpD,SAAS2E,IAR1BhF,KAAKyD,YAAYzD,KAAKwD,MAAMhD,WAAWwE,GACrC4B,aACAnG,WAAWC,MAAM,OAAQC,MAAM,EAAGC,MAAM,SACxCC,SAAS,IAAI,IAAI,IAAI,KACvBb,KAAKyD,YAAY3C,iBAAiBC,aAAa,KAAKf,KAAKmD,GAAG,gBAC5DnD,KAAKyD,YAAY3C,iBAAiBC,aAAa,kBAAkB,cACjEf,KAAKM,OAAOuG,KAAK7G,QAKnBoE,EAAE0C,WAAW,SAASC,GACrB/G,KAAKoC,UAAUC,IAAI0E,EAAG1E,GACtBrC,KAAKoC,UAAUI,IAAIuE,EAAGvE,GACtBxC,KAAK6F,QAGNzB,EAAE4C,WAAW,SAASC,GACrB,IAAIC,EAAGlH,KAAK6E,SAAS,QAEjB5D,GAAKkG,WAAWD,EAAGnD,OAAOqD,SAASF,EAAGlD,KAAKqD,WAAWH,EAAGjD,QAI7D,OAHGgD,IACFhG,EAAEmG,SAAW5F,KAAK8F,MAAMrG,EAAEmG,SAASH,IAE7BtH,MAAM4H,IAAIC,MAAMC,YAAYzH,KAAK6E,SAAS,SAAS5D,IAE3DmD,EAAEsD,QAAQ,SAASC,GAClB,GAAG3H,KAAKqD,MAAMsE,EAAd,CACA3H,KAAKqD,KAAKsE,EACV,IAAIC,EAAO,UAYX,IAAI,IAAIxD,KAXLuD,GAAGhI,MAAMC,OAAOsD,WAAWI,MAAMuE,OAAOD,EAAO,UACvC,UAARA,GAEF5H,KAAK2G,WACL3G,KAAKM,OAAOuG,KAAK7G,OAEdA,KAAKyD,cACJzD,KAAKwD,OAAQxD,KAAKwD,MAAMtC,OAAOlB,KAAKyD,aACvCzD,KAAKyD,YAAY,MAGNzD,KAAK2D,QACjB3D,KAAK2D,QAAQS,GAAGwD,OAGlBxD,EAAE0D,KAAK,SAASC,GAEf,GADAA,EAAMA,GAAO/H,KAAKM,OAAOiC,WACtBvC,KAAKgI,WAAW,CAClB,IAAI/G,EAAExB,EAAKwI,MAAMjI,KAAK6E,SAAS,SAC/B5D,EAAE+C,KAAKxC,KAAK0G,KAAKjH,EAAE+C,KAAK+D,GAAK,KAC7B/H,KAAKgI,WAAWG,QAAQlH,GAGzB,IAAI,IAAImH,KAAKpI,KAAK2D,QACjB3D,KAAK2D,QAAQyE,GAAGN,KAAKC,GAQtB,GAHuB,OAApBpI,MAAM4H,IAAIc,WACNN,EAAI,GAER/H,KAAKsI,UAAU,CACjB,IAAI5B,EAAEjH,EAAKwI,MAAMjI,KAAK6E,SAAS,WAC/B6B,EAAE/F,MAAMoH,EAAI,EAAErB,EAAE/F,MAAMa,KAAK0G,KAAKxB,EAAE/F,MAAMoH,GAAK,KAC7C/H,KAAKsI,UAAU7H,UAAUiG,KAG3BtC,EAAEmE,iBAAiB,WAClB,MAAO,OAASvI,KAAKmD,GAAK,uBAAyBnD,KAAKuE,OAAS,0BACpCvE,KAAKoC,UAAUC,GAAK,IAAMrC,KAAKoC,UAAUI,GAAK,MACvExC,KAAKwI,KAAM,mBAAmB/I,EAAKgJ,OAAOzI,KAAKwI,MAAM,KAAM,KAEhEpE,EAAEsE,gBAAgB,SAASzC,GAE1B,IADA,IAA0B0C,EAAtBC,EAAE,EAAEC,EAAG5C,EAAI6C,WACRH,EAAEE,EAAGD,MACI,GAAZD,EAAEI,WACyB,eAA1BJ,EAAEK,UAAUC,OAAO,EAAE,IACvBjJ,KAAK4D,YAAYnE,EAAKyJ,SAASP,EAAEK,UAAUC,OAAO,KACjB,SAAzBN,EAAEK,UAAUC,OAAO,EAAE,GAC7BjJ,KAAKwI,KAAK/I,EAAKyJ,SAASP,EAAEK,UAAUC,OAAO,IAE3CE,QAAQC,MAAM,8BAA8BnD,IAK/C,GAAGA,EAAIoD,aAAa,aAAa,CAChC,IACItC,EADEd,EAAIoD,aAAa,aAAaC,QAAQ,aAAa,IAChDC,MAAM,KACfvJ,KAAKoC,UAAUC,GAAGmH,WAAWzC,EAAG,GAAG,IACnC/G,KAAKoC,UAAUI,GAAGgH,WAAWzC,EAAG,GAAG,MAGrCpH,MAAMC,OAAOsD,WAAWI,OAAQC,KAAK,EAAGsE,KAAK,GAC7ClI,MAAMC,OAAOsD,WAAWuG,SAAS,SAAS3E,EAAK4E,GAC9C,IAAIC,EAAIhK,MAAMC,OAAOkF,EAAK,cAC1BnF,MAAMC,OAAOgK,aAAa9E,EAAM,SAASV,GAKxC,OAJA3E,EAAKoK,MAAMzF,GACVZ,MAAOsB,EACPgF,WAAWH,IAEL,IAAKD,GAAa/J,MAAMC,OAAOmK,gBAAgB3F,MAIjDzE,MAAMC,OAAOsD","file":"../../sketch/Annotation.js","sourcesContent":["define([\r\n\t\"dojo/_base/kernel\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/json\",\r\n\t\"./Anchor\",\r\n\t\"./_Plugin\"\r\n], function(dojo){\r\n\tdojo.declare(\"dojox.sketch.AnnotationTool\", dojox.sketch._Plugin, {\r\n\t\tonMouseDown: function(e){\r\n\t\t\tthis._omd=true;\r\n\t\t},\r\n\t\tonMouseMove: function(e,rect){\r\n\t\t\tif(!this._omd){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(this._cshape){\r\n\t\t\t\tthis._cshape.setShape(rect);\r\n\t\t\t} else {\r\n\t\t\t\tthis._cshape=this.figure.surface.createRect(rect)\r\n\t\t\t\t\t.setStroke({color:\"#999\", width:1, style:\"ShortDot\"})\r\n\t\t\t\t\t.setFill([255,255,255,0.7]);\r\n\t\t\t\tthis._cshape.getEventSource().setAttribute(\"shape-rendering\",\"crispEdges\");\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseUp: function(e){\r\n\t\t\tif(!this._omd){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._omd=false;\r\n\t\t\tvar f=this.figure;\r\n\t\t\tif(this._cshape){\r\n\t\t\t\tf.surface.remove(this._cshape);\r\n\t\t\t\tdelete this._cshape;\r\n\t\t\t}\r\n\t\t\tif(!(f._startPoint.x==e.pageX&&f._startPoint.y==e.pageY)){\r\n\t\t\t\t//\tThe minimum number of pixels one has to travel before a shape\r\n\t\t\t\t//\t\tgets drawn.\r\n\t\t\t\tvar limit=10;\r\n\t\t\t\tif(Math.max(\r\n\t\t\t\t\tlimit,\r\n\t\t\t\t\tMath.abs(f._absEnd.x-f._start.x),\r\n\t\t\t\t\tMath.abs(f._absEnd.y-f._start.y)\r\n\t\t\t\t)>limit){\r\n\t\t\t\t\tthis._create(f._start, f._end);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t_create: function(start,end){\r\n\t\t\t//\tcreate a new shape, needs to be accessible from the\r\n\t\t\t//\t\tdragging functions.\r\n\t\t\tvar f=this.figure;\r\n\t\t\tvar _=f.nextKey();\r\n\t\t\tvar a=new (this.annotation)(f, _);\r\n\t\t\ta.transform={\r\n\t\t\t\tdx:f._calCol(start.x/f.zoomFactor),\r\n\t\t\t\tdy:f._calCol(start.y/f.zoomFactor)\r\n\t\t\t};\r\n\t\t\ta.end={\r\n\t\t\t\tx:f._calCol(end.x/f.zoomFactor),\r\n\t\t\t\ty:f._calCol(end.y/f.zoomFactor)\r\n\t\t\t};\r\n\t\t\tif(a.control){\r\n\t\t\t\ta.control={\r\n\t\t\t\t\tx:f._calCol((end.x/2)/f.zoomFactor),\r\n\t\t\t\t\ty:f._calCol((end.y/2)/f.zoomFactor)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tf.onBeforeCreateShape(a);\r\n\t\t\ta.initialize();\r\n\t\t\tf.select(a);\r\n\t\t\tf.onCreateShape(a);\r\n\t\t\tf.history.add(dojox.sketch.CommandTypes.Create,a);\r\n\t\t}\r\n\t});\r\n\r\n\tdojox.sketch.Annotation=function(figure, id){\r\n\t\t//\tfor editing stuff.\r\n\t\tthis.id=this._key=id;\r\n\t\tthis.figure=figure;\r\n\t\tthis.mode=dojox.sketch.Annotation.Modes.View;\r\n\t\tthis.shape=null;\t// dojox.gfx.Group\r\n\t\tthis.boundingBox=null;\t// rect for boundaries\r\n\t\tthis.hasAnchors=true;\r\n\t\tthis.anchors={};\t//\tdojox.sketch.Anchor\r\n\t\tthis._properties={\r\n\t\t\t'stroke':{ color:\"blue\", width:2 },\r\n\t\t\t'font': {family:\"Arial\", size:16, weight:\"bold\"},\r\n\t\t\t'fill': \"blue\",\r\n\t\t\t'label': \"\"\r\n\t\t};\r\n\r\n\t\tif(this.figure){\r\n\t\t\tthis.figure.add(this);\r\n\t\t}\r\n\t};\r\n\r\n\tvar p=dojox.sketch.Annotation.prototype;\r\n\tp.constructor=dojox.sketch.Annotation;\r\n\tp.type=function(){ return ''; };\r\n\tp.getType=function(){ return dojox.sketch.Annotation; };\r\n\tp.onRemove=function(noundo){\r\n\t\t//this.figure._delete([this],noundo);\r\n\t\tthis.figure.history.add(dojox.sketch.CommandTypes.Delete, this, this.serialize());\r\n\t};\r\n\tp.property=function(name,/*?*/value){\r\n\t\tvar r;\r\n\t\tname=name.toLowerCase();\r\n\t\tif(this._properties[name]!==undefined){\r\n\t\t\tr=this._properties[name];\r\n\t\t}\r\n\t\tif(arguments.length>1){\r\n\t\t\tthis._properties[name]=value;\r\n\t\t\tif(r!=value){\r\n\t\t\t\tthis.onPropertyChange(name,r);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn r;\r\n\t};\r\n\tp.onPropertyChange=function(name,oldvalue){};\r\n\tp.onCreate=function(){\r\n\t\tthis.figure.history.add(dojox.sketch.CommandTypes.Create,this);\r\n\t}\r\n\tp.onDblClick=function(e){\r\n\t\tvar l=prompt('Set new text:',this.property('label'));\r\n\t\tif(l!==false){\r\n\t\t\tthis.beginEdit(dojox.sketch.CommandTypes.Modify);\r\n\t\t\tthis.property('label',l);\r\n\t\t\tthis.draw();\r\n\t\t\tthis.endEdit();\r\n\t\t}\r\n\t}\r\n\tp.initialize=function(){ };\r\n\tp.destroy=function(){ };\r\n\tp.draw=function(){ };\r\n\tp.apply=function(obj){ };\r\n\tp.serialize=function(){ };\r\n\tp.getBBox=function(){ };\r\n\tp.beginEdit=function(type){\r\n\t\tif(!this._type){\r\n\t\t\tthis._type=type||dojox.sketch.CommandTypes.Move;\r\n\t\t\tthis._prevState=this.serialize();\r\n\t\t}\r\n\t};\r\n\tp.endEdit=function(){\r\n\t\tif(this._prevState!=this.serialize()){\r\n\t\t\tthis.figure.history.add(this._type,this,this._prevState);\r\n\t\t}\r\n\t\tthis._type=this._prevState='';\r\n\t};\r\n\tp.calculate={\r\n\t\tslope:function(p1, p2){\r\n\t\t\tif(!(p1.x-p2.x)){ return 0; }\r\n\t\t\treturn ((p1.y-p2.y)/(p1.x-p2.x));\r\n\t\t},\r\n\t\tdx:function(p1, p2, dy){\r\n\t\t\tvar s=this.slope(p1,p2);\r\n\t\t\tif(s==0){ return s; }\r\n\t\t\treturn dy/s;\r\n\t\t},\r\n\t\tdy:function(p1, p2, dx){\r\n\t\t\treturn this.slope(p1,p2)*dx;\r\n\t\t}\r\n\t};\r\n\tp.drawBBox=function(){\r\n\t\tvar r=this.getBBox();\r\n\t\tif(!this.boundingBox){\r\n\t\t\tthis.boundingBox=this.shape.createRect(r)\r\n\t\t\t\t.moveToBack()\r\n\t\t\t\t.setStroke({color:\"#999\", width:1, style:\"Dash\"})\r\n\t\t\t\t.setFill([238,238,238,0.3]);\r\n\t\t\tthis.boundingBox.getEventSource().setAttribute(\"id\",this.id+\"-boundingBox\");\r\n\t\t\tthis.boundingBox.getEventSource().setAttribute(\"shape-rendering\",\"crispEdges\");\r\n\t\t\tthis.figure._add(this);\r\n\t\t} else {\r\n\t\t\tthis.boundingBox.setShape(r);\r\n\t\t}\r\n\t};\r\n\tp.setBinding=function(pt){\r\n\t\tthis.transform.dx+=pt.dx;\r\n\t\tthis.transform.dy+=pt.dy;\r\n\t\tthis.draw();\r\n\t};\r\n\t//p.doChange=function(pt){ };\r\n\tp.getTextBox=function(zoomfactor){\r\n\t\tvar fp=this.property('font');\r\n\t\t//_getTextBox expect style camlCase properties, do it manually here\r\n\t\tvar f = {fontFamily:fp.family,fontSize:fp.size,fontWeight:fp.weight};\r\n\t\tif(zoomfactor){\r\n\t\t\tf.fontSize = Math.floor(f.fontSize/zoomfactor);\r\n\t\t}\r\n\t\treturn dojox.gfx._base._getTextBox(this.property('label'),f);\r\n\t};\r\n\tp.setMode=function(m){\r\n\t\tif(this.mode==m){ return; }\r\n\t\tthis.mode=m;\r\n\t\tvar method=\"disable\";\r\n\t\tif(m==dojox.sketch.Annotation.Modes.Edit){ method=\"enable\"; }\r\n\t\tif(method==\"enable\"){\r\n\t\t\t//\tdraw the bounding box\r\n\t\t\tthis.drawBBox();\r\n\t\t\tthis.figure._add(this);\r\n\t\t} else {\r\n\t\t\tif(this.boundingBox){\r\n\t\t\t\tif(this.shape){ this.shape.remove(this.boundingBox); }\r\n\t\t\t\tthis.boundingBox=null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(var p in this.anchors){\r\n\t\t\tthis.anchors[p][method]();\r\n\t\t}\r\n\t};\r\n\tp.zoom=function(pct){\r\n\t\tpct = pct || this.figure.zoomFactor;\r\n\t\tif(this.labelShape){\r\n\t\t\tvar f=dojo.clone(this.property('font'));\r\n\t\t\tf.size=Math.ceil(f.size/pct)+\"px\";\r\n\t\t\tthis.labelShape.setFont(f);\r\n\t\t}\r\n\t\t\r\n\t\tfor(var n in this.anchors){\r\n\t\t\tthis.anchors[n].zoom(pct);\r\n\t\t}\r\n\t\t\r\n\t\t//In VML, path are always the same width no matter scaling factors,\r\n\t\t//so aways use 1 for VML\r\n\t\tif(dojox.gfx.renderer=='vml'){\r\n        \tpct=1;\r\n        }\r\n\t\tif(this.pathShape){\r\n\t\t\tvar s=dojo.clone(this.property('stroke'));\r\n\t\t\ts.width=pct>1?s.width:Math.ceil(s.width/pct)+\"px\";\r\n\t\t\tthis.pathShape.setStroke(s);\r\n\t\t}\r\n\t};\r\n\tp.writeCommonAttrs=function(){\r\n\t\treturn 'id=\"' + this.id + '\" dojoxsketch:type=\"' + this.type() + '\"'\r\n\t\t\t+ ' transform=\"translate('+ this.transform.dx + \",\" + this.transform.dy + ')\"'\r\n\t\t\t+ (this.data?(' ><![CDATA[data:'+dojo.toJson(this.data)+']]'):'');\r\n\t};\r\n\tp.readCommonAttrs=function(obj){\r\n\t\tvar i=0,cs=obj.childNodes,c;\r\n\t\twhile((c=cs[i++])){\r\n\t\t\tif(c.nodeType==4){ //CDATA\r\n\t\t\t\tif(c.nodeValue.substr(0,11)=='properties:'){\r\n\t\t\t\t\tthis._properties=dojo.fromJson(c.nodeValue.substr(11));\r\n\t\t\t\t}else if(c.nodeValue.substr(0,5)=='data:'){\r\n\t\t\t\t\tthis.data=dojo.fromJson(c.nodeValue.substr(5));\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.error('unknown CDATA node in node ',obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(obj.getAttribute('transform')){\r\n\t\t\tvar t=obj.getAttribute('transform').replace(\"translate(\",\"\");\r\n\t\t\tvar pt=t.split(\",\");\r\n\t\t\tthis.transform.dx=parseFloat(pt[0],10);\r\n\t\t\tthis.transform.dy=parseFloat(pt[1],10);\r\n\t\t}\r\n\t};\r\n\tdojox.sketch.Annotation.Modes={ View:0, Edit:1 };\r\n\tdojox.sketch.Annotation.register=function(name,toolclass){\r\n\t\tvar cls=dojox.sketch[name+'Annotation'];\r\n\t\tdojox.sketch.registerTool(name, function(p){\r\n\t\t\tdojo.mixin(p, {\r\n\t\t\t\tshape: name,\r\n\t\t\t\tannotation:cls\r\n\t\t\t});\r\n\t\t\treturn new (toolclass || dojox.sketch.AnnotationTool)(p);\r\n\t\t});\r\n\t};\r\n\r\n\treturn dojox.sketch.Annotation;\r\n});\r\n"]}