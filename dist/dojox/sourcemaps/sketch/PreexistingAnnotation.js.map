{"version":3,"sources":["sketch/PreexistingAnnotation.js"],"names":["define","dojo","getObject","dojox","ta","sketch","PreexistingAnnotation","figure","id","Annotation","call","this","transform","dx","dy","start","x","y","end","radius","textPosition","textOffset","textAlign","rectShape","labelShape","anchors","Anchor","prototype","p","constructor","type","getType","_pos","Math","min","w","max","h","apply","obj","documentElement","readCommonAttrs","i","childNodes","length","c","localName","property","nodeValue","getAttribute","parseFloat","stroke","style","m","match","color","width","initialize","shape","group","createGroup","getEventSource","setAttribute","createRect","height","r","setFill","createText","text","align","draw","destroy","remove","getBBox","setTransform","setShape","zoom","pct","zoomFactor","gfx","renderer","setStroke","serialize","s","writeCommonAttrs","register"],"mappings":"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","file":"../../sketch/PreexistingAnnotation.js","sourcesContent":["define([\"dojo/_base/kernel\", \"dojo/_base/lang\", \"./Annotation\", \"./Anchor\"], function(dojo){\r\n\tdojo.getObject(\"sketch\", true, dojox);\r\n\r\n\tvar ta=dojox.sketch;\r\n\tta.PreexistingAnnotation=function(figure, id){\r\n\t\tta.Annotation.call(this, figure, id);\r\n\t\tthis.transform={dx:0, dy:0};\r\n\t\tthis.start={ x:0, y:0 };\r\n\t\tthis.end={ x:200, y:200 };\r\n\t\tthis.radius=8;\r\n\t\tthis.textPosition={ x:196, y:196 };\r\n\t\tthis.textOffset=4;\r\n\t\tthis.textAlign=\"end\";\r\n\r\n\t\t//this.property('label',this.id);\r\n\t\tthis.rectShape=null;\r\n\t\tthis.labelShape=null;\r\n\r\n\t\tthis.anchors.start=new ta.Anchor(this, \"start\");\r\n\t\tthis.anchors.end=new ta.Anchor(this, \"end\");\r\n\t};\r\n\tta.PreexistingAnnotation.prototype=new ta.Annotation;\r\n\tvar p=ta.PreexistingAnnotation.prototype;\r\n\tp.constructor=ta.PreexistingAnnotation;\r\n\r\n\tp.type=function(){ return 'Preexisting' };\r\n\tp.getType=function(){ return ta.PreexistingAnnotation; };\r\n\r\n\tp._pos=function(){\r\n\t\tvar x=Math.min(this.start.x, this.end.x);\r\n\t\tvar y=Math.min(this.start.y, this.end.y);\r\n\t\tvar w=Math.max(this.start.x, this.end.x);\r\n\t\tvar h=Math.max(this.start.y, this.end.y);\r\n\t\tthis.start={ x:x, y:y };\r\n\t\tthis.end={ x:w, y:h };\r\n\t\tthis.textPosition={ x:this.end.x-this.textOffset, y:this.end.y-this.textOffset };\r\n\t};\r\n\tp.apply=function(obj){\r\n\t\tif(!obj){ return; }\r\n\t\tif(obj.documentElement){ obj=obj.documentElement; }\r\n\t\tthis.readCommonAttrs(obj);\r\n\t\t\r\n\t\tfor(var i=0; i<obj.childNodes.length; i++){\r\n\t\t\tvar c=obj.childNodes[i];\r\n\t\t\tif(c.localName==\"text\"){\r\n\t\t\t\tthis.property('label',c.childNodes.length?c.childNodes[0].nodeValue:'');\r\n\t\t\t}\r\n\t\t\telse if(c.localName==\"rect\"){\r\n\t\t\t\tif(c.getAttribute('x')!==null){ this.start.x=parseFloat(c.getAttribute('x'), 10); }\r\n\t\t\t\tif(c.getAttribute('width')!==null){ this.end.x=parseFloat(c.getAttribute('width'), 10)+parseFloat(c.getAttribute('x'), 10); }\r\n\t\t\t\tif(c.getAttribute('y')!==null){ this.start.y=parseFloat(c.getAttribute('y'), 10); }\r\n\t\t\t\tif(c.getAttribute('height')!==null){ this.end.y=parseFloat(c.getAttribute('height'), 10)+parseFloat(c.getAttribute('y'), 10); }\r\n\t\t\t\tif(c.getAttribute('r')!==null){ this.radius=parseFloat(c.getAttribute('r'),10); }\r\n\t\t\t\tvar stroke=this.property('stroke');\r\n\t\t\t\tvar style=c.getAttribute('style');\r\n\t\t\t\tvar m=style.match(/stroke:([^;]+);/);\r\n\t\t\t\tif(m){\r\n\t\t\t\t\tstroke.color=m[1];\r\n\t\t\t\t\tthis.property('fill',m[1]);\r\n\t\t\t\t}\r\n\t\t\t\tm=style.match(/stroke-width:([^;]+);/);\r\n\t\t\t\tif(m){\r\n\t\t\t\t\tstroke.width=m[1];\r\n\t\t\t\t}\r\n\t\t\t\tthis.property('stroke',stroke);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tp.initialize=function(obj){\r\n\t\tthis.apply(obj);\r\n\t\tthis._pos();\r\n\r\n\t\t//\tcreate either from scratch or based on the passed node\r\n\t\tthis.shape=this.figure.group.createGroup();\r\n\t\tthis.shape.getEventSource().setAttribute(\"id\", this.id);\r\n\t\t//if(this.transform.dx || this.transform.dy){ this.shape.setTransform(this.transform); }\r\n\t\tthis.rectShape=this.shape.createRect({\r\n\t\t\t\tx:this.start.x,\r\n\t\t\t\ty: this.start.y,\r\n\t\t\t\twidth: this.end.x-this.start.x,\r\n\t\t\t\theight:this.end.y-this.start.y,\r\n\t\t\t\tr:this.radius\r\n\t\t\t})\r\n\t\t\t//.setStroke({color:this.property('fill'), width:1})\r\n\t\t\t.setFill([255,255,255,0.1]);\r\n\t\tthis.rectShape.getEventSource().setAttribute(\"shape-rendering\",\"crispEdges\");\r\n\t\tthis.labelShape=this.shape.createText({\r\n\t\t\t\tx:this.textPosition.x,\r\n\t\t\t\ty:this.textPosition.y,\r\n\t\t\t\ttext:this.property('label'),\r\n\t\t\t\talign:this.textAlign\r\n\t\t\t})\r\n\t\t\t//.setFont(font)\r\n\t\t\t.setFill(this.property('fill'));\r\n\t\tthis.labelShape.getEventSource().setAttribute('id',this.id+\"-labelShape\");\r\n\t\tthis.draw();\r\n\t};\r\n\tp.destroy=function(){\r\n\t\tif(!this.shape){ return; }\r\n\t\tthis.shape.remove(this.rectShape);\r\n\t\tthis.shape.remove(this.labelShape);\r\n\t\tthis.figure.group.remove(this.shape);\r\n\t\tthis.shape=this.rectShape=this.labelShape=null;\r\n\t};\r\n\tp.getBBox=function(){\r\n\t\tvar x=Math.min(this.start.x, this.end.x);\r\n\t\tvar y=Math.min(this.start.y, this.end.y);\r\n\t\tvar w=Math.max(this.start.x, this.end.x)-x;\r\n\t\tvar h=Math.max(this.start.y, this.end.y)-y;\r\n\t\treturn { x:x-2, y:y-2, width:w+4, height:h+4 };\r\n\t};\r\n\tp.draw=function(obj){\r\n\t\tthis.apply(obj);\r\n\t\tthis._pos();\r\n\t\tthis.shape.setTransform(this.transform);\r\n\t\tthis.rectShape.setShape({\r\n\t\t\t\tx:this.start.x,\r\n\t\t\t\ty: this.start.y,\r\n\t\t\t\twidth: this.end.x-this.start.x,\r\n\t\t\t\theight:this.end.y-this.start.y,\r\n\t\t\t\tr:this.radius\r\n\t\t\t})\r\n\t\t\t//.setStroke({ color:this.property('fill'), width:1 })\r\n\t\t\t.setFill([255,255,255,0.1]);\r\n\r\n\t\tthis.labelShape.setShape({\r\n\t\t\t\tx:this.textPosition.x,\r\n\t\t\t\ty:this.textPosition.y,\r\n\t\t\t\ttext:this.property('label')\r\n\t\t\t})\r\n\t\t\t.setFill(this.property('fill'));\r\n\t\tthis.zoom();\r\n\t};\r\n\tp.zoom=function(pct){\r\n\t\tif(this.rectShape){\r\n\t\t\tpct = pct || this.figure.zoomFactor;\r\n\t\t\tta.Annotation.prototype.zoom.call(this,pct);\r\n\t\t\tpct = dojox.gfx.renderer=='vml'?1:pct;\r\n\t\t\tthis.rectShape.setStroke({color:this.property('fill'), width:1/pct});\r\n\t\t}\r\n\t};\r\n\tp.serialize=function(){\r\n\t\tvar s=this.property('stroke');\r\n\t\treturn '<g '+this.writeCommonAttrs()+'>'\r\n\t\t\t+ '<rect style=\"stroke:'+s.color+';stroke-width:1;fill:none;\" '\r\n\t\t\t+ 'x=\"' + this.start.x + '\" '\r\n\t\t\t+ 'width=\"' + (this.end.x-this.start.x) + '\" '\r\n\t\t\t+ 'y=\"' + this.start.y + '\" '\r\n\t\t\t+ 'height=\"' + (this.end.y-this.start.y) + '\" '\r\n\t\t\t+ 'rx=\"' + this.radius + '\" '\r\n\t\t\t+ 'ry=\"' + this.radius + '\" '\r\n\t\t\t+ ' />'\r\n\t\t\t+ '<text style=\"fill:'+s.color+';text-anchor:'+this.textAlign+'\" font-weight=\"bold\" '\r\n\t\t\t+ 'x=\"' + this.textPosition.x + '\" '\r\n\t\t\t+ 'y=\"' + this.textPosition.y + '\">'\r\n\t\t\t+ this.property('label')\r\n\t\t\t+ '</text>'\r\n\t\t\t+ '</g>';\r\n\t};\r\n\r\n\tta.Annotation.register(\"Preexisting\");\r\n\treturn dojox.sketch.PreexistingAnnotation;\r\n});\r\n"]}