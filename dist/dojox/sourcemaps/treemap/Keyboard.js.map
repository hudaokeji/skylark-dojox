{"version":3,"sources":["treemap/Keyboard.js"],"names":["define","arr","lang","event","declare","on","keys","domAttr","utils","_FocusMixin","tabIndex","_setTabIndexAttr","constructor","postCreate","this","inherited","arguments","own","domNode","hitch","_onKeyDown","_onMouseDown","createRenderer","item","level","kind","renderer","set","e","focus","selected","get","children","childrenI","selectedI","newSelected","itemToRenderer","getIdentity","parent","parentItem","keyCode","UP_ARROW","NUMPAD_MINUS","NUMPAD_PLUS","DOWN_ARROW","initElements","_computeAreaForItem","elements","indexOf","sort","a","b","size","LEFT_ARROW","Math","max","index","RIGHT_ARROW","min","length","_isLeaf","drillDown","stop","drillUp","_isRoot"],"mappings":";;;;;;;AAAAA,QAAQ,mBAAoB,kBAAmB,mBAAoB,qBAAsB,UAAW,YAAa,gBAChH,WAAY,qBACZ,SAASC,EAAKC,EAAMC,EAAOC,EAASC,EAAIC,EAAMC,EAASC,EAAOC,GAE9D,OAAOL,EAAQ,yBAA0BK,GAMxCC,SAAU,IACVC,iBAAkB,UAElBC,YAAa,aAGbC,WAAY,WACXC,KAAKC,UAAUC,WACfF,KAAKG,IAAIZ,EAAGS,KAAKI,QAAS,UAAWhB,EAAKiB,MAAML,KAAMA,KAAKM,cAC3DN,KAAKG,IAAIZ,EAAGS,KAAKI,QAAS,YAAahB,EAAKiB,MAAML,KAAMA,KAAKO,iBAG9DC,eAAgB,SAASC,EAAMC,EAAOC,GACrC,IAAIC,EAAWZ,KAAKC,UAAUC,WAI9B,OADAT,EAAQoB,IAAID,EAAU,WAAY,MAC3BA,GAGRL,aAAc,SAASO,GACtBd,KAAKI,QAAQW,SAGdT,WAAY,SAASQ,GACpB,IAAIE,EAAWhB,KAAKiB,IAAI,gBACxB,GAAID,EAAJ,CAIA,IAEIE,EAAUC,EAAWC,EAgBrBC,EAlBAT,EAAWZ,KAAKsB,eAAetB,KAAKuB,YAAYP,IAChDQ,EAASZ,EAASa,WAGtB,GAAGX,EAAEY,SAAWlC,EAAKmC,UAAYb,EAAEY,SAAWlC,EAAKoC,cAClDd,EAAEY,SAAWlC,EAAKqC,YAAY,CAE9B,KADAX,EAAYJ,EAAEY,SAAWlC,EAAKsC,WAAYd,EAASE,SAASM,EAAON,UASlE,OALAE,GAFAD,EAAYzB,EAAMqC,aAAab,EAAU9B,EAAKiB,MAAML,KACnDA,KAAKgC,sBAAsBC,UACN9C,EAAI+C,QAAQhB,EAAUF,IAC5CG,EAAUgB,KAAK,SAASC,EAAGC,GAC1B,OAAOA,EAAEC,KAAOF,EAAEE,OAOrB,OAAOxB,EAAEY,SACR,KAAKlC,EAAK+C,WACVlB,EAAcH,EAASC,EAAUqB,KAAKC,IAAI,EAAGtD,EAAI+C,QAAQf,EAAWC,GAAW,IAAIsB,OACnF,MACA,KAAKlD,EAAKmD,YACVtB,EAAcH,EAASC,EAAUqB,KAAKI,IAAIzB,EAAU0B,OAAO,EAAG1D,EAAI+C,QAAQf,EAAWC,GAAW,IAAIsB,OACpG,MACA,KAAKlD,EAAKsC,WACVT,EAAcH,EAASC,EAAU,GAAGuB,OACpC,MACA,KAAKlD,EAAKmC,SACVN,EAAcG,EACd,MAGA,KAAKhC,EAAKqC,aACN7B,KAAK8C,QAAQ9B,IAAahB,KAAK+C,YAClC/C,KAAK+C,UAAUnC,GACfvB,EAAM2D,KAAKlC,IAEZ,MAGA,KAAKtB,EAAKoC,cACN5B,KAAK8C,QAAQ9B,IAAahB,KAAKiD,UAClCjD,KAAKiD,QAAQrC,GACbvB,EAAM2D,KAAKlC,IAIVO,IACErB,KAAKkD,QAAQ7B,KAChBrB,KAAKa,IAAI,eAAgBQ,GACzBhC,EAAM2D,KAAKlC","file":"../../treemap/Keyboard.js","sourcesContent":["define([\"dojo/_base/array\", \"dojo/_base/lang\", \"dojo/_base/event\", \"dojo/_base/declare\", \"dojo/on\", \"dojo/keys\", \"dojo/dom-attr\",\r\n\t\"./_utils\", \"dijit/_FocusMixin\"],\r\n\tfunction(arr, lang, event, declare, on, keys, domAttr, utils, _FocusMixin){\r\n\r\n\treturn declare(\"dojox.treemap.Keyboard\", _FocusMixin, {\r\n\t\t// summary:\r\n\t\t//\t\tSpecializes TreeMap to support keyboard navigation and accessibility.\r\n\t\t\r\n\t\t// tabIndex: String\r\n\t\t//\t\tOrder fields are traversed when user hits the tab key\r\n\t\ttabIndex: \"0\",\r\n\t\t_setTabIndexAttr: \"domNode\",\r\n\t\t\t\r\n\t\tconstructor: function(){\r\n\t\t},\r\n\t\t\r\n\t\tpostCreate: function(){\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\tthis.own(on(this.domNode, \"keydown\", lang.hitch(this, this._onKeyDown)));\r\n\t\t\tthis.own(on(this.domNode, \"mousedown\", lang.hitch(this, this._onMouseDown)));\r\n\t\t},\r\n\r\n\t\tcreateRenderer: function(item, level, kind){\r\n\t\t\tvar renderer = this.inherited(arguments);\r\n\t\t\t// on Firefox we need a tabindex on sub divs to let the keyboard event be dispatched\r\n\t\t\t// put -1 so that it is not tablable\r\n\t\t\tdomAttr.set(renderer, \"tabindex\", \"-1\");\r\n\t\t\treturn renderer;\r\n\t\t},\r\n\t\t\r\n\t\t_onMouseDown: function(e){\r\n\t\t\tthis.domNode.focus();\r\n\t\t},\r\n\t\r\n\t\t_onKeyDown: function(e){\r\n\t\t\tvar selected = this.get(\"selectedItem\");\r\n\t\t\tif(!selected){\r\n\t\t\t\t// nothing selected selected we can't navigate\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar renderer = this.itemToRenderer[this.getIdentity(selected)];\r\n\t\t\tvar parent = renderer.parentItem;\r\n\t\t\tvar children, childrenI, selectedI;\r\n\t\t\t// we also need items to be sorted out\r\n\t\t\tif(e.keyCode != keys.UP_ARROW && e.keyCode != keys.NUMPAD_MINUS &&\r\n\t\t\t\te.keyCode != keys.NUMPAD_PLUS){\r\n\t\t\t\tchildren = (e.keyCode == keys.DOWN_ARROW)?selected.children:parent.children;\r\n\t\t\t\tif(children){\r\n\t\t\t\t\tchildrenI = utils.initElements(children, lang.hitch(this,\r\n\t\t\t\t\t\tthis._computeAreaForItem)).elements;\r\n\t\t\t\t\tselectedI = childrenI[arr.indexOf(children, selected)];\r\n\t\t\t\t\tchildrenI.sort(function(a, b){\r\n\t\t\t\t\t\treturn b.size - a.size;\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar newSelected;\r\n\t\t\tswitch(e.keyCode){\r\n\t\t\t\tcase keys.LEFT_ARROW:\r\n\t\t\t\tnewSelected = children[childrenI[Math.max(0, arr.indexOf(childrenI, selectedI)-1)].index];\t\t\t\t\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase keys.RIGHT_ARROW:\r\n\t\t\t\tnewSelected = children[childrenI[Math.min(childrenI.length-1, arr.indexOf(childrenI, selectedI)+1)].index];\t\t\t\t\t\t\t\t\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase keys.DOWN_ARROW:\r\n\t\t\t\tnewSelected = children[childrenI[0].index];\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase keys.UP_ARROW:\r\n\t\t\t\tnewSelected = parent;\r\n\t\t\t\tbreak;\r\n\t\t\t\t// TODO\r\n\t\t\t\t//case \"+\":\r\n\t\t\t\tcase keys.NUMPAD_PLUS:\r\n\t\t\t\tif(!this._isLeaf(selected) && this.drillDown){\r\n\t\t\t\t\tthis.drillDown(renderer);\r\n\t\t\t\t\tevent.stop(e);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\t// TODO\r\n\t\t\t\t//case \"-\":\r\n\t\t\t\tcase keys.NUMPAD_MINUS:\r\n\t\t\t\tif(!this._isLeaf(selected) && this.drillUp){\r\n\t\t\t\t\tthis.drillUp(renderer);\r\n\t\t\t\t\tevent.stop(e);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(newSelected){\r\n\t\t\t\tif(!this._isRoot(newSelected)){\r\n\t\t\t\t\tthis.set(\"selectedItem\", newSelected);\r\n\t\t\t\t\tevent.stop(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n});"]}