{"version":3,"sources":["io/tests/xhrPlugins.js"],"names":["define","doh","dojo","xhr","xhrPlugins","addCrossSiteXhr","url","moduleUrl","toString","register","t","d","Deferred","addCallback","result","callback","match","dfd","e","message","addProxy"],"mappings":";;;;;;;AAAAA,QAAQ,MAAO,oBAAqB,iBAAkB,sBAAuB,kBAAmB,SAASC,EAAKC,EAAMC,EAAKC,GAEzHA,EAAWC,gBAAgB,gCAC3B,IAAIC,EAAMJ,EAAKK,UAAU,WAAY,uBACrCD,EAAMA,EAAIE,WAEVP,EAAIQ,SAAS,6BACZ,SAAkBC,GACjB,IAAIC,EAAI,IAAIV,EAAIW,SAKhB,OAJUT,EAAI,OAAOG,IAAIA,IACrBO,YAAY,SAASC,GACxBH,EAAEI,SAASD,EAAOE,MAAM,eAElBL,GAGR,SAA0BD,GAGzB,IAAIC,EAAI,IAAIV,EAAIW,SAEhBR,EAAWC,gBAAgB,iCAC3B,IACC,IAAIY,EAAMd,EAAI,OAAOG,IAAI,qCAE1B,MAAOY,GACN,GAAGA,EAAEC,QAAQH,MAAM,YAClB,OAAO,EAER,MAAME,EAcP,OAZAD,EAAIJ,YAAY,SAASC,GACxBH,EAAEI,SAASD,EAAOE,MAAM,gBAWlBL,GAER,SAAwBD,GACvB,IAAIC,EAAI,IAAIV,EAAIW,SAOhB,OANAR,EAAWgB,SAASd,EAAI,SAEdH,EAAI,OAAOG,IAAI,mCACrBO,YAAY,SAASC,GACxBH,EAAEI,SAASD,EAAOE,MAAM,cAElBL","file":"../../../io/tests/xhrPlugins.js","sourcesContent":["define(['doh', 'dojo/_base/kernel', 'dojo/_base/xhr', 'dojox/io/xhrPlugins', 'dojo/_base/url'], function(doh, dojo, xhr, xhrPlugins){\r\n\r\nxhrPlugins.addCrossSiteXhr(\"http://cssupportingsite.com/\"); // make sure the registry is setup\r\nvar url = dojo.moduleUrl(\"dojox.io\", \"tests/crossSite.php\");\r\nurl = url.toString();\r\n\r\ndoh.register(\"dojox.io.tests.xhrPlugins\", [\r\n\tfunction getLocal(t){\r\n\t\tvar d = new doh.Deferred();\r\n\t\tvar dfd = xhr(\"GET\",{url:url});\r\n\t\tdfd.addCallback(function(result){\r\n\t\t\td.callback(result.match(/response/));\r\n\t\t});\r\n\t\treturn d;\r\n\t},\r\n\r\n\tfunction crossSiteRequest(t){\r\n\t\t// Note: this isn't really testing much unless you are using IE8 (XDomainRequest) or a\r\n\t\t// browser that supports cross-site XHR (maybe FF3.1?)\r\n\t\tvar d = new doh.Deferred();\r\n\t\t// persevere supports cross-site XHR so we can use it for cross-site testing for now\r\n\t\txhrPlugins.addCrossSiteXhr(\"http://persevere.sitepen.com/\");\r\n\t\ttry {\r\n\t\t\tvar dfd = xhr(\"GET\",{url:\"http://persevere.sitepen.com/SMD\"});\r\n\t\t}\r\n\t\tcatch (e){\r\n\t\t\tif(e.message.match(/No match/)){\r\n\t\t\t\treturn false; // this browser doesn't support this transport\r\n\t\t\t}\r\n\t\t\tthrow e;\r\n\t\t}\r\n\t\tdfd.addCallback(function(result){\r\n\t\t\td.callback(result.match(/transport/));\r\n\t\t});\r\n\t\t// TODO: This should run off a fixed URL on some Dojo server.\r\n\t\t\r\n/*\t\txhrPlugins.addXdr(\"http://dojotoolkit.org/...\");\r\n\t\txhrPlugins.addCrossSiteXhr(\"http://dojotoolkit.org/...\");\r\n\t\t\t\t\r\n\t\tvar dfd = xhr(\"GET\",{url:\"http://dojotoolkit.org/.../dojox/io/tests/crossSite.php\"});\r\n\t\tdfd.addCallback(function(result){\r\n\t\t\td.callback(result.match(/response/));\r\n\t\t}); */\r\n\t\treturn d;\r\n\t},\r\n\tfunction proxiedRequest(t){\r\n\t\tvar d = new doh.Deferred();\r\n\t\txhrPlugins.addProxy(url+\"?url=\");\r\n\r\n\t\tvar dfd = xhr(\"GET\",{url:\"http://someforeignsite.com/SMD\"});\r\n\t\tdfd.addCallback(function(result){\r\n\t\t\td.callback(result.match(/proxied/));\r\n\t\t});\r\n\t\treturn d;\r\n\t}\r\n]);\r\n\r\n});\r\n"]}