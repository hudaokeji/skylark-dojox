{"version":3,"sources":["grid/_FocusManager.js"],"names":["define","array","lang","declare","connect","event","has","query","util","html","constructor","inGrid","this","grid","cell","rowIndex","_connects","_headerConnects","headerMenu","push","domNode","lastFocusNode","destroy","forEach","disconnect","_colHeadNode","_colHeadFocusIdx","_contextMenuBindNode","tabbingOut","focusClass","focusView","initFocusView","views","getFirstScrollingView","_initColumnHeaders","isFocusCell","inCell","inRowIndex","isLastFocusCell","rowCount","index","layout","cellCount","isFirstFocusCell","isNoFocusCell","isNavHeader","getHeaderIndex","indexOf","_findHeaderCells","_focusifyCellNode","inBork","n","getNode","toggleClass","sl","scrollIntoView","edit","isEditing","fire","view","scrollboxNode","scrollLeft","e","_delayedCellFocus","focused","blurHeader","_delayedHeaderFocus","focusHeader","headers","i","length","allHeads","viewsHeaderNode","aHead","hasTabIdx","hasAttr","tabindex","attr","_setActiveColHeader","colHeaderNode","colFocusIdx","prevColFocusIdx","setAttribute","id","_scrollHeader","info","_scrollInfo","s","rt","scroller","findScrollTop","sr","offsetLeft","offsetWidth","l","w","r","offsetHeight","t","h","setScrollTop","cl","sbn","sbnr","clientWidth","scrollTop","clientHeight","rn","getRowNode","c","currentIdx","getCell","scroll","headerNode","_isHeaderHidden","curView","cView","getComputedStyle","display","colSizeAdjust","colIdx","delta","header","tableMap","map","curHeader","content","baseDecorateEvent","cellNode","cellIndex","getCellNodeIndex","canResize","deltaObj","drag","colResizeSetup","doResizeColumn","update","styleRow","inRow","setFocusIndex","inCellIndex","setFocusCell","focusGridView","setTimeout","hitch","onCellFocus","next","row","col","cc","rc","nextCell","editable","canEdit","previous","prevCell","move","inRowDelta","inColDelta","colDir","savedIdx","style","sc","Math","min","max","getLastPageRow","page","getPageRow","hidden","updateRow","previousKey","stop","tabOut","focus","nextKey","target","findAndFocusGridCell","inFocusNode","focusGrid","inSkipFocusCell","didFocus","isEmpty","cellIdx","rowNodes","scrollToRow","headerNodes","saveColHeadFocusIdx","unBindDomNode","bindDomNode","removeClass","removeAttr","viewsHeader","doFocus","currentTarget","_clickFocus","doBlur","doContextMenu","doLastNodeFocus","doLastNodeBlur","doColHeaderFocus","doColHeaderBlur","_mouseDown","dojo","some","v","_mouseUp"],"mappings":"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","file":"../../grid/_FocusManager.js","sourcesContent":["define([\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/_base/sniff\",\r\n\t\"dojo/query\",\r\n\t\"./util\",\r\n\t\"dojo/_base/html\"\r\n], function(array, lang, declare, connect, event, has, query, util, html){\r\n\r\n// focus management\r\nreturn declare(\"dojox.grid._FocusManager\", null, {\r\n\t// summary:\r\n\t//\t\tControls grid cell focus. Owned by grid and used internally for focusing.\r\n\t//\t\tNote: grid cell actually receives keyboard input only when cell is being edited.\r\n\tconstructor: function(inGrid){\r\n\t\tthis.grid = inGrid;\r\n\t\tthis.cell = null;\r\n\t\tthis.rowIndex = -1;\r\n\t\tthis._connects = [];\r\n\t\tthis._headerConnects = [];\r\n\t\tthis.headerMenu = this.grid.headerMenu;\r\n\t\tthis._connects.push(connect.connect(this.grid.domNode, \"onfocus\", this, \"doFocus\"));\r\n\t\tthis._connects.push(connect.connect(this.grid.domNode, \"onblur\", this, \"doBlur\"));\r\n\t\tthis._connects.push(connect.connect(this.grid.domNode, \"mousedown\", this, \"_mouseDown\"));\r\n\t\tthis._connects.push(connect.connect(this.grid.domNode, \"mouseup\", this, \"_mouseUp\"));\r\n\t\tthis._connects.push(connect.connect(this.grid.domNode, \"oncontextmenu\", this, \"doContextMenu\"));\r\n\t\tthis._connects.push(connect.connect(this.grid.lastFocusNode, \"onfocus\", this, \"doLastNodeFocus\"));\r\n\t\tthis._connects.push(connect.connect(this.grid.lastFocusNode, \"onblur\", this, \"doLastNodeBlur\"));\r\n\t\tthis._connects.push(connect.connect(this.grid,\"_onFetchComplete\", this, \"_delayedCellFocus\"));\r\n\t\tthis._connects.push(connect.connect(this.grid,\"postrender\", this, \"_delayedHeaderFocus\"));\r\n\t},\r\n\tdestroy: function(){\r\n\t\tarray.forEach(this._connects, connect.disconnect);\r\n\t\tarray.forEach(this._headerConnects, connect.disconnect);\r\n\t\tdelete this.grid;\r\n\t\tdelete this.cell;\r\n\t},\r\n\t_colHeadNode: null,\r\n\t_colHeadFocusIdx: null,\r\n\t_contextMenuBindNode: null,\r\n\ttabbingOut: false,\r\n\tfocusClass: \"dojoxGridCellFocus\",\r\n\tfocusView: null,\r\n\tinitFocusView: function(){\r\n\t\tthis.focusView = this.grid.views.getFirstScrollingView() || this.focusView || this.grid.views.views[0];\r\n\t\tthis._initColumnHeaders();\r\n\t},\r\n\tisFocusCell: function(inCell, inRowIndex){\r\n\t\t// summary:\r\n\t\t//\t\tstates if the given cell is focused\r\n\t\t// inCell: object\r\n\t\t//\t\tgrid cell object\r\n\t\t// inRowIndex: int\r\n\t\t//\t\tgrid row index\r\n\t\t// returns:\r\n\t\t//\t\ttrue of the given grid cell is focused\r\n\t\treturn (this.cell == inCell) && (this.rowIndex == inRowIndex);\r\n\t},\r\n\tisLastFocusCell: function(){\r\n\t\tif(this.cell){\r\n\t\t\treturn (this.rowIndex == this.grid.rowCount-1) && (this.cell.index == this.grid.layout.cellCount-1);\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\tisFirstFocusCell: function(){\r\n\t\tif(this.cell){\r\n\t\t\treturn (this.rowIndex === 0) && (this.cell.index === 0);\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\tisNoFocusCell: function(){\r\n\t\treturn (this.rowIndex < 0) || !this.cell;\r\n\t},\r\n\tisNavHeader: function(){\r\n\t\t// summary:\r\n\t\t//\t\tstates whether currently navigating among column headers.\r\n\t\t// returns:\r\n\t\t//\t\ttrue if focus is on a column header; false otherwise.\r\n\t\treturn (!!this._colHeadNode);\r\n\t},\r\n\tgetHeaderIndex: function(){\r\n\t\t// summary:\r\n\t\t//\t\tif one of the column headers currently has focus, return its index.\r\n\t\t// returns:\r\n\t\t//\t\tindex of the focused column header, or -1 if none have focus.\r\n\t\tif(this._colHeadNode){\r\n\t\t\treturn array.indexOf(this._findHeaderCells(), this._colHeadNode);\r\n\t\t}else{\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t},\r\n\t_focusifyCellNode: function(inBork){\r\n\t\tvar n = this.cell && this.cell.getNode(this.rowIndex);\r\n\t\tif(n){\r\n\t\t\thtml.toggleClass(n, this.focusClass, inBork);\r\n\t\t\tif(inBork){\r\n\t\t\t\tvar sl = this.scrollIntoView();\r\n\t\t\t\ttry{\r\n\t\t\t\t\tif(has(\"webkit\") || !this.grid.edit.isEditing()){\r\n\t\t\t\t\t\tutil.fire(n, \"focus\");\r\n\t\t\t\t\t\tif(sl){ this.cell.view.scrollboxNode.scrollLeft = sl; }\r\n\t\t\t\t\t}\r\n\t\t\t\t}catch(e){}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_delayedCellFocus: function(){\r\n\t\tif(this.isNavHeader()||!this.grid.focused){\r\n\t\t\t\treturn;\r\n\t\t}\r\n\t\tvar n = this.cell && this.cell.getNode(this.rowIndex);\r\n\t\tif(n){\r\n\t\t\ttry{\r\n\t\t\t\tif(!this.grid.edit.isEditing()){\r\n\t\t\t\t\thtml.toggleClass(n, this.focusClass, true);\r\n\t\t\t\t\tif(this._colHeadNode){\r\n\t\t\t\t\t\tthis.blurHeader();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tutil.fire(n, \"focus\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcatch(e){}\r\n\t\t}\r\n\t},\r\n\t_delayedHeaderFocus: function(){\r\n\t\tif(this.isNavHeader()){\r\n\t\t\tthis.focusHeader();\r\n\t\t\t//this.grid.domNode.focus();\r\n\t\t}\r\n\t},\r\n\t_initColumnHeaders: function(){\r\n\t\tarray.forEach(this._headerConnects, connect.disconnect);\r\n\t\tthis._headerConnects = [];\r\n\t\tvar headers = this._findHeaderCells();\r\n\t\tfor(var i = 0; i < headers.length; i++){\r\n\t\t\tthis._headerConnects.push(connect.connect(headers[i], \"onfocus\", this, \"doColHeaderFocus\"));\r\n\t\t\tthis._headerConnects.push(connect.connect(headers[i], \"onblur\", this, \"doColHeaderBlur\"));\r\n\t\t}\r\n\t},\r\n\t_findHeaderCells: function(){\r\n\t\t// This should be a one liner:\r\n\t\t//\tquery(\"th[tabindex=-1]\", this.grid.viewsHeaderNode);\r\n\t\t// But there is a bug in query() for IE -- see trac #7037.\r\n\t\tvar allHeads = query(\"th\", this.grid.viewsHeaderNode);\r\n\t\tvar headers = [];\r\n\t\tfor (var i = 0; i < allHeads.length; i++){\r\n\t\t\tvar aHead = allHeads[i];\r\n\t\t\tvar hasTabIdx = html.hasAttr(aHead, \"tabIndex\");\r\n\t\t\tvar tabindex = html.attr(aHead, \"tabIndex\");\r\n\t\t\tif (hasTabIdx && tabindex < 0) {\r\n\t\t\t\theaders.push(aHead);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn headers;\r\n\t},\r\n\t_setActiveColHeader: function(/*Node*/colHeaderNode, /*Integer*/colFocusIdx, /*Integer*/ prevColFocusIdx){\r\n\t\t//console.log(\"setActiveColHeader() - colHeaderNode:colFocusIdx:prevColFocusIdx = \" + colHeaderNode + \":\" + colFocusIdx + \":\" + prevColFocusIdx);\r\n\t\tthis.grid.domNode.setAttribute(\"aria-activedescendant\",colHeaderNode.id);\r\n\t\tif (prevColFocusIdx != null && prevColFocusIdx >= 0 && prevColFocusIdx != colFocusIdx){\r\n\t\t\thtml.toggleClass(this._findHeaderCells()[prevColFocusIdx],this.focusClass,false);\r\n\t\t}\r\n\t\thtml.toggleClass(colHeaderNode,this.focusClass, true);\r\n\t\tthis._colHeadNode = colHeaderNode;\r\n\t\tthis._colHeadFocusIdx = colFocusIdx;\r\n\t\tthis._scrollHeader(this._colHeadFocusIdx);\r\n\t},\r\n\tscrollIntoView: function(){\r\n\t\tvar info = (this.cell ? this._scrollInfo(this.cell) : null);\r\n\t\tif(!info || !info.s){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar rt = this.grid.scroller.findScrollTop(this.rowIndex);\r\n\t\t// place cell within horizontal view\r\n\t\tif(info.n && info.sr){\r\n\t\t\tif(info.n.offsetLeft + info.n.offsetWidth > info.sr.l + info.sr.w){\r\n\t\t\t\tinfo.s.scrollLeft = info.n.offsetLeft + info.n.offsetWidth - info.sr.w;\r\n\t\t\t}else if(info.n.offsetLeft < info.sr.l){\r\n\t\t\t\tinfo.s.scrollLeft = info.n.offsetLeft;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// place cell within vertical view\r\n\t\tif(info.r && info.sr){\r\n\t\t\tif(rt + info.r.offsetHeight > info.sr.t + info.sr.h){\r\n\t\t\t\tthis.grid.setScrollTop(rt + info.r.offsetHeight - info.sr.h);\r\n\t\t\t}else if(rt < info.sr.t){\r\n\t\t\t\tthis.grid.setScrollTop(rt);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn info.s.scrollLeft;\r\n\t},\r\n\t_scrollInfo: function(cell, domNode){\r\n\t\tif(cell){\r\n\t\t\tvar cl = cell,\r\n\t\t\t\tsbn = cl.view.scrollboxNode,\r\n\t\t\t\tsbnr = {\r\n\t\t\t\t\tw: sbn.clientWidth,\r\n\t\t\t\t\tl: sbn.scrollLeft,\r\n\t\t\t\t\tt: sbn.scrollTop,\r\n\t\t\t\t\th: sbn.clientHeight\r\n\t\t\t\t},\r\n\t\t\t\trn = cl.view.getRowNode(this.rowIndex);\r\n\t\t\treturn {\r\n\t\t\t\tc: cl,\r\n\t\t\t\ts: sbn,\r\n\t\t\t\tsr: sbnr,\r\n\t\t\t\tn: (domNode ? domNode : cell.getNode(this.rowIndex)),\r\n\t\t\t\tr: rn\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t_scrollHeader: function(currentIdx){\r\n\t\tvar info = null;\r\n\t\tif(this._colHeadNode){\r\n\t\t\tvar cell = this.grid.getCell(currentIdx);\r\n\t\t\tif(!cell){ return; }\r\n\t\t\tinfo = this._scrollInfo(cell, cell.getNode(0));\r\n\t\t}\r\n\t\tif(info && info.s && info.sr && info.n){\r\n\t\t\t// scroll horizontally as needed.\r\n\t\t\tvar scroll = info.sr.l + info.sr.w;\r\n\t\t\tif(info.n.offsetLeft + info.n.offsetWidth > scroll){\r\n\t\t\t\tinfo.s.scrollLeft = info.n.offsetLeft + info.n.offsetWidth - info.sr.w;\r\n\t\t\t}else if(info.n.offsetLeft < info.sr.l){\r\n\t\t\t\tinfo.s.scrollLeft = info.n.offsetLeft;\r\n\t\t\t}else if(has('ie') <= 7 && cell && cell.view.headerNode){\r\n\t\t\t\t// Trac 7158: scroll dojoxGridHeader for IE7 and lower\r\n\t\t\t\tcell.view.headerNode.scrollLeft = info.s.scrollLeft;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_isHeaderHidden: function(){\r\n\t\t// summary:\r\n\t\t//\t\tdetermine if the grid headers are hidden\r\n\t\t//\t\trelies on documented technique of setting .dojoxGridHeader { display:none; }\r\n\t\t// returns: Boolean\r\n\t\t//\t\ttrue if headers are hidden\r\n\t\t//\t\tfalse if headers are not hidden\r\n\t\t\r\n\t\tvar curView = this.focusView;\r\n\t\tif (!curView){\r\n\t\t\t// find one so we can determine if headers are hidden\r\n\t\t\t// there is no focusView after adding items to empty grid (test_data_grid_empty.html)\r\n\t\t\tfor (var i = 0, cView; (cView = this.grid.views.views[i]); i++) {\r\n\t\t\t\tif(cView.headerNode ){\r\n\t\t\t\t\tcurView=cView;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn (curView && html.getComputedStyle(curView.headerNode).display == \"none\");\r\n\t},\r\n\tcolSizeAdjust: function (e, colIdx, delta){ // adjust the column specified by colIdx by the specified delta px\r\n\t\tvar headers = this._findHeaderCells();\r\n\t\tvar view = this.focusView;\r\n\t\tif(!view || !view.header.tableMap.map){\r\n\t\t\tfor(var i = 0, cView; (cView = this.grid.views.views[i]); i++){\r\n\t\t\t\t// find first view with a tableMap in order to work with empty grid\r\n\t\t\t\tif(cView.header.tableMap.map){\r\n\t\t\t\t\tview=cView;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar curHeader = headers[colIdx];\r\n\t\tif (!view || (colIdx == headers.length-1 && colIdx === 0)){\r\n\t\t\treturn; // can't adjust single col. grid\r\n\t\t}\r\n\t\tview.content.baseDecorateEvent(e);\r\n\t\t// need to adjust event with header cell info since focus is no longer on header cell\r\n\t\te.cellNode = curHeader; //this.findCellTarget(e.target, e.rowNode);\r\n\t\te.cellIndex = view.content.getCellNodeIndex(e.cellNode);\r\n\t\te.cell = (e.cellIndex >= 0 ? this.grid.getCell(e.cellIndex) : null);\r\n\t\tif (view.header.canResize(e)){\r\n\t\t\tvar deltaObj = {\r\n\t\t\t\tl: delta\r\n\t\t\t};\r\n\t\t\tvar drag = view.header.colResizeSetup(e,false);\r\n\t\t\tview.header.doResizeColumn(drag, null, deltaObj);\r\n\t\t\tview.update();\r\n\t\t}\r\n\t},\r\n\tstyleRow: function(inRow){\r\n\t\treturn;\r\n\t},\r\n\tsetFocusIndex: function(inRowIndex, inCellIndex){\r\n\t\t// summary:\r\n\t\t//\t\tfocuses the given grid cell\r\n\t\t// inRowIndex: int\r\n\t\t//\t\tgrid row index\r\n\t\t// inCellIndex: int\r\n\t\t//\t\tgrid cell index\r\n\t\tthis.setFocusCell(this.grid.getCell(inCellIndex), inRowIndex);\r\n\t},\r\n\tsetFocusCell: function(inCell, inRowIndex){\r\n\t\t// summary:\r\n\t\t//\t\tfocuses the given grid cell\r\n\t\t// inCell: object\r\n\t\t//\t\tgrid cell object\r\n\t\t// inRowIndex: int\r\n\t\t//\t\tgrid row index\r\n\t\tif(inCell && !this.isFocusCell(inCell, inRowIndex)){\r\n\t\t\tthis.tabbingOut = false;\r\n\t\t\tif (this._colHeadNode){\r\n\t\t\t\tthis.blurHeader();\r\n\t\t\t}\r\n\t\t\tthis._colHeadNode = this._colHeadFocusIdx = null;\r\n\t\t\tthis.focusGridView();\r\n\t\t\tthis._focusifyCellNode(false);\r\n\t\t\tthis.cell = inCell;\r\n\t\t\tthis.rowIndex = inRowIndex;\r\n\t\t\tthis._focusifyCellNode(true);\r\n\t\t}\r\n\t\t// even if this cell isFocusCell, the document focus may need to be rejiggered\r\n\t\t// call opera on delay to prevent keypress from altering focus\r\n\t\tif(has('opera')){\r\n\t\t\tsetTimeout(lang.hitch(this.grid, 'onCellFocus', this.cell, this.rowIndex), 1);\r\n\t\t}else{\r\n\t\t\tthis.grid.onCellFocus(this.cell, this.rowIndex);\r\n\t\t}\r\n\t},\r\n\tnext: function(){\r\n\t\t// summary:\r\n\t\t//\tfocus next grid cell\r\n\t\tif(this.cell){\r\n\t\t\tvar row=this.rowIndex, col=this.cell.index+1, cc=this.grid.layout.cellCount-1, rc=this.grid.rowCount-1;\r\n\t\t\tif(col > cc){\r\n\t\t\t\tcol = 0;\r\n\t\t\t\trow++;\r\n\t\t\t}\r\n\t\t\tif(row > rc){\r\n\t\t\t\tcol = cc;\r\n\t\t\t\trow = rc;\r\n\t\t\t}\r\n\t\t\tif(this.grid.edit.isEditing()){ //when editing, only navigate to editable cells\r\n\t\t\t\tvar nextCell = this.grid.getCell(col);\r\n\t\t\t\tif (!this.isLastFocusCell() && (!nextCell.editable ||\r\n\t\t\t\t\tthis.grid.canEdit && !this.grid.canEdit(nextCell, row))){\r\n\t\t\t\t\tthis.cell=nextCell;\r\n\t\t\t\t\tthis.rowIndex=row;\r\n\t\t\t\t\tthis.next();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.setFocusIndex(row, col);\r\n\t\t}\r\n\t},\r\n\tprevious: function(){\r\n\t\t// summary:\r\n\t\t//\tfocus previous grid cell\r\n\t\tif(this.cell){\r\n\t\t\tvar row=(this.rowIndex || 0), col=(this.cell.index || 0) - 1;\r\n\t\t\tif(col < 0){\r\n\t\t\t\tcol = this.grid.layout.cellCount-1;\r\n\t\t\t\trow--;\r\n\t\t\t}\r\n\t\t\tif(row < 0){\r\n\t\t\t\trow = 0;\r\n\t\t\t\tcol = 0;\r\n\t\t\t}\r\n\t\t\tif(this.grid.edit.isEditing()){ //when editing, only navigate to editable cells\r\n\t\t\t\tvar prevCell = this.grid.getCell(col);\r\n\t\t\t\tif (!this.isFirstFocusCell() && !prevCell.editable){\r\n\t\t\t\t\tthis.cell=prevCell;\r\n\t\t\t\t\tthis.rowIndex=row;\r\n\t\t\t\t\tthis.previous();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.setFocusIndex(row, col);\r\n\t\t}\r\n\t},\r\n\tmove: function(inRowDelta, inColDelta) {\r\n\t\t// summary:\r\n\t\t//\t\tfocus grid cell or  simulate focus to column header based on position relative to current focus\r\n\t\t// inRowDelta: int\r\n\t\t//\t\tvertical distance from current focus\r\n\t\t// inColDelta: int\r\n\t\t//\t\thorizontal distance from current focus\r\n\r\n\t\tvar colDir = inColDelta < 0 ? -1 : 1;\r\n\t\t// Handle column headers.\r\n\t\tif(this.isNavHeader()){\r\n\t\t\tvar headers = this._findHeaderCells();\r\n\t\t\tvar savedIdx = currentIdx = array.indexOf(headers, this._colHeadNode);\r\n\t\t\tcurrentIdx += inColDelta;\r\n\t\t\twhile(currentIdx >=0 && currentIdx < headers.length && headers[currentIdx].style.display == \"none\"){\r\n\t\t\t\t// skip over hidden column headers\r\n\t\t\t\tcurrentIdx += colDir;\r\n\t\t\t}\r\n\t\t\tif((currentIdx >= 0) && (currentIdx < headers.length)){\r\n\t\t\t\tthis._setActiveColHeader(headers[currentIdx],currentIdx, savedIdx);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif(this.cell){\r\n\t\t\t\t// Handle grid proper.\r\n\t\t\t\tvar sc = this.grid.scroller,\r\n\t\t\t\t\tr = this.rowIndex,\r\n\t\t\t\t\trc = this.grid.rowCount-1,\r\n\t\t\t\t\trow = Math.min(rc, Math.max(0, r+inRowDelta));\r\n\t\t\t\tif(inRowDelta){\r\n\t\t\t\t\tif(inRowDelta>0){\r\n\t\t\t\t\t\tif(row > sc.getLastPageRow(sc.page)){\r\n\t\t\t\t\t\t\t//need to load additional data, let scroller do that\r\n\t\t\t\t\t\t\tthis.grid.setScrollTop(this.grid.scrollTop+sc.findScrollTop(row)-sc.findScrollTop(r));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else if(inRowDelta<0){\r\n\t\t\t\t\t\tif(row <= sc.getPageRow(sc.page)){\r\n\t\t\t\t\t\t\t//need to load additional data, let scroller do that\r\n\t\t\t\t\t\t\tthis.grid.setScrollTop(this.grid.scrollTop-sc.findScrollTop(r)-sc.findScrollTop(row));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar cc = this.grid.layout.cellCount-1,\r\n\t\t\t\ti = this.cell.index,\r\n\t\t\t\tcol = Math.min(cc, Math.max(0, i+inColDelta));\r\n\t\t\t\tvar cell = this.grid.getCell(col);\r\n\t\t\t\twhile(col>=0 && col < cc && cell && cell.hidden === true){\r\n\t\t\t\t\t// skip hidden cells\r\n\t\t\t\t\tcol += colDir;\r\n\t\t\t\t\tcell = this.grid.getCell(col);\r\n\t\t\t\t}\r\n\t\t\t\tif (!cell || cell.hidden === true){\r\n\t\t\t\t\t// don't change col if would move to hidden\r\n\t\t\t\t\tcol = i;\r\n\t\t\t\t}\r\n\t\t\t\t//skip hidden row|cell\r\n\t\t\t\tvar n = cell.getNode(row);\r\n\t\t\t\tif(!n && inRowDelta){\r\n\t\t\t\t\tif((row + inRowDelta) >= 0 && (row + inRowDelta) <= rc){\r\n\t\t\t\t\t\tthis.move(inRowDelta > 0 ? ++inRowDelta : --inRowDelta, inColDelta);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}else if((!n || html.style(n, \"display\") === \"none\") && inColDelta){\r\n\t\t\t\t\tif((col + inColDelta) >= 0 && (col + inColDelta) <= cc){\r\n\t\t\t\t\t\tthis.move(inRowDelta, inColDelta > 0 ? ++inColDelta : --inColDelta);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.setFocusIndex(row, col);\r\n\t\t\t\tif(inRowDelta){\r\n\t\t\t\t\tthis.grid.updateRow(r);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tpreviousKey: function(e){\r\n\t\tif(this.grid.edit.isEditing()){\r\n\t\t\tevent.stop(e);\r\n\t\t\tthis.previous();\r\n\t\t}else if(!this.isNavHeader() && !this._isHeaderHidden()) {\r\n\t\t\tthis.grid.domNode.focus(); // will call doFocus and set focus into header.\r\n\t\t\tevent.stop(e);\r\n\t\t}else{\r\n\t\t\tthis.tabOut(this.grid.domNode);\r\n\t\t\tif (this._colHeadFocusIdx != null) { // clear grid header focus\r\n\t\t\t\thtml.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx], this.focusClass, false);\r\n\t\t\t\tthis._colHeadFocusIdx = null;\r\n\t\t\t}\r\n\t\t\tthis._focusifyCellNode(false);\r\n\t\t}\r\n\t},\r\n\tnextKey: function(e) {\r\n\t\tvar isEmpty = (this.grid.rowCount === 0);\r\n\t\tif(e.target === this.grid.domNode && this._colHeadFocusIdx == null){\r\n\t\t\tthis.focusHeader();\r\n\t\t\tevent.stop(e);\r\n\t\t}else if(this.isNavHeader()){\r\n\t\t\t// if tabbing from col header, then go to grid proper.\r\n\t\t\tthis.blurHeader();\r\n\t\t\tif(!this.findAndFocusGridCell()){\r\n\t\t\t\tthis.tabOut(this.grid.lastFocusNode);\r\n\t\t\t}\r\n\t\t\tthis._colHeadNode = this._colHeadFocusIdx= null;\r\n\t\t}else if(this.grid.edit.isEditing()){\r\n\t\t\tevent.stop(e);\r\n\t\t\tthis.next();\r\n\t\t}else{\r\n\t\t\tthis.tabOut(this.grid.lastFocusNode);\r\n\t\t}\r\n\t},\r\n\ttabOut: function(inFocusNode){\r\n\t\tthis.tabbingOut = true;\r\n\t\tinFocusNode.focus();\r\n\t},\r\n\tfocusGridView: function(){\r\n\t\tutil.fire(this.focusView, \"focus\");\r\n\t},\r\n\tfocusGrid: function(inSkipFocusCell){\r\n\t\tthis.focusGridView();\r\n\t\tthis._focusifyCellNode(true);\r\n\t},\r\n\tfindAndFocusGridCell: function(){\r\n\t\t// summary:\r\n\t\t//\t\tfind the first focusable grid cell\r\n\t\t// returns: Boolean\r\n\t\t//\t\ttrue if focus was set to a cell\r\n\t\t//\t\tfalse if no cell found to set focus onto\r\n\t\t\r\n\t\tvar didFocus = true;\r\n\t\tvar isEmpty = (this.grid.rowCount === 0); // If grid is empty this.grid.rowCount == 0\r\n\t\tif (this.isNoFocusCell() && !isEmpty){\r\n\t\t\tvar cellIdx = 0;\r\n\t\t\tvar cell = this.grid.getCell(cellIdx);\r\n\t\t\tif (cell.hidden) {\r\n\t\t\t\t// if first cell isn't visible, use _colHeadFocusIdx\r\n\t\t\t\t// could also use a while loop to find first visible cell - not sure that is worth it\r\n\t\t\t\tcellIdx = this.isNavHeader() ? this._colHeadFocusIdx : 0;\r\n\t\t\t}\r\n\t\t\tthis.setFocusIndex(0, cellIdx);\r\n\t\t}\r\n\t\telse if (this.cell && !isEmpty){\r\n\t\t\tif (this.focusView && !this.focusView.rowNodes[this.rowIndex]){\r\n\t\t\t\t// if rowNode for current index is undefined (likely as a result of a sort and because of #7304)\r\n\t\t\t\t// scroll to that row\r\n\t\t\t\tthis.grid.scrollToRow(this.rowIndex);\r\n\t\t\t}\r\n\t\t\tthis.focusGrid();\r\n\t\t}else {\r\n\t\t\tdidFocus = false;\r\n\t\t}\r\n\t\tthis._colHeadNode = this._colHeadFocusIdx= null;\r\n\t\treturn didFocus;\r\n\t},\r\n\tfocusHeader: function(){\r\n\t\tvar headerNodes = this._findHeaderCells();\r\n\t\tvar saveColHeadFocusIdx = this._colHeadFocusIdx;\r\n\t\tif (this._isHeaderHidden()){\r\n\t\t\t// grid header is hidden, focus a cell\r\n\t\t\tthis.findAndFocusGridCell();\r\n\t\t}\r\n\t\telse if (!this._colHeadFocusIdx) {\r\n\t\t\tif (this.isNoFocusCell()) {\r\n\t\t\t\tthis._colHeadFocusIdx = 0;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._colHeadFocusIdx = this.cell.index;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._colHeadNode = headerNodes[this._colHeadFocusIdx];\r\n\t\twhile(this._colHeadNode && this._colHeadFocusIdx >=0 && this._colHeadFocusIdx < headerNodes.length &&\r\n\t\t\t\tthis._colHeadNode.style.display == \"none\"){\r\n\t\t\t// skip over hidden column headers\r\n\t\t\tthis._colHeadFocusIdx++;\r\n\t\t\tthis._colHeadNode = headerNodes[this._colHeadFocusIdx];\r\n\t\t}\r\n\t\tif(this._colHeadNode && this._colHeadNode.style.display != \"none\"){\r\n\t\t\t// Column header cells know longer receive actual focus.  So, for keyboard invocation of\r\n\t\t\t// contextMenu to work, the contextMenu must be bound to the grid.domNode rather than the viewsHeaderNode.\r\n\t\t\t// unbind the contextmenu from the viewsHeaderNode and to the grid when header cells are active.  Reset\r\n\t\t\t// the binding back to the viewsHeaderNode when header cells are no longer acive (in blurHeader) #10483\r\n\t\t\tif (this.headerMenu && this._contextMenuBindNode != this.grid.domNode){\r\n\t\t\t\tthis.headerMenu.unBindDomNode(this.grid.viewsHeaderNode);\r\n\t\t\t\tthis.headerMenu.bindDomNode(this.grid.domNode);\r\n\t\t\t\tthis._contextMenuBindNode = this.grid.domNode;\r\n\t\t\t}\r\n\t\t\tthis._setActiveColHeader(this._colHeadNode, this._colHeadFocusIdx, saveColHeadFocusIdx);\r\n\t\t\tthis._scrollHeader(this._colHeadFocusIdx);\r\n\t\t\tthis._focusifyCellNode(false);\r\n\t\t}else {\r\n\t\t\t// all col head nodes are hidden - focus the grid\r\n\t\t\tthis.findAndFocusGridCell();\r\n\t\t}\r\n\t},\r\n\tblurHeader: function(){\r\n\t\thtml.removeClass(this._colHeadNode, this.focusClass);\r\n\t\thtml.removeAttr(this.grid.domNode,\"aria-activedescendant\");\r\n\t\t// reset contextMenu onto viewsHeaderNode so right mouse on header will invoke (see focusHeader)\r\n\t\tif (this.headerMenu && this._contextMenuBindNode == this.grid.domNode) {\r\n\t\t\tvar viewsHeader = this.grid.viewsHeaderNode;\r\n\t\t\tthis.headerMenu.unBindDomNode(this.grid.domNode);\r\n\t\t\tthis.headerMenu.bindDomNode(viewsHeader);\r\n\t\t\tthis._contextMenuBindNode = viewsHeader;\r\n\t\t}\r\n\t},\r\n\tdoFocus: function(e){\r\n\t\t// trap focus only for grid dom node\r\n\t\tif(e && e.target != e.currentTarget){\r\n\t\t\tevent.stop(e);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// don't change focus if clicking on scroller bar\r\n\t\tif(this._clickFocus){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// do not focus for scrolling if grid is about to blur\r\n\t\tif(!this.tabbingOut){\r\n\t\t\tthis.focusHeader();\r\n\t\t}\r\n\t\tthis.tabbingOut = false;\r\n\t\tevent.stop(e);\r\n\t},\r\n\tdoBlur: function(e){\r\n\t\tevent.stop(e);\t// FF2\r\n\t},\r\n\tdoContextMenu: function(e){\r\n\t//stop contextMenu event if no header Menu to prevent default/browser contextMenu\r\n\t\tif (!this.headerMenu){\r\n\t\t\tevent.stop(e);\r\n\t\t}\r\n\t},\r\n\tdoLastNodeFocus: function(e){\r\n\t\tif (this.tabbingOut){\r\n\t\t\tthis._focusifyCellNode(false);\r\n\t\t}else if(this.grid.rowCount >0){\r\n\t\t\tif (this.isNoFocusCell()){\r\n\t\t\t\tthis.setFocusIndex(0,0);\r\n\t\t\t}\r\n\t\t\tthis._focusifyCellNode(true);\r\n\t\t}else {\r\n\t\t\tthis.focusHeader();\r\n\t\t}\r\n\t\tthis.tabbingOut = false;\r\n\t\tevent.stop(e);\t // FF2\r\n\t},\r\n\tdoLastNodeBlur: function(e){\r\n\t\tevent.stop(e);\t // FF2\r\n\t},\r\n\tdoColHeaderFocus: function(e){\r\n\t\tthis._setActiveColHeader(e.target,html.attr(e.target, \"idx\"),this._colHeadFocusIdx);\r\n\t\tthis._scrollHeader(this.getHeaderIndex());\r\n\t\tevent.stop(e);\r\n\t},\r\n\tdoColHeaderBlur: function(e){\r\n\t\thtml.toggleClass(e.target, this.focusClass, false);\r\n\t},\r\n\t_mouseDown: function(e){\r\n\t\t// a flag indicating grid is being focused by clicking\r\n\t\tthis._clickFocus = dojo.some(this.grid.views.views, function(v){\r\n\t\t\treturn v.scrollboxNode === e.target;\r\n\t\t});\r\n\t},\r\n\t_mouseUp: function(e){\r\n\t\tthis._clickFocus = false;\r\n\t}\r\n});\r\n});"]}