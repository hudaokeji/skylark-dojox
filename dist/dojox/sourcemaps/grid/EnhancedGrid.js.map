{"version":3,"sources":["grid/EnhancedGrid.js"],"names":["define","dojo","dojox","declare","lang","array","has","dom","domGeometry","DataGrid","DataSelection","_PluginManager","_SelectionPreserver","nls","experimental","EnhancedGrid","plugins","pluginMgr","_pluginMgrClass","postMixInProperties","this","_nls","inherited","arguments","postCreate","preInit","postInit","plugin","name","getPlugin","startup","createSelection","selection","grid","enhanced","canSort","colIndex","field","doKeyEvent","e","view","focus","focusView","content","decorateEvent","cell","header","doApplyCellEdit","inValue","inRowIndex","inAttrName","invalidated","mixin","target","source","props","p","_copyAttr","idx","attr","_getHeaderHeight","getMarginBox","viewsHeaderNode","h","_fetch","start","isRender","items","store","_pending_requests","_isLoaded","_isLoading","showMessage","loadingMessage","req","count","rowsPerPage","query","sort","getSortProps","queryOptions","onBegin","hitch","onComplete","onError","_storeLayerFetch","_onFetchError","fetch","getCellByField","filter","layout","cells","onMouseUp","createView","func","getCellX","x","call","n","inNode","inWhile","parentNode","ascendDom","toUpperCase","node","tagName","isDescendant","firstChild","offsetLeft","destroy","constructor","keepSelection","preserver","_range","inFrom","inTo","_selectingRange","onChanged","deselectAll","inItemOrIndex","markupFactory","ctor","cellFunc","_Grid","partial","cell_markupFactory","registerPlugin","clazz"],"mappings":"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","file":"../../grid/EnhancedGrid.js","sourcesContent":["define([\r\n\t\"dojo/_base/kernel\",\r\n\t\"../main\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/sniff\",\r\n\t\"dojo/dom\",\r\n\t\"dojo/dom-geometry\",\r\n\t\"./DataGrid\",\r\n\t\"./DataSelection\",\r\n\t\"./enhanced/_PluginManager\",\r\n\t\"./enhanced/plugins/_SelectionPreserver\",//default loaded plugin\r\n\t\"dojo/i18n!./enhanced/nls/EnhancedGrid\"\r\n], function(dojo, dojox, declare, lang, array, has, dom, domGeometry,\r\n\tDataGrid, DataSelection, _PluginManager, _SelectionPreserver, nls){\r\n\r\ndojo.experimental(\"dojox.grid.EnhancedGrid\");\r\n\r\nvar EnhancedGrid = declare(\"dojox.grid.EnhancedGrid\", DataGrid, {\r\n\t// summary:\r\n\t//\t\tProvides enhanced features based on DataGrid\r\n\t//\r\n\t// description:\r\n\t//\t\tEnhancedGrid features are implemented as plugins that could be loaded on demand.\r\n\t//\t\tExplicit dojo.require() is needed to use these feature plugins.\r\n\t//\r\n\t// example:\r\n\t//\t\tA quick sample to use EnhancedGrid features:\r\n\t//\r\n\t//\t   Step 1. Load EnhancedGrid and required features\r\n\t// |   <script type=\"text/javascript\">\r\n\t// |\t\tdojo.require(\"dojox.grid.EnhancedGrid\");\r\n\t// |\t\tdojo.require(\"dojox.grid.enhanced.plugins.DnD\");\r\n\t// |\t\tdojo.require(\"dojox.grid.enhanced.plugins.Menu\");\r\n\t// |\t\tdojo.require(\"dojox.grid.enhanced.plugins.NestedSorting\");\r\n\t// |\t\tdojo.require(\"dojox.grid.enhanced.plugins.IndirectSelection\");\r\n\t// |\t</script>\r\n\t//\r\n\t//\t\tStep 2. Use EnhancedGrid\r\n\t//\r\n\t//\t\t- Via HTML markup\r\n\t//\r\n\t// |\t<div dojoType=\"dojox.grid.EnhancedGrid\" ...\r\n\t// |\t\tplugins=\"{nestedSorting: true, dnd: true, indirectSelection: true,\r\n\t// |\t\tmenus:{headerMenu:\"headerMenuId\", rowMenu:\"rowMenuId\", cellMenu:\"cellMenuId\",\r\n\t// |\t\tselectedRegionMenu:\"selectedRegionMenuId\"}}\">\r\n\t// |\t\t\t...\r\n\t// |\t</div>\r\n\t//\r\n\t//\t\t- Or via JavaScript\r\n\t//\r\n\t// |\t<script type=\"text/javascript\">\r\n\t// |\t\tvar grid = new dojox.grid.EnhancedGrid({plugins : {nestedSorting: true, dnd: true, indirectSelection: true,\r\n\t// |\t               menus:{headerMenu:\"headerMenuId\", rowMenu:\"rowMenuId\", cellMenu:\"cellMenuId\",selectedRegionMenu:\"selectedRegionMenuId\"}},\r\n\t// |\t\t\t       ... }, dojo.byId('gridDiv'));\r\n\t// |\t\tgrid.startup();\r\n\t// |\t</script>\r\n\t//\r\n\t//\r\n\t//\t\tPlugin Support\r\n\t//\t\t[Note: Plugin support is still experimental]\r\n\t//\r\n\t//\t\tYou can either customize the default plugins or add new ones, more details please see\r\n\t//\r\n\t//\t\t- dojox.grid.enhanced._PluginManager\r\n\t//\t\t- dojox.grid.enhanced._Plugin\r\n\t//\t\t- dojox.grid.enhanced.plugins.*\r\n\r\n\t// plugins: Object\r\n\t//\t\tPlugin properties, e.g. {nestedSorting: true, dnd: true, ...}\r\n\tplugins: null,\r\n\r\n\t// pluginMgr: Object\r\n\t//\t\tSingleton plugin manager\r\n\tpluginMgr: null,\r\n\r\n\t// _pluginMgrClass: Object\r\n\t//\t\tDefault plugin manager class\r\n\t_pluginMgrClass: _PluginManager,\r\n\r\n\tpostMixInProperties: function(){\r\n\t\tthis._nls = nls;\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\tpostCreate: function(){\r\n\t\t//create plugin manager\r\n\t\tthis.pluginMgr = new this._pluginMgrClass(this);\r\n\t\tthis.pluginMgr.preInit();\r\n\t\tthis.inherited(arguments);\r\n\t\tthis.pluginMgr.postInit();\r\n\t},\r\n\tplugin: function(/*String*/name){\r\n\t\t// summary:\r\n\t\t//\t\tAn easier way for getting a plugin, e.g. grid.plugin('dnd')\r\n\t\treturn this.pluginMgr.getPlugin(name);\r\n\t},\r\n\tstartup: function(){\r\n\t\tthis.inherited(arguments);\r\n\t\tthis.pluginMgr.startup();\r\n\t},\r\n\tcreateSelection: function(){\r\n\t\tthis.selection = new dojox.grid.enhanced.DataSelection(this);\r\n\t},\r\n\tcanSort: function(colIndex, field){\r\n\t\t// summary:\r\n\t\t//\t\tOverwritten\r\n\t\treturn true;\r\n\t},\r\n\tdoKeyEvent: function(e){\r\n\t\t// summary:\r\n\t\t//\t\tOverwritten, see _Grid.doKeyEvent()\r\n\t\ttry{\r\n\t\t\tvar view = this.focus.focusView;\r\n\t\t\tview.content.decorateEvent(e);\r\n\t\t\tif(!e.cell){ view.header.decorateEvent(e); }\r\n\t\t}catch(e){}\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\tdoApplyCellEdit: function(inValue, inRowIndex, inAttrName){\r\n\t\t// summary:\r\n\t\t//\t\tOverwritten, see DataGrid.doApplyCellEdit()\r\n\t\tif(!inAttrName){\r\n\t\t\tthis.invalidated[inRowIndex] = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\tmixin: function(target, source){\r\n\t\tvar props = {};\r\n\t\tfor(var p in source){\r\n\t\t\tif(p == '_inherited' || p == 'declaredClass' || p == 'constructor' ||\r\n\t\t\t\tsource['privates'] && source['privates'][p]){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tprops[p] = source[p];\r\n\t\t}\r\n\t\tlang.mixin(target, props);\r\n\t},\r\n\t_copyAttr: function(idx, attr){\r\n\t\t// summary:\r\n\t\t//\t\tOverwritten, see DataGrid._copyAttr()\r\n\t\t//\t\tFix cell TAB navigation for single click editing\r\n\t\tif(!attr){ return; }\r\n\t\treturn this.inherited(arguments);\r\n\t},\r\n\t_getHeaderHeight: function(){\r\n\t\t// summary:\r\n\t\t//\t\tOverwritten, see _Grid._getHeaderHeight()\r\n\t\t//\t\tShould include borders/margins of this.viewsHeaderNode\r\n\t\tthis.inherited(arguments);\r\n\t\treturn domGeometry.getMarginBox(this.viewsHeaderNode).h;\r\n\t},\r\n\t_fetch: function(start, isRender){\r\n\t\t// summary:\r\n\t\t//\t\tOverwritten, see DataGrid._fetch()\r\n\t\tif(this.items){\r\n\t\t\treturn this.inherited(arguments);\r\n\t\t}\r\n\t\tstart = start || 0;\r\n\t\tif(this.store && !this._pending_requests[start]){\r\n\t\t\tif(!this._isLoaded && !this._isLoading){\r\n\t\t\t\tthis._isLoading = true;\r\n\t\t\t\tthis.showMessage(this.loadingMessage);\r\n\t\t\t}\r\n\t\t\tthis._pending_requests[start] = true;\r\n\t\t\ttry{\r\n\t\t\t\tvar req = {\r\n\t\t\t\t\tstart: start,\r\n\t\t\t\t\tcount: this.rowsPerPage,\r\n\t\t\t\t\tquery: this.query,\r\n\t\t\t\t\tsort: this.getSortProps(),\r\n\t\t\t\t\tqueryOptions: this.queryOptions,\r\n\t\t\t\t\tisRender: isRender,\r\n\t\t\t\t\tonBegin: lang.hitch(this, \"_onFetchBegin\"),\r\n\t\t\t\t\tonComplete: lang.hitch(this, \"_onFetchComplete\"),\r\n\t\t\t\t\tonError: lang.hitch(this, \"_onFetchError\")\r\n\t\t\t\t};\r\n\t\t\t\tthis._storeLayerFetch(req);\r\n\t\t\t}catch(e){\r\n\t\t\t\tthis._onFetchError(e, {start: start, count: this.rowsPerPage});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t},\r\n\t_storeLayerFetch: function(req){\r\n\t\t// summary:\r\n\t\t//\t\tExtracted fetch specifically for store layer use\r\n\t\tthis.store.fetch(req);\r\n\t},\r\n\tgetCellByField: function(field){\r\n\t\treturn array.filter(this.layout.cells, function(cell){\r\n\t\t\treturn cell.field == field;\r\n\t\t})[0];\r\n\t},\r\n\tonMouseUp: function(e){\t},\r\n\tcreateView: function(){\r\n\t\t// summary:\r\n\t\t//\t\tOverwrite: rewrite getCellX of view.header\r\n\t\tvar view = this.inherited(arguments);\r\n\t\tif(has('mozilla')){\r\n\t\t\tvar ascendDom = function(inNode, inWhile){\r\n\t\t\t\tfor(var n = inNode; n && inWhile(n); n = n.parentNode){}\r\n\t\t\t\treturn n;\r\n\t\t\t};//copied from dojox.grid._Builder\r\n\t\t\tvar makeNotTagName = function(inTagName){\r\n\t\t\t\tvar name = inTagName.toUpperCase();\r\n\t\t\t\treturn function(node){ return node.tagName != name; };\r\n\t\t\t};//copied from dojox.grid._Builder\r\n\r\n\t\t\tvar func = view.header.getCellX;\r\n\t\t\tview.header.getCellX = function(e){\r\n\t\t\t\tvar x = func.call(view.header, e);\r\n\t\t\t\tvar n = ascendDom(e.target, makeNotTagName(\"th\"));\r\n\t\t\t\tif(n && n !== e.target && dom.isDescendant(e.target, n)){ x += n.firstChild.offsetLeft; }\r\n\t\t\t\treturn x;\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn view;\r\n\t},\r\n\tdestroy: function(){\r\n\t\t// summary:\r\n\t\t//\t\tDestroy all resources\r\n\t\tdelete this._nls;\r\n\t\tthis.pluginMgr.destroy();\r\n\t\tthis.inherited(arguments);\r\n\t}\r\n});\r\n\r\ndeclare(\"dojox.grid.enhanced.DataSelection\", DataSelection, {\r\n\tconstructor: function(grid){\r\n\t\tif(grid.keepSelection){\r\n\t\t\tif(this.preserver){\r\n\t\t\t\tthis.preserver.destroy();\r\n\t\t\t}\r\n\t\t\tthis.preserver = new _SelectionPreserver(this);\r\n\t\t}\r\n\t},\r\n\t_range: function(inFrom, inTo){\r\n\t\tthis.grid._selectingRange = true;\r\n\t\tthis.inherited(arguments);\r\n\t\tthis.grid._selectingRange = false;\r\n\t\tthis.onChanged();\r\n\t},\r\n\tdeselectAll: function(inItemOrIndex){\r\n\t\tthis.grid._selectingRange = true;\r\n\t\tthis.inherited(arguments);\r\n\t\tthis.grid._selectingRange = false;\r\n\t\tthis.onChanged();\r\n\t}\r\n});\r\n\r\nEnhancedGrid.markupFactory = function(props, node, ctor, cellFunc){\r\n\treturn dojox.grid._Grid.markupFactory(props, node, ctor,\r\n\t\t\t\t\tlang.partial(DataGrid.cell_markupFactory, cellFunc));\r\n};\r\n\r\nEnhancedGrid.registerPlugin = function(clazz, props){\r\n\t_PluginManager.registerPlugin(clazz, props);\r\n};\r\n\r\nreturn EnhancedGrid;\r\n\r\n});\r\n"]}