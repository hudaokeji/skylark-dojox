{"version":3,"sources":["grid/DataGrid.js"],"names":["define","dojox","array","lang","json","has","declare","_Grid","DataSelection","html","DataGrid","store","query","queryOptions","fetchText","sortFields","updateDelay","items","_store_connects","_by_idty","_by_idx","_cache","_pages","_pending_requests","_bop","_eop","_requests","rowCount","_isLoaded","_isLoading","keepSelection","postCreate","this","_setStore","inherited","arguments","destroy","selection","createSelection","get","inRowIndex","inItem","field","fields","ret","s","grid","forEach","f","concat","getValues","getValue","value","defaultValue","_checkUpdateStatus","iStarted","_endUpdateDelay","clearTimeout","updating","beginUpdate","_this","setTimeout","endUpdate","_onSet","item","attribute","oldValue","newValue","idx","getItemIndex","updateRow","_createItem","index","idty","_hasIdentity","getIdentity","toJson","getSortProps","_addItem","noUpdate","_onNew","parentInfo","_addingItem","updateRowCount","showMessage","_onDelete","_getItemIndex","o","splice","noDataMessage","isSelected","deselect","selected","_onRevert","_refresh","setStore","_requestsPending","_setQuery","setQuery","setItems","disconnect","getFeatures","h","_canEdit","push","connect","_onFetchBegin","size","req","scroller","isRender","init","keepRows","rowsPerPage","_setAutoHeightAttr","autoHeight","_skipRowRenormalize","prerender","views","render","_resize","focus","initFocusView","_onFetchComplete","length","start","updateRows","setScrollTop","postrender","_lastScrollTop","setSelectable","domNode","selectable","_onFetchError","err","console","log","errorMessage","onFetchError","_fetch","loadingMessage","count","waitCount","i","isItemLoaded","onItem","loadItem","scope","fetch","sort","onBegin","hitch","onComplete","onError","e","_clearData","getItem","data","_preparePage","isDeleted","isItem","l","d","filter","reRender","_getItemAttr","attr","_render","parentNode","_rowToPage","Math","floor","_pageToRow","inPageIndex","pageIndex","_needPage","_requestPage","row","min","getCellName","inCell","edit","apply","scrollTop","canSort","c","getCell","getSortIndex","desc","si","sortInfo","descending","styleRowState","inRow","getState","states","ss","customClasses","onStyleRow","canEdit","_copyAttr","src","doStartEdit","onStartEdit","doApplyCellEdit","inValue","inAttrName","fetchItemByIdentity","identity","isNaN","parseFloat","Date","asDate","getTime","setValue","onApplyCellEdit","doCancelEdit","onCancelEdit","doApplyEdit","inDataAttr","onApplyEdit","removeSelectedRows","fx","deleteItem","clear","allItemsSelected","getSelected","cell_markupFactory","cellFunc","node","cellDef","trim","name","split","markupFactory","props","ctor","partial"],"mappings":"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","file":"../../grid/DataGrid.js","sourcesContent":["define([\r\n\t\"../main\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/json\",\r\n\t\"dojo/_base/sniff\",\r\n\t\"dojo/_base/declare\",\r\n\t\"./_Grid\",\r\n\t\"./DataSelection\",\r\n\t\"dojo/_base/html\",\r\n\t\"dojo/has\",\r\n\t\"dojo/has!dojo-bidi?./bidi/_BidiMixin\"\r\n], function(dojox, array, lang, json, has, declare, _Grid, DataSelection, html){\r\n\r\n/*=====\r\ndeclare(\"dojox.grid.__DataCellDef\", dojox.grid.__CellDef, {\r\n\tconstructor: function(){\r\n\t\t// field: String?\r\n\t\t//\t\tThe attribute to read from the dojo.data item for the row.\r\n\t\t// fields: String[]?\r\n\t\t//\t\tAn array of fields to grab the values of and pass as an array to the grid\r\n\t\t// get: Function?\r\n\t\t//\t\tfunction(rowIndex, item?){} rowIndex is of type Integer, item is of type\r\n\t\t//\t\tObject.  This function will be called when a cell requests data.  Returns\r\n\t\t//\t\tthe unformatted data for the cell.\r\n\t}\r\n});\r\n=====*/\r\n\r\n/*=====\r\ndeclare(\"dojox.grid.__DataViewDef\", dojox.grid.__ViewDef, {\r\n\tconstructor: function(){\r\n\t\t// cells: dojox.grid.__DataCellDef[]|Array[dojox.grid.__DataCellDef[]]?\r\n\t\t//\t\tThe structure of the cells within this grid.\r\n\t\t// defaultCell: dojox.grid.__DataCellDef?\r\n\t\t//\t\tA cell definition with default values for all cells in this view.  If\r\n\t\t//\t\ta property is defined in a cell definition in the \"cells\" array and\r\n\t\t//\t\tthis property, the cell definition's property will override this\r\n\t\t//\t\tproperty's property.\r\n\t}\r\n});\r\n=====*/\r\n\r\nvar DataGrid = declare(\"dojox.grid.DataGrid\", _Grid, {\r\n\tstore: null,\r\n\tquery: null,\r\n\tqueryOptions: null,\r\n\tfetchText: '...',\r\n\tsortFields: null,\r\n\t\r\n\t// updateDelay: int\r\n\t//\t\tTime, in milliseconds, to delay updates automatically so that multiple\r\n\t//\t\tcalls to onSet/onNew/onDelete don't keep rerendering the grid.  Set\r\n\t//\t\tto 0 to immediately cause updates.  A higher value will result in\r\n\t//\t\tbetter performance at the expense of responsiveness of the grid.\r\n\tupdateDelay: 1,\r\n\r\n/*=====\r\n\t// structure: dojox.grid.__DataViewDef|dojox.grid.__DataViewDef[]|dojox.grid.__DataCellDef[]|Array[dojox.grid.__DataCellDef[]]\r\n\t//\t\tView layout definition.\r\n\tstructure: '',\r\n=====*/\r\n\r\n\t// You can specify items instead of a query, if you like.  They do not need\r\n\t// to be loaded - but the must be items in the store\r\n\titems: null,\r\n\t\r\n\t_store_connects: null,\r\n\t_by_idty: null,\r\n\t_by_idx: null,\r\n\t_cache: null,\r\n\t_pages: null,\r\n\t_pending_requests: null,\r\n\t_bop: -1,\r\n\t_eop: -1,\r\n\t_requests: 0,\r\n\trowCount: 0,\r\n\r\n\t_isLoaded: false,\r\n\t_isLoading: false,\r\n\t\r\n\t// keepSelection: Boolean\r\n\t//\t\tWhether keep selection after sort, filter etc.\r\n\tkeepSelection: false,\t\r\n\t\r\n\tpostCreate: function(){\r\n\t\tthis._pages = [];\r\n\t\tthis._store_connects = [];\r\n\t\tthis._by_idty = {};\r\n\t\tthis._by_idx = [];\r\n\t\tthis._cache = [];\r\n\t\tthis._pending_requests = {};\r\n\r\n\t\tthis._setStore(this.store);\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\t\r\n\tdestroy: function(){\r\n\t\tthis.selection.destroy();\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\r\n\tcreateSelection: function(){\r\n\t\tthis.selection = new DataSelection(this);\r\n\t},\r\n\r\n\tget: function(inRowIndex, inItem){\r\n\t\t// summary:\r\n\t\t//\t\tDefault data getter.\r\n\t\t// description:\r\n\t\t//\t\tProvides data to display in a grid cell. Called in grid cell context.\r\n\t\t//\t\tSo this.cell.index is the column index.\r\n\t\t// inRowIndex: Integer\r\n\t\t//\t\tRow for which to provide data\r\n\t\t// returns:\r\n\t\t//\t\tData to display for a given grid cell.\r\n\t\t\r\n\t\tif(inItem && this.field == \"_item\" && !this.fields){\r\n\t\t\treturn inItem;\r\n\t\t}else if(inItem && this.fields){\r\n\t\t\tvar ret = [];\r\n\t\t\tvar s = this.grid.store;\r\n\t\t\tarray.forEach(this.fields, function(f){\r\n\t\t\t\tret = ret.concat(s.getValues(inItem, f));\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}else if(!inItem && typeof inRowIndex === \"string\"){\r\n\t\t\treturn this.inherited(arguments);\r\n\t\t}\r\n\t\treturn (!inItem ? this.defaultValue : (!this.field ? this.value : (this.field == \"_item\" ? inItem : this.grid.store.getValue(inItem, this.field))));\r\n\t},\r\n\r\n\t_checkUpdateStatus: function(){\r\n\t\tif(this.updateDelay > 0){\r\n\t\t\tvar iStarted = false;\r\n\t\t\tif(this._endUpdateDelay){\r\n\t\t\t\tclearTimeout(this._endUpdateDelay);\r\n\t\t\t\tdelete this._endUpdateDelay;\r\n\t\t\t\tiStarted = true;\r\n\t\t\t}\r\n\t\t\tif(!this.updating){\r\n\t\t\t\tthis.beginUpdate();\r\n\t\t\t\tiStarted = true;\r\n\t\t\t}\r\n\t\t\tif(iStarted){\r\n\t\t\t\tvar _this = this;\r\n\t\t\t\tthis._endUpdateDelay = setTimeout(function(){\r\n\t\t\t\t\tdelete _this._endUpdateDelay;\r\n\t\t\t\t\t_this.endUpdate();\r\n\t\t\t\t}, this.updateDelay);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_onSet: function(item, attribute, oldValue, newValue){\r\n\t\tthis._checkUpdateStatus();\r\n\t\tvar idx = this.getItemIndex(item);\r\n\t\tif(idx>-1){\r\n\t\t\tthis.updateRow(idx);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_createItem: function(item, index){\r\n\t\tvar idty = this._hasIdentity ? this.store.getIdentity(item) : json.toJson(this.query) + \":idx:\" + index + \":sort:\" + json.toJson(this.getSortProps());\r\n\t\tvar o = this._by_idty[idty] = { idty: idty, item: item };\r\n\t\treturn o;\r\n\t},\r\n\r\n\t_addItem: function(item, index, noUpdate){\r\n\t\tthis._by_idx[index] = this._createItem(item, index);\r\n\t\tif(!noUpdate){\r\n\t\t\tthis.updateRow(index);\r\n\t\t}\r\n\t},\r\n\r\n\t_onNew: function(item, parentInfo){\r\n\t\tthis._checkUpdateStatus();\r\n\t\tvar rowCount = this.get('rowCount');\r\n\t\tthis._addingItem = true;\r\n\t\tthis.updateRowCount(rowCount+1);\r\n\t\tthis._addingItem = false;\r\n\t\tthis._addItem(item, rowCount);\r\n\t\tthis.showMessage();\r\n\t},\r\n\r\n\t_onDelete: function(item){\r\n\t\tthis._checkUpdateStatus();\r\n\t\tvar idx = this._getItemIndex(item, true);\r\n\r\n\t\tif(idx >= 0){\r\n\t\t\t// When a row is deleted, all rest rows are shifted down,\r\n\t\t\t// and migrate from page to page. If some page is not\r\n\t\t\t// loaded yet empty rows can migrate to initialized pages\r\n\t\t\t// without refreshing. It causes empty rows in some pages, see:\r\n\t\t\t// http://bugs.dojotoolkit.org/ticket/6818\r\n\t\t\t// this code fix this problem by reseting loaded page info\r\n\t\t\tthis._pages = [];\r\n\t\t\tthis._bop = -1;\r\n\t\t\tthis._eop = -1;\r\n\r\n\t\t\tvar o = this._by_idx[idx];\r\n\t\t\tthis._by_idx.splice(idx, 1);\r\n\t\t\tdelete this._by_idty[o.idty];\r\n\t\t\tthis.updateRowCount(this.get('rowCount')-1);\r\n\t\t\tif(this.get('rowCount') === 0){\r\n\t\t\t\tthis.showMessage(this.noDataMessage);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(this.selection.isSelected(idx)){\r\n\t\t\tthis.selection.deselect(idx);\r\n\t\t\tthis.selection.selected.splice(idx, 1);\r\n\t\t}\r\n\t},\r\n\r\n\t_onRevert: function(){\r\n\t\tthis._refresh();\r\n\t},\r\n\r\n\tsetStore: function(store, query, queryOptions){\r\n\t\tif(this._requestsPending(0)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._setQuery(query, queryOptions);\r\n\t\tthis._setStore(store);\r\n\t\tthis._refresh(true);\r\n\t},\r\n\t\r\n\tsetQuery: function(query, queryOptions){\r\n\t\tif(this._requestsPending(0)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._setQuery(query, queryOptions);\r\n\t\tthis._refresh(true);\r\n\t},\r\n\t\r\n\tsetItems: function(items){\r\n\t\tthis.items = items;\r\n\t\tthis._setStore(this.store);\r\n\t\tthis._refresh(true);\r\n\t},\r\n\t\r\n\t_setQuery: function(query, queryOptions){\r\n\t\tthis.query = query;\r\n\t\tthis.queryOptions = queryOptions || this.queryOptions;\r\n\t},\r\n\r\n\t_setStore: function(store){\r\n\t\tif(this.store && this._store_connects){\r\n\t\t\tarray.forEach(this._store_connects, this.disconnect, this);\r\n\t\t}\r\n\t\tthis.store = store;\r\n\r\n\t\tif(this.store){\r\n\t\t\tvar f = this.store.getFeatures();\r\n\t\t\tvar h = [];\r\n\r\n\t\t\tthis._canEdit = !!f[\"dojo.data.api.Write\"] && !!f[\"dojo.data.api.Identity\"];\r\n\t\t\tthis._hasIdentity = !!f[\"dojo.data.api.Identity\"];\r\n\r\n\t\t\tif(!!f[\"dojo.data.api.Notification\"] && !this.items){\r\n\t\t\t\th.push(this.connect(this.store, \"onSet\", \"_onSet\"));\r\n\t\t\t\th.push(this.connect(this.store, \"onNew\", \"_onNew\"));\r\n\t\t\t\th.push(this.connect(this.store, \"onDelete\", \"_onDelete\"));\r\n\t\t\t}\r\n\t\t\tif(this._canEdit){\r\n\t\t\t\th.push(this.connect(this.store, \"revert\", \"_onRevert\"));\r\n\t\t\t}\r\n\r\n\t\t\tthis._store_connects = h;\r\n\t\t}\r\n\t},\r\n\r\n\t_onFetchBegin: function(size, req){\r\n\t\tif(!this.scroller){ return; }\r\n\t\tif(this.rowCount != size){\r\n\t\t\tif(req.isRender){\r\n\t\t\t\tthis.scroller.init(size, this.keepRows, this.rowsPerPage);\r\n\t\t\t\tthis.rowCount = size;\r\n\t\t\t\tthis._setAutoHeightAttr(this.autoHeight, true);\r\n\t\t\t\tthis._skipRowRenormalize = true;\r\n\t\t\t\tthis.prerender();\r\n\t\t\t\tthis._skipRowRenormalize = false;\r\n\t\t\t}else{\r\n\t\t\t\tthis.updateRowCount(size);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!size){\r\n\t\t\tthis.views.render();\r\n\t\t\tthis._resize();\r\n\t\t\tthis.showMessage(this.noDataMessage);\r\n\t\t\tthis.focus.initFocusView();\r\n\t\t}else{\r\n\t\t\tthis.showMessage();\r\n\t\t}\r\n\t},\r\n\r\n\t_onFetchComplete: function(items, req){\r\n\t\tif(!this.scroller){ return; }\r\n\t\tif(items && items.length > 0){\r\n\t\t\t//console.log(items);\r\n\t\t\tarray.forEach(items, function(item, idx){\r\n\t\t\t\tthis._addItem(item, req.start+idx, true);\r\n\t\t\t}, this);\r\n\t\t\tthis.updateRows(req.start, items.length);\r\n\t\t\tif(req.isRender){\r\n\t\t\t\tthis.setScrollTop(0);\r\n\t\t\t\tthis.postrender();\r\n\t\t\t}else if(this._lastScrollTop){\r\n\t\t\t\tthis.setScrollTop(this._lastScrollTop);\r\n\t\t\t}\r\n\t\t\tif(has(\"ie\")){\r\n\t\t\t\thtml.setSelectable(this.domNode, this.selectable);\r\n\t\t\t}\t\r\n\t\t}\r\n\t\tdelete this._lastScrollTop;\r\n\t\tif(!this._isLoaded){\r\n\t\t\tthis._isLoading = false;\r\n\t\t\tthis._isLoaded = true;\r\n\t\t}\r\n\t\tthis._pending_requests[req.start] = false;\r\n\t},\r\n\r\n\t_onFetchError: function(err, req){\r\n\t\tconsole.log(err);\r\n\t\tdelete this._lastScrollTop;\r\n\t\tif(!this._isLoaded){\r\n\t\t\tthis._isLoading = false;\r\n\t\t\tthis._isLoaded = true;\r\n\t\t\tthis.showMessage(this.errorMessage);\r\n\t\t}\r\n\t\tthis._pending_requests[req.start] = false;\r\n\t\tthis.onFetchError(err, req);\r\n\t},\r\n\r\n\tonFetchError: function(err, req){\r\n\t},\r\n\r\n\t_fetch: function(start, isRender){\r\n\t\tstart = start || 0;\r\n\t\tif(this.store && !this._pending_requests[start]){\r\n\t\t\tif(!this._isLoaded && !this._isLoading){\r\n\t\t\t\tthis._isLoading = true;\r\n\t\t\t\tthis.showMessage(this.loadingMessage);\r\n\t\t\t}\r\n\t\t\tthis._pending_requests[start] = true;\r\n\t\t\t//console.log(\"fetch: \", start);\r\n\t\t\ttry{\r\n\t\t\t\tif(this.items){\r\n\t\t\t\t\tvar items = this.items;\r\n\t\t\t\t\tvar store = this.store;\r\n\t\t\t\t\tthis.rowsPerPage = items.length;\r\n\t\t\t\t\tvar req = {\r\n\t\t\t\t\t\tstart: start,\r\n\t\t\t\t\t\tcount: this.rowsPerPage,\r\n\t\t\t\t\t\tisRender: isRender\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis._onFetchBegin(items.length, req);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Load them if we need to\r\n\t\t\t\t\tvar waitCount = 0;\r\n\t\t\t\t\tarray.forEach(items, function(i){\r\n\t\t\t\t\t\tif(!store.isItemLoaded(i)){ waitCount++; }\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif(waitCount === 0){\r\n\t\t\t\t\t\tthis._onFetchComplete(items, req);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tvar onItem = function(item){\r\n\t\t\t\t\t\t\twaitCount--;\r\n\t\t\t\t\t\t\tif(waitCount === 0){\r\n\t\t\t\t\t\t\t\tthis._onFetchComplete(items, req);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tarray.forEach(items, function(i){\r\n\t\t\t\t\t\t\tif(!store.isItemLoaded(i)){\r\n\t\t\t\t\t\t\t\tstore.loadItem({item: i, onItem: onItem, scope: this});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, this);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.store.fetch({\r\n\t\t\t\t\t\tstart: start,\r\n\t\t\t\t\t\tcount: this.rowsPerPage,\r\n\t\t\t\t\t\tquery: this.query,\r\n\t\t\t\t\t\tsort: this.getSortProps(),\r\n\t\t\t\t\t\tqueryOptions: this.queryOptions,\r\n\t\t\t\t\t\tisRender: isRender,\r\n\t\t\t\t\t\tonBegin: lang.hitch(this, \"_onFetchBegin\"),\r\n\t\t\t\t\t\tonComplete: lang.hitch(this, \"_onFetchComplete\"),\r\n\t\t\t\t\t\tonError: lang.hitch(this, \"_onFetchError\")\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}catch(e){\r\n\t\t\t\tthis._onFetchError(e, {start: start, count: this.rowsPerPage});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_clearData: function(){\r\n\t\tthis.updateRowCount(0);\r\n\t\tthis._by_idty = {};\r\n\t\tthis._by_idx = [];\r\n\t\tthis._pages = [];\r\n\t\tthis._bop = this._eop = -1;\r\n\t\tthis._isLoaded = false;\r\n\t\tthis._isLoading = false;\r\n\t},\r\n\r\n\tgetItem: function(idx){\r\n\t\tvar data = this._by_idx[idx];\r\n\t\tif(!data||(data&&!data.item)){\r\n\t\t\tthis._preparePage(idx);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn data.item;\r\n\t},\r\n\r\n\tgetItemIndex: function(item){\r\n\t\treturn this._getItemIndex(item, false);\r\n\t},\r\n\t\r\n\t_getItemIndex: function(item, isDeleted){\r\n\t\tif(!isDeleted && !this.store.isItem(item)){\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\tvar idty = this._hasIdentity ? this.store.getIdentity(item) : null;\r\n\r\n\t\tfor(var i=0, l=this._by_idx.length; i<l; i++){\r\n\t\t\tvar d = this._by_idx[i];\r\n\t\t\tif(d && ((idty && d.idty == idty) || (d.item === item))){\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\r\n\tfilter: function(query, reRender){\r\n\t\tthis.query = query;\r\n\t\tif(reRender){\r\n\t\t\tthis._clearData();\r\n\t\t}\r\n\t\tthis._fetch();\r\n\t},\r\n\r\n\t_getItemAttr: function(idx, attr){\r\n\t\tvar item = this.getItem(idx);\r\n\t\treturn (!item ? this.fetchText : this.store.getValue(item, attr));\r\n\t},\r\n\r\n\t// rendering\r\n\t_render: function(){\r\n\t\tif(this.domNode.parentNode){\r\n\t\t\tthis.scroller.init(this.get('rowCount'), this.keepRows, this.rowsPerPage);\r\n\t\t\tthis.prerender();\r\n\t\t\tthis._fetch(0, true);\r\n\t\t}\r\n\t},\r\n\r\n\t// paging\r\n\t_requestsPending: function(inRowIndex){\r\n\t\treturn this._pending_requests[inRowIndex];\r\n\t},\r\n\r\n\t_rowToPage: function(inRowIndex){\r\n\t\treturn (this.rowsPerPage ? Math.floor(inRowIndex / this.rowsPerPage) : inRowIndex);\r\n\t},\r\n\r\n\t_pageToRow: function(inPageIndex){\r\n\t\treturn (this.rowsPerPage ? this.rowsPerPage * inPageIndex : inPageIndex);\r\n\t},\r\n\r\n\t_preparePage: function(inRowIndex){\r\n\t\tif((inRowIndex < this._bop || inRowIndex >= this._eop) && !this._addingItem){\r\n\t\t\tvar pageIndex = this._rowToPage(inRowIndex);\r\n\t\t\tthis._needPage(pageIndex);\r\n\t\t\tthis._bop = pageIndex * this.rowsPerPage;\r\n\t\t\tthis._eop = this._bop + (this.rowsPerPage || this.get('rowCount'));\r\n\t\t}\r\n\t},\r\n\r\n\t_needPage: function(inPageIndex){\r\n\t\tif(!this._pages[inPageIndex]){\r\n\t\t\tthis._pages[inPageIndex] = true;\r\n\t\t\tthis._requestPage(inPageIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_requestPage: function(inPageIndex){\r\n\t\tvar row = this._pageToRow(inPageIndex);\r\n\t\tvar count = Math.min(this.rowsPerPage, this.get('rowCount') - row);\r\n\t\tif(count > 0){\r\n\t\t\tthis._requests++;\r\n\t\t\tif(!this._requestsPending(row)){\r\n\t\t\t\tsetTimeout(lang.hitch(this, \"_fetch\", row, false), 1);\r\n\t\t\t\t//this.requestRows(row, count);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tgetCellName: function(inCell){\r\n\t\treturn inCell.field;\r\n\t\t//console.log(inCell);\r\n\t},\r\n\r\n\t_refresh: function(isRender){\r\n\t\tthis._clearData();\r\n\t\tthis._fetch(0, isRender);\r\n\t},\r\n\r\n\tsort: function(){\r\n\t\tthis.edit.apply();\r\n\t\tthis._lastScrollTop = this.scrollTop;\r\n\t\tthis._refresh();\r\n\t},\r\n\r\n\tcanSort: function(){\r\n\t\treturn (!this._isLoading);\r\n\t},\r\n\r\n\tgetSortProps: function(){\r\n\t\tvar c = this.getCell(this.getSortIndex());\r\n\t\tif(!c){\r\n\t\t\tif(this.sortFields){\r\n\t\t\t\treturn this.sortFields;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}else{\r\n\t\t\tvar desc = c[\"sortDesc\"];\r\n\t\t\tvar si = !(this.sortInfo>0);\r\n\t\t\tif(typeof desc == \"undefined\"){\r\n\t\t\t\tdesc = si;\r\n\t\t\t}else{\r\n\t\t\t\tdesc = si ? !desc : desc;\r\n\t\t\t}\r\n\t\t\treturn [{ attribute: c.field, descending: desc }];\r\n\t\t}\r\n\t},\r\n\r\n\tstyleRowState: function(inRow){\r\n\t\t// summary:\r\n\t\t//\t\tPerform row styling\r\n\t\tif(this.store && this.store.getState){\r\n\t\t\tvar states=this.store.getState(inRow.index), c='';\r\n\t\t\tfor(var i=0, ss=[\"inflight\", \"error\", \"inserting\"], s; s=ss[i]; i++){\r\n\t\t\t\tif(states[s]){\r\n\t\t\t\t\tc = ' dojoxGridRow-' + s;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tinRow.customClasses += c;\r\n\t\t}\r\n\t},\r\n\r\n\tonStyleRow: function(inRow){\r\n\t\tthis.styleRowState(inRow);\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\r\n\t// editing\r\n\tcanEdit: function(inCell, inRowIndex){\r\n\t\treturn this._canEdit;\r\n\t},\r\n\r\n\t_copyAttr: function(idx, attr){\r\n\t\tvar row = {};\r\n\t\tvar backstop = {};\r\n\t\tvar src = this.getItem(idx);\r\n\t\treturn this.store.getValue(src, attr);\r\n\t},\r\n\r\n\tdoStartEdit: function(inCell, inRowIndex){\r\n\t\tif(!this._cache[inRowIndex]){\r\n\t\t\tthis._cache[inRowIndex] = this._copyAttr(inRowIndex, inCell.field);\r\n\t\t}\r\n\t\tthis.onStartEdit(inCell, inRowIndex);\r\n\t},\r\n\r\n\tdoApplyCellEdit: function(inValue, inRowIndex, inAttrName){\r\n\t\tthis.store.fetchItemByIdentity({\r\n\t\t\tidentity: this._by_idx[inRowIndex].idty,\r\n\t\t\tonItem: lang.hitch(this, function(item){\r\n\t\t\t\tvar oldValue = this.store.getValue(item, inAttrName);\r\n\t\t\t\tif(typeof oldValue == 'number'){\r\n\t\t\t\t\tinValue = isNaN(inValue) ? inValue : parseFloat(inValue);\r\n\t\t\t\t}else if(typeof oldValue == 'boolean'){\r\n\t\t\t\t\tinValue = inValue == 'true' ? true : inValue == 'false' ? false : inValue;\r\n\t\t\t\t}else if(oldValue instanceof Date){\r\n\t\t\t\t\tvar asDate = new Date(inValue);\r\n\t\t\t\t\tinValue = isNaN(asDate.getTime()) ? inValue : asDate;\r\n\t\t\t\t}\r\n\t\t\t\tthis.store.setValue(item, inAttrName, inValue);\r\n\t\t\t\tthis.onApplyCellEdit(inValue, inRowIndex, inAttrName);\r\n\t\t\t})\r\n\t\t});\r\n\t},\r\n\r\n\tdoCancelEdit: function(inRowIndex){\r\n\t\tvar cache = this._cache[inRowIndex];\r\n\t\tif(cache){\r\n\t\t\tthis.updateRow(inRowIndex);\r\n\t\t\tdelete this._cache[inRowIndex];\r\n\t\t}\r\n\t\tthis.onCancelEdit.apply(this, arguments);\r\n\t},\r\n\r\n\tdoApplyEdit: function(inRowIndex, inDataAttr){\r\n\t\tvar cache = this._cache[inRowIndex];\r\n\t\t/*if(cache){\r\n\t\t\tvar data = this.getItem(inRowIndex);\r\n\t\t\tif(this.store.getValue(data, inDataAttr) != cache){\r\n\t\t\t\tthis.update(cache, data, inRowIndex);\r\n\t\t\t}\r\n\t\t\tdelete this._cache[inRowIndex];\r\n\t\t}*/\r\n\t\tthis.onApplyEdit(inRowIndex);\r\n\t},\r\n\r\n\tremoveSelectedRows: function(){\r\n\t\t// summary:\r\n\t\t//\t\tRemove the selected rows from the grid.\r\n\t\tif(this._canEdit){\r\n\t\t\tthis.edit.apply();\r\n\t\t\tvar fx = lang.hitch(this, function(items){\r\n\t\t\t\tif(items.length){\r\n\t\t\t\t\tarray.forEach(items, this.store.deleteItem, this.store);\r\n\t\t\t\t\tthis.selection.clear();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif(this.allItemsSelected){\r\n\t\t\t\tthis.store.fetch({\r\n\t\t\t\t\t\t\tquery: this.query,\r\n\t\t\t\t\t\t\tqueryOptions: this.queryOptions,\r\n\t\t\t\t\t\t\tonComplete: fx});\r\n\t\t\t}else{\r\n\t\t\t\tfx(this.selection.getSelected());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\nDataGrid.cell_markupFactory = function(cellFunc, node, cellDef){\r\n\tvar field = lang.trim(html.attr(node, \"field\")||\"\");\r\n\tif(field){\r\n\t\tcellDef.field = field;\r\n\t}\r\n\tcellDef.field = cellDef.field||cellDef.name;\r\n\tvar fields = lang.trim(html.attr(node, \"fields\")||\"\");\r\n\tif(fields){\r\n\t\tcellDef.fields = fields.split(\",\");\r\n\t}\r\n\tif(cellFunc){\r\n\t\tcellFunc(node, cellDef);\r\n\t}\r\n};\r\n\r\nDataGrid.markupFactory = function(props, node, ctor, cellFunc){\r\n\treturn _Grid.markupFactory(props, node, ctor,\r\n\t\t\t\t\tlang.partial(DataGrid.cell_markupFactory, cellFunc));\r\n};\r\n\r\nreturn DataGrid;\r\n\r\n});\r\n"]}