{"version":3,"sources":["grid/enhanced/plugins/Selector.js"],"names":["define","dojo","lang","declare","array","event","keys","query","html","win","dijitFocus","_RowSelector","_Plugin","EnhancedGrid","_theOther","col","row","_inRange","type","value","start","end","halfClose","_isEqual","v1","v2","e","_stopEvent","evt","preventDefault","stop","_createItem","rowIndex","colIndex","except","Selector","name","constructor","grid","args","this","_config","cell","noClear","setupConfig","selectionMode","_enabled","_selecting","_selected","_startPoint","_currentPoint","_lastAnchorPoint","_lastEndPoint","_lastSelectedAnchorPoint","_lastSelectedEndPoint","_keyboardSelect","_lastType","_selectedRowModified","_hacks","_initEvents","_initAreas","_mixinGrid","destroy","inherited","arguments","config","isObject","types","indexOf","mode","selection","setMode","isSelected","_isSelected","toggleSelect","_startSelect","_endSelect","select","deselect","selectRange","toSelect","_selectingRange","startPoint","endPoint","_highlight","undefined","clear","_clearSelection","isSelecting","selectEnabled","toEnable","getSelected","includeExceptions","map","item","filter","length","getSelectedCount","getSelectedType","s","getLastSelectedRange","g","doContentMouseUp","cellNode","onMouseUp","onMouseUpRow","mouseUp","hitch","mouseDown","doRowSelectorFocus","style","border","forEach","views","view","content","domouseup","header","declaredClass","domousedown","dofocus","clickSelect","_oldDeselectAll","deselectAll","_this","from","to","preserver","_updateMapping","onChanged","deselectRange","apply","rowSelector","doStyleRowNode","inRowIndex","inRowNode","removeClass","addClass","toggleClass","rows","isOver","connect","layout","cells","index","_highlightNode","getNode","setupSelectorConfig","onStartSelect","onEndSelect","onStartDeselect","onEndDeselect","onSelectCleared","dp","partial","starter","_isUsingRowSelector","button","_usingKeyboard","target","ctrlKey","shiftKey","ender","isRowSelector","singleClickEdit","_singleClickEdit","_curType","_toSelect","_notRefreshSelection","_refreshSelected","scroller","doc","isVertical","isForward","current","selectCell","dir","subscribe","id","_onSelectedById","newIndex","_noInternalMapping","pointSet","concat","found","some","onSetStore","_onInternalRearrange","mapping","_refresh","node","min","max","converted","r","tr","c","tc","hidden","i","len","_focusPoint","console","warn","_onExternalChange","toHighlight","_highlightSingle","f","focus","onmove","createNewEnd","rowStep","colStep","ks","newEnd","_isValid","onkeydown","getTarget","isBubble","keyCode","SPACE","SHIFT","onkeyup","_lastFocusedRowBarIdx","addArea","onFocus","step","rowBarNode","getCellNode","focusClass","onBlur","onMove","next","rowCount","sc","lastPageRow","getLastPageRow","page","rc","Math","setScrollTop","scrollTop","findScrollTop","scrollIntoView","placeArea","onKeyDown","onKeyUp","getHeaderIndex","reservedItem","_blurPoint","call","_selectedById","extending","isRange","mandatarySelect","lastIsSelected","_fireEvent","_isStartFocus","_addToSelected","evtName","_calcToHighlight","sltd","_isInLastRange","_highlightHeader","colIdx","getHeaderNode","_highlightRowSelector","rowIdx","getRowNode","isRefresh","toHL","notselectable","domNode","rowNode","findRowTarget","dojox","util","rowIndexTag","setSelected","highlight","_forEach","point","_colHeadFocusIdx","focusArea","setFocusIndex","_blurContent","toAdd","toRemove","push","_add","_remove","func","colDir","rowDir","p","j","q","_makeupForExceptions","newCellItems","makedUps","pos","splice","_makeupForCells","newItems","_addException","items","_addCellException","colMakedup","rowMakedup","v","every","_hasIdentity","record","_by_idx","idty","comp","_isCellNotInExcept","attr","corres","res","ret","allowNotSelectable","isArray","registerPlugin","dependency"],"mappings":"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","file":"../../../../grid/enhanced/plugins/Selector.js","sourcesContent":["define([\r\n\t\"dojo/_base/kernel\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/keys\",\r\n\t\"dojo/query\",\r\n\t\"dojo/_base/html\",\r\n\t\"dojo/_base/window\",\r\n\t\"dijit/focus\",\r\n\t\"../../_RowSelector\",\r\n\t\"../_Plugin\",\r\n\t\"../../EnhancedGrid\",\r\n\t\"../../cells/_base\",\r\n\t\"./AutoScroll\"\r\n], function(dojo, lang, declare, array, event, keys, query, html, win, dijitFocus, _RowSelector, _Plugin, EnhancedGrid){\r\n\r\n/*=====\r\ndeclare(\"__SelectItem\", null,{\r\n\t// summary:\r\n\t//\t\tAn abstract representation of an item.\r\n});\r\ndeclare(\"__SelectCellItem\", __SelectItem,{\r\n\t// summary:\r\n\t//\t\tAn abstract representation of a cell.\r\n\t\r\n\t// row: Integer\r\n\t//\t\tRow index of this cell\r\n\trow: 0,\r\n\t\r\n\t// col: Integer\r\n\t//\t\tColumn index of this cell\r\n\tcol: 0\r\n});\r\ndeclare(\"__SelectRowItem\", __SelectItem,{\r\n\t// summary:\r\n\t//\t\tAn abstract representation of a row.\r\n\t\r\n\t// row: Integer\r\n\t//\t\tRow index of this row\r\n\trow: 0,\r\n\t\r\n\t// except: Integer[]\r\n\t//\t\tAn array of column indexes of all the unselected cells in this row.\r\n\texcept: []\r\n});\r\ndeclare(\"__SelectColItem\", __SelectItem,{\r\n\t// summary:\r\n\t//\t\tAn abstract representation of a column.\r\n\t\r\n\t// col: Integer\r\n\t//\t\tColumn index of this column\r\n\tcol: 0,\r\n\t\r\n\t// except: Integer[]\r\n\t//\t\tAn array of row indexes of all the unselected cells in this column.\r\n\texcept: []\r\n});\r\n=====*/\r\n\r\nvar DISABLED = 0, SINGLE = 1, MULTI = 2,\r\n\t_theOther = { col: \"row\", row: \"col\" },\r\n\t_inRange = function(type, value, start, end, halfClose){\r\n\t\tif(type !== \"cell\"){\r\n\t\t\tvalue = value[type];\r\n\t\t\tstart = start[type];\r\n\t\t\tend = end[type];\r\n\t\t\tif(typeof value !== \"number\" || typeof start !== \"number\" || typeof end !== \"number\"){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn halfClose ? ((value >= start && value < end) || (value > end && value <= start))\r\n\t\t\t\t\t\t\t: ((value >= start && value <= end) || (value >= end && value <= start));\r\n\t\t}else{\r\n\t\t\treturn _inRange(\"col\", value, start, end, halfClose) && _inRange(\"row\", value, start, end, halfClose);\r\n\t\t}\r\n\t},\r\n\t_isEqual = function(type, v1, v2){\r\n\t\ttry{\r\n\t\t\tif(v1 && v2){\r\n\t\t\t\tswitch(type){\r\n\t\t\t\t\tcase \"col\": case \"row\":\r\n\t\t\t\t\t\treturn v1[type] == v2[type] && typeof v1[type] == \"number\" &&\r\n\t\t\t\t\t\t\t\t!(_theOther[type] in v1) && !(_theOther[type] in v2);\r\n\t\t\t\t\tcase \"cell\":\r\n\t\t\t\t\t\treturn v1.col == v2.col && v1.row == v2.row && typeof v1.col == \"number\" && typeof v1.row == \"number\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}catch(e){}\r\n\t\treturn false;\r\n\t},\r\n\t_stopEvent = function(evt){\r\n\t\ttry{\r\n\t\t\tif(evt && evt.preventDefault){\r\n\t\t\t\tevent.stop(evt);\r\n\t\t\t}\r\n\t\t}catch(e){}\r\n\t},\r\n\t_createItem = function(type, rowIndex, colIndex){\r\n\t\tswitch(type){\r\n\t\t\tcase \"col\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\t\"col\": typeof colIndex == \"undefined\" ? rowIndex : colIndex,\r\n\t\t\t\t\t\"except\": []\r\n\t\t\t\t};\r\n\t\t\tcase \"row\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\t\"row\": rowIndex,\r\n\t\t\t\t\t\"except\": []\r\n\t\t\t\t};\r\n\t\t\tcase \"cell\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\t\"row\": rowIndex,\r\n\t\t\t\t\t\"col\": colIndex\r\n\t\t\t\t};\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\nvar Selector = declare(\"dojox.grid.enhanced.plugins.Selector\", _Plugin, {\r\n\t// summary:\r\n\t//\t\tProvides standard extended selection for grid.\r\n\t//\t\tSupports mouse/keyboard selection, multi-selection, and de-selection.\r\n\t//\r\n\t//\t\tAcceptable plugin parameters:\r\n\t//\t\tThe whole plugin parameter object is a config object passed to the setupConfig function.\r\n\t//\r\n\t//\t\tAcceptable cell parameters defined in layout:\r\n\t//\r\n\t//\t\t1. notselectable: Boolean: Whether this column is (and all the cells in it are) selectable.\r\n\t\r\n\t// name: String\r\n\t//\t\tplugin name\r\n\tname: \"selector\",\r\n\r\n\t// noClear: Boolean\r\n\t//\t\tNot to clear rows selected by IndirectSelection.\r\n/*\r\n\t//\t_config: null,\r\n\t//\t_enabled: true,\r\n\t//\t_selecting: {\r\n\t//\t\trow: false,\r\n\t//\t\tcol: false,\r\n\t//\t\tcell: false\r\n\t//\t},\r\n\t//\t_selected: {\r\n\t//\t\trow: [],\r\n\t//\t\tcol: [],\r\n\t//\t\tcell: []\r\n\t//\t},\r\n\t//\t_startPoint: {},\r\n\t//\t_currentPoint: {},\r\n\t//\t_lastAnchorPoint: {},\r\n\t//\t_lastEndPoint: {},\r\n\t//\t_lastSelectedAnchorPoint: {},\r\n\t//\t_lastSelectedEndPoint: {},\r\n\t//\t_keyboardSelect: {\r\n\t//\t\trow: 0,\r\n\t//\t\tcol: 0,\r\n\t//\t\tcell: 0\r\n\t//\t},\r\n\t//\t_curType: null,\r\n\t//\t_lastType: null,\r\n\t//\t_usingKeyboard: false,\r\n\t//\t_toSelect: true,\r\n*/\r\n\r\n\tconstructor: function(grid, args){\r\n\t\tthis.grid = grid;\r\n\t\tthis._config = {\r\n\t\t\trow: MULTI,\r\n\t\t\tcol: MULTI,\r\n\t\t\tcell: MULTI\r\n\t\t};\r\n\t\tthis.noClear = args && args.noClear;\r\n\t\tthis.setupConfig(args);\r\n\t\tif(grid.selectionMode === \"single\"){\r\n\t\t\tthis._config.row = SINGLE;\r\n\t\t}\r\n\t\tthis._enabled = true;\r\n\t\tthis._selecting = {};\r\n\t\tthis._selected = {\r\n\t\t\t\"col\": [],\r\n\t\t\t\"row\": [],\r\n\t\t\t\"cell\": []\r\n\t\t};\r\n\t\tthis._startPoint = {};\r\n\t\tthis._currentPoint = {};\r\n\t\tthis._lastAnchorPoint = {};\r\n\t\tthis._lastEndPoint = {};\r\n\t\tthis._lastSelectedAnchorPoint = {};\r\n\t\tthis._lastSelectedEndPoint = {};\r\n\t\tthis._keyboardSelect = {};\r\n\t\tthis._lastType = null;\r\n\t\tthis._selectedRowModified = {};\r\n\t\tthis._hacks();\r\n\t\tthis._initEvents();\r\n\t\tthis._initAreas();\r\n\t\tthis._mixinGrid();\r\n\t},\r\n\tdestroy: function(){\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\t//------------public--------------------\r\n\tsetupConfig: function(config){\r\n\t\t// summary:\r\n\t\t//\t\tSet selection mode for row/col/cell.\r\n\t\t// config: Object\r\n\t\t//\t\tAn object with the following structure (all properties are optional):\r\n\t\t// |\t{\r\n\t\t// |\t\t//Default is \"multi\", all other values are same as \"multi\".\r\n\t\t// |\t\trow: false|\"disabled\"|\"single\",\r\n\t\t// |\t\tcol: false|\"disabled\"|\"single\",\r\n\t\t// |\t\tcell: false|\"disabled\"|\"single\"\r\n\t\t// |\t}\r\n\t\tif(!config || !lang.isObject(config)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar types = [\"row\", \"col\", \"cell\"];\r\n\t\tfor(var type in config){\r\n\t\t\tif(array.indexOf(types, type) >= 0){\r\n\t\t\t\tif(!config[type] || config[type] == \"disabled\"){\r\n\t\t\t\t\tthis._config[type] = DISABLED;\r\n\t\t\t\t}else if(config[type] == \"single\"){\r\n\t\t\t\t\tthis._config[type] = SINGLE;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._config[type] = MULTI;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Have to set mode to default grid selection.\r\n\t\tvar mode = [\"none\",\"single\",\"extended\"][this._config.row];\r\n\t\tthis.grid.selection.setMode(mode);\r\n\t},\r\n\tisSelected: function(type, rowIndex, colIndex){\r\n\t\t// summary:\r\n\t\t//\t\tCheck whether a location (a cell, a column or a row) is selected.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\t// type: String\r\n\t\t//\t\t\"row\" or \"col\" or \"cell\"\r\n\t\t// rowIndex: Integer\r\n\t\t//\t\tIf type is \"row\" or \"cell\", this is the row index.\r\n\t\t//\t\tIf type if \"col\", this is the column index.\r\n\t\t// colIndex: Integer?\r\n\t\t//\t\tOnly valid when type is \"cell\"\r\n\t\t// returns: Boolean\r\n\t\t//\t\ttrue if selected, false if not. If cell is covered by a selected column, it's selected.\r\n\t\treturn this._isSelected(type, _createItem(type, rowIndex, colIndex));\r\n\t},\r\n\ttoggleSelect: function(type, rowIndex, colIndex){\r\n\t\tthis._startSelect(type, _createItem(type, rowIndex, colIndex), this._config[type] === MULTI, false, false, !this.isSelected(type, rowIndex, colIndex));\r\n\t\tthis._endSelect(type);\r\n\t},\r\n\tselect: function(type, rowIndex, colIndex){\r\n\t\t// summary:\r\n\t\t//\t\tSelect a location (a cell, a column or a row).\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\t// type: String\r\n\t\t//\t\t\"row\" or \"col\" or \"cell\"\r\n\t\t// rowIndex: Integer\r\n\t\t//\t\tIf type is \"row\" or \"cell\", this is the row index.\r\n\t\t//\t\tIf type if \"col\", this is the column index.\r\n\t\t// colIndex: Integer?\r\n\t\t//\t\tOnly valid when type is \"cell\"\r\n\t\tif(!this.isSelected(type, rowIndex, colIndex)){\r\n\t\t\tthis.toggleSelect(type, rowIndex, colIndex);\r\n\t\t}\r\n\t},\r\n\tdeselect: function(type, rowIndex, colIndex){\r\n\t\tif(this.isSelected(type, rowIndex, colIndex)){\r\n\t\t\tthis.toggleSelect(type, rowIndex, colIndex);\r\n\t\t}\r\n\t},\r\n\tselectRange: function(type, start, end, toSelect){\r\n\t\t// summary:\r\n\t\t//\t\tSelect a continuous range (a block of cells, a set of continuous columns or rows)\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\t// type: String\r\n\t\t//\t\t\"row\" or \"col\" or \"cell\"\r\n\t\t// start: Integer|Object\r\n\t\t//\t\tIf type is \"row\" or \"col\", this is the index of the starting row or column.\r\n\t\t//\t\tIf type if \"cell\", this is the left-top cell of the range.\r\n\t\t// end: Integer|Object\r\n\t\t//\t\tIf type is \"row\" or \"col\", this is the index of the ending row or column.\r\n\t\t//\t\tIf type if \"cell\", this is the right-bottom cell of the range.\r\n\t\tthis.grid._selectingRange = true;\r\n\t\tvar startPoint = type == \"cell\" ? _createItem(type, start.row, start.col) : _createItem(type, start),\r\n\t\t\tendPoint = type == \"cell\" ? _createItem(type, end.row, end.col) : _createItem(type, end);\r\n\t\tthis._startSelect(type, startPoint, false, false, false, toSelect);\r\n\t\tthis._highlight(type, endPoint, toSelect === undefined ? true : toSelect);\r\n\t\tthis._endSelect(type);\r\n\t\tthis.grid._selectingRange = false;\r\n\t},\r\n\tclear: function(type){\r\n\t\t// summary:\r\n\t\t//\t\tClear all selections.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\t// type: String?\r\n\t\t//\t\t\"row\" or \"col\" or \"cell\". If omitted, clear all.\r\n\t\tthis._clearSelection(type || \"all\");\r\n\t},\r\n\tisSelecting: function(type){\r\n\t\t// summary:\r\n\t\t//\t\tCheck whether the user is currently selecting something.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\t// type: String\r\n\t\t//\t\t\"row\" or \"col\" or \"cell\"\r\n\t\t// returns: Boolean\r\n\t\t//\t\ttrue if is selection, false otherwise.\r\n\t\tif(typeof type == \"undefined\"){\r\n\t\t\treturn this._selecting.col || this._selecting.row || this._selecting.cell;\r\n\t\t}\r\n\t\treturn this._selecting[type];\r\n\t},\r\n\tselectEnabled: function(toEnable){\r\n\t\t// summary:\r\n\t\t//\t\tTurn on/off this selection functionality if *toEnable* is provided.\r\n\t\t//\t\tCheck whether this selection functionality is enabled if nothing is passed in.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\t// toEnable: Boolean?\r\n\t\t//\t\tTo enable or not.\r\n\t\t// returns: Boolean|undefined\r\n\t\t//\t\tEnabled or not.\r\n\t\tif(typeof toEnable != \"undefined\" && !this.isSelecting()){\r\n\t\t\tthis._enabled = !!toEnable;\r\n\t\t}\r\n\t\treturn this._enabled;\r\n\t},\r\n\tgetSelected: function(type, includeExceptions){\r\n\t\t// summary:\r\n\t\t//\t\tGet an array of selected locations.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\t// type: String\r\n\t\t//\t\t\"row\" or \"col\" or \"cell\"\r\n\t\t// includeExceptions: Boolean\r\n\t\t//\t\tOnly meaningful for rows/columns. If true, all selected rows/cols, even they are partly selected, are all returned.\r\n\t\t// returns: __SelectItem[]\r\n\t\tswitch(type){\r\n\t\t\tcase \"cell\":\r\n\t\t\t\treturn array.map(this._selected[type], function(item){ return item; });\r\n\t\t\tcase \"col\": case \"row\":\r\n\t\t\t\treturn array.map(includeExceptions ? this._selected[type]\r\n\t\t\t\t: array.filter(this._selected[type], function(item){\r\n\t\t\t\t\treturn item.except.length === 0;\r\n\t\t\t\t}), function(item){\r\n\t\t\t\t\treturn includeExceptions ? item : item[type];\r\n\t\t\t\t});\r\n\t\t}\r\n\t\treturn [];\r\n\t},\r\n\tgetSelectedCount: function(type, includeExceptions){\r\n\t\t// summary:\r\n\t\t//\t\tGet the number of selected items.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\t// type: String\r\n\t\t//\t\t\"row\" or \"col\" or \"cell\"\r\n\t\t// includeExceptions: Boolean\r\n\t\t//\t\tOnly meaningful for rows/columns. If true, all selected rows/cols, even they are partly selected, are all returned.\r\n\t\t// returns: Integer\r\n\t\t//\t\tThe number of selected items.\r\n\t\tswitch(type){\r\n\t\t\tcase \"cell\":\r\n\t\t\t\treturn this._selected[type].length;\r\n\t\t\tcase \"col\": case \"row\":\r\n\t\t\t\treturn (includeExceptions ? this._selected[type]\r\n\t\t\t\t: array.filter(this._selected[type], function(item){\r\n\t\t\t\t\treturn item.except.length === 0;\r\n\t\t\t\t})).length;\r\n\t\t}\r\n\t\treturn 0;\r\n\t},\r\n\tgetSelectedType: function(){\r\n\t\t// summary:\r\n\t\t//\t\tGet the type of selected items.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\t// returns: String\r\n\t\t//\t\t\"row\" or \"col\" or \"cell\", or any mix of these (separator is | ).\r\n\t\tvar s = this._selected;\r\n\t\treturn [\"\",\t\t\"cell\",\t\t\"row\",\t\t\"row|cell\",\r\n\t\t\t\t\"col\",\t\"col|cell\",\t\"col|row\",\t\"col|row|cell\"\r\n\t\t\t][(!!s.cell.length) | (!!s.row.length << 1) | (!!s.col.length << 2)];\r\n\t},\r\n\tgetLastSelectedRange: function(type){\r\n\t\t// summary:\r\n\t\t//\t\tGet last selected range of the given type.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\t// returns: Object\r\n\t\t//\t\t{start: __SelectItem, end: __SelectItem}\r\n\t\t//\t\treturn null if nothing is selected.\r\n\t\treturn this._lastAnchorPoint[type] ? {\r\n\t\t\t\"start\": this._lastAnchorPoint[type],\r\n\t\t\t\"end\": this._lastEndPoint[type]\r\n\t\t} : null;\r\n\t},\r\n\t\r\n\t//--------------------------private----------------------------\r\n\t_hacks: function(){\r\n\t\t// summary:\r\n\t\t//\t\tComplete the event system of grid, hack some grid functions to prevent default behavior.\r\n\t\tvar g = this.grid;\r\n\t\tvar doContentMouseUp = function(e){\r\n\t\t\tif(e.cellNode){\r\n\t\t\t\tg.onMouseUp(e);\r\n\t\t\t}\r\n\t\t\tg.onMouseUpRow(e);\r\n\t\t};\r\n\t\tvar mouseUp = lang.hitch(g, \"onMouseUp\");\r\n\t\tvar mouseDown = lang.hitch(g, \"onMouseDown\");\r\n\t\tvar doRowSelectorFocus = function(e){\r\n\t\t\te.cellNode.style.border = \"solid 1px\";\r\n\t\t};\r\n\t\tarray.forEach(g.views.views, function(view){\r\n\t\t\tview.content.domouseup = doContentMouseUp;\r\n\t\t\tview.header.domouseup = mouseUp;\r\n\t\t\tif(view.declaredClass == \"dojox.grid._RowSelector\"){\r\n\t\t\t\tview.domousedown = mouseDown;\r\n\t\t\t\tview.domouseup = mouseUp;\r\n\t\t\t\tview.dofocus = doRowSelectorFocus;\r\n\t\t\t}\r\n\t\t});\r\n\t\t//Disable default selection.\r\n\t\tg.selection.clickSelect = function(){};\r\n\t\t\r\n\t\tthis._oldDeselectAll = g.selection.deselectAll;\r\n\t\tvar _this = this;\r\n\t\tg.selection.selectRange = function(from, to){\r\n\t\t\t_this.selectRange(\"row\", from, to, true);\r\n\t\t\tif(g.selection.preserver){\r\n\t\t\t\tg.selection.preserver._updateMapping(true, true, false, from, to);\r\n\t\t\t}\r\n\t\t\tg.selection.onChanged();\r\n\t\t};\r\n\t\tg.selection.deselectRange = function(from, to){\r\n\t\t\t_this.selectRange(\"row\", from, to, false);\r\n\t\t\tif(g.selection.preserver){\r\n\t\t\t\tg.selection.preserver._updateMapping(true, false, false, from, to);\r\n\t\t\t}\r\n\t\t\tg.selection.onChanged();\r\n\t\t};\r\n\t\tg.selection.deselectAll = function(){\r\n\t\t\tg._selectingRange = true;\r\n\t\t\t_this._oldDeselectAll.apply(g.selection, arguments);\r\n\t\t\t_this._clearSelection(\"all\");\r\n\t\t\tg._selectingRange = false;\r\n\t\t\tif(g.selection.preserver){\r\n\t\t\t\tg.selection.preserver._updateMapping(true, false, true);\r\n\t\t\t}\r\n\t\t\tg.selection.onChanged();\r\n\t\t};\r\n\t\t\r\n\t\tvar rowSelector = g.views.views[0];\r\n\t\t//The default function re-write the whole className, so can not insert any other classes.\r\n\t\tif(rowSelector instanceof _RowSelector){\r\n\t\t\trowSelector.doStyleRowNode = function(inRowIndex, inRowNode){\r\n\t\t\t\thtml.removeClass(inRowNode, \"dojoxGridRow\");\r\n\t\t\t\thtml.addClass(inRowNode, \"dojoxGridRowbar\");\r\n\t\t\t\thtml.addClass(inRowNode, \"dojoxGridNonNormalizedCell\");\r\n\t\t\t\thtml.toggleClass(inRowNode, \"dojoxGridRowbarOver\", g.rows.isOver(inRowIndex));\r\n\t\t\t\thtml.toggleClass(inRowNode, \"dojoxGridRowbarSelected\", !!g.selection.isSelected(inRowIndex));\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis.connect(g, \"updateRow\", function(rowIndex){\r\n\t\t\tarray.forEach(g.layout.cells, function(cell){\r\n\t\t\t\tif(this.isSelected(\"cell\", rowIndex, cell.index)){\r\n\t\t\t\t\tthis._highlightNode(cell.getNode(rowIndex), true);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t});\r\n\t},\r\n\t_mixinGrid: function(){\r\n\t\t// summary:\r\n\t\t//\t\tExpose events to grid.\r\n\t\tvar g = this.grid;\r\n\t\tg.setupSelectorConfig = lang.hitch(this, this.setupConfig);\r\n\t\tg.onStartSelect = function(){};\r\n\t\tg.onEndSelect = function(){};\r\n\t\tg.onStartDeselect = function(){};\r\n\t\tg.onEndDeselect = function(){};\r\n\t\tg.onSelectCleared = function(){};\r\n\t},\r\n\t_initEvents: function(){\r\n\t\t// summary:\r\n\t\t//\t\tConnect events, create event handlers.\r\n\t\tvar g = this.grid,\r\n\t\t\t_this = this,\r\n\t\t\tdp = lang.partial,\r\n\t\t\tstarter = function(type, e){\r\n\t\t\t\tif(type === \"row\"){\r\n\t\t\t\t\t_this._isUsingRowSelector = true;\r\n\t\t\t\t}\r\n\t\t\t\t//only left mouse button can select.\r\n\t\t\t\tif(_this.selectEnabled() && _this._config[type] && e.button != 2){\r\n\t\t\t\t\tif(_this._keyboardSelect.col || _this._keyboardSelect.row || _this._keyboardSelect.cell){\r\n\t\t\t\t\t\t_this._endSelect(\"all\");\r\n\t\t\t\t\t\t_this._keyboardSelect.col = _this._keyboardSelect.row = _this._keyboardSelect.cell = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(_this._usingKeyboard){\r\n\t\t\t\t\t\t_this._usingKeyboard = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar target = _createItem(type, e.rowIndex, e.cell && e.cell.index);\r\n\t\t\t\t\t_this._startSelect(type, target, e.ctrlKey, e.shiftKey);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tender = lang.hitch(this, \"_endSelect\");\r\n\t\tthis.connect(g, \"onHeaderCellMouseDown\", dp(starter, \"col\"));\r\n\t\tthis.connect(g, \"onHeaderCellMouseUp\", dp(ender, \"col\"));\r\n\t\t\r\n\t\tthis.connect(g, \"onRowSelectorMouseDown\", dp(starter, \"row\"));\r\n\t\tthis.connect(g, \"onRowSelectorMouseUp\", dp(ender, \"row\"));\r\n\t\t\r\n\t\tthis.connect(g, \"onCellMouseDown\", function(e){\r\n\t\t\tif(e.cell && e.cell.isRowSelector){ return; }\r\n\t\t\tif(g.singleClickEdit){\r\n\t\t\t\t_this._singleClickEdit = true;\r\n\t\t\t\tg.singleClickEdit = false;\r\n\t\t\t}\r\n\t\t\tstarter(_this._config[\"cell\"] == DISABLED ? \"row\" : \"cell\", e);\r\n\t\t});\r\n\t\tthis.connect(g, \"onCellMouseUp\", function(e){\r\n\t\t\tif(_this._singleClickEdit){\r\n\t\t\t\tdelete _this._singleClickEdit;\r\n\t\t\t\tg.singleClickEdit = true;\r\n\t\t\t}\r\n\t\t\tender(\"all\", e);\r\n\t\t});\r\n\t\t\r\n\t\tthis.connect(g, \"onCellMouseOver\", function(e){\r\n\t\t\tif(_this._curType != \"row\" && _this._selecting[_this._curType] && _this._config[_this._curType] == MULTI){\r\n\t\t\t\t_this._highlight(\"col\", _createItem(\"col\", e.cell.index), _this._toSelect);\r\n\t\t\t\tif(!_this._keyboardSelect.cell){\r\n\t\t\t\t\t_this._highlight(\"cell\", _createItem(\"cell\", e.rowIndex, e.cell.index), _this._toSelect);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.connect(g, \"onHeaderCellMouseOver\", function(e){\r\n\t\t\tif(_this._selecting.col && _this._config.col == MULTI){\r\n\t\t\t\t_this._highlight(\"col\", _createItem(\"col\", e.cell.index), _this._toSelect);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.connect(g, \"onRowMouseOver\", function(e){\r\n\t\t\tif(_this._selecting.row && _this._config.row == MULTI){\r\n\t\t\t\t_this._highlight(\"row\", _createItem(\"row\", e.rowIndex), _this._toSelect);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t//When row order has changed in a unpredictable way (sorted or filtered), map the new rowindex.\r\n\t\tthis.connect(g, \"onSelectedById\", \"_onSelectedById\");\r\n\t\t\r\n\t\t//When the grid refreshes, all those selected should still appear selected.\r\n\t\tthis.connect(g, \"_onFetchComplete\", function(){\r\n\t\t\t//console.debug(\"refresh after buildPage:\", g._notRefreshSelection);\r\n\t\t\tif(!g._notRefreshSelection){\r\n\t\t\t\tthis._refreshSelected(true);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//Small scroll might not refresh the grid.\r\n\t\tthis.connect(g.scroller, \"buildPage\", function(){\r\n\t\t\t//console.debug(\"refresh after buildPage:\", g._notRefreshSelection);\r\n\t\t\tif(!g._notRefreshSelection){\r\n\t\t\t\tthis._refreshSelected(true);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t//Whenever the mouse is up, end selecting.\r\n\t\tthis.connect(win.doc, \"onmouseup\", dp(ender, \"all\"));\r\n\t\t\r\n\t\t//If autoscroll is enabled, connect to it.\r\n\t\tthis.connect(g, \"onEndAutoScroll\", function(isVertical, isForward, view, target){\r\n\t\t\tvar selectCell = _this._selecting.cell,\r\n\t\t\t\ttype, current, dir = isForward ? 1 : -1;\r\n\t\t\tif(isVertical && (selectCell || _this._selecting.row)){\r\n\t\t\t\ttype = selectCell ? \"cell\" : \"row\";\r\n\t\t\t\tcurrent = _this._currentPoint[type];\r\n\t\t\t\t_this._highlight(type, _createItem(type, current.row + dir, current.col), _this._toSelect);\r\n\t\t\t}else if(!isVertical && (selectCell || _this._selecting.col)){\r\n\t\t\t\ttype = selectCell ? \"cell\" : \"col\";\r\n\t\t\t\tcurrent = _this._currentPoint[type];\r\n\t\t\t\t_this._highlight(type, _createItem(type, current.row, target), _this._toSelect);\r\n\t\t\t}\r\n\t\t});\r\n\t\t//If the grid is changed, selection should be consistent.\r\n\t\tthis.subscribe(\"dojox/grid/rearrange/move/\" + g.id, \"_onInternalRearrange\");\r\n\t\tthis.subscribe(\"dojox/grid/rearrange/copy/\" + g.id, \"_onInternalRearrange\");\r\n\t\tthis.subscribe(\"dojox/grid/rearrange/change/\" + g.id, \"_onExternalChange\");\r\n\t\tthis.subscribe(\"dojox/grid/rearrange/insert/\" + g.id, \"_onExternalChange\");\r\n\t\tthis.subscribe(\"dojox/grid/rearrange/remove/\" + g.id, \"clear\");\r\n\t\t\r\n\t\t//have to also select when the grid's default select is used.\r\n\t\tthis.connect(g, \"onSelected\", function(rowIndex){\r\n\t\t\tif(this._selectedRowModified && this._isUsingRowSelector){\r\n\t\t\t\tdelete this._selectedRowModified;\r\n\t\t\t}else if(!this.grid._selectingRange){\r\n\t\t\t\tthis.select(\"row\", rowIndex);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.connect(g, \"onDeselected\", function(rowIndex){\r\n\t\t\tif(this._selectedRowModified && this._isUsingRowSelector){\r\n\t\t\t\tdelete this._selectedRowModified;\r\n\t\t\t}else if(!this.grid._selectingRange){\r\n\t\t\t\tthis.deselect(\"row\", rowIndex);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t_onSelectedById: function(id, newIndex, isSelected){\r\n\t\tif(this.grid._noInternalMapping){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar pointSet = [this._lastAnchorPoint.row, this._lastEndPoint.row,\r\n\t\t\tthis._lastSelectedAnchorPoint.row, this._lastSelectedEndPoint.row];\r\n\t\tpointSet = pointSet.concat(this._selected.row);\r\n\t\tvar found = false;\r\n\t\tarray.forEach(pointSet, function(item){\r\n\t\t\tif(item){\r\n\t\t\t\tif(item.id === id){\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\titem.row = newIndex;\r\n\t\t\t\t}else if(item.row === newIndex && item.id){\r\n\t\t\t\t\titem.row = -1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(!found && isSelected){\r\n\t\t\tarray.some(this._selected.row, function(item){\r\n\t\t\t\tif(item && !item.id && !item.except.length){\r\n\t\t\t\t\titem.id = id;\r\n\t\t\t\t\titem.row = newIndex;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t}\r\n\t\tfound = false;\r\n\t\tpointSet = [this._lastAnchorPoint.cell, this._lastEndPoint.cell,\r\n\t\t\tthis._lastSelectedAnchorPoint.cell, this._lastSelectedEndPoint.cell];\r\n\t\tpointSet = pointSet.concat(this._selected.cell);\r\n\t\tarray.forEach(pointSet, function(item){\r\n\t\t\tif(item){\r\n\t\t\t\tif(item.id === id){\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\titem.row = newIndex;\r\n\t\t\t\t}else if(item.row === newIndex && item.id){\r\n\t\t\t\t\titem.row = -1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tonSetStore: function(){\r\n\t\tthis._clearSelection(\"all\");\r\n\t},\r\n\t_onInternalRearrange: function(type, mapping){\r\n\t\ttry{\r\n\t\t//The column can not refresh it self!\r\n\t\tthis._refresh(\"col\", false);\r\n\t\t\r\n\t\tarray.forEach(this._selected.row, function(item){\r\n\t\t\tarray.forEach(this.grid.layout.cells, function(cell){\r\n\t\t\t\tthis._highlightNode(cell.getNode(item.row), false);\r\n\t\t\t}, this);\r\n\t\t}, this);\r\n\t\t//The rowbar must be cleaned manually\r\n\t\tquery(\".dojoxGridRowSelectorSelected\").forEach(function(node){\r\n\t\t\thtml.removeClass(node, \"dojoxGridRowSelectorSelected\");\r\n\t\t\thtml.removeClass(node, \"dojoxGridRowSelectorSelectedUp\");\r\n\t\t\thtml.removeClass(node, \"dojoxGridRowSelectorSelectedDown\");\r\n\t\t});\r\n\t\t\r\n\t\tvar cleanUp = function(item){\r\n\t\t\tif(item){\r\n\t\t\t\tdelete item.converted;\r\n\t\t\t}\r\n\t\t},\r\n\t\tpointSet = [this._lastAnchorPoint[type], this._lastEndPoint[type],\r\n\t\t\tthis._lastSelectedAnchorPoint[type], this._lastSelectedEndPoint[type]];\r\n\t\t\r\n\t\tif(type === \"cell\"){\r\n\t\t\tthis.selectRange(\"cell\", mapping.to.min, mapping.to.max);\r\n\t\t\tvar cells = this.grid.layout.cells;\r\n\t\t\tarray.forEach(pointSet, function(item){\r\n\t\t\t\tif(item.converted){ return; }\r\n\t\t\t\tfor(var r = mapping.from.min.row, tr = mapping.to.min.row; r <= mapping.from.max.row; ++r, ++tr){\r\n\t\t\t\t\tfor(var c = mapping.from.min.col, tc = mapping.to.min.col; c <= mapping.from.max.col; ++c, ++tc){\r\n\t\t\t\t\t\twhile(cells[c].hidden){ ++c; }\r\n\t\t\t\t\t\twhile(cells[tc].hidden){ ++tc; }\r\n\t\t\t\t\t\tif(item.row == r && item.col == c){\r\n\t\t\t\t\t\t\t//console.log('mapping found: (', item.row, \",\",item.col,\") to (\", tr, \",\", tc,\")\");\r\n\t\t\t\t\t\t\titem.row = tr;\r\n\t\t\t\t\t\t\titem.col = tc;\r\n\t\t\t\t\t\t\titem.converted = true;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tpointSet = this._selected.cell.concat(this._selected[type]).concat(pointSet).concat(\r\n\t\t\t\t[this._lastAnchorPoint.cell, this._lastEndPoint.cell,\r\n\t\t\t\tthis._lastSelectedAnchorPoint.cell, this._lastSelectedEndPoint.cell]);\r\n\t\t\tarray.forEach(pointSet, function(item){\r\n\t\t\t\tif(item && !item.converted){\r\n\t\t\t\t\tvar from = item[type];\r\n\t\t\t\t\tif(from in mapping){\r\n\t\t\t\t\t\titem[type] = mapping[from];\r\n\t\t\t\t\t}\r\n\t\t\t\t\titem.converted = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tarray.forEach(this._selected[_theOther[type]], function(item){\r\n\t\t\t\tfor(var i = 0, len = item.except.length; i < len; ++i){\r\n\t\t\t\t\tvar from = item.except[i];\r\n\t\t\t\t\tif(from in mapping){\r\n\t\t\t\t\t\titem.except[i] = mapping[from];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tarray.forEach(pointSet, cleanUp);\r\n\t\t\r\n\t\tthis._refreshSelected(true);\r\n\t\tthis._focusPoint(type, this._lastEndPoint);\r\n\t\t}catch(e){\r\n\t\t\tconsole.warn(\"Selector._onInternalRearrange() error\",e);\r\n\t\t}\r\n\t},\r\n\t_onExternalChange: function(type, target){\r\n\t\tvar start = type == \"cell\" ? target.min : target[0],\r\n\t\t\tend = type == \"cell\" ? target.max : target[target.length - 1];\r\n\t\tthis.selectRange(type, start, end);\r\n\t},\r\n\t_refresh: function(type, toHighlight){\r\n\t\tif(!this._keyboardSelect[type]){\r\n\t\t\tarray.forEach(this._selected[type], function(item){\r\n\t\t\t\tthis._highlightSingle(type, toHighlight, item, undefined, true);\r\n\t\t\t}, this);\r\n\t\t}\r\n\t},\r\n\t_refreshSelected: function(){\r\n\t\tthis._refresh(\"col\", true);\r\n\t\tthis._refresh(\"row\", true);\r\n\t\tthis._refresh(\"cell\", true);\r\n\t},\r\n\t_initAreas: function(){\r\n\t\tvar g = this.grid, f = g.focus, _this = this,\r\n\t\t\tkeyboardSelectReady = 1, duringKeyboardSelect = 2,\r\n\t\t\tonmove = function(type, createNewEnd, rowStep, colStep, evt){\r\n\t\t\t\t//Keyboard swipe selection is SHIFT + Direction Keys.\r\n\t\t\t\tvar ks = _this._keyboardSelect;\r\n\t\t\t\t//Tricky, rely on valid status not being 0.\r\n\t\t\t\tif(evt.shiftKey && ks[type]){\r\n\t\t\t\t\tif(ks[type] === keyboardSelectReady){\r\n\t\t\t\t\t\tif(type === \"cell\"){\r\n\t\t\t\t\t\t\tvar item = _this._lastEndPoint[type];\r\n\t\t\t\t\t\t\tif(f.cell != g.layout.cells[item.col + colStep] || f.rowIndex != item.row + rowStep){\r\n\t\t\t\t\t\t\t\tks[type] = 0;\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//If selecting is not started, start it\r\n\t\t\t\t\t\t_this._startSelect(type, _this._lastAnchorPoint[type], true, false, true);\r\n\t\t\t\t\t\t_this._highlight(type, _this._lastEndPoint[type], _this._toSelect);\r\n\t\t\t\t\t\tks[type] = duringKeyboardSelect;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//Highlight to the new end point.\r\n\t\t\t\t\tvar newEnd = createNewEnd(type, rowStep, colStep, evt);\r\n\t\t\t\t\tif(_this._isValid(type, newEnd, g)){\r\n\t\t\t\t\t\t_this._highlight(type, newEnd, _this._toSelect);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_stopEvent(evt);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonkeydown = function(type, getTarget, evt, isBubble){\r\n\t\t\t\tif(isBubble && _this.selectEnabled() && _this._config[type] != DISABLED){\r\n\t\t\t\t\tswitch(evt.keyCode){\r\n\t\t\t\t\t\tcase keys.SPACE:\r\n\t\t\t\t\t\t\t//Keyboard single point selection is SPACE.\r\n\t\t\t\t\t\t\t_this._startSelect(type, getTarget(), evt.ctrlKey, evt.shiftKey);\r\n\t\t\t\t\t\t\t_this._endSelect(type);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase keys.SHIFT:\r\n\t\t\t\t\t\t\t//Keyboard swipe selection starts with SHIFT.\r\n\t\t\t\t\t\t\tif(_this._config[type] == MULTI && _this._isValid(type, _this._lastAnchorPoint[type], g)){\r\n\t\t\t\t\t\t\t\t//End last selection if any.\r\n\t\t\t\t\t\t\t\t_this._endSelect(type);\r\n\t\t\t\t\t\t\t\t_this._keyboardSelect[type] = keyboardSelectReady;\r\n\t\t\t\t\t\t\t\t_this._usingKeyboard = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonkeyup = function(type, evt, isBubble){\r\n\t\t\t\tif(isBubble && evt.keyCode == keys.SHIFT && _this._keyboardSelect[type]){\r\n\t\t\t\t\t_this._endSelect(type);\r\n\t\t\t\t\t_this._keyboardSelect[type] = 0;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t//TODO: this area \"rowHeader\" should be put outside, same level as header/content.\r\n\t\tif(g.views.views[0] instanceof _RowSelector){\r\n\t\t\tthis._lastFocusedRowBarIdx = 0;\r\n\t\t\tf.addArea({\r\n\t\t\t\tname:\"rowHeader\",\r\n\t\t\t\tonFocus: function(evt, step){\r\n\t\t\t\t\tvar view = g.views.views[0];\r\n\t\t\t\t\tif(view instanceof _RowSelector){\r\n\t\t\t\t\t\tvar rowBarNode = view.getCellNode(_this._lastFocusedRowBarIdx, 0);\r\n\t\t\t\t\t\tif(rowBarNode){\r\n\t\t\t\t\t\t\thtml.toggleClass(rowBarNode, f.focusClass, false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//evt might not be real event, it may be a mock object instead.\r\n\t\t\t\t\t\tif(evt && \"rowIndex\" in evt){\r\n\t\t\t\t\t\t\tif(evt.rowIndex >= 0){\r\n\t\t\t\t\t\t\t\t_this._lastFocusedRowBarIdx = evt.rowIndex;\r\n\t\t\t\t\t\t\t}else if(!_this._lastFocusedRowBarIdx){\r\n\t\t\t\t\t\t\t\t_this._lastFocusedRowBarIdx = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\trowBarNode = view.getCellNode(_this._lastFocusedRowBarIdx, 0);\r\n\t\t\t\t\t\tif(rowBarNode){\r\n\t\t\t\t\t\t\tdijitFocus.focus(rowBarNode);\r\n\t\t\t\t\t\t\thtml.toggleClass(rowBarNode, f.focusClass, true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tf.rowIndex = _this._lastFocusedRowBarIdx;\r\n\t\t\t\t\t\t_stopEvent(evt);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t},\r\n\t\t\t\tonBlur: function(evt, step){\r\n\t\t\t\t\tvar view = g.views.views[0];\r\n\t\t\t\t\tif(view instanceof _RowSelector){\r\n\t\t\t\t\t\tvar rowBarNode = view.getCellNode(_this._lastFocusedRowBarIdx, 0);\r\n\t\t\t\t\t\tif(rowBarNode){\r\n\t\t\t\t\t\t\thtml.toggleClass(rowBarNode, f.focusClass, false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t_stopEvent(evt);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t},\r\n\t\t\t\tonMove: function(rowStep, colStep, evt){\r\n\t\t\t\t\tvar view = g.views.views[0];\r\n\t\t\t\t\tif(rowStep && view instanceof _RowSelector){\r\n\t\t\t\t\t\tvar next = _this._lastFocusedRowBarIdx + rowStep;\r\n\t\t\t\t\t\tif(next >= 0 && next < g.rowCount){\r\n\t\t\t\t\t\t\t//TODO: these logic require a better Scroller.\r\n\t\t\t\t\t\t\t_stopEvent(evt);\r\n\t\t\t\t\t\t\tvar rowBarNode = view.getCellNode(_this._lastFocusedRowBarIdx, 0);\r\n\t\t\t\t\t\t\thtml.toggleClass(rowBarNode, f.focusClass, false);\r\n\t\t\t\t\t\t\t//If the row is not fetched, fetch it.\r\n\t\t\t\t\t\t\tvar sc = g.scroller;\r\n\t\t\t\t\t\t\tvar lastPageRow = sc.getLastPageRow(sc.page);\r\n\t\t\t\t\t\t\tvar rc = g.rowCount - 1, row = Math.min(rc, next);\r\n\t\t\t\t\t\t\tif(next > lastPageRow){\r\n\t\t\t\t\t\t\t\tg.setScrollTop(g.scrollTop + sc.findScrollTop(row) - sc.findScrollTop(_this._lastFocusedRowBarIdx));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//Now we have fetched the row.\r\n\t\t\t\t\t\t\trowBarNode = view.getCellNode(next, 0);\r\n\t\t\t\t\t\t\tdijitFocus.focus(rowBarNode);\r\n\t\t\t\t\t\t\thtml.toggleClass(rowBarNode, f.focusClass, true);\r\n\t\t\t\t\t\t\t_this._lastFocusedRowBarIdx = next;\r\n\t\t\t\t\t\t\t//If the row is out of view, scroll to it.\r\n\t\t\t\t\t\t\tf.cell = rowBarNode;\r\n\t\t\t\t\t\t\tf.cell.view = view;\r\n\t\t\t\t\t\t\tf.cell.getNode = function(index){\r\n\t\t\t\t\t\t\t\treturn f.cell;\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tf.rowIndex = _this._lastFocusedRowBarIdx;\r\n\t\t\t\t\t\t\tf.scrollIntoView();\r\n\t\t\t\t\t\t\tf.cell = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tf.placeArea(\"rowHeader\",\"before\",\"content\");\r\n\t\t}\r\n\t\t//Support keyboard selection.\r\n\t\tf.addArea({\r\n\t\t\tname:\"cellselect\",\r\n\t\t\tonMove: lang.partial(onmove, \"cell\", function(type, rowStep, colStep, evt){\r\n\t\t\t\tvar current = _this._currentPoint[type];\r\n\t\t\t\treturn _createItem(\"cell\", current.row + rowStep, current.col + colStep);\r\n\t\t\t}),\r\n\t\t\tonKeyDown: lang.partial(onkeydown, \"cell\", function(){\r\n\t\t\t\treturn _createItem(\"cell\", f.rowIndex, f.cell.index);\r\n\t\t\t}),\r\n\t\t\tonKeyUp: lang.partial(onkeyup, \"cell\")\r\n\t\t});\r\n\t\tf.placeArea(\"cellselect\",\"below\",\"content\");\r\n\t\tf.addArea({\r\n\t\t\tname:\"colselect\",\r\n\t\t\tonMove: lang.partial(onmove, \"col\", function(type, rowStep, colStep, evt){\r\n\t\t\t\tvar current = _this._currentPoint[type];\r\n\t\t\t\treturn _createItem(\"col\", current.col + colStep);\r\n\t\t\t}),\r\n\t\t\tonKeyDown: lang.partial(onkeydown, \"col\", function(){\r\n\t\t\t\treturn _createItem(\"col\", f.getHeaderIndex());\r\n\t\t\t}),\r\n\t\t\tonKeyUp: lang.partial(onkeyup, \"col\")\r\n\t\t});\r\n\t\tf.placeArea(\"colselect\",\"below\",\"header\");\r\n\t\tf.addArea({\r\n\t\t\tname:\"rowselect\",\r\n\t\t\tonMove: lang.partial(onmove, \"row\", function(type, rowStep, colStep, evt){\r\n\t\t\t\treturn _createItem(\"row\", f.rowIndex);\r\n\t\t\t}),\r\n\t\t\tonKeyDown: lang.partial(onkeydown, \"row\", function(){\r\n\t\t\t\treturn _createItem(\"row\", f.rowIndex);\r\n\t\t\t}),\r\n\t\t\tonKeyUp: lang.partial(onkeyup, \"row\")\r\n\t\t});\r\n\t\tf.placeArea(\"rowselect\",\"below\",\"rowHeader\");\r\n\t},\r\n\t_clearSelection: function(type, reservedItem){\r\n\t\t// summary:\r\n\t\t//\t\tClear selection for given type and fire events, but retain the highlight for *reservedItem*,\r\n\t\t//\t\tthus avoid \"flashing\".\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\t// type: String\r\n\t\t//\t\t\"row\", \"col\", or \"cell\r\n\t\t// reservedItem: __SelectItem\r\n\t\t//\t\tThe item to retain highlight.\r\n\t\tif(type == \"all\"){\r\n\t\t\tthis._clearSelection(\"cell\", reservedItem);\r\n\t\t\tthis._clearSelection(\"col\", reservedItem);\r\n\t\t\tthis._clearSelection(\"row\", reservedItem);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._isUsingRowSelector = true;\r\n\t\tarray.forEach(this._selected[type], function(item){\r\n\t\t\tif(!_isEqual(type, reservedItem, item)){\r\n\t\t\t\tthis._highlightSingle(type, false, item);\r\n\t\t\t}\r\n\t\t}, this);\r\n\t\tthis._blurPoint(type, this._currentPoint);\r\n\t\tthis._selecting[type] = false;\r\n\t\tthis._startPoint[type] = this._currentPoint[type] = null;\r\n\t\tthis._selected[type] = [];\r\n\t\t\r\n\t\t//Have to also deselect default grid selection.\r\n\t\tif(type == \"row\" && !this.grid._selectingRange){\r\n\t\t\tthis._oldDeselectAll.call(this.grid.selection);\r\n\t\t\tthis.grid.selection._selectedById = {};\r\n\t\t}\r\n\t\t\r\n\t\t//Fire events.\r\n\t\tthis.grid.onEndDeselect(type, null, null, this._selected);\r\n\t\tthis.grid.onSelectCleared(type);\r\n\t},\r\n\t_startSelect: function(type, start, extending, isRange, mandatarySelect, toSelect){\r\n\t\t// summary:\r\n\t\t//\t\tStart selection, setup start point and current point, fire events.\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\t// type: String\r\n\t\t//\t\t\"row\", \"col\", or \"cell\"\r\n\t\t// extending: Boolean\r\n\t\t//\t\tWhether this is a multi selection\r\n\t\t// isRange: Boolean\r\n\t\t//\t\tWhether this is a range selection (i.e. select from the last end point to this point)\r\n\t\t// start: __SelectItem\r\n\t\t//\t\tThe start point\r\n\t\t// mandatarySelect: Boolean\r\n\t\t//\t\tIf true, toSelect will be same as the original selection status.\r\n\t\tif(!this._isValid(type, start)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar lastIsSelected = this._isSelected(type, this._lastEndPoint[type]),\r\n\t\t\tisSelected = this._isSelected(type, start);\r\n\t\t\r\n\t\tif(this.noClear && !extending){\r\n\t\t\tthis._toSelect = toSelect === undefined ? true : toSelect;\r\n\t\t}else{\r\n\t\t\t//If we are modifying the selection using keyboard, retain the old status.\r\n\t\t\tthis._toSelect = mandatarySelect ? isSelected : !isSelected;\r\n\t\t}\r\n\t\t\r\n\t\t//If CTRL is not pressed or it's SINGLE mode, this is a brand new selection.\r\n\t\tif(!extending || (!isSelected && this._config[type] == SINGLE)){\r\n\t\t\tthis._clearSelection(\"col\", start);\r\n\t\t\tthis._clearSelection(\"cell\", start);\r\n\t\t\tif(!this.noClear || (type === 'row' && this._config[type] == SINGLE)){\r\n\t\t\t\tthis._clearSelection('row', start);\r\n\t\t\t}\r\n\t\t\tthis._toSelect = toSelect === undefined ? true : toSelect;\r\n\t\t}\r\n\t\t\r\n\t\tthis._selecting[type] = true;\r\n\t\tthis._currentPoint[type] = null;\r\n\t\t\r\n\t\t//We're holding SHIFT while clicking, it's a Click-Range selection.\r\n\t\tif(isRange && this._lastType == type && lastIsSelected == this._toSelect && this._config[type] == MULTI){\r\n\t\t\tif(type === \"row\"){\r\n\t\t\t\tthis._isUsingRowSelector = true;\r\n\t\t\t}\r\n\t\t\tthis._startPoint[type] = this._lastAnchorPoint[type];\r\n\t\t\tthis._highlight(type, this._startPoint[type]);\r\n\t\t\tthis._isUsingRowSelector = false;\r\n\t\t}else{\r\n\t\t\tthis._startPoint[type] = start;\r\n\t\t}\r\n\t\t//Now start selection\r\n\t\tthis._curType = type;\r\n\t\tthis._fireEvent(\"start\", type);\r\n\t\tthis._isStartFocus = true;\r\n\t\tthis._isUsingRowSelector = true;\r\n\t\tthis._highlight(type, start, this._toSelect);\r\n\t\tthis._isStartFocus = false;\r\n\t},\r\n\t_endSelect: function(type){\r\n\t\t// summary:\r\n\t\t//\t\tEnd selection. Keep records, fire events and cleanup status.\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\t// type: String\r\n\t\t//\t\t\"row\", \"col\", or \"cell\"\r\n\t\tif(type === \"row\"){\r\n\t\t\tdelete this._isUsingRowSelector;\r\n\t\t}\r\n\t\tif(type == \"all\"){\r\n\t\t\tthis._endSelect(\"col\");\r\n\t\t\tthis._endSelect(\"row\");\r\n\t\t\tthis._endSelect(\"cell\");\r\n\t\t}else if(this._selecting[type]){\r\n\t\t\tthis._addToSelected(type);\r\n\t\t\tthis._lastAnchorPoint[type] = this._startPoint[type];\r\n\t\t\tthis._lastEndPoint[type] = this._currentPoint[type];\r\n\t\t\tif(this._toSelect){\r\n\t\t\t\tthis._lastSelectedAnchorPoint[type] = this._lastAnchorPoint[type];\r\n\t\t\t\tthis._lastSelectedEndPoint[type] = this._lastEndPoint[type];\r\n\t\t\t}\r\n\t\t\tthis._startPoint[type] = this._currentPoint[type] = null;\r\n\t\t\tthis._selecting[type] = false;\r\n\t\t\tthis._lastType = type;\r\n\t\t\tthis._fireEvent(\"end\", type);\r\n\t\t}\r\n\t},\r\n\t_fireEvent: function(evtName, type){\r\n\t\tswitch(evtName){\r\n\t\t\tcase \"start\":\r\n\t\t\t\tthis.grid[this._toSelect ? \"onStartSelect\" : \"onStartDeselect\"](type, this._startPoint[type], this._selected);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"end\":\r\n\t\t\t\tthis.grid[this._toSelect ? \"onEndSelect\" : \"onEndDeselect\"](type, this._lastAnchorPoint[type], this._lastEndPoint[type], this._selected);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\t_calcToHighlight: function(type, target, toHighlight, toSelect){\r\n\t\t// summary:\r\n\t\t//\t\tCalculate what status should *target* have.\r\n\t\t//\t\tIf *toSelect* is not provided, this is a no op.\r\n\t\t\r\n\t\t// This function is time-critical!!\r\n\t\tif(toSelect !== undefined){\r\n\t\t\tvar sltd;\r\n\t\t\tif(this._usingKeyboard && !toHighlight){\r\n\t\t\t\tvar last = this._isInLastRange(this._lastType, target);\r\n\t\t\t\tif(last){\r\n\t\t\t\t\tsltd = this._isSelected(type, target);\r\n\t\t\t\t\t//This 2 cases makes the keyboard swipe selection valid!\r\n\t\t\t\t\tif(toSelect && sltd){\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!toSelect && !sltd && this._isInLastRange(this._lastType, target, true)){\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn toHighlight ? toSelect : (sltd || this._isSelected(type, target));\r\n\t\t}\r\n\t\treturn toHighlight;\r\n\t},\r\n\t_highlightNode: function(node, toHighlight){\r\n\t\t// summary:\r\n\t\t//\t\tDo the actual highlight work.\r\n\t\tif(node){\r\n\t\t\tvar selectCSSClass = \"dojoxGridRowSelected\";\r\n\t\t\tvar selectCellClass = \"dojoxGridCellSelected\";\r\n\t\t\thtml.toggleClass(node, selectCSSClass, toHighlight);\r\n\t\t\thtml.toggleClass(node, selectCellClass, toHighlight);\r\n\t\t}\r\n\t},\r\n\t_highlightHeader: function(colIdx, toHighlight){\r\n\t\tvar cells = this.grid.layout.cells;\r\n\t\tvar node = cells[colIdx].getHeaderNode();\r\n\t\tvar selectedClass = \"dojoxGridHeaderSelected\";\r\n\t\thtml.toggleClass(node, selectedClass, toHighlight);\r\n\t},\r\n\t_highlightRowSelector: function(rowIdx, toHighlight){\r\n\t\t//var t1 = (new Date()).getTime();\r\n\t\tvar rowSelector = this.grid.views.views[0];\r\n\t\tif(rowSelector instanceof _RowSelector){\r\n\t\t\tvar node = rowSelector.getRowNode(rowIdx);\r\n\t\t\tif(node){\r\n\t\t\t\tvar selectedClass = \"dojoxGridRowSelectorSelected\";\r\n\t\t\t\thtml.toggleClass(node, selectedClass, toHighlight);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//console.log((new Date()).getTime() - t1);\r\n\t},\r\n\t_highlightSingle: function(type, toHighlight, target, toSelect, isRefresh){\r\n\t\t// summary:\r\n\t\t//\t\tHighlight a single item.\r\n\t\t\r\n\t\t// This function is time critical!!\r\n\t\tvar _this = this, toHL, g = _this.grid, cells = g.layout.cells;\r\n\t\tswitch(type){\r\n\t\t\tcase \"cell\":\r\n\t\t\t\ttoHL = this._calcToHighlight(type, target, toHighlight, toSelect);\r\n\t\t\t\tvar c = cells[target.col];\r\n\t\t\t\tif(!c.hidden && !c.notselectable){\r\n\t\t\t\t\tthis._highlightNode(target.node || c.getNode(target.row), toHL);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"col\":\r\n\t\t\t\ttoHL = this._calcToHighlight(type, target, toHighlight, toSelect);\r\n\t\t\t\tthis._highlightHeader(target.col, toHL);\r\n\t\t\t\tquery(\"td[idx='\" + target.col + \"']\", g.domNode).forEach(function(cellNode){\r\n\t\t\t\t\tvar rowNode = cells[target.col].view.content.findRowTarget(cellNode);\r\n\t\t\t\t\tif(rowNode){\r\n\t\t\t\t\t\tvar rowIndex = rowNode[dojox.grid.util.rowIndexTag];\r\n\t\t\t\t\t\t_this._highlightSingle(\"cell\", toHL, {\r\n\t\t\t\t\t\t\t\"row\": rowIndex,\r\n\t\t\t\t\t\t\t\"col\": target.col,\r\n\t\t\t\t\t\t\t\"node\": cellNode\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"row\":\r\n\t\t\t\ttoHL = this._calcToHighlight(type, target, toHighlight, toSelect);\r\n\t\t\t\tthis._highlightRowSelector(target.row, toHL);\r\n\t\t\t\tif(this._config.cell){\r\n\t\t\t\t\tarray.forEach(cells, function(cell){\r\n\t\t\t\t\t\t_this._highlightSingle(\"cell\", toHL, {\r\n\t\t\t\t\t\t\t\"row\": target.row,\r\n\t\t\t\t\t\t\t\"col\": cell.index,\r\n\t\t\t\t\t\t\t\"node\": cell.getNode(target.row)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t//To avoid dead lock\r\n\t\t\t\tthis._selectedRowModified = true;\r\n\t\t\t\tif(!isRefresh){\r\n\t\t\t\t\tg.selection.setSelected(target.row, toHL);\r\n\t\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_highlight: function(type, target, toSelect){\r\n\t\t// summary:\r\n\t\t//\t\tHighlight from start point to target.\r\n\t\t// toSelect: Boolean\r\n\t\t//\t\tWhether we are selecting or deselecting.\r\n\t\t\r\n\t\t// This function is time critical!!\r\n\t\tif(this._selecting[type] && target !== null){\r\n\t\t\tvar start = this._startPoint[type],\r\n\t\t\t\tcurrent = this._currentPoint[type],\r\n\t\t\t\t_this = this,\r\n\t\t\t\thighlight = function(from, to, toHL){\r\n\t\t\t\t\t_this._forEach(type, from, to, function(item){\r\n\t\t\t\t\t\t_this._highlightSingle(type, toHL, item, toSelect);\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t};\r\n\t\t\tswitch(type){\r\n\t\t\t\tcase \"col\": case \"row\":\r\n\t\t\t\t\tif(current !== null){\r\n\t\t\t\t\t\tif(_inRange(type, target, start, current, true)){\r\n\t\t\t\t\t\t\t//target is between start and current, some selected should be deselected.\r\n\t\t\t\t\t\t\thighlight(current, target, false);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tif(_inRange(type, start, target, current, true)){\r\n\t\t\t\t\t\t\t\t//selection has jumped to different direction, all should be deselected.\r\n\t\t\t\t\t\t\t\thighlight(current, start, false);\r\n\t\t\t\t\t\t\t\tcurrent = start;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\thighlight(target, current, true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t//First time select.\r\n\t\t\t\t\t\tthis._highlightSingle(type, true, target, toSelect);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"cell\":\r\n\t\t\t\t\tif(current !== null){\r\n\t\t\t\t\t\tif(_inRange(\"row\", target, start, current, true) ||\r\n\t\t\t\t\t\t\t_inRange(\"col\", target, start, current, true) ||\r\n\t\t\t\t\t\t\t_inRange(\"row\", start, target, current, true) ||\r\n\t\t\t\t\t\t\t_inRange(\"col\", start, target, current, true)){\r\n\t\t\t\t\t\t\thighlight(start, current, false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\thighlight(start, target, true);\r\n\t\t\t}\r\n\t\t\tthis._currentPoint[type] = target;\r\n\t\t\tthis._focusPoint(type, this._currentPoint);\r\n\t\t}\r\n\t},\r\n\t_focusPoint: function(type, point){\r\n\t\t// summary:\r\n\t\t//\t\tFocus the current point, so when you move mouse, the focus indicator follows you.\r\n\t\tif(!this._isStartFocus){\r\n\t\t\tvar current = point[type],\r\n\t\t\t\tf = this.grid.focus;\r\n\t\t\tif(type == \"col\"){\r\n\t\t\t\tf._colHeadFocusIdx = current.col;\r\n\t\t\t\tf.focusArea(\"header\");\r\n\t\t\t}else if(type == \"row\"){\r\n\t\t\t\tf.focusArea(\"rowHeader\", {\r\n\t\t\t\t\t\"rowIndex\": current.row\r\n\t\t\t\t});\r\n\t\t\t}else if(type == \"cell\"){\r\n\t\t\t\tf.setFocusIndex(current.row, current.col);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_blurPoint: function(type, point){\r\n\t\t// summary:\r\n\t\t//\t\tBlur the current point.\r\n\t\tvar f = this.grid.focus;\r\n\t\tif(type == \"cell\"){\r\n\t\t\tf._blurContent();\r\n\t\t}\r\n\t},\r\n\t_addToSelected: function(type){\r\n\t\t// summary:\r\n\t\t//\t\tRecord the selected items.\r\n\t\tvar toSelect = this._toSelect, _this = this,\r\n\t\t\ttoAdd = [], toRemove = [],\r\n\t\t\tstart = this._startPoint[type],\r\n\t\t\tend = this._currentPoint[type];\r\n\t\tif(this._usingKeyboard){\r\n\t\t\t//If using keyboard, selection will be ended after every move. But we have to remember the original selection status,\r\n\t\t\t//so as to return to correct status when we shrink the selection region.\r\n\t\t\tthis._forEach(type, this._lastAnchorPoint[type], this._lastEndPoint[type], function(item){\r\n\t\t\t\t//If the original selected item is not in current range, change its status.\r\n\t\t\t\tif(!_inRange(type, item, start, end)){\r\n\t\t\t\t\t(toSelect ? toRemove : toAdd).push(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis._forEach(type, start, end, function(item){\r\n\t\t\tvar isSelected = _this._isSelected(type, item);\r\n\t\t\tif(toSelect && !isSelected){\r\n\t\t\t\t//Add new selected items\r\n\t\t\t\ttoAdd.push(item);\r\n\t\t\t}else if(!toSelect){\r\n\t\t\t\t//Remove deselected items.\r\n\t\t\t\ttoRemove.push(item);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._add(type, toAdd);\r\n\t\tthis._remove(type, toRemove);\r\n\t\t\r\n\t\t// have to keep record in original grid selection\r\n\t\tarray.forEach(this._selected.row, function(item){\r\n\t\t\tif(item.except.length > 0){\r\n\t\t\t\t//to avoid dead lock\r\n\t\t\t\tthis._selectedRowModified = true;\r\n\t\t\t\tthis.grid.selection.setSelected(item.row, false);\r\n\t\t\t}\r\n\t\t}, this);\r\n\t},\r\n\t_forEach: function(type, start, end, func, halfClose){\r\n\t\t// summary:\r\n\t\t//\t\tGo through items from *start* point to *end* point.\r\n\t\t\r\n\t\t// This function is time critical!!\r\n\t\tif(!this._isValid(type, start, true) || !this._isValid(type, end, true)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tswitch(type){\r\n\t\t\tcase \"col\": case \"row\":\r\n\t\t\t\tstart = start[type];\r\n\t\t\t\tend = end[type];\r\n\t\t\t\tvar dir = end > start ? 1 : -1;\r\n\t\t\t\tif(!halfClose){\r\n\t\t\t\t\tend += dir;\r\n\t\t\t\t}\r\n\t\t\t\tfor(; start != end; start += dir){\r\n\t\t\t\t\tfunc(_createItem(type, start));\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"cell\":\r\n\t\t\t\tvar colDir = end.col > start.col ? 1 : -1,\r\n\t\t\t\t\trowDir = end.row > start.row ? 1 : -1;\r\n\t\t\t\tfor(var i = start.row, p = end.row + rowDir; i != p; i += rowDir){\r\n\t\t\t\t\tfor(var j = start.col, q = end.col + colDir; j != q; j += colDir){\r\n\t\t\t\t\t\tfunc(_createItem(type, i, j));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_makeupForExceptions: function(type, newCellItems){\r\n\t\t// summary:\r\n\t\t//\t\tWhen new cells is selected, maybe they will fill in the \"holes\" in selected rows and columns.\r\n\t\tvar makedUps = [];\r\n\t\tarray.forEach(this._selected[type], function(v1){\r\n\t\t\tarray.forEach(newCellItems, function(v2){\r\n\t\t\t\tif(v1[type] == v2[type]){\r\n\t\t\t\t\tvar pos = array.indexOf(v1.except, v2[_theOther[type]]);\r\n\t\t\t\t\tif(pos >= 0){\r\n\t\t\t\t\t\tv1.except.splice(pos, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmakedUps.push(v2);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn makedUps;\r\n\t},\r\n\t_makeupForCells: function(type, newItems){\r\n\t\t// summary:\r\n\t\t//\t\tWhen some rows/cols are selected, maybe they can cover some of the selected cells,\r\n\t\t//\t\tand fill some of the \"holes\" in the selected cols/rows.\r\n\t\tvar toRemove = [];\r\n\t\tarray.forEach(this._selected.cell, function(v1){\r\n\t\t\tarray.some(newItems, function(v2){\r\n\t\t\t\tif(v1[type] == v2[type]){\r\n\t\t\t\t\ttoRemove.push(v1);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t});\r\n\t\tthis._remove(\"cell\", toRemove);\r\n\t\tarray.forEach(this._selected[_theOther[type]], function(v1){\r\n\t\t\tarray.forEach(newItems, function(v2){\r\n\t\t\t\tvar pos = array.indexOf(v1.except, v2[type]);\r\n\t\t\t\tif(pos >= 0){\r\n\t\t\t\t\tv1.except.splice(pos, 1);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\t_addException: function(type, items){\r\n\t\t// summary:\r\n\t\t//\t\tIf some rows/cols are deselected, maybe they have created \"holes\" in selected cols/rows.\r\n\t\tarray.forEach(this._selected[type], function(v1){\r\n\t\t\tarray.forEach(items, function(v2){\r\n\t\t\t\tv1.except.push(v2[_theOther[type]]);\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\t_addCellException: function(type, items){\r\n\t\t// summary:\r\n\t\t//\t\tIf some cells are deselected, maybe they have created \"holes\" in selected rows/cols.\r\n\t\tarray.forEach(this._selected[type], function(v1){\r\n\t\t\tarray.forEach(items, function(v2){\r\n\t\t\t\tif(v1[type] == v2[type]){\r\n\t\t\t\t\tv1.except.push(v2[_theOther[type]]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\t_add: function(type, items){\r\n\t\t// summary:\r\n\t\t//\t\tAdd to the selection record.\r\n\t\tvar cells = this.grid.layout.cells;\r\n\t\tif(type == \"cell\"){\r\n\t\t\tvar colMakedup = this._makeupForExceptions(\"col\", items);\r\n\t\t\tvar rowMakedup = this._makeupForExceptions(\"row\", items);\r\n\t\t\t//Step over hidden columns.\r\n\t\t\titems = array.filter(items, function(item){\r\n\t\t\t\treturn array.indexOf(colMakedup, item) < 0 && array.indexOf(rowMakedup, item) < 0 &&\r\n\t\t\t\t\t!cells[item.col].hidden && !cells[item.col].notselectable;\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tif(type == \"col\"){\r\n\t\t\t\t//Step over hidden columns.\r\n\t\t\t\titems = array.filter(items, function(item){\r\n\t\t\t\t\treturn !cells[item.col].hidden && !cells[item.col].notselectable;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis._makeupForCells(type, items);\r\n\t\t\tthis._selected[type] = array.filter(this._selected[type], function(v){\r\n\t\t\t\treturn array.every(items, function(item){\r\n\t\t\t\t\treturn v[type] !== item[type];\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tif(type != \"col\" && this.grid._hasIdentity){\r\n\t\t\tarray.forEach(items, function(item){\r\n\t\t\t\tvar record = this.grid._by_idx[item.row];\r\n\t\t\t\tif(record){\r\n\t\t\t\t\titem.id = record.idty;\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t\tthis._selected[type] = this._selected[type].concat(items);\r\n\t},\r\n\t_remove: function(type, items){\r\n\t\t// summary:\r\n\t\t//\t\tRemove from the selection record.\r\n\t\tvar comp = lang.partial(_isEqual, type);\r\n\t\tthis._selected[type] = array.filter(this._selected[type], function(v1){\r\n\t\t\treturn !array.some(items, function(v2){\r\n\t\t\t\treturn comp(v1, v2);\r\n\t\t\t});\r\n\t\t});\r\n\t\tif(type == \"cell\"){\r\n\t\t\tthis._addCellException(\"col\", items);\r\n\t\t\tthis._addCellException(\"row\", items);\r\n\t\t}else if(this._config.cell){\r\n\t\t\tthis._addException(_theOther[type], items);\r\n\t\t}\r\n\t},\r\n\t_isCellNotInExcept: function(type, item){\r\n\t\t// summary:\r\n\t\t//\t\tReturn true only when a cell is covered by selected row/col, and its not a \"hole\".\r\n\t\tvar attr = item[type], corres = item[_theOther[type]];\r\n\t\treturn array.some(this._selected[type], function(v){\r\n\t\t\treturn v[type] == attr && array.indexOf(v.except, corres) < 0;\r\n\t\t});\r\n\t},\r\n\t_isSelected: function(type, item){\r\n\t\t// summary:\r\n\t\t//\t\tReturn true when the item is selected. (or logically selected, i.e, covered by a row/col).\r\n\t\tif(!item){ return false; }\r\n\t\tvar res = array.some(this._selected[type], function(v){\r\n\t\t\tvar ret = _isEqual(type, item, v);\r\n\t\t\tif(ret && type !== \"cell\"){\r\n\t\t\t\treturn v.except.length === 0;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t});\r\n\t\tif(!res && type === \"cell\"){\r\n\t\t\tres = (this._isCellNotInExcept(\"col\", item) || this._isCellNotInExcept(\"row\", item));\r\n\t\t\tif(type === \"cell\"){\r\n\t\t\t\tres = res && !this.grid.layout.cells[item.col].notselectable;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\t_isInLastRange: function(type, item, isSelected){\r\n\t\t// summary:\r\n\t\t//\t\tReturn true only when the item is in the last seletion/deseletion range.\r\n\t\tvar start = this[isSelected ? \"_lastSelectedAnchorPoint\" : \"_lastAnchorPoint\"][type],\r\n\t\t\tend = this[isSelected ? \"_lastSelectedEndPoint\" : \"_lastEndPoint\"][type];\r\n\t\tif(!item || !start || !end){ return false; }\r\n\t\treturn _inRange(type, item, start, end);\r\n\t},\r\n\t_isValid: function(type, item, allowNotSelectable){\r\n\t\t// summary:\r\n\t\t//\t\tCheck whether the item is a valid __SelectItem for the given type.\r\n\t\tif(!item){ return false; }\r\n\t\ttry{\r\n\t\t\tvar g = this.grid, index = item[type];\r\n\t\t\tswitch(type){\r\n\t\t\t\tcase \"col\":\r\n\t\t\t\t\treturn index >= 0 && index < g.layout.cells.length && lang.isArray(item.except) &&\r\n\t\t\t\t\t\t\t(allowNotSelectable || !g.layout.cells[index].notselectable);\r\n\t\t\t\tcase \"row\":\r\n\t\t\t\t\treturn index >= 0 && index < g.rowCount && lang.isArray(item.except);\r\n\t\t\t\tcase \"cell\":\r\n\t\t\t\t\treturn item.col >= 0 && item.col < g.layout.cells.length &&\r\n\t\t\t\t\t\t\titem.row >= 0 && item.row < g.rowCount &&\r\n\t\t\t\t\t\t\t(allowNotSelectable || !g.layout.cells[item.col].notselectable);\r\n\t\t\t}\r\n\t\t}catch(e){}\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\nEnhancedGrid.registerPlugin(Selector/*name:'selector'*/, {\r\n\t\"dependency\": [\"autoScroll\"]\r\n});\r\n\r\nreturn Selector;\r\n\r\n});"]}