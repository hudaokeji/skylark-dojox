{"version":3,"sources":["grid/enhanced/plugins/Search.js"],"names":["define","dojo","lang","declare","array","dFilter","EnhancedGrid","_Plugin","Search","name","constructor","grid","args","this","isObject","_cacheSize","cacheSize","searchRow","hitch","searchArgs","onSearched","isFunction","isString","patternToRegExp","isGlobal","RegExp","isEmpty","field","_search","start","_this","cnt","query","sort","getSortProps","queryOptions","onBegin","size","_storeSize","onComplete","items","some","item","i","_checkRow","count","_storeLayerFetch","g","s","store","cells","filter","layout","cell","hidden","String","getValue","search","e","console","log","length","registerPlugin"],"mappings":";;;;;;;AAAAA,QACC,oBACA,kBACA,qBACA,mBACA,wBACA,qBACA,cACE,SAASC,EAAMC,EAAMC,EAASC,EAAOC,EAASC,EAAcC,GAE/D,IAAIC,EAASL,EAAQ,qCAAsCI,GAM1DE,KAAM,SAENC,YAAa,SAASC,EAAMC,GAC3BC,KAAKF,KAAOA,EACZC,EAAQA,GAAQV,EAAKY,SAASF,GAASA,KACvCC,KAAKE,WAAaH,EAAKI,YAAc,EACrCL,EAAKM,UAAYf,EAAKgB,MAAML,KAAM,cAEnCI,UAAW,SAAmCE,EAAyCC,GACtF,GAAIlB,EAAKmB,WAAWD,GAApB,CACGlB,EAAKoB,SAASH,KAChBA,EAAad,EAAQkB,gBAAgBJ,IAEtC,IAAIK,GAAW,EACf,GAAGL,aAAsBM,OACxBD,GAAW,MACN,CAAA,IAAGtB,EAAKY,SAASK,GAUtB,OATA,IAAIO,GAAU,EACd,IAAI,IAAIC,KAASR,EACbjB,EAAKoB,SAASH,EAAWQ,MAC3BR,EAAWQ,GAAStB,EAAQkB,gBAAgBJ,EAAWQ,KAExDD,GAAU,EAEX,GAAGA,EAAU,OAIdb,KAAKe,QAAQT,EAAY,EAAGC,EAAYI,KAEzCI,QAAS,SAA4BT,EAAyBU,EAAoCT,EAAyBI,GAC1H,IAAIM,EAAQjB,KACXkB,EAAMlB,KAAKE,WACXH,GACCiB,MAAOA,EACPG,MAAOnB,KAAKF,KAAKqB,MACjBC,KAAMpB,KAAKF,KAAKuB,eAChBC,aAActB,KAAKF,KAAKwB,aACxBC,QAAS,SAASC,GACjBP,EAAMQ,WAAaD,GAEpBE,WAAY,SAASC,GAChBpC,EAAMqC,KAAKD,EAAO,SAASE,EAAMC,GACpC,QAAGb,EAAMc,UAAUF,EAAMvB,EAAYK,KACpCJ,EAAWS,EAAQc,EAAGD,IACf,OAILX,EAAM,GAAKF,EAAQE,EAAMD,EAAMQ,WACjCR,EAAMF,QAAQT,EAAYU,EAAQE,EAAKX,EAAYI,GAEnDJ,GAAY,EAAG,SAKjBW,EAAM,IACRnB,EAAKiC,MAAQd,GAEdlB,KAAKF,KAAKmC,iBAAiBlC,IAE5BgC,UAAW,SAAyBF,EAAyBvB,EAAyBK,GACrF,IAAgCmB,EAAGhB,EAA/BoB,EAAIlC,KAAKF,KAAMqC,EAAID,EAAEE,MACxBC,EAAQ9C,EAAM+C,OAAOJ,EAAEK,OAAOF,MAAO,SAASG,GAC7C,OAAQA,EAAKC,SAEf,GAAG9B,EACF,OAAOpB,EAAMqC,KAAKS,EAAO,SAASG,GACjC,IACC,GAAGA,EAAK1B,MACP,OAAO4B,OAAOP,EAAEQ,SAASd,EAAMW,EAAK1B,QAAQ8B,OAAOtC,IAAe,EAEnE,MAAMuC,GACNC,QAAQC,IAAI,6BAA8BF,GAE3C,OAAO,IAGR,IAAI/B,KAASR,EACZ,GAAGA,EAAWQ,aAAkBF,OAAO,CACtC,IAAIkB,EAAIO,EAAMW,OAAS,EAAGlB,GAAK,IAAKA,EACnC,GAAGO,EAAMP,GAAGhB,OAASA,EACpB,IACC,GAAG4B,OAAOP,EAAEQ,SAASd,EAAMf,IAAQ8B,OAAOtC,EAAWQ,IAAU,EAC9D,OAAO,EAER,MACA,MAAM+B,GACN,OAAO,EAIV,GAAGf,EAAI,EAAI,OAAO,EAGpB,OAAO,KAOV,OAFArC,EAAawD,eAAetD,GAErBA","file":"../../../../grid/enhanced/plugins/Search.js","sourcesContent":["define([\r\n\t\"dojo/_base/kernel\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/data/util/filter\",\r\n\t\"../../EnhancedGrid\",\r\n\t\"../_Plugin\"\r\n], function(dojo, lang, declare, array, dFilter, EnhancedGrid, _Plugin){\r\n\r\nvar Search = declare(\"dojox.grid.enhanced.plugins.Search\", _Plugin, {\r\n\t// summary:\r\n\t//\t\tSearch the grid using wildcard string or Regular Expression.\r\n\t\r\n\t// name: String\r\n\t//\t\tplugin name\r\n\tname: \"search\",\r\n\t\r\n\tconstructor: function(grid, args){\r\n\t\tthis.grid = grid;\r\n\t\targs = (args && lang.isObject(args)) ? args : {};\r\n\t\tthis._cacheSize = args.cacheSize || -1;\r\n\t\tgrid.searchRow = lang.hitch(this, \"searchRow\");\r\n\t},\r\n\tsearchRow: function(/* Object|RegExp|String */searchArgs, /* function(Integer, item) */onSearched){\r\n\t\tif(!lang.isFunction(onSearched)){ return; }\r\n\t\tif(lang.isString(searchArgs)){\r\n\t\t\tsearchArgs = dFilter.patternToRegExp(searchArgs);\r\n\t\t}\r\n\t\tvar isGlobal = false;\r\n\t\tif(searchArgs instanceof RegExp){\r\n\t\t\tisGlobal = true;\r\n\t\t}else if(lang.isObject(searchArgs)){\r\n\t\t\tvar isEmpty = true;\r\n\t\t\tfor(var field in searchArgs){\r\n\t\t\t\tif(lang.isString(searchArgs[field])){\r\n\t\t\t\t\tsearchArgs[field] = dFilter.patternToRegExp(searchArgs[field]);\r\n\t\t\t\t}\r\n\t\t\t\tisEmpty = false;\r\n\t\t\t}\r\n\t\t\tif(isEmpty){ return; }\r\n\t\t}else{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._search(searchArgs, 0, onSearched, isGlobal);\r\n\t},\r\n\t_search: function(/* Object|RegExp */searchArgs, /* Integer */start, /* function(Integer, item) */onSearched, /* Boolean */isGlobal){\r\n\t\tvar _this = this,\r\n\t\t\tcnt = this._cacheSize,\r\n\t\t\targs = {\r\n\t\t\t\tstart: start,\r\n\t\t\t\tquery: this.grid.query,\r\n\t\t\t\tsort: this.grid.getSortProps(),\r\n\t\t\t\tqueryOptions: this.grid.queryOptions,\r\n\t\t\t\tonBegin: function(size){\r\n\t\t\t\t\t_this._storeSize = size;\r\n\t\t\t\t},\r\n\t\t\t\tonComplete: function(items){\r\n\t\t\t\t\tif(!array.some(items, function(item, i){\r\n\t\t\t\t\t\tif(_this._checkRow(item, searchArgs, isGlobal)){\r\n\t\t\t\t\t\t\tonSearched(start + i, item);\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t})){\r\n\t\t\t\t\t\tif(cnt > 0 && start + cnt < _this._storeSize){\r\n\t\t\t\t\t\t\t_this._search(searchArgs, start + cnt, onSearched, isGlobal);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tonSearched(-1, null);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\tif(cnt > 0){\r\n\t\t\targs.count = cnt;\r\n\t\t}\r\n\t\tthis.grid._storeLayerFetch(args);\r\n\t},\r\n\t_checkRow: function(/* store item */item, /* Object|RegExp */searchArgs, /* Boolean */isGlobal){\r\n\t\tvar g = this.grid, s = g.store, i, field,\r\n\t\t\tcells = array.filter(g.layout.cells, function(cell){\r\n\t\t\t\treturn !cell.hidden;\r\n\t\t\t});\r\n\t\tif(isGlobal){\r\n\t\t\treturn array.some(cells, function(cell){\r\n\t\t\t\ttry{\r\n\t\t\t\t\tif(cell.field){\r\n\t\t\t\t\t\treturn String(s.getValue(item, cell.field)).search(searchArgs) >= 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\tconsole.log(\"Search._checkRow() error: \", e);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tfor(field in searchArgs){\r\n\t\t\t\tif(searchArgs[field] instanceof RegExp){\r\n\t\t\t\t\tfor(i = cells.length - 1; i >= 0; --i){\r\n\t\t\t\t\t\tif(cells[i].field == field){\r\n\t\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\t\tif(String(s.getValue(item, field)).search(searchArgs[field]) < 0){\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}catch(e){\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(i < 0){ return false; }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n});\r\n\r\nEnhancedGrid.registerPlugin(Search/*name:'search'*/);\r\n\r\nreturn Search;\r\n\r\n});"]}