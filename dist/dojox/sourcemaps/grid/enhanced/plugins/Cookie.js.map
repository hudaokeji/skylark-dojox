{"version":3,"sources":["grid/enhanced/plugins/Cookie.js"],"names":["define","declare","array","lang","has","html","json","win","unload","cookie","_Plugin","_RowSelector","EnhancedGrid","gridCells","getObject","_cookieKeyBuilder","grid","window","location","id","_getCellsFromStructure","structure","cells","isArray","forEach","viewDef","rows","row","cell","push","_loadColWidth","colWidths","oldFunc","_setStructureAttr","_colWidthLoaded","i","length","width","hidden","call","_saveColWidth","map","filter","layout","isRowSelector","RowIndex","getHeaderNode","w","_loadColumnOrder","colOrder","every","viewInfo","subrowInfo","isView","def","isObject","isCell","_colOrderLoaded","clone","some","viewIdx","cellArray","splice","subrow","cellInfo","toJson","name","field","_saveColumnOrder","views","view","_loadSortOrder","sortOrder","setSortIndex","idx","asc","e","_saveSortOrder","getSortIndex","getSortAsc","addOnWindowUnload","dijit","findWidgets","body","widget","_destroyed","destroyRecursive","Cookie","_cookieEnabled","constructor","args","this","cookieProps","_cookieHandlers","_mixinGrid","addCookieHandler","onLoad","onSave","handler","enable","destroy","_saveCookie","inherited","arguments","g","hitch","removeCookie","setCookieEnabled","getCookieEnabled","ck","chs","cookieKey","enabled","onPreInit","fromJson","_cookie","_cookieStartedup","dummy","key","expires","cookieName","isString","registerPlugin","preInit"],"mappings":"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","file":"../../../../grid/enhanced/plugins/Cookie.js","sourcesContent":["define([\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/sniff\",\r\n\t\"dojo/_base/html\",\r\n\t\"dojo/_base/json\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/_base/unload\",\r\n\t\"dojo/cookie\",\r\n\t\"../_Plugin\",\r\n\t\"../../_RowSelector\",\r\n\t\"../../EnhancedGrid\",\r\n\t\"../../cells/_base\"\r\n], function(declare, array, lang, has, html, json, win, unload, cookie, _Plugin, _RowSelector, EnhancedGrid){\r\n\r\n\tvar gridCells = lang.getObject(\"dojox.grid.cells\");\r\n\r\n\t// Generate a cookie key for the given grid.\r\n\tvar _cookieKeyBuilder = function(grid){\r\n\t\treturn window.location + \"/\" + grid.id;\r\n\t};\r\n\t\r\n\t//Utilities:\r\n\tvar _getCellsFromStructure = function(structure){\r\n\t\tvar cells = [];\r\n\t\tif(!lang.isArray(structure)){\r\n\t\t\tstructure = [structure];\r\n\t\t}\r\n\t\tarray.forEach(structure,function(viewDef){\r\n\t\t\tif(lang.isArray(viewDef)){\r\n\t\t\t\tviewDef = {\"cells\" : viewDef};\r\n\t\t\t}\r\n\t\t\tvar rows = viewDef.rows || viewDef.cells;\r\n\t\t\tif(lang.isArray(rows)){\r\n\t\t\t\tif(!lang.isArray(rows[0])){\r\n\t\t\t\t\trows = [rows];\r\n\t\t\t\t}\r\n\t\t\t\tarray.forEach(rows, function(row){\r\n\t\t\t\t\tif(lang.isArray(row)){\r\n\t\t\t\t\t\tarray.forEach(row, function(cell){\r\n\t\t\t\t\t\t\tcells.push(cell);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn cells;\r\n\t};\r\n\t\r\n\t// Persist column width\r\n\tvar _loadColWidth = function(colWidths, grid){\r\n\t\tif(lang.isArray(colWidths)){\r\n\t\t\tvar oldFunc = grid._setStructureAttr;\r\n\t\t\tgrid._setStructureAttr = function(structure){\r\n\t\t\t\tif(!grid._colWidthLoaded){\r\n\t\t\t\t\tgrid._colWidthLoaded = true;\r\n\t\t\t\t\tvar cells = _getCellsFromStructure(structure);\r\n\t\t\t\t\tfor(var i = cells.length - 1; i >= 0; --i){\r\n\t\t\t\t\t\tif(typeof colWidths[i] == \"number\"){\r\n\t\t\t\t\t\t\tcells[i].width = colWidths[i] + \"px\";\r\n\t\t\t\t\t\t}else if(colWidths[i] == 'hidden'){\r\n\t\t\t\t\t\t\tcells[i].hidden = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\toldFunc.call(grid, structure);\r\n\t\t\t\tgrid._setStructureAttr = oldFunc;\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n\t\r\n\r\n\tvar _saveColWidth = function(grid){\r\n\t\treturn array.map(array.filter(grid.layout.cells, function(cell){\r\n\t\t\treturn !(cell.isRowSelector || cell instanceof gridCells.RowIndex);\r\n\t\t}), function(cell){\r\n\t\t\treturn cell.hidden ? 'hidden' : html[has('webkit') ? \"marginBox\" : \"contentBox\"](cell.getHeaderNode()).w;\r\n\t\t});\r\n\t};\r\n\t\r\n\t// Persist column order\r\n\tvar _loadColumnOrder = function(colOrder, grid){\r\n\t\tif(colOrder && array.every(colOrder, function(viewInfo){\r\n\t\t\treturn lang.isArray(viewInfo) && array.every(viewInfo, function(subrowInfo){\r\n\t\t\t\treturn lang.isArray(subrowInfo) && subrowInfo.length > 0;\r\n\t\t\t});\r\n\t\t})){\r\n\t\t\tvar oldFunc = grid._setStructureAttr;\r\n\t\t\tvar isCell = function(def){\r\n\t\t\t\treturn (\"name\" in def || \"field\" in def || \"get\" in def);\r\n\t\t\t};\r\n\t\t\tvar isView = function(def){\r\n\t\t\t\treturn (def !== null && lang.isObject(def) &&\r\n\t\t\t\t\t\t(\"cells\" in def || \"rows\" in def || (\"type\" in def && !isCell(def))));\r\n\t\t\t};\r\n\t\t\tgrid._setStructureAttr = function(structure){\r\n\t\t\t\tif(!grid._colOrderLoaded){\r\n\t\t\t\t\tgrid._colOrderLoaded = true;\r\n\t\t\t\t\tgrid._setStructureAttr = oldFunc;\r\n\t\t\t\t\tstructure = lang.clone(structure);\r\n\t\t\t\t\tif(lang.isArray(structure) && !array.some(structure, isView)){\r\n\t\t\t\t\t\tstructure = [{ cells: structure }];\r\n\t\t\t\t\t}else if(isView(structure)){\r\n\t\t\t\t\t\tstructure = [structure];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar cells = _getCellsFromStructure(structure);\r\n\t\t\t\t\tarray.forEach(lang.isArray(structure) ? structure : [structure], function(viewDef, viewIdx){\r\n\t\t\t\t\t\tvar cellArray = viewDef;\r\n\t\t\t\t\t\tif(lang.isArray(viewDef)){\r\n\t\t\t\t\t\t\tviewDef.splice(0, viewDef.length);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tdelete viewDef.rows;\r\n\t\t\t\t\t\t\tcellArray = viewDef.cells = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tarray.forEach(colOrder[viewIdx], function(subrow){\r\n\t\t\t\t\t\t\tarray.forEach(subrow, function(cellInfo){\r\n\t\t\t\t\t\t\t\tvar i, cell;\r\n\t\t\t\t\t\t\t\tfor(i = 0; i < cells.length; ++i){\r\n\t\t\t\t\t\t\t\t\tcell = cells[i];\r\n\t\t\t\t\t\t\t\t\tif(json.toJson({'name':cell.name,'field':cell.field}) == json.toJson(cellInfo)){\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(i < cells.length){\r\n\t\t\t\t\t\t\t\t\tcellArray.push(cell);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\toldFunc.call(grid, structure);\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n\t\r\n\tvar _saveColumnOrder = function(grid){\r\n\t\tvar colOrder = array.map(array.filter(grid.views.views, function(view){\r\n\t\t\treturn !(view instanceof _RowSelector);\r\n\t\t}), function(view){\r\n\t\t\treturn array.map(view.structure.cells, function(subrow){\r\n\t\t\t\treturn array.map(array.filter(subrow, function(cell){\r\n\t\t\t\t\treturn !(cell.isRowSelector || cell instanceof gridCells.RowIndex);\r\n\t\t\t\t}), function(cell){\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\"name\": cell.name,\r\n\t\t\t\t\t\t\"field\": cell.field\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn colOrder;\r\n\t};\r\n\t\r\n\t// Persist sorting order\r\n\tvar _loadSortOrder = function(sortOrder, grid){\r\n\t\ttry{\r\n\t\t\tif(sortOrder && lang.isObject(sortOrder)){\r\n\t\t\t\tgrid.setSortIndex(sortOrder.idx, sortOrder.asc);\r\n\t\t\t}\r\n\t\t}catch(e){\r\n\t\t\t//setSortIndex will finally call _fetch, some exceptions will be throw\r\n\t\t\t//'cause the grid hasn't be fully loaded now. Just ignore them.\r\n\t\t}\r\n\t};\r\n\t\r\n\tvar _saveSortOrder = function(grid){\r\n\t\treturn {\r\n\t\t\tidx: grid.getSortIndex(),\r\n\t\t\tasc: grid.getSortAsc()\r\n\t\t};\r\n\t};\r\n\t\r\n\tif(!has('ie')){\r\n\t\t// Now in non-IE, widgets are no longer destroyed on page unload,\r\n\t\t// so we have to destroy it manually to trigger saving cookie.\r\n\t\tunload.addOnWindowUnload(function(){\r\n\t\t\tarray.forEach(dijit.findWidgets(win.body()), function(widget){\r\n\t\t\t\tif(widget instanceof EnhancedGrid && !widget._destroyed){\r\n\t\t\t\t\twidget.destroyRecursive();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\t\r\n\tvar Cookie = declare(\"dojox.grid.enhanced.plugins.Cookie\", _Plugin, {\r\n\t\t// summary:\r\n\t\t//\t\tThis plugin provides a way to persist some grid features in cookie.\r\n\t\t//\t\tDefault persistable features are:\r\n\t\t//\t\tcolumn width:\t\"columnWidth\" (handler name)\r\n\t\t//\t\tcolumn order:\t\"columnOrder\"\r\n\t\t//\t\tsorting order:\t\"sortOrder\"\r\n\t\t//\r\n\t\t//\t\tGrid users can define new persistable features\r\n\t\t//\t\tby calling the following before grid is initialized (that is, during \"preInit\");\r\n\t\t//\t\t|\tgrid.addCookieHandler({\r\n\t\t//\t\t|\t\tname: \"a name for the new persistable feature\",\r\n\t\t//\t\t|\t\tonLoad: function(savedObject, grid){\r\n\t\t//\t\t|\t\t\t//load the cookie.\r\n\t\t//\t\t|\t\t},\r\n\t\t//\t\t|\t\tonSave: function(grid){\r\n\t\t//\t\t|\t\t\t//save the cookie.\r\n\t\t//\t\t|\t\t}\r\n\t\t//\t\t|\t});\r\n\t\t\r\n\t\t// name: String\r\n\t\t//\t\tPlugin name\r\n\t\tname: \"cookie\",\r\n\t\t\r\n\t\t_cookieEnabled: true,\r\n\t\t\r\n\t\tconstructor: function(grid, args){\r\n\t\t\tthis.grid = grid;\r\n\t\t\targs = (args && lang.isObject(args)) ? args : {};\r\n\t\t\tthis.cookieProps = args.cookieProps;\r\n\t\t\tthis._cookieHandlers = [];\r\n\t\t\tthis._mixinGrid();\r\n\t\t\t\r\n\t\t\t//Column width & simple sorting & column reorder are base grid features, so they must be supported.\r\n\t\t\tthis.addCookieHandler({\r\n\t\t\t\tname: \"columnWidth\",\r\n\t\t\t\tonLoad: _loadColWidth,\r\n\t\t\t\tonSave: _saveColWidth\r\n\t\t\t});\r\n\t\t\tthis.addCookieHandler({\r\n\t\t\t\tname: \"columnOrder\",\r\n\t\t\t\tonLoad: _loadColumnOrder,\r\n\t\t\t\tonSave: _saveColumnOrder\r\n\t\t\t});\r\n\t\t\tthis.addCookieHandler({\r\n\t\t\t\tname: \"sortOrder\",\r\n\t\t\t\tonLoad: _loadSortOrder,\r\n\t\t\t\tonSave: _saveSortOrder\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tarray.forEach(this._cookieHandlers, function(handler){\r\n\t\t\t\tif(args[handler.name] === false){\r\n\t\t\t\t\thandler.enable = false;\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\tdestroy:function(){\r\n\t\t\tthis._saveCookie();\r\n\t\t\tthis._cookieHandlers = null;\r\n\t\t\tthis.inherited(arguments);\r\n\t\t},\r\n\t\t_mixinGrid: function(){\r\n\t\t\tvar g = this.grid;\r\n\t\t\tg.addCookieHandler = lang.hitch(this, \"addCookieHandler\");\r\n\t\t\tg.removeCookie = lang.hitch(this, \"removeCookie\");\r\n\t\t\tg.setCookieEnabled = lang.hitch(this, \"setCookieEnabled\");\r\n\t\t\tg.getCookieEnabled = lang.hitch(this, \"getCookieEnabled\");\r\n\t\t},\r\n\t\t_saveCookie: function(){\r\n\t\t\tif(this.getCookieEnabled()){\r\n\t\t\t\tvar ck = {},\r\n\t\t\t\t\tchs = this._cookieHandlers,\r\n\t\t\t\t\tcookieProps = this.cookieProps,\r\n\t\t\t\t\tcookieKey = _cookieKeyBuilder(this.grid);\r\n\t\t\t\tfor(var i = chs.length-1; i >= 0; --i){\r\n\t\t\t\t\tif(chs[i].enabled){\r\n\t\t\t\t\t\t//Do the real saving work here.\r\n\t\t\t\t\t\tck[chs[i].name] = chs[i].onSave(this.grid);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcookieProps = lang.isObject(this.cookieProps) ? this.cookieProps : {};\r\n\t\t\t\tcookie(cookieKey, json.toJson(ck), cookieProps);\r\n\t\t\t}else{\r\n\t\t\t\tthis.removeCookie();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonPreInit: function(){\r\n\t\t\tvar grid = this.grid,\r\n\t\t\t\tchs = this._cookieHandlers,\r\n\t\t\t\tcookieKey = _cookieKeyBuilder(grid),\r\n\t\t\t\tck = cookie(cookieKey);\r\n\t\t\tif(ck){\r\n\t\t\t\tck = json.fromJson(ck);\r\n\t\t\t\tfor(var i = 0; i < chs.length; ++i){\r\n\t\t\t\t\tif(chs[i].name in ck && chs[i].enabled){\r\n\t\t\t\t\t\t//Do the real loading work here.\r\n\t\t\t\t\t\tchs[i].onLoad(ck[chs[i].name], grid);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._cookie = ck || {};\r\n\t\t\tthis._cookieStartedup = true;\r\n\t\t},\r\n\t\taddCookieHandler: function(args){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tIf a grid plugin wants cookie service, call this.\r\n\t\t\t//\t\tThis must be called during preInit.\r\n\t\t\t// args: Object\r\n\t\t\t//\t\tAn object with the following structure:\r\n\t\t\t//\t|\t{\r\n\t\t\t//\t|\t\tname: \"some-string\",\r\n\t\t\t//\t|\t\tonLoad: /* void */ function(/* object */partOfCookie, /* EDG */grid){...},\r\n\t\t\t//\t|\t\tonSave: /* object */ function(/* EDG */grid){...}\r\n\t\t\t//\t|\t}\r\n\t\t\tif(args.name){\r\n\t\t\t\tvar dummy = function(){};\r\n\t\t\t\targs.onLoad = args.onLoad || dummy;\r\n\t\t\t\targs.onSave = args.onSave || dummy;\r\n\t\t\t\tif(!(\"enabled\" in args)){\r\n\t\t\t\t\targs.enabled = true;\r\n\t\t\t\t}\r\n\t\t\t\tfor(var i = this._cookieHandlers.length - 1; i >= 0; --i){\r\n\t\t\t\t\tif(this._cookieHandlers[i].name == args.name){\r\n\t\t\t\t\t\tthis._cookieHandlers.splice(i, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis._cookieHandlers.push(args);\r\n\t\t\t\tif(this._cookieStartedup && args.name in this._cookie){\r\n\t\t\t\t\targs.onLoad(this._cookie[args.name], this.grid);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tremoveCookie: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRemove cookie for this grid.\r\n\t\t\tvar key = _cookieKeyBuilder(this.grid);\r\n\t\t\tcookie(key, null, {expires: -1});\r\n\t\t},\r\n\t\tsetCookieEnabled: function(cookieName, enabled){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA setter to enable|disable cookie support for a particular Grid feature.\r\n\t\t\t// cookieName: String?\r\n\t\t\t//\t\tName of a cookie handler if provided, otherwise for all cookies.\r\n\t\t\t// enabled: Boolean\r\n\t\t\tif(typeof cookieName == 'string'){\r\n\t\t\t\tvar chs = this._cookieHandlers;\r\n\t\t\t\tfor(var i = chs.length - 1; i >= 0; --i){\r\n\t\t\t\t\tif(chs[i].name === cookieName){\r\n\t\t\t\t\t\tchs[i].enabled = !!enabled;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tthis._cookieEnabled = !!cookieName;\r\n\t\t\t\tif(!this._cookieEnabled){ this.removeCookie(); }\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetCookieEnabled: function(cookieName){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA getter to check cookie support of a particular Grid feature.\r\n\t\t\t// cookieName: String?\r\n\t\t\t//\t\tName of a cookie handler if provided, otherwise for all cookies.\r\n\t\t\tif(lang.isString(cookieName)){\r\n\t\t\t\tvar chs = this._cookieHandlers;\r\n\t\t\t\tfor(var i = chs.length - 1; i >= 0; --i){\r\n\t\t\t\t\tif(chs[i].name == cookieName){ return chs[i].enabled; }\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn this._cookieEnabled;\r\n\t\t}\r\n\t});\r\n\r\n\tEnhancedGrid.registerPlugin(Cookie, {\"preInit\": true});\r\n\r\n\treturn Cookie;\r\n});\r\n"]}