{"version":3,"sources":["grid/enhanced/plugins/filter/FilterBar.js"],"names":["define","declare","array","connect","lang","has","event","html","win","query","_Widget","_TemplatedMixin","_WidgetsInTemplateMixin","fx","baseFx","string","dijitFocus","template","_stopEvent","evt","preventDefault","stop","e","templateString","widgetsInTemplate","_timeout_statusTooltip","_handle_statusTooltip","_curColIdx","plugin","postMixInProperties","this","nls","_filterBarDefBtnLabel","_filterBarClearBtnLabel","_closeFilterBarBtnLabel","itemsName","args","_noFilterMsg","substitute","t","statusTipTimeout","g","grid","showFilterBar","hitch","toggleFilterBar","isFilterBarShown","postCreate","inherited","arguments","closeFilterbarButton","style","closeFilterBarButton","domNode","_this","old_func","oldGetHeaderHeight","_getHeaderHeight","placeAt","viewsHeaderNode","filterDefDialog","layer","_onFiltered","defineFilterButton","title","hasClass","body","set","clearFilterButton","toggleClearFilterBtn","_initAriaInfo","marginBox","h","focus","addArea","name","onFocus","_onFocusFilterBar","onBlur","_onBlurFilterBar","placeArea","uninitialize","removeArea","toShow","useAnim","animArgs","Boolean","anims","push","mixin","node","duration","curHeight","views","offsetHeight","prop","properties","height","end","barHeight","scrollHeight","forEach","view","animateProperty","scrollboxNode","viewsNode","combine","play","update","getColumnIdx","coordX","headers","idx","i","length","coord","position","x","w","layout","cells","filterable","toHide","_closeFilterBar","getCriteria","handle","disconnect","_clearFilterDefDialog","_showFilterDefDialog","showDialog","focusArea","onClearFilter","_onEnterButton","_onMoveButton","_onLeaveButton","_leavingBtn","_onShowFilterDefDialog","colIdx","_defPaneIsShown","_onCloseFilterDefDialog","_onClickFilterBar","_clearStatusTipTimeout","clientX","_onMouseEnter","_updateTipPosition","_setStatusTipTimeout","_onMouseMove","_isFocused","_highlightHeader","_onMouseLeave","_tippos","pageX","y","pageY","highlightOnly","step","addClass","hasFilter","hasCloseButton","_focusPos","focusNode","removeClass","_clearHeaderHighlight","toBlur","buttonCount","current","next","filteredSize","originSize","p","msg","filterDef","statusBarNode","innerHTML","setAttribute","_isInColumn","mousePos_x","headerNode","colIndex","setTimeout","_showStatusTooltip","clearTimeout","filterStatusTip","_previousHeaderIdx","cell","getCell","getHeaderNode","onHeaderCellMouseOut","cellNode"],"mappings":"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","file":"../../../../../grid/enhanced/plugins/filter/FilterBar.js","sourcesContent":["define([\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/sniff\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/_base/html\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/query\",\r\n\t\"dijit/_Widget\",\r\n\t\"dijit/_TemplatedMixin\",\r\n\t\"dijit/_WidgetsInTemplateMixin\",\r\n\t\"dojo/fx\",\r\n\t\"dojo/_base/fx\",\r\n\t\"dojo/string\",\r\n\t\"dijit/focus\",\r\n\t\"dojo/text!../../templates/FilterBar.html\"\r\n], function(declare, array, connect, lang, has, event, html, win, query, _Widget,\r\n\t_TemplatedMixin, _WidgetsInTemplateMixin, fx, baseFx, string, dijitFocus, template){\r\n\r\nvar _focusClass = \"dojoxGridFBarHover\",\r\n\t_filteredClass = \"dojoxGridFBarFiltered\",\r\n\t_stopEvent = function(evt){\r\n\t\ttry{\r\n\t\t\tif(evt && evt.preventDefault){\r\n\t\t\t\tevent.stop(evt);\r\n\t\t\t}\r\n\t\t}catch(e){}\r\n\t};\r\n\t\r\nreturn declare(\"dojox.grid.enhanced.plugins.filter.FilterBar\", [_Widget, _TemplatedMixin, _WidgetsInTemplateMixin],{\r\n\t// summary:\r\n\t//\t\tThe filter bar UI.\r\n\ttemplateString: template,\r\n\r\n\twidgetsInTemplate: true,\r\n\t\r\n\t_timeout_statusTooltip: 300,\r\n\r\n\t_handle_statusTooltip: null,\r\n\r\n\t_curColIdx: -1,\r\n\t\r\n\tplugin: null,\r\n\r\n\tpostMixInProperties: function(){\r\n\t\tvar plugin = this.plugin;\r\n\t\tvar nls = plugin.nls;\r\n\t\tthis._filterBarDefBtnLabel = nls[\"filterBarDefButton\"];\r\n\t\tthis._filterBarClearBtnLabel = nls[\"filterBarClearButton\"];\r\n\t\tthis._closeFilterBarBtnLabel = nls[\"closeFilterBarBtn\"];\r\n\t\tvar itemsName = plugin.args.itemsName || nls[\"defaultItemsName\"];\r\n\t\tthis._noFilterMsg = string.substitute(nls[\"filterBarMsgNoFilterTemplate\"], [\"\", itemsName]);\r\n\t\t\r\n\t\tvar t = this.plugin.args.statusTipTimeout;\r\n\t\tif(typeof t == 'number'){\r\n\t\t\tthis._timeout_statusTooltip = t;\r\n\t\t}\r\n\t\t\r\n\t\tvar g = plugin.grid;\r\n\t\tg.showFilterBar = lang.hitch(this, \"showFilterBar\");\r\n\t\tg.toggleFilterBar = lang.hitch(this, \"toggleFilterBar\");\r\n\t\tg.isFilterBarShown = lang.hitch(this, \"isFilterBarShown\");\r\n\t},\r\n\tpostCreate: function(){\r\n\t\tthis.inherited(arguments);\r\n\t\tif(!this.plugin.args.closeFilterbarButton){\r\n\t\t\thtml.style(this.closeFilterBarButton.domNode, \"display\", \"none\");\r\n\t\t}\r\n\t\tvar _this = this,\r\n\t\t\tg = this.plugin.grid,\r\n\t\t\told_func = this.oldGetHeaderHeight = lang.hitch(g,g._getHeaderHeight);\r\n\t\t\r\n\t\tthis.placeAt(g.viewsHeaderNode, \"after\");\r\n\t\tthis.connect(this.plugin.filterDefDialog, \"showDialog\", \"_onShowFilterDefDialog\");\r\n\t\tthis.connect(this.plugin.filterDefDialog, \"closeDialog\", \"_onCloseFilterDefDialog\");\r\n\t\tthis.connect(g.layer(\"filter\"), \"onFiltered\", this._onFiltered);\r\n\t\t\r\n\t\tthis.defineFilterButton.domNode.title = this.plugin.nls[\"filterBarDefButton\"];\r\n\t\tif(html.hasClass(win.body(), \"dijit_a11y\")){\r\n\t\t\tthis.defineFilterButton.set(\"label\", this.plugin.nls[\"a11yFilterBarDefButton\"]);\r\n\t\t}\r\n\t\tthis.connect(this.defineFilterButton.domNode, \"click\", _stopEvent);\r\n\t\tthis.connect(this.clearFilterButton.domNode, \"click\", _stopEvent);\r\n\t\tthis.connect(this.closeFilterBarButton.domNode, \"click\", _stopEvent);\r\n\t\t\r\n\t\tthis.toggleClearFilterBtn(true);\r\n\t\tthis._initAriaInfo();\r\n\t\t\r\n\t\t//Hack the header height to include filter bar height;\r\n\t\tg._getHeaderHeight = function(){\r\n\t\t\treturn old_func() + html.marginBox(_this.domNode).h;\r\n\t\t};\r\n\t\t//Define an area to make focusManager handle all the navigation stuff\r\n\t\tg.focus.addArea({\r\n\t\t\tname: \"filterbar\",\r\n\t\t\tonFocus: lang.hitch(this, this._onFocusFilterBar, false),\r\n\t\t\tonBlur: lang.hitch(this, this._onBlurFilterBar)\r\n\t\t});\r\n\t\tg.focus.placeArea(\"filterbar\",\"after\",\"header\");\r\n\t},\r\n\tuninitialize: function(){\r\n\t\tvar g = this.plugin.grid;\r\n\t\tg._getHeaderHeight = this.oldGetHeaderHeight;\r\n\t\tg.focus.removeArea(\"filterbar\");\r\n\t\tthis.plugin = null;\r\n\t},\r\n\tisFilterBarShown: function(){\r\n\t\treturn html.style(this.domNode, \"display\") != \"none\";\r\n\t},\r\n\tshowFilterBar: function(toShow, useAnim, animArgs){\r\n\t\tvar g = this.plugin.grid;\r\n\t\tif(useAnim){\r\n\t\t\tif(Boolean(toShow) == this.isFilterBarShown()){ return; }\r\n\t\t\tanimArgs = animArgs || {};\r\n\t\t\tvar anims = [], defaultDuration = 500;\r\n\t\t\tanims.push(fx[toShow ? \"wipeIn\" : \"wipeOut\"](lang.mixin({\r\n\t\t\t\t\"node\": this.domNode,\r\n\t\t\t\t\"duration\": defaultDuration\r\n\t\t\t}, animArgs)));\r\n\t\t\tvar curHeight = g.views.views[0].domNode.offsetHeight;\r\n\t\t\tvar prop = {\r\n\t\t\t\t\"duration\": defaultDuration,\r\n\t\t\t\t\"properties\": {\r\n\t\t\t\t\t\"height\": {\r\n\t\t\t\t\t\t\"end\": lang.hitch(this, function(){\r\n\t\t\t\t\t\t\tvar barHeight = this.domNode.scrollHeight;\r\n\t\t\t\t\t\t\tif(has('ff')){\r\n\t\t\t\t\t\t\t\tbarHeight -= 2;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn toShow ? (curHeight - barHeight) : (curHeight + barHeight);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tarray.forEach(g.views.views, function(view){\r\n\t\t\t\tanims.push(baseFx.animateProperty(lang.mixin({\r\n\t\t\t\t\t\"node\": view.domNode\r\n\t\t\t\t}, prop, animArgs)), baseFx.animateProperty(lang.mixin({\r\n\t\t\t\t\t\"node\": view.scrollboxNode\r\n\t\t\t\t}, prop, animArgs)));\r\n\t\t\t});\r\n\t\t\tanims.push(baseFx.animateProperty(lang.mixin({\r\n\t\t\t\t\"node\": g.viewsNode\r\n\t\t\t}, prop, animArgs)));\r\n\t\t\tfx.combine(anims).play();\r\n\t\t}else{\r\n\t\t\thtml.style(this.domNode, \"display\", toShow ? \"\" : \"none\");\r\n\t\t\tg.update();\r\n\t\t}\r\n\t},\r\n\ttoggleFilterBar: function(useAnim, animArgs){\r\n\t\tthis.showFilterBar(!this.isFilterBarShown(), useAnim, animArgs);\r\n\t},\r\n\tgetColumnIdx: function(/* int */coordX){\r\n\t\tvar headers = query(\"[role='columnheader']\", this.plugin.grid.viewsHeaderNode);\r\n\t\tvar idx = -1;\r\n\t\tfor(var i = headers.length - 1; i >= 0; --i){\r\n\t\t\tvar coord = html.position(headers[i]);\r\n\t\t\tif(coordX >= coord.x && coordX < coord.x + coord.w){\r\n\t\t\t\tidx = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(idx >= 0 && this.plugin.grid.layout.cells[idx].filterable !== false){\r\n\t\t\treturn idx; //Integer\r\n\t\t}else{\r\n\t\t\treturn -1; //Integer\r\n\t\t}\r\n\t},\r\n\ttoggleClearFilterBtn: function(toHide){\r\n\t\thtml.style(this.clearFilterButton.domNode, \"display\", toHide ? \"none\" : \"\");\r\n\t},\r\n\t_closeFilterBar: function(e){\r\n\t\t_stopEvent(e);\r\n\t\tvar rulesCnt = this.plugin.filterDefDialog.getCriteria();\r\n\t\tif(rulesCnt){\r\n\t\t\tvar handle = connect.connect(this.plugin.filterDefDialog, \"clearFilter\", this, function(){\r\n\t\t\t\tthis.showFilterBar(false, true);\r\n\t\t\t\tconnect.disconnect(handle);\r\n\t\t\t});\r\n\t\t\tthis._clearFilterDefDialog(e);\r\n\t\t}else{\r\n\t\t\tthis.showFilterBar(false, true);\r\n\t\t}\r\n\t},\r\n\r\n\t_showFilterDefDialog: function(e){\r\n\t\t_stopEvent(e);\r\n\t\tthis.plugin.filterDefDialog.showDialog(this._curColIdx);\r\n\t\tthis.plugin.grid.focus.focusArea(\"filterbar\");\r\n\t},\r\n\t_clearFilterDefDialog: function(e){\r\n\t\t_stopEvent(e);\r\n\t\tthis.plugin.filterDefDialog.onClearFilter();\r\n\t\tthis.plugin.grid.focus.focusArea(\"filterbar\");\r\n\t},\r\n\t_onEnterButton: function(e){\r\n\t\t//If mouse is hovering the btn, which means the user is about to click,\r\n\t\t//we should not show status tip on the btn!\r\n\t\tthis._onBlurFilterBar();\r\n\t\t_stopEvent(e);\r\n\t},\r\n\t_onMoveButton: function(e){\r\n\t\tthis._onBlurFilterBar();\r\n\t},\r\n\t_onLeaveButton: function(e){\r\n\t\tthis._leavingBtn = true;\r\n\t},\r\n\t_onShowFilterDefDialog: function(/* Integer */colIdx){\r\n\t\tif(typeof colIdx == \"number\"){\r\n\t\t\tthis._curColIdx = colIdx;\r\n\t\t}\r\n\t\tthis._defPaneIsShown = true;\r\n\t},\r\n\t_onCloseFilterDefDialog: function(){\r\n\t\tthis._defPaneIsShown = false;\r\n\t\t//Do not remember what column are we on, so clicking the btn will show 'any column'\r\n\t\tthis._curColIdx = -1;\r\n\t\tdijitFocus.focus(this.defineFilterButton.domNode);\r\n\t},\r\n\t_onClickFilterBar: function(/* event */e){\r\n\t\t_stopEvent(e);\r\n\t\tthis._clearStatusTipTimeout();\r\n\t\tthis.plugin.grid.focus.focusArea(\"filterbar\");\r\n\t\tthis.plugin.filterDefDialog.showDialog(this.getColumnIdx(e.clientX));\r\n\t},\r\n\t_onMouseEnter: function(/* event */e){\r\n\t\tthis._onFocusFilterBar(true, null);\r\n\t\tthis._updateTipPosition(e);\r\n\t\tthis._setStatusTipTimeout();\r\n\t},\r\n\t_onMouseMove: function(/* event */e){\r\n\t\tif(this._leavingBtn){\r\n\t\t\tthis._onFocusFilterBar(true, null);\r\n\t\t\tthis._leavingBtn = false;\r\n\t\t}\r\n\t\tif(this._isFocused){\r\n\t\t\tthis._setStatusTipTimeout();\r\n\t\t\tthis._highlightHeader(this.getColumnIdx(e.clientX));\r\n\t\t\tif(this._handle_statusTooltip){\r\n\t\t\t\tthis._updateTipPosition(e);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_onMouseLeave: function(e){\r\n\t\tthis._onBlurFilterBar();\r\n\t},\r\n\t_updateTipPosition: function(evt){\r\n\t\tthis._tippos = {\r\n\t\t\tx: evt.pageX,\r\n\t\t\ty: evt.pageY\r\n\t\t};\r\n\t},\r\n\t_onFocusFilterBar: function(highlightOnly, evt, step){\r\n\t\tif(!this.isFilterBarShown()){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis._isFocused = true;\r\n\t\thtml.addClass(this.domNode,_focusClass);\r\n\t\tif(!highlightOnly){\r\n\t\t\tvar hasFilter = html.style(this.clearFilterButton.domNode, \"display\") !== \"none\";\r\n\t\t\tvar hasCloseButton = html.style(this.closeFilterBarButton.domNode, \"display\") !== \"none\";\r\n\t\t\tif(typeof this._focusPos == \"undefined\"){\r\n\t\t\t\tif(step > 0){\r\n\t\t\t\t\tthis._focusPos = 0;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(hasCloseButton){\r\n\t\t\t\t\t\tthis._focusPos = 1;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis._focusPos = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(hasFilter){\r\n\t\t\t\t\t\t++this._focusPos;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this._focusPos === 0){\r\n\t\t\t\tdijitFocus.focus(this.defineFilterButton.focusNode);\r\n\t\t\t}else if(this._focusPos === 1 && hasFilter){\r\n\t\t\t\tdijitFocus.focus(this.clearFilterButton.focusNode);\r\n\t\t\t}else{\r\n\t\t\t\tdijitFocus.focus(this.closeFilterBarButton.focusNode);\r\n\t\t\t}\r\n\t\t}\r\n\t\t_stopEvent(evt);\r\n\t\treturn true;\r\n\t},\r\n\t_onBlurFilterBar: function(evt, step){\r\n\t\tif(this._isFocused){\r\n\t\t\tthis._isFocused = false;\r\n\t\t\thtml.removeClass(this.domNode,_focusClass);\r\n\t\t\tthis._clearStatusTipTimeout();\r\n\t\t\tthis._clearHeaderHighlight();\r\n\t\t}\r\n\t\tvar toBlur = true;\r\n\t\tif(step){\r\n\t\t\tvar buttonCount = 3;\r\n\t\t\tif(html.style(this.closeFilterBarButton.domNode, \"display\") === \"none\"){\r\n\t\t\t\t--buttonCount;\r\n\t\t\t}\r\n\t\t\tif(html.style(this.clearFilterButton.domNode, \"display\") === \"none\"){\r\n\t\t\t\t--buttonCount;\r\n\t\t\t}\r\n\t\t\tif(buttonCount == 1){\r\n\t\t\t\tdelete this._focusPos;\r\n\t\t\t}else{\r\n\t\t\t\tvar current = this._focusPos;\r\n\t\t\t\tfor(var next = current + step; next < 0; next += buttonCount){}\r\n\t\t\t\tnext %= buttonCount;\r\n\t\t\t\tif((step > 0 && next < current) || (step < 0 && next > current)){\r\n\t\t\t\t\tdelete this._focusPos;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._focusPos = next;\r\n\t\t\t\t\ttoBlur = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn toBlur;\r\n\t},\r\n\t_onFiltered: function(/* int */filteredSize,/* int */originSize){\r\n\t\tvar p = this.plugin,\r\n\t\t\titemsName = p.args.itemsName || p.nls[\"defaultItemsName\"],\r\n\t\t\tmsg = \"\", g = p.grid,\r\n\t\t\tfilterLayer = g.layer(\"filter\");\r\n\t\tif(filterLayer.filterDef()){\r\n\t\t\tmsg = string.substitute(p.nls[\"filterBarMsgHasFilterTemplate\"], [filteredSize, originSize, itemsName]);\r\n\t\t\thtml.addClass(this.domNode, _filteredClass);\r\n\t\t}else{\r\n\t\t\tmsg = string.substitute(p.nls[\"filterBarMsgNoFilterTemplate\"], [originSize, itemsName]);\r\n\t\t\thtml.removeClass(this.domNode, _filteredClass);\r\n\t\t}\r\n\t\tthis.statusBarNode.innerHTML = msg;\r\n\t\tthis._focusPos = 0;\r\n\t},\r\n\t_initAriaInfo: function(){\r\n\t\tthis.defineFilterButton.domNode.setAttribute(\"aria-label\", this.plugin.nls[\"waiFilterBarDefButton\"]);\r\n\t\tthis.clearFilterButton.domNode.setAttribute(\"aria-label\", this.plugin.nls[\"waiFilterBarClearButton\"]);\r\n\t},\r\n\t_isInColumn: function(/* int */mousePos_x, /* domNode */headerNode, /* int */colIndex){\r\n\t\tvar coord = html.position(headerNode);\r\n\t\treturn mousePos_x >= coord.x && mousePos_x < coord.x + coord.w;\r\n\t},\r\n\t_setStatusTipTimeout: function(){\r\n\t\tthis._clearStatusTipTimeout();\r\n\t\tif(!this._defPaneIsShown){\r\n\t\t\tthis._handle_statusTooltip = setTimeout(lang.hitch(this,this._showStatusTooltip),this._timeout_statusTooltip);\r\n\t\t}\r\n\t},\r\n\t_clearStatusTipTimeout: function(){\r\n\t\tclearTimeout(this._handle_statusTooltip);\r\n\t\tthis._handle_statusTooltip = null;\r\n\t},\r\n\t_showStatusTooltip: function(){\r\n\t\tthis._handle_statusTooltip = null;\r\n\t\tif(this.plugin){\r\n\t\t\tthis.plugin.filterStatusTip.showDialog(this._tippos.x, this._tippos.y, this.getColumnIdx(this._tippos.x));\r\n\t\t}\r\n\t},\r\n\t_highlightHeader: function(/* int */colIdx){\r\n\t\tif(colIdx != this._previousHeaderIdx){\r\n\t\t\tvar g = this.plugin.grid,\r\n\t\t\tcell = g.getCell(this._previousHeaderIdx);\r\n\t\t\tif(cell){\r\n\t\t\t\thtml.removeClass(cell.getHeaderNode(), \"dojoxGridCellOver\");\r\n\t\t\t}\r\n\t\t\tcell = g.getCell(colIdx);\r\n\t\t\tif(cell){\r\n\t\t\t\thtml.addClass(cell.getHeaderNode(), \"dojoxGridCellOver\");\r\n\t\t\t}\r\n\t\t\tthis._previousHeaderIdx = colIdx;\r\n\t\t}\r\n\t},\r\n\t_clearHeaderHighlight: function(){\r\n\t\tif(typeof this._previousHeaderIdx != \"undefined\"){\r\n\t\t\tvar g = this.plugin.grid,\r\n\t\t\tcell = g.getCell(this._previousHeaderIdx);\r\n\t\t\tif(cell){\r\n\t\t\t\tg.onHeaderCellMouseOut({\r\n\t\t\t\t\tcellNode: cell.getHeaderNode()\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tdelete this._previousHeaderIdx;\r\n\t\t}\r\n\t}\r\n});\r\n});\r\n"]}