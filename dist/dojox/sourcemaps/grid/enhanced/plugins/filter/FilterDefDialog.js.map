{"version":3,"sources":["grid/enhanced/plugins/filter/FilterDefDialog.js"],"names":["define","declare","array","connect","lang","event","html","has","keys","on","string","win","dateLocale","FilterBuilder","Dialog","ComboBox","TextBox","NumberTextBox","DateTextBox","TimeTextBox","Button","AccordionContainer","ContentPane","_Widget","_TemplatedMixin","_WidgetsInTemplateMixin","dijitFocus","metrics","dijitA11y","defPaneTemplate","criteriaTemplate","boolValueTemplate","_tabIdxes","FilterAccordionContainer","nls","addChild","child","insertIndex","pane","arguments","_pane","content","this","inherited","_modifyChild","removeChild","isRemoveByUser","_hackHeight","_titleHeight","children","getChildren","length","style","_removeCBoxBtn","domNode","destroyRecursive","selectChild","resize","forEach","_setupTitleDom","startup","_started","parseInt","some","_connects","cnnt","disconnect","_onKeyPress","e","fromTitle","disabled","altKey","ctrlKey","k","c","charOrCode","ltr","_isBodyLtr","toNext","UP_ARROW","PAGE_UP","DOWN_ARROW","PAGE_DOWN","TAB","LEFT_ARROW","RIGHT_ARROW","_focusOnRemoveBtn","_adjacent","_buttonWidget","_onTitleClick","stop","scrollIntoView","selectedChildWidget","parentNode","focusNode","setAttribute","focus","isFirst","selected","_this","label","removeRuleButton","showLabel","iconClass","tabIndex","onClick","hitch","onKeyPress","contentWidget","placeAt","i","set","marginBox","h","toGrow","heightDif","dn","height","w","contentBox","titleNode","titleTextNode","FilterDefPane","templateString","widgetsInTemplate","dlg","postMixInProperties","plugin","_addRuleBtnLabel","addRuleButton","_cancelBtnLabel","cancelButton","_clearBtnLabel","clearButton","_filterBtnLabel","filterButton","_relAll","relationAll","_relAny","relationAny","_relMsgFront","relationMsgFront","_relMsgTail","relationMsgTail","postCreate","cboxContainer","criteriaPane","_relSelect","_addCBoxBtn","_cancelBtn","_clearFilterBtn","_filterBtn","waiRelAll","waiAddRuleButton","waiCancelButton","waiClearButton","waiFilterButton","_relOpCls","uninitialize","_onRelSelectChange","val","_onAddCBox","addCriteriaBoxes","_onCancel","onCancel","_onClearFilter","onClearFilter","_onFilter","onFilter","_onKey","keyCode","ENTER","CriteriaBox","_curValueBox","_colSelectLabel","columnSelectLabel","_condSelectLabel","conditionSelectLabel","_valueBoxLabel","valueBoxLabel","_anyColumnOption","anyColumnOption","g","grid","_colSelect","_colOptions","_getColumnOptions","addOption","value","curColIdx","concat","_condSelect","_getUsableConditions","getColumnType","_showSelectOrLabel","_condSelectAlt","layout","setTimeout","type","_setValueBoxByType","colIdx","String","map","filter","cells","cell","filterable","hidden","name","field","index","onMoveColumn","tmp","_onChangeColumn","option","get","removeOption","onRemove","removeCriteriaBoxes","sel","alt","options","getOptions","innerHTML","_checkValidCriteria","_setConditionsByType","_updateValueBox","_onChangeCondition","f","_isRange","cond","updateRuleTitle","_updatePane","_createValueBox","cls","arg","func","cbox","mixin","onChange","class","_createRangeBox","div","create","start","txt","rangeTo","end","addClass","appendChild","dummy","args","isObject","s","changeCurrentColumn","selectCurCol","curColumn","curCondition","curValue","save","isEmpty","column","condition","formattedVal","formatValue","colTxt","condTxt","load","obj","getExpr","colval","getExprForCriteria","v","isNaN","node","title","substitute","ruleTitleTemplate","_ruleIndex","push","join","updateRuleIndex","setAriaInfo","idx","dss","waiColumnSelectTemplate","waiConditionSelectTemplate","waiRemoveRuleButtonTemplate","_index","conditions","clone","_dataTypeMap","typeDisabledConds","disabledConditions","colDisabledConds","isArray","arr","disabledConds","isString","toLowerCase","condOption","condSelect","valueNode","vbcls","valueBoxCls","_getValueBoxClsInfo","vboxArg","_getValueBoxArgByType","waiValueBoxTemplate","onRendered","res","suggestion","autoComplete","store","searchAttr","query","fetchProperties","sort","attribute","queryOptions","ignoreCase","deep","builder","defaultArgs","dataTypeArgs","opt","selector","fmt","format","rangeTemplate","_lblTrue","_lblFalse","colIndex","UniqueComboBox","_openResultList","results","cache","colName","item","key","getValue","existed","evt","_opened","BooleanValueBox","constructor","_baseId","id","trueLabel","falseLabel","prop","rbTrue","rbFalse","_savedCriterias","_setupData","_cboxes","defaultType","filterDefPane","_defPane","refNode","filterDefDialogTitle","layer","setFilter","getFilter","getFilterRelation","sourceViewIndex","destViewIndex","cellIndex","targetIndex","before","min","max","dir","sc","destroy","number","dft","conditionEqual","conditionNotEqual","conditionLess","conditionLessEqual","conditionLarger","conditionLargerEqual","conditionIsEmpty","ac","conditionContains","conditionIs","conditionStartsWith","conditionEndWith","conditionNotContain","conditionIsNot","conditionNotStartWith","conditionNotEndWith","date","conditionBefore","conditionAfter","conditionRange","time","boolean","rules","ruleRelation","rule","getColumnLabelByValue","getConditionLabelByValue","_criteriasChanged","exprs","buildExpression","op","data","filterDef","filterBar","toggleClearFilterBtn","_closeDlgAndUpdateGrid","_clearWithoutRefresh","handle","apply","cnt","cbs","cc","total","ruleCount","len","_updateCBoxTitles","scrollTop","__alreadyResizedForIE6","size","position","getScrollbar","isIdx","curIdx","indexOf","idxes","splice","getCriteria","relation","and","or","getExprForColumn","datatype","isColumn","operands","isServerSide","clearFilter","noRefresh","closeDialog","showDialog","show","filterStatusTip","_prepareDialog","open","hide","canFilter","_defineFilter","ruleCountToConfirmClearFilter","clearFilterDialog","dp","_getFocusItems","_firstFocusItem","elems","_getTabNavigable","byId","lowest","first","_onSetFilter","needNewCBox","handled","filterCboxes","method","result","defPane","showMessage","loadingMessage","_refresh","duration"],"mappings":"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","file":"../../../../../grid/enhanced/plugins/filter/FilterDefDialog.js","sourcesContent":["define([\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/_base/html\",\r\n\t\"dojo/_base/sniff\",\r\n\t\"dojo/keys\",\r\n\t\"dojo/on\",\r\n\t\"dojo/string\",\r\n\t\"dojo/window\",\r\n\t\"dojo/date/locale\",\t\t\r\n\t\"./FilterBuilder\",\r\n\t\"../Dialog\",\r\n\t\"dijit/form/ComboBox\",\r\n\t\"dijit/form/TextBox\",\r\n\t\"dijit/form/NumberTextBox\",\r\n\t\"dijit/form/DateTextBox\",\r\n\t\"dijit/form/TimeTextBox\",\r\n\t\"dijit/form/Button\",\r\n\t\"dijit/layout/AccordionContainer\",\r\n\t\"dijit/layout/ContentPane\",\r\n\t\"dijit/_Widget\", \r\n\t\"dijit/_TemplatedMixin\", \r\n\t\"dijit/_WidgetsInTemplateMixin\",\r\n\t\"dijit/focus\",\r\n\t\"dojox/html/metrics\",\r\n\t\"dijit/a11y\",\r\n\t\"dojo/text!../../templates/FilterDefPane.html\",\r\n\t\"dojo/text!../../templates/CriteriaBox.html\",\r\n\t\"dojo/text!../../templates/FilterBoolValueBox.html\",\t\r\n\t\"dijit/Tooltip\",\r\n\t\"dijit/form/Select\",\r\n\t\"dijit/form/RadioButton\",\r\n\t\"dojox/html/ellipsis\",\r\n\t\"../../../cells/dijit\"\r\n], function(declare, array, connect, lang, event, html, has, keys, on, string, win, dateLocale, \r\n\tFilterBuilder, Dialog, ComboBox, TextBox, NumberTextBox, DateTextBox, TimeTextBox, Button, \r\n\tAccordionContainer, ContentPane, _Widget, _TemplatedMixin, _WidgetsInTemplateMixin, dijitFocus,\r\n\tmetrics, dijitA11y, defPaneTemplate, criteriaTemplate, boolValueTemplate){\r\n\t\t\r\nvar _tabIdxes = {\r\n\t\t// summary:\r\n\t\t//\t\tDefine tabindexes for elements in the filter definition dialog\r\n\t\trelSelect: 60,\r\n\t\taccordionTitle: 70,\r\n\t\tremoveCBoxBtn: -1,\r\n\t\tcolSelect: 90,\r\n\t\tcondSelect: 95,\r\n\t\tvalueBox: 10,\r\n\t\taddCBoxBtn: 20,\r\n\t\tfilterBtn: 30,\r\n\t\tclearBtn: 40,\r\n\t\tcancelBtn: 50\r\n\t};\r\nvar FilterAccordionContainer = declare(\"dojox.grid.enhanced.plugins.filter.AccordionContainer\", AccordionContainer, {\r\n\tnls: null,\r\n\taddChild: function(/*dijit._Widget*/ child, /*Integer?*/ insertIndex){\r\n\t\tvar pane = arguments[0] = child._pane = new ContentPane({\r\n\t\t\tcontent: child\r\n\t\t});\r\n\t\tthis.inherited(arguments);\r\n\t\tthis._modifyChild(pane);\r\n\t},\r\n\tremoveChild: function(child){\r\n\t\tvar pane = child, isRemoveByUser = false;\r\n\t\tif(child._pane){\r\n\t\t\tisRemoveByUser = true;\r\n\t\t\tpane = arguments[0] = child._pane;\r\n\t\t}\r\n\t\tthis.inherited(arguments);\r\n\t\tif(isRemoveByUser){\r\n\t\t\tthis._hackHeight(false, this._titleHeight);\r\n\t\t\tvar children = this.getChildren();\r\n\t\t\tif(children.length === 1){\r\n\t\t\t\thtml.style(children[0]._removeCBoxBtn.domNode, \"display\", \"none\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tpane.destroyRecursive();\r\n\t},\r\n\tselectChild: function(child){\r\n\t\tif(child._pane){\r\n\t\t\targuments[0] = child._pane;\r\n\t\t}\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\tresize: function(){\r\n\t\tthis.inherited(arguments);\r\n\t\tarray.forEach(this.getChildren(), this._setupTitleDom);\r\n\t},\r\n\tstartup: function(){\r\n\t\tif(this._started){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.inherited(arguments);\r\n\t\tif(parseInt(has('ie'), 10) == 7){\r\n\t\t\t//IE7 will fire a lot of \"onresize\" event during initialization.\r\n\t\t\tarray.some(this._connects, function(cnnt){\r\n\t\t\t\tif((cnnt[0] || {})[1] == \"onresize\"){\r\n\t\t\t\t\tthis.disconnect(cnnt);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t\tarray.forEach(this.getChildren(), function(child){\r\n\t\t\tthis._modifyChild(child, true);\r\n\t\t}, this);\r\n\t},\r\n\t_onKeyPress: function(/*Event*/ e, /*dijit._Widget*/ fromTitle){\r\n\t\t// summary:\r\n\t\t//\t\tOverrides base class method, make left/right button do other things.\r\n\t\tif(this.disabled || e.altKey || !(fromTitle || e.ctrlKey)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar k = keys, c = e.charOrCode, ltr = html._isBodyLtr(), toNext = null;\r\n\t\tif((fromTitle && c == k.UP_ARROW) || (e.ctrlKey && c == k.PAGE_UP)){\r\n\t\t\ttoNext = false;\r\n\t\t}else if((fromTitle && c == k.DOWN_ARROW) || (e.ctrlKey && (c == k.PAGE_DOWN || c == k.TAB))){\r\n\t\t\ttoNext = true;\r\n\t\t}else if(c == (ltr ? k.LEFT_ARROW : k.RIGHT_ARROW)){\r\n\t\t\ttoNext = this._focusOnRemoveBtn ? null : false;\r\n\t\t\tthis._focusOnRemoveBtn = !this._focusOnRemoveBtn;\r\n\t\t}else if(c == (ltr ? k.RIGHT_ARROW : k.LEFT_ARROW)){\r\n\t\t\ttoNext = this._focusOnRemoveBtn ? true : null;\r\n\t\t\tthis._focusOnRemoveBtn = !this._focusOnRemoveBtn;\r\n\t\t}else{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(toNext !== null){\r\n\t\t\tthis._adjacent(toNext)._buttonWidget._onTitleClick();\r\n\t\t}\r\n\t\tevent.stop(e);\r\n\t\twin.scrollIntoView(this.selectedChildWidget._buttonWidget.domNode.parentNode);\r\n\t\tif(has('ie')){\r\n\t\t\t//IE will not show focus indicator if tabIndex is -1\r\n\t\t\tthis.selectedChildWidget._removeCBoxBtn.focusNode.setAttribute(\"tabIndex\", this._focusOnRemoveBtn ? _tabIdxes.accordionTitle : -1);\r\n\t\t}\r\n\t\tdijitFocus.focus(this.selectedChildWidget[this._focusOnRemoveBtn ? \"_removeCBoxBtn\" : \"_buttonWidget\"].focusNode);\r\n\t},\r\n\t_modifyChild: function(child, isFirst){\r\n\t\tif(!child || !this._started){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\thtml.style(child.domNode, \"overflow\", \"hidden\");\r\n\t\tchild._buttonWidget.connect(child._buttonWidget, \"_setSelectedAttr\", function(){\r\n\t\t\tthis.focusNode.setAttribute(\"tabIndex\", this.selected ? _tabIdxes.accordionTitle : \"-1\");\r\n\t\t});\r\n\t\tvar _this = this;\r\n\t\tchild._buttonWidget.connect(child._buttonWidget.domNode, \"onclick\", function(){\r\n\t\t\t_this._focusOnRemoveBtn = false;\r\n\t\t});\r\n\t\t(child._removeCBoxBtn = new Button({\r\n\t\t\tlabel: this.nls.removeRuleButton,\r\n\t\t\tshowLabel: false,\r\n\t\t\ticonClass: \"dojoxGridFCBoxRemoveCBoxBtnIcon\",\r\n\t\t\ttabIndex: _tabIdxes.removeCBoxBtn,\r\n\t\t\tonClick: lang.hitch(child.content, \"onRemove\"),\r\n\t\t\tonKeyPress: function(e){\r\n\t\t\t\t_this._onKeyPress(e, child._buttonWidget.contentWidget);\r\n\t\t\t}\r\n\t\t})).placeAt(child._buttonWidget.domNode);\r\n\t\tvar i, children = this.getChildren();\r\n\t\tif(children.length === 1){\r\n\t\t\tchild._buttonWidget.set(\"selected\", true);\r\n\t\t\thtml.style(child._removeCBoxBtn.domNode, \"display\", \"none\");\r\n\t\t}else{\r\n\t\t\tfor(i = 0; i < children.length; ++i){\r\n\t\t\t\tif(children[i]._removeCBoxBtn){\r\n\t\t\t\t\thtml.style(children[i]._removeCBoxBtn.domNode, \"display\", \"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._setupTitleDom(child);\r\n\t\tif(!this._titleHeight){\r\n\t\t\tfor(i = 0; i < children.length; ++i){\r\n\t\t\t\tif(children[i] != this.selectedChildWidget){\r\n\t\t\t\t\tthis._titleHeight = html.marginBox(children[i]._buttonWidget.domNode.parentNode).h;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!isFirst){\r\n\t\t\tthis._hackHeight(true, this._titleHeight);\r\n\t\t}\r\n\t},\r\n\t_hackHeight: function(/* bool */toGrow,/* int */heightDif){\r\n\t\tvar children = this.getChildren(),\r\n\t\t\tdn = this.domNode, h = html.style(dn, \"height\");\r\n\t\tif(!toGrow){\r\n\t\t\tdn.style.height = (h - heightDif) + 'px';\r\n\t\t}else if(children.length > 1){\r\n\t\t\tdn.style.height = (h + heightDif) + 'px';\r\n\t\t}else{\r\n\t\t\t//Only one rule, no need to do anything.\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.resize();\r\n\t},\r\n\t_setupTitleDom: function(child){\r\n\t\tvar w = html.contentBox(child._buttonWidget.titleNode).w;\r\n\t\tif(has('ie') < 8){ w -= 8; }\r\n\t\thtml.style(child._buttonWidget.titleTextNode, \"width\", w + \"px\");\r\n\t}\r\n});\r\nvar FilterDefPane = declare(\"dojox.grid.enhanced.plugins.filter.FilterDefPane\",[_Widget, _TemplatedMixin, _WidgetsInTemplateMixin],{\r\n\ttemplateString: defPaneTemplate,\r\n\twidgetsInTemplate: true,\r\n\tdlg: null,\r\n\tpostMixInProperties: function(){\r\n\t\tthis.plugin = this.dlg.plugin;\r\n\t\tvar nls = this.plugin.nls;\r\n\t\tthis._addRuleBtnLabel = nls.addRuleButton;\r\n\t\tthis._cancelBtnLabel = nls.cancelButton;\r\n\t\tthis._clearBtnLabel = nls.clearButton;\r\n\t\tthis._filterBtnLabel = nls.filterButton;\r\n\t\tthis._relAll = nls.relationAll;\r\n\t\tthis._relAny = nls.relationAny;\r\n\t\tthis._relMsgFront = nls.relationMsgFront;\r\n\t\tthis._relMsgTail = nls.relationMsgTail;\r\n\t},\r\n\tpostCreate: function(){\r\n\t\tthis.inherited(arguments);\r\n\t\t// this.connect(this.domNode, \"onkeypress\", \"_onKey\");\r\n\t\ton(this.domNode, \"keydown\", lang.hitch(this, \"_onKey\"));\r\n\t\t\r\n\t\t(this.cboxContainer = new FilterAccordionContainer({\r\n\t\t\tnls: this.plugin.nls\r\n\t\t})).placeAt(this.criteriaPane);\r\n\t\t\r\n\t\tthis._relSelect.set(\"tabIndex\", _tabIdxes.relSelect);\r\n\t\tthis._addCBoxBtn.set(\"tabIndex\", _tabIdxes.addCBoxBtn);\r\n\t\tthis._cancelBtn.set(\"tabIndex\", _tabIdxes.cancelBtn);\r\n\t\tthis._clearFilterBtn.set(\"tabIndex\", _tabIdxes.clearBtn);\r\n\t\tthis._filterBtn.set(\"tabIndex\", _tabIdxes.filterBtn);\r\n\t\t\r\n\t\tvar nls = this.plugin.nls;\r\n\t\tthis._relSelect.domNode.setAttribute(\"aria-label\", nls.waiRelAll);\r\n\t\tthis._addCBoxBtn.domNode.setAttribute(\"aria-label\", nls.waiAddRuleButton);\r\n\t\tthis._cancelBtn.domNode.setAttribute(\"aria-label\", nls.waiCancelButton);\r\n\t\tthis._clearFilterBtn.domNode.setAttribute(\"aria-label\", nls.waiClearButton);\r\n\t\tthis._filterBtn.domNode.setAttribute(\"aria-label\", nls.waiFilterButton);\r\n\t\t\r\n\t\tthis._relSelect.set(\"value\", this.dlg._relOpCls === \"logicall\" ? \"0\" : \"1\");\r\n\t},\r\n\tuninitialize: function(){\r\n\t\tthis.cboxContainer.destroyRecursive();\r\n\t\tthis.plugin = null;\r\n\t\tthis.dlg = null;\r\n\t},\r\n\t_onRelSelectChange: function(val){\r\n\t\tthis.dlg._relOpCls = val == \"0\" ? \"logicall\" : \"logicany\";\r\n\t\tthis._relSelect.domNode.setAttribute(\"aria-label\", this.plugin.nls[val == \"0\" ? \"waiRelAll\" : \"waiRelAny\"]);\r\n\t},\r\n\t_onAddCBox: function(){\r\n\t\tthis.dlg.addCriteriaBoxes(1);\r\n\t},\r\n\t_onCancel: function(){\r\n\t\tthis.dlg.onCancel();\r\n\t},\r\n\t_onClearFilter: function(){\r\n\t\tthis.dlg.onClearFilter();\r\n\t},\r\n\t_onFilter: function(){\r\n\t\tthis.dlg.onFilter();\r\n\t},\r\n\t_onKey: function(e){\r\n\t\tif(e.keyCode == keys.ENTER){\r\n\t\t\tthis.dlg.onFilter();\r\n\t\t}\r\n\t}\r\n});\r\nvar CriteriaBox = declare(\"dojox.grid.enhanced.plugins.filter.CriteriaBox\",[_Widget, _TemplatedMixin, _WidgetsInTemplateMixin],{\r\n\ttemplateString: criteriaTemplate,\r\n\twidgetsInTemplate: true,\r\n\tdlg: null,\r\n\tpostMixInProperties: function(){\r\n\t\tthis.plugin = this.dlg.plugin;\r\n\t\tthis._curValueBox = null;\r\n\t\t\r\n\t\tvar nls = this.plugin.nls;\r\n\t\tthis._colSelectLabel = nls.columnSelectLabel;\r\n\t\tthis._condSelectLabel = nls.conditionSelectLabel;\r\n\t\tthis._valueBoxLabel = nls.valueBoxLabel;\r\n\t\tthis._anyColumnOption = nls.anyColumnOption;\r\n\t},\r\n\tpostCreate: function(){\r\n\t\tvar dlg = this.dlg, g = this.plugin.grid;\r\n\t\t//Select Column\r\n\t\tthis._colSelect.set(\"tabIndex\", _tabIdxes.colSelect);\r\n\t\tthis._colOptions = this._getColumnOptions();\r\n\t\tthis._colSelect.addOption([\r\n\t\t\t{label: this.plugin.nls.anyColumnOption, value: \"anycolumn\", selected: dlg.curColIdx < 0},\r\n\t\t\t{value: \"\"}\r\n\t\t].concat(this._colOptions));\r\n\t\t//Select Condition\r\n\t\tthis._condSelect.set(\"tabIndex\", _tabIdxes.condSelect);\r\n\t\tthis._condSelect.addOption(this._getUsableConditions(dlg.getColumnType(dlg.curColIdx)));\r\n\t\tthis._showSelectOrLabel(this._condSelect, this._condSelectAlt);\r\n\t\t\r\n\t\tthis.connect(g.layout, \"moveColumn\", \"onMoveColumn\");\r\n\t\tvar _this = this;\r\n\t\tsetTimeout(function(){\r\n\t\t\tvar type = dlg.getColumnType(dlg.curColIdx);\r\n\t\t\t_this._setValueBoxByType(type);\r\n\t\t}, 0);\r\n\t},\r\n\t_getColumnOptions: function(){\r\n\t\tvar colIdx = this.dlg.curColIdx >= 0 ? String(this.dlg.curColIdx) : \"anycolumn\";\r\n\t\treturn array.map(array.filter(this.plugin.grid.layout.cells, function(cell){\r\n\t\t\treturn !(cell.filterable === false || cell.hidden);\r\n\t\t}), function(cell){\r\n\t\t\treturn {\r\n\t\t\t\tlabel: cell.name || cell.field,\r\n\t\t\t\tvalue: String(cell.index),\r\n\t\t\t\tselected: colIdx == String(cell.index)\r\n\t\t\t};\r\n\t\t});\r\n\t},\r\n\tonMoveColumn: function(){\r\n\t\tvar tmp = this._onChangeColumn;\r\n\t\tthis._onChangeColumn = function(){};\r\n\t\tvar option = this._colSelect.get(\"selectedOptions\");\r\n\t\tthis._colSelect.removeOption(this._colOptions);\r\n\t\tthis._colOptions = this._getColumnOptions();\r\n\t\tthis._colSelect.addOption(this._colOptions);\r\n\t\tvar i = 0;\r\n\t\tfor(; i < this._colOptions.length; ++i){\r\n\t\t\tif(this._colOptions[i].label == option.label){\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(i < this._colOptions.length){\r\n\t\t\tthis._colSelect.set(\"value\", this._colOptions[i].value);\r\n\t\t}\r\n\t\tvar _this = this;\r\n\t\tsetTimeout(function(){\r\n\t\t\t_this._onChangeColumn = tmp;\r\n\t\t}, 0);\r\n\t},\r\n\tonRemove: function(){\r\n\t\tthis.dlg.removeCriteriaBoxes(this);\r\n\t},\r\n\tuninitialize: function(){\r\n\t\tif(this._curValueBox){\r\n\t\t\tthis._curValueBox.destroyRecursive();\r\n\t\t\tthis._curValueBox = null;\r\n\t\t}\r\n\t\tthis.plugin = null;\r\n\t\tthis.dlg = null;\r\n\t},\r\n\t_showSelectOrLabel: function(sel, alt){\r\n\t\tvar options = sel.getOptions();\r\n\t\tif(options.length == 1){\r\n\t\t\talt.innerHTML = options[0].label;\r\n\t\t\thtml.style(sel.domNode, \"display\", \"none\");\r\n\t\t\thtml.style(alt, \"display\", \"\");\r\n\t\t}else{\r\n\t\t\thtml.style(sel.domNode, \"display\", \"\");\r\n\t\t\thtml.style(alt, \"display\", \"none\");\r\n\t\t}\r\n\t},\r\n\t_onChangeColumn: function(val){\r\n\t\tthis._checkValidCriteria();\r\n\t\tvar type = this.dlg.getColumnType(val);\r\n\t\tthis._setConditionsByType(type);\r\n\t\tthis._setValueBoxByType(type);\r\n\t\tthis._updateValueBox();\r\n\t},\r\n\t_onChangeCondition: function(val){\r\n\t\tthis._checkValidCriteria();\r\n\t\tvar f = (val == \"range\");\r\n\t\tif(f ^ this._isRange){\r\n\t\t\tthis._isRange = f;\r\n\t\t\tthis._setValueBoxByType(this.dlg.getColumnType(this._colSelect.get(\"value\")));\r\n\t\t}\r\n\t\tthis._updateValueBox();\r\n\t},\r\n\t_updateValueBox: function(cond){\r\n\t\tthis._curValueBox.set(\"disabled\", this._condSelect.get(\"value\") == \"isempty\");\r\n\t},\r\n\t_checkValidCriteria: function(){\r\n\t\t// summary:\r\n\t\t//\t\tCheck whether the given criteria box is completed. If it is, mark it.\r\n\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\tthis.updateRuleTitle();\r\n\t\t\tthis.dlg._updatePane();\r\n\t\t}),0);\r\n\t},\r\n\t_createValueBox: function(/* widget constructor */cls,/* object */arg){\r\n\t\t// summary:\r\n\t\t//\t\tCreate a value input box with given class and arguments\r\n\t\tvar func = lang.hitch(arg.cbox, \"_checkValidCriteria\");\r\n\t\treturn new cls(lang.mixin(arg,{\r\n\t\t\ttabIndex: _tabIdxes.valueBox,\r\n\t\t\tonKeyPress: func,\r\n\t\t\tonChange: func,\r\n\t\t\t\"class\": \"dojoxGridFCBoxValueBox\"\r\n\t\t}));\r\n\t},\r\n\t_createRangeBox: function(/* widget constructor */cls,/* object */arg){\r\n\t\t// summary:\r\n\t\t//\t\tCreate a DIV containing 2 input widgets, which represents a range, with the given class and arguments\r\n\t\tvar func = lang.hitch(arg.cbox, \"_checkValidCriteria\");\r\n\t\tlang.mixin(arg,{\r\n\t\t\ttabIndex: _tabIdxes.valueBox,\r\n\t\t\tonKeyPress: func,\r\n\t\t\tonChange: func\r\n\t\t});\r\n\t\tvar div = html.create(\"div\", {\"class\": \"dojoxGridFCBoxValueBox\"}),\r\n\t\t\tstart = new cls(arg),\r\n\t\t\ttxt = html.create(\"span\", {\"class\": \"dojoxGridFCBoxRangeValueTxt\", \"innerHTML\": this.plugin.nls.rangeTo}),\r\n\t\t\tend = new cls(arg);\r\n\t\thtml.addClass(start.domNode, \"dojoxGridFCBoxStartValue\");\r\n\t\thtml.addClass(end.domNode, \"dojoxGridFCBoxEndValue\");\r\n\t\tdiv.appendChild(start.domNode);\r\n\t\tdiv.appendChild(txt);\r\n\t\tdiv.appendChild(end.domNode);\r\n\t\tdiv.domNode = div;\r\n\t\t//Mock functions for set and get (in place of the old attr function)\r\n\t\tdiv.set = function(dummy, args){\r\n\t\t\tif(lang.isObject(args)){\r\n\t\t\t\tstart.set(\"value\", args.start);\r\n\t\t\t\tend.set(\"value\", args.end);\r\n\t\t\t}\r\n\t\t};\r\n\t\tdiv.get = function(){\r\n\t\t\tvar s = start.get(\"value\"),\r\n\t\t\t\te = end.get(\"value\");\r\n\t\t\treturn s && e ? {start: s, end: e} : \"\";\r\n\t\t};\r\n\t\treturn div;\r\n\t},\r\n\tchangeCurrentColumn: function(/* bool */selectCurCol){\r\n\t\tvar colIdx = this.dlg.curColIdx;\r\n\t\t//Re-populate the columns in case some of them are set to hidden.\r\n\t\tthis._colSelect.removeOption(this._colOptions);\r\n\t\tthis._colOptions = this._getColumnOptions();\r\n\t\tthis._colSelect.addOption(this._colOptions);\r\n\t\tthis._colSelect.set('value', colIdx >= 0 ? String(colIdx) : \"anycolumn\");\r\n\t\tthis.updateRuleTitle(true);\r\n\t},\r\n\tcurColumn: function(){\r\n\t\treturn this._colSelect.getOptions(this._colSelect.get(\"value\")).label;\r\n\t},\r\n\tcurCondition: function(){\r\n\t\treturn this._condSelect.getOptions(this._condSelect.get(\"value\")).label;\r\n\t},\r\n\tcurValue: function(){\r\n\t\tvar cond = this._condSelect.get(\"value\");\r\n\t\tif(cond == \"isempty\"){return \"\";}\r\n\t\treturn this._curValueBox ? this._curValueBox.get(\"value\") : \"\";\r\n\t},\r\n\tsave: function(){\r\n\t\tif(this.isEmpty()){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar colIdx = this._colSelect.get(\"value\"),\r\n\t\t\ttype = this.dlg.getColumnType(colIdx),\r\n\t\t\tvalue = this.curValue(),\r\n\t\t\tcond = this._condSelect.get(\"value\");\r\n\t\treturn {\r\n\t\t\t\"column\": colIdx,\r\n\t\t\t\"condition\": cond,\r\n\t\t\t\"value\": value,\r\n\t\t\t\"formattedVal\": this.formatValue(type, cond, value),\r\n\t\t\t\"type\": type,\r\n\t\t\t\"colTxt\": this.curColumn(),\r\n\t\t\t\"condTxt\": this.curCondition()\r\n\t\t};\r\n\t},\r\n\tload: function(obj){\r\n\t\tvar tmp = [\r\n\t\t\tthis._onChangeColumn,\r\n\t\t\tthis._onChangeCondition\r\n\t\t];\r\n\t\tthis._onChangeColumn = this._onChangeCondition = function(){};\r\n\t\tif(obj.column){\r\n\t\t\tthis._colSelect.set(\"value\", obj.column);\r\n\t\t}\r\n\t\tif(obj.type){\r\n\t\t\tthis._setConditionsByType(obj.type);\r\n\t\t\tthis._setValueBoxByType(obj.type);\r\n\t\t}else{\r\n\t\t\tobj.type = this.dlg.getColumnType(this._colSelect.get(\"value\"));\r\n\t\t}\r\n\t\tif(obj.condition){\r\n\t\t\tthis._condSelect.set(\"value\", obj.condition);\r\n\t\t}\r\n\t\tvar value = obj.value || \"\";\r\n\t\tif(value || (obj.type != \"date\" && obj.type != \"time\")){\r\n\t\t\tthis._curValueBox.set(\"value\", value);\r\n\t\t}\r\n\t\tthis._updateValueBox();\r\n\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\tthis._onChangeColumn = tmp[0];\r\n\t\t\tthis._onChangeCondition = tmp[1];\r\n\t\t}), 0);\r\n\t},\r\n\tgetExpr: function(){\r\n\t\tif(this.isEmpty()){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar colval = this._colSelect.get(\"value\");\r\n\t\treturn this.dlg.getExprForCriteria({\r\n\t\t\t\"type\": this.dlg.getColumnType(colval),\r\n\t\t\t\"column\": colval,\r\n\t\t\t\"condition\": this._condSelect.get(\"value\"),\r\n\t\t\t\"value\": this.curValue()\r\n\t\t});\r\n\t},\r\n\tisEmpty: function(){\r\n\t\tvar cond = this._condSelect.get(\"value\");\r\n\t\tif(cond == \"isempty\"){return false;}\r\n\t\tvar v = this.curValue();\r\n\t\treturn v === \"\" || v === null || typeof v == \"undefined\" || (typeof v == \"number\" && isNaN(v));\r\n\t},\r\n\tupdateRuleTitle: function(isEmpty){\r\n\t\tvar node = this._pane._buttonWidget.titleTextNode;\r\n\t\tvar title = [\r\n\t\t\t\"<div class='dojoxEllipsis'>\"\r\n\t\t];\r\n\t\tif(isEmpty || this.isEmpty()){\r\n\t\t\tnode.title = string.substitute(this.plugin.nls.ruleTitleTemplate, [this._ruleIndex || 1]);\r\n\t\t\ttitle.push(node.title);\r\n\t\t}else{\r\n\t\t\tvar type = this.dlg.getColumnType(this._colSelect.get(\"value\"));\r\n\t\t\tvar column = this.curColumn();\r\n\t\t\tvar condition = this.curCondition();\r\n\t\t\tvar value = this.formatValue(type, this._condSelect.get(\"value\"), this.curValue());\r\n\t\t\ttitle.push(\r\n\t\t\t\tcolumn,\r\n\t\t\t\t\"&nbsp;<span class='dojoxGridRuleTitleCondition'>\",\r\n\t\t\t\tcondition,\r\n\t\t\t\t\"</span>&nbsp;\",\r\n\t\t\t\tvalue\r\n\t\t\t);\r\n\t\t\tnode.title = [column, \" \", condition, \" \", value].join('');\r\n\t\t}\r\n\t\tnode.innerHTML = title.join('');\r\n\t\tif(has('mozilla')){\r\n\t\t\tvar tt = html.create(\"div\", {\r\n\t\t\t\t\"style\": \"width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 9999;\"\r\n\t\t\t}, node);\r\n\t\t\ttt.title = node.title;\r\n\t\t}\r\n\t},\r\n\tupdateRuleIndex: function(index){\r\n\t\tif(this._ruleIndex != index){\r\n\t\t\tthis._ruleIndex = index;\r\n\t\t\tif(this.isEmpty()){\r\n\t\t\t\tthis.updateRuleTitle();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tsetAriaInfo: function(idx){\r\n\t\tvar dss = string.substitute, nls = this.plugin.nls;\r\n\t\tthis._colSelect.domNode.setAttribute(\"aria-label\", dss(nls.waiColumnSelectTemplate, [idx]));\r\n\t\tthis._condSelect.domNode.setAttribute(\"aria-label\", dss(nls.waiConditionSelectTemplate, [idx]));\r\n\t\tthis._pane._removeCBoxBtn.domNode.setAttribute(\"aria-label\", dss(nls.waiRemoveRuleButtonTemplate, [idx]));\r\n\t\tthis._index = idx;\r\n\t},\r\n\t_getUsableConditions: function(type){\r\n\t\tvar conditions = lang.clone(this.dlg._dataTypeMap[type].conditions);\r\n\t\tvar typeDisabledConds = (this.plugin.args.disabledConditions || {})[type];\r\n\t\tvar colIdx = parseInt(this._colSelect.get(\"value\"), 10);\r\n\t\tvar colDisabledConds = isNaN(colIdx) ?\r\n\t\t\t(this.plugin.args.disabledConditions || {})[\"anycolumn\"] :\r\n\t\t\tthis.plugin.grid.layout.cells[colIdx].disabledConditions;\r\n\t\tif(!lang.isArray(typeDisabledConds)){\r\n\t\t\ttypeDisabledConds = [];\r\n\t\t}\r\n\t\tif(!lang.isArray(colDisabledConds)){\r\n\t\t\tcolDisabledConds = [];\r\n\t\t}\r\n\t\tvar arr = typeDisabledConds.concat(colDisabledConds);\r\n\t\tif(arr.length){\r\n\t\t\tvar disabledConds = {};\r\n\t\t\tarray.forEach(arr, function(c){\r\n\t\t\t\tif(lang.isString(c)){\r\n\t\t\t\t\tdisabledConds[c.toLowerCase()] = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn array.filter(conditions, function(condOption){\r\n\t\t\t\treturn !(condOption.value in disabledConds);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn conditions;\r\n\t},\r\n\t_setConditionsByType: function(/* string */type){\r\n\t\tvar condSelect = this._condSelect;\r\n\t\tcondSelect.removeOption(condSelect.options);\r\n\t\tcondSelect.addOption(this._getUsableConditions(type));\r\n\t\tthis._showSelectOrLabel(this._condSelect, this._condSelectAlt);\r\n\t},\r\n\t_setValueBoxByType: function(/* string */type){\r\n\t\tif(this._curValueBox){\r\n\t\t\tthis.valueNode.removeChild(this._curValueBox.domNode);\r\n\t\t\ttry{\r\n\t\t\t\tthis._curValueBox.destroyRecursive();\r\n\t\t\t}catch(e){}\r\n\t\t\tdelete this._curValueBox;\r\n\t\t}\r\n\t\t//value box class\r\n\t\tvar vbcls = this.dlg._dataTypeMap[type].valueBoxCls[this._getValueBoxClsInfo(this._colSelect.get(\"value\"), type)],\r\n\t\t\tvboxArg = this._getValueBoxArgByType(type);\r\n\t\tthis._curValueBox = this[this._isRange ? \"_createRangeBox\" : \"_createValueBox\"](vbcls, vboxArg);\r\n\t\tthis.valueNode.appendChild(this._curValueBox.domNode);\r\n\t\t\r\n\t\t//Can not move to setAriaInfo, 'cause the value box is created after the defpane is loaded.\r\n\t\tthis._curValueBox.focusNode.setAttribute(\"aria-label\", string.substitute(this.plugin.nls.waiValueBoxTemplate,[this._index]));\r\n\t\t//Now our cbox is completely ready\r\n\t\tthis.dlg.onRendered(this);\r\n\t},\r\n\t//--------------------------UI Configuration--------------------------------------\r\n\t_getValueBoxArgByType: function(/* string */type){\r\n\t\t// summary:\r\n\t\t//\t\tGet the arguments for the value box construction.\r\n\t\tvar g = this.plugin.grid,\r\n\t\t\tcell = g.layout.cells[parseInt(this._colSelect.get(\"value\"), 10)],\r\n\t\t\tres = {\r\n\t\t\t\tcbox: this\r\n\t\t\t};\r\n\t\tif(type == \"string\"){\r\n\t\t\tif(cell && (cell.suggestion || cell.autoComplete)){\r\n\t\t\t\tlang.mixin(res, {\r\n\t\t\t\t\tstore: g.store,\r\n\t\t\t\t\tsearchAttr: cell.field || cell.name,\r\n\t\t\t\t\tquery: g.query || {},\r\n\t\t\t\t\tfetchProperties: {\r\n\t\t\t\t\t\tsort: [{\"attribute\": cell.field || cell.name}],\r\n\t\t\t\t\t\tqueryOptions: lang.mixin({\r\n\t\t\t\t\t\t\tignoreCase: true,\r\n\t\t\t\t\t\t\tdeep: true\r\n\t\t\t\t\t\t}, g.queryOptions || {})\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}else if(type == \"boolean\"){\r\n\t\t\tlang.mixin(res, this.dlg.builder.defaultArgs[\"boolean\"]);\r\n\t\t}\r\n\t\tif(cell && cell.dataTypeArgs){\r\n\t\t\tlang.mixin(res, cell.dataTypeArgs);\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\tformatValue: function(type, cond, v){\r\n\t\t// summary:\r\n\t\t//\t\tFormat the value to be shown in tooltip.\r\n\t\tif(cond == \"isempty\"){return \"\";}\r\n\t\tif(type == \"date\" || type == \"time\"){\r\n\t\t\tvar opt = {selector: type},\r\n\t\t\t\tfmt = dateLocale.format;\r\n\t\t\tif(cond == \"range\"){\r\n\t\t\t\treturn string.substitute(this.plugin.nls.rangeTemplate, [fmt(v.start, opt), fmt(v.end, opt)]);\r\n\t\t\t}\r\n\t\t\treturn fmt(v, opt);\r\n\t\t}else if(type == \"boolean\"){\r\n\t\t\treturn v ? this._curValueBox._lblTrue : this._curValueBox._lblFalse;\r\n\t\t}\r\n\t\treturn v;\r\n\t},\r\n\t_getValueBoxClsInfo: function(/* int|string */colIndex, /* string */type){\r\n\t\t// summary:\r\n\t\t//\t\tDecide which value box to use given data type and column index.\r\n\t\tvar cell = this.plugin.grid.layout.cells[parseInt(colIndex, 10)];\r\n\t\t//Now we only need to handle string. But maybe we need to handle more types here in the future.\r\n\t\tif(type == \"string\"){\r\n\t\t\treturn (cell && (cell.suggestion || cell.autoComplete)) ? \"ac\" : \"dft\";\r\n\t\t}\r\n\t\treturn \"dft\";\r\n\t}\r\n});\r\n\r\n\r\nvar UniqueComboBox = declare(\"dojox.grid.enhanced.plugins.filter.UniqueComboBox\", ComboBox, {\r\n\t_openResultList: function(results){\r\n\t\tvar cache = {}, s = this.store, colName = this.searchAttr;\r\n\t\targuments[0] = array.filter(results, function(item){\r\n\t\t\tvar key = s.getValue(item, colName), existed = cache[key];\r\n\t\t\tcache[key] = true;\r\n\t\t\treturn !existed;\r\n\t\t});\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\t_onKey: function(evt){\r\n\t\tif(evt.charOrCode === keys.ENTER && this._opened){\r\n\t\t\tevent.stop(evt);\r\n\t\t}\r\n\t\tthis.inherited(arguments);\r\n\t}\r\n});\r\nvar BooleanValueBox = declare(\"dojox.grid.enhanced.plugins.filter.BooleanValueBox\", [_Widget, _TemplatedMixin, _WidgetsInTemplateMixin], {\r\n\ttemplateString: boolValueTemplate,\r\n\twidgetsInTemplate: true,\r\n\tconstructor: function(args){\r\n\t\tvar nls = args.cbox.plugin.nls;\r\n\t\tthis._baseId = args.cbox.id;\r\n\t\tthis._lblTrue = args.trueLabel || nls.trueLabel || \"true\";\r\n\t\tthis._lblFalse = args.falseLabel || nls.falseLabel || \"false\";\r\n\t\tthis.args = args;\r\n\t},\r\n\tpostCreate: function(){\r\n\t\tthis.onChange();\r\n\t},\r\n\tonChange: function(){},\r\n\t\r\n\tget: function(prop){\r\n\t\treturn this.rbTrue.get(\"checked\");\r\n\t},\r\n\tset: function(prop, v){\r\n\t\tthis.inherited(arguments);\r\n\t\tif(prop == \"value\"){\r\n\t\t\tthis.rbTrue.set(\"checked\", !!v);\r\n\t\t\tthis.rbFalse.set(\"checked\", !v);\r\n\t\t}\r\n\t}\r\n});\r\nvar FilterDefDialog = declare(\"dojox.grid.enhanced.plugins.filter.FilterDefDialog\", null, {\r\n\t// summary:\r\n\t//\t\tCreate the filter definition UI.\r\n\tcurColIdx: -1,\r\n\t_relOpCls: \"logicall\",\r\n\t_savedCriterias: null,\r\n\tplugin: null,\r\n\tconstructor: function(args){\r\n\t\tvar plugin = this.plugin = args.plugin;\r\n\t\tthis.builder = new FilterBuilder();\r\n\t\tthis._setupData();\r\n\t\tthis._cboxes = [];\r\n\t\tthis.defaultType = plugin.args.defaultType || \"string\";\r\n\t\t\r\n\t\t(this.filterDefPane = new FilterDefPane({\r\n\t\t\t\"dlg\": this\r\n\t\t})).startup();\r\n\t\t(this._defPane = new Dialog({\r\n\t\t\t\"refNode\": this.plugin.grid.domNode,\r\n\t\t\t\"title\": plugin.nls.filterDefDialogTitle,\r\n\t\t\t\"class\": \"dojoxGridFDTitlePane\",\r\n\t\t\t\"iconClass\": \"dojoxGridFDPaneIcon\",\r\n\t\t\t\"content\": this.filterDefPane\r\n\t\t})).startup();\r\n\t\t\r\n\t\tthis._defPane.connect(plugin.grid.layer('filter'), \"filterDef\", lang.hitch(this, \"_onSetFilter\"));\r\n\t\tplugin.grid.setFilter = lang.hitch(this, \"setFilter\");\r\n\t\tplugin.grid.getFilter = lang.hitch(this, \"getFilter\");\r\n\t\tplugin.grid.getFilterRelation = lang.hitch(this, function(){\r\n\t\t\treturn this._relOpCls;\r\n\t\t});\r\n\t\t\r\n\t\tplugin.connect(plugin.grid.layout, \"moveColumn\", lang.hitch(this, \"onMoveColumn\"));\r\n\t},\r\n\tonMoveColumn: function(sourceViewIndex, destViewIndex, cellIndex, targetIndex, before){\r\n\t\tif(this._savedCriterias && cellIndex != targetIndex){\r\n\t\t\tif(before){ --targetIndex; }\r\n\t\t\tvar min = cellIndex < targetIndex ? cellIndex : targetIndex;\r\n\t\t\tvar max = cellIndex < targetIndex ? targetIndex : cellIndex;\r\n\t\t\tvar dir = targetIndex > min ? 1 : -1;\r\n\t\t\tarray.forEach(this._savedCriterias, function(sc){\r\n\t\t\t\tvar idx = parseInt(sc.column, 10);\r\n\t\t\t\tif(!isNaN(idx) && idx >= min && idx <= max){\r\n\t\t\t\t\tsc.column = String(idx == cellIndex ? idx + (max - min) * dir : idx - dir);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tdestroy: function(){\r\n\t\tthis._defPane.destroyRecursive();\r\n\t\tthis._defPane = null;\r\n\t\tthis.filterDefPane = null;\r\n\t\tthis.builder = null;\r\n\t\tthis._dataTypeMap = null;\r\n\t\tthis._cboxes = null;\r\n\t\tvar g = this.plugin.grid;\r\n\t\tg.setFilter = null;\r\n\t\tg.getFilter = null;\r\n\t\tg.getFilterRelation = null;\r\n\t\tthis.plugin = null;\r\n\t},\r\n\t_setupData: function(){\r\n\t\tvar nls = this.plugin.nls;\r\n\t\tthis._dataTypeMap = {\r\n\t\t// summary:\r\n\t\t//\t\tAll supported data types\r\n\t\t\t\"number\":{\r\n\t\t\t\tvalueBoxCls: {\r\n\t\t\t\t\tdft: NumberTextBox\r\n\t\t\t\t},\r\n\t\t\t\tconditions:[\r\n\t\t\t\t\t{label: nls.conditionEqual, value: \"equalto\", selected: true},\r\n\t\t\t\t\t{label: nls.conditionNotEqual, value: \"notequalto\"},\r\n\t\t\t\t\t{label: nls.conditionLess, value: \"lessthan\"},\r\n\t\t\t\t\t{label: nls.conditionLessEqual, value: \"lessthanorequalto\"},\r\n\t\t\t\t\t{label: nls.conditionLarger, value: \"largerthan\"},\r\n\t\t\t\t\t{label: nls.conditionLargerEqual, value: \"largerthanorequalto\"},\r\n\t\t\t\t\t{label: nls.conditionIsEmpty, value: \"isempty\"}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"string\":{\r\n\t\t\t\tvalueBoxCls: {\r\n\t\t\t\t\tdft: TextBox,\r\n\t\t\t\t\tac: UniqueComboBox\t\t//For autoComplete\r\n\t\t\t\t},\r\n\t\t\t\tconditions:[\r\n\t\t\t\t\t{label: nls.conditionContains, value: \"contains\", selected: true},\r\n\t\t\t\t\t{label: nls.conditionIs, value: \"equalto\"},\r\n\t\t\t\t\t{label: nls.conditionStartsWith, value: \"startswith\"},\r\n\t\t\t\t\t{label: nls.conditionEndWith, value: \"endswith\"},\r\n\t\t\t\t\t{label: nls.conditionNotContain, value: \"notcontains\"},\r\n\t\t\t\t\t{label: nls.conditionIsNot, value: \"notequalto\"},\r\n\t\t\t\t\t{label: nls.conditionNotStartWith, value: \"notstartswith\"},\r\n\t\t\t\t\t{label: nls.conditionNotEndWith, value: \"notendswith\"},\r\n\t\t\t\t\t{label: nls.conditionIsEmpty, value: \"isempty\"}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"date\":{\r\n\t\t\t\tvalueBoxCls: {\r\n\t\t\t\t\tdft: DateTextBox\r\n\t\t\t\t},\r\n\t\t\t\tconditions:[\r\n\t\t\t\t\t{label: nls.conditionIs, value: \"equalto\", selected: true},\r\n\t\t\t\t\t{label: nls.conditionBefore, value: \"lessthan\"},\r\n\t\t\t\t\t{label: nls.conditionAfter, value: \"largerthan\"},\r\n\t\t\t\t\t{label: nls.conditionRange, value: \"range\"},\r\n\t\t\t\t\t{label: nls.conditionIsEmpty, value: \"isempty\"}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"time\":{\r\n\t\t\t\tvalueBoxCls: {\r\n\t\t\t\t\tdft: TimeTextBox\r\n\t\t\t\t},\r\n\t\t\t\tconditions:[\r\n\t\t\t\t\t{label: nls.conditionIs, value: \"equalto\", selected: true},\r\n\t\t\t\t\t{label: nls.conditionBefore, value: \"lessthan\"},\r\n\t\t\t\t\t{label: nls.conditionAfter, value: \"largerthan\"},\r\n\t\t\t\t\t{label: nls.conditionRange, value: \"range\"},\r\n\t\t\t\t\t{label: nls.conditionIsEmpty, value: \"isempty\"}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"boolean\": {\r\n\t\t\t\tvalueBoxCls: {\r\n\t\t\t\t\tdft: BooleanValueBox\r\n\t\t\t\t},\r\n\t\t\t\tconditions: [\r\n\t\t\t\t\t{label: nls.conditionIs, value: \"equalto\", selected: true},\r\n\t\t\t\t\t{label: nls.conditionIsEmpty, value: \"isempty\"}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tsetFilter: function(rules, ruleRelation){\r\n\t\trules = rules || [];\r\n\t\tif(!lang.isArray(rules)){\r\n\t\t\trules = [rules];\r\n\t\t}\r\n\t\tvar func = function(){\r\n\t\t\tif(rules.length){\r\n\t\t\t\tthis._savedCriterias = array.map(rules, function(rule){\r\n\t\t\t\t\tvar type = rule.type || this.defaultType;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\"type\": type,\r\n\t\t\t\t\t\t\"column\": String(rule.column),\r\n\t\t\t\t\t\t\"condition\": rule.condition,\r\n\t\t\t\t\t\t\"value\": rule.value,\r\n\t\t\t\t\t\t\"colTxt\": this.getColumnLabelByValue(String(rule.column)),\r\n\t\t\t\t\t\t\"condTxt\": this.getConditionLabelByValue(type, rule.condition),\r\n\t\t\t\t\t\t\"formattedVal\": rule.formattedVal || rule.value\r\n\t\t\t\t\t};\r\n\t\t\t\t}, this);\r\n\t\t\t\tthis._criteriasChanged = true;\r\n\t\t\t\tif(ruleRelation === \"logicall\" || ruleRelation === \"logicany\"){\r\n\t\t\t\t\tthis._relOpCls = ruleRelation;\r\n\t\t\t\t}\r\n\t\t\t\tvar exprs = array.map(rules, this.getExprForCriteria, this);\r\n\t\t\t\texprs = this.builder.buildExpression(exprs.length == 1 ? exprs[0] : {\r\n\t\t\t\t\t\"op\": this._relOpCls,\r\n\t\t\t\t\t\"data\": exprs\r\n\t\t\t\t});\r\n\t\t\t\tthis.plugin.grid.layer(\"filter\").filterDef(exprs);\r\n\t\t\t\tthis.plugin.filterBar.toggleClearFilterBtn(false);\r\n\t\t\t}\r\n\t\t\tthis._closeDlgAndUpdateGrid();\r\n\t\t};\r\n\t\tif(this._savedCriterias){\r\n\t\t\tthis._clearWithoutRefresh = true;\r\n\t\t\tvar handle = connect.connect(this, \"clearFilter\", this, function(){\r\n\t\t\t\tconnect.disconnect(handle);\r\n\t\t\t\tthis._clearWithoutRefresh = false;\r\n\t\t\t\tfunc.apply(this);\r\n\t\t\t});\r\n\t\t\tthis.onClearFilter();\r\n\t\t}else{\r\n\t\t\tfunc.apply(this);\r\n\t\t}\r\n\t},\r\n\tgetFilter: function(){\r\n\t\treturn lang.clone(this._savedCriterias) || [];\r\n\t},\r\n\tgetColumnLabelByValue: function(v){\r\n\t\tvar nls = this.plugin.nls;\r\n\t\tif(v.toLowerCase() == \"anycolumn\"){\r\n\t\t\treturn nls[\"anyColumnOption\"];\r\n\t\t}else{\r\n\t\t\tvar cell = this.plugin.grid.layout.cells[parseInt(v, 10)];\r\n\t\t\treturn cell ? (cell.name || cell.field) : \"\";\r\n\t\t}\r\n\t},\r\n\tgetConditionLabelByValue: function(type, c){\r\n\t\tvar conditions = this._dataTypeMap[type].conditions;\r\n\t\tfor(var i = conditions.length - 1; i >= 0; --i){\r\n\t\t\tvar cond = conditions[i];\r\n\t\t\tif(cond.value == c.toLowerCase()){\r\n\t\t\t\treturn cond.label;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t},\r\n\taddCriteriaBoxes: function(/* int */cnt){\r\n\t\t// summary:\r\n\t\t//\t\tAdd *cnt* criteria boxes to the filter definition pane.\r\n\t\t//\t\tCheck overflow if necessary.\r\n\t\tif(typeof cnt != \"number\" || cnt <= 0){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar cbs = this._cboxes,\r\n\t\t\tcc = this.filterDefPane.cboxContainer,\r\n\t\t\ttotal = this.plugin.args.ruleCount,\r\n\t\t\tlen = cbs.length, cbox;\r\n\t\t//If overflow, add to max rule count.\r\n\t\tif(total > 0 && len + cnt > total){\r\n\t\t\tcnt = total - len;\r\n\t\t}\r\n\t\tfor(; cnt > 0; --cnt){\r\n\t\t\tcbox = new CriteriaBox({\r\n\t\t\t\tdlg: this\r\n\t\t\t});\r\n\t\t\tcbs.push(cbox);\r\n\t\t\tcc.addChild(cbox);\r\n\t\t}\r\n\t\t//If there's no content box in it , AccordionContainer can not startup\r\n\t\tcc.startup();\r\n\t\tthis._updatePane();\r\n\t\tthis._updateCBoxTitles();\r\n\t\tcc.selectChild(cbs[cbs.length-1]);\r\n\t\t//Asign an impossibly large scrollTop to scroll the criteria pane to the bottom.\r\n\t\tthis.filterDefPane.criteriaPane.scrollTop = 1000000;\r\n\t\tif(cbs.length === 4){\r\n\t\t\tif(has('ie') <= 6 && !this.__alreadyResizedForIE6){\r\n\t\t\t\tvar size = html.position(cc.domNode);\r\n\t\t\t\tsize.w -= metrics.getScrollbar().w;\r\n\t\t\t\tcc.resize(size);\r\n\t\t\t\tthis.__alreadyResizedForIE6 = true;\r\n\t\t\t}else{\r\n\t\t\t\tcc.resize();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tremoveCriteriaBoxes: function(/* int|CriteriaBox|int[] */cnt,/* bool? */isIdx){\r\n\t\t// summary:\r\n\t\t//\t\tRemove criteria boxes from the filter definition pane.\r\n\t\tvar cbs = this._cboxes, cc = this.filterDefPane.cboxContainer,\r\n\t\t\tlen = cbs.length, start = len - cnt,\r\n\t\t\tend = len - 1, cbox,\r\n\t\t\tcurIdx = array.indexOf(cbs, cc.selectedChildWidget.content);\r\n\t\tif(lang.isArray(cnt)){\r\n\t\t\tvar i, idxes = cnt;\r\n\t\t\tidxes.sort();\r\n\t\t\tcnt = idxes.length;\r\n\t\t\t//find a rule that's not deleted.\r\n\t\t\t//must find and focus the last one, or the hack will not work.\r\n\t\t\tfor(i = len - 1; i >= 0 && array.indexOf(idxes, i) >= 0; --i){}\r\n\t\t\tif(i >= 0){\r\n\t\t\t\t//must select before remove\r\n\t\t\t\tif(i != curIdx){\r\n\t\t\t\t\tcc.selectChild(cbs[i]);\r\n\t\t\t\t}\r\n\t\t\t\t//idxes is sorted from small to large,\r\n\t\t\t\t//so travel reversely won't need change index after delete from array.\r\n\t\t\t\tfor(i = cnt-1; i >= 0; --i){\r\n\t\t\t\t\tif(idxes[i] >= 0 && idxes[i] < len){\r\n\t\t\t\t\t\tcc.removeChild(cbs[idxes[i]]);\r\n\t\t\t\t\t\tcbs.splice(idxes[i],1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstart = cbs.length;\r\n\t\t}else{\r\n\t\t\tif(isIdx === true){\r\n\t\t\t\tif(cnt >= 0 && cnt < len){\r\n\t\t\t\t\tstart = end = cnt;\r\n\t\t\t\t\tcnt = 1;\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif(cnt instanceof CriteriaBox){\r\n\t\t\t\t\tcbox = cnt;\r\n\t\t\t\t\tcnt = 1;\r\n\t\t\t\t\tstart = end = array.indexOf(cbs, cbox);\r\n\t\t\t\t}else if(typeof cnt != \"number\" || cnt <= 0){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}else if(cnt >= len){\r\n\t\t\t\t\tcnt = end;\r\n\t\t\t\t\tstart = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(end < start){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//must select before remove\r\n\t\t\tif(curIdx >= start && curIdx <= end){\r\n\t\t\t\tcc.selectChild(cbs[start ? start-1 : end+1]);\r\n\t\t\t}\r\n\t\t\tfor(; end >= start; --end){\r\n\t\t\t\tcc.removeChild(cbs[end]);\r\n\t\t\t}\r\n\t\t\tcbs.splice(start, cnt);\r\n\t\t}\r\n\t\tthis._updatePane();\r\n\t\tthis._updateCBoxTitles();\r\n\t\tif(cbs.length === 3){\r\n\t\t\t//In ie6, resize back to the normal width will cause the title button look strange.\r\n\t\t\tcc.resize();\r\n\t\t}\r\n\t},\r\n\tgetCriteria: function(/* int */idx){\r\n\t\t// summary:\r\n\t\t//\t\tGet the *idx*-th criteria.\r\n\t\tif(typeof idx != \"number\"){\r\n\t\t\treturn this._savedCriterias ? this._savedCriterias.length : 0;\r\n\t\t}\r\n\t\tif(this._savedCriterias && this._savedCriterias[idx]){\r\n\t\t\treturn lang.mixin({\r\n\t\t\t\trelation: this._relOpCls == \"logicall\" ? this.plugin.nls.and : this.plugin.nls.or\r\n\t\t\t},this._savedCriterias[idx]);\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\tgetExprForCriteria: function(rule){\r\n\t\tif(rule.column == \"anycolumn\"){\r\n\t\t\tvar cells = array.filter(this.plugin.grid.layout.cells, function(cell){\r\n\t\t\t\treturn !(cell.filterable === false || cell.hidden);\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\t\"op\": \"logicany\",\r\n\t\t\t\t\"data\": array.map(cells, function(cell){\r\n\t\t\t\t\treturn this.getExprForColumn(rule.value, cell.index, rule.type, rule.condition);\r\n\t\t\t\t}, this)\r\n\t\t\t};\r\n\t\t}else{\r\n\t\t\treturn this.getExprForColumn(rule.value, rule.column, rule.type, rule.condition);\r\n\t\t}\r\n\t},\r\n\tgetExprForColumn: function(value, colIdx, type, condition){\r\n\t\tcolIdx = parseInt(colIdx, 10);\r\n\t\tvar cell = this.plugin.grid.layout.cells[colIdx],\r\n\t\t\tcolName = cell.field || cell.name,\r\n\t\t\tobj = {\r\n\t\t\t\t\"datatype\": type || this.getColumnType(colIdx),\r\n\t\t\t\t\"args\": cell.dataTypeArgs,\r\n\t\t\t\t\"isColumn\": true\r\n\t\t\t},\r\n\t\t\toperands = [lang.mixin({\"data\": this.plugin.args.isServerSide ? colName : cell}, obj)];\r\n\t\tobj.isColumn = false;\r\n\t\tif(condition == \"range\"){\r\n\t\t\toperands.push(lang.mixin({\"data\": value.start}, obj),\r\n\t\t\t\tlang.mixin({\"data\": value.end}, obj));\r\n\t\t}else if(condition != \"isempty\"){\r\n\t\t\toperands.push(lang.mixin({\"data\": value}, obj));\r\n\t\t}\r\n\t\treturn {\r\n\t\t\t\"op\": condition,\r\n\t\t\t\"data\": operands\r\n\t\t};\r\n\t},\r\n\tgetColumnType: function(/* int */colIndex){\r\n\t\tvar cell = this.plugin.grid.layout.cells[parseInt(colIndex, 10)];\r\n\t\tif(!cell || !cell.datatype){\r\n\t\t\treturn this.defaultType;\r\n\t\t}\r\n\t\tvar type = String(cell.datatype).toLowerCase();\r\n\t\treturn this._dataTypeMap[type] ? type : this.defaultType;\r\n\t},\r\n\t//////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\tclearFilter: function(noRefresh){\r\n\t\t// summary:\r\n\t\t//\t\tClear filter definition.\r\n\t\tif(!this._savedCriterias){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._savedCriterias = null;\r\n\t\tthis.plugin.grid.layer(\"filter\").filterDef(null);\r\n\t\ttry{\r\n\t\t\tthis.plugin.filterBar.toggleClearFilterBtn(true);\r\n\t\t\tthis.filterDefPane._clearFilterBtn.set(\"disabled\", true);\r\n\t\t\tthis.removeCriteriaBoxes(this._cboxes.length-1);\r\n\t\t\tthis._cboxes[0].load({});\r\n\t\t}catch(e){\r\n\t\t\t//Any error means the filter is defined outside this plugin.\r\n\t\t}\r\n\t\tif(noRefresh){\r\n\t\t\tthis.closeDialog();\r\n\t\t}else{\r\n\t\t\tthis._closeDlgAndUpdateGrid();\r\n\t\t}\r\n\t},\r\n\tshowDialog: function(/* int */colIndex){\r\n\t\t// summary:\r\n\t\t//\t\tShow the filter definition dialog.\r\n\t\tthis._defPane.show();\r\n\t\tthis.plugin.filterStatusTip.closeDialog();\r\n\t\tthis._prepareDialog(colIndex);\r\n\t},\r\n\tcloseDialog: function(){\r\n\t\t// summary:\r\n\t\t//\t\tClose the filter definition dialog.\r\n\t\tif(this._defPane.open){\r\n\t\t\tthis._defPane.hide();\r\n\t\t}\r\n\t},\r\n\tonFilter: function(e){\r\n\t\t// summary:\r\n\t\t//\t\tTriggered when the \"Filter\" button is clicked.\r\n\t\tif(this.canFilter()){\r\n\t\t\tthis._defineFilter();\r\n\t\t\tthis._closeDlgAndUpdateGrid();\r\n\t\t\tthis.plugin.filterBar.toggleClearFilterBtn(false);\r\n\t\t}\r\n\t},\r\n\tonClearFilter: function(e){\r\n\t\t// summary:\r\n\t\t//\t\tTriggered when the \"Clear\" button is clicked.\r\n\t\tif(this._savedCriterias){\r\n\t\t\tif(this._savedCriterias.length >= this.plugin.ruleCountToConfirmClearFilter){\r\n\t\t\t\tthis.plugin.clearFilterDialog.show();\r\n\t\t\t}else{\r\n\t\t\t\tthis.clearFilter(this._clearWithoutRefresh);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tonCancel: function(e){\r\n\t\t// summary:\r\n\t\t//\t\tTriggered when the \"Cancel\" buttton is clicked.\r\n\t\tvar sc = this._savedCriterias;\r\n\t\tvar cbs = this._cboxes;\r\n\t\tif(sc){\r\n\t\t\tthis.addCriteriaBoxes(sc.length - cbs.length);\r\n\t\t\tthis.removeCriteriaBoxes(cbs.length - sc.length);\r\n\t\t\tarray.forEach(sc, function(c, i){\r\n\t\t\t\tcbs[i].load(c);\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tthis.removeCriteriaBoxes(cbs.length - 1);\r\n\t\t\tcbs[0].load({});\r\n\t\t}\r\n\t\tthis.closeDialog();\r\n\t},\r\n\tonRendered: function(cbox){\r\n\t\t// summary:\r\n\t\t//\t\tTriggered when the rendering of the filter definition dialog is completely finished.\r\n\t\t// cbox:\r\n\t\t//\t\tCurrent visible criteria box\r\n\t\tif(!has('ff')){\r\n\t\t\tvar elems = dijitA11y._getTabNavigable(html.byId(cbox.domNode));\r\n\t\t\tdijitFocus.focus(elems.lowest || elems.first);\r\n\t\t}else{\r\n\t\t\tvar dp = this._defPane;\r\n\t\t\tdp._getFocusItems(dp.domNode);\r\n\t\t\tdijitFocus.focus(dp._firstFocusItem);\r\n\t\t}\r\n\t},\r\n\t_onSetFilter: function(filterDef){\r\n\t\t// summary:\r\n\t\t//\t\tIf someone clear the filter def in the store directly, we must clear it in the UI.\r\n\t\t//\t\tIf someone defines a filter, don't know how to handle it!\r\n\t\tif(filterDef === null && this._savedCriterias){\r\n\t\t\tthis.clearFilter();\r\n\t\t}\r\n\t},\r\n\t_prepareDialog: function(/* int */colIndex){\r\n\t\tvar sc = this._savedCriterias,\r\n\t\t\tcbs = this._cboxes, i, cbox;\r\n\t\tthis.curColIdx = colIndex;\r\n\t\tif(!sc){\r\n\t\t\tif(cbs.length === 0){\r\n\t\t\t\tthis.addCriteriaBoxes(1);\r\n\t\t\t}else{\r\n\t\t\t\t//Re-populate columns anyway, because we don't know when the column is set to hidden.\r\n\t\t\t\tfor(i = 0; (cbox = cbs[i]); ++i){\r\n\t\t\t\t\tcbox.changeCurrentColumn();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else if(this._criteriasChanged){\r\n\t\t\tthis.filterDefPane._relSelect.set(\"value\", this._relOpCls === \"logicall\" ? \"0\" : \"1\");\r\n\t\t\tthis._criteriasChanged = false;\r\n\t\t\tvar needNewCBox = sc.length > cbs.length ? sc.length - cbs.length : 0;\r\n\t\t\tthis.addCriteriaBoxes(needNewCBox);\r\n\t\t\tthis.removeCriteriaBoxes(cbs.length - sc.length);\r\n\t\t\tthis.filterDefPane._clearFilterBtn.set(\"disabled\", false);\r\n\t\t\tfor(i = 0; i < cbs.length - needNewCBox; ++i){\r\n\t\t\t\tcbs[i].load(sc[i]);\r\n\t\t\t}\r\n\t\t\tif(needNewCBox > 0){\r\n\t\t\t\tvar handled = [], handle = connect.connect(this, \"onRendered\", function(cbox){\r\n\t\t\t\t\tvar i = array.indexOf(cbs, cbox);\r\n\t\t\t\t\tif(!handled[i]){\r\n\t\t\t\t\t\thandled[i] = true;\r\n\t\t\t\t\t\tif(--needNewCBox === 0){\r\n\t\t\t\t\t\t\tconnect.disconnect(handle);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcbox.load(sc[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\t//Since we're allowed to remove cboxes when the definition pane is not shown,\r\n\t\t//we have to resize the container to have a correct _verticalSpace.\r\n\t\tthis.filterDefPane.cboxContainer.resize();\r\n\t},\r\n\t_defineFilter: function(){\r\n\t\tvar cbs = this._cboxes,\r\n\t\t\tfilterCboxes = function(method){\r\n\t\t\t\treturn array.filter(array.map(cbs, function(cbox){\r\n\t\t\t\t\treturn cbox[method]();\r\n\t\t\t\t}), function(result){\r\n\t\t\t\t\treturn !!result;\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\texprs = filterCboxes(\"getExpr\");\r\n\t\tthis._savedCriterias = filterCboxes(\"save\");\r\n\t\texprs = exprs.length == 1 ? exprs[0] : {\r\n\t\t\t\"op\": this._relOpCls,\r\n\t\t\t\"data\": exprs\r\n\t\t};\r\n\t\texprs = this.builder.buildExpression(exprs);\r\n\t\t\r\n\t\tthis.plugin.grid.layer(\"filter\").filterDef(exprs);\r\n\t\tthis.filterDefPane._clearFilterBtn.set(\"disabled\", false);\r\n\t},\r\n\t_updateCBoxTitles: function(){\r\n\t\tfor(var cbs = this._cboxes, i = cbs.length; i > 0; --i){\r\n\t\t\tcbs[i - 1].updateRuleIndex(i);\r\n\t\t\tcbs[i - 1].setAriaInfo(i);\r\n\t\t}\r\n\t},\r\n\t_updatePane: function(){\r\n\t\tvar cbs = this._cboxes,\r\n\t\t\tdefPane = this.filterDefPane;\r\n\t\tdefPane._addCBoxBtn.set(\"disabled\", cbs.length == this.plugin.args.ruleCount);\r\n\t\tdefPane._filterBtn.set(\"disabled\", !this.canFilter());\r\n\t},\r\n\tcanFilter: function(){\r\n\t\treturn array.filter(this._cboxes, function(cbox){\r\n\t\t\treturn !cbox.isEmpty();\r\n\t\t}).length > 0;\r\n\t},\r\n\t_closeDlgAndUpdateGrid: function(){\r\n\t\tthis.closeDialog();\r\n\t\tvar g = this.plugin.grid;\r\n\t\tg.showMessage(g.loadingMessage);\r\n\t\tsetTimeout(lang.hitch(g, g._refresh), this._defPane.duration + 10);\r\n\t}\r\n});\r\n\r\nreturn FilterDefDialog;\r\n});\r\n"]}