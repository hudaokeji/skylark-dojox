{"version":3,"sources":["grid/enhanced/plugins/filter/FilterStatusTip.js"],"names":["define","declare","array","lang","query","string","dateLocale","_Widget","_TemplatedMixin","_WidgetsInTemplateMixin","TooltipDialog","Button","popup","template","gridCssCls","headerCssCls","cellCssCls","FilterStatusPane","templateString","constructor","args","plugin","this","_statusHeader","nls","join","_removedCriterias","_rules","statusPane","_dlg","class","content","autofocus","connect","domNode","hitch","closeDialog","_modifyFilter","destroy","destroyRecursive","showDialog","pos_x","pos_y","columnIdx","_pos","x","y","close","_updateStatus","open","parent","filterBar","onCancel","length","filterDefDialog","removeCriteriaBoxes","onFilter","res","p","sp","fdg","getCriteria","statusTitle","innerHTML","statusRel","cell","grid","layout","cells","colName","name","field","substitute","_relOpCls","i","c","index","push","_createStatusDetail","statusDetailNode","_addButtonForRules","map","rule","_getCriteriaStr","forEach","nd","idx","label","showLabel","iconClass","onClick","e","stopPropagation","splice","placeAt","rowIdx","colTxt","condTxt","formattedVal","getColumnIdx"],"mappings":"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","file":"../../../../../grid/enhanced/plugins/filter/FilterStatusTip.js","sourcesContent":["define([\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/query\",\r\n\t\"dojo/string\",\r\n\t\"dojo/date/locale\",\r\n\t\"dijit/_Widget\", \r\n\t\"dijit/_TemplatedMixin\", \r\n\t\"dijit/_WidgetsInTemplateMixin\", \r\n\t\"dijit/TooltipDialog\",\r\n\t\"dijit/form/Button\",\r\n\t\"dijit/_base/popup\",\r\n\t\"dojo/text!../../templates/FilterStatusPane.html\",\r\n\t\"dojo/i18n!../../nls/Filter\"\r\n], function(declare, array, lang, query, string, dateLocale, _Widget, \r\n\t_TemplatedMixin, _WidgetsInTemplateMixin, TooltipDialog, Button, popup, template){\r\n\r\n\tvar gridCssCls = \"\", headerCssCls = \"\", cellCssCls = \"\", rowCssCls = \"\",\r\n\t\toddRowCssCls = \"dojoxGridFStatusTipOddRow\",\r\n\t\thandleHolderCssCls = \"dojoxGridFStatusTipHandle\",\r\n\t\tconditionCssCls = \"dojoxGridFStatusTipCondition\",\r\n\t\t_removeRuleIconCls = \"dojoxGridFStatusTipDelRuleBtnIcon\",\r\n\t\t_statusFooter = \"</tbody></table>\";\r\n\r\n\tvar FilterStatusPane = declare(\"dojox.grid.enhanced.plugins.filter.FilterStatusPane\", [_Widget, _TemplatedMixin], {\r\n\t\ttemplateString: template\r\n\t});\r\n\r\n\treturn declare(\"dojox.grid.enhanced.plugins.filter.FilterStatusTip\", null, {\r\n\t\t// summary:\r\n\t\t//\t\tCreate the status tip UI.\r\n\t\tconstructor: function(args){\r\n\t\t\tvar plugin = this.plugin = args.plugin;\r\n\t\t\tthis._statusHeader = [\"<table border='0' cellspacing='0' class='\",\r\n\t\t\t\tgridCssCls, \"'><thead><tr class='\",\r\n\t\t\t\theaderCssCls, \"'><th class='\",\r\n\t\t\t\tcellCssCls, \"'><div>\", plugin.nls[\"statusTipHeaderColumn\"], \"</div></th><th class='\",\r\n\t\t\t\tcellCssCls, \" lastColumn'><div>\", plugin.nls[\"statusTipHeaderCondition\"], \"</div></th></tr></thead><tbody>\"\r\n\t\t\t].join('');\r\n\t\t\tthis._removedCriterias = [];\r\n\t\t\tthis._rules = [];\r\n\t\t\tthis.statusPane = new FilterStatusPane();\r\n\t\t\tthis._dlg = new TooltipDialog({\r\n\t\t\t\t\"class\": \"dijitTooltipBelow dojoxGridFStatusTipDialog\",\r\n\t\t\t\tcontent: this.statusPane,\r\n\t\t\t\tautofocus: false\r\n\t\t\t});\r\n\t\t\tthis._dlg.connect(this._dlg.domNode, 'onmouseleave', lang.hitch(this, this.closeDialog));\r\n\t\t\tthis._dlg.connect(this._dlg.domNode, 'click', lang.hitch(this, this._modifyFilter));\r\n\t\t},\r\n\t\tdestroy: function(){\r\n\t\t\tthis._dlg.destroyRecursive();\r\n\t\t},\r\n\t\t//-----------------Public Functions------------------------\r\n\t\tshowDialog: function(/* int */pos_x,/* int */pos_y, columnIdx){\r\n\t\t\tthis._pos = {x:pos_x,y:pos_y};\r\n\t\t\tpopup.close(this._dlg);\r\n\t\t\tthis._removedCriterias = [];\r\n\t\t\tthis._rules = [];\r\n\t\t\tthis._updateStatus(columnIdx);\r\n\t\t\tpopup.open({\r\n\t\t\t\tpopup: this._dlg,\r\n\t\t\t\tparent: this.plugin.filterBar,\r\n\t\t\t\tonCancel: function(){},\r\n\t\t\t\tx:pos_x - 12,\r\n\t\t\t\ty:pos_y - 3\r\n\t\t\t});\r\n\t\t},\r\n\t\tcloseDialog: function(){\r\n\t\t\tpopup.close(this._dlg);\r\n\t\t\tif(this._removedCriterias.length){\r\n\t\t\t\tthis.plugin.filterDefDialog.removeCriteriaBoxes(this._removedCriterias);\r\n\t\t\t\tthis._removedCriterias = [];\r\n\t\t\t\tthis.plugin.filterDefDialog.onFilter();\r\n\t\t\t}\r\n\t\t},\r\n\t\t//-----------------Private Functions---------------------------\r\n\t\t_updateStatus: function(columnIdx){\r\n\t\t\tvar res, p = this.plugin,\r\n\t\t\t\tnls = p.nls,\r\n\t\t\t\tsp = this.statusPane,\r\n\t\t\t\tfdg = p.filterDefDialog;\r\n\t\t\tif(fdg.getCriteria() === 0){\r\n\t\t\t\tsp.statusTitle.innerHTML = nls[\"statusTipTitleNoFilter\"];\r\n\t\t\t\tsp.statusRel.innerHTML = \"\";\r\n\t\t\t\tvar cell = p.grid.layout.cells[columnIdx];\r\n\t\t\t\tvar colName = cell ? \"'\" + (cell.name || cell.field) + \"'\" : nls[\"anycolumn\"];\r\n\t\t\t\tres = string.substitute(nls[\"statusTipMsg\"], [colName]);\r\n\t\t\t}else{\r\n\t\t\t\tsp.statusTitle.innerHTML = nls[\"statusTipTitleHasFilter\"];\r\n\t\t\t\tsp.statusRel.innerHTML = fdg._relOpCls == \"logicall\" ? nls[\"statusTipRelAll\"] : nls[\"statusTipRelAny\"];\r\n\t\t\t\tthis._rules = [];\r\n\t\t\t\tvar i = 0, c = fdg.getCriteria(i++);\r\n\t\t\t\twhile(c){\r\n\t\t\t\t\tc.index = i - 1;\r\n\t\t\t\t\tthis._rules.push(c);\r\n\t\t\t\t\tc = fdg.getCriteria(i++);\r\n\t\t\t\t}\r\n\t\t\t\tres = this._createStatusDetail();\r\n\t\t\t}\r\n\t\t\tsp.statusDetailNode.innerHTML = res;\r\n\t\t\tthis._addButtonForRules();\r\n\t\t},\r\n\t\t_createStatusDetail: function(){\r\n\t\t\treturn this._statusHeader + array.map(this._rules, function(rule, i){\r\n\t\t\t\treturn this._getCriteriaStr(rule, i);\r\n\t\t\t}, this).join('') + _statusFooter;\r\n\t\t},\r\n\t\t_addButtonForRules: function(){\r\n\t\t\tif(this._rules.length > 1){\r\n\t\t\t\tquery(\".\" + handleHolderCssCls, this.statusPane.statusDetailNode).forEach(lang.hitch(this, function(nd, idx){\r\n\t\t\t\t\t(new Button({\r\n\t\t\t\t\t\tlabel: this.plugin.nls[\"removeRuleButton\"],\r\n\t\t\t\t\t\tshowLabel: false,\r\n\t\t\t\t\t\ticonClass: _removeRuleIconCls,\r\n\t\t\t\t\t\tonClick: lang.hitch(this, function(e){\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\tthis._removedCriterias.push(this._rules[idx].index);\r\n\t\t\t\t\t\t\tthis._rules.splice(idx,1);\r\n\t\t\t\t\t\t\tthis.statusPane.statusDetailNode.innerHTML = this._createStatusDetail();\r\n\t\t\t\t\t\t\tthis._addButtonForRules();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})).placeAt(nd, \"last\");\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t},\r\n\t\t_getCriteriaStr: function(/* object */c, /* int */rowIdx){\r\n\t\t\tvar res = [\"<tr class='\", rowCssCls,\r\n\t\t\t\t\" \", (rowIdx % 2 ? oddRowCssCls : \"\"),\r\n\t\t\t\t\"'><td class='\", cellCssCls, \"'>\", c.colTxt,\r\n\t\t\t\t\"</td><td class='\", cellCssCls,\r\n\t\t\t\t\"'><div class='\", handleHolderCssCls, \"'><span class='\", conditionCssCls,\r\n\t\t\t\t\"'>\", c.condTxt, \"&nbsp;</span>\",\r\n\t\t\t\tc.formattedVal, \"</div></td></tr>\"];\r\n\t\t\treturn res.join('');\r\n\t\t},\r\n\t\t_modifyFilter: function(){\r\n\t\t\tthis.closeDialog();\r\n\t\t\tvar p = this.plugin;\r\n\t\t\tp.filterDefDialog.showDialog(p.filterBar.getColumnIdx(this._pos.x));\r\n\t\t}\r\n\t});\r\n});\r\n"]}