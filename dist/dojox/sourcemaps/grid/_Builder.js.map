{"version":3,"sources":["grid/_Builder.js"],"names":["define","dojox","array","lang","win","event","has","connect","Moveable","metrics","util","html","domGeometry","dg","grid","findTable","node","n","tagName","parentNode","rowIndexTag","gridViewTag","_Builder","extend","view","this","_table","getTableArray","viewWidth","push","join","generateCellMarkup","inCell","inMoreStyles","inMoreClasses","isHeader","result","sortInfo","index","getSortIndex","id","editable","colSpan","rowSpan","classes","length","styles","hidden","unitWidth","attrs","isCellNode","inNode","Boolean","doc","attr","getCellNodeIndex","inCellNode","Number","getCellNode","inRowNode","inCellIndex","row","i","rowOwner","firstChild","rows","childNodes","cells","cell","j","findCellTarget","inSourceNode","inTopNode","offsetParent","baseDecorateEvent","e","dispatch","type","sourceView","cellNode","target","rowNode","cellIndex","getCell","findTarget","inSource","inTag","domNode","findRowTarget","isIntraNodeEvent","relatedTarget","isDescendant","x","isIntraRowEvent","rowIndex","gridRowIndex","dispatchEvent","domouseover","lastOverCellNode","onMouseOver","onMouseOverRow","domouseout","onMouseOut","onMouseOutRow","domousedown","onMouseDown","onMouseDownRow","_getTextDirStyle","textDir","inRowIndex","_ContentBuilder","call","prototype","update","prepareHtml","defaultGet","get","structure","undefined","value","markup","cellStyles","cellClasses","generateHtml","inDataIndex","dir","item","getItem","fire","header","invisible","m","cc","cs","customClasses","customStyles","format","apply","decorateEvent","_HeaderBuilder","moveable","_skipBogusClicks","overResizeWidth","minColWidth","tableMap","mapRows","_TableMap","inGetValue","inValue","simpleStructure","draggable","headerClasses","indexOf","headerStyles","getCellX","pos","name","inWhile","ascendDom","toUpperCase","position","clientX","layerX","cellX","prepareResize","mod","style","display","canResize","noresize","overLeftResizeArea","hasClass","body","tN","isLeftToRight","overRightResizeArea","offsetWidth","domousemove","c","toggleClass","headerNode","stop","beginColumnResize","doclick","colResizeSetup","isMouse","headContentBox","contentBox","lineDiv","document","createElement","vw","bodyContentBox","l","pageX","getScrollbar","w","top","y","left","height","h","addClass","_origLeft","appendChild","spanners","nodes","findOverlappingNodes","width","cView","adj","views","followers","idx","window","parseInt","table","headerContentNode","scrollLeft","tw","moverDiv","drag","onMove","hitch","endResizeColumn","releaseCapture","destroy","removeClass","setCapture","doResizeColumn","inDrag","mover","leftTop","changeX","data","deltaX","dragRecord","doResizeNow","Math","max","_getPadBorderExtents","onResizeColumn","convertColPctToFixed","flexCells","testFlexCells","t","s","sw","f","fl","setColWidth","setColumnsWidth","map","inRows","k","r","dumpMap","getMapCoords","inRow","inCol","getNode","inTable","_findOverlappingNodes","rw","tr","td"],"mappings":"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","file":"../../grid/_Builder.js","sourcesContent":["define([\r\n\t\"../main\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/_base/sniff\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/dnd/Moveable\",\r\n\t\"dojox/html/metrics\",\r\n\t\"./util\",\r\n\t\"dojo/_base/html\",\r\n\t\"dojo/dom-geometry\"\r\n], function(dojox, array, lang, win, event, has, connect, Moveable, metrics, util, html, domGeometry){\r\n\r\n\tvar dg = dojox.grid;\r\n\r\n\tvar getTdIndex = function(td){\r\n\t\treturn td.cellIndex >=0 ? td.cellIndex : array.indexOf(td.parentNode.cells, td);\r\n\t};\r\n\t\r\n\tvar getTrIndex = function(tr){\r\n\t\treturn tr.rowIndex >=0 ? tr.rowIndex : array.indexOf(tr.parentNode.childNodes, tr);\r\n\t};\r\n\t\r\n\tvar getTr = function(rowOwner, index){\r\n\t\treturn rowOwner && ((rowOwner.rows||0)[index] || rowOwner.childNodes[index]);\r\n\t};\r\n\r\n\tvar findTable = function(node){\r\n\t\tfor(var n=node; n && n.tagName!='TABLE'; n=n.parentNode){}\r\n\t\treturn n;\r\n\t};\r\n\t\r\n\tvar ascendDom = function(inNode, inWhile){\r\n\t\tfor(var n=inNode; n && inWhile(n); n=n.parentNode){}\r\n\t\treturn n;\r\n\t};\r\n\t\r\n\tvar makeNotTagName = function(inTagName){\r\n\t\tvar name = inTagName.toUpperCase();\r\n\t\treturn function(node){ return node.tagName != name; };\r\n\t};\r\n\r\n\tvar rowIndexTag = util.rowIndexTag;\r\n\tvar gridViewTag = util.gridViewTag;\r\n\r\n\t// base class for generating markup for the views\r\n\tvar _Builder = dg._Builder = lang.extend(function(view){\r\n\t\tif(view){\r\n\t\t\tthis.view = view;\r\n\t\t\tthis.grid = view.grid;\r\n\t\t}\r\n\t},{\r\n\t\tview: null,\r\n\t\t// boilerplate HTML\r\n\t\t_table: '<table class=\"dojoxGridRowTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" role=\"presentation\"',\r\n\r\n\t\t// Returns the table variable as an array - and with the view width, if specified\r\n\t\tgetTableArray: function(){\r\n\t\t\tvar html = [this._table];\r\n\t\t\tif(this.view.viewWidth){\r\n\t\t\t\thtml.push([' style=\"width:', this.view.viewWidth, ';\"'].join(''));\r\n\t\t\t}\r\n\t\t\thtml.push('>');\r\n\t\t\treturn html;\r\n\t\t},\r\n\t\t\r\n\t\t// generate starting tags for a cell\r\n\t\tgenerateCellMarkup: function(inCell, inMoreStyles, inMoreClasses, isHeader){\r\n\t\t\tvar result = [], html;\r\n\t\t\tif(isHeader){\r\n\t\t\t\tvar sortInfo = inCell.index != inCell.grid.getSortIndex() ? \"\" : inCell.grid.sortInfo > 0 ? 'aria-sort=\"ascending\"' : 'aria-sort=\"descending\"';\r\n\t\t\t\tif (!inCell.id){\r\n\t\t\t\t\tinCell.id = this.grid.id + \"Hdr\" + inCell.index;\r\n\t\t\t\t}\r\n\t\t\t\t// column headers are not editable, mark as aria-readonly=true\r\n\t\t\t\thtml = ['<th tabIndex=\"-1\" aria-readonly=\"true\" role=\"columnheader\"', sortInfo, ' id=\"', inCell.id, '\"'];\r\n\t\t\t}else{\r\n\t\t\t\t// cells inherit grid aria-readonly property; default value for aria-readonly is false(grid is editable)\r\n\t\t\t\t// if grid is editable (had any editable cells), mark non editable cells as aria-readonly=true\r\n\t\t\t\t// if no editable cells, grid's aria-readonly value will have been set to true and cells will inherit\r\n\t\t\t\tvar editInfo = this.grid.editable && !inCell.editable ? 'aria-readonly=\"true\"' : \"\";\r\n\t\t\t\thtml = ['<td tabIndex=\"-1\" role=\"gridcell\"', editInfo];\r\n\t\t\t}\r\n\t\t\tif(inCell.colSpan){\r\n\t\t\t\thtml.push(' colspan=\"', inCell.colSpan, '\"');\r\n\t\t\t}\r\n\t\t\tif(inCell.rowSpan){\r\n\t\t\t\thtml.push(' rowspan=\"', inCell.rowSpan, '\"');\r\n\t\t\t}\r\n\t\t\thtml.push(' class=\"dojoxGridCell ');\r\n\t\t\tif(inCell.classes){\r\n\t\t\t\thtml.push(inCell.classes, ' ');\r\n\t\t\t}\r\n\t\t\tif(inMoreClasses){\r\n\t\t\t\thtml.push(inMoreClasses, ' ');\r\n\t\t\t}\r\n\t\t\t// result[0] => td opener, style\r\n\t\t\tresult.push(html.join(''));\r\n\t\t\t// SLOT: result[1] => td classes\r\n\t\t\tresult.push('');\r\n\t\t\thtml = ['\" idx=\"', inCell.index, '\" style=\"'];\r\n\t\t\tif(inMoreStyles && inMoreStyles[inMoreStyles.length-1] != ';'){\r\n\t\t\t\tinMoreStyles += ';';\r\n\t\t\t}\r\n\t\t\thtml.push(inCell.styles, inMoreStyles||'', inCell.hidden?'display:none;':'');\r\n\t\t\tif(inCell.unitWidth){\r\n\t\t\t\thtml.push('width:', inCell.unitWidth, ';');\r\n\t\t\t}\r\n\t\t\t// result[2] => markup\r\n\t\t\tresult.push(html.join(''));\r\n\t\t\t// SLOT: result[3] => td style\r\n\t\t\tresult.push('');\r\n\t\t\thtml = [ '\"' ];\r\n\t\t\tif(inCell.attrs){\r\n\t\t\t\thtml.push(\" \", inCell.attrs);\r\n\t\t\t}\r\n\t\t\thtml.push('>');\r\n\t\t\t// result[4] => td postfix\r\n\t\t\tresult.push(html.join(''));\r\n\t\t\t// SLOT: result[5] => content\r\n\t\t\tresult.push('');\r\n\t\t\t// result[6] => td closes\r\n\t\t\tresult.push(isHeader?'</th>':'</td>');\r\n\t\t\treturn result; // Array\r\n\t\t},\r\n\r\n\t\t// cell finding\r\n\t\tisCellNode: function(inNode){\r\n\t\t\treturn Boolean(inNode && inNode!=win.doc && html.attr(inNode, \"idx\"));\r\n\t\t},\r\n\t\t\r\n\t\tgetCellNodeIndex: function(inCellNode){\r\n\t\t\treturn inCellNode ? Number(html.attr(inCellNode, \"idx\")) : -1;\r\n\t\t},\r\n\t\t\r\n\t\tgetCellNode: function(inRowNode, inCellIndex){\r\n\t\t\tfor(var i=0, row; ((row = getTr(inRowNode.firstChild, i)) && row.cells); i++){\r\n\t\t\t\tfor(var j=0, cell; (cell = row.cells[j]); j++){\r\n\t\t\t\t\tif(this.getCellNodeIndex(cell) == inCellIndex){\r\n\t\t\t\t\t\treturn cell;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\t\r\n\t\tfindCellTarget: function(inSourceNode, inTopNode){\r\n\t\t\tvar n = inSourceNode;\r\n\t\t\twhile(n && (!this.isCellNode(n) || (n.offsetParent && gridViewTag in n.offsetParent.parentNode && n.offsetParent.parentNode[gridViewTag] != this.view.id)) && (n!=inTopNode)){\r\n\t\t\t\tn = n.parentNode;\r\n\t\t\t}\r\n\t\t\treturn n!=inTopNode ? n : null;\r\n\t\t},\r\n\t\t\r\n\t\t// event decoration\r\n\t\tbaseDecorateEvent: function(e){\r\n\t\t\te.dispatch = 'do' + e.type;\r\n\t\t\te.grid = this.grid;\r\n\t\t\te.sourceView = this.view;\r\n\t\t\te.cellNode = this.findCellTarget(e.target, e.rowNode);\r\n\t\t\te.cellIndex = this.getCellNodeIndex(e.cellNode);\r\n\t\t\te.cell = (e.cellIndex >= 0 ? this.grid.getCell(e.cellIndex) : null);\r\n\t\t},\r\n\t\t\r\n\t\t// event dispatch\r\n\t\tfindTarget: function(inSource, inTag){\r\n\t\t\tvar n = inSource;\r\n\t\t\twhile(n && (n!=this.domNode) && (!(inTag in n) || (gridViewTag in n && n[gridViewTag] != this.view.id))){\r\n\t\t\t\tn = n.parentNode;\r\n\t\t\t}\r\n\t\t\treturn (n != this.domNode) ? n : null;\r\n\t\t},\r\n\r\n\t\tfindRowTarget: function(inSource){\r\n\t\t\treturn this.findTarget(inSource, rowIndexTag);\r\n\t\t},\r\n\r\n\t\tisIntraNodeEvent: function(e){\r\n\t\t\ttry{\r\n\t\t\t\treturn (e.cellNode && e.relatedTarget && html.isDescendant(e.relatedTarget, e.cellNode));\r\n\t\t\t}catch(x){\r\n\t\t\t\t// e.relatedTarget has permission problem in FF if it's an input: https://bugzilla.mozilla.org/show_bug.cgi?id=208427\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tisIntraRowEvent: function(e){\r\n\t\t\ttry{\r\n\t\t\t\tvar row = e.relatedTarget && this.findRowTarget(e.relatedTarget);\r\n\t\t\t\treturn !row && (e.rowIndex==-1) || row && (e.rowIndex==row.gridRowIndex);\r\n\t\t\t}catch(x){\r\n\t\t\t\t// e.relatedTarget on INPUT has permission problem in FF: https://bugzilla.mozilla.org/show_bug.cgi?id=208427\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdispatchEvent: function(e){\r\n\t\t\tif(e.dispatch in this){\r\n\t\t\t\treturn this[e.dispatch](e);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t// dispatched event handlers\r\n\t\tdomouseover: function(e){\r\n\t\t\tif(e.cellNode && (e.cellNode!=this.lastOverCellNode)){\r\n\t\t\t\tthis.lastOverCellNode = e.cellNode;\r\n\t\t\t\tthis.grid.onMouseOver(e);\r\n\t\t\t}\r\n\t\t\tthis.grid.onMouseOverRow(e);\r\n\t\t},\r\n\r\n\t\tdomouseout: function(e){\r\n\t\t\tif(e.cellNode && (e.cellNode==this.lastOverCellNode) && !this.isIntraNodeEvent(e, this.lastOverCellNode)){\r\n\t\t\t\tthis.lastOverCellNode = null;\r\n\t\t\t\tthis.grid.onMouseOut(e);\r\n\t\t\t\tif(!this.isIntraRowEvent(e)){\r\n\t\t\t\t\tthis.grid.onMouseOutRow(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tdomousedown: function(e){\r\n\t\t\tif (e.cellNode)\r\n\t\t\t\tthis.grid.onMouseDown(e);\r\n\t\t\tthis.grid.onMouseDownRow(e);\r\n\t\t},\r\n\r\n\t\t_getTextDirStyle: function(textDir, inCell, inRowIndex){\r\n\t\t\t// summary:\r\n\t\t\t//\t\t Get BiDi text dir, just a placeholder, defined in dojox/grid/bidi/_BidiMixin\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t});\r\n\r\n\t// Produces html for grid data content. Owned by grid and used internally\r\n\t// for rendering data. Override to implement custom rendering.\r\n\tvar _ContentBuilder = dg._ContentBuilder = lang.extend(function(view){\r\n\t\t_Builder.call(this, view);\r\n\t},_Builder.prototype,{\r\n\t\tupdate: function(){\r\n\t\t\tthis.prepareHtml();\r\n\t\t},\r\n\r\n\t\t// cache html for rendering data rows\r\n\t\tprepareHtml: function(){\r\n\t\t\tvar defaultGet=this.grid.get, cells=this.view.structure.cells;\r\n\t\t\tfor(var j=0, row; (row=cells[j]); j++){\r\n\t\t\t\tfor(var i=0, cell; (cell=row[i]); i++){\r\n\t\t\t\t\tcell.get = cell.get || (cell.value == undefined) && defaultGet;\r\n\t\t\t\t\tcell.markup = this.generateCellMarkup(cell, cell.cellStyles, cell.cellClasses, false);\r\n\t\t\t\t\tif (!this.grid.editable && cell.editable){\r\n\t\t\t\t\t\tthis.grid.editable = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// time critical: generate html using cache and data source\r\n\t\tgenerateHtml: function(inDataIndex, inRowIndex){\r\n\t\t\tvar\r\n\t\t\t\thtml = this.getTableArray(),\r\n\t\t\t\tv = this.view, dir,\r\n\t\t\t\tcells = v.structure.cells,\r\n\t\t\t\titem = this.grid.getItem(inRowIndex);\r\n\r\n\t\t\tutil.fire(this.view, \"onBeforeRow\", [inRowIndex, cells]);\r\n\t\t\tfor(var j=0, row; (row=cells[j]); j++){\r\n\t\t\t\tif(row.hidden || row.header){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\thtml.push(!row.invisible ? '<tr>' : '<tr class=\"dojoxGridInvisible\">');\r\n\t\t\t\tfor(var i=0, cell, m, cc, cs; (cell=row[i]); i++){\r\n\t\t\t\t\tm = cell.markup; cc = cell.customClasses = []; cs = cell.customStyles = [];\r\n\t\t\t\t\t// content (format can fill in cc and cs as side-effects)\r\n\t\t\t\t\tm[5] = cell.format(inRowIndex, item);\r\n\t\t\t\t\t// classes\r\n\t\t\t\t\tm[1] = cc.join(' ');\r\n\t\t\t\t\t// styles\r\n\t\t\t\t\tm[3] = cs.join(';');\r\n\t\t\t\t\tdir = cell.textDir || this.grid.textDir;\r\n\t\t\t\t\tif(dir){\r\n\t\t\t\t\t    m[3] += this._getTextDirStyle(dir, cell, inRowIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// in-place concat\r\n\t\t\t\t\thtml.push.apply(html, m);\r\n\t\t\t\t}\r\n\t\t\t\thtml.push('</tr>');\r\n\t\t\t}\r\n\t\t\thtml.push('</table>');\r\n\t\t\treturn html.join(''); // String\r\n\t\t},\r\n\r\n\t\tdecorateEvent: function(e){\r\n\t\t\te.rowNode = this.findRowTarget(e.target);\r\n\t\t\tif(!e.rowNode){return false;}\r\n\t\t\te.rowIndex = e.rowNode[rowIndexTag];\r\n\t\t\tthis.baseDecorateEvent(e);\r\n\t\t\te.cell = this.grid.getCell(e.cellIndex);\r\n\t\t\treturn true; // Boolean\r\n\t\t}\r\n\t});\r\n\r\n\t// Produces html for grid header content. Owned by grid and used internally\r\n\t// for rendering data. Override to implement custom rendering.\r\n\tvar _HeaderBuilder = dg._HeaderBuilder = lang.extend(function(view){\r\n\t\tthis.moveable = null;\r\n\t\t_Builder.call(this, view);\r\n\t},_Builder.prototype,{\r\n\t\t_skipBogusClicks: false,\r\n\t\toverResizeWidth: 4,\r\n\t\tminColWidth: 1,\r\n\t\t\r\n\t\tupdate: function(){\r\n\t\t\tif(this.tableMap){\r\n\t\t\t\tthis.tableMap.mapRows(this.view.structure.cells);\r\n\t\t\t}else{\r\n\t\t\t\tthis.tableMap = new dg._TableMap(this.view.structure.cells);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgenerateHtml: function(inGetValue, inValue){\r\n\t\t\tvar dir, html = this.getTableArray(), cells = this.view.structure.cells;\r\n\t\t\t\r\n\t\t\tutil.fire(this.view, \"onBeforeRow\", [-1, cells]);\r\n\t\t\tfor(var j=0, row; (row=cells[j]); j++){\r\n\t\t\t\tif(row.hidden){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\thtml.push(!row.invisible ? '<tr>' : '<tr class=\"dojoxGridInvisible\">');\r\n\t\t\t\tfor(var i=0, cell, markup; (cell=row[i]); i++){\r\n\t\t\t\t\tcell.customClasses = [];\r\n\t\t\t\t\tcell.customStyles = [];\r\n\t\t\t\t\tif(this.view.simpleStructure){\r\n\t\t\t\t\t\tif(cell.draggable){\r\n\t\t\t\t\t\t\tif(cell.headerClasses){\r\n\t\t\t\t\t\t\t\tif(cell.headerClasses.indexOf('dojoDndItem') == -1){\r\n\t\t\t\t\t\t\t\t\tcell.headerClasses += ' dojoDndItem';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tcell.headerClasses = 'dojoDndItem';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(cell.attrs){\r\n\t\t\t\t\t\t\tif(cell.attrs.indexOf(\"dndType='gridColumn_\") == -1){\r\n\t\t\t\t\t\t\t\tcell.attrs += \" dndType='gridColumn_\" + this.grid.id + \"'\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tcell.attrs = \"dndType='gridColumn_\" + this.grid.id + \"'\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmarkup = this.generateCellMarkup(cell, cell.headerStyles, cell.headerClasses, true);\r\n\t\t\t\t\t// content\r\n\t\t\t\t\tmarkup[5] = (inValue != undefined ? inValue : inGetValue(cell));\r\n\t\t\t\t\t// styles\r\n\t\t\t\t\tmarkup[3] = cell.customStyles.join(';');\r\n\t\t\t\t\tdir = cell.textDir || this.grid.textDir;\r\n\t\t\t\t\tif(dir){\r\n\t\t\t\t\t    markup[3] += this._getTextDirStyle(dir, cell, inValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// classes\r\n\t\t\t\t\tmarkup[1] = cell.customClasses.join(' '); //(cell.customClasses ? ' ' + cell.customClasses : '');\r\n\t\t\t\t\thtml.push(markup.join(''));\r\n\t\t\t\t}\r\n\t\t\t\thtml.push('</tr>');\r\n\t\t\t}\r\n\t\t\thtml.push('</table>');\r\n\t\t\treturn html.join('');\r\n\t\t},\r\n\r\n\t\t// event helpers\r\n\t\tgetCellX: function(e){\r\n\t\t\tvar n, x, pos;\r\n\t\t\t// Calculate starting x position\r\n\t\t\tn = ascendDom(e.target, makeNotTagName(\"th\"));\r\n\t\t\tif(n){\r\n\t\t\t\t// We have a proper parent node, use that for position\r\n\t\t\t\tpos = domGeometry.position(n);\r\n\t\t\t\tx = e.clientX - pos.x;\r\n\t\t\t}else{\r\n\t\t\t\t// Fall back to layerX\r\n\t\t\t\tx = e.layerX;\r\n\t\t\t}\r\n\t\t\treturn x;\r\n\t\t},\r\n\r\n\t\t// event decoration\r\n\t\tdecorateEvent: function(e){\r\n\t\t\tthis.baseDecorateEvent(e);\r\n\t\t\te.rowIndex = -1;\r\n\t\t\te.cellX = this.getCellX(e);\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\t// event handlers\r\n\t\t// resizing\r\n\t\tprepareResize: function(e, mod){\r\n\t\t\tdo{\r\n\t\t\t\tvar i = e.cellIndex;\r\n\t\t\t\te.cellNode = (i ? e.cellNode.parentNode.cells[i+mod] : null);\r\n\t\t\t\te.cellIndex = (e.cellNode ? this.getCellNodeIndex(e.cellNode) : -1);\r\n\t\t\t}while(e.cellNode && e.cellNode.style.display == \"none\");\r\n\t\t\treturn Boolean(e.cellNode);\r\n\t\t},\r\n\r\n\t\tcanResize: function(e){\r\n\t\t\tif(!e.cellNode || e.cellNode.colSpan > 1){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar cell = this.grid.getCell(e.cellIndex);\r\n\t\t\treturn !cell.noresize && cell.canResize();\r\n\t\t},\r\n\r\n\t\toverLeftResizeArea: function(e){\r\n\t\t\t// We are never over a resize area if we are in the process of moving\r\n\t\t\tif(html.hasClass(win.body(), \"dojoDndMove\")){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t//Bugfix for crazy IE problem (#8807).  IE returns position information for the icon and text arrow divs\r\n\t\t\t//as if they were still on the left instead of returning the position they were 'float: right' to.\r\n\t\t\t//So, the resize check ends up checking the wrong adjacent cell.  This checks to see if the hover was over\r\n\t\t\t//the image or text nodes, then just ignored them/treat them not in scale range.\r\n\t\t\tif(has('ie')){\r\n\t\t\t\tvar tN = e.target;\r\n\t\t\t\tif(html.hasClass(tN, \"dojoxGridArrowButtonNode\") ||\r\n\t\t\t\t\thtml.hasClass(tN, \"dojoxGridArrowButtonChar\") ||\r\n\t\t\t\t\thtml.hasClass(tN, \"dojoxGridColCaption\")){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(this.grid.isLeftToRight()){\r\n\t\t\t\treturn (e.cellIndex>0) && (e.cellX > 0 && e.cellX < this.overResizeWidth) && this.prepareResize(e, -1);\r\n\t\t\t}\r\n\t\t\tvar t = e.cellNode && (e.cellX > 0 && e.cellX < this.overResizeWidth);\r\n\t\t\treturn t;\r\n\t\t},\r\n\r\n\t\toverRightResizeArea: function(e){\r\n\t\t\t// We are never over a resize area if we are in the process of moving\r\n\t\t\tif(html.hasClass(win.body(), \"dojoDndMove\")){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t//Bugfix for crazy IE problem (#8807).  IE returns position information for the icon and text arrow divs\r\n\t\t\t//as if they were still on the left instead of returning the position they were 'float: right' to.\r\n\t\t\t//So, the resize check ends up checking the wrong adjacent cell.  This checks to see if the hover was over\r\n\t\t\t//the image or text nodes, then just ignored them/treat them not in scale range.\r\n\t\t\tif(has('ie')){\r\n\t\t\t\tvar tN = e.target;\r\n\t\t\t\tif(html.hasClass(tN, \"dojoxGridArrowButtonNode\") ||\r\n\t\t\t\t\thtml.hasClass(tN, \"dojoxGridArrowButtonChar\") ||\r\n\t\t\t\t\thtml.hasClass(tN, \"dojoxGridColCaption\")){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(this.grid.isLeftToRight()){\r\n\t\t\t\treturn e.cellNode && (e.cellX >= e.cellNode.offsetWidth - this.overResizeWidth);\r\n\t\t\t}\r\n\t\t\treturn (e.cellIndex>0) && (e.cellX >= e.cellNode.offsetWidth - this.overResizeWidth) && this.prepareResize(e, -1);\r\n\t\t},\r\n\r\n\t\tdomousemove: function(e){\r\n\t\t\t//console.log(e.cellIndex, e.cellX, e.cellNode.offsetWidth);\r\n\t\t\tif(!this.moveable){\r\n\t\t\t\tvar c = (this.overRightResizeArea(e) ? 'dojoxGridColResize' : (this.overLeftResizeArea(e) ? 'dojoxGridColResize' : ''));\r\n\t\t\t\tif(c && !this.canResize(e)){\r\n\t\t\t\t\tc = 'dojoxGridColNoResize';\r\n\t\t\t\t}\r\n\t\t\t\thtml.toggleClass(e.sourceView.headerNode, \"dojoxGridColNoResize\", (c == \"dojoxGridColNoResize\"));\r\n\t\t\t\thtml.toggleClass(e.sourceView.headerNode, \"dojoxGridColResize\", (c == \"dojoxGridColResize\"));\r\n\t\t\t\tif(c){\r\n\t\t\t\t\tevent.stop(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdomousedown: function(e){\r\n\t\t\tif(!this.moveable){\r\n\t\t\t\tif((this.overRightResizeArea(e) || this.overLeftResizeArea(e)) && this.canResize(e)){\r\n\t\t\t\t\tthis.beginColumnResize(e);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.grid.onMouseDown(e);\r\n\t\t\t\t\tthis.grid.onMouseOverRow(e);\r\n\t\t\t\t}\r\n\t\t\t\t//else{\r\n\t\t\t\t//\tthis.beginMoveColumn(e);\r\n\t\t\t\t//}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdoclick: function(e) {\r\n\t\t\tif(this._skipBogusClicks){\r\n\t\t\t\tevent.stop(e);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t// column resizing\r\n\t\tcolResizeSetup: function(/*Event Object*/e, /*boolean*/ isMouse ){\r\n\t\t\t//Set up the drag object for column resizing\r\n\t\t\t// Called with mouse event in case of drag and drop,\r\n\t\t\t// Also called from keyboard shift-arrow event when focus is on a header\r\n\t\t\tvar headContentBox = html.contentBox(e.sourceView.headerNode);\r\n\t\t\t\r\n\t\t\tif(isMouse){  //IE draws line even with no mouse down so separate from keyboard\r\n\t\t\t\tthis.lineDiv = document.createElement('div');\r\n\r\n\t\t\t\tvar vw = html.position(e.sourceView.headerNode, true);\r\n\t\t\t\tvar bodyContentBox = html.contentBox(e.sourceView.domNode);\r\n\t\t\t\t//fix #11340\r\n\t\t\t\tvar l = e.pageX;\r\n\t\t\t\tif(!this.grid.isLeftToRight() && has('ie') < 8){\r\n\t\t\t\t\tl -= metrics.getScrollbar().w;\r\n\t\t\t\t}\r\n\t\t\t\thtml.style(this.lineDiv, {\r\n\t\t\t\t\ttop: vw.y + \"px\",\r\n\t\t\t\t\tleft: l + \"px\",\r\n\t\t\t\t\theight: (bodyContentBox.h + headContentBox.h) + \"px\"\r\n\t\t\t\t});\r\n\t\t\t\thtml.addClass(this.lineDiv, \"dojoxGridResizeColLine\");\r\n\t\t\t\tthis.lineDiv._origLeft = l;\r\n\t\t\t\twin.body().appendChild(this.lineDiv);\r\n\t\t\t}\r\n\t\t\tvar spanners = [], nodes = this.tableMap.findOverlappingNodes(e.cellNode);\r\n\t\t\tfor(var i=0, cell; (cell=nodes[i]); i++){\r\n\t\t\t\tspanners.push({ node: cell, index: this.getCellNodeIndex(cell), width: cell.offsetWidth });\r\n\t\t\t\t//console.log(\"spanner: \" + this.getCellNodeIndex(cell));\r\n\t\t\t}\r\n\r\n\t\t\tvar view = e.sourceView;\r\n\t\t\tvar adj = this.grid.isLeftToRight() ? 1 : -1;\r\n\t\t\tvar views = e.grid.views.views;\r\n\t\t\tvar followers = [];\r\n\t\t\tfor(var j=view.idx+adj, cView; (cView=views[j]); j=j+adj){\r\n\t\t\t\tfollowers.push({ node: cView.headerNode, left: window.parseInt(cView.headerNode.style.left) });\r\n\t\t\t}\r\n\t\t\tvar table = view.headerContentNode.firstChild;\r\n\t\t\tvar drag = {\r\n\t\t\t\tscrollLeft: e.sourceView.headerNode.scrollLeft,\r\n\t\t\t\tview: view,\r\n\t\t\t\tnode: e.cellNode,\r\n\t\t\t\tindex: e.cellIndex,\r\n\t\t\t\tw: html.contentBox(e.cellNode).w,\r\n\t\t\t\tvw: headContentBox.w,\r\n\t\t\t\ttable: table,\r\n\t\t\t\ttw: html.contentBox(table).w,\r\n\t\t\t\tspanners: spanners,\r\n\t\t\t\tfollowers: followers\r\n\t\t\t};\r\n\t\t\treturn drag;\r\n\t\t},\r\n\t\tbeginColumnResize: function(e){\r\n\t\t\tthis.moverDiv = document.createElement(\"div\");\r\n\t\t\thtml.style(this.moverDiv,{position: \"absolute\", left:0}); // to make DnD work with dir=rtl\r\n\t\t\twin.body().appendChild(this.moverDiv);\r\n\t\t\thtml.addClass(this.grid.domNode, \"dojoxGridColumnResizing\");\r\n\t\t\tvar m = (this.moveable = new Moveable(this.moverDiv));\r\n\r\n\t\t\tvar drag = this.colResizeSetup(e,true);\r\n\r\n\t\t\tm.onMove = lang.hitch(this, \"doResizeColumn\", drag);\r\n\r\n\t\t\tconnect.connect(m, \"onMoveStop\", lang.hitch(this, function(){\r\n\t\t\t\tthis.endResizeColumn(drag);\r\n\t\t\t\tif(drag.node.releaseCapture){\r\n\t\t\t\t\tdrag.node.releaseCapture();\r\n\t\t\t\t}\r\n\t\t\t\tthis.moveable.destroy();\r\n\t\t\t\tdelete this.moveable;\r\n\t\t\t\tthis.moveable = null;\r\n\t\t\t\thtml.removeClass(this.grid.domNode, \"dojoxGridColumnResizing\");\r\n\t\t\t}));\r\n\r\n\t\t\tif(e.cellNode.setCapture){\r\n\t\t\t\te.cellNode.setCapture();\r\n\t\t\t}\r\n\t\t\tm.onMouseDown(e);\r\n\t\t},\r\n\r\n\t\tdoResizeColumn: function(inDrag, mover, leftTop){\r\n\t\t\tvar changeX = leftTop.l;\r\n\t\t\tvar data = {\r\n\t\t\t\tdeltaX: changeX,\r\n\t\t\t\tw: inDrag.w + (this.grid.isLeftToRight() ? changeX : -changeX),//fix #11341\r\n\t\t\t\tvw: inDrag.vw + changeX,\r\n\t\t\t\ttw: inDrag.tw + changeX\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tthis.dragRecord = {inDrag: inDrag, mover: mover, leftTop:leftTop};\r\n\t\t\t\r\n\t\t\tif(data.w >= this.minColWidth){\r\n\t\t\t\tif (!mover) { // we are using keyboard do immediate resize\r\n\t\t\t\t\tthis.doResizeNow(inDrag, data);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\thtml.style(this.lineDiv, \"left\", (this.lineDiv._origLeft + data.deltaX) + \"px\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tendResizeColumn: function(inDrag){\r\n\t\t\tif(this.dragRecord){\r\n\t\t\t\tvar leftTop = this.dragRecord.leftTop;\r\n\t\t\t\tvar changeX = this.grid.isLeftToRight() ? leftTop.l : -leftTop.l;\r\n\t\t\t\t// Make sure we are not under our minimum\r\n\t\t\t\t// http://bugs.dojotoolkit.org/ticket/9390\r\n\t\t\t\tchangeX += Math.max(inDrag.w + changeX, this.minColWidth) - (inDrag.w + changeX);\r\n\t\t\t\tif(has('webkit') && inDrag.spanners.length){\r\n\t\t\t\t\t// Webkit needs the pad border extents back in\r\n\t\t\t\t\tchangeX += html._getPadBorderExtents(inDrag.spanners[0].node).w;\r\n\t\t\t\t}\r\n\t\t\t\tvar data = {\r\n\t\t\t\t\tdeltaX: changeX,\r\n\t\t\t\t\tw: inDrag.w + changeX,\r\n\t\t\t\t\tvw: inDrag.vw + changeX,\r\n\t\t\t\t\ttw: inDrag.tw + changeX\r\n\t\t\t\t};\r\n\t\t\t\t// Only resize the columns when the drag has finished\r\n\t\t\t\tthis.doResizeNow(inDrag, data);\r\n\t\t\t\tdelete this.dragRecord;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\thtml.destroy(this.lineDiv);\r\n \t\t\thtml.destroy(this.moverDiv);\r\n\t\t\thtml.destroy(this.moverDiv);\r\n\t\t\tdelete this.moverDiv;\r\n\t\t\tthis._skipBogusClicks = true;\r\n\t\t\tinDrag.view.update();\r\n\t\t\tthis._skipBogusClicks = false;\r\n\t\t\tthis.grid.onResizeColumn(inDrag.index);\r\n\t\t},\r\n\t\tdoResizeNow: function(inDrag, data){\r\n\t\t\tinDrag.view.convertColPctToFixed();\r\n\t\t\tif(inDrag.view.flexCells && !inDrag.view.testFlexCells()){\r\n\t\t\t\tvar t = findTable(inDrag.node);\r\n\t\t\t\tif(t){\r\n\t\t\t\t\t(t.style.width = '');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar i, s, sw, f, fl;\r\n\t\t\tfor(i=0; (s=inDrag.spanners[i]); i++){\r\n\t\t\t\tsw = s.width + data.deltaX;\r\n\t\t\t\tif(sw > 0){\r\n\t\t\t\t\ts.node.style.width = sw + 'px';\r\n\t\t\t\t\tinDrag.view.setColWidth(s.index, sw);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this.grid.isLeftToRight() || !has('ie')){//fix #11339\r\n\t\t\t\tfor(i=0; (f=inDrag.followers[i]); i++){\r\n\t\t\t\t\tfl = f.left + data.deltaX;\r\n\t\t\t\t\tf.node.style.left = fl + 'px';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tinDrag.node.style.width = data.w + 'px';\r\n\t\t\tinDrag.view.setColWidth(inDrag.index, data.w);\r\n\t\t\tinDrag.view.headerNode.style.width = data.vw + 'px';\r\n\t\t\tinDrag.view.setColumnsWidth(data.tw);\r\n\t\t\tif(!this.grid.isLeftToRight()){\r\n\t\t\t\tinDrag.view.headerNode.scrollLeft = inDrag.scrollLeft + data.deltaX;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t// Maps an html table into a structure parsable for information about cell row and col spanning.\r\n\t// Used by HeaderBuilder.\r\n\tdg._TableMap = lang.extend(function(rows){\r\n\t\tthis.mapRows(rows);\r\n\t},{\r\n\t\tmap: null,\r\n\r\n\t\tmapRows: function(inRows){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tMap table topography\r\n\r\n\t\t\t//console.log('mapRows');\r\n\t\t\t// # of rows\r\n\t\t\tvar rowCount = inRows.length;\r\n\t\t\tif(!rowCount){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// map which columns and rows fill which cells\r\n\t\t\tthis.map = [];\r\n\t\t\tvar row;\r\n\t\t\tfor(var k=0; (row=inRows[k]); k++){\r\n\t\t\t\tthis.map[k] = [];\r\n\t\t\t}\r\n\t\t\tfor(var j=0; (row=inRows[j]); j++){\r\n\t\t\t\tfor(var i=0, x=0, cell, colSpan, rowSpan; (cell=row[i]); i++){\r\n\t\t\t\t\twhile(this.map[j][x]){x++;}\r\n\t\t\t\t\tthis.map[j][x] = { c: i, r: j };\r\n\t\t\t\t\trowSpan = cell.rowSpan || 1;\r\n\t\t\t\t\tcolSpan = cell.colSpan || 1;\r\n\t\t\t\t\tfor(var y=0; y<rowSpan; y++){\r\n\t\t\t\t\t\tfor(var s=0; s<colSpan; s++){\r\n\t\t\t\t\t\t\tthis.map[j+y][x+s] = this.map[j][x];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tx += colSpan;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//this.dumMap();\r\n\t\t},\r\n\r\n\t\tdumpMap: function(){\r\n\t\t\tfor(var j=0, row, h=''; (row=this.map[j]); j++,h=''){\r\n\t\t\t\tfor(var i=0, cell; (cell=row[i]); i++){\r\n\t\t\t\t\th += cell.r + ',' + cell.c + '   ';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetMapCoords: function(inRow, inCol){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFind node's map coords by it's structure coords\r\n\t\t\tfor(var j=0, row; (row=this.map[j]); j++){\r\n\t\t\t\tfor(var i=0, cell; (cell=row[i]); i++){\r\n\t\t\t\t\tif(cell.c==inCol && cell.r == inRow){\r\n\t\t\t\t\t\treturn { j: j, i: i };\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//else{console.log(inRow, inCol, ' : ', i, j, \" : \", cell.r, cell.c); };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn { j: -1, i: -1 };\r\n\t\t},\r\n\t\t\r\n\t\tgetNode: function(inTable, inRow, inCol){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFind a node in inNode's table with the given structure coords\r\n\t\t\tvar row = inTable && inTable.rows[inRow];\r\n\t\t\treturn row && row.cells[inCol];\r\n\t\t},\r\n\t\t\r\n\t\t_findOverlappingNodes: function(inTable, inRow, inCol){\r\n\t\t\tvar nodes = [];\r\n\t\t\tvar m = this.getMapCoords(inRow, inCol);\r\n\t\t\t//console.log(\"node j: %d, i: %d\", m.j, m.i);\r\n\t\t\tfor(var j=0, row; (row=this.map[j]); j++){\r\n\t\t\t\tif(j == m.j){ continue; }\r\n\t\t\t\tvar rw = row[m.i];\r\n\t\t\t\t//console.log(\"overlaps: r: %d, c: %d\", rw.r, rw.c);\r\n\t\t\t\tvar n = (rw?this.getNode(inTable, rw.r, rw.c):null);\r\n\t\t\t\tif(n){ nodes.push(n); }\r\n\t\t\t}\r\n\t\t\t//console.log(nodes);\r\n\t\t\treturn nodes;\r\n\t\t},\r\n\t\t\r\n\t\tfindOverlappingNodes: function(inNode){\r\n\t\t\treturn this._findOverlappingNodes(findTable(inNode), getTrIndex(inNode.parentNode), getTdIndex(inNode));\r\n\t\t}\r\n\t});\r\n\r\n\treturn {\r\n\t\t_Builder: _Builder,\r\n\t\t_HeaderBuilder: _HeaderBuilder,\r\n\t\t_ContentBuilder: _ContentBuilder\r\n\t};\r\n});\r\n"]}