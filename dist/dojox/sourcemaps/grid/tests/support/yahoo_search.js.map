{"version":3,"sources":["grid/tests/support/yahoo_search.js"],"names":["nop","dojo","declare","inFields","inData","this","rowsPerPage","fieldNames","f","i","push","name","clearData","turbo","widgets","TurboGrid","data","dynamic","prototype","apply","arguments","encodeParam","inName","inValue","printf","getParams","inParams","url","output","results","query","$","value","replace","undefined","send","inAsync","inOnReceive","inOnError","p","io","bind","method","content","contentType","mimetype","sync","load","bindArgs","error","onSend","receive","inEvt","ResultSet","onReceive","e","inTyp","inErr","m","message","alert","fetchRowCount","inCallback","requestRows","inRowIndex","inCount","params","start","processRows","l","totalResultsReturned","s","firstResultPosition","setRow","Result","c","Math","min","totalResultsAvailable","count","setRowCount","allChange","onInitializeData","getDatum","inColIndex","row","getRow","field","fields","get","na","modelChange","n","innerHTML","model","formatLink","supplant","href","text","formatImage","o","src","Url","width","Width","height","Height","formatDate","inDatum","d","Date","getMonth","getDate","getFullYear","formatDimensions"],"mappings":"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","file":"../../../../grid/tests/support/yahoo_search.js","sourcesContent":["// model that works with Yahoo Search API\r\n(function(){\r\nvar nop = function(){};\r\ndojo.declare(\"dojox.grid._data.yahooSearch\", null,\r\n\tfunction(inFields, inData) {\r\n\t\tthis.rowsPerPage = 20;\r\n\t\tthis.fieldNames = [];\r\n\t\tfor (var i=0, f; (f=inFields[i]); i++)\r\n\t\t\tthis.fieldNames.push(f.name);\r\n\t}, {\r\n\tclearData: function() {\r\n\t\tturbo.widgets.TurboGrid.data.dynamic.prototype.clearData.apply(this, arguments);\r\n\t},\r\n\t// server send / receive\r\n\tencodeParam: function(inName, inValue) {\r\n\t\treturn turbo.printf('&%s=%s', inName, inValue);\r\n\t},\r\n\tgetParams: function(inParams) {\r\n\t\tvar url = this.url;\r\n\t\turl += '?appid=turboajax';\r\n\t\tinParams = inParams || {};\r\n\t\tinParams.output = 'json';\r\n\t\tinParams.results = this.rowsPerPage;\r\n\t\tinParams.query = turbo.$('searchInput').value.replace(/ /g, '+');\r\n\t\tfor (var i in inParams)\r\n\t\t\tif (inParams[i] != undefined)\r\n\t\t\t\turl += this.encodeParam(i, inParams[i]);\r\n\t\treturn url;\r\n\t},\r\n\tsend: function(inAsync, inParams, inOnReceive, inOnError) {\r\n\t\tvar p = this.getParams(inParams);\r\n\t\tdojo.io.bind({\r\n\t\t\turl: \"support/proxy.php\",\r\n\t\t\tmethod: \"post\",\r\n\t\t\tcontent: {url: p },\r\n\t\t\tcontentType: \"application/x-www-form-urlencoded; charset=utf-8\",\r\n\t\t\tmimetype: 'text/json',\r\n\t\t\tsync: !inAsync,\r\n\t\t\tload: turbo.bindArgs(this, \"receive\", inOnReceive, inOnError),\r\n\t\t\terror: turbo.bindArgs(this, \"error\", inOnError)\r\n\t\t});\r\n\t\tthis.onSend(inParams);\r\n\t},\r\n\treceive: function(inOnReceive, inOnError, inEvt, inData) {\r\n\t\ttry {\r\n\t\t\tinData = inData.ResultSet;\r\n\t\t\tinOnReceive(inData);\r\n\t\t\tthis.onReceive(inData);\r\n\t\t} catch(e) {\r\n\t\t\tif (inOnError)\r\n\t\t\t\tinOnError(inData);\r\n\t\t}\r\n\t},\r\n\terror: function(inOnError, inTyp, inErr) {\r\n\t\tvar m = 'io error: ' + inErr.message;\r\n\t\talert(m);\r\n\t\tif (inOnError)\r\n\t\t\tinOnError(m);\r\n\t},\r\n\tfetchRowCount: function(inCallback) {\r\n\t\tthis.send(true, inCallback );\r\n\t},\r\n\t// request data\r\n\trequestRows: function(inRowIndex, inCount)\t{\r\n\t\tinRowIndex = (inRowIndex == undefined ? 0 : inRowIndex);\r\n\t\tvar params = {\r\n\t\t\tstart: inRowIndex + 1\r\n\t\t}\r\n\t\tthis.send(true, params, turbo.bindArgs(this, this.processRows));\r\n\t},\r\n\t// server callbacks\r\n\tprocessRows: function(inData) {\r\n\t\tfor (var i=0, l=inData.totalResultsReturned, s=inData.firstResultPosition; i<l; i++) {\r\n\t\t\tthis.setRow(inData.Result[i], s - 1 + i);\r\n\t\t}\r\n\t\t// yahoo says 1000 is max results to return\r\n\t\tvar c = Math.min(1000, inData.totalResultsAvailable);\r\n\t\tif (this.count != c) {\r\n\t\t\tthis.setRowCount(c);\r\n\t\t\tthis.allChange();\r\n\t\t\tthis.onInitializeData(inData);\r\n\t\t}\r\n\t},\r\n\tgetDatum: function(inRowIndex, inColIndex) {\r\n\t\tvar row = this.getRow(inRowIndex);\r\n\t\tvar field = this.fields.get(inColIndex);\r\n\t\treturn (inColIndex == undefined ? row : (row ? row[field.name] : field.na));\r\n\t},\r\n\t// events\r\n\tonInitializeData: nop,\r\n\tonSend: nop,\r\n\tonReceive: nop\r\n});\r\n\r\n// report\r\nmodelChange = function() {\r\n\tvar n = turbo.$('rowCount');\r\n\tif (n)\r\n\t\tn.innerHTML = turbo.printf('about %s row(s)', model.count);\r\n}\r\n\r\n\r\n// some data formatters\r\nformatLink = function(inData, inRowIndex) {\r\n\tif (!inData[0] || !inData[1])\r\n\t\treturn '&nbsp;';\r\n\treturn turbo.supplant('<a target=\"_blank\" href=\"{href}\">{text}</a>', {href: inData[0], text: inData[1] });\r\n};\r\n\r\nformatImage = function(inData, inRowIndex) {\r\n\tif (!inData[0] || !inData[1])\r\n\t\treturn '&nbsp;';\r\n\tvar o = {\r\n\t\thref: inData[0],\r\n\t\tsrc: inData[1].Url,\r\n\t\twidth: inData[1].Width,\r\n\t\theight: inData[1].Height\r\n\t}\r\n\treturn turbo.supplant('<a href=\"{href}\" target=\"_blank\"><img border=0 src=\"{src}\" width=\"{width}\" height=\"{height}\"></a>', o);\r\n};\r\n\r\nformatDate = function(inDatum, inRowIndex) {\r\n\tif (inDatum == '')\r\n\t\treturn '&nbsp;';\r\n\tvar d = new Date(inDatum * 1000);\r\n\treturn turbo.printf('%s/%s/%s', d.getMonth(), d.getDate(), d.getFullYear());\r\n};\r\n\r\nformatDimensions = function(inData, inRowIndex) {\r\n\tif (!inData[0] || !inData[1])\r\n\t\treturn '&nbsp;';\r\n\treturn inData[0] + ' x ' + inData[1];\r\n}\r\n})();\r\n"]}