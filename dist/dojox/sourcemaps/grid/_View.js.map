{"version":3,"sources":["grid/_View.js"],"names":["define","dojo","dijit","dojox","declare","array","lang","connect","has","query","win","template","Source","_Widget","_TemplatedMixin","metrics","util","html","_Builder","Avatar","Manager","_View","defaultWidth","viewWidth","templateString","classTag","marginBottom","rowPad","_togglingColumn","_headerBuilderClass","_HeaderBuilder","_contentBuilderClass","_ContentBuilder","postMixInProperties","this","rowNodes","postCreate","scrollboxNode","funnelEvents","contentNode","headerNode","content","header","grid","isLeftToRight","headerNodeContainer","style","width","destroy","i","_cleanupRowWidgets","source","inherited","arguments","focus","hiddenFocusNode","setStructure","inStructure","vs","structure","isNaN","noscroll","_onBeforeRow","onBeforeRow","_onAfterRow","onAfterRow","overflow","simpleStructure","Boolean","cells","length","testFlexCells","updateStructure","inRowNode","forEach","map","byNode","w","_destroyOnRemove","domNode","parentNode","removeChild","inRowIndex","getRowNode","g","n","lw","getAttribute","cellIdx","window","parseInt","attr","getCell","byId","replaceChild","_started","startup","innerHTML","flexCells","row","j","cell","view","isFlex","update","getScrollbarWidth","hasScrollSpace","hasVScrollbar","getScrollbar","getColumnsWidth","h","headerContentNode","firstChild","offsetWidth","setColumnsWidth","getWidth","getContentWidth","Math","max","_getContentBox","render","height","renderHeader","layout","getSibling","hitch","node","before","inc","idx","getCellNodeIndex","getHeaderNode","display","columnReordering","bottomMarker","topMarker","create","id","class","body","_hide","arrowDim","contentBox","headerHeight","rows","horizontal","accept","viewIndex","index","generateText","onMouseDown","e","decorateEvent","overRightResizeArea","overLeftResizeArea","canResize","moveable","beginColumnResize","headerMenu","onCancel","button","prototype","call","onMouseOver","src","_getChildByEvent","apply","_markTargetAnchor","current","targetAnchor","_removeItemClass","target","endAdd","pos","position","left","floor","x","top","y","_addItemClass","_unmarkTargetAnchor","disconnect","_source_conn","unsubscribe","_source_sub","onDndCancel","subscribe","visibility","_onDndDropBefore","nodes","copy","manager","_targetNode","_beforeTarget","views","srcView","tgtView","convertColPctToFixed","_onDndDrop","getIdx","marginBox","stn","stb","moveColumn","_removingColumn","generateHtml","_getHeaderContent","contentWidth","fire","inCell","name","getCellName","test","ret","getSortIndex","push","concat","sortInfo","join","resize","adaptHeight","adaptWidth","hasHScrollbar","reset","hadScroll","_hasHScroll","undefined","_hasVScroll","scrollHeight","clientHeight","hasPct","initialWidth","cellNodes","fixedWidths","c","vIdx","slice","cellNode","getHeaderCellNode","hasAttr","setColWidth","removeAttr","minusScroll","_autoHeight","replace","self","v","checkOtherViewScrollers","setStyleHeightPx","min","setSize","ds","hs","renderRow","rowNode","createRowNode","buildRow","document","createElement","className","_RowSelector","selectionMode","setAttribute","gridViewTag","rowIndexTag","buildRowContent","styleRow","rowRemoved","edit","save","getCellNode","inCellIndex","inNode","_style","cssText","styleRowNode","doStyleRowNode","updateRow","updateRowStyles","lastTop","firstScroll","_nativeScroll","doscroll","inEvent","isLtr","s","scrollLeft","clientWidth","scrollWidth","scrollTop","scrollTo","setScrollTop","inTop","doContentEvent","onContentEvent","doHeaderEvent","onHeaderEvent","dispatchContentEvent","dispatchEvent","dispatchHeaderEvent","inIndex","inWidth","setCellWidth","_GridAvatar","construct","dd","doc","a","cellPadding","cellSpacing","zIndex","margin","b","tr","td","img","table","tbody","creator","_normalizedCreator","getItem","data","cloneNode","tagName","toLowerCase","appendChild","r","m","oldOffsetY","OFFSET_Y","oldMakeAvatar","makeAvatar","hasClass"],"mappings":";;;;;;;AAAAA,QACC,OACA,iBACA,UACA,qBACA,mBACA,kBACA,qBACA,mBACA,aACA,oBACA,kCACA,kBACA,gBACA,wBACA,qBACA,SACA,kBACA,aACA,kBACA,oBACE,SAASC,EAAMC,EAAOC,EAAOC,EAASC,EAAOC,EAAMC,EAASC,EAAKC,EACnEC,EAAKC,EAAUC,EAAQC,EAASC,EAAiBC,EAASC,EAAMC,EAAMC,EAAUC,EAAQC,GAGxF,IAKIC,EAAQjB,EAAQ,oBAAqBS,EAASC,IAQjDQ,aAAc,OAIdC,UAAW,GAEXC,eAAgBb,EAEhBc,SAAU,YACVC,aAAc,EACdC,OAAQ,EAIRC,iBAAkB,EAIlBC,oBAAqBX,EAASY,eAI9BC,qBAAsBb,EAASc,gBAE/BC,oBAAqB,WACpBC,KAAKC,aAGNC,WAAY,WACXF,KAAK3B,QAAQ2B,KAAKG,cAAc,WAAW,YAC3CrB,EAAKsB,aAAaJ,KAAKK,YAAaL,KAAM,kBAAoB,YAAa,WAAY,QAAS,WAAY,cAAe,cAC3HlB,EAAKsB,aAAaJ,KAAKM,WAAYN,KAAM,iBAAmB,WAAY,YAAa,WAAY,YAAa,YAAa,QAAS,gBACpIA,KAAKO,QAAU,IAAIP,KAAKH,qBAAqBG,MAC7CA,KAAKQ,OAAS,IAAIR,KAAKL,oBAAoBK,MAEvCA,KAAKS,KAAKC,kBACbV,KAAKW,oBAAoBC,MAAMC,MAAQ,KAIzCC,QAAS,WAGR,IAAI,IAAIC,KAFRhC,EAAK+B,QAAQd,KAAKM,mBACXN,KAAKM,WACCN,KAAKC,SACjBD,KAAKgB,mBAAmBhB,KAAKC,SAASc,IACtChC,EAAK+B,QAAQd,KAAKC,SAASc,IAE5Bf,KAAKC,YACFD,KAAKiB,QACPjB,KAAKiB,OAAOH,UAEbd,KAAKkB,UAAUC,YAIhBC,MAAO,WACH9C,EAAI,OAASA,EAAI,WAAaA,EAAI,SACpC0B,KAAKqB,gBAAgBD,QAErBpB,KAAKG,cAAciB,SAIrBE,aAAc,SAASC,GACtB,IAAIC,EAAMxB,KAAKyB,UAAYF,EAExBC,EAAGX,QAAUa,MAAMF,EAAGX,OACxBb,KAAKX,UAAYmC,EAAGX,MAAQ,KAE5Bb,KAAKX,UAAYmC,EAAGX,QAAUW,EAAGG,SAAW,OAAS3B,KAAKX,WAE3DW,KAAK4B,aAAeJ,EAAGK,aAAa,aACpC7B,KAAK8B,YAAcN,EAAGO,YAAY,aAClC/B,KAAK2B,SAAWH,EAAGG,SAChB3B,KAAK2B,WACP3B,KAAKG,cAAcS,MAAMoB,SAAW,UAErChC,KAAKiC,gBAAkBC,QAA2B,GAAnBV,EAAGW,MAAMC,QAExCpC,KAAKqC,gBAELrC,KAAKsC,mBAGNtB,mBAAoB,SAASuB,GAIzBA,GACFpE,EAAMqE,QAAQjE,EAAM,aAAcgE,GAAWE,IAAIzE,EAAM0E,QAAS,SAASC,GACrEA,EAAEC,kBACJD,EAAE7B,iBACK6B,GACCA,EAAEE,SAAWF,EAAEE,QAAQC,YAC/BH,EAAEE,QAAQC,WAAWC,YAAYJ,EAAEE,YAMvChB,YAAa,SAASmB,EAAYb,GACjCnC,KAAK4B,aAAaoB,EAAYb,GAC3Ba,GAAc,GAChBhD,KAAKgB,mBAAmBhB,KAAKiD,WAAWD,KAI1CjB,WAAY,SAASiB,EAAYb,EAAOI,GACvCvC,KAAK8B,YAAYkB,EAAYb,EAAOI,GACpC,IAAIW,EAAIlD,KAAKS,KACbtC,EAAMqE,QAAQjE,EAAM,qBAAsBgE,GAAY,SAASY,GAC9D,GAAGA,GAAKA,EAAEL,WAAW,CACpB,IAAIM,EAAKD,EAAEE,aAAa,cACpBC,EAAUC,OAAOC,SAASzE,EAAK0E,KAAKN,EAAG,WAAY,IAEnDR,GADUO,EAAEQ,QAAQJ,GAChBtF,EAAM2F,KAAKP,IAChBT,GACFQ,EAAEL,WAAWc,aAAajB,EAAEE,QAASM,GACjCR,EAAEkB,UACLlB,EAAEmB,UAEH/F,EAAK+C,QAAQqC,IAEbA,EAAEY,UAAY,KAGd/D,OAGJqC,cAAe,WAEdrC,KAAKgE,WAAY,EACjB,IAAI,IAASC,EAALC,EAAE,EAASD,EAAIjE,KAAKyB,UAAUU,MAAM+B,GAAKA,IAChD,IAAI,IAASC,EAALpD,EAAE,EAAUoD,EAAKF,EAAIlD,GAAKA,IACjCoD,EAAKC,KAAOpE,KACZA,KAAKgE,UAAYhE,KAAKgE,WAAaG,EAAKE,SAG1C,OAAOrE,KAAKgE,WAGb1B,gBAAiB,WAEhBtC,KAAKQ,OAAO8D,SAEZtE,KAAKO,QAAQ+D,UAGdC,kBAAmB,WAClB,IAAIC,EAAiBxE,KAAKyE,gBACtBzC,EAAWjD,EAAK6B,MAAMZ,KAAKG,cAAe,YAM9C,OALGH,KAAK2B,WAAaK,GAAwB,UAAZA,EAChCwC,GAAiB,EACG,UAAZxC,IACRwC,GAAiB,GAEVA,EAAiB3F,EAAQ6F,eAAe/B,EAAI,GAGrDgC,gBAAiB,WAChB,IAAIC,EAAI5E,KAAK6E,kBACb,OAAOD,GAAKA,EAAEE,WAAcF,EAAEE,WAAWC,aAAehG,EAAK6B,MAAMgE,EAAEE,WAAY,SAAY,GAG9FE,gBAAiB,SAASnE,GACzBb,KAAK6E,kBAAkBC,WAAWlE,MAAMC,MAAQA,EAAQ,KACrDb,KAAKX,YACPW,KAAKX,UAAYwB,EAAQ,OAI3BoE,SAAU,WACT,OAAOjF,KAAKX,WAAcW,KAAK2E,kBAAkB3E,KAAKuE,oBAAsB,MAG7EW,gBAAiB,WAChB,OAAOC,KAAKC,IAAI,EAAGrG,EAAKsG,eAAerF,KAAK6C,SAASF,EAAI3C,KAAKuE,qBAAuB,MAGtFe,OAAQ,WACPtF,KAAKG,cAAcS,MAAM2E,OAAS,GAClCvF,KAAKwF,eACFxF,KAAKN,iBAAmB,IAC1BM,KAAKgF,gBAAgBhF,KAAK2E,kBAAoB3E,KAAKN,iBACnDM,KAAKN,iBAAmB,GAEzB,IAAIyC,EAAQnC,KAAKS,KAAKgF,OAAOtD,MACzBuD,EAAatH,EAAKuH,MAAM3F,KAAM,SAAS4F,EAAMC,IAC/C7F,KAAKS,KAAKC,kBAAoBmF,GAAUA,GAIzC,IAHA,IAAIC,EAAMD,GAAQ,EAAE,EAChBE,EAAM/F,KAAKQ,OAAOwF,iBAAiBJ,GAAQE,EAC3C3B,EAAOhC,EAAM4D,GACX5B,GAAQA,EAAK8B,iBAAyD,QAAtC9B,EAAK8B,gBAAgBrF,MAAMsF,SAEhE/B,EAAOhC,EADP4D,GAAOD,GAGR,OAAG3B,EACKA,EAAK8B,gBAEN,OAER,GAAGjG,KAAKS,KAAK0F,kBAAoBnG,KAAKiC,gBAAgB,CAClDjC,KAAKiB,QACPjB,KAAKiB,OAAOH,UAMVd,KAAKoG,cACPrH,EAAK+B,QAAQd,KAAKoG,cAEnBpG,KAAKoG,aAAerH,EAAK4E,KALJ,0BAMlB3D,KAAKqG,WACPtH,EAAK+B,QAAQd,KAAKqG,WAEnBrG,KAAKqG,UAAYtH,EAAK4E,KARJ,uBASb3D,KAAKoG,eACTpG,KAAKoG,aAAerH,EAAKuH,OAAO,OAC/BC,GAZmB,yBAanBC,MAAS,2BACPhI,EAAIiI,QACPzG,KAAK0G,MAAM1G,KAAKoG,cAGhBpG,KAAKqG,UAAYtH,EAAKuH,OAAO,OAC5BC,GAlBgB,sBAmBhBC,MAAS,wBACPhI,EAAIiI,QACPzG,KAAK0G,MAAM1G,KAAKqG,YAEjBrG,KAAK2G,SAAW5H,EAAK6H,WAAW5G,KAAKoG,cAErC,IAAIS,EAAe9H,EAAK6H,WAAW5G,KAAK6E,kBAAkBC,WAAWgC,KAAK,IAAIlC,EAE9E5E,KAAKiB,OAAS,IAAIvC,EAAOsB,KAAK6E,kBAAkBC,WAAWgC,KAAK,IAC/DC,YAAY,EACZC,QAAU,cAAgBhH,KAAKS,KAAK8F,IACpCU,UAAWjH,KAAKkH,MAChBC,cAAc,EACdC,YAAahJ,EAAKuH,MAAM3F,KAAM,SAASqH,GACtCrH,KAAKQ,OAAO8G,cAAcD,IACtBrH,KAAKQ,OAAO+G,oBAAoBF,IAAMrH,KAAKQ,OAAOgH,mBAAmBH,KACxErH,KAAKQ,OAAOiH,UAAUJ,KAAOrH,KAAKQ,OAAOkH,SACzC1H,KAAKQ,OAAOmH,kBAAkBN,IAE3BrH,KAAKS,KAAKmH,YACZ5H,KAAKS,KAAKmH,WAAWC,UAAS,GAG5BR,EAAES,UAAYxJ,EAAI,MAAQ,EAAI,EAAI,IACpCI,EAAOqJ,UAAUX,YAAYY,KAAKhI,KAAKiB,OAAQoG,MAIlDY,YAAa7J,EAAKuH,MAAM3F,KAAM,SAASqH,GACtC,IAAIa,EAAMlI,KAAKiB,OACZiH,EAAIC,iBAAiBd,IACvB3I,EAAOqJ,UAAUE,YAAYG,MAAMF,EAAK/G,aAG1CkH,kBAAmBjK,EAAKuH,MAAM3F,KAAM,SAAS6F,GAC5C,IAAIqC,EAAMlI,KAAKiB,OACf,GAAGiH,EAAII,SAAWJ,EAAIK,cAAgBL,EAAIrC,QAAUA,EAApD,CACGqC,EAAIK,cAAgB7C,EAAWwC,EAAIK,aAAcL,EAAIrC,SACvDqC,EAAIM,iBAAiB9C,EAAWwC,EAAIK,aAAcL,EAAIrC,QAASqC,EAAIrC,OAAS,QAAU,UAEvFnH,EAAOqJ,UAAUM,kBAAkBL,KAAKE,EAAKrC,GAE7C,IAAI4C,EAAS5C,EAASqC,EAAIK,aAAe7C,EAAWwC,EAAIK,aAAcL,EAAIrC,QACtE6C,EAAS,EAERD,IACJA,EAASP,EAAIK,aACbG,EAAS3J,EAAK6H,WAAW6B,GAAQ9F,EAAI3C,KAAK2G,SAAShE,EAAE,EAAI,GAG1D,IAAIgG,EAAM5J,EAAK6J,SAASH,GAAQ,GAC5BI,EAAO1D,KAAK2D,MAAMH,EAAII,EAAI/I,KAAK2G,SAAShE,EAAE,EAAI+F,GAElD3J,EAAK6B,MAAMZ,KAAKoG,aAAc,aAAc,WAC5CrH,EAAK6B,MAAMZ,KAAKqG,UAAW,aAAc,WACzCtH,EAAK6B,MAAMZ,KAAKoG,cACfyC,KAAQA,EAAO,KACfG,IAASnC,EAAe8B,EAAIM,EAAK,OAGlClK,EAAK6B,MAAMZ,KAAKqG,WACfwC,KAAQA,EAAO,KACfG,IAASL,EAAIM,EAAIjJ,KAAK2G,SAAS/B,EAAK,OAGlCsD,EAAIK,cAAgB7C,EAAWwC,EAAIK,aAAcL,EAAIrC,SACvDqC,EAAIgB,cAAcxD,EAAWwC,EAAIK,aAAcL,EAAIrC,QAASqC,EAAIrC,OAAS,QAAU,aAGrFsD,oBAAqB/K,EAAKuH,MAAM3F,KAAM,WACrC,IAAIkI,EAAMlI,KAAKiB,OACXiH,EAAIK,eACLL,EAAIK,cAAgB7C,EAAWwC,EAAIK,aAAcL,EAAIrC,SACvDqC,EAAIM,iBAAiB9C,EAAWwC,EAAIK,aAAcL,EAAIrC,QAASqC,EAAIrC,OAAS,QAAU,UAEvF7F,KAAK0G,MAAM1G,KAAKoG,cAChBpG,KAAK0G,MAAM1G,KAAKqG,WAChB3H,EAAOqJ,UAAUoB,oBAAoBnB,KAAKE,MAE3CpH,QAAS1C,EAAKuH,MAAM3F,KAAM,WACzB3B,EAAQ+K,WAAWpJ,KAAKqJ,cACxBhL,EAAQiL,YAAYtJ,KAAKuJ,aACzB7K,EAAOqJ,UAAUjH,QAAQkH,KAAKhI,KAAKiB,QAChCjB,KAAKoG,eACPrH,EAAK+B,QAAQd,KAAKoG,qBACXpG,KAAKoG,cAEVpG,KAAKqG,YACPtH,EAAK+B,QAAQd,KAAKqG,kBACXrG,KAAKqG,aAGdmD,YAAapL,EAAKuH,MAAM3F,KAAM,WAC7BtB,EAAOqJ,UAAUyB,YAAYxB,KAAKhI,KAAKiB,QACvCjB,KAAK0G,MAAM1G,KAAKoG,cAChBpG,KAAK0G,MAAM1G,KAAKqG,eAIlBrG,KAAKqJ,aAAehL,EAAQA,QAAQ2B,KAAKiB,OAAQ,YAAajB,KAAM,cACpEA,KAAKuJ,YAAclL,EAAQoL,UAAU,mBAAoBzJ,KAAM,oBAC/DA,KAAKiB,OAAO6C,YAId4C,MAAO,SAASd,GACf7G,EAAK6B,MAAMgF,GACVoD,IAAK,WACLU,WAAc,YAIhBC,iBAAkB,SAAS1I,EAAQ2I,EAAOC,GACzC,GAAG3K,EAAQ4K,UAAUrB,SAAWzI,KAAKiB,OAArC,CAGAjB,KAAKiB,OAAO8I,YAAc/J,KAAKiB,OAAOsH,aACtCvI,KAAKiB,OAAO+I,cAAgBhK,KAAKiB,OAAO4E,OACxC,IAAIoE,EAAQjK,KAAKS,KAAKwJ,MAAMA,MACxBC,EAAUD,EAAMhJ,EAAOgG,WACvBkD,EAAUF,EAAMjK,KAAKkH,OACtBiD,GAAWD,IACbA,EAAQE,uBACRD,EAAQC,0BAIVC,WAAY,SAASpJ,EAAQ2I,EAAOC,GACnC,GAAG3K,EAAQ4K,UAAUrB,SAAWzI,KAAKiB,OAArC,CAMAjB,KAAK0G,MAAM1G,KAAKoG,cAChBpG,KAAK0G,MAAM1G,KAAKqG,WAEhB,IAAIiE,EAAS,SAASnH,GACrB,OAAOA,EAAIpE,EAAK0E,KAAKN,EAAG,OAAS,MAE9BR,EAAI5D,EAAKwL,UAAUX,EAAM,IAAIjH,EACjC,GAAG1B,EAAOgG,YAAcjH,KAAKkH,MAAM,CAClC,IAAI+C,EAAQjK,KAAKS,KAAKwJ,MAAMA,MACxBC,EAAUD,EAAMhJ,EAAOgG,WACvBkD,EAAUF,EAAMjK,KAAKkH,OACtBgD,EAAQ7K,WAAkC,QAArB6K,EAAQ7K,WAC/B6K,EAAQlF,gBAAgBkF,EAAQvF,kBAAoBhC,GAElDwH,EAAQ9K,WAAkC,QAArB8K,EAAQ9K,WAC/B8K,EAAQnF,gBAAgBmF,EAAQxF,mBAGlC,IAAI6F,EAAMxK,KAAKiB,OAAO8I,YAClBU,EAAMzK,KAAKiB,OAAO+I,eACrBhK,KAAKS,KAAKC,kBAAoB+J,GAAOA,GACtC,IAAIhF,EAASzF,KAAKS,KAAKgF,OACnBM,EAAM/F,KAAKkH,aACRlH,KAAKiB,OAAO8I,mBACZ/J,KAAKiB,OAAO+I,cAEnBvE,EAAOiF,WACNzJ,EAAOgG,UACPlB,EACAuE,EAAOV,EAAM,IACbU,EAAOE,GACPC,QApCGvL,EAAQ4K,UAAU7I,SAAWjB,KAAKiB,SACpCjB,KAAK2K,iBAAkB,IAsC1BnF,aAAc,WACbxF,KAAK6E,kBAAkBd,UAAY/D,KAAKQ,OAAOoK,aAAa5K,KAAK6K,mBAC9D7K,KAAKgE,YACPhE,KAAK8K,aAAe9K,KAAKkF,kBACzBlF,KAAK6E,kBAAkBC,WAAWlE,MAAMC,MAAQb,KAAK8K,cAEtDhM,EAAKiM,KAAK/K,KAAM,eAAgB,EAAGA,KAAKyB,UAAUU,MAAOnC,KAAK6E,qBAI/DgG,kBAAmB,SAASG,GAC3B,IAAI7H,EAAI6H,EAAOC,MAAQD,EAAOvK,KAAKyK,YAAYF,GAC5C,QAAQG,KAAKhI,KACfA,EAAI,UAEL,IAAIiI,GAAQ,iCAaZ,OAXGJ,EAAO9D,OAAS8D,EAAOvK,KAAK4K,eAC9BD,EAAIE,KAAK,MAETF,EAAMA,EAAIG,QAAS,IAChBP,EAAOvK,KAAK+K,SAAW,EAAI,kBAAoB,oBAC/C,2CACAR,EAAOvK,KAAK+K,SAAW,EAAI,UAAY,UACvC,yEACA,uCAEJJ,EAAMA,EAAIG,QAAQpI,EAAG,kBACVsI,KAAK,KAGjBC,OAAQ,WACP1L,KAAK2L,cACL3L,KAAK4L,cAGNC,cAAe,SAASC,GACvB,IAAIC,EAAY/L,KAAKgM,cAAa,EAClC,QAAuBC,GAApBjM,KAAKgM,aAA4BF,EACnC,GAAG9L,KAAK2B,SACP3B,KAAKgM,aAAc,MACf,CACJ,IAAIpL,EAAQ7B,EAAK6B,MAAMZ,KAAKG,cAAe,YAE1CH,KAAKgM,YADM,UAATpL,IAEe,UAATA,GAGYZ,KAAKG,cAAc4E,YAAc/E,KAAKuE,oBAAsBvE,KAAKK,YAAY0E,aAOpG,OAHGgH,IAAc/L,KAAKgM,aACrBhM,KAAKS,KAAK6D,SAEJtE,KAAKgM,aAGbvH,cAAe,SAASqH,GACvB,IAAIC,EAAY/L,KAAKkM,cAAa,EAClC,QAAuBD,GAApBjM,KAAKkM,aAA4BJ,EACnC,GAAG9L,KAAK2B,SACP3B,KAAKkM,aAAc,MACf,CACJ,IAAItL,EAAQ7B,EAAK6B,MAAMZ,KAAKG,cAAe,YAE1CH,KAAKkM,YADM,UAATtL,IAEe,UAATA,GAGYZ,KAAKG,cAAcgM,aAAenM,KAAKG,cAAciM,cAO5E,OAHGL,IAAc/L,KAAKkM,aACrBlM,KAAKS,KAAK6D,SAEJtE,KAAKkM,aAGb9B,qBAAsB,WAErB,IAAIiC,GAAS,EACbrM,KAAKS,KAAK6L,aAAe,GACzB,IAAIC,EAAYhO,EAAM,KAAMyB,KAAK6E,mBAC7B2H,EAAcrO,EAAMsE,IAAI8J,EAAW,SAASE,EAAGC,GAClD,IAAI/J,EAAI8J,EAAE7L,MAAMC,MAEhB,GADA9B,EAAK0E,KAAKgJ,EAAG,OAAQC,GAClB/J,GAAoB,KAAfA,EAAEgK,OAAO,GAChBN,GAAS,OACJ,GAAG1J,GAAoB,MAAfA,EAAEgK,OAAO,GACtB,OAAOpJ,OAAOC,SAASb,EAAG,IAE3B,OAAO5D,EAAK6H,WAAW6F,GAAG9J,IAE3B,QAAG0J,IACFlO,EAAMqE,QAAQxC,KAAKS,KAAKgF,OAAOtD,MAAO,SAASgC,EAAM4B,GACpD,GAAG5B,EAAKC,MAAQpE,KAAK,CACpB,IAAI4M,EAAWzI,EAAKC,KAAKyI,kBAAkB1I,EAAK+C,OAChD,GAAG0F,GAAY7N,EAAK+N,QAAQF,EAAU,QAAQ,CAC7C,IAAIF,EAAOnJ,OAAOC,SAASzE,EAAK0E,KAAKmJ,EAAU,SAC/C5M,KAAK+M,YAAYhH,EAAKyG,EAAYE,IAClC3N,EAAKiO,WAAWJ,EAAU,WAG1B5M,OACI,IAKT2L,YAAa,SAASsB,GACrB,IAAIjN,KAAKS,KAAKyM,YAAY,CACzB,IAAItI,EAAK5E,KAAK6C,QAAQjC,MAAM2E,QAAU/B,SAASxD,KAAK6C,QAAQjC,MAAM2E,OAAO4H,QAAQ,KAAK,IAAK,KAAQnN,KAAK6C,QAAQuJ,aAC5GgB,EAAOpN,MAWRiN,GAAgBjN,KAAK2B,UAVM,WAE7B,IADA,IAAI0L,EACItM,EAAI,EAAGA,EAAIqM,EAAK3M,KAAKwJ,MAAMA,MAAM7H,SAAUrB,EAElD,IADAsM,EAAID,EAAK3M,KAAKwJ,MAAMA,MAAMlJ,MACjBqM,GAAQC,EAAExB,gBAClB,OAAO,EAGT,OAAO,EAE4ByB,MACnC1I,GAAK/F,EAAQ6F,eAAeE,GAE7B9F,EAAKyO,iBAAiBvN,KAAKG,cAAeyE,GAE3C5E,KAAKyE,eAAc,IAGpBmH,WAAY,WACR5L,KAAKgE,YAEPhE,KAAK8K,aAAe9K,KAAKkF,kBACzBlF,KAAK6E,kBAAkBC,WAAWlE,MAAMC,MAAQb,KAAK8K,cAItD,IAAInI,EAAI3C,KAAKG,cAAc4E,YAAc/E,KAAKuE,oBAC1CvE,KAAK2K,iBAGRhI,EAAIwC,KAAKqI,IAAI7K,EAAG3C,KAAK2E,mBAAqB,KAC1C3E,KAAK2K,iBAAkB,GAHvBhI,EAAIwC,KAAKC,IAAIzC,EAAG3C,KAAK2E,mBAAqB,KAKlC3E,KAAKK,YACXO,MAAMC,MAAQ8B,EACjB3C,KAAK6L,eAAc,IAGpB4B,QAAS,SAAS9K,EAAGiC,GACpB,IAAI8I,EAAK1N,KAAK6C,QAAQjC,MAClB+M,EAAK3N,KAAKM,WAAWM,MAEtB+B,IACF+K,EAAG7M,MAAQ8B,EACXgL,EAAG9M,MAAQ8B,GAEZ+K,EAAGnI,OAAUX,GAAK,EAAIA,EAAI,KAAO,IAGlCgJ,UAAW,SAAS5K,GACnB,IAAI6K,EAAU7N,KAAK8N,cAAc9K,GAGjC,OAFAhD,KAAK+N,SAAS/K,EAAY6K,GAEnBA,GAGRC,cAAe,SAAS9K,GACvB,IAAI4C,EAAOoI,SAASC,cAAc,OAalC,OAZArI,EAAKsI,UAAYlO,KAAKT,SAAW,MAC7BS,gBAAgB/B,EAAMwC,KAAK0N,aAC9BpP,EAAK0E,KAAKmC,EAAK,OAAO,iBAEtB7G,EAAK0E,KAAKmC,EAAK,OAAO,OACS,QAA3B5F,KAAKS,KAAK2N,eACbxI,EAAKyI,aAAa,gBAAiB,UAGrCzI,EAAK9G,EAAKwP,aAAetO,KAAKuG,GAC9BX,EAAK9G,EAAKyP,aAAevL,EACzBhD,KAAKC,SAAS+C,GAAc4C,EACrBA,GAGRmI,SAAU,SAAS/K,EAAYT,GAE9BvC,KAAKwO,gBAAgBxL,EAAYT,GAEjCvC,KAAKyO,SAASzL,EAAYT,IAK3BiM,gBAAiB,SAASxL,EAAYT,GACrCA,EAAUwB,UAAY/D,KAAKO,QAAQqK,aAAa5H,EAAYA,GACzDhD,KAAKgE,WAAahE,KAAK8K,eAEzBvI,EAAUuC,WAAWlE,MAAMC,MAAQb,KAAK8K,cAEzChM,EAAKiM,KAAK/K,KAAM,cAAegD,EAAYhD,KAAKyB,UAAUU,MAAOI,KAGlEmM,WAAW,SAAS1L,GAChBA,GAAc,GAChBhD,KAAKgB,mBAAmBhB,KAAKiD,WAAWD,IAEzChD,KAAKS,KAAKkO,KAAKC,KAAK5O,KAAMgD,UACnBhD,KAAKC,SAAS+C,IAGtBC,WAAY,SAASD,GACpB,OAAOhD,KAAKC,SAAS+C,IAGtB6L,YAAa,SAAS7L,EAAY8L,GACjC,IAAI7K,EAAMjE,KAAKiD,WAAWD,GAC1B,GAAGiB,EACF,OAAOjE,KAAKO,QAAQsO,YAAY5K,EAAK6K,IAIvCjC,kBAAmB,SAASiC,GAC3B,GAAG9O,KAAK6E,kBACP,OAAO7E,KAAKQ,OAAOqO,YAAY7O,KAAK6E,kBAAmBiK,IAKzDL,SAAU,SAASzL,EAAYT,GAhoBb,IAASwM,EAioB1BxM,EAAUyM,YAhoBoB/C,IADJ8C,EAioBMxM,GAhoBnB3B,MAAMqO,QAAuBF,EAAO1L,aAAa,SAAW0L,EAAOnO,MAAMqO,QAioBtFjP,KAAKkP,aAAalM,EAAYT,IAG/B2M,aAAc,SAASlM,EAAYT,GAC/BA,GACFvC,KAAKmP,eAAenM,EAAYT,IAIlC4M,eAAgB,SAASnM,EAAYT,GACpCvC,KAAKS,KAAKyO,aAAalM,EAAYT,IAIpC6M,UAAW,SAASpM,GACnB,IAAI6K,EAAU7N,KAAKiD,WAAWD,GAK9B,OAJG6K,IACFA,EAAQjN,MAAM2E,OAAS,GACvBvF,KAAK+N,SAAS/K,EAAY6K,IAEpBA,GAGRwB,gBAAiB,SAASrM,GACzBhD,KAAKkP,aAAalM,EAAYhD,KAAKiD,WAAWD,KAI/CsM,QAAS,EACTC,YAAY,EACZC,eAAe,EAEfC,SAAU,SAASC,IACfpR,EAAI,OAAS,IAAMA,EAAI,aACzB0B,KAAKwP,eAAgB,GAGtB,IAAIG,EAAQ3P,KAAKS,KAAKC,gBACtB,GAAGV,KAAKuP,YAAc,EAAE,CACvB,IAAKI,GAA6B,GAApB3P,KAAKuP,aAAsBI,GAA8B,IAArB3P,KAAKuP,YAAmB,CACzE,IAAIK,EAAI7Q,EAAKwL,UAAUvK,KAAKW,qBACzBrC,EAAI,MACN0B,KAAKW,oBAAoBC,MAAMC,MAAQ+O,EAAEjN,EAAI3C,KAAKuE,oBAAsB,KAChEjG,EAAI,aAEZ0B,KAAKW,oBAAoBC,MAAMC,MAAQ+O,EAAEjN,EAAI3C,KAAKuE,oBAAsB,KAGxEvE,KAAKG,cAAc0P,WAAaF,EAC/B3P,KAAKG,cAAc2P,YAAc9P,KAAKG,cAAc4P,YACpD/P,KAAKG,cAAc4P,YAAc/P,KAAKG,cAAc2P,aAGvD9P,KAAKuP,cAENvP,KAAKM,WAAWuP,WAAa7P,KAAKG,cAAc0P,WAEhD,IAAI7G,EAAMhJ,KAAKG,cAAc6P,UAC1BhH,IAAQhJ,KAAKsP,SACftP,KAAKS,KAAKwP,SAASjH,GAEpBhJ,KAAKwP,eAAgB,GAGtBU,aAAc,SAASC,GAOtB,OALAnQ,KAAKsP,QAAUa,EACXnQ,KAAKwP,gBAERxP,KAAKG,cAAc6P,UAAYG,GAEzBnQ,KAAKG,cAAc6P,WAI3BI,eAAgB,SAAS/I,GACrBrH,KAAKO,QAAQ+G,cAAcD,IAC7BrH,KAAKS,KAAK4P,eAAehJ,IAI3BiJ,cAAe,SAASjJ,GACpBrH,KAAKQ,OAAO8G,cAAcD,IAC5BrH,KAAKS,KAAK8P,cAAclJ,IAK1BmJ,qBAAsB,SAASnJ,GAC9B,OAAOrH,KAAKO,QAAQkQ,cAAcpJ,IAGnCqJ,oBAAqB,SAASrJ,GAC7B,OAAOrH,KAAKQ,OAAOiQ,cAAcpJ,IAIlC0F,YAAa,SAAS4D,EAASC,GAC9B5Q,KAAKS,KAAKoQ,aAAaF,EAASC,EAAU,OAG3CtM,OAAQ,WACP,GAAItE,KAAK6C,QAAT,CAGA7C,KAAKO,QAAQ+D,SACbtE,KAAKS,KAAK6D,SAGV,IAAIuE,EAAO7I,KAAKG,cAAc0P,WAC9B7P,KAAKG,cAAc0P,WAAahH,EAChC7I,KAAKM,WAAWuP,WAAahH,MAI3BiI,EAAc5S,EAAQ,yBAA0Be,GACnD8R,UAAW,WACV,IAAIC,EAAKxS,EAAIyS,IAETC,EAAIF,EAAG/C,cAAc,SACzBiD,EAAEC,YAAcD,EAAEE,YAAc,IAChCF,EAAEhD,UAAY,qBACdgD,EAAEtQ,MAAMgI,SAAW,WACnBsI,EAAEtQ,MAAMyQ,OAAS,KACjBH,EAAEtQ,MAAM0Q,OAAS,MACjB,IAAIC,EAAIP,EAAG/C,cAAc,SACrBuD,EAAKR,EAAG/C,cAAc,MACtBwD,EAAKT,EAAG/C,cAAc,MACtByD,EAAMV,EAAG/C,cAAc,MAC3BuD,EAAGtD,UAAY,yBACfwD,EAAIxD,UAAY,8BAChBwD,EAAI9Q,MAAMC,MAAQ,OAClB,IAAkC+E,EAO7B+L,EAAOC,EAPR3Q,EAASjB,KAAK8J,QAAQ7I,OAC1B,GAAGA,EAAO4Q,QAETjM,EAAO3E,EAAO6Q,mBAAmB7Q,EAAO8Q,QAAQ/R,KAAK8J,QAAQF,MAAM,GAAGrD,IAAIyL,KAAM,UAAUpM,UAK1F,GAAiC,OAFjCA,EAAO5F,KAAK8J,QAAQF,MAAM,GAAGqI,WAAU,IAE/BC,QAAQC,cAEfR,EAAQX,EAAG/C,cAAc,UACzB2D,EAAQZ,EAAG/C,cAAc,UACnBmE,YAAYxM,GAClB+L,EAAMS,YAAYR,GAClBhM,EAAO+L,OACF,GAAiC,MAA9B/L,EAAKsM,QAAQC,cAAsB,CAE3CR,EAAQX,EAAG/C,cAAc,SACzB2D,EAAQZ,EAAG/C,cAAc,SACzB,IAAIoE,EAAIrB,EAAG/C,cAAc,MACzB0D,EAAMR,YAAcQ,EAAMP,YAAc,IACxCiB,EAAED,YAAYxM,GACdgM,EAAMQ,YAAYC,GAClBV,EAAMS,YAAYR,GAClBhM,EAAO+L,EAGT/L,EAAKW,GAAK,GACVkL,EAAGW,YAAYxM,GACf4L,EAAGY,YAAYV,GACfF,EAAGY,YAAYX,GACf1S,EAAK6B,MAAM4Q,EAAI,UAAW,IAC1BD,EAAEa,YAAYZ,GAEdN,EAAEkB,YAAYb,GACdvR,KAAK4F,KAAOsL,EAEZ,IAAIoB,EAAIpT,EAAQ4K,UAChB9J,KAAKuS,WAAaD,EAAEE,SACpBF,EAAEE,SAAW,GAEd1R,QAAS,WACR5B,EAAQ4K,UAAU0I,SAAWxS,KAAKuS,WAClCvS,KAAKkB,UAAUC,cAIbsR,EAAgBvT,EAAQ4K,UAAU4I,WAStC,OARAxT,EAAQ4K,UAAU4I,WAAa,WAE9B,YAAqBzG,IADXjM,KAAKiB,OACRgG,WAA4BlI,EAAK4T,SAASnU,EAAIiI,OAAO,cAGrDgM,EAAczK,KAAK9I,EAAQ4K,WAF1B,IAAIgH,EAAY9Q,OAKlBb","file":"../../grid/_View.js","sourcesContent":["define([\r\n\t\"dojo\",\r\n\t\"dijit/registry\",\r\n\t\"../main\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/sniff\",\r\n\t\"dojo/query\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/text!./resources/View.html\",\r\n\t\"dojo/dnd/Source\",\r\n\t\"dijit/_Widget\",\r\n\t\"dijit/_TemplatedMixin\",\r\n\t\"dojox/html/metrics\",\r\n\t\"./util\",\r\n\t\"dojo/_base/html\",\r\n\t\"./_Builder\",\r\n\t\"dojo/dnd/Avatar\",\r\n\t\"dojo/dnd/Manager\"\r\n], function(dojo, dijit, dojox, declare, array, lang, connect, has, query,\r\n\twin, template, Source, _Widget, _TemplatedMixin, metrics, util, html, _Builder, Avatar, Manager){\r\n\r\n\t// a private function\r\n\tvar getStyleText = function(inNode, inStyleText){\r\n\t\treturn inNode.style.cssText == undefined ? inNode.getAttribute(\"style\") : inNode.style.cssText;\r\n\t};\r\n\r\n\t// some public functions\r\n\tvar _View = declare('dojox.grid._View', [_Widget, _TemplatedMixin], {\r\n\t\t// summary:\r\n\t\t//\t\tA collection of grid columns. A grid is comprised of a set of views that stack horizontally.\r\n\t\t//\t\tGrid creates views automatically based on grid's layout structure.\r\n\t\t//\t\tUsers should typically not need to access individual views directly.\r\n\t\t//\r\n\t\t// defaultWidth: String\r\n\t\t//\t\tDefault width of the view\r\n\t\tdefaultWidth: \"18em\",\r\n\r\n\t\t// viewWidth: String\r\n\t\t//\t\tWidth for the view, in valid css unit\r\n\t\tviewWidth: \"\",\r\n\r\n\t\ttemplateString: template,\r\n\r\n\t\tclassTag: 'dojoxGrid',\r\n\t\tmarginBottom: 0,\r\n\t\trowPad: 2,\r\n\r\n\t\t// _togglingColumn: int\r\n\t\t//\t\tWidth of the column being toggled (-1 for none)\r\n\t\t_togglingColumn: -1,\r\n\t\t\r\n\t\t// _headerBuilderClass: Object\r\n\t\t//\t\tThe class to use for our header builder\r\n\t\t_headerBuilderClass: _Builder._HeaderBuilder,\r\n\t\t\r\n\t\t// _contentBuilderClass: Object\r\n\t\t//\t\tThe class to use for our content builder\r\n\t\t_contentBuilderClass: _Builder._ContentBuilder,\r\n\t\t\r\n\t\tpostMixInProperties: function(){\r\n\t\t\tthis.rowNodes = {};\r\n\t\t},\r\n\r\n\t\tpostCreate: function(){\r\n\t\t\tthis.connect(this.scrollboxNode,\"onscroll\",\"doscroll\");\r\n\t\t\tutil.funnelEvents(this.contentNode, this, \"doContentEvent\", [ 'mouseover', 'mouseout', 'click', 'dblclick', 'contextmenu', 'mousedown' ]);\r\n\t\t\tutil.funnelEvents(this.headerNode, this, \"doHeaderEvent\", [ 'dblclick', 'mouseover', 'mouseout', 'mousemove', 'mousedown', 'click', 'contextmenu' ]);\r\n\t\t\tthis.content = new this._contentBuilderClass(this);\r\n\t\t\tthis.header = new this._headerBuilderClass(this);\r\n\t\t\t//BiDi: in RTL case, style width='9000em' causes scrolling problem in head node\r\n\t\t\tif(!this.grid.isLeftToRight()){\r\n\t\t\t\tthis.headerNodeContainer.style.width = \"\";\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestroy: function(){\r\n\t\t\thtml.destroy(this.headerNode);\r\n\t\t\tdelete this.headerNode;\r\n\t\t\tfor(var i in this.rowNodes){\r\n\t\t\t\tthis._cleanupRowWidgets(this.rowNodes[i]);\r\n\t\t\t\thtml.destroy(this.rowNodes[i]);\r\n\t\t\t}\r\n\t\t\tthis.rowNodes = {};\r\n\t\t\tif(this.source){\r\n\t\t\t\tthis.source.destroy();\r\n\t\t\t}\r\n\t\t\tthis.inherited(arguments);\r\n\t\t},\r\n\r\n\t\t// focus\r\n\t\tfocus: function(){\r\n\t\t\tif(has('ie') || has('webkit') || has('opera')){\r\n\t\t\t\tthis.hiddenFocusNode.focus();\r\n\t\t\t}else{\r\n\t\t\t\tthis.scrollboxNode.focus();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsetStructure: function(inStructure){\r\n\t\t\tvar vs = (this.structure = inStructure);\r\n\t\t\t// FIXME: similar logic is duplicated in layout\r\n\t\t\tif(vs.width && !isNaN(vs.width)){\r\n\t\t\t\tthis.viewWidth = vs.width + 'em';\r\n\t\t\t}else{\r\n\t\t\t\tthis.viewWidth = vs.width || (vs.noscroll ? 'auto' : this.viewWidth); //|| this.defaultWidth;\r\n\t\t\t}\r\n\t\t\tthis._onBeforeRow = vs.onBeforeRow||function(){};\r\n\t\t\tthis._onAfterRow = vs.onAfterRow||function(){};\r\n\t\t\tthis.noscroll = vs.noscroll;\r\n\t\t\tif(this.noscroll){\r\n\t\t\t\tthis.scrollboxNode.style.overflow = \"hidden\";\r\n\t\t\t}\r\n\t\t\tthis.simpleStructure = Boolean(vs.cells.length == 1);\r\n\t\t\t// bookkeeping\r\n\t\t\tthis.testFlexCells();\r\n\t\t\t// accommodate new structure\r\n\t\t\tthis.updateStructure();\r\n\t\t},\r\n\t\t\r\n\t\t_cleanupRowWidgets: function(inRowNode){\r\n\t\t\t// Summary:\r\n\t\t\t//\t\tCleans up the widgets for the given row node so that\r\n\t\t\t//\t\twe can reattach them if needed\r\n\t\t\tif(inRowNode){\r\n\t\t\t\tarray.forEach(query(\"[widgetId]\", inRowNode).map(dijit.byNode), function(w){\r\n\t\t\t\t\tif(w._destroyOnRemove){\r\n\t\t\t\t\t\tw.destroy();\r\n\t\t\t\t\t\tdelete w;\r\n\t\t\t\t\t}else if(w.domNode && w.domNode.parentNode){\r\n\t\t\t\t\t\tw.domNode.parentNode.removeChild(w.domNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonBeforeRow: function(inRowIndex, cells){\r\n\t\t\tthis._onBeforeRow(inRowIndex, cells);\r\n\t\t\tif(inRowIndex >= 0){\r\n\t\t\t\tthis._cleanupRowWidgets(this.getRowNode(inRowIndex));\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonAfterRow: function(inRowIndex, cells, inRowNode){\r\n\t\t\tthis._onAfterRow(inRowIndex, cells, inRowNode);\r\n\t\t\tvar g = this.grid;\r\n\t\t\tarray.forEach(query(\".dojoxGridStubNode\", inRowNode), function(n){\r\n\t\t\t\tif(n && n.parentNode){\r\n\t\t\t\t\tvar lw = n.getAttribute(\"linkWidget\");\r\n\t\t\t\t\tvar cellIdx = window.parseInt(html.attr(n, \"cellIdx\"), 10);\r\n\t\t\t\t\tvar cellDef = g.getCell(cellIdx);\r\n\t\t\t\t\tvar w = dijit.byId(lw);\r\n\t\t\t\t\tif(w){\r\n\t\t\t\t\t\tn.parentNode.replaceChild(w.domNode, n);\r\n\t\t\t\t\t\tif(!w._started){\r\n\t\t\t\t\t\t\tw.startup();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdojo.destroy(n);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tn.innerHTML = \"\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t},\r\n\r\n\t\ttestFlexCells: function(){\r\n\t\t\t// FIXME: cheater, this function does double duty as initializer and tester\r\n\t\t\tthis.flexCells = false;\r\n\t\t\tfor(var j=0, row; (row=this.structure.cells[j]); j++){\r\n\t\t\t\tfor(var i=0, cell; (cell=row[i]); i++){\r\n\t\t\t\t\tcell.view = this;\r\n\t\t\t\t\tthis.flexCells = this.flexCells || cell.isFlex();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this.flexCells;\r\n\t\t},\r\n\r\n\t\tupdateStructure: function(){\r\n\t\t\t// header builder needs to update table map\r\n\t\t\tthis.header.update();\r\n\t\t\t// content builder needs to update markup cache\r\n\t\t\tthis.content.update();\r\n\t\t},\r\n\r\n\t\tgetScrollbarWidth: function(){\r\n\t\t\tvar hasScrollSpace = this.hasVScrollbar();\r\n\t\t\tvar overflow = html.style(this.scrollboxNode, \"overflow\");\r\n\t\t\tif(this.noscroll || !overflow || overflow == \"hidden\"){\r\n\t\t\t\thasScrollSpace = false;\r\n\t\t\t}else if(overflow == \"scroll\"){\r\n\t\t\t\thasScrollSpace = true;\r\n\t\t\t}\r\n\t\t\treturn (hasScrollSpace ? metrics.getScrollbar().w : 0); // Integer\r\n\t\t},\r\n\r\n\t\tgetColumnsWidth: function(){\r\n\t\t\tvar h = this.headerContentNode;\r\n\t\t\treturn h && h.firstChild ? (h.firstChild.offsetWidth || html.style(h.firstChild, 'width')) : 0; // Integer\r\n\t\t},\r\n\r\n\t\tsetColumnsWidth: function(width){\r\n\t\t\tthis.headerContentNode.firstChild.style.width = width + 'px';\r\n\t\t\tif(this.viewWidth){\r\n\t\t\t\tthis.viewWidth = width + 'px';\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetWidth: function(){\r\n\t\t\treturn this.viewWidth || (this.getColumnsWidth()+this.getScrollbarWidth()) +'px'; // String\r\n\t\t},\r\n\r\n\t\tgetContentWidth: function(){\r\n\t\t\treturn Math.max(0, html._getContentBox(this.domNode).w - this.getScrollbarWidth()) + 'px'; // String\r\n\t\t},\r\n\r\n\t\trender: function(){\r\n\t\t\tthis.scrollboxNode.style.height = '';\r\n\t\t\tthis.renderHeader();\r\n\t\t\tif(this._togglingColumn >= 0){\r\n\t\t\t\tthis.setColumnsWidth(this.getColumnsWidth() - this._togglingColumn);\r\n\t\t\t\tthis._togglingColumn = -1;\r\n\t\t\t}\r\n\t\t\tvar cells = this.grid.layout.cells;\r\n\t\t\tvar getSibling = lang.hitch(this, function(node, before){\r\n\t\t\t\t!this.grid.isLeftToRight() && (before = !before);\r\n\t\t\t\tvar inc = before?-1:1;\r\n\t\t\t\tvar idx = this.header.getCellNodeIndex(node) + inc;\r\n\t\t\t\tvar cell = cells[idx];\r\n\t\t\t\twhile(cell && cell.getHeaderNode() && cell.getHeaderNode().style.display == \"none\"){\r\n\t\t\t\t\tidx += inc;\r\n\t\t\t\t\tcell = cells[idx];\r\n\t\t\t\t}\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\treturn cell.getHeaderNode();\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t\t\tif(this.grid.columnReordering && this.simpleStructure){\r\n\t\t\t\tif(this.source){\r\n\t\t\t\t\tthis.source.destroy();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// Create the top and bottom markers\r\n\t\t\t\tvar bottomMarkerId = \"dojoxGrid_bottomMarker\";\r\n\t\t\t\tvar topMarkerId = \"dojoxGrid_topMarker\";\r\n\t\t\t\tif(this.bottomMarker){\r\n\t\t\t\t\thtml.destroy(this.bottomMarker);\r\n\t\t\t\t}\r\n\t\t\t\tthis.bottomMarker = html.byId(bottomMarkerId);\r\n\t\t\t\tif(this.topMarker){\r\n\t\t\t\t\thtml.destroy(this.topMarker);\r\n\t\t\t\t}\r\n\t\t\t\tthis.topMarker = html.byId(topMarkerId);\r\n\t\t\t\tif (!this.bottomMarker) {\r\n\t\t\t\t\tthis.bottomMarker = html.create(\"div\", {\r\n\t\t\t\t\t\t\"id\": bottomMarkerId,\r\n\t\t\t\t\t\t\"class\": \"dojoxGridColPlaceBottom\"\r\n\t\t\t\t\t}, win.body());\r\n\t\t\t\t\tthis._hide(this.bottomMarker);\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.topMarker = html.create(\"div\", {\r\n\t\t\t\t\t\t\"id\": topMarkerId,\r\n\t\t\t\t\t\t\"class\": \"dojoxGridColPlaceTop\"\r\n\t\t\t\t\t}, win.body());\r\n\t\t\t\t\tthis._hide(this.topMarker);\r\n\t\t\t\t}\r\n\t\t\t\tthis.arrowDim = html.contentBox(this.bottomMarker);\r\n\r\n\t\t\t\tvar headerHeight = html.contentBox(this.headerContentNode.firstChild.rows[0]).h;\r\n\t\t\t\t\r\n\t\t\t\tthis.source = new Source(this.headerContentNode.firstChild.rows[0], {\r\n\t\t\t\t\thorizontal: true,\r\n\t\t\t\t\taccept: [ \"gridColumn_\" + this.grid.id ],\r\n\t\t\t\t\tviewIndex: this.index,\r\n\t\t\t\t\tgenerateText: false,\r\n\t\t\t\t\tonMouseDown: lang.hitch(this, function(e){\r\n\t\t\t\t\t\tthis.header.decorateEvent(e);\r\n\t\t\t\t\t\tif((this.header.overRightResizeArea(e) || this.header.overLeftResizeArea(e)) &&\r\n\t\t\t\t\t\t\tthis.header.canResize(e) && !this.header.moveable){\r\n\t\t\t\t\t\t\tthis.header.beginColumnResize(e);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tif(this.grid.headerMenu){\r\n\t\t\t\t\t\t\t\tthis.grid.headerMenu.onCancel(true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// IE reports a left click as 1, where everything else reports 0\r\n\t\t\t\t\t\t\tif(e.button === (has('ie') < 9 ? 1 : 0)){\r\n\t\t\t\t\t\t\t\tSource.prototype.onMouseDown.call(this.source, e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tonMouseOver: lang.hitch(this, function(e){\r\n\t\t\t\t\t\tvar src = this.source;\r\n\t\t\t\t\t\tif(src._getChildByEvent(e)){\r\n\t\t\t\t\t\t\tSource.prototype.onMouseOver.apply(src, arguments);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\t_markTargetAnchor: lang.hitch(this, function(before){\r\n\t\t\t\t\t\tvar src = this.source;\r\n\t\t\t\t\t\tif(src.current == src.targetAnchor && src.before == before){ return; }\r\n\t\t\t\t\t\tif(src.targetAnchor && getSibling(src.targetAnchor, src.before)){\r\n\t\t\t\t\t\t\tsrc._removeItemClass(getSibling(src.targetAnchor, src.before), src.before ? \"After\" : \"Before\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tSource.prototype._markTargetAnchor.call(src, before);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar target = before ? src.targetAnchor : getSibling(src.targetAnchor, src.before);\r\n\t\t\t\t\t\tvar endAdd = 0;\r\n\r\n\t\t\t\t\t\tif (!target) {\r\n\t\t\t\t\t\t\ttarget = src.targetAnchor;\r\n\t\t\t\t\t\t\tendAdd = html.contentBox(target).w + this.arrowDim.w/2 + 2;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar pos = html.position(target, true);\r\n\t\t\t\t\t\tvar left = Math.floor(pos.x - this.arrowDim.w/2 + endAdd);\r\n\r\n\t\t\t\t\t\thtml.style(this.bottomMarker, \"visibility\", \"visible\");\r\n\t\t\t\t\t\thtml.style(this.topMarker, \"visibility\", \"visible\");\r\n\t\t\t\t\t\thtml.style(this.bottomMarker, {\r\n\t\t\t\t\t\t\t\"left\": left + \"px\",\r\n\t\t\t\t\t\t\t\"top\" : (headerHeight + pos.y) + \"px\"\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\thtml.style(this.topMarker, {\r\n\t\t\t\t\t\t\t\"left\": left + \"px\",\r\n\t\t\t\t\t\t\t\"top\" : (pos.y - this.arrowDim.h) + \"px\"\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tif(src.targetAnchor && getSibling(src.targetAnchor, src.before)){\r\n\t\t\t\t\t\t\tsrc._addItemClass(getSibling(src.targetAnchor, src.before), src.before ? \"After\" : \"Before\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\t_unmarkTargetAnchor: lang.hitch(this, function(){\r\n\t\t\t\t\t\tvar src = this.source;\r\n\t\t\t\t\t\tif(!src.targetAnchor){ return; }\r\n\t\t\t\t\t\tif(src.targetAnchor && getSibling(src.targetAnchor, src.before)){\r\n\t\t\t\t\t\t\tsrc._removeItemClass(getSibling(src.targetAnchor, src.before), src.before ? \"After\" : \"Before\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis._hide(this.bottomMarker);\r\n\t\t\t\t\t\tthis._hide(this.topMarker);\r\n\t\t\t\t\t\tSource.prototype._unmarkTargetAnchor.call(src);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tdestroy: lang.hitch(this, function(){\r\n\t\t\t\t\t\tconnect.disconnect(this._source_conn);\r\n\t\t\t\t\t\tconnect.unsubscribe(this._source_sub);\r\n\t\t\t\t\t\tSource.prototype.destroy.call(this.source);\r\n\t\t\t\t\t\tif(this.bottomMarker){\r\n\t\t\t\t\t\t\thtml.destroy(this.bottomMarker);\r\n\t\t\t\t\t\t\tdelete this.bottomMarker;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(this.topMarker){\r\n\t\t\t\t\t\t\thtml.destroy(this.topMarker);\r\n\t\t\t\t\t\t\tdelete this.topMarker;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tonDndCancel: lang.hitch(this, function(){\r\n\t\t\t\t\t\tSource.prototype.onDndCancel.call(this.source);\r\n\t\t\t\t\t\tthis._hide(this.bottomMarker);\r\n\t\t\t\t\t\tthis._hide(this.topMarker);\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis._source_conn = connect.connect(this.source, \"onDndDrop\", this, \"_onDndDrop\");\r\n\t\t\t\tthis._source_sub = connect.subscribe(\"/dnd/drop/before\", this, \"_onDndDropBefore\");\r\n\t\t\t\tthis.source.startup();\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t_hide: function(node){\r\n\t\t\thtml.style(node, {\r\n\t\t\t\ttop: \"-10000px\",\r\n\t\t\t\t\"visibility\": \"hidden\"\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_onDndDropBefore: function(source, nodes, copy){\r\n\t\t\tif(Manager.manager().target !== this.source){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.source._targetNode = this.source.targetAnchor;\r\n\t\t\tthis.source._beforeTarget = this.source.before;\r\n\t\t\tvar views = this.grid.views.views;\r\n\t\t\tvar srcView = views[source.viewIndex];\r\n\t\t\tvar tgtView = views[this.index];\r\n\t\t\tif(tgtView != srcView){\r\n\t\t\t\tsrcView.convertColPctToFixed();\r\n\t\t\t\ttgtView.convertColPctToFixed();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onDndDrop: function(source, nodes, copy){\r\n\t\t\tif(Manager.manager().target !== this.source){\r\n\t\t\t\tif(Manager.manager().source === this.source){\r\n\t\t\t\t\tthis._removingColumn = true;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._hide(this.bottomMarker);\r\n\t\t\tthis._hide(this.topMarker);\r\n\r\n\t\t\tvar getIdx = function(n){\r\n\t\t\t\treturn n ? html.attr(n, \"idx\") : null;\r\n\t\t\t};\r\n\t\t\tvar w = html.marginBox(nodes[0]).w;\r\n\t\t\tif(source.viewIndex !== this.index){\r\n\t\t\t\tvar views = this.grid.views.views;\r\n\t\t\t\tvar srcView = views[source.viewIndex];\r\n\t\t\t\tvar tgtView = views[this.index];\r\n\t\t\t\tif(srcView.viewWidth && srcView.viewWidth != \"auto\"){\r\n\t\t\t\t\tsrcView.setColumnsWidth(srcView.getColumnsWidth() - w);\r\n\t\t\t\t}\r\n\t\t\t\tif(tgtView.viewWidth && tgtView.viewWidth != \"auto\"){\r\n\t\t\t\t\ttgtView.setColumnsWidth(tgtView.getColumnsWidth());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar stn = this.source._targetNode;\r\n\t\t\tvar stb = this.source._beforeTarget;\r\n\t\t\t!this.grid.isLeftToRight() && (stb = !stb);\r\n\t\t\tvar layout = this.grid.layout;\r\n\t\t\tvar idx = this.index;\r\n\t\t\tdelete this.source._targetNode;\r\n\t\t\tdelete this.source._beforeTarget;\r\n\t\t\t\r\n\t\t\tlayout.moveColumn(\r\n\t\t\t\tsource.viewIndex,\r\n\t\t\t\tidx,\r\n\t\t\t\tgetIdx(nodes[0]),\r\n\t\t\t\tgetIdx(stn),\r\n\t\t\t\tstb);\r\n\t\t},\r\n\r\n\t\trenderHeader: function(){\r\n\t\t\tthis.headerContentNode.innerHTML = this.header.generateHtml(this._getHeaderContent);\r\n\t\t\tif(this.flexCells){\r\n\t\t\t\tthis.contentWidth = this.getContentWidth();\r\n\t\t\t\tthis.headerContentNode.firstChild.style.width = this.contentWidth;\r\n\t\t\t}\r\n\t\t\tutil.fire(this, \"onAfterRow\", [-1, this.structure.cells, this.headerContentNode]);\r\n\t\t},\r\n\r\n\t\t// note: not called in 'view' context\r\n\t\t_getHeaderContent: function(inCell){\r\n\t\t\tvar n = inCell.name || inCell.grid.getCellName(inCell);\r\n\t\t\tif(/^\\s+$/.test(n)){\r\n\t\t\t\tn = '&nbsp;'//otherwise arrow styles will be messed up\r\n\t\t\t}\r\n\t\t\tvar ret = [ '<div class=\"dojoxGridSortNode' ];\r\n\t\t\t\r\n\t\t\tif(inCell.index != inCell.grid.getSortIndex()){\r\n\t\t\t\tret.push('\">');\r\n\t\t\t}else{\r\n\t\t\t\tret = ret.concat([ ' ',\r\n\t\t\t\t\t\t\tinCell.grid.sortInfo > 0 ? 'dojoxGridSortUp' : 'dojoxGridSortDown',\r\n\t\t\t\t\t\t\t'\"><div class=\"dojoxGridArrowButtonChar\">',\r\n\t\t\t\t\t\t\tinCell.grid.sortInfo > 0 ? '&#9650;' : '&#9660;',\r\n\t\t\t\t\t\t\t'</div><div class=\"dojoxGridArrowButtonNode\" role=\"presentation\"></div>',\r\n\t\t\t\t\t\t\t'<div class=\"dojoxGridColCaption\">']);\r\n\t\t\t}\r\n\t\t\tret = ret.concat([n, '</div></div>']);\r\n\t\t\treturn ret.join('');\r\n\t\t},\r\n\r\n\t\tresize: function(){\r\n\t\t\tthis.adaptHeight();\r\n\t\t\tthis.adaptWidth();\r\n\t\t},\r\n\r\n\t\thasHScrollbar: function(reset){\r\n\t\t\tvar hadScroll = this._hasHScroll||false;\r\n\t\t\tif(this._hasHScroll == undefined || reset){\r\n\t\t\t\tif(this.noscroll){\r\n\t\t\t\t\tthis._hasHScroll = false;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar style = html.style(this.scrollboxNode, \"overflow\");\r\n\t\t\t\t\tif(style == \"hidden\"){\r\n\t\t\t\t\t\tthis._hasHScroll = false;\r\n\t\t\t\t\t}else if(style == \"scroll\"){\r\n\t\t\t\t\t\tthis._hasHScroll = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis._hasHScroll = (this.scrollboxNode.offsetWidth - this.getScrollbarWidth() < this.contentNode.offsetWidth );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(hadScroll !== this._hasHScroll){\r\n\t\t\t\tthis.grid.update();\r\n\t\t\t}\r\n\t\t\treturn this._hasHScroll; // Boolean\r\n\t\t},\r\n\r\n\t\thasVScrollbar: function(reset){\r\n\t\t\tvar hadScroll = this._hasVScroll||false;\r\n\t\t\tif(this._hasVScroll == undefined || reset){\r\n\t\t\t\tif(this.noscroll){\r\n\t\t\t\t\tthis._hasVScroll = false;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar style = html.style(this.scrollboxNode, \"overflow\");\r\n\t\t\t\t\tif(style == \"hidden\"){\r\n\t\t\t\t\t\tthis._hasVScroll = false;\r\n\t\t\t\t\t}else if(style == \"scroll\"){\r\n\t\t\t\t\t\tthis._hasVScroll = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis._hasVScroll = (this.scrollboxNode.scrollHeight > this.scrollboxNode.clientHeight);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(hadScroll !== this._hasVScroll){\r\n\t\t\t\tthis.grid.update();\r\n\t\t\t}\r\n\t\t\treturn this._hasVScroll; // Boolean\r\n\t\t},\r\n\t\t\r\n\t\tconvertColPctToFixed: function(){\r\n\t\t\t// Fix any percentage widths to be pixel values\r\n\t\t\tvar hasPct = false;\r\n\t\t\tthis.grid.initialWidth = \"\";\r\n\t\t\tvar cellNodes = query(\"th\", this.headerContentNode);\r\n\t\t\tvar fixedWidths = array.map(cellNodes, function(c, vIdx){\r\n\t\t\t\tvar w = c.style.width;\r\n\t\t\t\thtml.attr(c, \"vIdx\", vIdx);\r\n\t\t\t\tif(w && w.slice(-1) == \"%\"){\r\n\t\t\t\t\thasPct = true;\r\n\t\t\t\t}else if(w && w.slice(-2) == \"px\"){\r\n\t\t\t\t\treturn window.parseInt(w, 10);\r\n\t\t\t\t}\r\n\t\t\t\treturn html.contentBox(c).w;\r\n\t\t\t});\r\n\t\t\tif(hasPct){\r\n\t\t\t\tarray.forEach(this.grid.layout.cells, function(cell, idx){\r\n\t\t\t\t\tif(cell.view == this){\r\n\t\t\t\t\t\tvar cellNode = cell.view.getHeaderCellNode(cell.index);\r\n\t\t\t\t\t\tif(cellNode && html.hasAttr(cellNode, \"vIdx\")){\r\n\t\t\t\t\t\t\tvar vIdx = window.parseInt(html.attr(cellNode, \"vIdx\"));\r\n\t\t\t\t\t\t\tthis.setColWidth(idx, fixedWidths[vIdx]);\r\n\t\t\t\t\t\t\thtml.removeAttr(cellNode, \"vIdx\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tadaptHeight: function(minusScroll){\r\n\t\t\tif(!this.grid._autoHeight){\r\n\t\t\t\tvar h = (this.domNode.style.height && parseInt(this.domNode.style.height.replace(/px/,''), 10)) || this.domNode.clientHeight;\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tvar checkOtherViewScrollers = function(){\r\n\t\t\t\t\tvar v;\r\n\t\t\t\t\tfor(var i = 0; i < self.grid.views.views.length; ++i){\r\n\t\t\t\t\t\tv = self.grid.views.views[i];\r\n\t\t\t\t\t\tif(v !== self && v.hasHScrollbar()){\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t};\r\n\t\t\t\tif(minusScroll || (this.noscroll && checkOtherViewScrollers())){\r\n\t\t\t\t\th -= metrics.getScrollbar().h;\r\n\t\t\t\t}\r\n\t\t\t\tutil.setStyleHeightPx(this.scrollboxNode, h);\r\n\t\t\t}\r\n\t\t\tthis.hasVScrollbar(true);\r\n\t\t},\r\n\r\n\t\tadaptWidth: function(){\r\n\t\t\tif(this.flexCells){\r\n\t\t\t\t// the view content width\r\n\t\t\t\tthis.contentWidth = this.getContentWidth();\r\n\t\t\t\tthis.headerContentNode.firstChild.style.width = this.contentWidth;\r\n\t\t\t}\r\n\t\t\t// FIXME: it should be easier to get w from this.scrollboxNode.clientWidth,\r\n\t\t\t// but clientWidth seemingly does not include scrollbar width in some cases\r\n\t\t\tvar w = this.scrollboxNode.offsetWidth - this.getScrollbarWidth();\r\n\t\t\tif(!this._removingColumn){\r\n\t\t\t\tw = Math.max(w, this.getColumnsWidth()) + 'px';\r\n\t\t\t}else{\r\n\t\t\t\tw = Math.min(w, this.getColumnsWidth()) + 'px';\r\n\t\t\t\tthis._removingColumn = false;\r\n\t\t\t}\r\n\t\t\tvar cn = this.contentNode;\r\n\t\t\tcn.style.width = w;\r\n\t\t\tthis.hasHScrollbar(true);\r\n\t\t},\r\n\r\n\t\tsetSize: function(w, h){\r\n\t\t\tvar ds = this.domNode.style;\r\n\t\t\tvar hs = this.headerNode.style;\r\n\r\n\t\t\tif(w){\r\n\t\t\t\tds.width = w;\r\n\t\t\t\ths.width = w;\r\n\t\t\t}\r\n\t\t\tds.height = (h >= 0 ? h + 'px' : '');\r\n\t\t},\r\n\r\n\t\trenderRow: function(inRowIndex){\r\n\t\t\tvar rowNode = this.createRowNode(inRowIndex);\r\n\t\t\tthis.buildRow(inRowIndex, rowNode);\r\n\t\t\t//this.grid.edit.restore(this, inRowIndex);\r\n\t\t\treturn rowNode;\r\n\t\t},\r\n\r\n\t\tcreateRowNode: function(inRowIndex){\r\n\t\t\tvar node = document.createElement(\"div\");\r\n\t\t\tnode.className = this.classTag + 'Row';\r\n\t\t\tif (this instanceof dojox.grid._RowSelector){\r\n\t\t\t\thtml.attr(node,\"role\",\"presentation\");\r\n\t\t\t}else{\r\n\t\t\t\thtml.attr(node,\"role\",\"row\");\r\n\t\t\t\tif (this.grid.selectionMode != \"none\") {\r\n\t\t\t\t\tnode.setAttribute(\"aria-selected\", \"false\"); //rows can be selected so add aria-selected prop\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tnode[util.gridViewTag] = this.id;\r\n\t\t\tnode[util.rowIndexTag] = inRowIndex;\r\n\t\t\tthis.rowNodes[inRowIndex] = node;\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tbuildRow: function(inRowIndex, inRowNode){\r\n\t\t\t\r\n\t\t\tthis.buildRowContent(inRowIndex, inRowNode);\r\n\t\t  \t\r\n\t\t\tthis.styleRow(inRowIndex, inRowNode);\r\n\t\t  \r\n\t\t \r\n\t\t},\r\n\r\n\t\tbuildRowContent: function(inRowIndex, inRowNode){\r\n\t\t\tinRowNode.innerHTML = this.content.generateHtml(inRowIndex, inRowIndex);\r\n\t\t\tif(this.flexCells && this.contentWidth){\r\n\t\t\t\t// FIXME: accessing firstChild here breaks encapsulation\r\n\t\t\t\tinRowNode.firstChild.style.width = this.contentWidth;\r\n\t\t\t}\r\n\t\t\tutil.fire(this, \"onAfterRow\", [inRowIndex, this.structure.cells, inRowNode]);\r\n\t\t},\r\n\r\n\t\trowRemoved:function(inRowIndex){\r\n\t\t\tif(inRowIndex >= 0){\r\n\t\t\t\tthis._cleanupRowWidgets(this.getRowNode(inRowIndex));\r\n\t\t\t}\r\n\t\t\tthis.grid.edit.save(this, inRowIndex);\r\n\t\t\tdelete this.rowNodes[inRowIndex];\r\n\t\t},\r\n\r\n\t\tgetRowNode: function(inRowIndex){\r\n\t\t\treturn this.rowNodes[inRowIndex];\r\n\t\t},\r\n\r\n\t\tgetCellNode: function(inRowIndex, inCellIndex){\r\n\t\t\tvar row = this.getRowNode(inRowIndex);\r\n\t\t\tif(row){\r\n\t\t\t\treturn this.content.getCellNode(row, inCellIndex);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetHeaderCellNode: function(inCellIndex){\r\n\t\t\tif(this.headerContentNode){\r\n\t\t\t\treturn this.header.getCellNode(this.headerContentNode, inCellIndex);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// styling\r\n\t\tstyleRow: function(inRowIndex, inRowNode){\r\n\t\t\tinRowNode._style = getStyleText(inRowNode);\r\n\t\t\tthis.styleRowNode(inRowIndex, inRowNode);\r\n\t\t},\r\n\r\n\t\tstyleRowNode: function(inRowIndex, inRowNode){\r\n\t\t\tif(inRowNode){\r\n\t\t\t\tthis.doStyleRowNode(inRowIndex, inRowNode);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdoStyleRowNode: function(inRowIndex, inRowNode){\r\n\t\t\tthis.grid.styleRowNode(inRowIndex, inRowNode);\r\n\t\t},\r\n\r\n\t\t// updating\r\n\t\tupdateRow: function(inRowIndex){\r\n\t\t\tvar rowNode = this.getRowNode(inRowIndex);\r\n\t\t\tif(rowNode){\r\n\t\t\t\trowNode.style.height = '';\r\n\t\t\t\tthis.buildRow(inRowIndex, rowNode);\r\n\t\t\t}\r\n\t\t\treturn rowNode;\r\n\t\t},\r\n\r\n\t\tupdateRowStyles: function(inRowIndex){\r\n\t\t\tthis.styleRowNode(inRowIndex, this.getRowNode(inRowIndex));\r\n\t\t},\r\n\r\n\t\t// scrolling\r\n\t\tlastTop: 0,\r\n\t\tfirstScroll:0,\r\n\t\t_nativeScroll: false,\r\n\r\n\t\tdoscroll: function(inEvent){\r\n\t\t\tif(has('ff') >= 13 || has('chrome')){\r\n\t\t\t\tthis._nativeScroll = true;\r\n\t\t\t}\r\n\t\t\t//var s = dojo.marginBox(this.headerContentNode.firstChild);\r\n\t\t\tvar isLtr = this.grid.isLeftToRight();\r\n\t\t\tif(this.firstScroll < 2){\r\n\t\t\t\tif((!isLtr && this.firstScroll == 1) || (isLtr && this.firstScroll === 0)){\r\n\t\t\t\t\tvar s = html.marginBox(this.headerNodeContainer);\r\n\t\t\t\t\tif(has('ie')){\r\n\t\t\t\t\t\tthis.headerNodeContainer.style.width = s.w + this.getScrollbarWidth() + 'px';\r\n\t\t\t\t\t}else if(has('mozilla')){\r\n\t\t\t\t\t\t//TODO currently only for FF, not sure for safari and opera\r\n\t\t\t\t\t\tthis.headerNodeContainer.style.width = s.w - this.getScrollbarWidth() + 'px';\r\n\t\t\t\t\t\t//this.headerNodeContainer.style.width = s.w + 'px';\r\n\t\t\t\t\t\t//set scroll to right in FF\r\n\t\t\t\t\t\tthis.scrollboxNode.scrollLeft = isLtr ?\r\n\t\t\t\t\t\t\tthis.scrollboxNode.clientWidth - this.scrollboxNode.scrollWidth :\r\n\t\t\t\t\t\t\tthis.scrollboxNode.scrollWidth - this.scrollboxNode.clientWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.firstScroll++;\r\n\t\t\t}\r\n\t\t\tthis.headerNode.scrollLeft = this.scrollboxNode.scrollLeft;\r\n\t\t\t// 'lastTop' is a semaphore to prevent feedback-loop with setScrollTop below\r\n\t\t\tvar top = this.scrollboxNode.scrollTop;\r\n\t\t\tif(top !== this.lastTop){\r\n\t\t\t\tthis.grid.scrollTo(top);\r\n\t\t\t}\r\n\t\t\tthis._nativeScroll = false;\r\n\t\t},\r\n\r\n\t\tsetScrollTop: function(inTop){\r\n\t\t\t// 'lastTop' is a semaphore to prevent feedback-loop with doScroll above\r\n\t\t\tthis.lastTop = inTop;\r\n\t\t\tif(!this._nativeScroll){\r\n\t\t\t\t//fix #15487\r\n\t\t\t\tthis.scrollboxNode.scrollTop = inTop;\r\n\t\t\t}\r\n\t\t\treturn this.scrollboxNode.scrollTop;\r\n\t\t},\r\n\r\n\t\t// event handlers (direct from DOM)\r\n\t\tdoContentEvent: function(e){\r\n\t\t\tif(this.content.decorateEvent(e)){\r\n\t\t\t\tthis.grid.onContentEvent(e);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdoHeaderEvent: function(e){\r\n\t\t\tif(this.header.decorateEvent(e)){\r\n\t\t\t\tthis.grid.onHeaderEvent(e);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// event dispatch(from Grid)\r\n\t\tdispatchContentEvent: function(e){\r\n\t\t\treturn this.content.dispatchEvent(e);\r\n\t\t},\r\n\r\n\t\tdispatchHeaderEvent: function(e){\r\n\t\t\treturn this.header.dispatchEvent(e);\r\n\t\t},\r\n\r\n\t\t// column resizing\r\n\t\tsetColWidth: function(inIndex, inWidth){\r\n\t\t\tthis.grid.setCellWidth(inIndex, inWidth + 'px');\r\n\t\t},\r\n\r\n\t\tupdate: function(){\r\n\t\t\tif(!this.domNode){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.content.update();\r\n\t\t\tthis.grid.update();\r\n\t\t\t//get scroll after update or scroll left setting goes wrong on IE.\r\n\t\t\t//See trac: #8040\r\n\t\t\tvar left = this.scrollboxNode.scrollLeft;\r\n\t\t\tthis.scrollboxNode.scrollLeft = left;\r\n\t\t\tthis.headerNode.scrollLeft = left;\r\n\t\t}\r\n\t});\r\n\r\n\tvar _GridAvatar = declare(\"dojox.grid._GridAvatar\", Avatar, {\r\n\t\tconstruct: function(){\r\n\t\t\tvar dd = win.doc;\r\n\r\n\t\t\tvar a = dd.createElement(\"table\");\r\n\t\t\ta.cellPadding = a.cellSpacing = \"0\";\r\n\t\t\ta.className = \"dojoxGridDndAvatar\";\r\n\t\t\ta.style.position = \"absolute\";\r\n\t\t\ta.style.zIndex = 1999;\r\n\t\t\ta.style.margin = \"0px\"; // to avoid dojo.marginBox() problems with table's margins\r\n\t\t\tvar b = dd.createElement(\"tbody\");\r\n\t\t\tvar tr = dd.createElement(\"tr\");\r\n\t\t\tvar td = dd.createElement(\"td\");\r\n\t\t\tvar img = dd.createElement(\"td\");\r\n\t\t\ttr.className = \"dojoxGridDndAvatarItem\";\r\n\t\t\timg.className = \"dojoxGridDndAvatarItemImage\";\r\n\t\t\timg.style.width = \"16px\";\r\n\t\t\tvar source = this.manager.source, node;\r\n\t\t\tif(source.creator){\r\n\t\t\t\t// create an avatar representation of the node\r\n\t\t\t\tnode = source._normalizedCreator(source.getItem(this.manager.nodes[0].id).data, \"avatar\").node;\r\n\t\t\t}else{\r\n\t\t\t\t// or just clone the node and hope it works\r\n\t\t\t\tnode = this.manager.nodes[0].cloneNode(true);\r\n\t\t\t\tvar table, tbody;\r\n\t\t\t\tif(node.tagName.toLowerCase() == \"tr\"){\r\n\t\t\t\t\t// insert extra table nodes\r\n\t\t\t\t\ttable = dd.createElement(\"table\");\r\n\t\t\t\t\ttbody = dd.createElement(\"tbody\");\r\n\t\t\t\t\ttbody.appendChild(node);\r\n\t\t\t\t\ttable.appendChild(tbody);\r\n\t\t\t\t\tnode = table;\r\n\t\t\t\t}else if(node.tagName.toLowerCase() == \"th\"){\r\n\t\t\t\t\t// insert extra table nodes\r\n\t\t\t\t\ttable = dd.createElement(\"table\");\r\n\t\t\t\t\ttbody = dd.createElement(\"tbody\");\r\n\t\t\t\t\tvar r = dd.createElement(\"tr\");\r\n\t\t\t\t\ttable.cellPadding = table.cellSpacing = \"0\";\r\n\t\t\t\t\tr.appendChild(node);\r\n\t\t\t\t\ttbody.appendChild(r);\r\n\t\t\t\t\ttable.appendChild(tbody);\r\n\t\t\t\t\tnode = table;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tnode.id = \"\";\r\n\t\t\ttd.appendChild(node);\r\n\t\t\ttr.appendChild(img);\r\n\t\t\ttr.appendChild(td);\r\n\t\t\thtml.style(tr, \"opacity\", 0.9);\r\n\t\t\tb.appendChild(tr);\r\n\r\n\t\t\ta.appendChild(b);\r\n\t\t\tthis.node = a;\r\n\r\n\t\t\tvar m = Manager.manager();\r\n\t\t\tthis.oldOffsetY = m.OFFSET_Y;\r\n\t\t\tm.OFFSET_Y = 1;\r\n\t\t},\r\n\t\tdestroy: function(){\r\n\t\t\tManager.manager().OFFSET_Y = this.oldOffsetY;\r\n\t\t\tthis.inherited(arguments);\r\n\t\t}\r\n\t});\r\n\r\n\tvar oldMakeAvatar = Manager.manager().makeAvatar;\r\n\tManager.manager().makeAvatar = function(){\r\n\t\tvar src = this.source;\r\n\t\tif(src.viewIndex !== undefined && !html.hasClass(win.body(),\"dijit_a11y\")){\r\n\t\t\treturn new _GridAvatar(this);\r\n\t\t}\r\n\t\treturn oldMakeAvatar.call(Manager.manager());\r\n\t};\r\n\r\n\treturn _View;\r\n\r\n});"]}