{"version":3,"sources":["editor/plugins/AutoSave.js"],"names":["define","dojo","dijit","dojox","manager","popup","_Widget","_TemplatedMixin","_WidgetsInTemplateMixin","Dialog","MenuItem","Menu","Button","ComboButton","ComboBox","_TextBoxMixin","TextBox","TooltipDialog","_Plugin","connect","declare","locale","i18n","string","Save","experimental","AutoSaveSettingDialog","dialogTitle","dialogDescription","paramName","paramLabel","btnOk","btnCancel","widgetsInTemplate","templateString","postMixInProperties","this","id","getUniqueId","declaredClass","replace","dialogId","textBoxId","show","_value","intBox","set","dialog","selectInputText","focusNode","hide","onOk","onCancel","_onKeyDown","evt","keyCode","keys","ENTER","_onChange","val","_isValidValue","_setValueAttr","_getValueAttr","_v","String","Boolean","match","AutoSave","url","logResults","interval","_iconClassPrefix","_MIN","_setIntervalAttr","_getIntervalAttr","_interval","setEditor","editor","_strings","getLocalization","_initButton","_saveSettingDialog","pd","_promDialog","startup","menu","style","menuItemSave","iconClass","label","menuItemAutoSave","_menuItemAutoSave","addChild","button","form","showLabel","dropDown","_menuItemAutoSaveClickHandler","_showAutSaveSettingDialog","_onDialogOk","get","_setSaveInterval","disconnect","_onStopClick","_clearSaveInterval","_intervalHandler","setInterval","hitch","_isWorking","_save","clearInterval","onSuccess","resp","ioargs","substitute","0","date","format","Date","selector","open","around","domNode","_promDialogTimeout","setTimeout","clearTimeout","close","console","log","onError","error","destroy","inherited","arguments","destroyRecursive","_destroyRecursive","_AutoSaveSettingDialog","subscribe","_scopeName","o","plugin","args","name","toLowerCase"],"mappings":";;;;;;;AAAAA,QACC,OACA,QACA,QACA,sBACA,oBACA,gBACA,wBACA,gCACA,eACA,iBACA,aACA,oBACA,yBACA,sBACA,2BACA,qBACA,sBACA,wBACA,qBACA,qBACA,mBACA,YACA,cACA,4BACA,+CACE,SAASC,EAAMC,EAAOC,EAAOC,EAASC,EAAOC,EAASC,EAAiBC,EACzEC,EAAQC,EAAUC,EAAMC,EAAQC,EAAaC,EAAUC,EAAeC,EAASC,EAAeC,EAC9FC,EAASC,EAASC,EAAQC,EAAMC,EAAQC,GAEzCvB,EAAKwB,aAAa,iCAElB,IAAIC,EAAwBzB,EAAKmB,QAAQ,+CAAgDd,EAASC,EAAiBC,IAIlHmB,YAAa,GAIbC,kBAAmB,GAInBC,UAAW,GAIXC,WAAY,GAIZC,MAAO,GAIPC,UAAW,GAEXC,mBAAmB,EAEnBC,eACC,g+BAmBDC,oBAAqB,WACpBC,KAAKC,GAAKnC,EAAMoC,YAAYF,KAAKG,cAAcC,QAAQ,MAAM,MAC7DJ,KAAKK,SAAWL,KAAKC,GAAK,UAC1BD,KAAKM,UAAYN,KAAKC,GAAK,YAG5BM,KAAM,WAMa,IAAfP,KAAKQ,QACPR,KAAKQ,OAAS,EACdR,KAAKS,OAAOC,IAAI,QAAS,IAEzBV,KAAKS,OAAOC,IAAI,QAASV,KAAKQ,QAE/BR,KAAKW,OAAOJ,OACZzC,EAAM8C,gBAAgBZ,KAAKS,OAAOI,YAGnCC,KAAM,WAKLd,KAAKW,OAAOG,QAGbC,KAAM,WAKLf,KAAKW,OAAOG,QAGbE,SAAU,WAKThB,KAAKW,OAAOG,QAGbG,WAAY,SAASC,GAKjBA,EAAIC,SAAWtD,EAAKuD,KAAKC,OAC3BrB,KAAKe,QAIPO,UAAW,SAAoBC,GAK3BvB,KAAKwB,cAAcD,GACrBvB,KAAKQ,OAASe,EAEdvB,KAAKS,OAAOC,IAAI,QAASV,KAAKQ,SAIhCiB,cAAe,SAAoBF,GAO/BvB,KAAKwB,cAAcD,KACrBvB,KAAKQ,OAASe,IAIhBG,cAAe,WAKd,OAAO1B,KAAKQ,QAGbgB,cAAe,SAAoBD,GAKlC,IACCI,EAAKC,OAAOL,GACb,OAAOM,QAAQF,EAAGG,MAAQH,EAAGG,MAFhB,aAEgC,OAI3CC,EAAWlE,EAAKmB,QAAQ,gCAAiCI,GAS5D4C,IAAK,GAKLC,YAAY,EAIZC,SAAU,EAIVC,iBAAkB,0BAIlBC,KAAM,IAENC,iBAAkB,SAASd,GAQ1BvB,KAAKkC,SAAWX,GAGjBe,iBAAkB,WAKjB,OAAOtC,KAAKuC,WAGbC,UAAW,SAASC,GAOnBzC,KAAKyC,OAASA,EACdzC,KAAK0C,SAAW7E,EAAKqB,KAAKyD,gBAAgB,uBAAwB,YAClE3C,KAAK4C,cAEL5C,KAAK6C,mBAAqB,IAAIvD,GAC7BC,YAAeS,KAAK0C,SAAiC,uBACrDlD,kBAAqBQ,KAAK0C,SAAuC,6BACjEjD,UAAaO,KAAK0C,SAAqC,2BACvDhD,WAAcM,KAAK0C,SAAsC,4BACzD/C,MAASK,KAAK0C,SAAoC,0BAClD9C,UAAaI,KAAK0C,SAAwC,gCAE3D1C,KAAKjB,QAAQiB,KAAK6C,mBAAoB,OAAQ,eAE9C,IAAIC,EAAM9C,KAAK+C,YAAc,IAAIjF,EAAMe,cACvCiE,EAAGE,UACHF,EAAGpC,IAAI,UAAW,KAGnBkC,YAAa,WACZ,IAAIK,EAAO,IAAInF,EAAMS,MACnB2E,MAAO,kBAERC,EAAe,IAAIrF,EAAMQ,UACxB8E,UAAWpD,KAAKmC,iBAAmB,WAAanC,KAAKmC,iBACrDkB,MAAOrD,KAAK0C,SAAoB,YAEjCY,EAAoBtD,KAAKuD,kBAAoB,IAAIzF,EAAMQ,UACtD8E,UAAWpD,KAAKmC,iBAAmB,WAAanC,KAAKmC,iBACrDkB,MAAOrD,KAAK0C,SAA6B,qBAG3CO,EAAKO,SAASL,GACdF,EAAKO,SAASF,GACdtD,KAAKyD,OAAS,IAAI3F,EAAM4F,KAAKjF,aAC5B4E,MAAOrD,KAAK0C,SAAoB,UAChCU,UAAWpD,KAAKmC,iBAAmB,WAAanC,KAAKmC,iBACrDwB,WAAW,EACXC,SAAUX,IAGXjD,KAAKjB,QAAQiB,KAAKyD,OAAQ,UAAW,SACrCzD,KAAKjB,QAAQoE,EAAc,UAAW,SACtCnD,KAAK6D,8BAAgChG,EAAKkB,QAAQuE,EAAkB,UAAWtD,KAAM,8BAGtF8D,0BAA2B,WAK1B,IAAInD,EAASX,KAAK6C,mBAClBlC,EAAOD,IAAI,QAASV,KAAKkC,UACzBvB,EAAOJ,QAGRwD,YAAa,WAKZ,IAAI7B,EAAYlC,KAAKkC,SAAWlC,KAAK6C,mBAAmBmB,IAAI,SAAWhE,KAAKoC,KACzEF,EAAW,IACblC,KAAKiE,iBAAiB/B,GAGtBrE,EAAKqG,WAAWlE,KAAK6D,+BACrB7D,KAAKuD,kBAAkB7C,IAAI,QAASV,KAAK0C,SAA8B,qBACvE1C,KAAK6D,8BAAgChG,EAAKkB,QAAQiB,KAAKuD,kBAAmB,UAAWvD,KAAM,gBAE3FA,KAAKyD,OAAO/C,IAAI,YAAaV,KAAKmC,iBAAmB,WAAanC,KAAKmC,oBAIzEgC,aAAc,WAKbnE,KAAKoE,qBAGLvG,EAAKqG,WAAWlE,KAAK6D,+BACrB7D,KAAKuD,kBAAkB7C,IAAI,QAASV,KAAK0C,SAA6B,oBACtE1C,KAAK6D,8BAAgChG,EAAKkB,QAAQiB,KAAKuD,kBAAmB,UAAWvD,KAAM,6BAE3FA,KAAKyD,OAAO/C,IAAI,YAAaV,KAAKmC,iBAAmB,WAAanC,KAAKmC,mBAGxE8B,iBAAkB,SAAoB/B,GAKlCA,GAAY,IAGflC,KAAKoE,qBACLpE,KAAKqE,iBAAmBC,YAAYzG,EAAK0G,MAAMvE,KAAO,WAC3CA,KAAKwE,YAAexE,KAAKgE,IAAI,cAGhChE,KAAKwE,YAAa,EAClBxE,KAAKyE,WAEHvC,KAGXkC,mBAAoB,WAChBpE,KAAKqE,mBACPK,cAAc1E,KAAKqE,kBACnBrE,KAAKqE,iBAAmB,OAI1BM,UAAW,SAASC,EAAMC,GAOzB7E,KAAKyD,OAAO/C,IAAI,YAAY,GAE5BV,KAAK+C,YAAYrC,IAAI,UAAW7C,EAAKsB,OAAO2F,WACzC9E,KAAK0C,SAA6B,oBAAIqC,EAAKlH,EAAKmH,KAAK/F,OAAOgG,OAAO,IAAIC,MAASC,SAAU,YAC3FrH,EAAMG,MAAMmH,MAAMnH,MAAO+B,KAAK+C,YAAasC,OAAQrF,KAAKyD,OAAO6B,UAC/DtF,KAAKuF,mBAAqBC,WAAW3H,EAAK0G,MAAMvE,KAAM,WACrDyF,aAAazF,KAAKuF,oBAClBvF,KAAKuF,mBAAqB,KAC1BzH,EAAMG,MAAMyH,MAAM1F,KAAK+C,eACpB,KACN/C,KAAKwE,YAAa,EACfxE,KAAKiC,YACP0D,QAAQC,IAAIhB,IAIdiB,QAAS,SAASC,EAAOjB,GAOxB7E,KAAKyD,OAAO/C,IAAI,YAAY,GAE5BV,KAAK+C,YAAYrC,IAAI,UAAW7C,EAAKsB,OAAO2F,WACzC9E,KAAK0C,SAA0B,iBAAIqC,EAAKlH,EAAKmH,KAAK/F,OAAOgG,OAAO,IAAIC,MAASC,SAAU,YACxFrH,EAAMG,MAAMmH,MAAMnH,MAAO+B,KAAK+C,YAAasC,OAAQrF,KAAKyD,OAAO6B,UAC/DtF,KAAKuF,mBAAqBC,WAAW3H,EAAK0G,MAAMvE,KAAM,WACrDyF,aAAazF,KAAKuF,oBAClBvF,KAAKuF,mBAAqB,KAC1BzH,EAAMG,MAAMyH,MAAM1F,KAAK+C,eACpB,KACN/C,KAAKwE,YAAa,EACfxE,KAAKiC,YACP0D,QAAQC,IAAIE,IAIdC,QAAS,WAGR/F,KAAKgG,UAAUC,WAEfjG,KAAKuD,kBAAoB,KAEtBvD,KAAKuF,qBACPE,aAAazF,KAAKuF,oBAClBvF,KAAKuF,mBAAqB,KAC1BzH,EAAMG,MAAMyH,MAAM1F,KAAK+C,cAGxB/C,KAAKoE,qBAEFpE,KAAK6C,qBACP7C,KAAK6C,mBAAmBqD,mBACxBlG,KAAKmG,kBAAoB,MAGvBnG,KAAK6D,gCACPhG,EAAKqG,WAAWlE,KAAK6D,+BACrB7D,KAAK6D,8BAAgC,SAqBxC,OAfA9B,EAASqE,uBAAyB9G,EAGlCzB,EAAKwI,UAAUvI,EAAMwI,WAAa,oBAAoB,KAAK,SAASC,GAChEA,EAAEC,QAEM,YADAD,EAAEE,KAAKC,KAAKC,gBAEtBJ,EAAEC,OAAS,IAAIzE,GACdC,IAAM,QAASuE,EAAEE,KAAQF,EAAEE,KAAKzE,IAAM,GACtCC,aAAa,eAAgBsE,EAAEE,OAAQF,EAAEE,KAAKxE,WAC9CC,SAAW,aAAcqE,EAAEE,KAAQF,EAAEE,KAAKvE,SAAW,OAKjDH","file":"../../../editor/plugins/AutoSave.js","sourcesContent":["define([\r\n\t\"dojo\",\r\n\t\"dijit\",\t// _scopeName\r\n\t\"dojox\",\r\n\t\"dijit/_base/manager\",\t// getUniqueId()\r\n\t\"dijit/_base/popup\",\r\n\t\"dijit/_Widget\",\r\n\t\"dijit/_TemplatedMixin\",\r\n\t\"dijit/_WidgetsInTemplateMixin\",\r\n\t\"dijit/Dialog\",\r\n\t\"dijit/MenuItem\",\r\n\t\"dijit/Menu\",\r\n\t\"dijit/form/Button\",\r\n\t\"dijit/form/ComboButton\",\r\n\t\"dijit/form/ComboBox\",\r\n\t\"dijit/form/_TextBoxMixin\",\t// selectInputText()\r\n\t\"dijit/form/TextBox\",\r\n\t\"dijit/TooltipDialog\",\r\n\t\"dijit/_editor/_Plugin\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/date/locale\",\r\n\t\"dojo/i18n\",\r\n\t\"dojo/string\",\r\n\t\"dojox/editor/plugins/Save\",\r\n\t\"dojo/i18n!dojox/editor/plugins/nls/AutoSave\"\r\n], function(dojo, dijit, dojox, manager, popup, _Widget, _TemplatedMixin, _WidgetsInTemplateMixin,\r\n\tDialog, MenuItem, Menu, Button, ComboButton, ComboBox, _TextBoxMixin, TextBox, TooltipDialog, _Plugin,\r\n\tconnect, declare, locale, i18n, string, Save) {\r\n\r\ndojo.experimental(\"dojox.editor.plugins.AutoSave\");\r\n\r\nvar AutoSaveSettingDialog = dojo.declare(\"dojox.editor.plugins._AutoSaveSettingDialog\", [_Widget, _TemplatedMixin, _WidgetsInTemplateMixin], {\r\n\t\r\n\t// dialogTitle [public] String\r\n\t//\t\tThe tile of the Auto-Save setting dialog\r\n\tdialogTitle: \"\",\r\n\t\r\n\t// dialogDescription [public] String\r\n\t//\t\tThe description of the Auto-Save setting dialog\r\n\tdialogDescription: \"\",\r\n\t\r\n\t// paramName [public] String\r\n\t//\t\tThe name of the parameter (Auto-Save Interval)\r\n\tparamName: \"\",\r\n\t\r\n\t// paramLabel [public] String\r\n\t//\t\tMinute\r\n\tparamLabel: \"\",\r\n\t\r\n\t// btnOk [public] String\r\n\t//\t\tThe label of the OK button\r\n\tbtnOk: \"\",\r\n\t\r\n\t// btnCancel [public] String\r\n\t//\t\tThe label of the Cancel button\r\n\tbtnCancel: \"\",\r\n\t\r\n\twidgetsInTemplate: true,\r\n\t\r\n\ttemplateString:\r\n\t\t\"<span id='${dialogId}' class='dijit dijitReset dijitInline' tabindex='-1'>\" +\r\n\t\t\t\"<div dojoType='dijit.Dialog' title='${dialogTitle}' dojoAttachPoint='dialog' \" +\r\n\t\t\t\t\"class='dijitEditorAutoSaveSettingDialog'>\" +\r\n\t\t\t\t\"<div tabindex='-1'>${dialogDescription}</div>\" +\r\n\t\t\t\t\"<div tabindex='-1' class='dijitEditorAutoSaveSettingInputArea'>${paramName}</div>\" +\r\n\t\t\t\t\"<div class='dijitEditorAutoSaveSettingInputArea' tabindex='-1'>\" +\r\n\t\t\t\t\t\"<input class='textBox' dojoType='dijit.form.TextBox' id='${textBoxId}' required='false' intermediateChanges='true' \" +\r\n\t\t\t\t\t\t\"selectOnClick='true' required='true' dojoAttachPoint='intBox' \" +\r\n\t\t\t\t\t\t\"dojoAttachEvent='onKeyDown: _onKeyDown, onChange: _onChange'/>\" +\r\n\t\t\t\t\t\"<label class='dijitLeft dijitInline boxLabel' \" +\r\n\t\t\t\t\t\t\"for='${textBoxId}' tabindex='-1'>${paramLabel}</label>\" +\r\n\t\t\t\t\"</div>\" +\r\n\t\t\t\t\"<div class='dijitEditorAutoSaveSettingButtonArea' tabindex='-1'>\" +\r\n\t\t\t\t\t\"<button dojoType='dijit.form.Button' dojoAttachEvent='onClick: onOk'>${btnOk}</button>\" +\r\n\t\t\t\t\t\"<button dojoType='dijit.form.Button' dojoAttachEvent='onClick: onCancel'>${btnCancel}</button>\" +\r\n\t\t\t\t\"</div>\" +\r\n\t\t\t\"</div>\" +\r\n\t\t\"</span>\",\r\n\t\r\n\tpostMixInProperties: function(){\r\n\t\tthis.id = dijit.getUniqueId(this.declaredClass.replace(/\\./g,\"_\"));\r\n\t\tthis.dialogId = this.id + \"_dialog\";\r\n\t\tthis.textBoxId = this.id + \"_textBox\";\r\n\t},\r\n\t\r\n\tshow: function(){\r\n\t\t// summary:\r\n\t\t//\t\tDisplay the setting dialog. If the internal interval value is \"\"\r\n\t\t//\t\tset it to zero\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\tif(this._value == \"\"){\r\n\t\t\tthis._value = 0;\r\n\t\t\tthis.intBox.set(\"value\", 0);\r\n\t\t}else{\r\n\t\t\tthis.intBox.set(\"value\", this._value);\r\n\t\t}\r\n\t\tthis.dialog.show();\r\n\t\tdijit.selectInputText(this.intBox.focusNode);\r\n\t},\r\n\t\r\n\thide: function(){\r\n\t\t// summary:\r\n\t\t//\t\tHide the setting dialog.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\tthis.dialog.hide();\r\n\t},\r\n\t\r\n\tonOk: function(){\r\n\t\t// summary:\r\n\t\t//\t\tHandle the OK event and close the dialog.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\tthis.dialog.hide();\r\n\t},\r\n\t\r\n\tonCancel: function(){\r\n\t\t// summary:\r\n\t\t//\t\tHandle the Cancel event and close the dialog.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\tthis.dialog.hide();\r\n\t},\r\n\t\r\n\t_onKeyDown: function(evt){\r\n\t\t// summary:\r\n\t\t//\t\tHandle the keydown event\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tif(evt.keyCode == dojo.keys.ENTER){\r\n\t\t\tthis.onOk();\r\n\t\t}\r\n\t},\r\n\t\r\n\t_onChange: function(/*String*/ val){\r\n\t\t// summary:\r\n\t\t//\t\tCheck if the value is between 1 - 999.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\tif(this._isValidValue(val)){\r\n\t\t\tthis._value = val;\r\n\t\t}else{\r\n\t\t\tthis.intBox.set(\"value\", this._value);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_setValueAttr: function(/*String*/ val){\r\n\t\t// summary:\r\n\t\t//\t\tSet the value attribute if it is acceptable\r\n\t\t// val:\r\n\t\t//\t\tThe interval value\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tif(this._isValidValue(val)){\r\n\t\t\tthis._value = val;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_getValueAttr: function(){\r\n\t\t// summary:\r\n\t\t//\t\tGet the interval value\r\n\t\t// tags:\r\n\t\t//\t\tprotected\r\n\t\treturn this._value;\r\n\t},\r\n\t\r\n\t_isValidValue: function(/*String*/ val){\r\n\t\t// summary:\r\n\t\t//\t\tCheck if this value between 1- 999\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tvar regExp = /^\\d{0,3}$/,\r\n\t\t\t_v = String(val);\r\n\t\treturn Boolean(_v.match ? _v.match(regExp) : \"\");\r\n\t}\r\n});\r\n\r\nvar AutoSave = dojo.declare(\"dojox.editor.plugins.AutoSave\", Save, {\r\n\t// summary:\r\n\t//\t\tThis plugin provides the auto save capability to the editor. The\r\n\t//\t\tplugin saves the content of the editor in interval. When\r\n\t//\t\tthe save action is performed, the document in the editor frame\r\n\t//\t\twill be posted to the URL provided, or none, if none provided.\r\n\t\r\n\t// url: [public] String\r\n\t//\t\tThe URL to POST the content back to.  Used by the save function.\r\n\turl: \"\",\r\n\r\n\t// logResults: [public] Boolean\r\n\t//\t\tBoolean flag to indicate that the default action for save and\r\n\t//\t\terror handlers is to just log to console.  Default is true.\r\n\tlogResults: true,\r\n\t\r\n\t// interval: [public] Number\r\n\t//\t\tThe interval to perform the save action.\r\n\tinterval: 0,\r\n\t\r\n\t// _iconClassPrefix: [private] String\r\n\t//\t\tThis prefix of the CSS class\r\n\t_iconClassPrefix: \"dijitEditorIconAutoSave\",\r\n\t\r\n\t// _MIN: [private const] Number\r\n\t//\t\tDefault 1 minute\r\n\t_MIN: 60000,\r\n\t\r\n\t_setIntervalAttr: function(val){\r\n\t\t// summary:\r\n\t\t//\t\tSet the interval value.\r\n\t\t//\t\tDelay the boundary check to _isValidValue of the dialog class\r\n\t\t// val:\r\n\t\t//\t\tThe interval value.\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tthis.interval = val;\r\n\t},\r\n\t\r\n\t_getIntervalAttr: function(){\r\n\t\t// summary:\r\n\t\t//\t\tGet the interval value\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\treturn this._interval;\r\n\t},\r\n\t\r\n\tsetEditor: function(editor){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ride for the setting of the editor. No toggle button for\r\n\t\t//\t\tthis plugin. And start to save the content of the editor in\r\n\t\t//\t\tinterval\r\n\t\t// editor: Object\r\n\t\t//\t\tThe editor to configure for this plugin to use.\r\n\t\tthis.editor = editor;\r\n\t\tthis._strings = dojo.i18n.getLocalization(\"dojox.editor.plugins\", \"AutoSave\");\r\n\t\tthis._initButton();\r\n\t\t\r\n\t\tthis._saveSettingDialog = new AutoSaveSettingDialog({\r\n\t\t\t\"dialogTitle\": this._strings[\"saveSettingdialogTitle\"],\r\n\t\t\t\"dialogDescription\": this._strings[\"saveSettingdialogDescription\"],\r\n\t\t\t\"paramName\": this._strings[\"saveSettingdialogParamName\"],\r\n\t\t\t\"paramLabel\": this._strings[\"saveSettingdialogParamLabel\"],\r\n\t\t\t\"btnOk\": this._strings[\"saveSettingdialogButtonOk\"],\r\n\t\t\t\"btnCancel\": this._strings[\"saveSettingdialogButtonCancel\"]\r\n\t\t});\r\n\t\tthis.connect(this._saveSettingDialog, \"onOk\", \"_onDialogOk\");\r\n\t\t\r\n\t\tvar pd = (this._promDialog = new dijit.TooltipDialog());\r\n\t\tpd.startup();\r\n\t\tpd.set(\"content\", \"\");\r\n\t},\r\n\t\r\n\t_initButton: function(){\r\n\t\tvar menu = new dijit.Menu({\r\n\t\t\t\tstyle: \"display: none\"\r\n\t\t\t}),\r\n\t\t\tmenuItemSave = new dijit.MenuItem({\r\n\t\t\t\ticonClass: this._iconClassPrefix + \"Default \" + this._iconClassPrefix,\r\n\t\t\t\tlabel: this._strings[\"saveLabel\"]\r\n\t\t\t}),\r\n\t\t\tmenuItemAutoSave = (this._menuItemAutoSave = new dijit.MenuItem({\r\n\t\t\t\ticonClass: this._iconClassPrefix + \"Setting \" + this._iconClassPrefix,\r\n\t\t\t\tlabel: this._strings[\"saveSettingLabelOn\"]\r\n\t\t\t}));\r\n\t\t\t\r\n\t\tmenu.addChild(menuItemSave);\r\n\t\tmenu.addChild(menuItemAutoSave);\r\n\t\tthis.button = new dijit.form.ComboButton({\r\n\t\t\tlabel: this._strings[\"saveLabel\"],\r\n\t\t\ticonClass: this._iconClassPrefix + \"Default \" + this._iconClassPrefix,\r\n\t\t\tshowLabel: false,\r\n\t\t\tdropDown: menu\r\n\t\t});\r\n\t\t\r\n\t\tthis.connect(this.button, \"onClick\", \"_save\");\r\n\t\tthis.connect(menuItemSave, \"onClick\", \"_save\");\r\n\t\tthis._menuItemAutoSaveClickHandler = dojo.connect(menuItemAutoSave, \"onClick\", this, \"_showAutSaveSettingDialog\");\r\n\t},\r\n\t\r\n\t_showAutSaveSettingDialog: function(){\r\n\t\t// summary:\r\n\t\t//\t\tShow the setting dialog\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tvar dialog = this._saveSettingDialog;\r\n\t\tdialog.set(\"value\", this.interval);\r\n\t\tdialog.show();\r\n\t},\r\n\t\r\n\t_onDialogOk: function(){\r\n\t\t// summary:\r\n\t\t//\t\tIf the interval is set (larger than 0), enable auto-save.\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tvar interval = (this.interval = this._saveSettingDialog.get(\"value\") * this._MIN);\r\n\t\tif(interval > 0){\r\n\t\t\tthis._setSaveInterval(interval);\r\n\t\t\t// Change the menu \"Set Auto-Save Interval...\" to \"Turn off Auto-Save\"\r\n\t\t\t// Connect it to another handler that terminates the auto-save.\r\n\t\t\tdojo.disconnect(this._menuItemAutoSaveClickHandler);\r\n\t\t\tthis._menuItemAutoSave.set(\"label\", this._strings[\"saveSettingLabelOff\"]);\r\n\t\t\tthis._menuItemAutoSaveClickHandler = dojo.connect(this._menuItemAutoSave, \"onClick\", this, \"_onStopClick\");\r\n\t\t\t// Change the icon of the main button to auto-save style\r\n\t\t\tthis.button.set(\"iconClass\", this._iconClassPrefix + \"Setting \" + this._iconClassPrefix);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_onStopClick: function(){\r\n\t\t// summary:\r\n\t\t//\t\tStop auto-save\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tthis._clearSaveInterval();\r\n\t\t// Change the menu \"Turn off Auto-Save\" to \"Set Auto-Save Interval...\".\r\n\t\t// Connect it to another handler that show the setting dialog.\r\n\t\tdojo.disconnect(this._menuItemAutoSaveClickHandler);\r\n\t\tthis._menuItemAutoSave.set(\"label\", this._strings[\"saveSettingLabelOn\"]);\r\n\t\tthis._menuItemAutoSaveClickHandler = dojo.connect(this._menuItemAutoSave, \"onClick\", this, \"_showAutSaveSettingDialog\");\r\n\t\t// Change the icon of the main button\r\n\t\tthis.button.set(\"iconClass\", this._iconClassPrefix + \"Default \" + this._iconClassPrefix);\r\n\t},\r\n\t\r\n\t_setSaveInterval: function(/*Number*/ interval){\r\n\t\t// summary:\r\n\t\t//\t\tFunction to trigger saving of the editor document\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tif(interval <= 0){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._clearSaveInterval();\r\n\t\tthis._intervalHandler = setInterval(dojo.hitch(this,  function(){\r\n\t\t\t\t\t\t\t\t\tif(!this._isWorking && !this.get(\"disabled\")){\r\n\t\t\t\t\t\t\t\t\t\t// If the plugin is not disabled (ViewSource, etc.)\r\n\t\t\t\t\t\t\t\t\t\t// and not working. Do saving!\r\n\t\t\t\t\t\t\t\t\t\tthis._isWorking = true;\r\n\t\t\t\t\t\t\t\t\t\tthis._save();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}), interval);\r\n\t},\r\n\t\r\n\t_clearSaveInterval: function(){\r\n\t\tif(this._intervalHandler){\r\n\t\t\tclearInterval(this._intervalHandler);\r\n\t\t\tthis._intervalHandler = null;\r\n\t\t}\r\n\t},\r\n\r\n\tonSuccess: function(resp, ioargs){\r\n\t\t// summary:\r\n\t\t//\t\tUser over-ridable save success function for editor content.\r\n\t\t// resp:\r\n\t\t//\t\tThe response from the server, if any, in text format.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\tthis.button.set(\"disabled\", false);\r\n\t\t// Show the successful message\r\n\t\tthis._promDialog.set(\"content\", dojo.string.substitute(\r\n\t\t\t\t\tthis._strings[\"saveMessageSuccess\"], {\"0\": dojo.date.locale.format(new Date(), {selector: \"time\"})}));\r\n\t\t\t\tdijit.popup.open({popup: this._promDialog, around: this.button.domNode});\r\n\t\t\t\tthis._promDialogTimeout = setTimeout(dojo.hitch(this, function(){\r\n\t\t\t\t\tclearTimeout(this._promDialogTimeout);\r\n\t\t\t\t\tthis._promDialogTimeout = null;\r\n\t\t\t\t\tdijit.popup.close(this._promDialog);\r\n\t\t\t\t}), 3000);\r\n\t\tthis._isWorking = false;\r\n\t\tif(this.logResults){\r\n\t\t\tconsole.log(resp);\r\n\t\t}\r\n\t},\r\n\r\n\tonError: function(error, ioargs){\r\n\t\t// summary:\r\n\t\t//\t\tUser over-ridable save success function for editor content.\r\n\t\t// resp:\r\n\t\t//\t\tThe response from the server, if any, in text format.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\tthis.button.set(\"disabled\", false);\r\n\t\t// Show the failure message\r\n\t\tthis._promDialog.set(\"content\", dojo.string.substitute(\r\n\t\t\t\t\tthis._strings[\"saveMessageFail\"], {\"0\": dojo.date.locale.format(new Date(), {selector: \"time\"})}));\r\n\t\t\t\tdijit.popup.open({popup: this._promDialog, around: this.button.domNode});\r\n\t\t\t\tthis._promDialogTimeout = setTimeout(dojo.hitch(this, function(){\r\n\t\t\t\t\tclearTimeout(this._promDialogTimeout);\r\n\t\t\t\t\tthis._promDialogTimeout = null;\r\n\t\t\t\t\tdijit.popup.close(this._promDialog);\r\n\t\t\t\t}), 3000);\r\n\t\tthis._isWorking = false;\r\n\t\tif(this.logResults){\r\n\t\t\tconsole.log(error);\r\n\t\t}\r\n\t},\r\n\t\r\n\tdestroy: function(){\r\n\t\t// summary:\r\n\t\t//\t\tCleanup of our plugin.\r\n\t\tthis.inherited(arguments);\r\n\t\t\r\n\t\tthis._menuItemAutoSave = null;\r\n\t\t\r\n\t\tif(this._promDialogTimeout){\r\n\t\t\tclearTimeout(this._promDialogTimeout);\r\n\t\t\tthis._promDialogTimeout = null;\r\n\t\t\tdijit.popup.close(this._promDialog);\r\n\t\t}\r\n\t\t\r\n\t\tthis._clearSaveInterval();\r\n\t\t\r\n\t\tif(this._saveSettingDialog){\r\n\t\t\tthis._saveSettingDialog.destroyRecursive();\r\n\t\t\tthis._destroyRecursive = null;\r\n\t\t}\r\n\t\t\r\n\t\tif(this._menuItemAutoSaveClickHandler){\r\n\t\t\tdojo.disconnect(this._menuItemAutoSaveClickHandler);\r\n\t\t\tthis._menuItemAutoSaveClickHandler = null;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// For monkey patching\r\nAutoSave._AutoSaveSettingDialog = AutoSaveSettingDialog;\r\n\r\n// Register this plugin.\r\ndojo.subscribe(dijit._scopeName + \".Editor.getPlugin\",null,function(o){\r\n\tif(o.plugin){ return; }\r\n\tvar name = o.args.name.toLowerCase();\r\n\tif(name == \"autosave\"){\r\n\t\to.plugin = new AutoSave({\r\n\t\t\turl: (\"url\" in o.args) ? o.args.url : \"\",\r\n\t\t\tlogResults: (\"logResults\" in o.args) ? o.args.logResults : true,\r\n\t\t\tinterval: (\"interval\" in o.args) ? o.args.interval : 5\r\n\t\t});\r\n\t}\r\n});\r\n\r\nreturn AutoSave;\r\n\r\n});\r\n"]}