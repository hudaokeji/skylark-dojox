{"version":3,"sources":["editor/plugins/Breadcrumb.js"],"names":["define","dojo","dijit","dojox","_Widget","_TemplatedMixin","_Contained","Toolbar","Menu","MenuItem","MenuSeparator","_Plugin","experimental","BreadcrumbMenuTitle","declare","templateString","menuTitle","postCreate","setSelectable","this","domNode","label","id","setAttribute","_setMenuTitleAttr","str","title","innerHTML","_getMenuTitleAttr","Breadcrumb","_menu","breadcrumbBar","setEditor","editor","_buttons","strings","i18n","getLocalization","_titleTemplate","nodeActions","place","footer","onLoadDeferred","addCallback","hitch","addClass","body","form","ComboButton","showLabel","_selNode","editNode","dropDown","onClick","_menuTarget","_selectContents","_menuTitle","_selCMenu","selectContents","_delCMenu","deleteContents","_deleteContents","_selEMenu","selectElement","_selectElement","_delEMenu","deleteElement","_deleteElement","_moveSMenu","moveStart","_moveCToStart","_moveEMenu","moveEnd","_moveCToEnd","addChild","_ddConnect","connect","set","string","substitute","nodeName","startup","isIE","setTimeout","className","focus","tagName","toLowerCase","_sCall","onDisplayChanged","e","beginEditing","endEditing","_updateBreadcrumb","ed","window","sel","range","getSelection","rangeCount","getRangeAt","node","startContainer","bcList","ownerDocument","document","nodeType","push","type","parentNode","reverse","length","db","pop","disconnect","removeChild","i","self","bc","b","updateState","style","iframe","get","size","marginBox","resize","h","destroy","destroyRecursive","inherited","arguments","_BreadcrumbMenuTitle","subscribe","_scopeName","o","plugin","args","name"],"mappings":"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","file":"../../../editor/plugins/Breadcrumb.js","sourcesContent":["define([\r\n\t\"dojo\",\r\n\t\"dijit\",\r\n\t\"dojox\",\r\n\t\"dijit/_Widget\",\r\n\t\"dijit/_TemplatedMixin\",\r\n\t\"dijit/_Contained\",\r\n\t\"dijit/Toolbar\",\r\n\t\"dijit/Menu\",\r\n\t\"dijit/MenuItem\",\r\n\t\"dijit/MenuSeparator\",\r\n\t\"dijit/_editor/_Plugin\",\r\n\t\"dijit/form/Button\",\r\n\t\"dijit/form/ComboButton\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/i18n\",\r\n\t\"dojo/string\",\r\n\t\"dojo/i18n!dojox/editor/plugins/nls/Breadcrumb\"\r\n], function(dojo, dijit, dojox, _Widget, _TemplatedMixin, _Contained, Toolbar, Menu, MenuItem,\r\n\tMenuSeparator, _Plugin) {\r\n\r\ndojo.experimental(\"dojox.editor.plugins.Breadcrumb\");\r\n\r\nvar BreadcrumbMenuTitle = dojo.declare(\"dojox.editor.plugins._BreadcrumbMenuTitle\",[_Widget, _TemplatedMixin, _Contained],{\r\n\t// summary:\r\n\t//\t\tSimple internal, non-clickable, menu entry to act as a menu title bar.\r\n\ttemplateString: \"<tr><td dojoAttachPoint=\\\"title\\\" colspan=\\\"4\\\" class=\\\"dijitToolbar\\\" style=\\\"font-weight: bold; padding: 3px;\\\"></td></tr>\",\r\n\r\n\tmenuTitle: \"\",\r\n\r\n\tpostCreate: function(){\r\n\t\tdojo.setSelectable(this.domNode, false);\r\n\t\tvar label = this.id+\"_text\";\r\n\t\tthis.domNode.setAttribute(\"aria-labelledby\", label);\r\n\t},\r\n\r\n\t_setMenuTitleAttr: function(str){\r\n\t\tthis.title.innerHTML = str;\r\n\t},\r\n\t_getMenuTitleAttr: function(str){\r\n\t\treturn this.title.innerHTML;\r\n\t}\r\n});\r\n\r\n\r\nvar Breadcrumb = dojo.declare(\"dojox.editor.plugins.Breadcrumb\", _Plugin,{\r\n\t// summary:\r\n\t//\t\tThis plugin provides Breadcrumb capability to the editor. As you move\r\n\t//\t\taround the editor, it updates with your current indention depth.\r\n\r\n\t// _menu: [private] Object\r\n\t//\t\tThe popup menu that is displayed.\r\n\t_menu: null,\r\n\r\n\t// breadcrumbBar: [protected] dijit/Toolbar\r\n\t//\t\tThe toolbar containing the breadcrumb.\r\n\tbreadcrumbBar: null,\r\n\r\n\tsetEditor: function(editor){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ride for the setting of the editor.\r\n\t\t// editor: Object\r\n\t\t//\t\tThe editor to configure for this plugin to use.\r\n\t\tthis.editor = editor;\r\n\t\tthis._buttons = [];\r\n\t\tthis.breadcrumbBar = new dijit.Toolbar();\r\n        \r\n\t\tvar strings = dojo.i18n.getLocalization(\"dojox.editor.plugins\", \"Breadcrumb\");\r\n\t\tthis._titleTemplate = strings.nodeActions;\r\n\r\n\t\tdojo.place(this.breadcrumbBar.domNode, editor.footer);\r\n\t\tthis.editor.onLoadDeferred.addCallback(dojo.hitch(this, function(){\r\n\t\t\tthis._menu = new dijit.Menu({});\r\n\t\t\tdojo.addClass(this.breadcrumbBar.domNode, \"dojoxEditorBreadcrumbArrow\");\r\n\t\t\tvar self = this;\r\n\t\t\tvar body = new dijit.form.ComboButton({\r\n\t\t\t\tshowLabel: true,\r\n\t\t\t\tlabel: \"body\",\r\n\t\t\t\t_selNode: editor.editNode,\r\n\t\t\t\tdropDown: this._menu,\r\n\t\t\t\tonClick: dojo.hitch(this, function(){\r\n\t\t\t\t\tthis._menuTarget = editor.editNode;\r\n\t\t\t\t\tthis._selectContents();\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// Build the menu\r\n\t\t\tthis._menuTitle = new BreadcrumbMenuTitle({menuTitle: strings.nodeActions});\r\n\t\t\tthis._selCMenu = new dijit.MenuItem({label: strings.selectContents, onClick: dojo.hitch(this, this._selectContents)});\r\n\t\t\tthis._delCMenu = new dijit.MenuItem({label: strings.deleteContents, onClick: dojo.hitch(this, this._deleteContents)});\r\n\t\t\tthis._selEMenu = new dijit.MenuItem({label: strings.selectElement, onClick: dojo.hitch(this, this._selectElement)});\r\n\t\t\tthis._delEMenu = new dijit.MenuItem({label: strings.deleteElement, onClick: dojo.hitch(this, this._deleteElement)});\r\n\t\t\tthis._moveSMenu = new dijit.MenuItem({label: strings.moveStart, onClick: dojo.hitch(this, this._moveCToStart)});\r\n\t\t\tthis._moveEMenu = new dijit.MenuItem({label: strings.moveEnd, onClick: dojo.hitch(this, this._moveCToEnd)});\r\n\r\n\t\t\tthis._menu.addChild(this._menuTitle);\r\n\t\t\tthis._menu.addChild(this._selCMenu);\r\n\t\t\tthis._menu.addChild(this._delCMenu);\r\n\t\t\tthis._menu.addChild(new dijit.MenuSeparator({}));\r\n\t\t\tthis._menu.addChild(this._selEMenu);\r\n\t\t\tthis._menu.addChild(this._delEMenu);\r\n\t\t\tthis._menu.addChild(new dijit.MenuSeparator({}));\r\n\t\t\tthis._menu.addChild(this._moveSMenu);\r\n\t\t\tthis._menu.addChild(this._moveEMenu);\r\n\r\n\t\t\tbody._ddConnect = dojo.connect(body, \"openDropDown\", dojo.hitch(this, function(){\r\n\t\t\t\tthis._menuTarget = body._selNode;\r\n\t\t\t\tthis._menuTitle.set(\"menuTitle\", dojo.string.substitute(this._titleTemplate,{\r\n\t\t\t\t\t\t\"nodeName\": \"&lt;body&gt;\"\r\n\t\t\t\t}));\r\n\t\t\t\tthis._selEMenu.set(\"disabled\", true);\r\n\t\t\t\tthis._delEMenu.set(\"disabled\", true);\r\n\t\t\t\tthis._selCMenu.set(\"disabled\", false);\r\n\t\t\t\tthis._delCMenu.set(\"disabled\", false);\r\n\t\t\t\tthis._moveSMenu.set(\"disabled\", false);\r\n\t\t\t\tthis._moveEMenu.set(\"disabled\", false);\r\n\t\t\t}));\r\n\t\t\tthis.breadcrumbBar.addChild(body);\r\n\t\t\tthis.connect(this.editor, \"onNormalizedDisplayChanged\", \"updateState\");\r\n\t\t}));\r\n\t\tthis.breadcrumbBar.startup();\r\n\t\tif(dojo.isIE){\r\n\t\t\t// Sometimes IE will mess up layout and needs to be poked.\r\n            setTimeout(dojo.hitch(this, function(){this.breadcrumbBar.domNode.className = this.breadcrumbBar.domNode.className;}), 100);\r\n\t\t}\r\n\t},\r\n\r\n\t_selectContents: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal function for selecting the contents of a node.\r\n\t\tthis.editor.focus();\r\n\t\tif(this._menuTarget){\r\n\t\t\tvar nodeName = this._menuTarget.tagName.toLowerCase();\r\n\t\t\tswitch(nodeName){\r\n\t\t\t\tcase 'br':\r\n\t\t\t\tcase 'hr':\r\n\t\t\t\tcase 'img':\r\n\t\t\t\tcase 'input':\r\n\t\t\t\tcase 'base':\r\n\t\t\t\tcase 'meta':\r\n\t\t\t\tcase 'area':\r\n\t\t\t\tcase 'basefont':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tthis.editor._sCall(\"collapse\", [null]);\r\n\t\t\t\t\t\tthis.editor._sCall(\"selectElementChildren\", [this._menuTarget]);\r\n\t\t\t\t\t\tthis.editor.onDisplayChanged();\r\n\t\t\t\t\t}catch(e){/*squelch*/}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_deleteContents: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal function for selecting the contents of a node.\r\n\t\tif(this._menuTarget){\r\n\t\t\tthis.editor.beginEditing();\r\n\t\t\tthis._selectContents();\r\n\t\t\tthis.editor._sCall(\"remove\", [this._menuTarget]);\r\n\t\t\tthis.editor.endEditing();\r\n\t\t\tthis._updateBreadcrumb();\r\n\t\t\tthis.editor.onDisplayChanged();\r\n\t\t}\r\n\t},\r\n\r\n\t_selectElement: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal function for selecting the contents of a node.\r\n\t\tthis.editor.focus();\r\n\t\tif(this._menuTarget){\r\n\t\t\tthis.editor._sCall(\"collapse\", [null]);\r\n\t\t\tthis.editor._sCall(\"selectElement\", [this._menuTarget]);\r\n\t\t\tthis.editor.onDisplayChanged();\r\n\t\t\t\r\n\t\t}\r\n\t},\r\n\r\n\t_deleteElement: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal function for selecting the contents of a node.\r\n\t\tif(this._menuTarget){\r\n\t\t\tthis.editor.beginEditing();\r\n\t\t\tthis._selectElement();\r\n\t\t\tthis.editor._sCall(\"remove\", [this._menuTarget]);\r\n\t\t\tthis.editor.endEditing();\r\n\t\t\tthis._updateBreadcrumb();\r\n\t\t\tthis.editor.onDisplayChanged();\r\n\t\t}\r\n\t},\r\n\r\n\t_moveCToStart: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal function for selecting the contents of a node.\r\n\t\tthis.editor.focus();\r\n\t\tif(this._menuTarget){\r\n\t\t\tthis._selectContents();\r\n\t\t\tthis.editor._sCall(\"collapse\", [true]);\r\n\t\t}\r\n\t},\r\n\r\n\t_moveCToEnd: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal function for selecting the contents of a node.\r\n\t\tthis.editor.focus();\r\n\t\tif(this._menuTarget){\r\n\t\t\tthis._selectContents();\r\n\t\t\tthis.editor._sCall(\"collapse\", [false]);\r\n\t\t}\r\n\t},\r\n\r\n\t_updateBreadcrumb: function(){\r\n\t\t// summary:\r\n\t\t//\t\tFunction to trigger updating of the breadcrumb\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tvar ed = this.editor;\r\n\t\tif(ed.window){\r\n\t\t\tvar sel = dijit.range.getSelection(ed.window);\r\n\t\t\tif(sel && sel.rangeCount > 0){\r\n\t\t\t\tvar range = sel.getRangeAt(0);\r\n                \r\n\t\t\t\t// Check the getSelectedElement call.  Needed when dealing with img tags.\r\n\t\t\t\tvar node = ed._sCall(\"getSelectedElement\", []) || range.startContainer;\r\n\t\t\t\t//var node = range.startContainer;\r\n\t\t\t\tvar bcList = [];\r\n\r\n\t\t\t\t// Make sure we get a selection within the editor document,\r\n\t\t\t\t// have seen cases on IE where this wasn't true.\r\n\t\t\t\tif(node && node.ownerDocument === ed.document){\r\n\t\t\t\t\twhile(node && node !== ed.editNode && node != ed.document.body && node != ed.document){\r\n\t\t\t\t\t\tif(node.nodeType === 1){\r\n\t\t\t\t\t\t\tbcList.push({type: node.tagName.toLowerCase(), node: node});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbcList = bcList.reverse();\r\n\r\n\t\t\t\t\twhile(this._buttons.length){\r\n\t\t\t\t\t\tvar db = this._buttons.pop();\r\n\t\t\t\t\t\tdojo.disconnect(db._ddConnect);\r\n\t\t\t\t\t\tthis.breadcrumbBar.removeChild(db);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._buttons = [];\r\n\r\n\t\t\t\t\tvar i;\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tfor(i = 0; i < bcList.length; i++){\r\n\t\t\t\t\t\tvar bc = bcList[i];\r\n\t\t\t\t\t\tvar b = new dijit.form.ComboButton({\r\n\t\t\t\t\t\t\tshowLabel: true,\r\n\t\t\t\t\t\t\tlabel: bc.type,\r\n\t\t\t\t\t\t\t_selNode: bc.node,\r\n\t\t\t\t\t\t\tdropDown: this._menu,\r\n\t\t\t\t\t\t\tonClick: function(){\r\n\t\t\t\t\t\t\t\tself._menuTarget = this._selNode;\r\n\t\t\t\t\t\t\t\tself._selectContents();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tb._ddConnect = dojo.connect(b, \"openDropDown\", dojo.hitch(b, function(){\r\n\t\t\t\t\t\t\tself._menuTarget = this._selNode;\r\n\t\t\t\t\t\t\tvar nodeName = self._menuTarget.tagName.toLowerCase();\r\n\t\t\t\t\t\t\tvar title = dojo.string.substitute(self._titleTemplate,{\r\n\t\t\t\t\t\t\t\t\"nodeName\": \"&lt;\" + nodeName + \"&gt;\"\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tself._menuTitle.set(\"menuTitle\", title);\r\n\t\t\t\t\t\t\tswitch(nodeName){\r\n\t\t\t\t\t\t\t\tcase 'br':\r\n\t\t\t\t\t\t\t\tcase 'hr':\r\n\t\t\t\t\t\t\t\tcase 'img':\r\n\t\t\t\t\t\t\t\tcase 'input':\r\n\t\t\t\t\t\t\t\tcase 'base':\r\n\t\t\t\t\t\t\t\tcase 'meta':\r\n\t\t\t\t\t\t\t\tcase 'area':\r\n\t\t\t\t\t\t\t\tcase 'basefont':\r\n\t\t\t\t\t\t\t\t\tself._selCMenu.set(\"disabled\", true);\r\n\t\t\t\t\t\t\t\t\tself._delCMenu.set(\"disabled\", true);\r\n\t\t\t\t\t\t\t\t\tself._moveSMenu.set(\"disabled\", true);\r\n\t\t\t\t\t\t\t\t\tself._moveEMenu.set(\"disabled\", true);\r\n\t\t\t\t\t\t\t\t\tself._selEMenu.set(\"disabled\", false);\r\n\t\t\t\t\t\t\t\t\tself._delEMenu.set(\"disabled\", false);\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\tself._selCMenu.set(\"disabled\", false);\r\n\t\t\t\t\t\t\t\t\tself._delCMenu.set(\"disabled\", false);\r\n\t\t\t\t\t\t\t\t\tself._selEMenu.set(\"disabled\", false);\r\n\t\t\t\t\t\t\t\t\tself._delEMenu.set(\"disabled\", false);\r\n\t\t\t\t\t\t\t\t\tself._moveSMenu.set(\"disabled\", false);\r\n\t\t\t\t\t\t\t\t\tself._moveEMenu.set(\"disabled\", false);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t\tthis._buttons.push(b);\r\n\t\t\t\t\t\tthis.breadcrumbBar.addChild(b);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(dojo.isIE){\r\n\t\t\t\t\t\t// Prod it to fix layout.\r\n\t\t\t\t\t\tthis.breadcrumbBar.domNode.className = this.breadcrumbBar.domNode.className;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tupdateState: function(){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ride of updateState to hide the toolbar when the iframe is not visible.\r\n\t\t//\t\tAlso triggers the breadcrumb update.\r\n\t\tif(dojo.style(this.editor.iframe, \"display\") === \"none\" || this.get(\"disabled\")){\r\n\t\t\tdojo.style(this.breadcrumbBar.domNode, \"display\", \"none\");\r\n\t\t}else{\r\n\t\t\tif(dojo.style(this.breadcrumbBar.domNode, \"display\") === \"none\"){\r\n\t\t\t\tdojo.style(this.breadcrumbBar.domNode, \"display\", \"block\");\r\n\t\t\t}\r\n\t\t\tthis._updateBreadcrumb();\r\n\r\n\t\t\t// Some themes do padding, so we have to resize again after display.\r\n\t\t\tvar size = dojo.marginBox(this.editor.domNode);\r\n\t\t\tthis.editor.resize({h: size.h});\r\n\t\t}\r\n\t},\r\n\r\n\tdestroy: function(){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ride to clean up the breadcrumb toolbar.\r\n\t\tif(this.breadcrumbBar){\r\n\t\t\tthis.breadcrumbBar.destroyRecursive();\r\n\t\t\tthis.breadcrumbBar = null;\r\n\t\t}\r\n\t\tif(this._menu){\r\n\t\t\tthis._menu.destroyRecursive();\r\n\t\t\tdelete this._menu;\r\n\t\t}\r\n\t\tthis._buttons = null;\r\n\t\tdelete this.editor.breadcrumbBar;\r\n\t\tthis.inherited(arguments);\r\n\t}\r\n});\r\n\r\n// For monkey patching\r\nBreadcrumb._BreadcrumbMenuTitle = BreadcrumbMenuTitle;\r\n\r\n// Register this plugin.\r\ndojo.subscribe(dijit._scopeName + \".Editor.getPlugin\",null,function(o){\r\n\tif(o.plugin){ return; }\r\n\tvar name = o.args.name.toLowerCase();\r\n\tif(name === \"breadcrumb\"){\r\n\t\to.plugin = new Breadcrumb({});\r\n\t}\r\n});\r\n\r\nreturn Breadcrumb;\r\n\r\n});\r\n"]}