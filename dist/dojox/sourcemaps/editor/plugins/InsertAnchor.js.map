{"version":3,"sources":["editor/plugins/InsertAnchor.js"],"names":["define","dojo","dijit","dojox","_Plugin","InsertAnchor","declare","htmlTemplate","iconClassPrefix","_template","join","_initButton","_this","this","messages","i18n","getLocalization","lang","dropDown","TooltipDialog","title","execute","hitch","onOpen","_onOpenDialog","prototype","apply","arguments","onCancel","setTimeout","button","form","DropDownButton","label","showLabel","iconClass","tabIndex","id","getUniqueId","editor","_uniqueId","set","string","substitute","startup","_anchorInput","byId","_textInput","_setButton","connect","contentDomPreFilters","push","_preDomFilter","contentDomPostFilters","_postDomFilter","_setup","updateState","get","setEditor","_checkInput","disable","isValid","onLoadDeferred","addCallback","editNode","_onDblClick","_applyStyles","getAnchorStyle","modurl","moduleUrl","_scopeName","toString","match","bUrl","charAt","doc","location","protocol","host","_calcBaseUrl","global","href","length","replace","_styled","document","style","isIE","createStyleSheet","cssText","sNode","createElement","appendChild","createTextNode","getElementsByTagName","e","fullUrl","baseUrl","index","indexOf","substring","lastIndexOf","_checkValues","args","anchorInput","textInput","setValue","_onCloseDialog","window","getSelection","a","range","getRangeAt","endContainer","nodeType","parentNode","nodeName","toLowerCase","_sCall","queryCommandEnabled","execCommand","focus","_getCurrentValues","anchor","text","tagName","attr","textContent","innerText","reset","target","t","onDisplayChanged","openDropDown","node","query","addClass","removeClass","subscribe","o","plugin","name"],"mappings":";;;;;;;AAAAA,QACC,OACA,QACA,QACA,wBACA,sBACA,sBACA,mBACA,sBACA,+BACA,oBACA,oBACA,4BACA,qBACA,YACA,cACA,oBACA,wCACA,kDACA,8BACE,SAASC,EAAMC,EAAOC,EAAOC,GAEhC,IAAIC,EAAeJ,EAAKK,QAAQ,oCAAqCF,GAYpEG,aAAc,uFAIdC,gBAAiB,4BAIjBC,WACC,sCACA,mDACA,YACA,uIAEA,qBACA,+CACA,YACA,mIAEA,aACA,uBACA,0FACA,gGACA,sBACCC,KAAK,IAEPC,YAAa,WAGZ,IAAIC,EAAQC,KACRC,EAAWb,EAAKc,KAAKC,gBAAgB,uBAAwB,eAAgBH,KAAKI,MAGlFC,EAAYL,KAAKK,SAAW,IAAIhB,EAAMiB,eACzCC,MAAON,EAAgB,MACvBO,QAASpB,EAAKqB,MAAMT,KAAM,YAC1BU,OAAQ,WACPX,EAAMY,gBACNtB,EAAMiB,cAAcM,UAAUF,OAAOG,MAAMb,KAAMc,YAElDC,SAAU,WACTC,WAAW5B,EAAKqB,MAAMV,EAAO,kBAAkB,MAIjDC,KAAKiB,OAAS,IAAI5B,EAAM6B,KAAKC,gBAC5BC,MAAOnB,EAAuB,aAC9BoB,WAAW,EACXC,UAAWtB,KAAKL,gBAAkB,IAAMK,KAAKL,gBAAkB,eAC/D4B,SAAU,KACVlB,SAAUL,KAAKK,WAGhBJ,EAASuB,GAAKnC,EAAMoC,YAAYzB,KAAK0B,OAAOF,IAC5CxB,KAAK2B,UAAY1B,EAASuB,GAE1BxB,KAAKK,SAASuB,IAAI,UAAWvB,EAASE,MACrC,0FACAnB,EAAKyC,OAAOC,WAAW9B,KAAKJ,UAAWK,IAExCI,EAAS0B,UACT/B,KAAKgC,aAAe3C,EAAM4C,KAAKjC,KAAK2B,UAAY,gBAChD3B,KAAKkC,WAAa7C,EAAM4C,KAAKjC,KAAK2B,UAAY,cAC9C3B,KAAKmC,WAAa9C,EAAM4C,KAAKjC,KAAK2B,UAAY,cAC9C3B,KAAKoC,QAAQ/C,EAAM4C,KAAKjC,KAAK2B,UAAY,iBAAkB,UAAW,WACrE3B,KAAKK,SAASU,aAGZf,KAAKgC,cACPhC,KAAKoC,QAAQpC,KAAKgC,aAAc,WAAY,eAE1ChC,KAAKkC,YACPlC,KAAKoC,QAAQpC,KAAKgC,aAAc,WAAY,eAI7ChC,KAAK0B,OAAOW,qBAAqBC,KAAKlD,EAAKqB,MAAMT,KAAMA,KAAKuC,gBAC5DvC,KAAK0B,OAAOc,sBAAsBF,KAAKlD,EAAKqB,MAAMT,KAAMA,KAAKyC,iBAC7DzC,KAAK0C,UAGNC,YAAa,WAGZ3C,KAAKiB,OAAOW,IAAI,WAAY5B,KAAK4C,IAAI,cAGtCC,UAAW,SAASnB,GAKnB1B,KAAK0B,OAASA,EACd1B,KAAKF,eAGNgD,YAAa,WAMZ,IAAIC,GAAU,EACX/C,KAAKgC,aAAagB,YACpBD,GAAU,GAEX/C,KAAKmC,WAAWP,IAAI,WAAYmB,IAGjCL,OAAQ,WAGP1C,KAAK0B,OAAOuB,eAAeC,YAAY9D,EAAKqB,MAAMT,KAAM,WACvDA,KAAKoC,QAAQpC,KAAK0B,OAAOyB,SAAU,aAAcnD,KAAKoD,aACtDpC,WAAW5B,EAAKqB,MAAMT,KAAM,WAC3BA,KAAKqD,iBACF,SAINC,eAAgB,WAMf,IAaIC,EAASnE,EAAKoE,UAAUlE,EAAMmE,WAAY,4BAA4BC,WAC1E,IAAKH,EAAOI,MAAM,mBACfJ,EAAOI,MAAM,eAAgB,CAG/B,IAAIC,EACJ,GAAwB,MAArBL,EAAOM,OAAO,GAIhBD,EAFYxE,EAAK0E,IAAIC,SAASC,SAEf,KADH5E,EAAK0E,IAAIC,SAASE,UAG9BL,EAAO5D,KAAKkE,aAAa9E,EAAK+E,OAAOJ,SAASK,MAElB,MAA1BR,EAAKA,EAAKS,OAAS,IAAmC,MAArBd,EAAOM,OAAO,KACjDD,GAAQ,KAETL,EAASK,EAAOL,EAEjB,MAhCY,4SAgCCe,QAAQ,eAAgBf,IAGtCF,aAAc,WAIb,IAAIrD,KAAKuE,QACR,IAECvE,KAAKuE,SAAU,EACf,IAAIT,EAAM9D,KAAK0B,OAAO8C,SAClBC,EAAQzE,KAAKsD,iBACjB,GAAIlE,EAAKsF,KAIJ,CACKZ,EAAIa,iBAAiB,IAC3BC,QAAUH,MANA,CACb,IAAII,EAAQf,EAAIgB,cAAc,SAC9BD,EAAME,YAAYjB,EAAIkB,eAAeP,IACrCX,EAAImB,qBAAqB,QAAQ,GAAGF,YAAYF,IAKhD,MAAMK,MAIVhB,aAAc,SAASiB,GAQtB,IAAIC,EAAU,KACd,GAAgB,OAAZD,EAAkB,CAErB,IAAIE,EAAQF,EAAQG,QAAQ,MACd,GAAVD,IACHF,EAAUA,EAAQI,UAAU,EAAEF,IAO9BD,GAFDC,EAAQF,EAAQK,YAAY,MAChB,GAAKH,EAAQF,EAAQd,OACtBc,EAAQI,UAAU,EAAEF,GAEpBF,EAGZ,OAAOC,GAGRK,aAAc,SAASC,GAkBtB,OAXGA,IACCA,EAAKC,cACPD,EAAKC,YAAcD,EAAKC,YAAYrB,QAAQ,KAAM,WAE/CoB,EAAKE,YAIRF,EAAKE,UAAY,WAGZF,GAGRG,SAAU,SAASH,GAMlB,GADA1F,KAAK8F,kBACD9F,KAAK0B,OAAOqE,OAAOC,aAAa,CAEnC,IAEIC,EAFM5G,EAAM6G,MAAMF,aAAahG,KAAK0B,OAAOqE,QAC/BI,WAAW,GACbC,aACI,IAAfH,EAAEI,WAIJJ,EAAIA,EAAEK,YAEJL,GAAMA,EAAEM,UAAyC,MAA7BN,EAAEM,SAASC,gBAGjCP,EAAIjG,KAAK0B,OAAO+E,OAAO,sBAAuB,OAE5CR,GAAMA,EAAEM,UAAyC,MAA7BN,EAAEM,SAASC,eAK9BxG,KAAK0B,OAAOgF,oBAAoB,YAGlC1G,KAAK0B,OAAO+E,OAAO,yBAA0BR,IAC7CjG,KAAK0B,OAAOiF,YAAY,WAK3BjB,EAAO1F,KAAKyF,aAAaC,GACzB1F,KAAK0B,OAAOiF,YAAY,aACvBvH,EAAKyC,OAAOC,WAAW9B,KAAKN,aAAcgG,KAG5CI,eAAgB,WAGf9F,KAAK0B,OAAOkF,SAGbC,kBAAmB,SAASZ,GAO3B,IAAIa,EAAQC,EAQZ,OAPGd,GAAiC,MAA5BA,EAAEe,QAAQR,eAAyBpH,EAAK6H,KAAKhB,EAAG,SACvDa,EAAS1H,EAAK6H,KAAKhB,EAAG,QACtBc,EAAOd,EAAEiB,aAAejB,EAAEkB,UAC1BnH,KAAK0B,OAAO+E,OAAO,iBAAkBR,GAAG,KAExCc,EAAO/G,KAAK0B,OAAO+E,OAAO,oBAEnBd,YAAamB,GAAU,GAAIlB,UAAWmB,GAAQ,KAGvDpG,cAAe,WAId,IAAIsF,EACAjG,KAAK0B,OAAOqE,OAAOC,aAkBtBC,EAAIjG,KAAK0B,OAAO+E,OAAO,sBAAuB,OAZ5B,KADlBR,EAFU5G,EAAM6G,MAAMF,aAAahG,KAAK0B,OAAOqE,QAC/BI,WAAW,GACjBC,cACLC,WAIJJ,EAAIA,EAAEK,YAEJL,GAAMA,EAAEM,UAAyC,MAA7BN,EAAEM,SAASC,gBAGjCP,EAAIjG,KAAK0B,OAAO+E,OAAO,sBAAuB,QAKhDzG,KAAKK,SAAS+G,QACdpH,KAAKmC,WAAWP,IAAI,YAAY,GAChC5B,KAAKK,SAASuB,IAAI,QAAS5B,KAAK6G,kBAAkBZ,KAGnD7C,YAAa,SAAS8B,GASrB,GAAGA,GAAKA,EAAEmC,OAAO,CAChB,IAAIC,EAAIpC,EAAEmC,OAEA,OADDC,EAAEN,QAASM,EAAEN,QAAQR,cAAgB,KAC7BpH,EAAK6H,KAAKK,EAAG,UAC7BtH,KAAK0B,OAAO6F,mBACZvH,KAAK0B,OAAO+E,OAAO,iBAAkBa,IACrCtG,WAAW5B,EAAKqB,MAAMT,KAAM,WAG3BA,KAAKiB,OAAOW,IAAI,YAAY,GAC5B5B,KAAKiB,OAAOuG,eACTxH,KAAKiB,OAAOZ,SAASuG,OACvB5G,KAAKiB,OAAOZ,SAASuG,UAEnB,OAKPrE,cAAe,SAASkF,GASvBrI,EAAKsI,MAAM,sBAAuB1H,KAAK0B,OAAOyB,UAAUwE,SAAS,uCAGlElF,eAAgB,SAASgF,GAYxB,OAHGA,GACFrI,EAAKsI,MAAM,sBAAuBD,GAAMG,YAAY,sCAE9CH,KAeT,OATArI,EAAKyI,UAAUxI,EAAMoE,WAAa,oBAAoB,KAAK,SAASqE,GACnE,IAAGA,EAAEC,OAAL,CACA,IAAIC,EAAOF,EAAEpC,KAAKsC,KACfA,IAAQA,EAAOA,EAAKxB,eACX,iBAATwB,IACFF,EAAEC,OAAS,IAAIvI,MAIVA","file":"../../../editor/plugins/InsertAnchor.js","sourcesContent":["define([\r\n\t\"dojo\",\r\n\t\"dijit\",\r\n\t\"dojox\",\r\n\t\"dijit/_editor/_Plugin\",\r\n\t\"dijit/_base/manager\",\t// TODO: change to dijit/registry, and change dijit.byId to registry.byId\r\n\t\"dijit/_editor/range\",\r\n\t\"dijit/_Templated\",\r\n\t\"dijit/TooltipDialog\",\r\n\t\"dijit/form/ValidationTextBox\",\r\n\t\"dijit/form/Select\",\r\n\t\"dijit/form/Button\",\r\n\t\"dijit/form/DropDownButton\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/i18n\",\r\n\t\"dojo/string\",\r\n\t\"dojo/NodeList-dom\",\r\n\t\"dojox/editor/plugins/ToolbarLineBreak\",\r\n\t\"dojo/i18n!dojox/editor/plugins/nls/InsertAnchor\",\r\n\t\"dojo/i18n!dijit/nls/common\"\r\n], function(dojo, dijit, dojox, _Plugin ) {\r\n\r\nvar InsertAnchor = dojo.declare(\"dojox.editor.plugins.InsertAnchor\", _Plugin, {\r\n\t// summary:\r\n\t//\t\tThis plugin provides the basis for an insert anchor dialog for the\r\n\t//\t\tdijit.Editor\r\n\t//\r\n\t// description:\r\n\t//\t\tThe command provided by this plugin is:\r\n\t//\r\n\t//\t\t- insertAnchor\r\n\r\n\t// htmlTemplate: [protected] String\r\n\t//\t\tString used for templating the HTML to insert at the desired point.\r\n\thtmlTemplate: \"<a name=\\\"${anchorInput}\\\" class=\\\"dijitEditorPluginInsertAnchorStyle\\\">${textInput}</a>\",\r\n\r\n\t// iconClassPrefix: [const] String\r\n\t//\t\tThe CSS class name for the button node icon.\r\n\ticonClassPrefix: \"dijitAdditionalEditorIcon\",\r\n\r\n\t// linkDialogTemplate: [private] String\r\n\t//\t\tTemplate for contents of TooltipDialog to pick URL\r\n\t_template: [\r\n\t\t\"<table role='presentation'><tr><td>\",\r\n\t\t\"<label for='${id}_anchorInput'>${anchor}</label>\",\r\n\t\t\"</td><td>\",\r\n\t\t\"<input dojoType='dijit.form.ValidationTextBox' required='true' \" +\r\n\t\t\"id='${id}_anchorInput' name='anchorInput' intermediateChanges='true'>\",\r\n\t\t\"</td></tr><tr><td>\",\r\n\t\t\"<label for='${id}_textInput'>${text}</label>\",\r\n\t\t\"</td><td>\",\r\n\t\t\"<input dojoType='dijit.form.ValidationTextBox' required='true' id='${id}_textInput' \" +\r\n\t\t\"name='textInput' intermediateChanges='true'>\",\r\n\t\t\"</td></tr>\",\r\n\t\t\"<tr><td colspan='2'>\",\r\n\t\t\"<button dojoType='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button>\",\r\n\t\t\"<button dojoType='dijit.form.Button' type='button' id='${id}_cancelButton'>${cancel}</button>\",\r\n\t\t\"</td></tr></table>\"\r\n\t].join(\"\"),\r\n\r\n\t_initButton: function(){\r\n\t\t// summary:\r\n\t\t//\t\tOverride _Plugin._initButton() to initialize DropDownButton and TooltipDialog.\r\n\t\tvar _this = this;\r\n\t\tvar messages = dojo.i18n.getLocalization(\"dojox.editor.plugins\", \"InsertAnchor\", this.lang);\r\n\r\n\t\t// Build the dropdown dialog we'll use for the button\r\n\t\tvar dropDown = (this.dropDown = new dijit.TooltipDialog({\r\n\t\t\ttitle: messages[\"title\"],\r\n\t\t\texecute: dojo.hitch(this, \"setValue\"),\r\n\t\t\tonOpen: function(){\r\n\t\t\t\t_this._onOpenDialog();\r\n\t\t\t\tdijit.TooltipDialog.prototype.onOpen.apply(this, arguments);\r\n\t\t\t},\r\n\t\t\tonCancel: function(){\r\n\t\t\t\tsetTimeout(dojo.hitch(_this, \"_onCloseDialog\"),0);\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis.button = new dijit.form.DropDownButton({\r\n\t\t\tlabel: messages[\"insertAnchor\"],\r\n\t\t\tshowLabel: false,\r\n\t\t\ticonClass: this.iconClassPrefix + \" \" + this.iconClassPrefix + \"InsertAnchor\",\r\n\t\t\ttabIndex: \"-1\",\r\n\t\t\tdropDown: this.dropDown\r\n\t\t});\r\n\r\n\t\tmessages.id = dijit.getUniqueId(this.editor.id);\r\n\t\tthis._uniqueId = messages.id;\r\n\r\n\t\tthis.dropDown.set('content', dropDown.title +\r\n\t\t\t\"<div style='border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'></div>\" +\r\n\t\t\tdojo.string.substitute(this._template, messages));\r\n\r\n\t\tdropDown.startup();\r\n\t\tthis._anchorInput = dijit.byId(this._uniqueId + \"_anchorInput\");\r\n\t\tthis._textInput = dijit.byId(this._uniqueId + \"_textInput\");\r\n\t\tthis._setButton = dijit.byId(this._uniqueId + \"_setButton\");\r\n\t\tthis.connect(dijit.byId(this._uniqueId + \"_cancelButton\"), \"onClick\", function(){\r\n\t\t\tthis.dropDown.onCancel();\r\n\t\t});\r\n\r\n\t\tif(this._anchorInput){\r\n\t\t\tthis.connect(this._anchorInput, \"onChange\", \"_checkInput\");\r\n\t\t}\r\n\t\tif(this._textInput){\r\n\t\t\tthis.connect(this._anchorInput, \"onChange\", \"_checkInput\");\r\n\t\t}\r\n\r\n\t\t//Register some filters to handle setting/removing the class tags on anchors.\r\n\t\tthis.editor.contentDomPreFilters.push(dojo.hitch(this, this._preDomFilter));\r\n\t\tthis.editor.contentDomPostFilters.push(dojo.hitch(this, this._postDomFilter));\r\n\t\tthis._setup();\r\n\t},\r\n\t\r\n\tupdateState: function(){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ride for button state control for disabled to work.\r\n\t\tthis.button.set(\"disabled\", this.get(\"disabled\"));\r\n\t},\r\n\r\n\tsetEditor: function(editor){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ride for the setting of the editor.\r\n\t\t// editor: Object\r\n\t\t//\t\tThe editor to configure for this plugin to use.\r\n\t\tthis.editor = editor;\r\n\t\tthis._initButton();\r\n\t},\r\n\r\n\t_checkInput: function(){\r\n\t\t// summary:\r\n\t\t//\t\tFunction to check the input to the dialog is valid\r\n\t\t//\t\tand enable/disable set button\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tvar disable = true;\r\n\t\tif(this._anchorInput.isValid()){\r\n\t\t\tdisable = false;\r\n\t\t}\r\n\t\tthis._setButton.set(\"disabled\", disable);\r\n\t},\r\n\r\n\t_setup: function(){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ridable function that connects tag specific events.\r\n\t\tthis.editor.onLoadDeferred.addCallback(dojo.hitch(this, function(){\r\n\t\t\tthis.connect(this.editor.editNode, \"ondblclick\", this._onDblClick);\r\n\t\t\tsetTimeout(dojo.hitch(this, function() {\r\n\t\t\t\tthis._applyStyles();\r\n\t\t\t}), 100);\r\n\t\t}));\r\n\t},\r\n\r\n\tgetAnchorStyle: function(){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ridable function for getting the style to apply to the anchor.\r\n\t\t//\t\tThe default is a dashed border with an anchor symbol.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\tvar style = \"@media screen {\\n\" +\r\n\t\t\t\t\"\\t.dijitEditorPluginInsertAnchorStyle {\\n\" +\r\n\t\t\t\t\"\\t\\tbackground-image: url({MODURL}/images/anchor.gif);\\n\" +\r\n\t\t\t\t\"\\t\\tbackground-repeat: no-repeat;\\n\"\t+\r\n\t\t\t\t\"\\t\\tbackground-position: top left;\\n\" +\r\n\t\t\t\t\"\\t\\tborder-width: 1px;\\n\" +\r\n\t\t\t\t\"\\t\\tborder-style: dashed;\\n\" +\r\n\t\t\t\t\"\\t\\tborder-color: #D0D0D0;\\n\" +\r\n\t\t\t\t \"\\t\\tpadding-left: 20px;\\n\" +\r\n\t\t\t\"\\t}\\n\" +\r\n\t\t\"}\\n\";\r\n\r\n\t\t//Finally associate in the image locations based off the module url.\r\n\t\tvar modurl = dojo.moduleUrl(dojox._scopeName, \"editor/plugins/resources\").toString();\r\n\t\tif(!(modurl.match(/^https?:\\/\\//i)) &&\r\n\t\t\t!(modurl.match(/^file:\\/\\//i))){\r\n\t\t\t// We have to root it to the page location on webkit for some nutball reason.\r\n\t\t\t// Probably has to do with how iframe was loaded.\r\n\t\t\tvar bUrl;\r\n\t\t\tif(modurl.charAt(0) === \"/\"){\r\n\t\t\t\t//Absolute path on the server, so lets handle...\r\n\t\t\t\tvar proto = dojo.doc.location.protocol;\r\n\t\t\t\tvar hostn = dojo.doc.location.host;\r\n\t\t\t\tbUrl = proto + \"//\" + hostn;\r\n\t\t\t}else{\r\n\t\t\t\tbUrl = this._calcBaseUrl(dojo.global.location.href);\r\n\t\t\t}\r\n\t\t\tif(bUrl[bUrl.length - 1] !== \"/\" && modurl.charAt(0) !== \"/\"){\r\n\t\t\t\tbUrl += \"/\";\r\n\t\t\t}\r\n\t\t\tmodurl = bUrl + modurl;\r\n\t\t}\r\n\t\treturn style.replace(/\\{MODURL\\}/gi, modurl);\r\n\t},\r\n\r\n\t_applyStyles: function(){\r\n\t\t// summary:\r\n\t\t//\t\tFunction to apply a style to inserted anchor tags so that\r\n\t\t//\t\tthey are obviously anchors.\r\n\t\tif(!this._styled){\r\n\t\t\ttry{\r\n\t\t\t\t//Attempt to inject our specialized style rules for doing this.\r\n\t\t\t\tthis._styled = true;\r\n\t\t\t\tvar doc = this.editor.document;\r\n\t\t\t\tvar style = this.getAnchorStyle();\r\n\t\t\t\tif(!dojo.isIE){\r\n\t\t\t\t\tvar sNode = doc.createElement(\"style\");\r\n\t\t\t\t\tsNode.appendChild(doc.createTextNode(style));\r\n\t\t\t\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(sNode);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar ss = doc.createStyleSheet(\"\");\r\n\t\t\t\t\tss.cssText = style;\r\n\t\t\t\t}\r\n\t\t\t }catch(e){ /* Squelch */ }\r\n\t\t }\r\n\t},\r\n\r\n\t_calcBaseUrl: function(fullUrl) {\r\n\t\t// summary:\r\n\t\t//\t\tInternal function used to figure out the full root url (no relatives)\r\n\t\t//\t\tfor loading images in the styles in the iframe.\r\n\t\t// fullUrl: String\r\n\t\t//\t\tThe full url to tear down to the base.\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tvar baseUrl = null;\r\n\t\tif (fullUrl !== null) {\r\n\t\t\t// Check to see if we need to strip off any query parameters from the Url.\r\n\t\t\tvar index = fullUrl.indexOf(\"?\");\r\n\t\t\tif (index != -1) {\r\n\t\t\t\tfullUrl = fullUrl.substring(0,index);\r\n\t\t\t}\r\n\r\n\t\t\t// Now we need to trim if necessary.  If it ends in /, then we don't\r\n\t\t\t// have a filename to trim off so we can return.\r\n\t\t\tindex = fullUrl.lastIndexOf(\"/\");\r\n\t\t\tif (index > 0 && index < fullUrl.length) {\r\n\t\t\t\tbaseUrl = fullUrl.substring(0,index);\r\n\t\t\t}else{\r\n\t\t\t\tbaseUrl = fullUrl;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn baseUrl; //String\r\n\t},\r\n\r\n\t_checkValues: function(args){\r\n\t\t// summary:\r\n\t\t//\t\tFunction to check the values in args and 'fix' them up as needed.\r\n\t\t// args: Object\r\n\t\t//\t\tContent being set.\r\n\t\t// tags:\r\n\t\t//\t\tprotected\r\n\t\tif(args){\r\n\t\t\tif(args.anchorInput){\r\n\t\t\t\targs.anchorInput = args.anchorInput.replace(/\"/g, \"&quot;\");\r\n\t\t\t}\r\n\t\t\tif(!args.textInput){\r\n\t\t\t\t// WebKit doesn't work with double-click select unless there's\r\n\t\t\t\t// a space in the anchor text, so put a in the case of\r\n\t\t\t\t// empty desc.\r\n\t\t\t\targs.textInput = \"&nbsp;\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn args;\r\n\t},\r\n\r\n\tsetValue: function(args){\r\n\t\t// summary:\r\n\t\t//\t\tCallback from the dialog when user presses \"set\" button.\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tthis._onCloseDialog();\r\n\t\tif(!this.editor.window.getSelection){\r\n\t\t\t// IE check without using user agent string.\r\n\t\t\tvar sel = dijit.range.getSelection(this.editor.window);\r\n\t\t\tvar range = sel.getRangeAt(0);\r\n\t\t\tvar a = range.endContainer;\r\n\t\t\tif(a.nodeType === 3){\r\n\t\t\t\t// Text node, may be the link contents, so check parent.\r\n\t\t\t\t// This plugin doesn't really support nested HTML elements\r\n\t\t\t\t// in the link, it assumes all link content is text.\r\n\t\t\t\ta = a.parentNode;\r\n\t\t\t}\r\n\t\t\tif(a && (a.nodeName && a.nodeName.toLowerCase() !== \"a\")){\r\n\t\t\t\t// Stll nothing, one last thing to try on IE, as it might be 'img'\r\n\t\t\t\t// and thus considered a control.\r\n\t\t\t\ta = this.editor._sCall(\"getSelectedElement\", [\"a\"]);\r\n\t\t\t}\r\n\t\t\tif(a && (a.nodeName && a.nodeName.toLowerCase() === \"a\")){\r\n\t\t\t\t// Okay, we do have a match.  IE, for some reason, sometimes pastes before\r\n\t\t\t\t// instead of removing the targetted paste-over element, so we unlink the\r\n\t\t\t\t// old one first.  If we do not the <a> tag remains, but it has no content,\r\n\t\t\t\t// so isn't readily visible (but is wrong for the action).\r\n\t\t\t\tif(this.editor.queryCommandEnabled(\"unlink\")){\r\n\t\t\t\t\t// Select all the link childent, then unlink.  The following insert will\r\n\t\t\t\t\t// then replace the selected text.\r\n\t\t\t\t\tthis.editor._sCall(\"selectElementChildren\", [a]);\r\n\t\t\t\t\tthis.editor.execCommand(\"unlink\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// make sure values are properly escaped, etc.\r\n\t\targs = this._checkValues(args);\r\n\t\tthis.editor.execCommand('inserthtml',\r\n\t\t\tdojo.string.substitute(this.htmlTemplate, args));\r\n\t},\r\n\r\n\t_onCloseDialog: function(){\r\n\t\t// summary:\r\n\t\t//\t\tHandler for close event on the dialog\r\n\t\tthis.editor.focus();\r\n\t},\r\n\r\n\t_getCurrentValues: function(a){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ride for getting the values to set in the dropdown.\r\n\t\t// a:\r\n\t\t//\t\tThe anchor/link to process for data for the dropdown.\r\n\t\t// tags:\r\n\t\t//\t\tprotected\r\n\t\tvar anchor, text;\r\n\t\tif(a && a.tagName.toLowerCase() === \"a\" && dojo.attr(a, \"name\")){\r\n\t\t\tanchor = dojo.attr(a, \"name\");\r\n\t\t\ttext = a.textContent || a.innerText;\r\n\t\t\tthis.editor._sCall(\"selectElement\", [a, true]);\r\n\t\t}else{\r\n\t\t\ttext = this.editor._sCall(\"getSelectedText\");\r\n\t\t}\r\n\t\treturn {anchorInput: anchor || '', textInput: text || ''}; //Object;\r\n\t},\r\n\r\n\t_onOpenDialog: function(){\r\n\t\t// summary:\r\n\t\t//\t\tHandler for when the dialog is opened.\r\n\t\t//\t\tIf the caret is currently in a URL then populate the URL's info into the dialog.\r\n\t\tvar a;\r\n\t\tif(!this.editor.window.getSelection){\r\n\t\t\t// IE is difficult to select the element in, using the range unified\r\n\t\t\t// API seems to work reasonably well.\r\n\t\t\tvar sel = dijit.range.getSelection(this.editor.window);\r\n\t\t\tvar range = sel.getRangeAt(0);\r\n\t\t\ta = range.endContainer;\r\n\t\t\tif(a.nodeType === 3){\r\n\t\t\t\t// Text node, may be the link contents, so check parent.\r\n\t\t\t\t// This plugin doesn't really support nested HTML elements\r\n\t\t\t\t// in the link, it assumes all link content is text.\r\n\t\t\t\ta = a.parentNode;\r\n\t\t\t}\r\n\t\t\tif(a && (a.nodeName && a.nodeName.toLowerCase() !== \"a\")){\r\n\t\t\t\t// Stll nothing, one last thing to try on IE, as it might be 'img'\r\n\t\t\t\t// and thus considered a control.\r\n\t\t\t\ta = this.editor._sCall(\"getSelectedElement\", [\"a\"]);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\ta = this.editor._sCall(\"getAncestorElement\", [\"a\"]);\r\n\t\t}\r\n\t\tthis.dropDown.reset();\r\n\t\tthis._setButton.set(\"disabled\", true);\r\n\t\tthis.dropDown.set(\"value\", this._getCurrentValues(a));\r\n\t},\r\n\r\n\t_onDblClick: function(e){\r\n\t\t// summary:\r\n\t\t//\t\tFunction to define a behavior on double clicks on the element\r\n\t\t//\t\ttype this dialog edits to select it and pop up the editor\r\n\t\t//\t\tdialog.\r\n\t\t// e: Object\r\n\t\t//\t\tThe double-click event.\r\n\t\t// tags:\r\n\t\t//\t\tprotected.\r\n\t\tif(e && e.target){\r\n\t\t\tvar t = e.target;\r\n\t\t\tvar tg = t.tagName? t.tagName.toLowerCase() : \"\";\r\n\t\t\tif(tg === \"a\" && dojo.attr(t, \"name\")){\r\n\t\t\t\tthis.editor.onDisplayChanged();\r\n\t\t\t\tthis.editor._sCall(\"selectElement\", [t]);\r\n\t\t\t\tsetTimeout(dojo.hitch(this, function(){\r\n\t\t\t\t\t// Focus shift outside the event handler.\r\n\t\t\t\t\t// IE doesn't like focus changes in event handles.\r\n\t\t\t\t\tthis.button.set(\"disabled\", false);\r\n\t\t\t\t\tthis.button.openDropDown();\r\n\t\t\t\t\tif(this.button.dropDown.focus){\r\n\t\t\t\t\t\tthis.button.dropDown.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}), 10);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_preDomFilter: function(node){\r\n\t\t// summary:\r\n\t\t//\t\tA filter to identify the 'a' tags and if they're anchors,\r\n\t\t//\t\tapply the right style to them.\r\n\t\t// node:\r\n\t\t//\t\tThe node to search from.\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\r\n\t\tdojo.query(\"a[name]:not([href])\", this.editor.editNode).addClass(\"dijitEditorPluginInsertAnchorStyle\");\r\n\t},\r\n\r\n\t_postDomFilter: function(node){\r\n\t\t// summary:\r\n\t\t//\t\tA filter to identify the 'a' tags and if they're anchors,\r\n\t\t//\t\tremove the class style that shows up in the editor from\r\n\t\t//\t\tthem.\r\n\t\t// node:\r\n\t\t//\t\tThe node to search from.\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tif(node){\t// avoid error when Editor.get(\"value\") called before editor's iframe initialized\r\n\t\t\tdojo.query(\"a[name]:not([href])\", node).removeClass(\"dijitEditorPluginInsertAnchorStyle\");\r\n\t\t}\r\n\t\treturn node;\r\n\t}\r\n});\r\n\r\n\r\n// Register this plugin.\r\ndojo.subscribe(dijit._scopeName + \".Editor.getPlugin\",null,function(o){\r\n\tif(o.plugin){ return; }\r\n\tvar name = o.args.name;\r\n\tif(name) { name = name.toLowerCase(); }\r\n\tif(name === \"insertanchor\"){\r\n\t\to.plugin = new InsertAnchor();\r\n\t}\r\n});\r\n\r\nreturn InsertAnchor;\r\n\r\n});\r\n"]}