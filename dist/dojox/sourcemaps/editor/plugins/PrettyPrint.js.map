{"version":3,"sources":["editor/plugins/PrettyPrint.js"],"names":["define","dojo","dijit","dojox","_Plugin","PrettyPrint","declare","indentBy","lineLength","useDefaultCommand","entityMap","_initButton","this","command","setToolbar","toolbar","setEditor","editor","inherited","arguments","self","onLoadDeferred","addCallback","_prettyprint_getValue","getValue","val","html","format","prettyPrint","xhtml","_prettyprint_endEditing","_endEditing","_prettyprint_onBlur","_onBlur","ignore_caret","v","_undoedSteps","_steps","push","text","bookmark","_getBookmark","e","_c","savedContent","onChange","subscribe","_scopeName","o","plugin","args","name","toLowerCase","entities","concat"],"mappings":";;;;;;;AAAAA,QACC,OACA,QACA,QACA,wBACA,qBACA,qBACA,qBACE,SAASC,EAAMC,EAAOC,EAAOC,GAEhC,IAAIC,EAAcJ,EAAKK,QAAQ,mCAAoCF,GASlEG,UAAW,EAOXC,YAAa,EAGbC,mBAAmB,EAMnBC,UAAW,KAMXC,YAAa,kBAGLC,KAAKC,SAGbC,WAAY,SAASC,KAMrBC,UAAW,SAASC,GAInBL,KAAKM,UAAUC,WACf,IAAIC,EAAOR,KACXA,KAAKK,OAAOI,eAAeC,YAAY,WACtCF,EAAKH,OAAOM,sBAAwBH,EAAKH,OAAOO,SAChDJ,EAAKH,OAAOO,SAAW,WACtB,IAAIC,EAAML,EAAKH,OAAOM,sBAAsBJ,WAC5C,OAAOhB,EAAMuB,KAAKC,OAAOC,YAAYH,EAAKL,EAAKb,SAAUa,EAAKZ,WAAYY,EAAKV,UAAWU,EAAKS,QAKhGT,EAAKH,OAAOa,wBAA0BV,EAAKH,OAAOc,YAClDX,EAAKH,OAAOe,oBAAsBZ,EAAKH,OAAOgB,QAC9Cb,EAAKH,OAAOc,YAAc,SAASG,GAClC,IAAIC,EAAIf,EAAKH,OAAOM,uBAAsB,GAC1CH,EAAKH,OAAOmB,gBACZhB,EAAKH,OAAOoB,OAAOC,MAAMC,KAAMJ,EAAGK,SAAUpB,EAAKH,OAAOwB,kBAEzDrB,EAAKH,OAAOgB,QAAU,SAASS,GAC9B9B,KAAKM,UAAU,UAAWC,WAC1B,IAAIwB,EAAGvB,EAAKH,OAAOM,uBAAsB,GACtCoB,GAAIvB,EAAKH,OAAO2B,eAClBxB,EAAKH,OAAO4B,SAASF,GACrBvB,EAAKH,OAAO2B,aAAaD,SAyB9B,OAjBA1C,EAAK6C,UAAU5C,EAAM6C,WAAa,oBAAoB,KAAK,SAASC,GAChEA,EAAEC,QAEO,gBADDD,EAAEE,KAAKC,KAAKC,gBAEtBJ,EAAEC,OAAS,IAAI5C,GACdE,SAAW,aAAcyC,EAAEE,KAAMF,EAAEE,KAAK3C,UAAU,EAClDC,WAAa,eAAgBwC,EAAEE,KAAMF,EAAEE,KAAK1C,YAAY,EACxDE,UAAY,cAAesC,EAAEE,KAAMF,EAAEE,KAAKxC,UAAUP,EAAMuB,KAAK2B,SAAS3B,KAAK4B,SAC3E,IAAS,SAAS,IAAS,UAAU,IAAS,SAC9C,IAAS,QAAQ,IAAS,SAAS,IAAS,SAC5C,IAAS,WAAW,IAAS,SAE/BzB,MAAQ,UAAWmB,EAAEE,MAAMF,EAAEE,KAAKrB,WAK9BxB","file":"../../../editor/plugins/PrettyPrint.js","sourcesContent":["define([\r\n\t\"dojo\",\r\n\t\"dijit\",\r\n\t\"dojox\",\r\n\t\"dijit/_editor/_Plugin\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojox/html/format\"\r\n], function(dojo, dijit, dojox, _Plugin) {\r\n\r\nvar PrettyPrint = dojo.declare(\"dojox.editor.plugins.PrettyPrint\", _Plugin,{\r\n\t// summary:\r\n\t//\t\tThis plugin provides a mechanism by which to 'beautify HTML'\r\n\t//\t\tgenerated by the editor.  It is by no means perfect.\r\n\r\n\t// indentBy: [public] Integer\r\n\t//\t\tThe indentBy property configures if the plugin should use a\r\n\t//\t\tset number of spaces for indent (between 1-5), or just tab.\r\n\t//\t\tThe default value is -1, which means tab.\r\n\tindentBy: -1,\r\n\r\n\t// lineLength: [public] Integer\r\n\t//\t\tThe lineLength property configures if the plugin should break up long\r\n\t//\t\ttext lines into N lines of 'lineLength' length.  This parameter does not\r\n\t//\t\ttake into account indention depth, only text line length.  The default is -1\r\n\t//\t\twhich means unlimited line length.\r\n\tlineLength: -1,\r\n\r\n\t// Over-ride indicating that the command processing is done all by this plugin.\r\n\tuseDefaultCommand: false,\r\n\t\r\n\t// map: [public] Array\r\n\t//\t\tAn array of arrays that define out entity character to encoding mappings.\r\n\t//\t\tsee the dojox.html.entities definitions for more details.  The default is\r\n\t//\t\tHTML + cent, pound, yen, ellipsis, copyright, registered trademark.\r\n\tentityMap: null,\r\n\r\n\t// xhtml: [public] boolean\r\n\t//\t\tFlag to denote that the PrettyPrint plugin try to generate XHTML compliant\r\n\t//\t\tmarkup.\r\n\r\n\t_initButton: function(){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ride for creation of the resize button.\r\n\t\tdelete this.command;\r\n\t},\r\n\r\n\tsetToolbar: function(toolbar){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ride to do nothing.\r\n\t\t//\t\tWe don't want to append a button, we take over getValue.\r\n\t},\r\n\r\n\tsetEditor: function(editor){\r\n\t\t// summary:\r\n\t\t//\t\tOver-ride to take over getValue of editor so that\r\n\t\t//\t\twe can 'pretty' the output.\r\n\t\tthis.inherited(arguments);\r\n\t\tvar self = this;\r\n\t\tthis.editor.onLoadDeferred.addCallback(function(){\r\n\t\t\tself.editor._prettyprint_getValue = self.editor.getValue;\r\n\t\t\tself.editor.getValue = function(){\r\n\t\t\t\tvar val = self.editor._prettyprint_getValue(arguments);\r\n\t\t\t\treturn dojox.html.format.prettyPrint(val, self.indentBy, self.lineLength, self.entityMap, self.xhtml);\r\n\t\t\t};\r\n\r\n\t\t\t// The following are implemented as 'performance' functions.  Don't prettyprint\r\n\t\t\t// content on internal state changes, just on calls to actually get values.\r\n\t\t\tself.editor._prettyprint_endEditing = self.editor._endEditing;\r\n\t\t\tself.editor._prettyprint_onBlur = self.editor._onBlur;\r\n\t\t\tself.editor._endEditing = function(ignore_caret){\r\n\t\t\t\tvar v = self.editor._prettyprint_getValue(true);\r\n\t\t\t\tself.editor._undoedSteps=[];//clear undoed steps\r\n\t\t\t\tself.editor._steps.push({text: v, bookmark: self.editor._getBookmark()});\r\n\t\t\t}\r\n\t\t\tself.editor._onBlur = function(e){\r\n\t\t\t\tthis.inherited(\"_onBlur\", arguments);\r\n\t\t\t\tvar _c=self.editor._prettyprint_getValue(true);\r\n\t\t\t\tif(_c!=self.editor.savedContent){\r\n\t\t\t\t\tself.editor.onChange(_c);\r\n\t\t\t\t\tself.editor.savedContent=_c;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n\r\n// Register this plugin.\r\ndojo.subscribe(dijit._scopeName + \".Editor.getPlugin\",null,function(o){\r\n\tif(o.plugin){ return; }\r\n\tvar name = o.args.name.toLowerCase();\r\n\tif(name === \"prettyprint\"){\r\n\t\to.plugin = new PrettyPrint({\r\n\t\t\tindentBy: (\"indentBy\" in o.args)?o.args.indentBy:-1,\r\n\t\t\tlineLength: (\"lineLength\" in o.args)?o.args.lineLength:-1,\r\n\t\t\tentityMap: (\"entityMap\" in o.args)?o.args.entityMap:dojox.html.entities.html.concat([\r\n\t\t\t\t[\"\\u00A2\",\"cent\"],[\"\\u00A3\",\"pound\"],[\"\\u20AC\",\"euro\"],\r\n\t\t\t\t[\"\\u00A5\",\"yen\"],[\"\\u00A9\",\"copy\"],[\"\\u00A7\",\"sect\"],\r\n\t\t\t\t[\"\\u2026\",\"hellip\"],[\"\\u00AE\",\"reg\"]\r\n\t\t\t]),\r\n\t\t\txhtml: (\"xhtml\" in o.args)?o.args.xhtml:false\r\n\t\t});\r\n\t}\r\n});\r\n\r\nreturn PrettyPrint;\r\n\r\n});\r\n"]}