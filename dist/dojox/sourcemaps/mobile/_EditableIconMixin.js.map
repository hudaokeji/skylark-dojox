{"version":3,"sources":["mobile/_EditableIconMixin.js"],"names":["define","array","connect","declare","event","lang","win","domGeometry","domStyle","touch","registry","IconItem","has","viewRegistry","css3","deleteIconForEdit","threshold","destroy","this","_blankItem","inherited","arguments","startEdit","editable","isEditing","_handles","domNode","name","count","forEach","getChildren","w","defer","set","deleteIconNode","_deleteHandle","highlight","publish","onStartEdit","endEdit","unhighlight","disconnect","_movingItem","onEndEdit","scaleItem","widget","ratio","add","transition","transform","_onTransitionStart","e","stop","_onTransitionEnd","getEnclosingWidget","target","_moving","_onTouchStart","style","visibility","_onClick","n","item","iconPressed","parentNode","iconNode","_conn","move","doc","release","_touchStartPosX","touches","pageX","_touchStartPosY","pageY","_onDragStart","_pressTimer","_dragging","movingItem","get","x","y","enclosingScrollable","getEnclosingScrollable","dx","dy","pos","getPos","startPos","_startPos","position","_offsetPos","_startIndex","getIndexOfChild","addChild","moveChild","length","top","left","zIndex","_onTouchMove","_detectOverlap","Math","abs","_clearPressTimer","_onTouchEnd","startIndex","endIndex","removeChild","onMoveItem","remove","point","i","children","blankItem","blankPos","blankIndex","dir","_contains","h","moveChildWithAnimation","_animate","from","to","j","posArray","push","t","offsetTop","l","offsetLeft","hitch","removeChildWithAnimation","index","insertIndex","paneContainerWidget","paneWidget","_deleteIconClicked","deleteIconClicked","deleteItem","onDeleteItem","_setEditableAttr","_set","_touchStartHandle","press"],"mappings":"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","file":"../../mobile/_EditableIconMixin.js","sourcesContent":["define([\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/dom-geometry\",\r\n\t\"dojo/dom-style\",\r\n\t\"dojo/touch\",\r\n\t\"dijit/registry\",\r\n\t\"./IconItem\",\r\n\t\"./sniff\",\r\n\t\"./viewRegistry\",\r\n\t\"./_css3\"\r\n], function(array, connect, declare, event, lang, win, domGeometry, domStyle, touch, registry, IconItem, has, viewRegistry, css3){\r\n\r\n\t// module:\r\n\t//\t\tdojox/mobile/_EditableIconMixin\r\n\r\n\treturn declare(\"dojox.mobile._EditableIconMixin\", null, {\r\n\t\t// summary:\r\n\t\t//\t\tA mixin for IconContainer to make it editable.\r\n\r\n\t\tdeleteIconForEdit: \"mblDomButtonBlackCircleCross\",\r\n\t\tthreshold: 4, // drag threshold value in pixels\r\n\r\n\t\tdestroy: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDestroys the container.\r\n\t\t\tif(this._blankItem){\r\n\t\t\t\tthis._blankItem.destroy();\r\n\t\t\t}\r\n\t\t\tthis.inherited(arguments);\r\n\t\t},\r\n\r\n\t\tstartEdit: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStarts the editing.\r\n\t\t\tif(!this.editable || this.isEditing){ return; }\r\n\r\n\t\t\tthis.isEditing = true;\r\n\t\t\tif(!this._handles){\r\n\t\t\t\tthis._handles = [\r\n\t\t\t\t\tthis.connect(this.domNode, css3.name(\"transitionStart\"), \"_onTransitionStart\"),\r\n\t\t\t\t\tthis.connect(this.domNode, css3.name(\"transitionEnd\"), \"_onTransitionEnd\")\r\n\t\t\t\t];\r\n\t\t\t}\r\n\r\n\t\t\tvar count = 0;\r\n\t\t\tarray.forEach(this.getChildren(), function(w){\r\n\t\t\t\tthis.defer(function(){\r\n\t\t\t\t\tw.set(\"deleteIcon\", this.deleteIconForEdit);\r\n\t\t\t\t\tif(w.deleteIconNode){\r\n\t\t\t\t\t\tw._deleteHandle = this.connect(w.deleteIconNode, \"onclick\", \"_deleteIconClicked\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tw.highlight(0);\r\n\t\t\t\t}, 15*count++);\r\n\t\t\t}, this);\r\n\r\n\t\t\tconnect.publish(\"/dojox/mobile/startEdit\", [this]); // pubsub\r\n\t\t\tthis.onStartEdit(); // callback\r\n\t\t},\r\n\r\n\t\tendEdit: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEnds the editing.\r\n\t\t\tif(!this.isEditing){ return; }\r\n\r\n\t\t\tarray.forEach(this.getChildren(), function(w){\r\n\t\t\t\tw.unhighlight();\r\n\t\t\t\tif(w._deleteHandle){\r\n\t\t\t\t\tthis.disconnect(w._deleteHandle);\r\n\t\t\t\t\tw._deleteHandle = null;\r\n\t\t\t\t}\r\n\t\t\t\tw.set(\"deleteIcon\", \"\");\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis._movingItem = null;\r\n\t\t\tif(this._handles){\r\n\t\t\t\tarray.forEach(this._handles, this.disconnect, this);\r\n\t\t\t\tthis._handles = null;\r\n\t\t\t}\r\n\r\n\t\t\tconnect.publish(\"/dojox/mobile/endEdit\", [this]); // pubsub\r\n\t\t\tthis.onEndEdit(); // callback\r\n\t\t\tthis.isEditing = false;\r\n\t\t},\r\n\r\n\t\tscaleItem: function(/*Widget*/widget, /*Number*/ratio){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tScales an item according to the specified ratio.\r\n\t\t\tdomStyle.set(widget.domNode, css3.add({}, {\r\n\t\t\t\ttransition: has(\"android\") ? \"\" : css3.name(\"transform\", true) + \" .1s ease-in-out\",\r\n\t\t\t\ttransform: ratio == 1 ? \"\" : \"scale(\" + ratio + \")\"\r\n\t\t\t}));\t\t\t\r\n\t\t},\r\n\r\n\t\t_onTransitionStart: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tevent.stop(e);\r\n\t\t},\r\n\r\n\t\t_onTransitionEnd: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tevent.stop(e);\r\n\t\t\tvar w = registry.getEnclosingWidget(e.target);\r\n\t\t\tw._moving = false;\r\n\t\t\tdomStyle.set(w.domNode, css3.name(\"transition\"), \"\");\r\n\t\t},\r\n\r\n\t\t_onTouchStart: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(!this._blankItem){\r\n\t\t\t\tthis._blankItem = new IconItem();\r\n\t\t\t\tthis._blankItem.domNode.style.visibility = \"hidden\";\r\n\t\t\t\tthis._blankItem._onClick = function(){};\r\n\t\t\t}\r\n\t\t\tvar item = this._movingItem = registry.getEnclosingWidget(e.target);\r\n\t\t\tvar iconPressed = false;\r\n\t\t\tvar n;\r\n\t\t\tfor(n = e.target; n !== item.domNode; n = n.parentNode){\r\n\t\t\t\tif(n === item.iconNode){\r\n\t\t\t\t\ticonPressed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!iconPressed){ return; }\r\n\r\n\t\t\tif(!this._conn){\r\n\t\t\t\tthis._conn = [\r\n\t\t\t\t\tthis.connect(this.domNode, touch.move, \"_onTouchMove\"),\r\n\t\t\t\t\tthis.connect(win.doc, touch.release, \"_onTouchEnd\")\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\tthis._touchStartPosX = e.touches ? e.touches[0].pageX : e.pageX;\r\n\t\t\tthis._touchStartPosY = e.touches ? e.touches[0].pageY : e.pageY;\r\n\t\t\tif(this.isEditing){\r\n\t\t\t\tthis._onDragStart(e);\r\n\t\t\t}else{\r\n\t\t\t\t// set timer to detect long press\r\n\t\t\t\tthis._pressTimer = this.defer(function(){\r\n\t\t\t\t\tthis.startEdit();\r\n\t\t\t\t\tthis._onDragStart(e);\r\n\t\t\t\t}, 1000);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onDragStart: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tthis._dragging = true;\r\n\r\n\t\t\tvar movingItem = this._movingItem;\r\n\t\t\tif(movingItem.get(\"selected\")){\r\n\t\t\t\tmovingItem.set(\"selected\", false);\r\n\t\t\t}\r\n\t\t\tthis.scaleItem(movingItem, 1.1);\r\n\r\n\t\t\tvar x = e.touches ? e.touches[0].pageX : e.pageX;\r\n\t\t\tvar y = e.touches ? e.touches[0].pageY : e.pageY;\r\n\t\t\t\r\n\t\t\tvar enclosingScrollable = viewRegistry.getEnclosingScrollable(movingItem.domNode);\r\n\t\t\tvar dx = 0;\r\n\t\t\tvar dy = 0;\r\n\t\t\tif(enclosingScrollable){ // this node is placed inside a scrollable\r\n\t\t\t\tvar pos = enclosingScrollable.getPos();\r\n\t\t\t\tdx = pos.x;\r\n\t\t\t\tdy = pos.y;\r\n\t\t\t\tevent.stop(e);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar startPos = this._startPos = domGeometry.position(movingItem.domNode, true);\r\n\t\t\tthis._offsetPos = {\r\n\t\t\t\tx: startPos.x - x - dx,\r\n\t\t\t\ty: startPos.y - y - dy\r\n\t\t\t};\r\n\r\n\t\t\tthis._startIndex = this.getIndexOfChild(movingItem);\r\n\t\t\tthis.addChild(this._blankItem, this._startIndex);\r\n\t\t\tthis.moveChild(movingItem, this.getChildren().length);\r\n\t\t\tdomStyle.set(movingItem.domNode, {\r\n\t\t\t\tposition: \"absolute\",\r\n\t\t\t\ttop: (startPos.y - dy) + \"px\",\r\n\t\t\t\tleft: (startPos.x - dx) + \"px\",\r\n\t\t\t\tzIndex: 100\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_onTouchMove: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar x = e.touches ? e.touches[0].pageX : e.pageX;\r\n\t\t\tvar y = e.touches ? e.touches[0].pageY : e.pageY;\r\n\t\t\tif(this._dragging){\r\n\t\t\t\tdomStyle.set(this._movingItem.domNode, {\r\n\t\t\t\t\ttop: (this._offsetPos.y + y) + \"px\",\r\n\t\t\t\t\tleft: (this._offsetPos.x + x) + \"px\"\r\n\t\t\t\t});\r\n\t\t\t\tthis._detectOverlap({x: x, y: y});\r\n\t\t\t\tevent.stop(e);\r\n\t\t\t}else{\r\n\t\t\t\tvar dx = Math.abs(this._touchStartPosX - x);\r\n\t\t\t\tvar dy = Math.abs(this._touchStartPosY - y);\r\n\t\t\t\tif (dx > this.threshold || dy > this.threshold) {\r\n\t\t\t\t\tthis._clearPressTimer();\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onTouchEnd: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tthis._clearPressTimer();\r\n\t\t\tif(this._conn){\r\n\t\t\t\tarray.forEach(this._conn, this.disconnect, this);\r\n\t\t\t\tthis._conn = null;\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tif(this._dragging){\r\n\t\t\t\tthis._dragging = false;\r\n\r\n\t\t\t\tvar movingItem = this._movingItem;\r\n\t\t\t\tthis.scaleItem(movingItem, 1.0);\r\n\t\t\t\tdomStyle.set(movingItem.domNode, {\r\n\t\t\t\t\tposition: \"\",\r\n\t\t\t\t\ttop: \"\",\r\n\t\t\t\t\tleft: \"\",\r\n\t\t\t\t\tzIndex: \"\"\r\n\t\t\t\t});\r\n\t\t\t\tvar startIndex = this._startIndex;\r\n\t\t\t\tvar endIndex = this.getIndexOfChild(this._blankItem);\r\n\t\t\t\tthis.moveChild(movingItem, endIndex);\r\n\t\t\t\tthis.removeChild(this._blankItem);\r\n\t\t\t\tconnect.publish(\"/dojox/mobile/moveIconItem\", [this, movingItem, startIndex, endIndex]); // pubsub\r\n\t\t\t\tthis.onMoveItem(movingItem, startIndex, endIndex); // callback\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_clearPressTimer: function(){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(this._pressTimer){\r\n\t\t\t\tthis._pressTimer.remove();\r\n\t\t\t\tthis._pressTimer = null;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_detectOverlap: function(/*Object*/point){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar children = this.getChildren(),\r\n\t\t\t\tblankItem = this._blankItem,\r\n\t\t\t\tblankPos = domGeometry.position(blankItem.domNode, true),\r\n\t\t\t\tblankIndex = this.getIndexOfChild(blankItem),\r\n\t\t\t\tdir = 1,\r\n\t\t\t\ti, w, pos;\r\n\t\t\tif(this._contains(point, blankPos)){\r\n\t\t\t\treturn;\r\n\t\t\t}else if(point.y < blankPos.y || (point.y <= blankPos.y + blankPos.h && point.x < blankPos.x)){\r\n\t\t\t\tdir = -1;\r\n\t\t\t}\r\n\t\t\tfor(i = blankIndex + dir; i>=0 && i<children.length-1; i += dir){\r\n\t\t\t\tw = children[i];\r\n\t\t\t\tif(w._moving){ continue; }\r\n\t\t\t\tpos = domGeometry.position(w.domNode, true);\r\n\t\t\t\tif(this._contains(point, pos)){\r\n\t\t\t\t\tthis.defer(function(){\r\n\t\t\t\t\t\tthis.moveChildWithAnimation(blankItem, dir == 1 ? i+1 : i);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}else if((dir == 1 && pos.y > point.y) || (dir == -1 && pos.y + pos.h < point.y)){\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_contains: function(point, pos){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\treturn pos.x < point.x && point.x < pos.x + pos.w && pos.y < point.y && point.y < pos.y + pos.h;\r\n\t\t},\r\n\r\n\t\t_animate: function(/*int*/from, /*int*/to){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(from == to) { return; }\r\n\t\t\tvar dir = from < to ? 1 : -1;\r\n\t\t\tvar children = this.getChildren();\r\n\t\t\tvar posArray = [];\r\n\t\t\tvar i, j;\r\n\t\t\tfor(i=from; i!=to; i+=dir){\r\n\t\t\t\tposArray.push({\r\n\t\t\t\t\tt: (children[i+dir].domNode.offsetTop - children[i].domNode.offsetTop) + \"px\",\r\n\t\t\t\t\tl: (children[i+dir].domNode.offsetLeft - children[i].domNode.offsetLeft) + \"px\"\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tfor(i=from, j=0; i!=to; i+=dir, j++){\r\n\t\t\t\tvar w = children[i];\r\n\t\t\t\tw._moving = true;\r\n\t\t\t\tdomStyle.set(w.domNode, {\r\n\t\t\t\t\ttop: posArray[j].t,\r\n\t\t\t\t\tleft: posArray[j].l\r\n\t\t\t\t});\r\n\t\t\t\tthis.defer(lang.hitch(w, function(){\r\n\t\t\t\t\tdomStyle.set(this.domNode, css3.add({\r\n\t\t\t\t\t\ttop: \"0px\",\r\n\t\t\t\t\t\tleft: \"0px\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\ttransition: \"top .3s ease-in-out, left .3s ease-in-out\"\r\n\t\t\t\t\t}));\r\n\t\t\t\t}), j*10);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tremoveChildWithAnimation: function(/*Widget|Number*/widget){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRemoves the given child with animation.\r\n\t\t\tvar index = (typeof widget === \"number\") ? widget : this.getIndexOfChild(widget);\r\n\t\t\tthis.removeChild(widget);\r\n\r\n\t\t\t// Show remove animation\r\n\t\t\tif(this._blankItem){\r\n\t\t\t\t// #16868 - no _blankItem if calling deleteItem() programmatically, that is\r\n\t\t\t\t// without _onTouchStart() being called.\r\n\t\t\t\tthis.addChild(this._blankItem);\r\n\t\t\t}\r\n\t\t\tthis._animate(index, this.getChildren().length - 1);\r\n\t\t\tif(this._blankItem){\r\n\t\t\t\tthis.removeChild(this._blankItem);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tmoveChild: function(/*Widget|Number*/widget, /*Number?*/insertIndex){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tMoves a child without animation.\r\n\t\t\tthis.addChild(widget, insertIndex);\r\n\t\t\tthis.paneContainerWidget.addChild(widget.paneWidget, insertIndex);\r\n\t\t},\r\n\r\n\t\tmoveChildWithAnimation: function(/*Widget|Number*/widget, /*Number?*/insertIndex){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tMoves a child with animation.\t\r\n\t\t\tvar index = this.getIndexOfChild(this._blankItem);\r\n\t\t\tthis.moveChild(widget, insertIndex);\r\n\r\n\t\t\t// Show move animation\r\n\t\t\tthis._animate(index, insertIndex);\r\n\t\t},\r\n\r\n\t\t_deleteIconClicked: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal handler for click events.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(this.deleteIconClicked(e) === false){ return; } // user's click action\r\n\t\t\tvar item = registry.getEnclosingWidget(e.target);\r\n\t\t\tthis.deleteItem(item);\r\n\t\t},\r\n\r\n\t\tdeleteIconClicked: function(/*Event*/ /*===== e =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tUser-defined function to handle clicks for the delete icon.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\t\t},\r\n\r\n\t\tdeleteItem: function(/*Widget*/item){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDeletes the given item.\r\n\t\t\tif(item._deleteHandle){\r\n\t\t\t\tthis.disconnect(item._deleteHandle);\r\n\t\t\t}\r\n\t\t\tthis.removeChildWithAnimation(item);\r\n\r\n\t\t\tconnect.publish(\"/dojox/mobile/deleteIconItem\", [this, item]); // pubsub\r\n\t\t\tthis.onDeleteItem(item); // callback\r\n\r\n\t\t\titem.destroy();\r\n\t\t},\r\n\r\n\t\tonDeleteItem: function(/*Widget*/item){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t},\r\n\r\n\t\tonMoveItem: function(/*Widget*/item, /*int*/from, /*int*/to){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t},\r\n\r\n\t\tonStartEdit: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t},\r\n\r\n\t\tonEndEdit: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t},\r\n\r\n\t\t_setEditableAttr: function(/*Boolean*/editable){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tthis._set(\"editable\", editable);\r\n\t\t\tif(editable && !this._touchStartHandle){ // Allow users to start editing by long press on IconItems\r\n\t\t\t\tthis._touchStartHandle = this.connect(this.domNode, touch.press, \"_onTouchStart\");\r\n\t\t\t}else if(!editable && this._touchStartHandle){\r\n\t\t\t\tthis.disconnect(this._touchStartHandle);\r\n\t\t\t\tthis._touchStartHandle = null;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n});\r\n"]}