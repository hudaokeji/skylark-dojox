{"version":3,"sources":["mobile/Overlay.js"],"names":["define","declare","lang","has","win","domClass","domGeometry","domStyle","windowUtils","WidgetBase","array","registry","touch","viewRegistry","css3","baseClass","buildRendering","this","inherited","arguments","containerNode","domNode","_reposition","popupPos","position","vp","getBox","scrollableParent","getEnclosingScrollable","t","getPos","y","h","get","set","top","bottom","show","aroundNode","forEach","findWidgets","w","height","resize","aroundPos","global","scrollBy","_domNode","replace","defer","handler","connect","name","disconnect","remove","add","skipReposition","_moveHandle","doc","documentElement","move","_repositionTimer","setInterval","hitch","hide","clearInterval","onBlur","e"],"mappings":";;;;;;;AAAAA,QACC,qBACA,kBACA,aACA,oBACA,iBACA,oBACA,iBACA,cACA,oBACA,mBACA,iBACA,aACA,iBACA,WACE,SAASC,EAASC,EAAMC,EAAKC,EAAKC,EAAUC,EAAaC,EAAUC,EAAaC,EAAYC,EAAOC,EAAUC,EAAOC,EAAcC,GAEpI,OAAOb,EAAQ,uBAAwBQ,GAOtCM,UAAW,8BAEXC,eAAgB,WACfC,KAAKC,UAAUC,WACXF,KAAKG,gBAERH,KAAKG,cAAgBH,KAAKI,UAI5BC,YAAa,WAKZ,IAAIC,EAAWjB,EAAYkB,SAASP,KAAKI,SACrCI,EAAKjB,EAAYkB,SAEjBC,EAAmBd,EAAae,uBAAuBX,KAAKI,SAWhE,OATIM,IACFF,EAAGI,GAAKF,EAAiBG,SAASC,IAG/BR,EAASQ,EAAER,EAASS,GAAMP,EAAGO,GACa,YAA1CzB,EAAS0B,IAAIhB,KAAKI,QAAS,aAA6BlB,EAAI,WAAa,KAC7EoB,EAASQ,EAAIN,EAAGI,EAAIJ,EAAGO,EAAIT,EAASS,EACpCzB,EAAS2B,IAAIjB,KAAKI,SAAWG,SAAU,WAAYW,IAAKZ,EAASQ,EAAI,KAAMK,OAAQ,UAE7Eb,GAGRc,KAAM,SAAqBC,GAG1B5B,EAAM6B,QAAQ5B,EAAS6B,YAAYvB,KAAKI,SAAU,SAASoB,GACvDA,GAAiB,QAAZA,EAAEC,QAAuC,mBAAZD,EAAEE,QACtCF,EAAEE,WAGJ,IAAIpB,EAAWN,KAAKK,cACpB,GAAGgB,EAAW,CACb,IAAIM,EAAYtC,EAAYkB,SAASc,GAClCf,EAASQ,EAAIa,EAAUb,IAEzB3B,EAAIyC,OAAOC,SAAS,EAAGF,EAAUb,EAAIa,EAAUZ,EAAIT,EAASQ,GAC5Dd,KAAKK,eAGP,IAAIyB,EAAW9B,KAAKI,QACpBhB,EAAS2C,QAAQD,GAAW,YAAa,UAAW,mBAAoB,aAAc,SAAU,aAAc,kBAC9G9B,KAAKgC,MAAM,WACV,IAAIC,EAAUjC,KAAKkC,QAAQJ,EAAUjC,EAAKsC,KAAK,iBAAkB,WAChEnC,KAAKoC,WAAWH,GAChB7C,EAASiD,OAAOP,GAAW,YAAa,QAAS,kBACjD9B,KAAKK,gBAENjB,EAASkD,IAAIR,EAAU,kBACrB,KACH,IAAIS,GAAiB,EAcrB,OAZAvC,KAAKwC,YAAcxC,KAAKkC,QAAQ/C,EAAIsD,IAAIC,gBAAiB/C,EAAMgD,KAC9D,WACCJ,GAAiB,IAGnBvC,KAAK4C,iBAAmBC,YAAY5D,EAAK6D,MAAM9C,KAAM,WACjDuC,EACFA,GAAiB,EAGlBvC,KAAKK,gBACF,IACGC,GAGRyC,KAAM,WAGL,IAAIjB,EAAW9B,KAAKI,QACjBJ,KAAKwC,cACPxC,KAAKoC,WAAWpC,KAAKwC,aACrBxC,KAAKwC,YAAc,KACnBQ,cAAchD,KAAK4C,kBACnB5C,KAAK4C,iBAAmB,MAEtB1D,EAAI,oBACNE,EAAS2C,QAAQD,GAAW,aAAc,SAAU,eAAgB,YAAa,QAAS,mBAAoB,kBAC9G9B,KAAKgC,MAAM,WACV,IAAIC,EAAUjC,KAAKkC,QAAQJ,EAAUjC,EAAKsC,KAAK,iBAAkB,WAChEnC,KAAKoC,WAAWH,GAChB7C,EAAS2C,QAAQD,GAAW,qBAAsB,aAAc,SAAU,aAAc,oBAEzF1C,EAASkD,IAAIR,EAAU,kBACrB,MAEH1C,EAAS2C,QAAQD,GAAW,qBAAsB,YAAa,QAAS,aAAc,SAAU,gBAIlGmB,OAAQ,SAAkBC,GACzB,OAAO","file":"../../mobile/Overlay.js","sourcesContent":["define([\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/sniff\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/dom-class\",\r\n\t\"dojo/dom-geometry\",\r\n\t\"dojo/dom-style\",\r\n\t\"dojo/window\",\r\n\t\"dijit/_WidgetBase\",\r\n\t\"dojo/_base/array\",\r\n\t\"dijit/registry\",\r\n\t\"dojo/touch\",\r\n\t\"./viewRegistry\",\r\n\t\"./_css3\"\r\n], function(declare, lang, has, win, domClass, domGeometry, domStyle, windowUtils, WidgetBase, array, registry, touch, viewRegistry, css3){\r\n\r\n\treturn declare(\"dojox.mobile.Overlay\", WidgetBase, {\r\n\t\t// summary:\r\n\t\t//\t\tA non-templated widget that animates up from the bottom, \r\n\t\t//\t\toverlaying the current content.\r\n\r\n\t\t// baseClass: String\r\n\t\t//\t\tThe name of the CSS class of this widget.\r\n\t\tbaseClass: \"mblOverlay mblOverlayHidden\",\r\n\r\n\t\tbuildRendering: function(){\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\tif(!this.containerNode){\r\n\t\t\t\t// set containerNode so that getChildren() works\r\n\t\t\t\tthis.containerNode = this.domNode;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_reposition: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tPosition the overlay at the bottom\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar popupPos = domGeometry.position(this.domNode);\r\n\t\t\tvar vp = windowUtils.getBox();\r\n\t\t\t// search for the scrollable parent if any \r\n\t\t\tvar scrollableParent = viewRegistry.getEnclosingScrollable(this.domNode);\r\n\t\t\t// update vp scroll position if the overlay is inside a scrollable\r\n\t\t \tif(scrollableParent){\r\n\t\t \t\tvp.t -= scrollableParent.getPos().y;\r\n\t\t \t}\r\n\t\t \t// reposition if needed \r\n\t\t \tif((popupPos.y+popupPos.h) != vp.h // TODO: should be a has() test for position:fixed not scrolling\r\n\t\t\t\t|| (domStyle.get(this.domNode, 'position') != 'absolute' && has('android') < 3)){ // android 2.x supports position:fixed but child transforms don't persist\r\n\t\t\t\tpopupPos.y = vp.t + vp.h - popupPos.h;\r\n\t\t\t\tdomStyle.set(this.domNode, { position: \"absolute\", top: popupPos.y + \"px\", bottom: \"auto\" });\r\n\t\t\t}\r\n\t\t\treturn popupPos;\r\n\t\t},\r\n\r\n\t\tshow: function(/*DomNode?*/aroundNode){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tScroll the overlay up into view\r\n\t\t\tarray.forEach(registry.findWidgets(this.domNode), function(w){\r\n\t\t\t\tif(w && w.height == \"auto\" && typeof w.resize == \"function\"){\r\n\t\t\t\t\tw.resize();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tvar popupPos = this._reposition();\r\n\t\t\tif(aroundNode){\r\n\t\t\t\tvar aroundPos = domGeometry.position(aroundNode);\r\n\t\t\t\tif(popupPos.y < aroundPos.y){ // if the aroundNode is under the popup, try to scroll it up\r\n\t\t\t\t\t// TODO: if this widget has a scrollable parent, use its scrollTo method to make sure the aroundNode is visible?\r\n\t\t\t\t\twin.global.scrollBy(0, aroundPos.y + aroundPos.h - popupPos.y);\r\n\t\t\t\t\tthis._reposition();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar _domNode = this.domNode;\r\n\t\t\tdomClass.replace(_domNode, [\"mblCoverv\", \"mblIn\"], [\"mblOverlayHidden\", \"mblRevealv\", \"mblOut\", \"mblReverse\", \"mblTransition\"]);\r\n\t\t\tthis.defer(function(){\r\n\t\t\t\tvar handler = this.connect(_domNode, css3.name(\"transitionEnd\"), function(){\r\n\t\t\t\t\tthis.disconnect(handler);\r\n\t\t\t\t\tdomClass.remove(_domNode, [\"mblCoverv\", \"mblIn\", \"mblTransition\"]);\r\n\t\t\t\t\tthis._reposition();\r\n\t\t\t\t});\r\n\t\t\t\tdomClass.add(_domNode, \"mblTransition\");\r\n\t\t\t}, 100);\r\n\t\t\tvar skipReposition = false;\r\n\r\n\t\t\tthis._moveHandle = this.connect(win.doc.documentElement, touch.move,\r\n\t\t\t\tfunction(){\r\n\t\t\t\t\tskipReposition = true;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t\tthis._repositionTimer = setInterval(lang.hitch(this, function(){\r\n\t\t\t\tif(skipReposition){ // don't reposition if busy\r\n\t\t\t\t\tskipReposition = false;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis._reposition();\r\n\t\t\t}), 50); // yield a short time to allow for consolidation for better CPU throughput\r\n\t\t\treturn popupPos;\r\n\t\t},\r\n\r\n\t\thide: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tScroll the overlay down and then make it invisible\r\n\t\t\tvar _domNode = this.domNode;\r\n\t\t\tif(this._moveHandle){\r\n\t\t\t\tthis.disconnect(this._moveHandle);\r\n\t\t\t\tthis._moveHandle = null;\r\n\t\t\t\tclearInterval(this._repositionTimer);\r\n\t\t\t\tthis._repositionTimer = null;\r\n\t\t\t}\r\n\t\t\tif(has(\"css3-animations\")){\r\n\t\t\t\tdomClass.replace(_domNode, [\"mblRevealv\", \"mblOut\", \"mblReverse\"], [\"mblCoverv\", \"mblIn\", \"mblOverlayHidden\", \"mblTransition\"]);\r\n\t\t\t\tthis.defer(function(){\r\n\t\t\t\t\tvar handler = this.connect(_domNode, css3.name(\"transitionEnd\"), function(){\r\n\t\t\t\t\t\tthis.disconnect(handler);\r\n\t\t\t\t\t\tdomClass.replace(_domNode, [\"mblOverlayHidden\"], [\"mblRevealv\", \"mblOut\", \"mblReverse\", \"mblTransition\"]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tdomClass.add(_domNode, \"mblTransition\");\r\n\t\t\t\t}, 100);\r\n\t\t\t}else{\r\n\t\t\t\tdomClass.replace(_domNode, [\"mblOverlayHidden\"], [\"mblCoverv\", \"mblIn\", \"mblRevealv\", \"mblOut\", \"mblReverse\"]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonBlur: function(/*Event*/e){\r\n\t\t\treturn false; // touching outside the overlay area does not call hide()\r\n\t\t}\r\n\t});\r\n});\r\n"]}