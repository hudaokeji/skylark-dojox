{"version":3,"sources":["mobile/SearchBox.js"],"names":["define","declare","lang","win","SearchMixin","TextBox","domClass","keys","touch","on","has","baseClass","type","placeHolder","incremental","_setIncrementalAttr","val","this","_onInput","e","charOrCode","ENTER","inherited","arguments","postCreate","textbox","removeAttribute","hasAttribute","setAttribute","add","domNode","connect","value","defer","touchStartX","touchStartY","handleRelease","_this","press","evt","touches","pageX","pageY","doc","release","dx","dy","get","Math","abs","preventDefault","set","remove","getBoundingClientRect","right"],"mappings":";;;;;;;AAAAA,QACC,qBACA,kBACA,oBACA,0BACA,uBACA,iBACA,YACA,aACA,UACA,WACE,SAASC,EAASC,EAAMC,EAAKC,EAAaC,EAASC,EAAUC,EAAMC,EAAOC,EAAIC,GAEhF,OAAOT,EAAQ,0BAA2BI,EAASD,IAMlDO,UAAW,0BAKXC,KAAM,SAENC,YAAa,GAKbC,aAAa,EAEbC,oBAAqB,SAASC,GAK7BC,KAAKH,YAAcE,GAGpBE,SAAU,SAASC,GAGfA,EAAEC,YAAcb,EAAKc,MACvBF,EAAEC,WAAa,IACNH,KAAKH,cACdK,EAAEC,WAAa,GAEhBH,KAAKK,UAAUC,YAGhBC,WAAY,WACXP,KAAKK,UAAUC,WACfN,KAAKQ,QAAQC,gBAAgB,eACzBT,KAAKQ,QAAQE,aAAa,YAC7BV,KAAKQ,QAAQG,aAAa,UAAW,KAEnClB,EAAI,OAAS,IACfJ,EAASuB,IAAIZ,KAAKa,QAAS,WAC3Bb,KAAKc,QAAQd,KAAKQ,QAAS,UAC1B,WAC2B,KAAvBR,KAAKQ,QAAQO,OACff,KAAKgB,MACJ,WAC2B,KAAvBhB,KAAKQ,QAAQO,OACff,KAAKC,UAAWE,WAAYb,EAAKc,aAQxCJ,KAAKc,QAAQd,KAAKQ,QAAS,WAC1B,WACCR,KAAKC,UAAWE,WAAYb,EAAKc,UAKnC,IACIa,EAAaC,EACbC,EAFAC,EAAQpB,KAGTP,EAAI,QACNO,KAAKR,GAAGD,EAAM8B,MAAO,SAASC,GAE7BL,EAAcK,EAAIC,QAAUD,EAAIC,QAAQ,GAAGC,MAAQF,EAAIE,MACvDN,EAAcI,EAAIC,QAAUD,EAAIC,QAAQ,GAAGE,MAAQH,EAAIG,MAEvDN,EAAgB3B,EAAGN,EAAIwC,IAAKnC,EAAMoC,QACjC,SAASL,GACR,IAAUM,EAAIC,EACW,IAAtBT,EAAMU,IAAI,WACZF,EAAKN,EAAIE,MAAQP,EACjBY,EAAKP,EAAIG,MAAQP,EAGda,KAAKC,IAAIJ,IAAO,GAAKG,KAAKC,IAAIH,IAAO,IACvCP,EAAIW,iBACJb,EAAMc,IAAI,QAAS,IACnBd,EAAMnB,UAAWE,WAAYb,EAAKc,UAGjCe,IACFA,EAAcgB,SACdhB,EAAgB,QAIZC,EAAMP,QAAQuB,wBAEbC,OAASf,EAAIC,QAAUD,EAAIC,QAAQ,GAAGC,MAAQF,EAAIE,QAAU,IAEhEL,IACFA,EAAcgB,SACdhB,EAAgB","file":"../../mobile/SearchBox.js","sourcesContent":["define([\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/window\",\r\n\t\"dijit/form/_SearchMixin\",\r\n\t\"dojox/mobile/TextBox\",\r\n\t\"dojo/dom-class\",\r\n\t\"dojo/keys\",\r\n\t\"dojo/touch\",\r\n\t\"dojo/on\",\r\n\t\"./sniff\"\r\n], function(declare, lang, win, SearchMixin, TextBox, domClass, keys, touch, on, has){\r\n\r\n\treturn declare(\"dojox.mobile.SearchBox\", [TextBox, SearchMixin], {\r\n\t\t// summary:\r\n\t\t//\t\tA non-templated base class for INPUT type=\"search\".\r\n\r\n\t\t// baseClass: String\r\n\t\t//\t\tThe name of the CSS class of this widget.\r\n\t\tbaseClass: \"mblTextBox mblSearchBox\",\r\n\r\n\t\t// type: String\r\n\t\t//\t\tCorresponds to the type attribute of the HTML `<input>` element.\r\n\t\t//\t\tThe value is \"search\".\r\n\t\ttype: \"search\",\r\n\r\n\t\tplaceHolder: \"\",\r\n\r\n\t\t// incremental: Boolean\r\n\t\t//\t\tSet true to search on every key or false to only search after \r\n\t\t//\t\tpressing ENTER or cancel.\r\n\t\tincremental: true,\r\n\r\n\t\t_setIncrementalAttr: function(val){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCustom setter so the INPUT doesn't get the incremental attribute set.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tthis.incremental = val;\r\n\t\t},\r\n\r\n\t\t_onInput: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(e.charOrCode == keys.ENTER){\r\n\t\t\t\te.charOrCode = 229;\r\n\t\t\t}else if(!this.incremental){\r\n\t\t\t\te.charOrCode = 0; // call _onInput to make sure a pending query is aborted\r\n\t\t\t}\r\n\t\t\tthis.inherited(arguments);\r\n\t\t},\r\n\r\n\t\tpostCreate: function(){\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\tthis.textbox.removeAttribute('incremental'); // only want onsearch to fire for ENTER and cancel\r\n\t\t\tif(!this.textbox.hasAttribute('results')){\r\n\t\t\t\tthis.textbox.setAttribute('results', '0'); // enables webkit search decoration\r\n\t\t\t}\r\n\t\t\tif(has(\"ios\") < 5){\r\n\t\t\t\tdomClass.add(this.domNode, 'iphone4'); // cannot click cancel button after focus so just remove it\r\n\t\t\t\tthis.connect(this.textbox, \"onfocus\", // if value changes between start of onfocus to end, then it was a cancel\r\n\t\t\t\t\tfunction(){\r\n\t\t\t\t\t\tif(this.textbox.value !== ''){\r\n\t\t\t\t\t\t\tthis.defer(\r\n\t\t\t\t\t\t\t\tfunction(){\r\n\t\t\t\t\t\t\t\t\tif(this.textbox.value === ''){\r\n\t\t\t\t\t\t\t\t\t\tthis._onInput({ charOrCode: keys.ENTER }); // emulate onsearch\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tthis.connect(this.textbox, \"onsearch\",\r\n\t\t\t\tfunction(){\r\n\t\t\t\t\tthis._onInput({ charOrCode: keys.ENTER });\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t\t\r\n\t\t\t// Clear action for the close button (iOS specific)\r\n\t\t\tvar _this = this;\r\n\t\t\tvar touchStartX, touchStartY;\r\n\t\t\tvar handleRelease;\r\n\t\t\tif(has(\"ios\")){\r\n\t\t\t\tthis.on(touch.press, function(evt){\r\n\t\t\t\t\tvar rect;\r\n\t\t\t\t\ttouchStartX = evt.touches ? evt.touches[0].pageX : evt.pageX;\r\n\t\t\t\t\ttouchStartY = evt.touches ? evt.touches[0].pageY : evt.pageY;\r\n\t\t\t\t\t// As the native searchbox on iOS, clear on release, not on start.\r\n\t\t\t\t\thandleRelease = on(win.doc, touch.release,\r\n\t\t\t\t\t\tfunction(evt){\r\n\t\t\t\t\t\t\tvar rect, dx, dy;\r\n\t\t\t\t\t\t\tif(_this.get(\"value\") != \"\"){\r\n\t\t\t\t\t\t\t\tdx = evt.pageX - touchStartX;\r\n\t\t\t\t\t\t\t\tdy = evt.pageY - touchStartY;\r\n\t\t\t\t\t\t\t\t// Mimic the behavior of native iOS searchbox: \r\n\t\t\t\t\t\t\t\t// if location of release event close to the location of start event:\r\n\t\t\t\t\t\t\t\tif(Math.abs(dx) <= 4 && Math.abs(dy) <= 4){\r\n\t\t\t\t\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t\t\t\t\t\t_this.set(\"value\", \"\");\r\n\t\t\t\t\t\t\t\t\t_this._onInput({ charOrCode: keys.ENTER });\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(handleRelease){ // possibly already cancelled/cleared on touch.press\r\n\t\t\t\t\t\t\t\thandleRelease.remove();\r\n\t\t\t\t\t\t\t\thandleRelease = null;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t\trect = _this.domNode.getBoundingClientRect();\r\n\t\t\t\t\t// if touched in the right-most 20 pixels of the search box \r\n\t\t\t\t\tif(rect.right - (evt.touches ? evt.touches[0].pageX : evt.pageX) >= 20){\r\n\t\t\t\t\t\t// cancel\r\n\t\t\t\t\t\tif(handleRelease){\r\n\t\t\t\t\t\t\thandleRelease.remove();\r\n\t\t\t\t\t\t\thandleRelease = null;\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n});\r\n"]}