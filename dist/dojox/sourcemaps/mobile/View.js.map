{"version":3,"sources":["mobile/View.js"],"names":["define","array","config","connect","declare","lang","has","win","Deferred","dom","domClass","domConstruct","domGeometry","domStyle","registry","Contained","Container","WidgetBase","ViewController","common","transitDeferred","viewRegistry","css3","getObject","selected","keepScrollPos","tag","baseClass","constructor","params","node","byId","style","visibility","destroy","remove","this","id","inherited","arguments","buildRendering","templateString","domNode","containerNode","srcNodeRef","create","_animEndHandle","name","_animStartHandle","mblCSS3Transition","_transEndHandle","set","add","startup","_started","undefined","_visible","fragView","selectedView","firstView","views","getSiblingViews","ids","location","hash","substring","split","forEach","v","i","indexOf","show","defer","onStartView","publish","parent","getParent","resize","hide","getChildren","child","onBeforeTransitionIn","moveTo","dir","transition","context","method","onAfterTransitionIn","onBeforeTransitionOut","onAfterTransitionOut","_clearClasses","classes","trim","className","c","match","push","join","_fixViewState","toNode","nodes","parentNode","childNodes","length","n","nodeType","contains","toWidget","byNode","_inProgress","convertToId","replace","_isBookmarkable","detail","mblForceBookmarkable","charAt","hashchange","performTransition","transitionDir","optArgs","_detail","_optArgs","_arguments","_dummyNode","doc","createElement","body","appendChild","addTransitionInfo","fromNode","fromTop","offsetTop","display","mblAlwaysResizeOnTransition","_resized","resizeAll","_addTransitionPaddingTop","load","movedFrom","apply","concat","_toArray","scrollTop","documentElement","global","pageYOffset","_scrollTop","toTop","top","mblHideAddressBar","scrollTo","fromView","toView","_doTransition","console","log","value","paddingTop","_removeTransitionPaddingTop","_toCls","s","toUpperCase","rev","when","hitch","transit","toPosition","get","reverse","invokeCallback","webkitPerspective","_this","posX","posY","fromOrigin","toOrigin","position","y","innerHeight","viewPos","clickedPosX","innerWidth","x","clickedPosY","transformOrigin","onAnimationStart","e","onAnimationEnd","animationName","target","isOut","li","p","getEnclosingScrollable","onTouchEnd","setFragIds","m","isVisible","checkAncestors","visible","tagName","getShowingView","map","filter","noEvent","doNotHideOthers","out"],"mappings":"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","file":"../../mobile/View.js","sourcesContent":["define([\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/config\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/sniff\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/_base/Deferred\",\r\n\t\"dojo/dom\",\r\n\t\"dojo/dom-class\",\r\n\t\"dojo/dom-construct\",\r\n\t\"dojo/dom-geometry\",\r\n\t\"dojo/dom-style\",\r\n\t\"dijit/registry\",\r\n\t\"dijit/_Contained\",\r\n\t\"dijit/_Container\",\r\n\t\"dijit/_WidgetBase\",\r\n\t\"./ViewController\", // to load ViewController for you (no direct references)\r\n\t\"./common\",\r\n\t\"./transition\",\r\n\t\"./viewRegistry\",\r\n\t\"./_css3\"\r\n], function(array, config, connect, declare, lang, has, win, Deferred, dom, domClass, domConstruct, domGeometry, domStyle, registry, Contained, Container, WidgetBase, ViewController, common, transitDeferred, viewRegistry, css3){\r\n\r\n\t// module:\r\n\t//\t\tdojox/mobile/View\r\n\r\n\tvar dm = lang.getObject(\"dojox.mobile\", true);\r\n\r\n\treturn declare(\"dojox.mobile.View\", [WidgetBase, Container, Contained], {\r\n\t\t// summary:\r\n\t\t//\t\tA container widget for any HTML element and/or Dojo widgets\r\n\t\t// description:\r\n\t\t//\t\tView is a container widget for any HTML element and/or Dojo widgets.\r\n\t\t//\t\tAs a Dojo widget container it can itself contain View widgets\r\n\t\t//\t\tforming a set of nested views. A Dojo Mobile application is usually\r\n\t\t//\t\tmade of multiple View widgets and the user can navigate through\r\n\t\t//\t\tthe views back and forth with animated transition effects.\r\n\t\t//\t\t\r\n\t\t//\t\tWhen using several sibling views (direct children of the same\r\n\t\t//\t\telement), you can use the 'selected' attribute to define whether\r\n\t\t//\t\tthe view should be displayed when the application is launched.\r\n\t\t//\t\tIf no view has selected=true, the first sibling view is displayed\r\n\t\t//\t\tat startup time.\r\n\r\n\t\t// selected: Boolean\r\n\t\t//\t\tIf true, the view is displayed at startup time.\r\n\t\tselected: false,\r\n\r\n\t\t// keepScrollPos: Boolean\r\n\t\t//\t\tIf true, the scroll position is kept when transition occurs between views.\r\n\t\tkeepScrollPos: true,\r\n\r\n\t\t// tag: String\r\n\t\t//\t\tThe name of the HTML tag to create as domNode. The default value is \"div\".\r\n\t\ttag: \"div\",\r\n\r\n\t\t/* internal properties */\r\n\t\tbaseClass: \"mblView\",\r\n\r\n\t\tconstructor: function(/*Object*/params, /*DomNode?*/node){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreates a new instance of the class.\r\n\t\t\t// params:\r\n\t\t\t//\t\tContains the parameters.\r\n\t\t\t// node:\r\n\t\t\t//\t\tThe DOM node. If none is specified, it is automatically created. \r\n\t\t\tif(node){\r\n\t\t\t\tdom.byId(node).style.visibility = \"hidden\";\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestroy: function(){\r\n\t\t\tviewRegistry.remove(this.id);\r\n\t\t\tthis.inherited(arguments);\r\n\t\t},\r\n\r\n\t\tbuildRendering: function(){\r\n\t\t\tif(!this.templateString){\r\n\t\t\t\t// Create root node if it wasn't created by _TemplatedMixin\r\n\t\t\t\tthis.domNode = this.containerNode = this.srcNodeRef || domConstruct.create(this.tag);\r\n\t\t\t}\r\n\r\n\t\t\tthis._animEndHandle = this.connect(this.domNode, css3.name(\"animationEnd\"), \"onAnimationEnd\");\r\n\t\t\tthis._animStartHandle = this.connect(this.domNode, css3.name(\"animationStart\"), \"onAnimationStart\");\r\n\t\t\tif(!config.mblCSS3Transition){\r\n\t\t\t\tthis._transEndHandle = this.connect(this.domNode, css3.name(\"transitionEnd\"), \"onAnimationEnd\");\r\n\t\t\t}\r\n\t\t\tif(has('mblAndroid3Workaround')){\r\n\t\t\t\t// workaround for the screen flicker issue on Android 3.x/4.0\r\n\t\t\t\t// applying \"-webkit-transform-style:preserve-3d\" to domNode can avoid\r\n\t\t\t\t// transition animation flicker\r\n\t\t\t\tdomStyle.set(this.domNode, css3.name(\"transformStyle\"), \"preserve-3d\");\r\n\t\t\t}\r\n\r\n\t\t\tviewRegistry.add(this);\r\n\t\t\tthis.inherited(arguments);\r\n\t\t},\r\n\r\n\t\tstartup: function(){\r\n\t\t\tif(this._started){ return; }\r\n\r\n\t\t\t// Determine which view among the siblings should be visible.\r\n\t\t\t// Priority:\r\n\t\t\t//\t 1. fragment id in the url (ex. #view1,view2)\r\n\t\t\t//\t 2. this.selected\r\n\t\t\t//\t 3. the first view\r\n\t\t\tif(this._visible === undefined){\r\n\t\t\t\tvar views = this.getSiblingViews();\r\n\t\t\t\tvar ids = location.hash && location.hash.substring(1).split(/,/);\r\n\t\t\t\tvar fragView, selectedView, firstView;\r\n\t\t\t\tarray.forEach(views, function(v, i){\r\n\t\t\t\t\tif(array.indexOf(ids, v.id) !== -1){ fragView = v; }\r\n\t\t\t\t\tif(i == 0){ firstView = v; }\r\n\t\t\t\t\tif(v.selected){ selectedView = v; }\r\n\t\t\t\t\tv._visible = false;\r\n\t\t\t\t}, this);\r\n\t\t\t\t(fragView || selectedView || firstView)._visible = true;\r\n\t\t\t}\r\n\t\t\tif(this._visible){\r\n\t\t\t\t// The 2nd arg is not to hide its sibling views so that they can be\r\n\t\t\t\t// correctly initialized.\r\n\t\t\t\tthis.show(true, true);\r\n\r\n\t\t\t\t// Defer firing events to let user connect to events just after creation\r\n\t\t\t\t// TODO: revisit this for 2.0\r\n\t\t\t\tthis.defer(function(){\r\n\t\t\t\t\tthis.onStartView();\r\n\t\t\t\t\tconnect.publish(\"/dojox/mobile/startView\", [this]);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif(this.domNode.style.visibility === \"hidden\"){ // this check is to avoid screen flickers\r\n\t\t\t\tthis.domNode.style.visibility = \"inherit\";\r\n\t\t\t}\r\n\r\n\t\t\t// Need to call inherited first - so that child widgets get started\r\n\t\t\t// up correctly\r\n\t\t\tthis.inherited(arguments);\r\n\r\n\t\t\tvar parent = this.getParent();\r\n\t\t\tif(!parent || !parent.resize){ // top level widget\r\n\t\t\t\tthis.resize();\r\n\t\t\t}\r\n\r\n\t\t\tif(!this._visible){\r\n\t\t\t\t// hide() should be called last so that child widgets can be\r\n\t\t\t\t// initialized while they are visible.\r\n\t\t\t\tthis.hide();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tresize: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCalls resize() of each child widget.\r\n\t\t\tarray.forEach(this.getChildren(), function(child){\r\n\t\t\t\tif(child.resize){ child.resize(); }\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tonStartView: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t\t// description:\r\n\t\t\t//\t\tCalled only when this view is shown at startup time.\r\n\t\t},\r\n\r\n\t\tonBeforeTransitionIn: function(moveTo, dir, transition, context, method){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t\t// description:\r\n\t\t\t//\t\tCalled before the arriving transition occurs.\r\n\t\t},\r\n\r\n\t\tonAfterTransitionIn: function(moveTo, dir, transition, context, method){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t\t// description:\r\n\t\t\t//\t\tCalled after the arriving transition occurs.\r\n\t\t},\r\n\r\n\t\tonBeforeTransitionOut: function(moveTo, dir, transition, context, method){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t\t// description:\r\n\t\t\t//\t\tCalled before the leaving transition occurs.\r\n\t\t},\r\n\r\n\t\tonAfterTransitionOut: function(moveTo, dir, transition, context, method){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t\t// description:\r\n\t\t\t//\t\tCalled after the leaving transition occurs.\r\n\t\t},\r\n\r\n\t\t_clearClasses: function(/*DomNode*/node){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tClean up the domNode classes that were added while making a transition.\r\n\t\t\t// description:\r\n\t\t\t//\t\tRemove all the \"mbl\" prefixed classes except mbl*View.\r\n\t\t\tif(!node){ return; }\r\n\t\t\tvar classes = [];\r\n\t\t\tarray.forEach(lang.trim(node.className||\"\").split(/\\s+/), function(c){\r\n\t\t\t\tif(c.match(/^mbl\\w*View$/) || c.indexOf(\"mbl\") === -1){\r\n\t\t\t\t\tclasses.push(c);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tnode.className = classes.join(' ');\r\n\t\t},\r\n\r\n\t\t_fixViewState: function(/*DomNode*/toNode){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSanity check for view transition states.\r\n\t\t\t// description:\r\n\t\t\t//\t\tSometimes uninitialization of Views fails after making view transition,\r\n\t\t\t//\t\tand that results in failure of subsequent view transitions.\r\n\t\t\t//\t\tThis function does the uninitialization for all the sibling views.\r\n\t\t\tvar nodes = this.domNode.parentNode.childNodes;\r\n\t\t\tfor(var i = 0; i < nodes.length; i++){\r\n\t\t\t\tvar n = nodes[i];\r\n\t\t\t\tif(n.nodeType === 1 && domClass.contains(n, \"mblView\")){\r\n\t\t\t\t\tthis._clearClasses(n);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._clearClasses(toNode); // just in case toNode is a sibling of an ancestor.\r\n\t\t\t\r\n\t\t\t// #16337\r\n\t\t\t// Uninitialization may fail to clear _inProgress when multiple\r\n\t\t\t// performTransition calls occur in a short duration of time.\r\n\t\t\tvar toWidget = registry.byNode(toNode);\r\n\t\t\tif(toWidget){\r\n\t\t\t\ttoWidget._inProgress = false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tconvertToId: function(moveTo){\r\n\t\t\tif(typeof(moveTo) == \"string\"){\r\n\t\t\t\t// removes a leading hash mark (#) and params if exists\r\n\t\t\t\t// ex. \"#bar&myParam=0003\" -> \"bar\"\r\n\t\t\t\treturn moveTo.replace(/^#?([^&?]+).*/, \"$1\");\r\n\t\t\t}\r\n\t\t\treturn moveTo;\r\n\t\t},\r\n\r\n\t\t_isBookmarkable: function(detail){\r\n\t\t\treturn detail.moveTo && (config.mblForceBookmarkable || detail.moveTo.charAt(0) === '#') && !detail.hashchange;\r\n\t\t},\r\n\r\n\t\tperformTransition: function(/*String*/moveTo, /*Number*/transitionDir, /*String*/transition,\r\n\t\t\t\t\t\t\t\t\t/*Object|null*/context, /*String|Function*/method /*...*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to perform the various types of view transitions, such as fade, slide, and flip.\r\n\t\t\t// moveTo: String\r\n\t\t\t//\t\tThe id of the transition destination view which resides in\r\n\t\t\t//\t\tthe current page.\r\n\t\t\t//\t\tIf the value has a hash sign ('#') before the id\r\n\t\t\t//\t\t(e.g. #view1) and the dojo/hash module is loaded by the user\r\n\t\t\t//\t\tapplication, the view transition updates the hash in the\r\n\t\t\t//\t\tbrowser URL so that the user can bookmark the destination\r\n\t\t\t//\t\tview. In this case, the user can also use the browser's\r\n\t\t\t//\t\tback/forward button to navigate through the views in the\r\n\t\t\t//\t\tbrowser history.\r\n\t\t\t//\t\tIf null, transitions to a blank view.\r\n\t\t\t//\t\tIf '#', returns immediately without transition.\r\n\t\t\t// transitionDir: Number\r\n\t\t\t//\t\tThe transition direction. If 1, transition forward. If -1, transition backward.\r\n\t\t\t//\t\tFor example, the slide transition slides the view from right to left when transitionDir == 1,\r\n\t\t\t//\t\tand from left to right when transitionDir == -1.\r\n\t\t\t// transition: String\r\n\t\t\t//\t\tA type of animated transition effect. You can choose from\r\n\t\t\t//\t\tthe standard transition types, \"slide\", \"fade\", \"flip\", or\r\n\t\t\t//\t\tfrom the extended transition types, \"cover\", \"coverv\",\r\n\t\t\t//\t\t\"dissolve\", \"reveal\", \"revealv\", \"scaleIn\", \"scaleOut\",\r\n\t\t\t//\t\t\"slidev\", \"swirl\", \"zoomIn\", \"zoomOut\", \"cube\", and\r\n\t\t\t//\t\t\"swap\". If \"none\" is specified, transition occurs\r\n\t\t\t//\t\timmediately without animation.\r\n\t\t\t// context: Object\r\n\t\t\t//\t\tThe object that the callback function will receive as \"this\".\r\n\t\t\t// method: String|Function\r\n\t\t\t//\t\tA callback function that is called when the transition has finished.\r\n\t\t\t//\t\tA function reference, or name of a function in context.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tpublic\r\n\t\t\t//\r\n\t\t\t// example:\r\n\t\t\t//\t\tTransition backward to a view whose id is \"foo\" with the slide animation.\r\n\t\t\t//\t|\tperformTransition(\"foo\", -1, \"slide\");\r\n\t\t\t//\r\n\t\t\t// example:\r\n\t\t\t//\t\tTransition forward to a blank view, and then open another page.\r\n\t\t\t//\t|\tperformTransition(null, 1, \"slide\", null, function(){location.href = href;});\r\n\r\n\t\t\tif(this._inProgress){ return; } // transition is in progress\r\n\t\t\tthis._inProgress = true;\r\n\t\t\t\r\n\t\t\t// normalize the arg\r\n\t\t\tvar detail, optArgs;\r\n\t\t\tif(moveTo && typeof(moveTo) === \"object\"){\r\n\t\t\t\tdetail = moveTo;\r\n\t\t\t\toptArgs = transitionDir; // array\r\n\t\t\t}else{\r\n\t\t\t\tdetail = {\r\n\t\t\t\t\tmoveTo: moveTo,\r\n\t\t\t\t\ttransitionDir: transitionDir,\r\n\t\t\t\t\ttransition: transition,\r\n\t\t\t\t\tcontext: context,\r\n\t\t\t\t\tmethod: method\r\n\t\t\t\t};\r\n\t\t\t\toptArgs = [];\r\n\t\t\t\tfor(var i = 5; i < arguments.length; i++){\r\n\t\t\t\t\toptArgs.push(arguments[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// save the parameters\r\n\t\t\tthis._detail = detail;\r\n\t\t\tthis._optArgs = optArgs;\r\n\t\t\tthis._arguments = [\r\n\t\t\t\tdetail.moveTo,\r\n\t\t\t\tdetail.transitionDir,\r\n\t\t\t\tdetail.transition,\r\n\t\t\t\tdetail.context,\r\n\t\t\t\tdetail.method\r\n\t\t\t];\r\n\r\n\t\t\tif(detail.moveTo === \"#\"){ return; }\r\n\t\t\tvar toNode;\r\n\t\t\tif(detail.moveTo){\r\n\t\t\t\ttoNode = this.convertToId(detail.moveTo);\r\n\t\t\t}else{\r\n\t\t\t\tif(!this._dummyNode){\r\n\t\t\t\t\tthis._dummyNode = win.doc.createElement(\"div\");\r\n\t\t\t\t\twin.body().appendChild(this._dummyNode);\r\n\t\t\t\t}\r\n\t\t\t\ttoNode = this._dummyNode;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.addTransitionInfo && typeof(detail.moveTo) == \"string\" && this._isBookmarkable(detail)){\r\n\t\t\t\tthis.addTransitionInfo(this.id, detail.moveTo, {transitionDir:detail.transitionDir, transition:detail.transition});\r\n\t\t\t}\r\n\r\n\t\t\tvar fromNode = this.domNode;\r\n\t\t\tvar fromTop = fromNode.offsetTop;\r\n\t\t\ttoNode = this.toNode = dom.byId(toNode);\r\n\t\t\tif(!toNode){ console.log(\"dojox/mobile/View.performTransition: destination view not found: \"+detail.moveTo); return; }\r\n\t\t\ttoNode.style.visibility = \"hidden\";\r\n\t\t\ttoNode.style.display = \"\";\r\n\t\t\tthis._fixViewState(toNode);\r\n\t\t\tvar toWidget = registry.byNode(toNode);\r\n\t\t\tif(toWidget){\r\n\t\t\t\t// Now that the target view became visible, it's time to run resize()\r\n\t\t\t\tif(config.mblAlwaysResizeOnTransition || !toWidget._resized){\r\n\t\t\t\t\tcommon.resizeAll(null, toWidget);\r\n\t\t\t\t\ttoWidget._resized = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(detail.transition && detail.transition != \"none\"){\r\n\t\t\t\t\t// Temporarily add padding to align with the fromNode while transition\r\n\t\t\t\t\ttoWidget._addTransitionPaddingTop(fromTop);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttoWidget.load && toWidget.load(); // for ContentView\r\n\r\n\t\t\t\ttoWidget.movedFrom = fromNode.id;\r\n\t\t\t}\r\n\t\t\tif(has('mblAndroidWorkaround') && !config.mblCSS3Transition\r\n\t\t\t\t\t&& detail.transition && detail.transition != \"none\"){\r\n\t\t\t\t// workaround for the screen flicker issue on Android 2.2/2.3\r\n\t\t\t\t// apply \"-webkit-transform-style:preserve-3d\" to both toNode and fromNode\r\n\t\t\t\t// to make them 3d-transition-ready state just before transition animation\r\n\t\t\t\tdomStyle.set(toNode, css3.name(\"transformStyle\"), \"preserve-3d\");\r\n\t\t\t\tdomStyle.set(fromNode, css3.name(\"transformStyle\"), \"preserve-3d\");\r\n\t\t\t\t// show toNode offscreen to avoid flicker when switching \"display\" and \"visibility\" styles\r\n\t\t\t\tdomClass.add(toNode, \"mblAndroidWorkaround\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.onBeforeTransitionOut.apply(this, this._arguments);\r\n\t\t\tconnect.publish(\"/dojox/mobile/beforeTransitionOut\", [this].concat(lang._toArray(this._arguments)));\r\n\t\t\tif(toWidget){\r\n\t\t\t\t// perform view transition keeping the scroll position\r\n\t\t\t\tif(this.keepScrollPos && !this.getParent()){\r\n\t\t\t\t\tvar scrollTop = win.body().scrollTop || win.doc.documentElement.scrollTop || win.global.pageYOffset || 0;\r\n\t\t\t\t\tfromNode._scrollTop = scrollTop;\r\n\t\t\t\t\tvar toTop = (detail.transitionDir == 1) ? 0 : (toNode._scrollTop || 0);\r\n\t\t\t\t\ttoNode.style.top = \"0px\";\r\n\t\t\t\t\tif(scrollTop > 1 || toTop !== 0){\r\n\t\t\t\t\t\tfromNode.style.top = toTop - scrollTop + \"px\";\r\n\t\t\t\t\t\t// address bar hiding does not work on iOS 7+.\r\n\t\t\t\t\t\tif(!(has(\"ios\") >= 7) && config.mblHideAddressBar !== false){\r\n\t\t\t\t\t\t\tthis.defer(function(){ // iPhone needs setTimeout (via defer)\r\n\t\t\t\t\t\t\t\twin.global.scrollTo(0, (toTop || 1));\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\ttoNode.style.top = \"0px\";\r\n\t\t\t\t}\r\n\t\t\t\ttoWidget.onBeforeTransitionIn.apply(toWidget, this._arguments);\r\n\t\t\t\tconnect.publish(\"/dojox/mobile/beforeTransitionIn\", [toWidget].concat(lang._toArray(this._arguments)));\r\n\t\t\t}\r\n\t\t\ttoNode.style.display = \"none\";\r\n\t\t\ttoNode.style.visibility = \"inherit\";\r\n\r\n\t\t\tcommon.fromView = this;\r\n\t\t\tcommon.toView = toWidget;\r\n\r\n\t\t\tthis._doTransition(fromNode, toNode, detail.transition, detail.transitionDir);\r\n\t\t},\r\n\r\n\t\t_addTransitionPaddingTop: function(/*String|Integer*/ value){\r\n\t\t\t// add padding top to the view in order to get alignment during the transition\r\n\t\t\tthis.containerNode.style.paddingTop = value + \"px\";\r\n\t\t},\r\n\r\n\t\t_removeTransitionPaddingTop: function(){\r\n\t\t\t// remove padding top from the view after the transition\r\n\t\t\tthis.containerNode.style.paddingTop = \"\";\r\n\t\t},\r\n\r\n\t\t_toCls: function(s){\r\n\t\t\t// convert from transition name to corresponding class name\r\n\t\t\t// ex. \"slide\" -> \"mblSlide\"\r\n\t\t\treturn \"mbl\"+s.charAt(0).toUpperCase() + s.substring(1);\r\n\t\t},\r\n\r\n\t\t_doTransition: function(fromNode, toNode, transition, transitionDir){\r\n\t\t\tvar rev = (transitionDir == -1) ? \" mblReverse\" : \"\";\r\n\t\t\ttoNode.style.display = \"\";\r\n\t\t\tif(!transition || transition == \"none\"){\r\n\t\t\t\tthis.domNode.style.display = \"none\";\r\n\t\t\t\tthis.invokeCallback();\r\n\t\t\t}else if(config.mblCSS3Transition){\r\n\t\t\t\t//get dojox/css3/transit first\r\n\t\t\t\tDeferred.when(transitDeferred, lang.hitch(this, function(transit){\r\n\t\t\t\t\t//follow the style of .mblView.mblIn in View.css\r\n\t\t\t\t\t//need to set the toNode to absolute position\r\n\t\t\t\t\tvar toPosition = domStyle.get(toNode, \"position\");\r\n\t\t\t\t\tdomStyle.set(toNode, \"position\", \"absolute\");\r\n\t\t\t\t\tDeferred.when(transit(fromNode, toNode, {transition: transition, reverse: (transitionDir===-1)?true:false}),lang.hitch(this,function(){\r\n\t\t\t\t\t\tdomStyle.set(toNode, \"position\", toPosition);\r\n\t\t\t\t\t\t// Reset the temporary padding on toNode\r\n\t\t\t\t\t\ttoNode.style.paddingTop = \"\";\r\n\t\t\t\t\t\tthis.invokeCallback();\r\n\t\t\t\t\t}));\r\n\t\t\t\t}));\r\n\t\t\t}else{\r\n\t\t\t\tif(transition.indexOf(\"cube\") != -1){\r\n\t\t\t\t\tif(has('ipad')){\r\n\t\t\t\t\t\tdomStyle.set(toNode.parentNode, {webkitPerspective:1600});\r\n\t\t\t\t\t}else if(has(\"ios\")){\r\n\t\t\t\t\t\tdomStyle.set(toNode.parentNode, {webkitPerspective:800});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar s = this._toCls(transition);\r\n\t\t\t\tif(has('mblAndroidWorkaround')){\r\n\t\t\t\t\t// workaround for the screen flicker issue on Android 2.2\r\n\t\t\t\t\t// applying transition css classes just after setting toNode.style.display = \"\"\r\n\t\t\t\t\t// causes flicker, so wait for a while using setTimeout (via defer)\r\n\t\t\t\t\tvar _this = this;\r\n\t\t\t\t\t_this.defer(function(){\r\n\t\t\t\t\t\tdomClass.add(fromNode, s + \" mblOut\" + rev);\r\n\t\t\t\t\t\tdomClass.add(toNode, s + \" mblIn\" + rev);\r\n\t\t\t\t\t\tdomClass.remove(toNode, \"mblAndroidWorkaround\"); // remove offscreen style\r\n\t\t\t\t\t\t_this.defer(function(){\r\n\t\t\t\t\t\t\tdomClass.add(fromNode, \"mblTransition\");\r\n\t\t\t\t\t\t\tdomClass.add(toNode, \"mblTransition\");\r\n\t\t\t\t\t\t}, 30); // 30 = 100 - 70, to make total delay equal to 100ms\r\n\t\t\t\t\t}, 70); // 70ms is experiential value\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdomClass.add(fromNode, s + \" mblOut\" + rev);\r\n\t\t\t\t\tdomClass.add(toNode, s + \" mblIn\" + rev);\r\n\t\t\t\t\tthis.defer(function(){\r\n\t\t\t\t\t\tdomClass.add(fromNode, \"mblTransition\");\r\n\t\t\t\t\t\tdomClass.add(toNode, \"mblTransition\");\r\n\t\t\t\t\t}, 100);\r\n\t\t\t\t}\r\n\t\t\t\t// set transform origin\r\n\t\t\t\tvar fromOrigin = \"50% 50%\";\r\n\t\t\t\tvar toOrigin = \"50% 50%\";\r\n\t\t\t\tvar scrollTop, posX, posY;\r\n\t\t\t\tif(transition.indexOf(\"swirl\") != -1 || transition.indexOf(\"zoom\") != -1){\r\n\t\t\t\t\tif(this.keepScrollPos && !this.getParent()){\r\n\t\t\t\t\t\tscrollTop = win.body().scrollTop || win.doc.documentElement.scrollTop || win.global.pageYOffset || 0;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tscrollTop = -domGeometry.position(fromNode, true).y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tposY = win.global.innerHeight / 2 + scrollTop;\r\n\t\t\t\t\tfromOrigin = \"50% \" + posY + \"px\";\r\n\t\t\t\t\ttoOrigin = \"50% \" + posY + \"px\";\r\n\t\t\t\t}else if(transition.indexOf(\"scale\") != -1){\r\n\t\t\t\t\tvar viewPos = domGeometry.position(fromNode, true);\r\n\t\t\t\t\tposX = ((this.clickedPosX !== undefined) ? this.clickedPosX : win.global.innerWidth / 2) - viewPos.x;\r\n\t\t\t\t\tif(this.keepScrollPos && !this.getParent()){\r\n\t\t\t\t\t\tscrollTop = win.body().scrollTop || win.doc.documentElement.scrollTop || win.global.pageYOffset || 0;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tscrollTop = -viewPos.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tposY = ((this.clickedPosY !== undefined) ? this.clickedPosY : win.global.innerHeight / 2) + scrollTop;\r\n\t\t\t\t\tfromOrigin = posX + \"px \" + posY + \"px\";\r\n\t\t\t\t\ttoOrigin = posX + \"px \" + posY + \"px\";\r\n\t\t\t\t}\r\n\t\t\t\tdomStyle.set(fromNode, css3.add({}, {transformOrigin:fromOrigin}));\r\n\t\t\t\tdomStyle.set(toNode, css3.add({}, {transformOrigin:toOrigin}));\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonAnimationStart: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA handler that is called when transition animation starts.\r\n\t\t},\r\n\r\n\t\tonAnimationEnd: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA handler that is called after transition animation ends.\r\n\t\t\tvar name = e.animationName || e.target.className;\r\n\t\t\tif(name.indexOf(\"Out\") === -1 &&\r\n\t\t\t\tname.indexOf(\"In\") === -1 &&\r\n\t\t\t\tname.indexOf(\"Shrink\") === -1){ return; }\r\n\t\t\tvar isOut = false;\r\n\t\t\tif(domClass.contains(this.domNode, \"mblOut\")){\r\n\t\t\t\tisOut = true;\r\n\t\t\t\tthis.domNode.style.display = \"none\";\r\n\t\t\t\tdomClass.remove(this.domNode, [this._toCls(this._detail.transition), \"mblIn\", \"mblOut\", \"mblReverse\"]);\r\n\t\t\t}else{\r\n\t\t\t\t// Reset the temporary padding\r\n\t\t\t\tthis._removeTransitionPaddingTop();\r\n\t\t\t}\r\n\t\t\tdomStyle.set(this.domNode, css3.add({}, {transformOrigin:\"\"}));\r\n\t\t\tif(name.indexOf(\"Shrink\") !== -1){\r\n\t\t\t\tvar li = e.target;\r\n\t\t\t\tli.style.display = \"none\";\r\n\t\t\t\tdomClass.remove(li, \"mblCloseContent\");\r\n\r\n\t\t\t\t// If target is placed inside scrollable, need to call onTouchEnd\r\n\t\t\t\t// to adjust scroll position\r\n\t\t\t\tvar p = viewRegistry.getEnclosingScrollable(this.domNode);\r\n\t\t\t\tp && p.onTouchEnd();\r\n\t\t\t}\r\n\t\t\tif(isOut){\r\n\t\t\t\tthis.invokeCallback();\r\n\t\t\t}\r\n\t\t\tthis._clearClasses(this.domNode);\r\n\r\n\t\t\t// clear the clicked position\r\n\t\t\tthis.clickedPosX = this.clickedPosY = undefined;\r\n\r\n\t\t\tif(name.indexOf(\"Cube\") !== -1 &&\r\n\t\t\t\tname.indexOf(\"In\") !== -1 && has(\"ios\")){\r\n\t\t\t\tthis.domNode.parentNode.style[css3.name(\"perspective\")] = \"\";\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tinvokeCallback: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA function to be called after performing a transition to\r\n\t\t\t//\t\tcall a specified callback.\r\n\t\t\tthis.onAfterTransitionOut.apply(this, this._arguments);\r\n\t\t\tconnect.publish(\"/dojox/mobile/afterTransitionOut\", [this].concat(this._arguments));\r\n\t\t\tvar toWidget = registry.byNode(this.toNode);\r\n\t\t\tif(toWidget){\r\n\t\t\t\ttoWidget.onAfterTransitionIn.apply(toWidget, this._arguments);\r\n\t\t\t\tconnect.publish(\"/dojox/mobile/afterTransitionIn\", [toWidget].concat(this._arguments));\r\n\t\t\t\ttoWidget.movedFrom = undefined;\r\n\t\t\t\tif(this.setFragIds && this._isBookmarkable(this._detail)){\r\n\t\t\t\t\tthis.setFragIds(toWidget); // setFragIds is defined in bookmarkable.js\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(has('mblAndroidWorkaround')){\r\n\t\t\t\t// workaround for the screen flicker issue on Android 2.2/2.3\r\n\t\t\t\t// remove \"-webkit-transform-style\" style after transition finished\r\n\t\t\t\t// to avoid side effects such as input field auto-scrolling issue\r\n\t\t\t\t// use setTimeout (via defer) to avoid flicker in case of ScrollableView\r\n\t\t\t\tthis.defer(function(){\r\n\t\t\t\t\tif(toWidget){ domStyle.set(this.toNode, css3.name(\"transformStyle\"), \"\"); }\r\n\t\t\t\t\tdomStyle.set(this.domNode, css3.name(\"transformStyle\"), \"\");\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tvar c = this._detail.context, m = this._detail.method;\r\n\t\t\tif(c || m){\r\n\t\t\t\tif(!m){\r\n\t\t\t\t\tm = c;\r\n\t\t\t\t\tc = null;\r\n\t\t\t\t}\r\n\t\t\t\tc = c || win.global;\r\n\t\t\t\tif(typeof(m) == \"string\"){\r\n\t\t\t\t\tc[m].apply(c, this._optArgs);\r\n\t\t\t\t}else if(typeof(m) == \"function\"){\r\n\t\t\t\t\tm.apply(c, this._optArgs);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._detail = this._optArgs = this._arguments = undefined;\r\n\t\t\tthis._inProgress = false;\r\n\t\t},\r\n\r\n\t\tisVisible: function(/*Boolean?*/checkAncestors){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturn true if this view is visible\r\n\t\t\t// checkAncestors:\r\n\t\t\t//\t\tIf true, in addition to its own visibility, also checks the\r\n\t\t\t//\t\tancestors visibility to see if the view is actually being\r\n\t\t\t//\t\tshown or not.\r\n\t\t\tvar visible = function(node){\r\n\t\t\t\treturn domStyle.get(node, \"display\") !== \"none\";\r\n\t\t\t};\r\n\t\t\tif(checkAncestors){\r\n\t\t\t\tfor(var n = this.domNode; n.tagName !== \"BODY\"; n = n.parentNode){\r\n\t\t\t\t\tif(!visible(n)){ return false; }\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}else{\r\n\t\t\t\treturn visible(this.domNode);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetShowingView: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFind the currently showing view from my sibling views.\r\n\t\t\t// description:\r\n\t\t\t//\t\tNote that depending on the ancestor views' visibility,\r\n\t\t\t//\t\tthe found view may not be actually shown.\r\n\t\t\tvar nodes = this.domNode.parentNode.childNodes;\r\n\t\t\tfor(var i = 0; i < nodes.length; i++){\r\n\t\t\t\tvar n = nodes[i];\r\n\t\t\t\tif(n.nodeType === 1 && domClass.contains(n, \"mblView\") && n.style.display !== \"none\"){\r\n\t\t\t\t\treturn registry.byNode(n);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tgetSiblingViews: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns an array of the sibling views.\r\n\t\t\tif(!this.domNode.parentNode){ return [this]; }\r\n\t\t\treturn array.map(array.filter(this.domNode.parentNode.childNodes,\r\n\t\t\t\tfunction(n){ return n.nodeType === 1 && domClass.contains(n, \"mblView\"); }),\r\n\t\t\t\tfunction(n){ return registry.byNode(n); });\r\n\t\t},\r\n\r\n\t\tshow: function(/*Boolean?*/noEvent, /*Boolean?*/doNotHideOthers){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tShows this view without a transition animation.\r\n\t\t\tvar out = this.getShowingView();\r\n\t\t\tif(!noEvent){\r\n\t\t\t\tif(out){\r\n\t\t\t\t\tout.onBeforeTransitionOut(out.id);\r\n\t\t\t\t\tconnect.publish(\"/dojox/mobile/beforeTransitionOut\", [out, out.id]);\r\n\t\t\t\t}\r\n\t\t\t\tthis.onBeforeTransitionIn(this.id);\r\n\t\t\t\tconnect.publish(\"/dojox/mobile/beforeTransitionIn\", [this, this.id]);\r\n\t\t\t}\r\n\r\n\t\t\tif(doNotHideOthers){\r\n\t\t\t\tthis.domNode.style.display = \"\";\r\n\t\t\t}else{\r\n\t\t\t\tarray.forEach(this.getSiblingViews(), function(v){\r\n\t\t\t\t\tv.domNode.style.display = (v === this) ? \"\" : \"none\";\r\n\t\t\t\t}, this);\r\n\t\t\t}\r\n\t\t\tthis.load && this.load(); // for ContentView\r\n\r\n\t\t\tif(!noEvent){\r\n\t\t\t\tif(out){\r\n\t\t\t\t\tout.onAfterTransitionOut(out.id);\r\n\t\t\t\t\tconnect.publish(\"/dojox/mobile/afterTransitionOut\", [out, out.id]);\r\n\t\t\t\t}\r\n\t\t\t\tthis.onAfterTransitionIn(this.id);\r\n\t\t\t\tconnect.publish(\"/dojox/mobile/afterTransitionIn\", [this, this.id]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\thide: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHides this view without a transition animation.\r\n\t\t\tthis.domNode.style.display = \"none\";\r\n\t\t}\r\n\t});\r\n});\r\n"]}