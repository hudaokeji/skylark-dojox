{"version":3,"sources":["mobile/tests/imageControlsApp/app/assistants/flickr-image-view-assistant.js"],"names":["dojo","require","declare","dojox","mobile","app","SceneAssistant","apiKey","setup","this","controller","parse","viewer","dijit","byId","_this","handlePhotoLoad","hitch","loadingDiv","query","loadConn","connect","type","url","isSmall","disconnect","destroy","reportDiv","direction","index","set","urls","length","innerHTML","title","activate","options","dataType","console","log","loadInteresting","loadGroup","useData","images","startIndex","Math","min","max","io","script","get","content","api_key","format","jsonp","addBoth","groupData","group_id","nsid","per_page","res","photos","photo","baseUrl","i","farm","server","id","secret","push","large","small"],"mappings":"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","file":"../../../../../../mobile/tests/imageControlsApp/app/assistants/flickr-image-view-assistant.js","sourcesContent":["dojo.require(\"dojox.mobile.app.SceneAssistant\");\r\n\r\ndojo.declare(\"FlickrImageViewAssistant\", dojox.mobile.app.SceneAssistant, {\r\n  \r\n\tapiKey: \"8c6803164dbc395fb7131c9d54843627\",\r\n\t\r\n\tsetup: function(){\r\n\t\r\n\t\t// Instantiate widgets in the template HTML.\r\n\t\tthis.controller.parse();\r\n\t\t\r\n\t\tvar viewer = this.viewer = dijit.byId(\"flickrImageView\");\r\n\t\t\r\n\t\tvar _this = this;\r\n\t\t\r\n\t\tthis.handlePhotoLoad = dojo.hitch(this, this.handlePhotoLoad);\r\n\t\t\r\n\t\tvar loadingDiv = this.controller.query(\".loading\")[0];\r\n\t\t\r\n\t\t// When the first image loads, hide the loading indicator.\r\n\t\tvar loadConn = dojo.connect(viewer, \"onLoad\", function(type, url, isSmall){\r\n\t\t\tif(type == \"center\"){\r\n\t\t\t\tdojo.disconnect(loadConn);\r\n\t\t\t\tdojo.destroy(loadingDiv);\r\n\t\t\t\tloadingDiv = null;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tvar reportDiv = this.controller.query(\".report\")[0];\r\n\t\t\r\n\t\tthis.connect(viewer, \"onChange\", function(direction){\r\n\t\t\t_this.index += direction;\r\n\t\t\t\r\n\t\t\t// If we are not at the first image, set the leftUrl attribute\r\n\t\t\tif(_this.index > 0){\r\n\t\t\t\tviewer.set(\"leftUrl\", _this.urls[_this.index - 1]);\r\n\t\t\t}\r\n\t\t\r\n\t\t\t// If we are not at the last image, set the rightUrl attribute\r\n\t\t\tif(_this.index < _this.urls.length - 1){\r\n\t\t\t\tviewer.set(\"rightUrl\", _this.urls[_this.index + 1]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treportDiv.innerHTML =\r\n\t\t\t\t(_this.index + 1) + \" of \" + _this.urls.length\r\n\t\t\t\t+ \" \" + _this.urls[_this.index].title;\r\n\t\t});\r\n\t},\r\n  \r\n\tactivate: function(options){\r\n\t\t\r\n\t\tthis.dataType = (options && options.type ? options.type : \"interesting\");\r\n\t\tconsole.log(\"In main assistant activate, dataType = \", this.dataType, options);\r\n\t\t\r\n\t\tswitch(this.dataType){\r\n\t\t\tcase \"interesting\":\r\n\t\t\t\tthis.loadInteresting();\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"group\":\r\n\t\t\t\tthis.loadGroup(options);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"data\":\r\n\t\t\t\t// Another scene has passed in a list of images\r\n\t\t\t\t// and an initial index\r\n\t\t\t\tthis.useData(options.images, options.index || 0);\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t}\r\n\t},\r\n\t\r\n\tuseData: function(images, startIndex){\r\n\t\tthis.urls = images;\r\n\t\tthis.index = Math.min(images.length - 1, Math.max(0, startIndex));\r\n\t\r\n\t\tif (this.index > 0) {\r\n\t\t\tthis.viewer.set(\"leftUrl\", images[this.index - 1]);\r\n\t\t}\r\n\t\tthis.viewer.set(\"centerUrl\", images[this.index]);\r\n\t\t\r\n\t\tif (this.index < images.length) {\r\n\t\t\tthis.viewer.set(\"rightUrl\", images[this.index + 1]);\r\n\t\t}\r\n\t},\r\n  \r\n\tloadInteresting: function(){\r\n\t\tconsole.log(\"loading interesting\");\r\n\r\n\t\tvar url = \"http://api.flickr.com/services/rest/?method=\" +\r\n\t\t\t\t\t\"flickr.interestingness.getList\";\r\n\t\t\t\t\t\r\n\r\n\t\tvar deferred = dojo.io.script.get({\r\n\t\t\turl: url,\r\n\t\t\tcontent: {\r\n\t\t\t\tapi_key: this.apiKey,\r\n\t\t\t\tformat: \"json\"\r\n\t\t\t},\r\n\t\t\tjsonp: \"jsoncallback\"\r\n\t\t});\r\n\t\tdeferred.addBoth(this.handlePhotoLoad);\r\n\t},\r\n\r\n\tloadGroup: function(groupData){\r\n\t\tconsole.log(\"loading group \", groupData);\r\n\r\n\t\tvar url = \"http://api.flickr.com/services/rest/?method=\" +\r\n\t\t\t\t\t\"flickr.groups.pools.getPhotos\";\r\n\t\t\t\t\t\r\n//\t\t\"http://api.flickr.com/services/rest/?method=flickr.groups.pools.getPhotos\"\r\n//\t\t+ \"&api_key=\" + lib.API_KEY\r\n//\t\t+ \"&group_id=\" + group.id\r\n//\t\t+ \"&extras=owner_name\"\r\n//\t\t+ \"&per_page=\" + (perPage || 10)\r\n//\t\t+ \"&format=json&nojsoncallback=1\"\r\n\r\n\t\tvar deferred = dojo.io.script.get({\r\n\t\t\turl: url,\r\n\t\t\tcontent: {\r\n\t\t\t\tapi_key: this.apiKey,\r\n\t\t\t\tformat: \"json\",\r\n\t\t\t\tgroup_id: groupData.nsid,\r\n\t\t\t\tper_page: 20\r\n\t\t\t},\r\n\t\t\tjsonp: \"jsoncallback\"\r\n\t\t});\r\n\t\tdeferred.addBoth(this.handlePhotoLoad);\r\n\t},\r\n\t\r\n\t\r\n\t\r\n\thandlePhotoLoad: function(res){\r\n\t\t\r\n\t\tif(res && res.photos && res.photos.photo){\r\n\t\t\tvar images = res.photos.photo;\r\n\t\t\t\r\n\t\t\tvar urls = [];\r\n\t\t\t\r\n\t\t\tvar baseUrl;\r\n\t\t\t\r\n\t\t\tfor(var i = 0; i < images.length; i++){\r\n\t\t\t\tbaseUrl = \"http://farm\"\r\n\t\t\t\t\t\t\t+ images[i].farm\r\n\t\t\t\t\t\t\t+ \".static.flickr.com/\"\r\n\t\t\t\t\t\t\t+ images[i].server\r\n\t\t\t\t\t\t\t+ \"/\"\r\n\t\t\t\t\t\t\t+ images[i].id\r\n\t\t\t\t\t\t\t+ \"_\"\r\n\t\t\t\t\t\t\t+ images[i].secret;\r\n\t\t\t\turls.push({\r\n\t\t\t\t\tlarge: baseUrl + \"_m.jpg\",\r\n\t\t\t\t\tsmall: baseUrl + \"_t.jpg\",\r\n\t\t\t\t\ttitle: images[i].title\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis.urls = urls;\r\n\t\t\tthis.index = 0;\r\n\t\t\r\n\t\t\tthis.viewer.set(\"centerUrl\", urls[0]);\r\n\t\t\tthis.viewer.set(\"rightUrl\", urls[1]);\r\n\t\t}else{\r\n\t\t\tconsole.log(\"didn't get photos\");\r\n\t\t}\r\n\t}\r\n  \r\n});"]}