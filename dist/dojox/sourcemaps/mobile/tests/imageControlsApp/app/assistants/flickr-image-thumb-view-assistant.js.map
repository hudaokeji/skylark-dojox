{"version":3,"sources":["mobile/tests/imageControlsApp/app/assistants/flickr-image-thumb-view-assistant.js"],"names":["dojo","require","declare","dojox","mobile","app","SceneAssistant","apiKey","setup","this","controller","parse","handlePhotoLoad","hitch","search","resizeViewer","textWidget","dijit","byId","viewer","labelParam","resizeTimer","_this","connect","item","index","console","log","stageController","pushScene","type","images","urls","value","length","timer","setTimeout","set","setThumbSize","window","clearTimeout","activate","options","dataType","style","domNode","loadInteresting","loadText","loadTags","cls","removeClass","addClass","resize","searchText","trim","io","script","get","url","content","api_key","format","per_page","jsonp","addBoth","text","extras","tags","res","photos","photo","baseUrl","i","farm","server","id","secret","push","large","small","thumb","ownername","title"],"mappings":"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","file":"../../../../../../mobile/tests/imageControlsApp/app/assistants/flickr-image-thumb-view-assistant.js","sourcesContent":["dojo.require(\"dojox.mobile.app.SceneAssistant\");\r\n\r\ndojo.declare(\"FlickrImageThumbViewAssistant\", dojox.mobile.app.SceneAssistant, {\r\n\r\n\tapiKey: \"8c6803164dbc395fb7131c9d54843627\",\r\n\r\n\tsetup: function(){\r\n\r\n\t\t// Instantiate widgets in the template HTML.\r\n\t\tthis.controller.parse();\r\n\r\n\t\tthis.handlePhotoLoad = dojo.hitch(this, this.handlePhotoLoad);\r\n\t\tthis.search = dojo.hitch(this, this.search);\r\n\t\tthis.resizeViewer = dojo.hitch(this, this.resizeViewer);\r\n\r\n\t\tthis.textWidget = dijit.byId(\"searchTextThumbInput\");\r\n\r\n\t\tvar viewer = this.viewer = dijit.byId(\"flickrImageThumbView\");\r\n\r\n\t\t// Set the parameter from which to retrieve the owner name\r\n\t\tviewer.labelParam = \"ownername\";\r\n\r\n\t\tvar _this = this;\r\n\r\n\t\tthis.connect(viewer, \"onSelect\", function(item, index){\r\n\t\t\tconsole.log(\"selected \", item, index);\r\n\r\n\t\t\t_this.controller.stageController.pushScene(\"flickr-image-view\",{\r\n\t\t\t\ttype: \"data\",\r\n\t\t\t\timages: _this.urls,\r\n\t\t\t\tindex: index\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.connect(this.textWidget, \"onChange\", function(value){\r\n\t\t\tif(!value || value.length == 0){\r\n\t\t\t\t_this.viewer.set(\"items\", []);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!_this.timer){\r\n\t\t\t\t_this.timer = setTimeout(_this.search, 1000);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.connect(dijit.byId(\"btnSmall\"), \"onClick\", function(){\r\n\t\t\t_this.setThumbSize(\"small\");\r\n\t\t});\r\n\t\tthis.connect(dijit.byId(\"btnMedium\"), \"onClick\", function(){\r\n\t\t\t_this.setThumbSize(\"medium\");\r\n\t\t});\r\n\t\tthis.connect(dijit.byId(\"btnLarge\"), \"onClick\", function(){\r\n\t\t\t_this.setThumbSize(\"large\");\r\n\t\t});\r\n\r\n\t\tvar resizeTimer;\r\n\t\t// Listen to the resize event on the window to make\r\n\t\t// the thumbnails fill the horizontal space\r\n\t\t// This is fairly pointless for mobile, but makes it work\r\n\t\t// better in desktop browsers\r\n\t\tthis.connect(window, \"resize\", function(){\r\n\t\t\tif(resizeTimer){\r\n\t\t\t\tclearTimeout(resizeTimer);\r\n\t\t\t}\r\n\t\t\tresizeTimer = setTimeout(_this.resizeViewer, 300);\r\n\t\t});\r\n\t},\r\n\r\n\tactivate: function(options){\r\n\r\n\t\t// If this is the first time this view is activated, then do the initial\r\n\t\t// load of images\r\n\t\tif (!this.dataType) {\r\n\r\n\t\t\tthis.dataType = (options ? options.type : \"interesting\");\r\n\r\n\t\t\tswitch (this.dataType) {\r\n\t\t\t\tcase \"interesting\":\r\n\t\t\t\t\t// Hide the search text box\r\n\t\t\t\t\tdojo.style(this.textWidget.domNode, \"display\", \"none\");\r\n\t\t\t\t\tthis.loadInteresting();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\t\tdojo.style(this.textWidget.domNode, \"visibility\", \"visible\");\r\n\t\t\t\t\tthis.loadText(this.textWidget.set(\"value\"));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"tag\":\r\n\t\t\t\t\t// Another scene has passed in a list of images\r\n\t\t\t\t\t// and an initial index\r\n\t\t\t\t\tdojo.style(this.textWidget.domNode, \"visibility\", \"visible\");\r\n\t\t\t\t\tthis.loadTags(this.textWidget.set(\"value\"));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.log(\"unknown type \" + this.dataType, options);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetThumbSize: function(cls){\r\n\t\tdojo.removeClass(this.viewer.domNode, [\"small\", \"medium\", \"large\"]);\r\n\t\tdojo.addClass(this.viewer.domNode, cls);\r\n\t\tthis.resizeViewer();\r\n\t},\r\n\r\n\tresizeViewer: function(){\r\n\t\tthis.viewer.resize();\r\n\t},\r\n\r\n\tsearch: function(){\r\n\t\tif(this.timer){\r\n\t\t\tclearTimeout(this.timer);\r\n\t\t\tthis.timer = null;\r\n\t\t}\r\n\r\n\t\tvar searchText = this.textWidget.set(\"value\");\r\n\r\n\t\tif(!searchText || dojo.trim(searchText).length < 1){\r\n\t\t\tthis.viewer.set(\"items\", []);\r\n\r\n\t\t\tconsole.log(\"NOT SEARCHING\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconsole.log(\"search\", searchText);\r\n\t\tswitch(this.dataType){\r\n\t\t\tcase \"text\":\r\n\t\t\t\tthis.loadText(searchText);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"tag\":\r\n\t\t\t\t// Another scene has passed in a list of images\r\n\t\t\t\t// and an initial index\r\n\t\t\t\tthis.loadTags(searchText);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\r\n\tloadInteresting: function(){\r\n\t\tconsole.log(\"loading interesting\");\r\n\r\n\t\tvar url = \"http://api.flickr.com/services/rest/?method=\" +\r\n\t\t\t\t\t\"flickr.interestingness.getList\";\r\n\r\n\t\tvar deferred = dojo.io.script.get({\r\n\t\t\turl: url,\r\n\t\t\tcontent: {\r\n\t\t\t\tapi_key: this.apiKey,\r\n\t\t\t\tformat: \"json\",\r\n\t\t\t\tper_page: 20\r\n\t\t\t},\r\n\t\t\tjsonp: \"jsoncallback\"\r\n\t\t});\r\n\t\tdeferred.addBoth(this.handlePhotoLoad);\r\n\t},\r\n\r\n\tloadText: function(text){\r\n\t\tconsole.log(\"loading text \", text);\r\n\r\n\t\tvar url = \"http://api.flickr.com/services/rest/?method=\" +\r\n\t\t\t\t\t\"flickr.photos.search\";\r\n\r\n\t\tvar deferred = dojo.io.script.get({\r\n\t\t\turl: url,\r\n\t\t\tcontent: {\r\n\t\t\t\tapi_key: this.apiKey,\r\n\t\t\t\tformat: \"json\",\r\n\t\t\t\ttext: text,\r\n\t\t\t\textras: \"owner_name\",\r\n\t\t\t\tper_page: 20\r\n\t\t\t},\r\n\t\t\tjsonp: \"jsoncallback\"\r\n\t\t});\r\n\t\tdeferred.addBoth(this.handlePhotoLoad);\r\n\t},\r\n\r\n\tloadTags: function(text){\r\n\t\tconsole.log(\"loading tags \", text);\r\n\r\n\t\tvar url = \"http://api.flickr.com/services/rest/?method=\" +\r\n\t\t\t\t\t\"flickr.photos.search\";\r\n\r\n\t\tvar deferred = dojo.io.script.get({\r\n\t\t\turl: url,\r\n\t\t\tcontent: {\r\n\t\t\t\tapi_key: this.apiKey,\r\n\t\t\t\tformat: \"json\",\r\n\t\t\t\ttags: text,\r\n\t\t\t\tper_page: 20\r\n\t\t\t},\r\n\t\t\tjsonp: \"jsoncallback\"\r\n\t\t});\r\n\t\tdeferred.addBoth(this.handlePhotoLoad);\r\n\t},\r\n\r\n\thandlePhotoLoad: function(res){\r\n\t\tconsole.log(\"got photos\", res);\r\n\t\tif(res && res.photos && res.photos.photo){\r\n\t\t\tvar images = this.images = res.photos.photo;\r\n\r\n\t\t\tvar urls = [];\r\n\r\n\t\t\tvar baseUrl;\r\n\r\n\t\t\tfor(var i = 0; i < images.length; i++){\r\n\t\t\t\tbaseUrl = \"http://farm\"\r\n\t\t\t\t\t\t\t+ images[i].farm\r\n\t\t\t\t\t\t\t+ \".static.flickr.com/\"\r\n\t\t\t\t\t\t\t+ images[i].server\r\n\t\t\t\t\t\t\t+ \"/\"\r\n\t\t\t\t\t\t\t+ images[i].id\r\n\t\t\t\t\t\t\t+ \"_\"\r\n\t\t\t\t\t\t\t+ images[i].secret;\r\n\t\t\t\turls.push({\r\n\t\t\t\t\tlarge: baseUrl + \".jpg\",\r\n\t\t\t\t\tsmall: baseUrl + \"_t.jpg\",\r\n\t\t\t\t\tthumb: baseUrl + \"_s.jpg\",\r\n\t\t\t\t\townername: images[i].ownername,\r\n\t\t\t\t\ttitle: images[i].title\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis.urls = urls;\r\n\t\t\tthis.index = 0;\r\n\t\t\tthis.viewer.set(\"selectedIndex\", this.index);\r\n\r\n\t\t\tthis.viewer.set(\"items\", urls);\r\n\t\t}else{\r\n\t\t\tthis.viewer.set(\"items\", []);\r\n\t\t\tconsole.log(\"didn't get photos\");\r\n\t\t}\r\n\t}\r\n\r\n});"]}