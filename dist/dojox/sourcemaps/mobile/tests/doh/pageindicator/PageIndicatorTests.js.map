{"version":3,"sources":["mobile/tests/doh/pageindicator/PageIndicatorTests.js"],"names":["timeoutInterval","WIDGET_CLASSNAME1","WIDGET_CLASSNAME2","WIDGET_DOT_CLASSNAME1","WIDGET_DOT_CLASSNAME2","WIDGET_PAGENUM","require","connect","has","domConst","domClass","ready","registry","runner","PageIndicator","_initAppBars","view1","byId","findAppBars","resize","view2","view3","view4","view5","_assertCorrectPageIndicator","widget","col","assertNotEqual","assertTrue","contains","domNode","r","_tblNode","rows","assertEqual","cells","length","i","dot","firstChild","placeHolderId","WIDGET_PROGRAMMATICALLY","id","fixed","place","startup","widgetId","_createPageIndicatorProgrammaticallyWithSourceNodeReference","register","name","timeout","runTest","widget1","d","Deferred","setTimeout","getTestCallback","goTo","node","e","document","createEventObject","layerX","fireEvent","createEvent","initEvent","dispatchEvent","errorMsg","errorCounter","window","onerror","msg","url","lineNumber","console","log","destroyRecursive","run"],"mappings":"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","file":"../../../../../mobile/tests/doh/pageindicator/PageIndicatorTests.js","sourcesContent":["var timeoutInterval = 3000;\r\n\r\nvar WIDGET_CLASSNAME1 = \"mblPageIndicator\";\r\nvar WIDGET_CLASSNAME2 = \"mblFixedBottomBar\";\r\nvar WIDGET_DOT_CLASSNAME1 = \"mblPageIndicatorDot\";\r\nvar WIDGET_DOT_CLASSNAME2 = \"mblPageIndicatorDotSelected\";\r\nvar WIDGET_PAGENUM = 5;\r\n\r\nrequire([\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/sniff\",\r\n\t\"dojo/dom-construct\", // dojo.place\r\n\t\"dojo/dom-class\", // dojo.hasClass\r\n\t\"dojo/ready\", // dojo.ready\r\n\t\"dijit/registry\",  // dijit.byId\r\n\t\"doh/runner\",\t//doh functions\r\n\t\"dojox/mobile/PageIndicator\",\r\n\t\"dojox/mobile\",\t\t\t\t// This is a mobile app.\r\n\t\"dojox/mobile/SwapView\",\t\t// This mobile app uses mobile view\r\n\t\"dojox/mobile/compat\",\t\t// This mobile app supports running on desktop browsers\r\n\t\"dojox/mobile/parser\"\t\t// This mobile app uses declarative programming with fast mobile parser\r\n], function(connect, has, domConst, domClass, ready, registry, runner, PageIndicator){\r\n\tfunction fireOnClick(node){\r\n\t\tif(has(\"ie\")<9){\r\n\t\t\tvar e = document.createEventObject();\r\n\t\t\te.layerX = 0;\r\n\t\t\tnode.fireEvent( \"onclick\" );\r\n\t\t}else{\r\n\t\t\tvar e = document.createEvent('Events');\r\n\t\t\te.initEvent('click', true, true);\r\n\t\t\te.layerX = 0;\r\n\t\t\tnode.dispatchEvent(e);\r\n\t\t}\r\n\t}\r\n\tfunction _createPageIndicatorDeclaratively(widgetId) {\r\n\t\treturn registry.byId(widgetId);\r\n\t};\r\n\tfunction _createPageIndicatorProgrammatically(placeHolderId, widgetId){\r\n\t\t// Create SwapView\r\n\t\tvar r = new PageIndicator({id:widgetId, fixed:\"bottom\"});\r\n\t\trunner.assertNotEqual(null, r);\r\n\t\tdomConst.place(r.domNode, placeHolderId, \"replace\");\r\n\t\t\r\n\t\tr.startup();\r\n\t\t_initAppBars();\r\n\r\n\t\treturn r;\r\n\t};\r\n\tfunction _createPageIndicatorProgrammaticallyWithSourceNodeReference(widgetId){\r\n\t\t// Create IconContainer\r\n\t\tvar r = new PageIndicator({}, widgetId);\r\n\r\n\t\tr.startup();\r\n\t\t_initAppBars();\r\n\r\n\t\treturn r;\r\n\t};\r\n\tfunction _initAppBars(){\r\n\t\tvar view1 = registry.byId(\"dojox_mobile_SwapView_0\");\r\n\t\tview1.findAppBars();\r\n\t\tview1.resize();\r\n\r\n\t\tvar view2 = registry.byId(\"dojox_mobile_SwapView_1\");\r\n\t\tview2.findAppBars();\r\n\t\tview2.resize();\r\n\r\n\t\tvar view3 = registry.byId(\"dojox_mobile_SwapView_2\");\r\n\t\tview3.findAppBars();\r\n\t\tview3.resize();\r\n\r\n\t\tvar view4 = registry.byId(\"dojox_mobile_SwapView_3\");\r\n\t\tview4.findAppBars();\r\n\t\tview4.resize();\r\n\r\n\t\tvar view5 = registry.byId(\"dojox_mobile_SwapView_4\");\r\n\t\tview5.findAppBars();\r\n\t\tview5.resize();\r\n\t};\r\n\tfunction _assertCorrectPageIndicator(widget, col){\r\n\t\trunner.assertNotEqual(null, widget, \"IconContainer: Did not instantiate.\");\r\n\t\trunner.assertTrue(domClass.contains(widget.domNode, WIDGET_CLASSNAME1), WIDGET_CLASSNAME1);\r\n\t\trunner.assertTrue(domClass.contains(widget.domNode, WIDGET_CLASSNAME2), WIDGET_CLASSNAME2);\r\n\t\tvar r = widget._tblNode.rows[0];\r\n\t\trunner.assertEqual(WIDGET_PAGENUM, widget._tblNode.rows[0].cells.length, \"Number of page\");\r\n\t\tfor(i = 0; i < r.cells.length; i++){\r\n\t\t\tdot = r.cells[i].firstChild;\r\n\t\t\trunner.assertTrue(domClass.contains(dot, WIDGET_DOT_CLASSNAME1), WIDGET_DOT_CLASSNAME1);\r\n\t\t\tif(i+1 === col){\r\n\t\t\t\trunner.assertTrue(domClass.contains(dot, WIDGET_DOT_CLASSNAME2), WIDGET_DOT_CLASSNAME2);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tready(function(){\r\n\t\tif(WIDGET_PROGRAMMATICALLY === 1){\r\n\t\t\t_createPageIndicatorProgrammatically(\"dojox_mobile_PageIndicator_0Place\", \"dojox_mobile_PageIndicator_0\");\r\n\t\t}else if(WIDGET_PROGRAMMATICALLY === 2){\r\n\t\t\t_createPageIndicatorProgrammaticallyWithSourceNodeReference(\"dojox_mobile_PageIndicator_0\");\r\n\t\t}\r\n\r\n\t\trunner.register(\"dojox.mobile.test.doh.PageIndicator\", [\r\n\t\t\t{\r\n\t\t\t\tname: \"PageIndicator Verification1\",\r\n\t\t\t\ttimeout: 4000,\r\n\t\t\t\trunTest: function(){\r\n\r\n\t\t\t\t\tvar view1 = registry.byId(\"dojox_mobile_SwapView_0\");\r\n\t\t\t\t\tvar view2 = registry.byId(\"dojox_mobile_SwapView_1\");\r\n\t\t\t\t\tvar widget1 = registry.byId(\"dojox_mobile_PageIndicator_0\");\r\n\r\n\t\t\t\t\tvar d = new runner.Deferred();\r\n\t\t\t\t\tsetTimeout(d.getTestCallback(function(){\r\n\t\t\t\t\t\t_assertCorrectPageIndicator(widget1, 1);\r\n\t\t\t\t\t\tview1.goTo(1);\r\n\t\t\t\t\t}), timeoutInterval);\r\n\t\t\t\t\treturn d;\r\n\t\t\t\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"PageIndicator Verification2\",\r\n\t\t\t\ttimeout: 4000,\r\n\t\t\t\trunTest: function(){\r\n\t\t\t\t\tvar view2 = registry.byId(\"dojox_mobile_SwapView_1\");\r\n\t\t\t\t\tvar d = new runner.Deferred();\r\n\t\t\t\t\tsetTimeout(d.getTestCallback(function(){\r\n\t\t\t\t\t\tvar widget1 = registry.byId(\"dojox_mobile_PageIndicator_0\");\r\n\t\t\t\t\t\t_assertCorrectPageIndicator(widget1, 2);\r\n\t\t\t\t\t\tview2.goTo(1);\r\n\t\t\t\t\t}), timeoutInterval);\r\n\t\t\t\t\treturn d;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"PageIndicator Verification3\",\r\n\t\t\t\ttimeout: 4000,\r\n\t\t\t\trunTest: function(){\r\n\t\t\t\t\tvar d = new runner.Deferred();\r\n\t\t\t\t\tsetTimeout(d.getTestCallback(function(){\r\n\t\t\t\t\t\tvar widget1 = registry.byId(\"dojox_mobile_PageIndicator_0\");\r\n\t\t\t\t\t\t_assertCorrectPageIndicator(widget1, 3);\r\n\t\t\t\t\t\tfireOnClick(widget1.domNode);\r\n\t\t\t\t\t}), timeoutInterval);\r\n\t\t\t\t\treturn d;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"PageIndicator Verification4\",\r\n\t\t\t\ttimeout: 4000,\r\n\t\t\t\trunTest: function(){\r\n\t\t\t\t\tvar d = new runner.Deferred();\r\n\t\t\t\t\tsetTimeout(d.getTestCallback(function(){\r\n\t\t\t\t\t\tvar widget1 = registry.byId(\"dojox_mobile_PageIndicator_0\");\r\n\t\t\t\t\t\t_assertCorrectPageIndicator(widget1, 2);\r\n\t\t\t\t\t}), timeoutInterval);\r\n\t\t\t\t\treturn d;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"PageIndicator Verification5\",\r\n\t\t\t\ttimeout: 3000,\r\n\t\t\t\trunTest: function(){\r\n\t\t\t\t\t// Test case for #15064: destroy right after startup()\r\n\t\t\t\t\tvar widget = new PageIndicator();\r\n\t\t\t\t\tvar d = new runner.Deferred();\r\n\t\t\t\t\tvar errorCounter = 0;\r\n\t\t\t\t\tvar errorMsg;\r\n\t\t\t\t\t// Before the fix of #15064, there used to be an error thrown when destroying \r\n\t\t\t\t\t// right after startup(). To test it, we cannot use a simple try-catch, because\r\n\t\t\t\t\t// this is about an error thrown by the setTimeout function which used to be set \r\n\t\t\t\t\t// PageIndicator's startup(). Hence:\r\n\t\t\t\t\twindow.onerror = function(msg, url, lineNumber){\r\n\t\t\t\t\t\terrorCounter++;\r\n\t\t\t\t\t\terrorMsg = \"After destroy: \" + msg + \"\\nURL: \" + url + \r\n\t\t\t\t\t\t\t\"\\nLine number: \" + lineNumber;\r\n\t\t\t\t\t\tconsole.log(errorMsg);\r\n\t\t\t\t\t};\r\n\t\t\t\t\twidget.startup();\r\n\t\t\t\t\twidget.destroyRecursive(false/*preserveDom*/);\r\n\t\t\t\t\t// Check that no error has been thrown\r\n\t\t\t\t\tsetTimeout(d.getTestCallback(function(){\r\n\t\t\t\t\t\trunner.assertEqual(0, errorCounter, errorMsg);\r\n\t\t\t\t\t}), 2000); // smaller than the total timeout of the test case\r\n\t\t\t\t\t\t\r\n\t\t\t\t\treturn d;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t]);\r\n\t\trunner.run();\r\n\t});\r\n})\r\n"]}