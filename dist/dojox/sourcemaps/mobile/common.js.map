{"version":3,"sources":["mobile/common.js"],"names":["define","array","config","connect","lang","win","kernel","dom","domClass","domConstruct","domReady","ready","touch","registry","has","dm","getObject","doc","dojoClick","add","_sendClick","target","e","node","parentNode","ev","createEvent","initMouseEvent","global","screenX","screenY","clientX","clientY","dispatchEvent","getScreenSize","h","innerHeight","documentElement","clientHeight","w","innerWidth","clientWidth","updateOrient","dim","replace","tabletSize","detectScreenSize","force","from","to","sz","Math","min","this","_sz","publish","hideAddressBarWait","mblHideAddressBarWait","hide_1","scrollTo","_hidingTimer","setTimeout","isAddressBarHidden","resizeAll","_hiding","hideAddressBar","evt","disableHideAddressBar","minH","screen","availHeight","outerHeight","devicePixelRatio","style","overflow","body","offsetHeight","minHeight","_resetMinHeight","pageYOffset","root","disableResizeAll","isTopLevel","parent","getParent","resize","resizeRecursively","forEach","getChildren","child","filter","toArray","openWindow","url","open","_detectWindowsTheme","navigator","userAgent","match","create","innerHTML","head","setWindowsTheme","experimental","windows","undefined","i","j","check","href","indexOf","s","styleSheets","length","r","cssRules","imports","elems","getElementsByTagName","mblApplyPageStyles","_no_dojo_dm","_dm","deviceTheme","setDm","mblAndroidWorkaround","mblAndroid3Workaround","setSelectable","selectable","nodes","byId","removeAttribute","setAttribute","tagName","toggle","mblAndroidWorkaroundButtonStyle","f","isHidingPossible","appVersion","mblHideAddressBar","mblForceHideAddressBar","mblAlwaysHideAddressBar","ios6","onorientationchange","curSize","curClientWidth","curClientHeight","_f","_conn","disconnect","newClientWidth","newClientHeight","newSize","abs","visibility"],"mappings":"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","file":"../../mobile/common.js","sourcesContent":["define([\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/config\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/_base/kernel\",\r\n\t\"dojo/dom\",\r\n\t\"dojo/dom-class\",\r\n\t\"dojo/dom-construct\",\r\n\t\"dojo/domReady\",\r\n\t\"dojo/ready\",\r\n\t\"dojo/touch\",\r\n\t\"dijit/registry\",\r\n\t\"./sniff\",\r\n\t\"./uacss\" // (no direct references)\r\n], function(array, config, connect, lang, win, kernel, dom, domClass, domConstruct, domReady, ready, touch, registry, has){\r\n\r\n\t// module:\r\n\t//\t\tdojox/mobile/common\r\n\r\n\tvar dm = lang.getObject(\"dojox.mobile\", true);\r\n\r\n\t// tell dojo/touch to generate synthetic clicks immediately\r\n\t// and regardless of preventDefault() calls on touch events\r\n\twin.doc.dojoClick = true;\r\n\t/// ... but let user disable this by removing dojoClick from the document\r\n\tif(has(\"touch\")){\r\n\t\t// Do we need to send synthetic clicks when preventDefault() is called on touch events?\r\n\t\t// This is normally true on anything except Android 4.1+ and IE10+, but users reported\r\n\t\t// exceptions like Galaxy Note 2. So let's use a has(\"clicks-prevented\") flag, and let\r\n\t\t// applications override it through data-dojo-config=\"has:{'clicks-prevented':true}\" if needed.\r\n\t\thas.add(\"clicks-prevented\", !(has(\"android\") >= 4.1 || (has(\"ie\") === 10) || (!has(\"ie\") && has(\"trident\") > 6)));\r\n\t\tif(has(\"clicks-prevented\")){\r\n\t\t\tdm._sendClick = function(target, e){\r\n\t\t\t\t// dojo/touch will send a click if dojoClick is set, so don't do it again.\r\n\t\t\t\tfor(var node = target; node; node = node.parentNode){\r\n\t\t\t\t\tif(node.dojoClick){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar ev = win.doc.createEvent(\"MouseEvents\"); \r\n\t\t\t\tev.initMouseEvent(\"click\", true, true, win.global, 1, e.screenX, e.screenY, e.clientX, e.clientY); \r\n\t\t\t\ttarget.dispatchEvent(ev);\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tdm.getScreenSize = function(){\r\n\t\t// summary:\r\n\t\t//\t\tReturns the dimensions of the browser window.\r\n\t\treturn {\r\n\t\t\th: win.global.innerHeight || win.doc.documentElement.clientHeight,\r\n\t\t\tw: win.global.innerWidth || win.doc.documentElement.clientWidth\r\n\t\t};\r\n\t};\r\n\r\n\tdm.updateOrient = function(){\r\n\t\t// summary:\r\n\t\t//\t\tUpdates the orientation specific CSS classes, 'dj_portrait' and\r\n\t\t//\t\t'dj_landscape'.\r\n\t\tvar dim = dm.getScreenSize();\r\n\t\tdomClass.replace(win.doc.documentElement,\r\n\t\t\t\t  dim.h > dim.w ? \"dj_portrait\" : \"dj_landscape\",\r\n\t\t\t\t  dim.h > dim.w ? \"dj_landscape\" : \"dj_portrait\");\r\n\t};\r\n\tdm.updateOrient();\r\n\r\n\tdm.tabletSize = 500;\r\n\tdm.detectScreenSize = function(/*Boolean?*/force){\r\n\t\t// summary:\r\n\t\t//\t\tDetects the screen size and determines if the screen is like\r\n\t\t//\t\tphone or like tablet. If the result is changed,\r\n\t\t//\t\tit sets either of the following css class to `<html>`:\r\n\t\t//\r\n\t\t//\t\t- 'dj_phone'\r\n\t\t//\t\t- 'dj_tablet'\r\n\t\t//\r\n\t\t//\t\tand it publishes either of the following events:\r\n\t\t//\r\n\t\t//\t\t- '/dojox/mobile/screenSize/phone'\r\n\t\t//\t\t- '/dojox/mobile/screenSize/tablet'\r\n\r\n\t\tvar dim = dm.getScreenSize();\r\n\t\tvar sz = Math.min(dim.w, dim.h);\r\n\t\tvar from, to;\r\n\t\tif(sz >= dm.tabletSize && (force || (!this._sz || this._sz < dm.tabletSize))){\r\n\t\t\tfrom = \"phone\";\r\n\t\t\tto = \"tablet\";\r\n\t\t}else if(sz < dm.tabletSize && (force || (!this._sz || this._sz >= dm.tabletSize))){\r\n\t\t\tfrom = \"tablet\";\r\n\t\t\tto = \"phone\";\r\n\t\t}\r\n\t\tif(to){\r\n\t\t\tdomClass.replace(win.doc.documentElement, \"dj_\"+to, \"dj_\"+from);\r\n\t\t\tconnect.publish(\"/dojox/mobile/screenSize/\"+to, [dim]);\r\n\t\t}\r\n\t\tthis._sz = sz;\r\n\t};\r\n\tdm.detectScreenSize();\r\n\r\n\t// dojox/mobile.hideAddressBarWait: Number\r\n\t//\t\tThe time in milliseconds to wait before the fail-safe hiding address\r\n\t//\t\tbar runs. The value must be larger than 800.\r\n\tdm.hideAddressBarWait = typeof(config.mblHideAddressBarWait) === \"number\" ?\r\n\t\tconfig.mblHideAddressBarWait : 1500;\r\n\r\n\tdm.hide_1 = function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal function to hide the address bar.\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\tscrollTo(0, 1);\r\n\t\tdm._hidingTimer = (dm._hidingTimer == 0) ? 200 : dm._hidingTimer * 2;\r\n\t\tsetTimeout(function(){ // wait for a while for \"scrollTo\" to finish\r\n\t\t\tif(dm.isAddressBarHidden() || dm._hidingTimer > dm.hideAddressBarWait){\r\n\t\t\t\t// Succeeded to hide address bar, or failed but timed out \r\n\t\t\t\tdm.resizeAll();\r\n\t\t\t\tdm._hiding = false;\r\n\t\t\t}else{\r\n\t\t\t\t// Failed to hide address bar, so retry after a while\r\n\t\t\t\tsetTimeout(dm.hide_1, dm._hidingTimer);\r\n\t\t\t}\r\n\t\t}, 50); //50ms is an experiential value\r\n\t};\r\n\r\n\tdm.hideAddressBar = function(/*Event?*/evt){\r\n\t\t// summary:\r\n\t\t//\t\tHides the address bar.\r\n\t\t// description:\r\n\t\t//\t\tTries to hide the address bar a couple of times. The purpose is to do \r\n\t\t//\t\tit as quick as possible while ensuring the resize is done after the hiding\r\n\t\t//\t\tfinishes.\r\n\t\tif(dm.disableHideAddressBar || dm._hiding){ return; }\r\n\t\tdm._hiding = true;\r\n\t\tdm._hidingTimer = has(\"ios\") ? 200 : 0; // Need to wait longer in case of iPhone\r\n\t\tvar minH = screen.availHeight;\r\n\t\tif(has('android')){\r\n\t\t\tminH = outerHeight / devicePixelRatio;\r\n\t\t\t// On some Android devices such as Galaxy SII, minH might be 0 at this time.\r\n\t\t\t// In that case, retry again after a while. (200ms is an experiential value)\r\n\t\t\tif(minH == 0){\r\n\t\t\t\tdm._hiding = false;\r\n\t\t\t\tsetTimeout(function(){ dm.hideAddressBar(); }, 200);\r\n\t\t\t}\r\n\t\t\t// On some Android devices such as HTC EVO, \"outerHeight/devicePixelRatio\"\r\n\t\t\t// is too short to hide address bar, so make it high enough\r\n\t\t\tif(minH <= innerHeight){ minH = outerHeight; }\r\n\t\t\t// On Android 2.2/2.3, hiding address bar fails when \"overflow:hidden\" style is\r\n\t\t\t// applied to html/body element, so force \"overflow:visible\" style\r\n\t\t\tif(has('android') < 3){\r\n\t\t\t\twin.doc.documentElement.style.overflow = win.body().style.overflow = \"visible\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(win.body().offsetHeight < minH){ // to ensure enough height for scrollTo to work\r\n\t\t\twin.body().style.minHeight = minH + \"px\";\r\n\t\t\tdm._resetMinHeight = true;\r\n\t\t}\r\n\t\tsetTimeout(dm.hide_1, dm._hidingTimer);\r\n\t};\r\n\r\n\tdm.isAddressBarHidden = function(){\r\n\t\treturn pageYOffset === 1;\r\n\t};\r\n\r\n\tdm.resizeAll = function(/*Event?*/evt, /*Widget?*/root){\r\n\t\t// summary:\r\n\t\t//\t\tCalls the resize() method of all the top level resizable widgets.\r\n\t\t// description:\r\n\t\t//\t\tFinds all widgets that do not have a parent or the parent does not\r\n\t\t//\t\thave the resize() method, and calls resize() for them.\r\n\t\t//\t\tIf a widget has a parent that has resize(), calling widget's\r\n\t\t//\t\tresize() is its parent's responsibility.\r\n\t\t// evt:\r\n\t\t//\t\tNative event object\r\n\t\t// root:\r\n\t\t//\t\tIf specified, searches the specified widget recursively for top-level\r\n\t\t//\t\tresizable widgets.\r\n\t\t//\t\troot.resize() is always called regardless of whether root is a\r\n\t\t//\t\ttop level widget or not.\r\n\t\t//\t\tIf omitted, searches the entire page.\r\n\t\tif(dm.disableResizeAll){ return; }\r\n\t\tconnect.publish(\"/dojox/mobile/resizeAll\", [evt, root]); // back compat\r\n\t\tconnect.publish(\"/dojox/mobile/beforeResizeAll\", [evt, root]);\r\n\t\tif(dm._resetMinHeight){\r\n\t\t\twin.body().style.minHeight = dm.getScreenSize().h + \"px\";\r\n\t\t} \r\n\t\tdm.updateOrient();\r\n\t\tdm.detectScreenSize();\r\n\t\tvar isTopLevel = function(w){\r\n\t\t\tvar parent = w.getParent && w.getParent();\r\n\t\t\treturn !!((!parent || !parent.resize) && w.resize);\r\n\t\t};\r\n\t\tvar resizeRecursively = function(w){\r\n\t\t\tarray.forEach(w.getChildren(), function(child){\r\n\t\t\t\tif(isTopLevel(child)){ child.resize(); }\r\n\t\t\t\tresizeRecursively(child);\r\n\t\t\t});\r\n\t\t};\r\n\t\tif(root){\r\n\t\t\tif(root.resize){ root.resize(); }\r\n\t\t\tresizeRecursively(root);\r\n\t\t}else{\r\n\t\t\tarray.forEach(array.filter(registry.toArray(), isTopLevel),\r\n\t\t\t\t\tfunction(w){ w.resize(); });\r\n\t\t}\r\n\t\tconnect.publish(\"/dojox/mobile/afterResizeAll\", [evt, root]);\r\n\t};\r\n\r\n\tdm.openWindow = function(url, target){\r\n\t\t// summary:\r\n\t\t//\t\tOpens a new browser window with the given URL.\r\n\t\twin.global.open(url, target || \"_blank\");\r\n\t};\r\n\r\n\tdm._detectWindowsTheme = function(){\r\n\t\t// summary:\r\n\t\t//\t\tDetects if the \"windows\" theme is used,\r\n\t\t//\t\tif it is used, set has(\"windows-theme\") and\r\n\t\t//\t\tadd the .windows_theme class on the document.\r\n\t\t\r\n\t\t// Avoid unwanted (un)zoom on some WP8 devices (at least Nokia Lumia 920) \r\n\t\tif(navigator.userAgent.match(/IEMobile\\/10\\.0/)){\r\n\t\t\tdomConstruct.create(\"style\", \r\n\t\t\t\t{innerHTML: \"@-ms-viewport {width: auto !important}\"}, win.doc.head);\r\n\t\t}\r\n\r\n\t\tvar setWindowsTheme = function(){\r\n\t\t\tdomClass.add(win.doc.documentElement, \"windows_theme\");\r\n\t\t\tkernel.experimental(\"Dojo Mobile Windows theme\", \"Behavior and appearance of the Windows theme are experimental.\");\r\n\t\t};\r\n\r\n\t\t// First see if the \"windows-theme\" feature has already been set explicitly\r\n\t\t// in that case skip aut-detect\r\n\t\tvar windows = has(\"windows-theme\");\r\n\t\tif(windows !== undefined){\r\n\t\t\tif(windows){\r\n\t\t\t\tsetWindowsTheme();\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// check css\r\n\t\tvar i, j;\r\n\r\n\t\tvar check = function(href){\r\n\t\t\t// TODO: find a better regexp to match?\r\n\t\t\tif(href && href.indexOf(\"/windows/\") !== -1){\r\n\t\t\t\thas.add(\"windows-theme\", true);\r\n\t\t\t\tsetWindowsTheme();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t// collect @import\r\n\t\tvar s = win.doc.styleSheets;\r\n\t\tfor(i = 0; i < s.length; i++){\r\n\t\t\tif(s[i].href){ continue; }\r\n\t\t\tvar r = s[i].cssRules || s[i].imports;\r\n\t\t\tif(!r){ continue; }\r\n\t\t\tfor(j = 0; j < r.length; j++){\r\n\t\t\t\tif(check(r[j].href)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// collect <link>\r\n\t\tvar elems = win.doc.getElementsByTagName(\"link\");\r\n\t\tfor(i = 0; i < elems.length; i++){\r\n\t\t\tif(check(elems[i].href)){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tif(config.mblApplyPageStyles !== false){\r\n\t\tdomClass.add(win.doc.documentElement, \"mobile\");\r\n\t}\r\n\tif(has('chrome')){\r\n\t\t// dojox/mobile does not load uacss (only _compat does), but we need dj_chrome.\r\n\t\tdomClass.add(win.doc.documentElement, \"dj_chrome\");\r\n\t}\r\n\r\n\tif(win.global._no_dojo_dm){\r\n\t\t// deviceTheme seems to be loaded from a script tag (= non-dojo usage)\r\n\t\tvar _dm = win.global._no_dojo_dm;\r\n\t\tfor(var i in _dm){\r\n\t\t\tdm[i] = _dm[i];\r\n\t\t}\r\n\t\tdm.deviceTheme.setDm(dm);\r\n\t}\r\n\r\n\t// flag for Android transition animation flicker workaround\r\n\thas.add('mblAndroidWorkaround', \r\n\t\t\tconfig.mblAndroidWorkaround !== false && has('android') < 3, undefined, true);\r\n\thas.add('mblAndroid3Workaround', \r\n\t\t\tconfig.mblAndroid3Workaround !== false && has('android') >= 3, undefined, true);\r\n\r\n\tdm._detectWindowsTheme();\r\n\r\n\tdm.setSelectable = function(/*Node*/node, /*Boolean*/selectable){\r\n\t\tvar nodes, i;\r\n\t\tnode = dom.byId(node);\r\n\t\tif (has(\"ie\") <= 9){\r\n\t\t\t// (IE < 10) Fall back to setting/removing the\r\n\t\t\t// unselectable attribute on the element and all its children\r\n\t\t\t// except the input element (see https://bugs.dojotoolkit.org/ticket/13846)\r\n\t\t\tnodes = node.getElementsByTagName(\"*\");\r\n\t\t\ti = nodes.length;\r\n\t\t\tif(selectable){\r\n\t\t\t\tnode.removeAttribute(\"unselectable\");\r\n\t\t\t\twhile(i--){\r\n\t\t\t\t\tnodes[i].removeAttribute(\"unselectable\");\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tnode.setAttribute(\"unselectable\", \"on\");\r\n\t\t\t\twhile(i--){\r\n\t\t\t\t\tif (nodes[i].tagName !== \"INPUT\"){\r\n\t\t\t\t\t\tnodes[i].setAttribute(\"unselectable\", \"on\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tdomClass.toggle(node, \"unselectable\", !selectable);\r\n\t\t}\r\n\t};\r\n\r\n\t// Set the background style using dojo/domReady, not dojo/ready, to ensure it is already\r\n\t// set at widget initialization time. (#17418) \r\n\tdomReady(function(){\r\n\t\tdomClass.add(win.body(), \"mblBackground\");\r\n\t});\r\n\r\n\tready(function(){\r\n\t\tdm.detectScreenSize(true);\r\n\t\tif(config.mblAndroidWorkaroundButtonStyle !== false && has('android')){\r\n\t\t\t// workaround for the form button disappearing issue on Android 2.2-4.0\r\n\t\t\tdomConstruct.create(\"style\", {innerHTML:\"BUTTON,INPUT[type='button'],INPUT[type='submit'],INPUT[type='reset'],INPUT[type='file']::-webkit-file-upload-button{-webkit-appearance:none;} audio::-webkit-media-controls-play-button,video::-webkit-media-controls-play-button{-webkit-appearance:media-play-button;} video::-webkit-media-controls-fullscreen-button{-webkit-appearance:media-fullscreen-button;}\"}, win.doc.head, \"first\");\r\n\t\t}\r\n\t\tif(has('mblAndroidWorkaround')){\r\n\t\t\t// add a css class to show view offscreen for android flicker workaround\r\n\t\t\tdomConstruct.create(\"style\", {innerHTML:\".mblView.mblAndroidWorkaround{position:absolute;top:-9999px !important;left:-9999px !important;}\"}, win.doc.head, \"last\");\r\n\t\t}\r\n\r\n\t\tvar f = dm.resizeAll;\r\n\t\t// Address bar hiding\r\n\t\tvar isHidingPossible =\r\n\t\t\tnavigator.appVersion.indexOf(\"Mobile\") != -1 && // only mobile browsers\r\n\t\t\t// #17455: hiding Safari's address bar works in iOS < 7 but this is \r\n\t\t\t// no longer possible since iOS 7. Hence, exclude iOS 7 and later: \r\n\t\t\t!(has(\"ios\") >= 7);\r\n\t\t// You can disable the hiding of the address bar with the following dojoConfig:\r\n\t\t// var dojoConfig = { mblHideAddressBar: false };\r\n\t\t// If unspecified, the flag defaults to true.\r\n\t\tif((config.mblHideAddressBar !== false && isHidingPossible) ||\r\n\t\t\tconfig.mblForceHideAddressBar === true){\r\n\t\t\tdm.hideAddressBar();\r\n\t\t\tif(config.mblAlwaysHideAddressBar === true){\r\n\t\t\t\tf = dm.hideAddressBar;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar ios6 = has(\"ios\") >= 6; // Full-screen support for iOS6 or later\r\n\t\tif((has('android') || ios6) && win.global.onorientationchange !== undefined){\r\n\t\t\tvar _f = f;\r\n\t\t\tvar curSize, curClientWidth, curClientHeight;\r\n\t\t\tif(ios6){\r\n\t\t\t\tcurClientWidth = win.doc.documentElement.clientWidth;\r\n\t\t\t\tcurClientHeight = win.doc.documentElement.clientHeight;\r\n\t\t\t}else{ // Android\r\n\t\t\t\t// Call resize for the first resize event after orientationchange\r\n\t\t\t\t// because the size information may not yet be up to date when the \r\n\t\t\t\t// event orientationchange occurs.\r\n\t\t\t\tf = function(evt){\r\n\t\t\t\t\tvar _conn = connect.connect(null, \"onresize\", null, function(e){\r\n\t\t\t\t\t\tconnect.disconnect(_conn);\r\n\t\t\t\t\t\t_f(e);\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\tcurSize = dm.getScreenSize();\r\n\t\t\t};\r\n\t\t\t// Android: Watch for resize events when the virtual keyboard is shown/hidden.\r\n\t\t\t// The heuristic to detect this is that the screen width does not change\r\n\t\t\t// and the height changes by more than 100 pixels.\r\n\t\t\t//\r\n\t\t\t// iOS >= 6: Watch for resize events when entering or existing the new iOS6 \r\n\t\t\t// full-screen mode. The heuristic to detect this is that clientWidth does not\r\n\t\t\t// change while the clientHeight does change.\r\n\t\t\tconnect.connect(null, \"onresize\", null, function(e){\r\n\t\t\t\tif(ios6){\r\n\t\t\t\t\tvar newClientWidth = win.doc.documentElement.clientWidth,\r\n\t\t\t\t\t\tnewClientHeight = win.doc.documentElement.clientHeight;\r\n\t\t\t\t\tif(newClientWidth == curClientWidth && newClientHeight != curClientHeight){\r\n\t\t\t\t\t\t// full-screen mode has been entered/exited (iOS6)\r\n\t\t\t\t\t\t_f(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurClientWidth = newClientWidth;\r\n\t\t\t\t\tcurClientHeight = newClientHeight;\r\n\t\t\t\t}else{ // Android\r\n\t\t\t\t\tvar newSize = dm.getScreenSize();\r\n\t\t\t\t\tif(newSize.w == curSize.w && Math.abs(newSize.h - curSize.h) >= 100){\r\n\t\t\t\t\t\t// keyboard has been shown/hidden (Android)\r\n\t\t\t\t\t\t_f(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurSize = newSize;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tconnect.connect(null, win.global.onorientationchange !== undefined\r\n\t\t\t? \"onorientationchange\" : \"onresize\", null, f);\r\n\t\twin.body().style.visibility = \"visible\";\r\n\t});\r\n\r\n\t// TODO: return functions declared above in this hash, rather than\r\n\t// dojox.mobile.\r\n\r\n\t/*=====\r\n\treturn {\r\n\t\t// summary:\r\n\t\t//\t\tA common module for dojox/mobile.\r\n\t\t// description:\r\n\t\t//\t\tThis module includes common utility functions that are used by\r\n\t\t//\t\tdojox/mobile widgets. Also, it provides functions that are commonly\r\n\t\t//\t\tnecessary for mobile web applications, such as the hide address bar\r\n\t\t//\t\tfunction.\r\n\t};\r\n\t=====*/\r\n\treturn dm;\r\n});\r\n"]}