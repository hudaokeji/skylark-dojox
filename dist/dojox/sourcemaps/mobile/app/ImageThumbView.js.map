{"version":3,"sources":["mobile/app/ImageThumbView.js"],"names":["dojo","provide","experimental","require","declare","dijit","_WidgetBase","items","urlParam","labelParam","itemTemplate","minPadding","maxPerRow","maxRows","baseClass","thumbSize","animationEnabled","selectedIndex","cache","cacheMustMatch","clickEvent","cacheBust","disableHide","constructor","params","node","postCreate","this","inherited","arguments","_this","addThumb","hitch","handleImgLoad","hideCached","_onLoadImages","visibleImages","_cacheCounter","connect","domNode","event","itemNode","_getItemNodeFromEvent","_cached","onSelect","_item","_index","query","removeClass","addClass","resize","render","item","index","_setAnimationEnabledAttr","value","_setItemsAttr","i","urls","length","clearedUrls","url","_conn","disconnect","src","push","_getItemNode","hasClass","parentNode","touches","target","_thumbSize","_size","contentBox","style","thumb","pop","setTimeout","isString","column","row","totalThumbWidth","w","padding","totalThumbHeight","h","nodes","thumbNodes","pos","place","_loading","numRows","Math","ceil","_numRows","setContainerHeight","amount","thumbDiv","cacheHit","_url","splice","create","class","innerHTML","string","substitute","labelNode","loader","_thumbDiv","marginBox","calcPadding","img","indexOf","Date","getTime","width","thumbWidth","imgBounds","floor","x","y","-webkit-transform","destroy","counter"],"mappings":"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","file":"../../../mobile/app/ImageThumbView.js","sourcesContent":["dojo.provide(\"dojox.mobile.app.ImageThumbView\");\r\ndojo.experimental(\"dojox.mobile.app.ImageThumbView\");\r\n\r\ndojo.require(\"dijit._WidgetBase\");\r\ndojo.require(\"dojo.string\");\r\n\r\ndojo.declare(\"dojox.mobile.app.ImageThumbView\", dijit._WidgetBase, {\r\n\t// summary:\r\n\t//\t\tAn image thumbnail gallery\r\n\r\n\t// items: Array\r\n\t//\t\tThe data items from which the image urls are retrieved.\r\n\t//\t\tIf an item is a string, it is expected to be a URL. Otherwise\r\n\t//\t\tby default it is expected to have a 'url' member.  This can\r\n\t//\t\tbe configured using the 'urlParam' attribute on this widget.\r\n\titems: [],\r\n\r\n\t// urlParam: String\r\n\t//\t\tThe parameter name used to retrieve an image url from a JSON object\r\n\turlParam: \"url\",\r\n\r\n\tlabelParam: null,\r\n\r\n\titemTemplate: '<div class=\"mblThumbInner\">' +\r\n\t\t\t\t'<div class=\"mblThumbOverlay\"></div>' +\r\n\t\t\t\t'<div class=\"mblThumbMask\">' +\r\n\t\t\t\t\t'<div class=\"mblThumbSrc\" style=\"background-image:url(${url})\"></div>' +\r\n\t\t\t\t'</div>' +\r\n\t\t\t'</div>',\r\n\r\n\tminPadding: 4,\r\n\r\n\tmaxPerRow: 3,\r\n\r\n\tmaxRows: -1,\r\n\r\n\tbaseClass: \"mblImageThumbView\",\r\n\r\n\tthumbSize: \"medium\",\r\n\r\n\tanimationEnabled: true,\r\n\r\n\tselectedIndex: -1,\r\n\r\n\tcache: null,\r\n\r\n\tcacheMustMatch: false,\r\n\r\n\tclickEvent: \"onclick\",\r\n\r\n\tcacheBust: false,\r\n\r\n\tdisableHide: false,\r\n\r\n\tconstructor: function(params, node){\r\n\t},\r\n\r\n\tpostCreate: function(){\r\n\r\n\t\tthis.inherited(arguments);\r\n\t\tvar _this = this;\r\n\r\n\t\tvar hoverCls = \"mblThumbHover\";\r\n\r\n\t\tthis.addThumb = dojo.hitch(this, this.addThumb);\r\n\t\tthis.handleImgLoad = dojo.hitch(this, this.handleImgLoad);\r\n\t\tthis.hideCached = dojo.hitch(this, this.hideCached);\r\n\r\n\t\tthis._onLoadImages = {};\r\n\r\n\t\tthis.cache = [];\r\n\t\tthis.visibleImages = [];\r\n\r\n\t\tthis._cacheCounter = 0;\r\n\r\n\t\tthis.connect(this.domNode, this.clickEvent, function(event){\r\n\t\t\tvar itemNode = _this._getItemNodeFromEvent(event);\r\n\r\n\t\t\tif(itemNode && !itemNode._cached){\r\n\t\t\t\t_this.onSelect(itemNode._item, itemNode._index, _this.items);\r\n\t\t\t\tdojo.query(\".selected\", this.domNode).removeClass(\"selected\");\r\n\t\t\t\tdojo.addClass(itemNode, \"selected\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdojo.addClass(this.domNode, this.thumbSize);\r\n\r\n\t\tthis.resize();\r\n\t\tthis.render();\r\n\t},\r\n\r\n\tonSelect: function(item, index, items){\r\n\t\t// summary:\r\n\t\t//\t\tDummy function that is triggered when an image is selected.\r\n\t},\r\n\r\n\t_setAnimationEnabledAttr: function(value){\r\n\t\tthis.animationEnabled = value;\r\n\t\tdojo[value ? \"addClass\" : \"removeClass\"](this.domNode, \"animated\");\r\n\t},\r\n\r\n\t_setItemsAttr: function(items){\r\n\t\tthis.items = items || [];\r\n\r\n\t\tvar urls = {};\r\n\t\tvar i;\r\n\t\tfor(i = 0; i < this.items.length; i++){\r\n\t\t\turls[this.items[i][this.urlParam]] = 1;\r\n\t\t}\r\n\r\n\t\tvar clearedUrls = [];\r\n\t\tfor(var url in this._onLoadImages){\r\n\t\t\tif(!urls[url] && this._onLoadImages[url]._conn){\r\n\t\t\t\tdojo.disconnect(this._onLoadImages[url]._conn);\r\n\t\t\t\tthis._onLoadImages[url].src = null;\r\n\t\t\t\tclearedUrls.push(url);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(i = 0; i < clearedUrls.length; i++){\r\n\t\t\tdelete this._onLoadImages[url];\r\n\t\t}\r\n\r\n\t\tthis.render();\r\n\t},\r\n\r\n\t_getItemNode: function(node){\r\n\t\twhile(node && !dojo.hasClass(node, \"mblThumb\") && node != this.domNode){\r\n\t\t\tnode = node.parentNode;\r\n\t\t}\r\n\r\n\t\treturn (node == this.domNode) ? null : node;\r\n\t},\r\n\r\n\t_getItemNodeFromEvent: function(event){\r\n\t\tif(event.touches && event.touches.length > 0){\r\n\t\t\tevent = event.touches[0];\r\n\t\t}\r\n\t\treturn this._getItemNode(event.target);\r\n\t},\r\n\r\n\tresize: function(){\r\n\t\tthis._thumbSize = null;\r\n\r\n\t\tthis._size = dojo.contentBox(this.domNode);\r\n\r\n\t\tthis.disableHide = true;\r\n\t\tthis.render();\r\n\t\tthis.disableHide = false;\r\n\t},\r\n\r\n\thideCached: function(){\r\n\t\t// summary:\r\n\t\t//\t\tHides all cached nodes, so that they're no invisible and overlaying\r\n\t\t//\t\tother screen elements.\r\n\t\tfor(var i = 0; i < this.cache.length; i++){\r\n\t\t\tif (this.cache[i]) {\r\n\t\t\t\tdojo.style(this.cache[i], \"display\", \"none\");\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\trender: function(){\r\n\t\tvar i;\r\n\t\tvar url;\r\n\t\tvar item;\r\n\r\n\t\tvar thumb;\r\n\t\twhile(this.visibleImages && this.visibleImages.length > 0){\r\n\t\t\tthumb = this.visibleImages.pop();\r\n\t\t\tthis.cache.push(thumb);\r\n\r\n\t\t\tif (!this.disableHide) {\r\n\t\t\t\tdojo.addClass(thumb, \"hidden\");\r\n\t\t\t}\r\n\t\t\tthumb._cached = true;\r\n\t\t}\r\n\r\n\t\tif(this.cache && this.cache.length > 0){\r\n\t\t\tsetTimeout(this.hideCached, 1000);\r\n\t\t}\r\n\r\n\t\tif(!this.items || this.items.length == 0){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor(i = 0; i < this.items.length; i++){\r\n\t\t\titem = this.items[i];\r\n\t\t\turl = (dojo.isString(item) ? item : item[this.urlParam]);\r\n\r\n\t\t\tthis.addThumb(item, url, i);\r\n\r\n\t\t\tif(this.maxRows > 0 && (i + 1) / this.maxPerRow >= this.maxRows){\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(!this._thumbSize){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar column = 0;\r\n\t\tvar row = -1;\r\n\r\n\t\tvar totalThumbWidth = this._thumbSize.w + (this.padding * 2);\r\n\t\tvar totalThumbHeight = this._thumbSize.h + (this.padding * 2);\r\n\r\n\t\tvar nodes = this.thumbNodes =\r\n\t\t\tdojo.query(\".mblThumb\", this.domNode);\r\n\r\n\t\tvar pos = 0;\r\n\t\tnodes = this.visibleImages;\r\n\t\tfor(i = 0; i < nodes.length; i++){\r\n\t\t\tif(nodes[i]._cached){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(pos % this.maxPerRow == 0){\r\n\t\t\t\trow ++;\r\n\t\t\t}\r\n\t\t\tcolumn = pos % this.maxPerRow;\r\n\r\n\t\t\tthis.place(\r\n\t\t\t\tnodes[i],\r\n\t\t\t\t(column * totalThumbWidth) + this.padding,\t// x position\r\n\t\t\t\t(row * totalThumbHeight) + this.padding\t\t// y position\r\n\t\t\t);\r\n\r\n\t\t\tif(!nodes[i]._loading){\r\n\t\t\t\tdojo.removeClass(nodes[i], \"hidden\");\r\n\t\t\t}\r\n\r\n\t\t\tif(pos == this.selectedIndex){\r\n\t\t\t\tdojo[pos == this.selectedIndex ? \"addClass\" : \"removeClass\"]\r\n\t\t\t\t\t(nodes[i], \"selected\");\r\n\t\t\t}\r\n\t\t\tpos++;\r\n\t\t}\r\n\r\n\t\tvar numRows = Math.ceil(pos / this.maxPerRow);\r\n\r\n\t\tthis._numRows = numRows;\r\n\r\n\t\tthis.setContainerHeight((numRows * (this._thumbSize.h + this.padding * 2)));\r\n\t},\r\n\r\n\tsetContainerHeight: function(amount){\r\n\t\tdojo.style(this.domNode, \"height\", amount + \"px\");\r\n\t},\r\n\r\n\taddThumb: function(item, url, index){\r\n\r\n\t\tvar thumbDiv;\r\n\t\tvar cacheHit = false;\r\n\t\tif(this.cache.length > 0){\r\n\t\t\t// Reuse a previously created node if possible\r\n\t\t\tvar found = false;\r\n\t\t\t// Search for an image with the same url first\r\n\t\t\tfor(var i = 0; i < this.cache.length; i++){\r\n\t\t\t\tif(this.cache[i]._url == url){\r\n\t\t\t\t\tthumbDiv = this.cache.splice(i, 1)[0];\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// if no image with the same url is found, just take the last one\r\n\t\t\tif(!thumbDiv && !this.cacheMustMatch){\r\n            \tthumbDiv = this.cache.pop();\r\n\t\t\t\tdojo.removeClass(thumbDiv, \"selected\");\r\n\t\t\t} else {\r\n\t\t\t\tcacheHit = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(!thumbDiv){\r\n\r\n\t\t\t// Create a new thumb\r\n\t\t\tthumbDiv = dojo.create(\"div\", {\r\n\t\t\t\t\"class\": \"mblThumb hidden\",\r\n\t\t\t\tinnerHTML: dojo.string.substitute(this.itemTemplate, {\r\n\t\t\t\t\turl: url\r\n\t\t\t\t}, null, this)\r\n\t\t\t}, this.domNode);\r\n\t\t}\r\n\r\n\t\tif(this.labelParam) {\r\n\t\t\tvar labelNode = dojo.query(\".mblThumbLabel\", thumbDiv)[0];\r\n\t\t\tif(!labelNode) {\r\n\t\t\t\tlabelNode = dojo.create(\"div\", {\r\n\t\t\t\t\t\"class\": \"mblThumbLabel\"\r\n\t\t\t\t}, thumbDiv);\r\n\t\t\t}\r\n\t\t\tlabelNode.innerHTML = item[this.labelParam] || \"\";\r\n\t\t}\r\n\r\n\t    dojo.style(thumbDiv, \"display\", \"\");\r\n\t\tif (!this.disableHide) {\r\n\t\t\tdojo.addClass(thumbDiv, \"hidden\");\r\n\t\t}\r\n\r\n\t\tif (!cacheHit) {\r\n\t\t\tvar loader = dojo.create(\"img\", {});\r\n\t\t\tloader._thumbDiv = thumbDiv;\r\n\t\t\tloader._conn = dojo.connect(loader, \"onload\", this.handleImgLoad);\r\n\t\t\tloader._url = url;\r\n\t\t\tthumbDiv._loading = true;\r\n\r\n\t\t\tthis._onLoadImages[url] = loader;\r\n\t\t\tif (loader) {\r\n\t\t\t\tloader.src = url;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.visibleImages.push(thumbDiv);\r\n\r\n\t\tthumbDiv._index = index;\r\n\t\tthumbDiv._item = item;\r\n\t\tthumbDiv._url = url;\r\n\t\tthumbDiv._cached = false;\r\n\r\n\t\tif(!this._thumbSize){\r\n\t\t\tthis._thumbSize = dojo.marginBox(thumbDiv);\r\n\r\n\t\t\tif(this._thumbSize.h == 0){\r\n\t\t\t\tthis._thumbSize.h = 100;\r\n\t\t\t\tthis._thumbSize.w = 100;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.labelParam){\r\n\t\t\t\tthis._thumbSize.h += 8;\r\n\t\t\t}\r\n\r\n\t\t\tthis.calcPadding();\r\n\t\t}\r\n\t},\r\n\r\n\thandleImgLoad: function(event){\r\n\t\tvar img = event.target;\r\n\t\tdojo.disconnect(img._conn);\r\n\t\tdojo.removeClass(img._thumbDiv, \"hidden\");\r\n\t\timg._thumbDiv._loading = false;\r\n\t\timg._conn = null;\r\n\r\n\t\tvar url = img._url;\r\n\t\tif(this.cacheBust){\r\n\t\t\turl += (url.indexOf(\"?\") > -1 ? \"&\" : \"?\")\r\n\t\t\t\t+ \"cacheBust=\" + (new Date()).getTime() + \"_\" + (this._cacheCounter++);\r\n\t\t}\r\n\r\n\t\tdojo.query(\".mblThumbSrc\", img._thumbDiv)\r\n\t\t\t\t.style(\"backgroundImage\", \"url(\" + url + \")\");\r\n\r\n\t\tdelete this._onLoadImages[img._url];\r\n\t},\r\n\r\n\tcalcPadding: function(){\r\n\t\tvar width = this._size.w;\r\n\r\n\t\tvar thumbWidth = this._thumbSize.w;\r\n\r\n\t\tvar imgBounds = thumbWidth + this.minPadding;\r\n\r\n\t\tthis.maxPerRow = Math.floor(width / imgBounds);\r\n\r\n\t\tthis.padding = Math.floor((width - (thumbWidth * this.maxPerRow)) / (this.maxPerRow * 2));\r\n\t},\r\n\r\n\tplace: function(node, x, y){\r\n\t\tdojo.style(node, {\r\n\t\t\t\"-webkit-transform\" :\"translate(\" + x + \"px,\" + y + \"px)\"\r\n\t\t});\r\n\t},\r\n\r\n\tdestroy: function(){\r\n\t\t// Stop the loading of any more images\r\n\r\n\t\tvar img;\r\n\t\tvar counter = 0;\r\n\t\tfor (var url in this._onLoadImages){\r\n\t\t\timg = this._onLoadImages[url];\r\n\t\t\tif (img) {\r\n\t\t\t\timg.src = null;\r\n\t\t\t\tcounter++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.inherited(arguments);\r\n\t}\r\n});"]}