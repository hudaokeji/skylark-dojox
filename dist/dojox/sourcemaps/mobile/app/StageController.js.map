{"version":3,"sources":["mobile/app/StageController.js"],"names":["dojo","provide","experimental","require","declare","scenes","effect","constructor","node","this","domNode","config","mobileAnim","getActiveSceneController","length","pushScene","sceneName","params","_opInProgress","create","class","style","visibility","controller","dojox","mobile","app","SceneController","assistant","deactivate","push","_this","forEach","setZIndex","stageController","init","addCallback","activate","performTransition","idx","popScene","data","_destroyScene","splice","console","log","popScenesTo","scene","destroy","destroyRecursive"],"mappings":";;;;;;;AAAAA,KAAKC,QAAQ,oCACbD,KAAKE,aAAa,oCAElBF,KAAKG,QAAQ,oCAEbH,KAAKI,QAAQ,mCAAoC,MAIhDC,OAAQ,KAERC,OAAQ,OAERC,YAAa,SAASC,GACrBC,KAAKC,QAAUF,EACfC,KAAKJ,UAEFL,KAAKW,OAAOC,aACdH,KAAKH,OAASN,KAAKW,OAAOC,aAI5BC,yBAA0B,WACzB,OAAOJ,KAAKJ,OAAOI,KAAKJ,OAAOS,OAAS,IAGzCC,UAAW,SAASC,EAAWC,GAC9B,IAAGR,KAAKS,cAAR,CAGAT,KAAKS,eAAgB,EAGrB,IAAIV,EAAOR,KAAKmB,OAAO,OACtBC,MAAS,gBACTC,OACCC,WAAY,WAEXb,KAAKC,SAEJa,EAAa,IAAIC,MAAMC,OAAOC,IAAIC,mBAAoBnB,GAEvDC,KAAKJ,OAAOS,OAAS,GACvBL,KAAKJ,OAAOI,KAAKJ,OAAOS,OAAQ,GAAGc,UAAUC,aAG9CpB,KAAKJ,OAAOyB,KAAKP,GAEjB,IAAIQ,EAAQtB,KAEZT,KAAKgC,QAAQvB,KAAKJ,OAAQI,KAAKwB,WAE/BV,EAAWW,gBAAkBzB,KAE7Bc,EAAWY,KAAKnB,EAAWC,GAAQmB,YAAY,WAEpB,GAAvBL,EAAM1B,OAAOS,QACfS,EAAWb,QAAQW,MAAMC,WAAa,UACtCS,EAAM1B,OAAO0B,EAAM1B,OAAOS,OAAS,GAAGc,UAAUS,SAASpB,GACzDc,EAAMb,eAAgB,GAEtBa,EAAM1B,OAAO0B,EAAM1B,OAAOS,OAAS,GACjCwB,kBACAP,EAAM1B,OAAO0B,EAAM1B,OAAOS,OAAS,GAAGJ,QACtC,EACAqB,EAAMzB,OACN,KACA,WAECyB,EAAM1B,OAAO0B,EAAM1B,OAAOS,OAAS,GAAGc,UAAUS,SAASpB,GACzDc,EAAMb,eAAgB,QAM5Be,UAAW,SAASV,EAAYgB,GAC/BvC,KAAKqB,MAAME,EAAWb,QAAS,SAAU6B,EAAM,IAGhDC,SAAU,SAASC,GAGlB,IAAGhC,KAAKS,cAAR,CAIA,IAAIa,EAAQtB,KACTA,KAAKJ,OAAOS,OAAS,GAEvBL,KAAKS,eAAgB,EACrBT,KAAKJ,OAAO0B,EAAM1B,OAAOS,OAAS,GAAGc,UAAUS,SAASI,GACxDhC,KAAKJ,OAAO0B,EAAM1B,OAAOS,OAAS,GAChCwB,kBACAP,EAAM1B,OAAOI,KAAKJ,OAAOS,OAAS,GAAGJ,SACpC,EACDD,KAAKH,OACL,KACA,WAECyB,EAAMW,cAAcX,EAAM1B,OAAO0B,EAAM1B,OAAOS,OAAS,IACvDiB,EAAM1B,OAAOsC,OAAOZ,EAAM1B,OAAOS,OAAS,EAAG,GAC7CiB,EAAMb,eAAgB,KAGzB0B,QAAQC,IAAI,+CAIdC,YAAa,SAAS9B,EAAWyB,GAChC,IAAGhC,KAAKS,cAAR,CAIA,KAAMT,KAAKJ,OAAOS,OAAS,GACzBL,KAAKJ,OAAOI,KAAKJ,OAAOS,OAAS,GAAGE,WAAaA,GAClDP,KAAKiC,cAAcjC,KAAKJ,OAAOI,KAAKJ,OAAOS,OAAS,IACpDL,KAAKJ,OAAOsC,OAAOlC,KAAKJ,OAAOS,OAAS,EAAG,GAG5CL,KAAK+B,SAASC,KAGfC,cAAe,SAASK,GACvBA,EAAMnB,UAAUC,aAChBkB,EAAMnB,UAAUoB,UAChBD,EAAME","file":"../../../mobile/app/StageController.js","sourcesContent":["dojo.provide(\"dojox.mobile.app.StageController\");\r\ndojo.experimental(\"dojox.mobile.app.StageController\");\r\n\r\ndojo.require(\"dojox.mobile.app.SceneController\");\r\n\r\ndojo.declare(\"dojox.mobile.app.StageController\", null,{\r\n\r\n\t// scenes: Array\r\n\t//\t\tThe list of scenes currently in existence in the app.\r\n\tscenes: null,\r\n\r\n\teffect: \"fade\",\r\n\r\n\tconstructor: function(node){\r\n\t\tthis.domNode = node;\r\n\t\tthis.scenes = [];\r\n\r\n\t\tif(dojo.config.mobileAnim){\r\n\t\t\tthis.effect = dojo.config.mobileAnim;\r\n\t\t}\r\n\t},\r\n\r\n\tgetActiveSceneController: function(){\r\n\t\treturn this.scenes[this.scenes.length - 1];\r\n\t},\r\n\r\n\tpushScene: function(sceneName, params){\r\n\t\tif(this._opInProgress){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._opInProgress = true;\r\n\r\n\t\t// Push new scenes as the first element on the page.\r\n\t\tvar node = dojo.create(\"div\", {\r\n\t\t\t\"class\": \"scene-wrapper\",\r\n\t\t\tstyle: {\r\n\t\t\t\tvisibility: \"hidden\"\r\n\t\t\t}\r\n\t\t}, this.domNode);\r\n\r\n\t\tvar controller = new dojox.mobile.app.SceneController({}, node);\r\n\r\n\t\tif(this.scenes.length > 0){\r\n\t\t\tthis.scenes[this.scenes.length -1].assistant.deactivate();\r\n\t\t}\r\n\r\n\t\tthis.scenes.push(controller);\r\n\r\n\t\tvar _this = this;\r\n\r\n\t\tdojo.forEach(this.scenes, this.setZIndex);\r\n\r\n\t\tcontroller.stageController = this;\r\n\r\n\t\tcontroller.init(sceneName, params).addCallback(function(){\r\n\r\n\t\t\tif(_this.scenes.length == 1){\r\n\t\t\t\tcontroller.domNode.style.visibility = \"visible\";\r\n\t\t\t\t_this.scenes[_this.scenes.length - 1].assistant.activate(params);\r\n\t\t\t\t_this._opInProgress = false;\r\n\t\t\t}else{\r\n\t\t\t\t_this.scenes[_this.scenes.length - 2]\r\n\t\t\t\t\t.performTransition(\r\n\t\t\t\t\t\t_this.scenes[_this.scenes.length - 1].domNode,\r\n\t\t\t\t\t\t1,\r\n\t\t\t\t\t\t_this.effect,\r\n\t\t\t\t\t\tnull,\r\n\t\t\t\t\t\tfunction(){\r\n\t\t\t\t\t\t\t// When the scene is ready, activate it.\r\n\t\t\t\t\t\t\t_this.scenes[_this.scenes.length - 1].assistant.activate(params);\r\n\t\t\t\t\t\t\t_this._opInProgress = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tsetZIndex: function(controller, idx){\r\n\t\tdojo.style(controller.domNode, \"zIndex\", idx + 1);\r\n\t},\r\n\r\n\tpopScene: function(data){\r\n\t\t//\tperformTransition: function(/*String*/moveTo, /*Number*/dir, /*String*/transition,\r\n\t\t\t//\t\t\t\t\t\t/*Object|null*/context, /*String|Function*/method /*optional args*/){\r\n\t\tif(this._opInProgress){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar _this = this;\r\n\t\tif(this.scenes.length > 1){\r\n\r\n\t\t\tthis._opInProgress = true;\r\n\t\t\tthis.scenes[_this.scenes.length - 2].assistant.activate(data);\r\n\t\t\tthis.scenes[_this.scenes.length - 1]\r\n\t\t\t\t.performTransition(\r\n\t\t\t\t\t_this.scenes[this.scenes.length - 2].domNode,\r\n\t\t\t\t\t-1,\r\n\t\t\t\t\tthis.effect,\r\n\t\t\t\t\tnull,\r\n\t\t\t\t\tfunction(){\r\n\t\t\t\t\t\t// When the scene is no longer visible, destroy it\r\n\t\t\t\t\t\t_this._destroyScene(_this.scenes[_this.scenes.length - 1]);\r\n\t\t\t\t\t\t_this.scenes.splice(_this.scenes.length - 1, 1);\r\n\t\t\t\t\t\t_this._opInProgress = false;\r\n\t\t\t\t\t});\r\n\t\t}else{\r\n\t\t\tconsole.log(\"cannot pop the scene if there is just one\");\r\n\t\t}\r\n\t},\r\n\r\n\tpopScenesTo: function(sceneName, data){\r\n\t\tif(this._opInProgress){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twhile(this.scenes.length > 2 &&\r\n\t\t\t\tthis.scenes[this.scenes.length - 2].sceneName != sceneName){\r\n\t\t\tthis._destroyScene(this.scenes[this.scenes.length - 2]);\r\n\t\t\tthis.scenes.splice(this.scenes.length - 2, 1);\r\n\t\t}\r\n\r\n\t\tthis.popScene(data);\r\n\t},\r\n\r\n\t_destroyScene: function(scene){\r\n\t\tscene.assistant.deactivate();\r\n\t\tscene.assistant.destroy();\r\n\t\tscene.destroyRecursive();\r\n\t}\r\n\r\n\r\n});\r\n\r\n"]}