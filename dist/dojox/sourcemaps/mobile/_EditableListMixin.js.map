{"version":3,"sources":["mobile/_EditableListMixin.js"],"names":["define","array","connect","declare","event","win","domClass","domGeometry","domStyle","touch","domAttr","registry","ListItem","rightIconForEdit","deleteIconForEdit","isEditing","destroy","this","_blankItem","inherited","arguments","_setupMoveItem","node","set","width","getContentBox","w","top","offsetTop","add","_resetMoveItem","defer","remove","_onClick","e","type","keyCode","onClick","item","getEnclosingWidget","target","n","domNode","parentNode","deleteIconNode","publish","onDeleteItem","_onTouchStart","getChildren","length","_movingItem","_startIndex","getIndexOfChild","rightIconPressed","rightIconNode","ref","getNextSibling","containerNode","insertBefore","appendChild","_conn","move","doc","release","_pos","forEach","c","index","push","position","y","touchStartY","touches","pageY","_startTop","getMarginBox","t","stop","_onTouchMove","i","blank","p","getIndexInParent","style","_onTouchEnd","startIndex","endIndex","removeChild","disconnect","onMoveItem","startEdit","child","tabIndex","display","msTouchAction","_handles","press","onStartEdit","endEdit","onEndEdit","from","to"],"mappings":"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","file":"../../mobile/_EditableListMixin.js","sourcesContent":["// TODO: auto scroll?\r\n\r\ndefine([\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/dom-class\",\r\n\t\"dojo/dom-geometry\",\r\n\t\"dojo/dom-style\",\r\n\t\"dojo/touch\",\r\n\t\"dojo/dom-attr\",\r\n\t\"dijit/registry\",\r\n\t\"./ListItem\"\r\n], function(array, connect, declare, event, win, domClass, domGeometry, domStyle, touch, domAttr, registry, ListItem){\r\n\r\n\t// module:\r\n\t//\t\tdojox/mobile/EditableRoundRectList\r\n\r\n\treturn declare(\"dojox.mobile._EditableListMixin\", null, {\r\n\t\t// summary:\r\n\t\t//\t\tA rounded rectangle list.\r\n\t\t// description:\r\n\t\t//\t\tEditableRoundRectList is a rounded rectangle list, which can be used to\r\n\t\t//\t\tdisplay a group of items. Each item must be\ta dojox/mobile/ListItem.\r\n\r\n\t\trightIconForEdit: \"mblDomButtonGrayKnob\",\r\n\t\tdeleteIconForEdit: \"mblDomButtonRedCircleMinus\",\r\n\r\n\t\t// isEditing: Boolean\r\n\t\t//\t\tA read-only flag that indicates whether the widget is in the editing mode.\r\n\t\tisEditing: false,\r\n\r\n\t\tdestroy: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDestroys the widget.\r\n\t\t\tif(this._blankItem){\r\n\t\t\t\tthis._blankItem.destroy();\r\n\t\t\t}\r\n\t\t\tthis.inherited(arguments);\r\n\t\t},\r\n\r\n\t\t_setupMoveItem: function(/*DomNode*/node){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tdomStyle.set(node, {\r\n\t\t\t\twidth: domGeometry.getContentBox(node).w + \"px\",\r\n\t\t\t\ttop: node.offsetTop + \"px\"\r\n\t\t\t});\r\n\t\t\tdomClass.add(node, \"mblListItemFloat\");\r\n\t\t},\r\n\r\n\t\t_resetMoveItem: function(/*DomNode*/node){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tthis.defer(function(){ // iPhone needs setTimeout (via defer)\r\n\t\t\t\tdomClass.remove(node, \"mblListItemFloat\");\r\n\t\t\t\tdomStyle.set(node, {\r\n\t\t\t\t\twidth: \"\",\r\n\t\t\t\t\ttop: \"\"\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_onClick: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal handler for click events.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(e && e.type === \"keydown\" && e.keyCode !== 13){ return; }\r\n\t\t\tif(this.onClick(e) === false){ return; } // user's click action\r\n\t\t\tvar item = registry.getEnclosingWidget(e.target);\r\n\t\t\tfor(var n = e.target; n !== item.domNode; n = n.parentNode){\r\n\t\t\t\tif(n === item.deleteIconNode){\r\n\t\t\t\t\tconnect.publish(\"/dojox/mobile/deleteListItem\", [item]);\r\n\t\t\t\t\tthis.onDeleteItem(item); //callback\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonClick: function(/*Event*/ /*===== e =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tUser-defined function to handle clicks.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\t\t},\r\n\r\n\t\t_onTouchStart: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(this.getChildren().length <= 1){ return; }\r\n\t\t\tif(!this._blankItem){\r\n\t\t\t\tthis._blankItem = new ListItem();\r\n\t\t\t}\r\n\t\t\tvar item = this._movingItem = registry.getEnclosingWidget(e.target);\r\n\t\t\tthis._startIndex = this.getIndexOfChild(item);\r\n\t\t\tvar rightIconPressed = false;\r\n\t\t\tfor(var n = e.target; n !== item.domNode; n = n.parentNode){\r\n\t\t\t\tif(n === item.rightIconNode){\r\n\t\t\t\t\trightIconPressed = true;\r\n\t\t\t\t\tdomAttr.set(item.rightIconNode, \"aria-grabbed\", \"true\");\r\n\t\t\t\t\tdomAttr.set(this.domNode, \"aria-dropeffect\", \"move\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!rightIconPressed){ return; }\r\n\t\t\tvar ref = item.getNextSibling();\r\n\t\t\tref = ref ? ref.domNode : null;\r\n\t\t\tthis.containerNode.insertBefore(this._blankItem.domNode, ref);\r\n\t\t\tthis._setupMoveItem(item.domNode);\r\n\t\t\tthis.containerNode.appendChild(item.domNode);\r\n\r\n\t\t\tif(!this._conn){\r\n\t\t\t\tthis._conn = [\r\n\t\t\t\t\tthis.connect(this.domNode, touch.move, \"_onTouchMove\"),\r\n\t\t\t\t\tthis.connect(win.doc, touch.release, \"_onTouchEnd\")\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\tthis._pos = [];\r\n\t\t\tarray.forEach(this.getChildren(), function(c, index){\r\n\t\t\t\tthis._pos.push(domGeometry.position(c.domNode, true).y);\r\n\t\t\t}, this);\r\n\t\t\tthis.touchStartY = e.touches ? e.touches[0].pageY : e.pageY;\r\n\t\t\tthis._startTop = domGeometry.getMarginBox(item.domNode).t;\r\n\t\t\tevent.stop(e);\r\n\t\t},\r\n\r\n\t\t_onTouchMove: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar y = e.touches ? e.touches[0].pageY : e.pageY;\r\n\t\t\tvar index = this._pos.length - 1;\r\n\t\t\tfor(var i = 1; i < this._pos.length; i++){\r\n\t\t\t\tif(y < this._pos[i]){\r\n\t\t\t\t\tindex = i - 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar item = this.getChildren()[index];\r\n\t\t\tvar blank = this._blankItem;\r\n\t\t\tif(item !== blank){\r\n\t\t\t\tvar p = item.domNode.parentNode;\r\n\t\t\t\tif(item.getIndexInParent() < blank.getIndexInParent()){\r\n\t\t\t\t\tp.insertBefore(blank.domNode, item.domNode);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tp.insertBefore(item.domNode, blank.domNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._movingItem.domNode.style.top = this._startTop + (y - this.touchStartY) + \"px\";\r\n\t\t},\r\n\r\n\t\t_onTouchEnd: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar startIndex = this._startIndex;\r\n\t\t\tvar endIndex = this.getIndexOfChild(this._blankItem);\r\n\t\t\t\t\t\t\r\n\t\t\tvar ref = this._blankItem.getNextSibling();\r\n\t\t\tref = ref ? ref.domNode : null;\r\n\t\t\tif(ref === null){ \r\n\t\t\t\t//If the item is droped at the end of the list the endIndex is wrong\r\n\t\t\t\tendIndex--; \r\n\t\t\t} \r\n\t\t\tthis.containerNode.insertBefore(this._movingItem.domNode, ref);\r\n\t\t\tthis.containerNode.removeChild(this._blankItem.domNode);\r\n\t\t\tthis._resetMoveItem(this._movingItem.domNode);\r\n\r\n\t\t\tarray.forEach(this._conn, connect.disconnect);\r\n\t\t\tthis._conn = null;\r\n\t\t\t\r\n\t\t\tthis.onMoveItem(this._movingItem, startIndex, endIndex); //callback\r\n\t\t\t\r\n\t\t\tdomAttr.set(this._movingItem.rightIconNode, \"aria-grabbed\", \"false\");\r\n\t\t\tdomAttr.remove(this.domNode, \"aria-dropeffect\");\r\n\t\t},\r\n\r\n\t\tstartEdit: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStarts the editing.\r\n\t\t\tthis.isEditing = true;\r\n\t\t\tdomClass.add(this.domNode, \"mblEditableRoundRectList\");\r\n\t\t\tarray.forEach(this.getChildren(), function(child){\r\n\t\t\t\tif(!child.deleteIconNode){\r\n\t\t\t\t\tchild.set(\"rightIcon\", this.rightIconForEdit);\r\n\t\t\t\t\tif(child.rightIconNode){\r\n\t\t\t\t\t\tdomAttr.set(child.rightIconNode, \"role\", \"button\");\r\n\t\t\t\t\t\tdomAttr.set(child.rightIconNode, \"aria-grabbed\", \"false\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchild.set(\"deleteIcon\", this.deleteIconForEdit);\r\n\t\t\t\t\tchild.deleteIconNode.tabIndex = child.tabIndex;\r\n\t\t\t\t\tif(child.deleteIconNode){\r\n\t\t\t\t\t\tdomAttr.set(child.deleteIconNode, \"role\", \"button\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tchild.rightIconNode.style.display = \"\";\r\n\t\t\t\tchild.deleteIconNode.style.display = \"\";\r\n\t\t\t\tif(typeof child.rightIconNode.style.msTouchAction != \"undefined\"){\r\n\t\t\t\t\tchild.rightIconNode.style.msTouchAction = \"none\";\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tif(!this._handles){\r\n\t\t\t\tthis._handles = [\r\n\t\t\t\t\tthis.connect(this.domNode, touch.press, \"_onTouchStart\"),\r\n\t\t\t\t\tthis.connect(this.domNode, \"onclick\", \"_onClick\"),\r\n\t\t\t\t\tthis.connect(this.domNode, \"onkeydown\", \"_onClick\") // for desktop browsers\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.onStartEdit(); // callback\r\n\t\t},\r\n\r\n\t\tendEdit: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEnds the editing.\r\n\t\t\tdomClass.remove(this.domNode, \"mblEditableRoundRectList\");\r\n\t\t\tarray.forEach(this.getChildren(), function(child){\r\n\t\t\t\tchild.rightIconNode.style.display = \"none\";\r\n\t\t\t\tchild.deleteIconNode.style.display = \"none\";\r\n\t\t\t\tif(typeof child.rightIconNode.style.msTouchAction != \"undefined\"){\r\n\t\t\t\t\tchild.rightIconNode.style.msTouchAction = \"auto\";\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif(this._handles){\r\n\t\t\t\tarray.forEach(this._handles, this.disconnect, this);\r\n\t\t\t\tthis._handles = null;\r\n\t\t\t}\r\n\t\t\tthis.isEditing = false;\r\n\t\t\t\r\n\t\t\tthis.onEndEdit(); // callback\r\n\t\t},\r\n\t\t\r\n\t\t\r\n\t\tonDeleteItem: function(/*Widget*/item){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t\t// description:\r\n\t\t\t//\t\tThis function is called when a user clicks the delete\r\n\t\t\t//\t\tbutton.\r\n\t\t\t//\t\tYou have to provide that function or subscribe to /dojox/mobile/deleteListItem, \r\n\t\t\t//\t\totherwise the delete button will have no-effect.\r\n\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\tonMoveItem: function(/*Widget*/item, /*int*/from, /*int*/to){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t},\r\n\r\n\t\tonStartEdit: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t},\r\n\r\n\t\tonEndEdit: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub function to connect to from your application.\r\n\t\t}\r\n\r\n\r\n\t});\r\n});\r\n"]}