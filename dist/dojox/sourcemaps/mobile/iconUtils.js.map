{"version":3,"sources":["mobile/iconUtils.js"],"names":["define","array","config","connect","event","lang","win","domClass","domConstruct","domStyle","has","dm","getObject","this","setupSpriteIcon","iconNode","iconPos","arr","map","split","item","t","r","b","l","set","position","clip","top","parentNode","get","left","add","createDomButton","refNode","style","toNode","_domButtons","findDomButtons","sheet","dic","i","j","_dic","ss","doc","styleSheets","length","rules","cssRules","rule","href","styleSheet","selectorText","sels","sel","n","match","cls","RegExp","$1","s","className","node","indexOf","btnClass","nDiv","$2","undefined","props","mblBBBoxShadowWorkaround","p","firstChild","create","setTimeout","remove","src","createIcon","icon","title","parent","pos","nodeName","alt","replace","currentTheme","width","height","iconWrapper","setIcon","tagName","destroy","empty"],"mappings":"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","file":"../../mobile/iconUtils.js","sourcesContent":["define([\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/config\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/dom-class\",\r\n\t\"dojo/dom-construct\",\r\n\t\"dojo/dom-style\",\r\n\t\"./sniff\"\r\n], function(array, config, connect, event, lang, win, domClass, domConstruct, domStyle, has){\r\n\r\n\tvar dm = lang.getObject(\"dojox.mobile\", true);\r\n\r\n\t// module:\r\n\t//\t\tdojox/mobile/iconUtils\r\n\r\n\tvar IconUtils = function(){\r\n\t\t// summary:\r\n\t\t//\t\tUtilities to create an icon (image, CSS sprite image, or DOM Button).\r\n\r\n\t\tthis.setupSpriteIcon = function(/*DomNode*/iconNode, /*String*/iconPos){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSets up CSS sprite for a foreground image.\r\n\t\t\tif(iconNode && iconPos){\r\n\t\t\t\tvar arr = array.map(iconPos.split(/[ ,]/),function(item){return item-0});\r\n\t\t\t\tvar t = arr[0]; // top\r\n\t\t\t\tvar r = arr[1] + arr[2]; // right\r\n\t\t\t\tvar b = arr[0] + arr[3]; // bottom\r\n\t\t\t\tvar l = arr[1]; // left\r\n\t\t\t\tdomStyle.set(iconNode, {\r\n\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\tclip: \"rect(\"+t+\"px \"+r+\"px \"+b+\"px \"+l+\"px)\",\r\n\t\t\t\t\ttop: (iconNode.parentNode ? domStyle.get(iconNode, \"top\") : 0) - t + \"px\",\r\n\t\t\t\t\tleft: -l + \"px\"\r\n\t\t\t\t});\r\n\t\t\t\tdomClass.add(iconNode, \"mblSpriteIcon\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.createDomButton = function(/*DomNode*/refNode, /*Object?*/style, /*DomNode?*/toNode){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreates a DOM button.\r\n\t\t\t// description:\r\n\t\t\t//\t\tDOM button is a simple graphical object that consists of one or\r\n\t\t\t//\t\tmore nested DIV elements with some CSS styling. It can be used\r\n\t\t\t//\t\tin place of an icon image on ListItem, IconItem, and so on.\r\n\t\t\t//\t\tThe kind of DOM button to create is given as a class name of\r\n\t\t\t//\t\trefNode. The number of DIVs to create is searched from the style\r\n\t\t\t//\t\tsheets in the page. However, if the class name has a suffix that\r\n\t\t\t//\t\tstarts with an underscore, like mblDomButtonGoldStar_5, then the\r\n\t\t\t//\t\tsuffixed number is used instead. A class name for DOM button\r\n\t\t\t//\t\tmust starts with 'mblDomButton'.\r\n\t\t\t// refNode:\r\n\t\t\t//\t\tA node that has a DOM button class name.\r\n\t\t\t// style:\r\n\t\t\t//\t\tA hash object to set styles to the node.\r\n\t\t\t// toNode:\r\n\t\t\t//\t\tA root node to create a DOM button. If omitted, refNode is used.\r\n\r\n\t\t\tif(!this._domButtons){\r\n\t\t\t\tif(has(\"webkit\")){\r\n\t\t\t\t\tvar findDomButtons = function(sheet, dic){\r\n\t\t\t\t\t\t// summary:\r\n\t\t\t\t\t\t//\t\tSearches the style sheets for DOM buttons.\r\n\t\t\t\t\t\t// description:\r\n\t\t\t\t\t\t//\t\tReturns a key-value pair object whose keys are DOM\r\n\t\t\t\t\t\t//\t\tbutton class names and values are the number of DOM\r\n\t\t\t\t\t\t//\t\telements they need.\r\n\t\t\t\t\t\tvar i, j;\r\n\t\t\t\t\t\tif(!sheet){\r\n\t\t\t\t\t\t\tvar _dic = {};\r\n\t\t\t\t\t\t\tvar ss = win.doc.styleSheets;\r\n\t\t\t\t\t\t\tfor (i = 0; i < ss.length; i++){\r\n\t\t\t\t\t\t\t\tss[i] && findDomButtons(ss[i], _dic);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn _dic;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar rules = sheet.cssRules || [];\r\n\t\t\t\t\t\tfor (i = 0; i < rules.length; i++){\r\n\t\t\t\t\t\t\tvar rule = rules[i];\r\n\t\t\t\t\t\t\tif(rule.href && rule.styleSheet){\r\n\t\t\t\t\t\t\t\tfindDomButtons(rule.styleSheet, dic);\r\n\t\t\t\t\t\t\t}else if(rule.selectorText){\r\n\t\t\t\t\t\t\t\tvar sels = rule.selectorText.split(/,/);\r\n\t\t\t\t\t\t\t\tfor (j = 0; j < sels.length; j++){\r\n\t\t\t\t\t\t\t\t\tvar sel = sels[j];\r\n\t\t\t\t\t\t\t\t\tvar n = sel.split(/>/).length - 1;\r\n\t\t\t\t\t\t\t\t\tif(sel.match(/(mblDomButton\\w+)/)){\r\n\t\t\t\t\t\t\t\t\t\tvar cls = RegExp.$1;\r\n\t\t\t\t\t\t\t\t\t\tif(!dic[cls] || n > dic[cls]){\r\n\t\t\t\t\t\t\t\t\t\t\tdic[cls] = n;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn dic;\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis._domButtons = findDomButtons();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._domButtons = {};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar s = refNode.className;\r\n\t\t\tvar node = toNode || refNode;\r\n\t\t\tif(s.match(/(mblDomButton\\w+)/) && s.indexOf(\"/\") === -1){\r\n\t\t\t\tvar btnClass = RegExp.$1;\r\n\t\t\t\tvar nDiv = 4;\r\n\t\t\t\tif(s.match(/(mblDomButton\\w+_(\\d+))/)){\r\n\t\t\t\t\tnDiv = RegExp.$2 - 0;\r\n\t\t\t\t}else if(this._domButtons[btnClass] !== undefined){\r\n\t\t\t\t\tnDiv = this._domButtons[btnClass];\r\n\t\t\t\t}\r\n\t\t\t\tvar props = null;\r\n\t\t\t\tif(has(\"bb\") && config.mblBBBoxShadowWorkaround !== false){\r\n\t\t\t\t\t// Removes box-shadow because BlackBerry incorrectly renders it.\r\n\t\t\t\t\tprops = {style:\"-webkit-box-shadow:none\"};\r\n\t\t\t\t}\r\n\t\t\t\tfor(var i = 0, p = node; i < nDiv; i++){\r\n\t\t\t\t\tp = p.firstChild || domConstruct.create(\"div\", props, p);\r\n\t\t\t\t}\r\n\t\t\t\tif(toNode){\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\tdomClass.remove(refNode, btnClass);\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t\tdomClass.add(toNode, btnClass);\r\n\t\t\t\t}\r\n\t\t\t}else if(s.indexOf(\".\") !== -1){ // file name\r\n\t\t\t\tdomConstruct.create(\"img\", {src:s}, node);\r\n\t\t\t}else{\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tdomClass.add(node, \"mblDomButton\");\r\n\t\t\t!!style && domStyle.set(node, style);\r\n\t\t\treturn node;\r\n\t\t};\r\n\r\n\t\tthis.createIcon = function(/*String*/icon, /*String?*/iconPos, /*DomNode?*/node, /*String?*/title, /*DomNode?*/parent, /*DomNode?*/refNode, /*String?*/pos){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreates or updates an icon node\r\n\t\t\t// description:\r\n\t\t\t//\t\tIf node exists, updates the existing node. Otherwise, creates a new one.\r\n\t\t\t// icon:\r\n\t\t\t//\t\tPath for an image, or DOM button class name.\r\n\t\t\ttitle = title || \"\";\r\n\t\t\tif(icon && icon.indexOf(\"mblDomButton\") === 0){\r\n\t\t\t\t// DOM button\r\n\t\t\t\tif(!node){\r\n\t\t\t\t\tnode = domConstruct.create(\"div\", null, refNode || parent, pos);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(node.className.match(/(mblDomButton\\w+)/)){\r\n\t\t\t\t\t\tdomClass.remove(node, RegExp.$1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tnode.title = title;\r\n\t\t\t\tdomClass.add(node, icon);\r\n\t\t\t\tthis.createDomButton(node);\r\n\t\t\t}else if(icon && icon !== \"none\"){\r\n\t\t\t\t// Image\r\n\t\t\t\tif(!node || node.nodeName !== \"IMG\"){\r\n\t\t\t\t\tnode = domConstruct.create(\"img\", {\r\n\t\t\t\t\t\talt: title\r\n\t\t\t\t\t}, refNode || parent, pos);\r\n\t\t\t\t}\r\n\t\t\t\tnode.src = (icon || \"\").replace(\"${theme}\", dm.currentTheme);\r\n\t\t\t\tthis.setupSpriteIcon(node, iconPos);\r\n\t\t\t\tif(iconPos && parent){\r\n\t\t\t\t\tvar arr = iconPos.split(/[ ,]/);\r\n\t\t\t\t\tdomStyle.set(parent, {\r\n\t\t\t\t\t\tposition: \"relative\",\r\n\t\t\t\t\t\twidth: arr[2] + \"px\",\r\n\t\t\t\t\t\theight: arr[3] + \"px\"\r\n\t\t\t\t\t});\r\n\t\t\t\t\tdomClass.add(parent, \"mblSpriteIconParent\");\r\n\t\t\t\t}\r\n\t\t\t\tconnect.connect(node, \"ondragstart\", event, \"stop\");\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t};\r\n\r\n\t\tthis.iconWrapper = false;\r\n\t\tthis.setIcon = function(/*String*/icon, /*String*/iconPos, /*DomNode*/iconNode, /*String?*/alt, /*DomNode*/parent, /*DomNode?*/refNode, /*String?*/pos){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA setter function to set an icon.\r\n\t\t\t// description:\r\n\t\t\t//\t\tThis function is intended to be used by icon setters (e.g. _setIconAttr)\r\n\t\t\t// icon:\r\n\t\t\t//\t\tAn icon path or a DOM button class name.\r\n\t\t\t// iconPos:\r\n\t\t\t//\t\tThe position of an aggregated icon. IconPos is comma separated\r\n\t\t\t//\t\tvalues like top,left,width,height (ex. \"0,0,29,29\").\r\n\t\t\t// iconNode:\r\n\t\t\t//\t\tAn icon node.\r\n\t\t\t// alt:\r\n\t\t\t//\t\tAn alt text for the icon image.\r\n\t\t\t// parent:\r\n\t\t\t//\t\tParent node of the icon.\r\n\t\t\t// refNode:\r\n\t\t\t//\t\tA node reference to place the icon.\r\n\t\t\t// pos:\r\n\t\t\t//\t\tThe position of the icon relative to refNode.\r\n\t\t\tif(!parent || !icon && !iconNode){ return null; }\r\n\t\t\tif(icon && icon !== \"none\"){ // create or update an icon\r\n\t\t\t\tif(!this.iconWrapper && icon.indexOf(\"mblDomButton\") !== 0 && !iconPos){ // image\r\n\t\t\t\t\tif(iconNode && iconNode.tagName === \"DIV\"){\r\n\t\t\t\t\t\tdomConstruct.destroy(iconNode);\r\n\t\t\t\t\t\ticonNode = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ticonNode = this.createIcon(icon, null, iconNode, alt, parent, refNode, pos);\r\n\t\t\t\t\tdomClass.add(iconNode, \"mblImageIcon\");\r\n\t\t\t\t}else{ // sprite or DOM button\r\n\t\t\t\t\tif(iconNode && iconNode.tagName === \"IMG\"){\r\n\t\t\t\t\t\tdomConstruct.destroy(iconNode);\r\n\t\t\t\t\t\ticonNode = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ticonNode && domConstruct.empty(iconNode);\r\n\t\t\t\t\tif(!iconNode){\r\n\t\t\t\t\t\ticonNode = domConstruct.create(\"div\", null, refNode || parent, pos);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.createIcon(icon, iconPos, null, null, iconNode);\r\n\t\t\t\t\tif(alt){\r\n\t\t\t\t\t\ticonNode.title = alt;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdomClass.remove(parent, \"mblNoIcon\");\r\n\t\t\t\treturn iconNode;\r\n\t\t\t}else{ // clear the icon\r\n\t\t\t\tdomConstruct.destroy(iconNode);\r\n\t\t\t\tdomClass.add(parent, \"mblNoIcon\");\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\t// Return singleton.  (TODO: can we replace IconUtils class and singleton w/a simple hash of functions?)\r\n\treturn new IconUtils();\r\n});\r\n"]}