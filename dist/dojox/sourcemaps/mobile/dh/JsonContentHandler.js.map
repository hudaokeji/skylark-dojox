{"version":3,"sources":["mobile/dh/JsonContentHandler.js"],"names":["define","dojo","array","declare","lang","Deferred","json","domConstruct","parse","content","target","refNode","view","container","create","insertBefore","this","_ws","_req","root","when","_loadPrereqs","hitch","_instantiate","style","visibility","forEach","w","_started","startup","id","d","req","_collectRequires","length","require","c","map","s","replace","resolve","obj","className","key","charAt","cls","push","objs","isArray","i","children","j","node","parent","widget","getObject","proto","prototype","params","prop","v","t","substring","split","Function","placeAt","containerNode","domNode"],"mappings":"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","file":"../../../mobile/dh/JsonContentHandler.js","sourcesContent":["define([\r\n\t\"dojo/_base/kernel\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/Deferred\",\r\n\t\"dojo/json\",\r\n\t\"dojo/dom-construct\"\r\n], function(dojo, array, declare, lang, Deferred, json, domConstruct){\r\n\r\n\t// module:\r\n\t//\t\tdojox/mobile/dh/JsonContentHandler\r\n\r\n\treturn declare(\"dojox.mobile.dh.JsonContentHandler\", null, {\r\n\t\t// summary:\r\n\t\t//\t\tA JSON content handler.\r\n\t\t// description:\r\n\t\t//\t\tThis module is a content handler that creates a view from JSON\r\n\t\t//\t\tdata. If widgets used in the JSON data are not available, they\r\n\t\t//\t\tare loaded automatically before instantiation.\r\n\t\t//\r\n\t\t//\t\tThere are two formats as shown in the examples below. You can\r\n\t\t//\t\tchoose either of them. The v1.7 format can be more compact, but\r\n\t\t//\t\tif you want multiple widgets at the same level, they must be in\r\n\t\t//\t\tan array. So, you can have, for example, two consecutive\r\n\t\t//\t\tRoundRectLists, but you cannot have, for example,\r\n\t\t//\t\tRoundRectCategory, RoundRectList, RoundRectCategory, and\r\n\t\t//\t\tRoundRectList, because they are keys in one JS object, which\r\n\t\t//\t\tcauses conflict. The v1.8 format has no such limitation.\r\n\t\t//\r\n\t\t// example:\r\n\t\t// \t|\t// v1.7 format\r\n\t\t//\t|\t{\r\n\t\t//\t|\t  \"dojox.mobile.View\": {\r\n\t\t//\t|\t    \"@id\": \"view1\",\r\n\t\t//\t|\t    \"dojox.mobile.Heading\": {\r\n\t\t//\t|\t      \"@back\": \"Home\",\r\n\t\t//\t|\t      \"@moveTo\": \"home\",\r\n\t\t//\t|\t      \"@label\": \"view1.json\"\r\n\t\t//\t|\t    },\r\n\t\t//\t|\t    \"dojox.mobile.EdgeToEdgeList\": {\r\n\t\t//\t|\t      \"dojox.mobile.ListItem\": [{\r\n\t\t//\t|\t        \"@label\": \"Jack Coleman\"\r\n\t\t//\t|\t      }, {\r\n\t\t//\t|\t        \"@label\": \"James Evans\"\r\n\t\t//\t|\t      }, {\r\n\t\t//\t|\t        \"@label\": \"Jason Griffin\"\r\n\t\t//\t|\t      }]\r\n\t\t//\t|\t    }\r\n\t\t//\t|\t  }\r\n\t\t//\t|\t}\r\n\t\t//\t|\t\r\n\t\t// example:\r\n\t\t//\t|\t// v1.8 format\r\n\t\t//\t|\t{\r\n\t\t//\t|\t  \"class\": \"dojox.mobile.View\",\r\n\t\t//\t|\t  \"@id\": \"view1\",\r\n\t\t//\t|\t  \"children\": [\r\n\t\t//\t|\t\r\n\t\t//\t|\t    {\r\n\t\t//\t|\t      \"class\": \"dojox.mobile.Heading\",\r\n\t\t//\t|\t      \"@back\": \"Home\",\r\n\t\t//\t|\t      \"@moveTo\": \"home\",\r\n\t\t//\t|\t      \"@label\": \"view1.json\"\r\n\t\t//\t|\t    },\r\n\t\t//\t|\t\r\n\t\t//\t|\t    {\r\n\t\t//\t|\t      \"class\": \"dojox.mobile.EdgeToEdgeList\",\r\n\t\t//\t|\t      \"children\": [\r\n\t\t//\t|\t        {\r\n\t\t//\t|\t          \"class\": \"dojox.mobile.ListItem\",\r\n\t\t//\t|\t          \"@label\": \"Jack Coleman\"\r\n\t\t//\t|\t        },\r\n\t\t//\t|\t        {\r\n\t\t//\t|\t          \"class\": \"dojox.mobile.ListItem\",\r\n\t\t//\t|\t          \"@label\": \"James Evans\"\r\n\t\t//\t|\t        },\r\n\t\t//\t|\t        {\r\n\t\t//\t|\t          \"class\": \"dojox.mobile.ListItem\",\r\n\t\t//\t|\t          \"@label\": \"Jason Griffin\"\r\n\t\t//\t|\t        }\r\n\t\t//\t|\t      ]\r\n\t\t//\t|\t    }\r\n\t\t//\t|\t\r\n\t\t//\t|\t  ]\r\n\t\t//\t|\t}\r\n\t\t//\t|\t\r\n\t\t// example:\r\n\t\t//\t|\t// SpinWheel in v1.8 format\r\n\t\t//\t|\t{\r\n\t\t//\t|\t  \"class\": \"dojox.mobile.View\",\r\n\t\t//\t|\t  \"@id\": \"view1\",\r\n\t\t//\t|\t  \"children\": [\r\n\t\t//\t|\t    {\r\n\t\t//\t|\t      \"class\": \"dojox.mobile.SpinWheel\",\r\n\t\t//\t|\t      \"@id\": \"spin1\",\r\n\t\t//\t|\t      \"@style\": {\"margin\":\"10px auto\",\"width\":\"304px\"},\r\n\t\t//\t|\t      \"children\": [\r\n\t\t//\t|\t        {\r\n\t\t//\t|\t          \"class\": \"dojox.mobile.SpinWheelSlot\",\r\n\t\t//\t|\t          \"@labels\": \"A,B,C,D,E\",\r\n\t\t//\t|\t          \"@style\": {\"textAlign\":\"center\",\"width\":\"300px\"}\r\n\t\t//\t|\t        }\r\n\t\t//\t|\t      ]\r\n\t\t//\t|\t    }\r\n\t\t//\t|\t  ]\r\n\t\t//\t|\t}\r\n\r\n\t\tparse: function(/*Object*/ content, /*DomNode*/ target, /*DomNode?*/ refNode){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tParses the given data and creates a new view at the given position.\r\n\t\t\t// content:\r\n\t\t\t//\t\tContent data for a new view.\r\n\t\t\t// target:\r\n\t\t\t//\t\tA DOM node under which a new view is created.\r\n\t\t\t// refNode:\r\n\t\t\t//\t\tAn optional reference DOM node before which a new view is created.\r\n\t\t\tvar view, container = domConstruct.create(\"DIV\");\r\n\t\t\ttarget.insertBefore(container, refNode);\r\n\t\t\tthis._ws = [];\r\n\t\t\tthis._req = [];\r\n\t\t\tvar root = json.parse(content);\r\n\t\t\treturn Deferred.when(this._loadPrereqs(root), lang.hitch(this, function(){\r\n\t\t\t\tview = this._instantiate(root, container);\r\n\t\t\t\tview.style.visibility = \"hidden\";\r\n\t\t\t\tarray.forEach(this._ws, function(w){\r\n\t\t\t\t\tif(!w._started && w.startup){\r\n\t\t\t\t\t\tw.startup();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis._ws = null;\r\n\t\t\t\treturn view.id;\r\n\t\t\t}));\r\n\t\t},\r\n\r\n\t\t_loadPrereqs: function(root){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar d = new Deferred();\r\n\t\t\tvar req = this._collectRequires(root);\r\n\t\t\tif(req.length === 0){ return true; }\r\n\r\n\t\t\tif(dojo.require){\r\n\t\t\t\tarray.forEach(req, function(c){\r\n\t\t\t\t\tdojo[\"require\"](c);\r\n\t\t\t\t});\r\n\t\t\t\treturn true;\r\n\t\t\t}else{\r\n\t\t\t\treq = array.map(req, function(s){ return s.replace(/\\./g, \"/\"); });\r\n\t\t\t\trequire(req, function(){\r\n\t\t\t\t\td.resolve(true);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn d;\r\n\t\t},\r\n\r\n\t\t_collectRequires: function(obj){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar className = obj[\"class\"];\r\n\t\t\tfor(var key in obj){\r\n\t\t\t\tif(key.charAt(0) == \"@\" || key === \"children\"){ continue; }\r\n\t\t\t\tvar cls = className || key.replace(/:.*/, \"\");\r\n\t\t\t\tthis._req.push(cls);\r\n\t\t\t\tif(!cls){ continue; }\r\n\t\t\t\tvar objs = className ? [obj] :\r\n\t\t\t\t\t\t(lang.isArray(obj[key]) ? obj[key] : [obj[key]]);\r\n\t\t\t\tfor(var i = 0; i < objs.length; i++){\r\n\t\t\t\t\t// process child widgets\r\n\t\t\t\t\tif(!className){\r\n\t\t\t\t\t\tthis._collectRequires(objs[i]);\r\n\t\t\t\t\t}else if(objs[i].children){\r\n\t\t\t\t\t\tfor(var j = 0; j < objs[i].children.length; j++){\r\n\t\t\t\t\t\t\tthis._collectRequires(objs[i].children[j]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this._req;\r\n\t\t},\r\n\r\n\t\t_instantiate: function(/*Object*/obj, /*DomNode*/node, /*Widget*/parent){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tGiven the evaluated json data, does the same thing as what\r\n\t\t\t//\t\tthe parser does.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar widget;\r\n\t\t\tvar className = obj[\"class\"];\r\n\t\t\tfor(var key in obj){\r\n\t\t\t\tif(key.charAt(0) == \"@\" || key === \"children\"){ continue; }\r\n\t\t\t\tvar cls = lang.getObject(className || key.replace(/:.*/, \"\"));\r\n\t\t\t\tif(!cls){ continue; }\r\n\t\t\t\tvar proto = cls.prototype,\r\n\t\t\t\t\tobjs = className ? [obj] :\r\n\t\t\t\t\t\t(lang.isArray(obj[key]) ? obj[key] : [obj[key]]);\r\n\t\t\t\tfor(var i = 0; i < objs.length; i++){\r\n\t\t\t\t\tvar params = {};\r\n\t\t\t\t\tfor(var prop in objs[i]){\r\n\t\t\t\t\t\tif(prop.charAt(0) == \"@\"){\r\n\t\t\t\t\t\t\tvar v = objs[i][prop];\r\n\t\t\t\t\t\t\tprop = prop.substring(1);\r\n\t\t\t\t\t\t\tvar t = typeof proto[prop];\r\n\t\t\t\t\t\t\tif(lang.isArray(proto[prop])){\r\n\t\t\t\t\t\t\t\tparams[prop] = v.split(/\\s*,\\s*/);\r\n\t\t\t\t\t\t\t}else if(t === \"string\"){\r\n\t\t\t\t\t\t\t\tparams[prop] = v;\r\n\t\t\t\t\t\t\t}else if(t === \"number\"){\r\n\t\t\t\t\t\t\t\tparams[prop] = v - 0;\r\n\t\t\t\t\t\t\t}else if(t === \"boolean\"){\r\n\t\t\t\t\t\t\t\tparams[prop] = (v !== \"false\");\r\n\t\t\t\t\t\t\t}else if(t === \"object\"){\r\n\t\t\t\t\t\t\t\tparams[prop] = json.parse(v);\r\n\t\t\t\t\t\t\t}else if(t === \"function\"){\r\n\t\t\t\t\t\t\t\tparams[prop] = lang.getObject(v, false) || new Function(v);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\twidget = new cls(params, node);\r\n\t\t\t\t\tif(node){ // to call View's startup()\r\n\t\t\t\t\t\tthis._ws.push(widget);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(parent){\r\n\t\t\t\t\t\twidget.placeAt(parent.containerNode || parent.domNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// process child widgets\r\n\t\t\t\t\tif(!className){\r\n\t\t\t\t\t\tthis._instantiate(objs[i], null, widget);\r\n\t\t\t\t\t}else if(objs[i].children){\r\n\t\t\t\t\t\tfor(var j = 0; j < objs[i].children.length; j++){\r\n\t\t\t\t\t\t\tthis._instantiate(objs[i].children[j], null, widget);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn widget && widget.domNode;\r\n\t\t}\r\n\t});\r\n});\r\n"]}