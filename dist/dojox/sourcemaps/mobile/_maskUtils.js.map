{"version":3,"sources":["mobile/_maskUtils.js"],"names":["define","win","domStyle","has","add","global","doc","elt","getCSSCanvasContext","style","webkitMaskImage","cache","createRoundMask","node","x","y","r","b","w","h","rx","ry","e","tw","th","id","replace","ctx","beginPath","fillStyle","fillRect","moveTo","arcTo","lineTo","pi","Math","PI","scale","arc","closePath","fill","_svgMask","removeChild","bg","p","parentNode","getComputedStyle","backgroundColor","match","svgNS","svg","createElementNS","setAttribute","position","pointerEvents","opacity","zIndex","path","d","appendChild"],"mappings":"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","file":"../../mobile/_maskUtils.js","sourcesContent":["define([\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/dom-style\",\r\n\t\"./sniff\"\r\n], function(win, domStyle, has){\r\n\r\n\thas.add(\"mask-image-css\", function(global, doc, elt){\r\n\t\treturn typeof doc.getCSSCanvasContext === \"function\" && typeof elt.style.webkitMaskImage !== \"undefined\";\r\n\t});\r\n\r\n\t// Indicates whether image mask is available (either via css mask image or svg)\r\n\thas.add(\"mask-image\", function(){\r\n\t\treturn has(\"mask-image-css\") || has(\"svg\");\r\n\t});\r\n\r\n\tvar cache = {};\r\n\r\n\treturn {\r\n\t\t// summary:\r\n\t\t//\t\tUtility methods to clip rounded corners of various elements (Switch, ScrollablePane, scrollbars in scrollable widgets).\r\n\t\t//\t\tUses -webkit-mask-image on webkit, or SVG on other browsers.\r\n\t\t\r\n\t\tcreateRoundMask: function(/*DomNode*/node, x, y, r, b, w, h, rx, ry, e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreates and sets a mask for the specified node.\r\n\t\t\t\r\n\t\t\tvar tw = x + w + r;\r\n\t\t\tvar th = y + h + b;\r\n\t\t\t\r\n\t\t\tif(has(\"mask-image-css\")){\t\t\t// use -webkit-mask-image\r\n\t\t\t\tvar id = (\"DojoMobileMask\" + x + y + w + h + rx + ry).replace(/\\./g, \"_\");\r\n\t\t\t\tif (!cache[id]) {\r\n\t\t\t\t\tcache[id] = 1;\r\n\t\t\t\t\tvar ctx = win.doc.getCSSCanvasContext(\"2d\", id, tw, th);\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tif (rx == ry) {\r\n\t\t\t\t\t\t// round arc\r\n\t\t\t\t\t\tif(rx == 2 && w == 5){\r\n\t\t\t\t\t\t\t// optimized case for vertical scrollbar\r\n\t\t\t\t\t\t\tctx.fillStyle = \"rgba(0,0,0,0.5)\";\r\n\t\t\t\t\t\t\tctx.fillRect(1, 0, 3, 2);\r\n\t\t\t\t\t\t\tctx.fillRect(0, 1, 5, 1);\r\n\t\t\t\t\t\t\tctx.fillRect(0, h - 2, 5, 1);\r\n\t\t\t\t\t\t\tctx.fillRect(1, h - 1, 3, 2);\r\n\t\t\t\t\t\t\tctx.fillStyle = \"rgb(0,0,0)\";\r\n\t\t\t\t\t\t\tctx.fillRect(0, 2, 5, h - 4);\r\n\t\t\t\t\t\t}else if(rx == 2 && h == 5){\r\n\t\t\t\t\t\t\t// optimized case for horizontal scrollbar\r\n\t\t\t\t\t\t\tctx.fillStyle = \"rgba(0,0,0,0.5)\";\r\n\t\t\t\t\t\t\tctx.fillRect(0, 1, 2, 3);\r\n\t\t\t\t\t\t\tctx.fillRect(1, 0, 1, 5);\r\n\t\t\t\t\t\t\tctx.fillRect(w - 2, 0, 1, 5);\r\n\t\t\t\t\t\t\tctx.fillRect(w - 1, 1, 2, 3);\r\n\t\t\t\t\t\t\tctx.fillStyle = \"rgb(0,0,0)\";\r\n\t\t\t\t\t\t\tctx.fillRect(2, 0, w - 4, 5);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t// general case\r\n\t\t\t\t\t\t\tctx.fillStyle = \"#000000\";\r\n\t\t\t\t\t\t\tctx.moveTo(x+rx, y);\r\n\t\t\t\t\t\t\tctx.arcTo(x, y, x, y+rx, rx);\r\n\t\t\t\t\t\t\tctx.lineTo(x, y+h - rx);\r\n\t\t\t\t\t\t\tctx.arcTo(x, y+h, x+rx, y+h, rx);\r\n\t\t\t\t\t\t\tctx.lineTo(x+w - rx, y+h);\r\n\t\t\t\t\t\t\tctx.arcTo(x+w, y+h, x+w, y+rx, rx);\r\n\t\t\t\t\t\t\tctx.lineTo(x+w, y+rx);\r\n\t\t\t\t\t\t\tctx.arcTo(x+w, y, x+w - rx, y, rx);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// elliptical arc\r\n\t\t\t\t\t\tvar pi = Math.PI;\r\n\t\t\t\t\t\tctx.scale(1, ry / rx);\r\n\t\t\t\t\t\tctx.moveTo(x+rx, y);\r\n\t\t\t\t\t\tctx.arc(x+rx, y+rx, rx, 1.5 * pi, 0.5 * pi, true);\r\n\t\t\t\t\t\tctx.lineTo(x+w - rx, y+2 * rx);\r\n\t\t\t\t\t\tctx.arc(x+w - rx, y+rx, rx, 0.5 * pi, 1.5 * pi, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t\tctx.fill();\r\n\t\t\t\t}\r\n\t\t\t\tnode.style.webkitMaskImage = \"-webkit-canvas(\" + id + \")\";\r\n\t\t\t}else if(has(\"svg\")){\t\t// add an SVG image to clip the corners.\r\n\t\t\t\tif(node._svgMask){\r\n\t\t\t\t\tnode.removeChild(node._svgMask);\r\n\t\t\t\t}\r\n\t\t\t\tvar bg = null;\r\n\t\t\t\tfor(var p = node.parentNode; p; p = p.parentNode){\r\n\t\t\t\t\tbg = domStyle.getComputedStyle(p).backgroundColor;\r\n\t\t\t\t\tif(bg && bg != \"transparent\" && !bg.match(/rgba\\(.*,\\s*0\\s*\\)/)){\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar svgNS = \"http://www.w3.org/2000/svg\";\r\n\t\t\t\tvar svg = win.doc.createElementNS(svgNS, \"svg\");\r\n\t\t\t\tsvg.setAttribute(\"width\", tw);\r\n\t\t\t\tsvg.setAttribute(\"height\", th);\r\n\t\t\t\tsvg.style.position = \"absolute\";\r\n\t\t\t\tsvg.style.pointerEvents = \"none\";\r\n\t\t\t\tsvg.style.opacity = \"1\";\r\n\t\t\t\tsvg.style.zIndex = \"2147483647\"; // max int\r\n\t\t\t\tvar path = win.doc.createElementNS(svgNS, \"path\");\r\n\t\t\t\te = e || 0;\r\n\t\t\t\trx += e;\r\n\t\t\t\try += e;\r\n\t\t\t\t// TODO: optimized cases for scrollbars as in webkit case?\r\n\t\t\t\tvar d = \" M\" + (x + rx - e) + \",\" + (y - e) + \" a\" + rx + \",\" + ry + \" 0 0,0 \" + (-rx) + \",\" + ry + \" v\" + (-ry) + \" h\" + rx + \" Z\" +\r\n\t\t\t\t\t\t\" M\" + (x - e) + \",\" + (y + h - ry + e) + \" a\" + rx + \",\" + ry + \" 0 0,0 \" + rx + \",\" + ry + \" h\" + (-rx) + \" v\" + (-ry) + \" z\" +\r\n\t\t\t\t\t\t\" M\" + (x + w - rx + e) + \",\" + (y + h + e) + \" a\" + rx + \",\" + ry + \" 0 0,0 \" + rx + \",\" + (-ry) + \" v\" + ry + \" h\" + (-rx) + \" z\" +\r\n\t\t\t\t\t\t\" M\" + (x + w + e) + \",\" + (y + ry - e) + \" a\" + rx + \",\" + ry + \" 0 0,0 \" + (-rx) + \",\" + (-ry) + \" h\" + rx + \" v\" + ry + \" z\";\r\n\t\t\t\tif(y > 0){\r\n\t\t\t\t\td += \" M0,0 h\" + tw + \" v\" + y + \" h\" + (-tw) + \" z\";\r\n\t\t\t\t}\r\n\t\t\t\tif(b > 0){\r\n\t\t\t\t\td += \" M0,\" + (y + h) + \" h\" + tw + \" v\" + b + \" h\" + (-tw) + \" z\";\r\n\t\t\t\t}\r\n\t\t\t\tpath.setAttribute(\"d\", d);\r\n\t\t\t\tpath.setAttribute(\"fill\", bg);\r\n\t\t\t\tpath.setAttribute(\"stroke\", bg);\r\n\t\t\t\tpath.style.opacity = \"1\";\r\n\t\t\t\tsvg.appendChild(path); \r\n\t\t\t\tnode._svgMask = svg;\r\n\t\t\t\tnode.appendChild(svg);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n});\r\n"]}