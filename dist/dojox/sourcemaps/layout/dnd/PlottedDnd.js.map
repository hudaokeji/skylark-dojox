{"version":3,"sources":["layout/dnd/PlottedDnd.js"],"names":["dojo","provide","require","declare","dnd","Source","GC_OFFSET_X","manager","OFFSET_X","GC_OFFSET_Y","OFFSET_Y","constructor","node","params","this","childBoxes","dropIndicator","dojox","layout","DropIndicator","withHandles","handleClasses","opacity","allowAutoScroll","dom","singular","skipForm","_over","defaultHandleClass","isDropped","_timer","isOffset","offsetDrag","x","y","hideSource","_drop","create","_calculateCoords","height","forEach","childNodes","child","c","coords","xy","w","offsetWidth","h","offsetHeight","mw","mh","_legalMouseDown","e","parentNode","hasClass","setDndItemSelectable","isSelectable","_node","setSelectable","getDraggedWidget","nodeName","toLowerCase","dijit","byNode","isAccepted","_dndType","getAttribute","accept","onDndStart","source","nodes","copy","firstIndicator","m","style","avatar","clientHeight","dndNodes","PlottedDnd","superclass","call","n","onDndCancel","getSelectedNodes","deleteDashedZone","onDndDrop","target","dropObject","current","console","warn","onMouseDown","selection","anchor","NoOffsetDrag","_getChildByEvent","pageX","clientY","isFormElement","containerSource","_draggedWidget","dragRestriction","onMouseUp","isIE","mouseDown","onMouseMove","isDragging","before","setIndicatorPosition","targetAnchor","_markTargetAnchor","canDrop","id","_checkAutoScroll","isSource","length","startDrag","copyState","isCopyKey","_stopAutoScroll","targetBox","_unmarkTargetAnchor","horizontal","pageY","insertDashedZone","onOverEvent","onOutEvent","display","next","nextSibling","parseInt","b","place","appendChild","insertNodes","addSelected","data","_widget","byId","_setGcDndHandle","domNode","clearTimeout","_sumAncestorProperties","offsetTop","autoScrollActive","_autoScrollDown","scrollTop","_autoScrollUp","setTimeout","hitch","scrollHeight","prop","retVal","val","body","service","first","cls","query","removeClass","_hasHandle","i","_gripNode","addClass","cn","tag","isInserted","nodeType","el","doc","createElement","className","position","border","margin","destroy","removeChild","extend","Manager","flag","canDropFlag","update","makeAvatar","declaredClass","Avatar","handdleIE","subscribe","IEonselectstart","document","onselectstart","addOnWindowUnload","unsubscribe"],"mappings":"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","file":"../../../layout/dnd/PlottedDnd.js","sourcesContent":["dojo.provide(\"dojox.layout.dnd.PlottedDnd\");\r\n\r\ndojo.require(\"dojo.dnd.Source\");\r\ndojo.require(\"dojo.dnd.Manager\");\r\ndojo.require(\"dojox.layout.dnd.Avatar\");\r\n\r\ndojo.declare(\"dojox.layout.dnd.PlottedDnd\", [dojo.dnd.Source], {\r\n\t// summary:\r\n\t//\t\tdnd source handling plotted zone to show the dropping area\r\n\tGC_OFFSET_X: dojo.dnd.manager().OFFSET_X,\r\n\tGC_OFFSET_Y: dojo.dnd.manager().OFFSET_Y,\r\n\t\r\n\tconstructor: function(/*Node*/node, /*Object*/params){\r\n\t\t\r\n\t\tthis.childBoxes \t\t= null;\r\n\t\tthis.dropIndicator\t\t= new dojox.layout.dnd.DropIndicator(\"dndDropIndicator\", \"div\");\r\n\t\tthis.withHandles \t\t= params.withHandles;\r\n\t\tthis.handleClasses\t \t= params.handleClasses;\r\n\t\tthis.opacity \t\t\t= params.opacity;\r\n\t\tthis.allowAutoScroll\t= params.allowAutoScroll;//MODIF MYS\r\n\t\tthis.dom                = params.dom;\r\n\t\tthis.singular\t\t\t= true;\r\n\t\tthis.skipForm \t\t\t= true;\r\n\t\tthis._over \t\t\t\t= false;\r\n\t\tthis.defaultHandleClass = \"GcDndHandle\";\r\n\t\tthis.isDropped\t\t\t= false;\r\n\t\tthis._timer\t\t\t\t= null;\r\n\t\t//Initialize the params to calculate offset\r\n  \t\tthis.isOffset = (params.isOffset)?true:false;\r\n  \t\tthis.offsetDrag = (params.offsetDrag) ? params.offsetDrag : {x:0,y:0};\r\n\t\tthis.hideSource = params.hideSource ? params.hideSource : true;\r\n\t\tthis._drop = this.dropIndicator.create();\r\n\t\t\r\n\t},\r\n\t\r\n\t_calculateCoords : function(/*Boolean*/height){\r\n\t\t// summary:\r\n\t\t//\t\tCalculate each position of children\r\n\t\tdojo.forEach(this.node.childNodes, function(child){\r\n\t\t\tvar c = dojo.coords(child, true);\r\n\t\t\tchild.coords = {\r\n\t\t\t\txy: c,\r\n\t\t\t\tw: child.offsetWidth / 2,\r\n\t\t\t\th: child.offsetHeight / 2,\r\n\t\t\t\tmw: c.w\r\n\t\t\t};\r\n\t\t\tif(height){\r\n\t\t\t\tchild.coords.mh = c.h;\r\n\t\t\t}\r\n\t\t}, this);\r\n\t},\r\n\t\r\n\t_legalMouseDown: function(/*Event*/e){\r\n\t\t// summary:\r\n\t\t//\t\tChecks if user clicked on \"approved\" items.\r\n\t\tif(!this.withHandles){ return true; }\r\n\t\tfor(var node = (e.target); node && node != this.node; node = node.parentNode){\r\n\t\t\tif(dojo.hasClass(node, this.defaultHandleClass)){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\t// Boolean\r\n\t},\r\n\t\r\n\tsetDndItemSelectable: function(/*Node*/node, /*Boolean*/isSelectable) {\r\n\t\t// summary:\r\n\t\t//\t\tset an item as selectable\r\n\t\tfor(var _node = node; _node && node != this.node; _node = _node.parentNode) {\r\n\t\t\tif (dojo.hasClass(_node,\"dojoDndItem\")) {\r\n\t\t\t\tdojo.setSelectable(_node, isSelectable);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tgetDraggedWidget: function(/*Node*/node) {\r\n\t\t// summary:\r\n\t\t//\t\tReturn one or more widget selected during the drag.\r\n\t\tvar _node = node;\r\n\t\twhile (_node && _node.nodeName.toLowerCase()!=\"body\" && !dojo.hasClass(_node,\"dojoDndItem\")) {\r\n\t\t\t_node = _node.parentNode;\r\n\t\t}\r\n\t\treturn (_node) ? dijit.byNode(_node) : null;\r\n\t},\r\n\t\r\n\tisAccepted: function(/*Node*/ node) {\r\n\t\t// summary:\r\n\t\t//\t\ttest if this node can be accepted\r\n\t\tvar _dndType = (node) ? node.getAttribute(\"dndtype\") : null;\r\n\t\treturn (_dndType && _dndType in this.accept);\r\n\t},\r\n\t\r\n\tonDndStart:function(/*Object*/source, /*Array*/nodes, /*Object*/copy){\r\n\t\t// summary:\r\n\t\t//\t\tCalled to initiate the DnD operation.\r\n\r\n\t\tthis.firstIndicator = (source == this);\r\n\t\tthis._calculateCoords(true);\r\n\t\t//this.isDropped = true;\r\n\t\tvar m = dojo.dnd.manager();\r\n\t\tif(nodes[0].coords){\r\n\t\t\tthis._drop.style.height = nodes[0].coords.mh + \"px\";\r\n\t\t\tdojo.style(m.avatar.node, \"width\", nodes[0].coords.mw + \"px\");\r\n\t\t}else{\r\n\t\t\tthis._drop.style.height = m.avatar.node.clientHeight+\"px\";\r\n\t\t}\r\n\t\tthis.dndNodes = nodes;\r\n\t\tdojox.layout.dnd.PlottedDnd.superclass.onDndStart.call(this,source, nodes, copy);\r\n\t\tif(source == this && this.hideSource){\r\n\t\t\tdojo.forEach(nodes, function(n){\r\n\t\t\t\tdojo.style(n, \"display\",\"none\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t\t\r\n\t},\r\n\r\n\tonDndCancel:function(){\r\n\t\t// summary:\r\n\t\t//\t\tCalled to cancel the DnD operation.\r\n\t\tvar m = dojo.dnd.manager();\r\n\t\tif(m.source == this && this.hideSource){\r\n\t\t\tvar nodes = this.getSelectedNodes();\r\n\t\t\tdojo.forEach(nodes, function(n){\r\n\t\t\t\tdojo.style(n, \"display\",\"\");\r\n\t\t\t});\r\n\t\t}\r\n\t\tdojox.layout.dnd.PlottedDnd.superclass.onDndCancel.call(this);\r\n\t\tthis.deleteDashedZone();\r\n\t},\r\n\t\r\n\tonDndDrop: function(source,nodes,copy,target) {\r\n\t\t// summary:\r\n\t\t//\t\tCalled to finish the DnD operation\r\n\t\ttry{\r\n\t\t\tif(!this.isAccepted(nodes[0])){\r\n\t\t\t\tthis.onDndCancel();\r\n\t\t\t}else{\r\n\t\t\t\tif(source == this && this._over && this.dropObject){\r\n\t\t\t\t\tthis.current = this.dropObject.c;\r\n\t\t\t\t}\r\n\t\t\t\tdojox.layout.dnd.PlottedDnd.superclass.onDndDrop.call(this, source, nodes, copy, target);\r\n\t\t\t\tthis._calculateCoords(true);\r\n\t\t\t}\r\n\t\t}catch(e){\r\n\t\t\tconsole.warn(e);\r\n\t\t}\r\n\t},\r\n\t\t\t\r\n\tonMouseDown: function(/*Event*/e) {\r\n\t\t// summary:\r\n\t\t//\t\tEvent processor for onmousedown.\r\n\t\tif(this.current == null){\r\n\t\t\tthis.selection = {};\r\n\t\t}else{\r\n\t\t\tif(this.current == this.anchor){\r\n\t\t\t\tthis.anchor = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(this.current !== null){\r\n\t\t\tvar c = dojo.coords(this.current, true);\r\n\t\t\tthis.current.coords = {\r\n\t\t\t\txy: c,\r\n\t\t\t\tw: this.current.offsetWidth / 2,\r\n\t\t\t\th: this.current.offsetHeight / 2,\r\n\t\t\t\tmh: c.h,\r\n\t\t\t\tmw: c.w\r\n\t\t\t};\r\n\t\t\tthis._drop.style.height = this.current.coords.mh + \"px\";\r\n\t\t\t\r\n\t\t\tif(this.isOffset){\r\n\t\t\t\tif(this.offsetDrag.x == 0 && this.offsetDrag.y == 0){\r\n\t\t\t\t\tvar NoOffsetDrag = true;\r\n\t\t\t\t\tvar coords = dojo.coords(this._getChildByEvent(e));\r\n\t\t\t\t\tthis.offsetDrag.x = coords.x - e.pageX;\r\n\t\t\t\t\tthis.offsetDrag.y = coords.y - e.clientY;\r\n\t\t\t\t}\r\n\t\t\t\tif(this.offsetDrag.y < 16 && this.current != null){\r\n\t\t\t\t\tthis.offsetDrag.y = this.GC_OFFSET_Y;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar m = dojo.dnd.manager();\r\n\t\t\t\tm.OFFSET_X = this.offsetDrag.x;\r\n\t\t\t\tm.OFFSET_Y = this.offsetDrag.y;\r\n\t\t\t\tif (NoOffsetDrag) {\r\n\t\t\t\t\tthis.offsetDrag.x = 0;\r\n\t\t\t\t\tthis.offsetDrag.y = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(dojo.dnd.isFormElement(e)){\r\n\t\t\tthis.setDndItemSelectable(e.target,true);\r\n\t\t}else{\r\n\t\t\tthis.containerSource = true;\r\n\t\t\tvar _draggedWidget = this.getDraggedWidget(e.target);\r\n\t\t\tif(_draggedWidget && _draggedWidget.dragRestriction){\r\n\t\t\t// FIXME: not clear what this was supposed to mean ... this code needs more cleanups.\r\n\t\t\t//\tdragRestriction = true;\r\n\t\t\t}else{\r\n\t\t\t\tdojox.layout.dnd.PlottedDnd.superclass.onMouseDown.call(this,e);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tonMouseUp: function(/*Event*/e) {\r\n\t\t// summary:\r\n\t\t//\t\tEvent processor for onmouseup.\r\n\t\tdojox.layout.dnd.PlottedDnd.superclass.onMouseUp.call(this,e);\r\n\t\tthis.containerSource = false;\r\n\t\tif (!dojo.isIE && this.mouseDown){\r\n\t\t\tthis.setDndItemSelectable(e.target,true);\r\n\t\t}\r\n\t\tvar m = dojo.dnd.manager();\r\n\t\tm.OFFSET_X = this.GC_OFFSET_X;\r\n\t\tm.OFFSET_Y = this.GC_OFFSET_Y;\r\n\t},\r\n\t\r\n\tonMouseMove: function(e) {\r\n\t\t// summary:\r\n\t\t//\t\tEvent processor for onmousemove\r\n\t\tvar m = dojo.dnd.manager();\r\n\t\tif(this.isDragging) {\r\n\t\t\tvar before = false;\r\n\t\t\tif(this.current != null || (this.current == null && !this.dropObject)){\r\n\t\t\t\tif(this.isAccepted(m.nodes[0]) || this.containerSource){\r\n\t\t\t\t\tbefore = this.setIndicatorPosition(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this.current != this.targetAnchor || before != this.before){\r\n\t\t\t\tthis._markTargetAnchor(before);\r\n\t\t\t\tm.canDrop(!this.current || m.source != this || !(this.current.id in this.selection));\r\n\t\t\t}\r\n\r\n\t\t\tif(this.allowAutoScroll){\r\n\t\t\t\tthis._checkAutoScroll(e);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif(this.mouseDown && this.isSource){\r\n\t\t\t\tvar nodes = this.getSelectedNodes();\r\n\t\t\t\tif(nodes.length){\r\n\t\t\t\t\tm.startDrag(this, nodes, this.copyState(dojo.isCopyKey(e)));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(this.allowAutoScroll){\r\n\t\t\t\tthis._stopAutoScroll();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_markTargetAnchor: function(/*Boolean*/before){\r\n\t\t// summary:\r\n\t\t//\t\tAssigns a class to the current target anchor based on \"before\" status\r\n\t\tif(this.current == this.targetAnchor && this.before == before){ return; }\r\n\t\tthis.targetAnchor = this.current;\r\n\t\tthis.targetBox = null;\r\n\t\tthis.before = before;\r\n\t},\r\n\t\r\n\t_unmarkTargetAnchor: function(){\r\n\t\t// summary:\r\n\t\t//\t\tRemoves a class of the current target anchor based on \"before\" status.\r\n\t\tif(!this.targetAnchor){ return; }\r\n\t\tthis.targetAnchor = null;\r\n\t\tthis.targetBox = null;\r\n\t\tthis.before = true;\r\n\t},\r\n\t\r\n\tsetIndicatorPosition: function(/*Event*/e) {\r\n\t\t// summary:\r\n\t\t//\t\tset the position of the drop indicator\r\n\t\tvar before = false;\r\n\t\tif(this.current){\r\n\t\t\tif (!this.current.coords || this.allowAutoScroll) {\r\n\t\t\t\tthis.current.coords = {\r\n\t\t\t\t\txy: dojo.coords(this.current, true),\r\n\t\t\t\t\tw: this.current.offsetWidth / 2,\r\n\t\t\t\t\th: this.current.offsetHeight / 2\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tbefore = this.horizontal ?\r\n\t\t\t\t(e.pageX - this.current.coords.xy.x) < this.current.coords.w :\r\n\t\t\t\t(e.pageY - this.current.coords.xy.y) < this.current.coords.h\r\n\t\t\tthis.insertDashedZone(before);\r\n\t\t}else{\r\n\t\t\tif(!this.dropObject /*|| dojo.isIE*/){ this.insertDashedZone(false); }\r\n\t\t}\r\n\t\treturn before;\r\n\t},\r\n\t\r\n\r\n\tonOverEvent:function(){\r\n\t\tthis._over = true;\r\n\t\tdojox.layout.dnd.PlottedDnd.superclass.onOverEvent.call(this);\r\n\t\tif (this.isDragging) {\r\n\t\t\tvar m = dojo.dnd.manager();\r\n\t\t\tif (!this.current && !this.dropObject && this.getSelectedNodes()[0] && this.isAccepted(m.nodes[0]))\r\n\t\t\t\tthis.insertDashedZone(false);\r\n\t\t}\r\n\t},\r\n\t\r\n\tonOutEvent: function() {\r\n\t\tthis._over = false;\r\n\t\tthis.containerSource = false;\r\n\t\tdojox.layout.dnd.PlottedDnd.superclass.onOutEvent.call(this);\r\n\t\tif (this.dropObject) this.deleteDashedZone();\r\n\t},\r\n\t\r\n\tdeleteDashedZone: function() {\r\n\t\t// summary:\r\n\t\t//\t\thide the dashed zone\r\n\t\tthis._drop.style.display = \"none\";\r\n\t\t\tvar next = this._drop.nextSibling;\r\n\t\t\twhile (next != null) {\r\n\t\t\t\tnext.coords.xy.y -= parseInt(this._drop.style.height);\r\n\t\t\t\tnext = next.nextSibling;\r\n\t\t\t}\r\n\t\tdelete this.dropObject;\r\n\t},\r\n\t\r\n\tinsertDashedZone: function(/*Boolean*/before) {\r\n\t\t// summary:\r\n\t\t//\t\tInsert the dashed zone at the right place\r\n\t\tif(this.dropObject){\r\n\t\t\tif( before == this.dropObject.b &&\r\n\t\t\t\t((this.current && this.dropObject.c == this.current.id) ||\r\n\t\t\t\t(!this.current && !this.dropObject.c))\r\n\t\t\t){\r\n\t\t\t\treturn;\r\n\t\t\t}else{\r\n\t\t\t\tthis.deleteDashedZone();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.dropObject = { n: this._drop, c: this.current ? this.current.id : null, b: before};\r\n\t\tif(this.current){\r\n\t\t\tdojo.place(this._drop, this.current, before ? \"before\" : \"after\");\r\n\t\t\tif(!this.firstIndicator){\r\n\t\t\t\tvar next = this._drop.nextSibling;\r\n\t\t\t\twhile(next != null){\r\n\t\t\t\t\tnext.coords.xy.y += parseInt(this._drop.style.height);\r\n\t\t\t\t\tnext = next.nextSibling;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tthis.firstIndicator = false;\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tthis.node.appendChild(this._drop);\r\n\t\t}\r\n\t\tthis._drop.style.display = \"\";\r\n\t},\r\n\t\r\n\tinsertNodes: function(/*Boolean*/addSelected, /*Array*/data, /*Boolean*/before, /*Node*/anchor){\r\n\t\t// summary:\r\n\t\t//\t\tInserts new data items (see Dojo Container's insertNodes method for details).\r\n\t\tif(this.dropObject){\r\n\t\t\tdojo.style(this.dropObject.n,\"display\",\"none\");\r\n\t\t\tdojox.layout.dnd.PlottedDnd.superclass.insertNodes.call(this,true,data,true,this.dropObject.n);\r\n\t\t\tthis.deleteDashedZone();\r\n\t\t}else{\r\n\t\t\t return dojox.layout.dnd.PlottedDnd.superclass.insertNodes.call(this,addSelected,data,before,anchor);\r\n\t\t}\r\n\t\tvar _widget = dijit.byId(data[0].getAttribute(\"widgetId\"));\r\n\t\tif (_widget) {\r\n\t\t\tdojox.layout.dnd._setGcDndHandle(_widget, this.withHandles, this.handleClasses);\r\n\t\t\tif(this.hideSource)\r\n\t\t\t\tdojo.style(_widget.domNode, \"display\", \"\");\r\n\t\t}\r\n\t},\r\n\t\r\n\t_checkAutoScroll: function(e){\r\n\t\tif(this._timer){\r\n\t\t\tclearTimeout(this._timer);\r\n\t\t}\r\n\t\tthis._stopAutoScroll();\r\n\t\tvar node = this.dom,\r\n\t\t\ty = this._sumAncestorProperties(node,\"offsetTop\")\r\n\t\t;\r\n\t\t//Down\r\n\t\tif( (e.pageY - node.offsetTop +30 ) > node.clientHeight ){\r\n\t\t\tthis.autoScrollActive = true;\r\n\t\t\tthis._autoScrollDown(node);\r\n\t\t} else if ( (node.scrollTop > 0) && (e.pageY - y) < 30){\r\n\t\t\t//Up\r\n\t\t\tthis.autoScrollActive = true;\r\n\t\t\tthis._autoScrollUp(node);\r\n\t\t}\r\n\t},\r\n\r\n\t_autoScrollUp: function(node){\r\n\t\tif( this.autoScrollActive && node.scrollTop > 0) {\r\n\t\t\tnode.scrollTop -= 30;\r\n\t\t\tthis._timer = setTimeout(dojo.hitch(this,\"_autoScrollUp\",node), 100);\r\n\t\t}\r\n\t},\r\n\r\n\t_autoScrollDown: function(node){\r\n\t\tif( this.autoScrollActive && (node.scrollTop < (node.scrollHeight-node.clientHeight))){\r\n\t\t\tnode.scrollTop += 30;\r\n\t\t\tthis._timer = setTimeout(dojo.hitch(this, \"_autoScrollDown\",node), 100);\r\n\t\t}\r\n\t},\r\n\r\n\t_stopAutoScroll: function(){\r\n\t\tthis.autoScrollActive = false;\r\n\t},\r\n\r\n\t_sumAncestorProperties: function(node, prop){\r\n\t\t// summary:\r\n\t\t//\t\tReturns the sum of the passed property on all ancestors of node.\r\n\t\tnode = dojo.byId(node);\r\n\t\tif(!node){ return 0; }\r\n\t\t\r\n\t\tvar retVal = 0;\r\n\t\twhile(node){\r\n\t\t\tvar val = node[prop];\r\n\t\t\tif(val){\r\n\t\t\t\tretVal += val - 0;\r\n\t\t\t\tif(node == dojo.body()){ break; }// opera and khtml #body & #html has the same values, we only need one value\r\n\t\t\t}\r\n\t\t\tnode = node.parentNode;\r\n\t\t}\r\n\t\treturn retVal;\t//\tinteger\r\n\t}\r\n\t\r\n});\r\n\r\ndojox.layout.dnd._setGcDndHandle = function(service,withHandles,handleClasses, first) {\r\n\tvar cls = \"GcDndHandle\";\r\n\tif(!first){\r\n\t\tdojo.query(\".GcDndHandle\", service.domNode).removeClass(cls);\r\n\t}\r\n\tif(!withHandles){\r\n\t\tdojo.addClass(service.domNode, cls);\r\n\t}else{\r\n\t\tvar _hasHandle = false;\r\n\t\tfor(var i = handleClasses.length - 1; i >= 0; i--){\r\n\t\t\tvar _node = dojo.query(\".\" + handleClasses[i], service.domNode)[0];\r\n\t\t\tif(_node){\r\n\t\t\t\t_hasHandle = true;\r\n\t\t\t\tif(handleClasses[i] != cls){\r\n\t\t\t\t\tvar _gripNode = dojo.query(\".\" + cls, service.domNode);\r\n\t\t\t\t\tif(_gripNode.length == 0){\r\n\t\t\t\t\t\tdojo.removeClass(service.domNode, cls);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t_gripNode.removeClass(cls);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdojo.addClass(_node, cls);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!_hasHandle){\r\n\t\t\tdojo.addClass(service.domNode, cls);\r\n\t\t}\r\n\t}\r\n};\r\n\r\ndojo.declare(\"dojox.layout.dnd.DropIndicator\", null, {\r\n\t// summary:\r\n\t//\t\tAn empty widget to show at the user the drop zone of the widget.\r\n\tconstructor: function(/*String*/cn, /*String*/tag) {\r\n\t\tthis.tag = tag || \"div\";\r\n\t\tthis.style = cn || null;\r\n\t},\r\n\r\n\tisInserted : function(){\r\n\t\treturn (this.node.parentNode && this.node.parentNode.nodeType==1);\r\n\t},\r\n\r\n\tcreate : function(/*Node*//*nodeRef*/){\r\n\t\tif(this.node && this.isInserted()){ return this.node; }\r\n\t\tvar h = \"90px\",\r\n\t\t\tel = dojo.doc.createElement(this.tag);\r\n\t\t\t\r\n\t\tif(this.style){\r\n\t\t\tel.className = this.style;\r\n\t\t\tel.style.height = h;\r\n\t\t}else{\r\n\t\t\t// FIXME: allow this to be done mostly in CSS?\r\n\t\t\tdojo.style(el, {\r\n\t\t\t\tposition:\"relative\",\r\n\t\t\t\tborder:\"1px dashed #F60\",\r\n\t\t\t\tmargin:\"2px\",\r\n\t\t\t\theight: h\r\n\t\t\t})\r\n\t\t}\r\n\t\tthis.node = el;\r\n\t\treturn el;\r\n\t},\r\n\t\r\n\tdestroy : function(){\r\n\t\tif(!this.node || !this.isInserted()){ return; }\r\n\t\tthis.node.parentNode.removeChild(this.node);\r\n\t\tthis.node = null;\r\n\t}\r\n});\r\n\r\ndojo.extend(dojo.dnd.Manager, {\r\n\t\r\n\tcanDrop: function(flag){\r\n\t\tvar canDropFlag = this.target && flag;\r\n\t\tif(this.canDropFlag != canDropFlag){\r\n\t\t\tthis.canDropFlag = canDropFlag;\r\n\t\t\tif(this.avatar){ this.avatar.update(); }\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\tmakeAvatar: function(){\r\n\t\t// summary:\r\n\t\t//\t\tMakes the avatar, it is separate to be overwritten dynamically, if needed.\r\n\t\treturn (this.source.declaredClass == \"dojox.layout.dnd.PlottedDnd\") ?\r\n\t\t\tnew dojox.layout.dnd.Avatar(this, this.source.opacity) :\r\n\t\t\tnew dojo.dnd.Avatar(this)\r\n\t\t;\r\n\t}\r\n});\r\n\r\nif(dojo.isIE){\r\n\tdojox.layout.dnd.handdleIE = [\r\n\t\tdojo.subscribe(\"/dnd/start\", null, function(){\r\n\t\t\tIEonselectstart = document.body.onselectstart;\r\n\t\t\tdocument.body.onselectstart = function(){ return false; };\r\n\t\t}),\r\n\t\tdojo.subscribe(\"/dnd/cancel\", null, function(){\r\n\t\t\tdocument.body.onselectstart = IEonselectstart;\r\n\t\t}),\r\n\t\tdojo.subscribe(\"/dnd/drop\", null, function(){\r\n\t\t\tdocument.body.onselectstart = IEonselectstart;\r\n\t\t})\r\n\t];\r\n\tdojo.addOnWindowUnload(function(){\r\n\t\tdojo.forEach(dojox.layout.dnd.handdleIE, dojo.unsubscribe);\r\n\t});\r\n}\r\n"]}