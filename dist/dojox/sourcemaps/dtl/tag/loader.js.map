{"version":3,"sources":["dtl/tag/loader.js"],"names":["define","lang","dd","array","connect","ddtl","getObject","BlockNode","extend","name","nodelist","this","super","parent","html","dummyRender","context","String","safe","render","buffer","blocks","block","used","rendered","push","getParent","bufferParent","setParent","node","up","root","disconnect","pop","unrender","clone","constructor","toString","ExtendsNode","getTemplate","shared","key","parents","string","get","Error","url","templatePath","templateString","indexOf","substring","length","dojox","dtl","text","getTemplateString","i","contents","tag","loader","old","IncludeNode","path","constant","parsed","_path","_Filter","arguments","_cache","location","resolve","Number","dirty","last","cache","_resolveTemplateArg","template","_TextNode","set","div","document","createElement","innerHTML","children","childNodes","removed","removeChild","child","cloneNode","concat","remove","mixin","parser","token","split","_blocks","parse","rtrim","next_token","extends_","parts","charAt","include","slice","create_text_node","ssi","Token","token_type","join"],"mappings":"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","file":"../../../dtl/tag/loader.js","sourcesContent":["define([\r\n\t\"dojo/_base/lang\",\r\n\t\"../_base\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/connect\"\r\n], function(lang,dd,array,connect){\r\n\r\n\tvar ddtl = lang.getObject(\"tag.loader\", true, dd);\r\n\t/*=====\r\n\t ddtl = {\r\n\t \t// TODO: summary\r\n\t };\r\n\t =====*/\r\n\r\n\tddtl.BlockNode = lang.extend(function(name, nodelist){\r\n\t\tthis.name = name;\r\n\t\tthis.nodelist = nodelist; // Can be overridden\r\n\t},\r\n\t{\r\n\t\t\"super\": function(){\r\n\t\t\tif(this.parent){\r\n\t\t\t\tvar html = this.parent.nodelist.dummyRender(this.context, null, true);\r\n\t\t\t\tif(typeof html == \"string\"){\r\n\t\t\t\t\thtml = new String(html);\r\n\t\t\t\t}\r\n\t\t\t\thtml.safe = true;\r\n\t\t\t\treturn html;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t},\r\n\t\trender: function(context, buffer){\r\n\t\t\tvar name = this.name;\r\n\t\t\tvar nodelist = this.nodelist;\r\n\t\t\tvar parent;\r\n\t\t\tif(buffer.blocks){\r\n\t\t\t\tvar block = buffer.blocks[name];\r\n\t\t\t\tif(block){\r\n\t\t\t\t\tparent = block.parent;\r\n\t\t\t\t\tnodelist = block.nodelist;\r\n\t\t\t\t\tblock.used = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.rendered = nodelist;\r\n\r\n\t\t\tcontext = context.push();\r\n\t\t\tthis.context = context;\r\n\t\t\tthis.parent = null;\r\n\t\t\tif(nodelist != this.nodelist){\r\n\t\t\t\tthis.parent = this;\r\n\t\t\t}\r\n\t\t\tcontext.block = this;\r\n\r\n\t\t\tif(buffer.getParent){\r\n\t\t\t\tvar bufferParent = buffer.getParent();\r\n\t\t\t\tvar setParent = connect.connect(buffer, \"onSetParent\", function(node, up, root){\r\n\t\t\t\t\tif(up && root){\r\n\t\t\t\t\t\tbuffer.setParent(bufferParent);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tbuffer = nodelist.render(context, buffer, this);\r\n\t\t\tsetParent && connect.disconnect(setParent);\r\n\t\t\tcontext = context.pop();\r\n\t\t\treturn buffer;\r\n\t\t},\r\n\t\tunrender: function(context, buffer){\r\n\t\t\treturn this.rendered.unrender(context, buffer);\r\n\t\t},\r\n\t\tclone: function(buffer){\r\n\t\t\treturn new this.constructor(this.name, this.nodelist.clone(buffer));\r\n\t\t},\r\n\t\ttoString: function(){ return \"dojox.dtl.tag.loader.BlockNode\"; }\r\n\t});\r\n\r\n\tddtl.ExtendsNode = lang.extend(function(getTemplate, nodelist, shared, parent, key){\r\n\t\tthis.getTemplate = getTemplate;\r\n\t\tthis.nodelist = nodelist;\r\n\t\tthis.shared = shared;\r\n\t\tthis.parent = parent;\r\n\t\tthis.key = key;\r\n\t},\r\n\t{\r\n\t\tparents: {},\r\n\t\tgetParent: function(context){\r\n\t\t\tvar parent = this.parent;\r\n\t\t\tif(!parent){\r\n\t\t\t\tvar string;\r\n\t\t\t\tparent = this.parent = context.get(this.key, false);\r\n\t\t\t\tif(!parent){\r\n\t\t\t\t\tthrow new Error(\"extends tag used a variable that did not resolve\");\r\n\t\t\t\t}\r\n\t\t\t\tif(typeof parent == \"object\"){\r\n\t\t\t\t\tvar url = parent.url || parent.templatePath;\r\n\t\t\t\t\tif(parent.shared){\r\n\t\t\t\t\t\tthis.shared = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(url){\r\n\t\t\t\t\t\tparent = this.parent = url.toString();\r\n\t\t\t\t\t}else if(parent.templateString){\r\n\t\t\t\t\t\t// Allow the builder's string interning to work\r\n\t\t\t\t\t\tstring = parent.templateString;\r\n\t\t\t\t\t\tparent = this.parent = \" \";\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tparent = this.parent = this.parent.toString();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(parent && parent.indexOf(\"shared:\") === 0){\r\n\t\t\t\t\tthis.shared = true;\r\n\t\t\t\t\tparent = this.parent = parent.substring(7, parent.length);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!parent){\r\n\t\t\t\tthrow new Error(\"Invalid template name in 'extends' tag.\");\r\n\t\t\t}\r\n\t\t\tif(parent.render){\r\n\t\t\t\treturn parent;\r\n\t\t\t}\r\n\t\t\tif(this.parents[parent]){\r\n\t\t\t\treturn this.parents[parent];\r\n\t\t\t}\r\n\t\t\tthis.parent = this.getTemplate(string || dojox.dtl.text.getTemplateString(parent));\r\n\t\t\tif(this.shared){\r\n\t\t\t\tthis.parents[parent] = this.parent;\r\n\t\t\t}\r\n\t\t\treturn this.parent;\r\n\t\t},\r\n\t\trender: function(context, buffer){\r\n\t\t\tvar parent = this.getParent(context);\r\n\r\n\t\t\tparent.blocks = parent.blocks || {};\r\n\t\t\tbuffer.blocks = buffer.blocks || {};\r\n\r\n\t\t\tfor(var i = 0, node; node = this.nodelist.contents[i]; i++){\r\n\t\t\t\tif(node instanceof dojox.dtl.tag.loader.BlockNode){\r\n\t\t\t\t\tvar old = parent.blocks[node.name];\r\n\t\t\t\t\tif(old && old.nodelist != node.nodelist){\r\n\t\t\t\t\t\t// In a shared template, the individual blocks might change\r\n\t\t\t\t\t\tbuffer = old.nodelist.unrender(context, buffer);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tparent.blocks[node.name] = buffer.blocks[node.name] = {\r\n\t\t\t\t\t\tshared: this.shared,\r\n\t\t\t\t\t\tnodelist: node.nodelist,\r\n\t\t\t\t\t\tused: false\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.rendered = parent;\r\n\t\t\treturn parent.nodelist.render(context, buffer, this);\r\n\t\t},\r\n\t\tunrender: function(context, buffer){\r\n\t\t\treturn this.rendered.unrender(context, buffer, this);\r\n\t\t},\r\n\t\ttoString: function(){ return \"dojox.dtl.block.ExtendsNode\"; }\r\n\t});\r\n\r\n\tddtl.IncludeNode = lang.extend(function(path, constant, getTemplate, text, parsed){\r\n\t\tthis._path = path;\r\n\t\tthis.constant = constant;\r\n\t\tthis.path = (constant) ? path : new dd._Filter(path);\r\n\t\tthis.getTemplate = getTemplate;\r\n\t\tthis.text = text;\r\n\t\tthis.parsed = (arguments.length == 5) ? parsed : true;\r\n\t},\r\n\t{\r\n\t\t_cache: [{}, {}],\r\n\t\trender: function(context, buffer){\r\n\t\t\tvar location = ((this.constant) ? this.path : this.path.resolve(context)).toString();\r\n\t\t\tvar parsed = Number(this.parsed);\r\n\t\t\tvar dirty = false;\r\n\t\t\tif(location != this.last){\r\n\t\t\t\tdirty = true;\r\n\t\t\t\tif(this.last){\r\n\t\t\t\t\tbuffer = this.unrender(context, buffer);\r\n\t\t\t\t}\r\n\t\t\t\tthis.last = location;\r\n\t\t\t}\r\n\r\n\t\t\tvar cache = this._cache[parsed];\r\n\r\n\t\t\tif(parsed){\r\n\t\t\t\tif(!cache[location]){\r\n\t\t\t\t\tcache[location] = dd.text._resolveTemplateArg(location, true);\r\n\t\t\t\t}\r\n\t\t\t\tif(dirty){\r\n\t\t\t\t\tvar template = this.getTemplate(cache[location]);\r\n\t\t\t\t\tthis.rendered = template.nodelist;\r\n\t\t\t\t}\r\n\t\t\t\treturn this.rendered.render(context, buffer, this);\r\n\t\t\t}else{\r\n\t\t\t\tif(this.text instanceof dd._TextNode){\r\n\t\t\t\t\tif(dirty){\r\n\t\t\t\t\t\tthis.rendered = this.text;\r\n\t\t\t\t\t\tthis.rendered.set(dd.text._resolveTemplateArg(location, true));\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this.rendered.render(context, buffer);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(!cache[location]){\r\n\t\t\t\t\t\tvar nodelist = [];\r\n\t\t\t\t\t\tvar div = document.createElement(\"div\");\r\n\t\t\t\t\t\tdiv.innerHTML = dd.text._resolveTemplateArg(location, true);\r\n\t\t\t\t\t\tvar children = div.childNodes;\r\n\t\t\t\t\t\twhile(children.length){\r\n\t\t\t\t\t\t\tvar removed = div.removeChild(children[0]);\r\n\t\t\t\t\t\t\tnodelist.push(removed);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcache[location] = nodelist;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(dirty){\r\n\t\t\t\t\t\tthis.nodelist = [];\r\n\t\t\t\t\t\tvar exists = true;\r\n\t\t\t\t\t\tfor(var i = 0, child; child = cache[location][i]; i++){\r\n\t\t\t\t\t\t\tthis.nodelist.push(child.cloneNode(true));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(var i = 0, node; node = this.nodelist[i]; i++){\r\n\t\t\t\t\t\tbuffer = buffer.concat(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn buffer;\r\n\t\t},\r\n\t\tunrender: function(context, buffer){\r\n\t\t\tif(this.rendered){\r\n\t\t\t\tbuffer = this.rendered.unrender(context, buffer);\r\n\t\t\t}\r\n\t\t\tif(this.nodelist){\r\n\t\t\t\tfor(var i = 0, node; node = this.nodelist[i]; i++){\r\n\t\t\t\t\tbuffer = buffer.remove(node);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn buffer;\r\n\t\t},\r\n\t\tclone: function(buffer){\r\n\t\t\treturn new this.constructor(this._path, this.constant, this.getTemplate, this.text.clone(buffer), this.parsed);\r\n\t\t}\r\n\t});\r\n\r\n\tlang.mixin(ddtl, {\r\n\t\tblock: function(parser, token){\r\n\t\t\tvar parts = token.contents.split();\r\n\t\t\tvar name = parts[1];\r\n\r\n\t\t\tparser._blocks = parser._blocks || {};\r\n\t\t\tparser._blocks[name] = parser._blocks[name] || [];\r\n\t\t\tparser._blocks[name].push(name);\r\n\r\n\t\t\tvar nodelist = parser.parse([\"endblock\", \"endblock \" + name]).rtrim();\r\n\t\t\tparser.next_token();\r\n\t\t\treturn new dojox.dtl.tag.loader.BlockNode(name, nodelist);\r\n\t\t},\r\n\t\textends_: function(parser, token){\r\n\t\t\tvar parts = token.contents.split();\r\n\t\t\tvar shared = false;\r\n\t\t\tvar parent = null;\r\n\t\t\tvar key = null;\r\n\t\t\tif(parts[1].charAt(0) == '\"' || parts[1].charAt(0) == \"'\"){\r\n\t\t\t\tparent = parts[1].substring(1, parts[1].length - 1);\r\n\t\t\t}else{\r\n\t\t\t\tkey = parts[1];\r\n\t\t\t}\r\n\t\t\tif(parent && parent.indexOf(\"shared:\") == 0){\r\n\t\t\t\tshared = true;\r\n\t\t\t\tparent = parent.substring(7, parent.length);\r\n\t\t\t}\r\n\t\t\tvar nodelist = parser.parse();\r\n\t\t\treturn new dojox.dtl.tag.loader.ExtendsNode(parser.getTemplate, nodelist, shared, parent, key);\r\n\t\t},\r\n\t\tinclude: function(parser, token){\r\n\t\t\tvar parts = token.contents.split();\r\n\t\t\tif(parts.length != 2){\r\n\t\t\t\tthrow new Error(parts[0] + \" tag takes one argument: the name of the template to be included\");\r\n\t\t\t}\r\n\t\t\tvar path = parts[1];\r\n\t\t\tvar constant = false;\r\n\t\t\tif((path.charAt(0) == '\"' || path.slice(-1) == \"'\") && path.charAt(0) == path.slice(-1)){\r\n\t\t\t\tpath = path.slice(1, -1);\r\n\t\t\t\tconstant = true;\r\n\t\t\t}\r\n\t\t\treturn new ddtl.IncludeNode(path, constant, parser.getTemplate, parser.create_text_node());\r\n\t\t},\r\n\t\tssi: function(parser, token){\r\n\t\t\t// We're going to treat things a little differently here.\r\n\t\t\t// First of all, this tag is *not* portable, so I'm not\r\n\t\t\t// concerned about it being a \"drop in\" replacement.\r\n\r\n\t\t\t// Instead, we'll just replicate the include tag, but with that\r\n\t\t\t// optional \"parsed\" parameter.\r\n\t\t\tvar parts = token.contents.split();\r\n\t\t\tvar parsed = false;\r\n\t\t\tif(parts.length == 3){\r\n\t\t\t\tparsed = (parts.pop() == \"parsed\");\r\n\t\t\t\tif(!parsed){\r\n\t\t\t\t\tthrow new Error(\"Second (optional) argument to ssi tag must be 'parsed'\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar node = ddtl.include(parser, new dd.Token(token.token_type, parts.join(\" \")));\r\n\t\t\tnode.parsed = parsed;\r\n\t\t\treturn node;\r\n\t\t}\r\n\t});\r\n\r\n\treturn ddtl;\r\n});"]}