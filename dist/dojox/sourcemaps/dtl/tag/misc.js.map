{"version":3,"sources":["dtl/tag/misc.js"],"names":["define","lang","array","connect","dd","ddtm","getObject","DebugNode","extend","text","this","render","context","buffer","key","keys","getKeys","debug","only","i","console","set","unrender","clone","constructor","toString","FilterNode","varnode","nodelist","_varnode","_nodelist","output","dojox","string","Builder","update","var","pop","_expression","FirstOfNode","vars","_vars","map","item","dtl","_Filter","contents","resolved","resolve","SpacelessNode","getParent","watch","disconnect","value","dummyRender","replace","_isEmpty","node","nodeType","data","match","_watch","parentNode","firstChild","removeChild","children","childNodes","length","_watchParent","last","TemplateTagNode","tag","mapping","openblock","closeblock","openvariable","closevariable","openbrace","closebrace","opencomment","closecomment","WidthRatioNode","current","max","width","Math","round","getExpression","WithNode","target","alias","push","mixin","comment","parser","token","skip_past","_noOpNode","create_text_node","filter","rest","split","create_variable_node","parse","next_token","firstof","parts","split_contents","slice","Error","spaceless","delete_first_token","templatetag","prototype","join","widthratio","with_"],"mappings":";;;;;;;AAAAA,QACC,kBACA,mBACA,qBACA,YACE,SAASC,EAAKC,EAAMC,EAAQC,GAE9B,IAAIC,EAAOJ,EAAKK,UAAU,YAAY,EAAMF,GAiS5C,OA1RAC,EAAKE,UAAYN,EAAKO,OAAO,SAASC,GACrCC,KAAKD,KAAOA,IAGZE,OAAQ,SAASC,EAASC,GAIzB,IAHA,IAGeC,EAHXC,EAAOH,EAAQI,UACfC,KACAC,KACIC,EAAI,EAAQL,EAAMC,EAAKI,GAAIA,IAClCD,EAAKJ,GAAOF,EAAQE,GACpBG,GAAS,IAAMH,EAAM,YAAcF,EAAQE,GAAO,MAGnD,OADAM,QAAQH,MAAMC,GACPR,KAAKD,KAAKY,IAAIJ,GAAON,OAAOC,EAASC,EAAQH,OAErDY,SAAU,SAASV,EAASC,GAC3B,OAAOA,GAERU,MAAO,SAASV,GACf,OAAO,IAAIH,KAAKc,YAAYd,KAAKD,KAAKc,MAAMV,KAE7CY,SAAU,WAAY,MAAO,oBAG9BpB,EAAKqB,WAAazB,EAAKO,OAAO,SAASmB,EAASC,GAC/ClB,KAAKmB,SAAWF,EAChBjB,KAAKoB,UAAYF,IAGjBjB,OAAQ,SAASC,EAASC,GAEzB,IAAIkB,EAASrB,KAAKoB,UAAUnB,OAAOC,EAAS,IAAIoB,MAAMC,OAAOC,SAC7DtB,EAAUA,EAAQuB,QAASC,IAAOL,EAAON,aAC1Bf,KAAKmB,SAASlB,OAAOC,EAASC,GAE7C,OADAD,EAAUA,EAAQyB,MACXxB,GAERS,SAAU,SAASV,EAASC,GAC3B,OAAOA,GAERU,MAAO,SAASV,GACf,OAAO,IAAIH,KAAKc,YAAYd,KAAK4B,YAAa5B,KAAKoB,UAAUP,MAAMV,OAIrER,EAAKkC,YAActC,EAAKO,OAAO,SAASgC,EAAM/B,GAC7CC,KAAK+B,MAAQD,EACb9B,KAAK8B,KAAOtC,EAAMwC,IAAIF,EAAM,SAASG,GACpC,OAAO,IAAIX,MAAMY,IAAIC,QAAQF,KAE9BjC,KAAKoC,SAAWrC,IAGhBE,OAAQ,SAASC,EAASC,GACzB,IAAI,IAAW8B,EAAPxB,EAAI,EAASwB,EAAOjC,KAAK8B,KAAKrB,GAAIA,IAAI,CAC7C,IAAI4B,EAAWJ,EAAKK,QAAQpC,GAC5B,QAAsB,IAAZmC,EAKT,OAJgB,OAAbA,IACFA,EAAW,QAEZrC,KAAKoC,SAASzB,IAAI0B,GACXrC,KAAKoC,SAASnC,OAAOC,EAASC,GAGvC,OAAOH,KAAKoC,SAASxB,SAASV,EAASC,IAExCS,SAAU,SAASV,EAASC,GAC3B,OAAOH,KAAKoC,SAASxB,SAASV,EAASC,IAExCU,MAAO,SAASV,GACf,OAAO,IAAIH,KAAKc,YAAYd,KAAK+B,MAAO/B,KAAKoC,SAASvB,MAAMV,OAI9DR,EAAK4C,cAAgBhD,EAAKO,OAAO,SAASoB,EAAUnB,GACnDC,KAAKkB,SAAWA,EAChBlB,KAAKoC,SAAWrC,IAGhBE,OAAQ,SAASC,EAASC,GACzB,GAAGA,EAAOqC,UAAU,CAEnB,IAAIC,GACHhD,EAAQA,QAAQU,EAAQ,oBAAqBH,KAAM,UACnDP,EAAQA,QAAQU,EAAQ,cAAeH,KAAM,iBAE9CG,EAASH,KAAKkB,SAASjB,OAAOC,EAASC,GACvCV,EAAQiD,WAAWD,EAAM,IACzBhD,EAAQiD,WAAWD,EAAM,QACrB,CACJ,IAAIE,EAAQ3C,KAAKkB,SAAS0B,YAAY1C,GACtCF,KAAKoC,SAASzB,IAAIgC,EAAME,QAAQ,SAAU,OAC1C1C,EAASH,KAAKoC,SAASnC,OAAOC,EAASC,GAExC,OAAOA,GAERS,SAAU,SAASV,EAASC,GAC3B,OAAOH,KAAKkB,SAASN,SAASV,EAASC,IAExCU,MAAO,SAASV,GACf,OAAO,IAAIH,KAAKc,YAAYd,KAAKkB,SAASL,MAAMV,GAASH,KAAKoC,SAASvB,MAAMV,KAE9E2C,SAAU,SAASC,GAClB,OAAyB,GAAjBA,EAAKC,WAAkBD,EAAKE,KAAKC,MAAM,YAEhDC,OAAQ,SAASJ,GAChB,GAAG/C,KAAK8C,SAASC,GAAM,CAEnBA,EAAKK,WAAWC,YAAcN,GAChCA,EAAKK,WAAWE,YAAYP,OAEzB,CACJ,IAAIQ,EAAWR,EAAKK,WAAWI,WAC/B,GAAoB,GAAjBT,EAAKC,UAAiBO,EAASE,OAAS,EAC1C,IAAI,IAAIhD,EAAI,EAAkB8C,EAAS9C,GAAIA,IAC1C,GAA+B,GAA5B8C,EAAS9C,EAAI,GAAGuC,UAAiBhD,KAAK8C,SAASS,EAAS9C,EAAI,IAE9D,YADAsC,EAAKK,WAAWE,YAAYC,EAAS9C,EAAI,MAO9CiD,aAAc,SAASX,GAEtB,GADeA,EAAKS,WACRC,OACX,KAAMV,EAAKS,WAAWC,QAAO,CAC5B,IAAIE,EAAOZ,EAAKS,WAAWT,EAAKS,WAAWC,OAAS,GACpD,IAAIzD,KAAK8C,SAASa,GACjB,OAEDZ,EAAKO,YAAYK,OAMrBhE,EAAKiE,gBAAkBrE,EAAKO,OAAO,SAAS+D,EAAK9D,GAChDC,KAAK6D,IAAMA,EACX7D,KAAKoC,SAAWrC,IAGhB+D,SACCC,UAAW,KACXC,WAAY,KACZC,aAAc,KACdC,cAAe,KACfC,UAAW,IACXC,WAAY,IACZC,YAAa,KACbC,aAAc,MAEfrE,OAAQ,SAASC,EAASC,GAEzB,OADAH,KAAKoC,SAASzB,IAAIX,KAAK8D,QAAQ9D,KAAK6D,MAC7B7D,KAAKoC,SAASnC,OAAOC,EAASC,IAEtCS,SAAU,SAASV,EAASC,GAC3B,OAAOH,KAAKoC,SAASxB,SAASV,EAASC,IAExCU,MAAO,SAASV,GACf,OAAO,IAAIH,KAAKc,YAAYd,KAAK6D,IAAK7D,KAAKoC,SAASvB,MAAMV,OAI5DR,EAAK4E,eAAiBhF,EAAKO,OAAO,SAAS0E,EAASC,EAAKC,EAAO3E,GAC/DC,KAAKwE,QAAU,IAAI9E,EAAGyC,QAAQqC,GAC9BxE,KAAKyE,IAAM,IAAI/E,EAAGyC,QAAQsC,GAC1BzE,KAAK0E,MAAQA,EACb1E,KAAKoC,SAAWrC,IAGhBE,OAAQ,SAASC,EAASC,GACzB,IAAIqE,GAAWxE,KAAKwE,QAAQlC,QAAQpC,GAChCuE,GAAOzE,KAAKyE,IAAInC,QAAQpC,GAM5B,MALqB,iBAAXsE,GAAqC,iBAAPC,GAAoBA,EAG3DzE,KAAKoC,SAASzB,IAAI,GAAKgE,KAAKC,MAAOJ,EAAUC,EAAOzE,KAAK0E,QAFzD1E,KAAKoC,SAASzB,IAAI,IAIZX,KAAKoC,SAASnC,OAAOC,EAASC,IAEtCS,SAAU,SAASV,EAASC,GAC3B,OAAOH,KAAKoC,SAASxB,SAASV,EAASC,IAExCU,MAAO,SAASV,GACf,OAAO,IAAIH,KAAKc,YAAYd,KAAKwE,QAAQK,gBAAiB7E,KAAKyE,IAAII,gBAAiB7E,KAAK0E,MAAO1E,KAAKoC,SAASvB,MAAMV,OAItHR,EAAKmF,SAAWvF,EAAKO,OAAO,SAASiF,EAAQC,EAAO9D,GACnDlB,KAAK+E,OAAS,IAAIrF,EAAGyC,QAAQ4C,GAC7B/E,KAAKgF,MAAQA,EACbhF,KAAKkB,SAAWA,IAGhBjB,OAAQ,SAASC,EAASC,GACzB,IAAI4E,EAAS/E,KAAK+E,OAAOzC,QAAQpC,GAKjC,OAJAA,EAAUA,EAAQ+E,QACVjF,KAAKgF,OAASD,EACtB5E,EAASH,KAAKkB,SAASjB,OAAOC,EAASC,GACvCD,EAAUA,EAAQyB,MACXxB,GAERS,SAAU,SAASV,EAASC,GAC3B,OAAOA,GAERU,MAAO,SAASV,GACf,OAAO,IAAIH,KAAKc,YAAYd,KAAK+E,OAAOF,gBAAiB7E,KAAKgF,MAAOhF,KAAKkB,SAASL,MAAMV,OAI3FZ,EAAK2F,MAAMvF,GACVwF,QAAS,SAASC,EAAQC,GAIzB,OADAD,EAAOE,UAAU,cACV5F,EAAG6F,WAEXhF,MAAO,SAAS6E,EAAQC,GAGvB,OAAO,IAAI1F,EAAKE,UAAUuF,EAAOI,qBAElCC,OAAQ,SAASL,EAAQC,GAGxB,IAAIK,EAAOL,EAAMjD,SAASuD,MAAM,KAAM,GAAG,GACrC1E,EAAUmE,EAAOQ,qBAAqB,OAASF,GAC/CxE,EAAWkE,EAAOS,OAAO,cAE7B,OADAT,EAAOU,aACA,IAAInG,EAAKqB,WAAWC,EAASC,IAErC6E,QAAS,SAASX,EAAQC,GACzB,IAAIW,EAAQX,EAAMY,iBAAiBC,MAAM,GACzC,IAAIF,EAAMvC,OACT,MAAM,IAAI0C,MAAM,sDAEjB,OAAO,IAAIxG,EAAKkC,YAAYmE,EAAOZ,EAAOI,qBAE3CY,UAAW,SAAShB,EAAQC,GAC3B,IAAInE,EAAWkE,EAAOS,OAAO,iBAE7B,OADAT,EAAOiB,qBACA,IAAI1G,EAAK4C,cAAcrB,EAAUkE,EAAOI,qBAEhDc,YAAa,SAASlB,EAAQC,GAC7B,IAAIW,EAAQX,EAAMjD,SAASuD,QAC3B,GAAmB,GAAhBK,EAAMvC,OACR,MAAM,IAAI0C,MAAM,8CAEjB,IAAItC,EAAMmC,EAAM,GACZlC,EAAUnE,EAAKiE,gBAAgB2C,UAAUzC,QAC7C,IAAIA,EAAQD,GAAK,CAChB,IAAIxD,KACJ,IAAI,IAAID,KAAO0D,EACdzD,EAAK4E,KAAK7E,GAEX,MAAM,IAAI+F,MAAM,kCAAoCtC,EAAM,sBAAwBxD,EAAKmG,KAAK,OAE7F,OAAO,IAAI7G,EAAKiE,gBAAgBC,EAAKuB,EAAOI,qBAE7CiB,WAAY,SAASrB,EAAQC,GAC5B,IAAIW,EAAQX,EAAMjD,SAASuD,QAC3B,GAAmB,GAAhBK,EAAMvC,OACR,MAAM,IAAI0C,MAAM,oCAEjB,IAAIzB,GAASsB,EAAM,GACnB,GAAmB,iBAATtB,EACT,MAAM,IAAIyB,MAAM,gDAEjB,OAAO,IAAIxG,EAAK4E,eAAeyB,EAAM,GAAIA,EAAM,GAAItB,EAAOU,EAAOI,qBAElEkB,MAAO,SAAStB,EAAQC,GACvB,IAAIW,EAAQX,EAAMY,iBAClB,GAAmB,GAAhBD,EAAMvC,QAA2B,MAAZuC,EAAM,GAC7B,MAAM,IAAIG,MAAM,oDAEjB,IAAIjF,EAAWkE,EAAOS,OAAO,YAE7B,OADAT,EAAOU,aACA,IAAInG,EAAKmF,SAASkB,EAAM,GAAIA,EAAM,GAAI9E,MAIxCvB","file":"../../../dtl/tag/misc.js","sourcesContent":["define([\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/connect\",\r\n\t\"../_base\"\r\n], function(lang,array,connect,dd){\r\n\r\n\tvar ddtm = lang.getObject(\"tag.misc\", true, dd);\r\n\t/*=====\r\n\t ddtm = {\r\n\t \t// TODO: summary\r\n\t };\r\n\t =====*/\r\n\r\n\tddtm.DebugNode = lang.extend(function(text){\r\n\t\tthis.text = text;\r\n\t},\r\n\t{\r\n\t\trender: function(context, buffer){\r\n\t\t\tvar keys = context.getKeys();\r\n\t\t\tvar debug = [];\r\n\t\t\tvar only = {};\r\n\t\t\tfor(var i = 0, key; key = keys[i]; i++){\r\n\t\t\t\tonly[key] = context[key];\r\n\t\t\t\tdebug += \"[\" + key + \": \" + typeof context[key] + \"]\\n\";\r\n\t\t\t}\r\n\t\t\tconsole.debug(only);\r\n\t\t\treturn this.text.set(debug).render(context, buffer, this);\r\n\t\t},\r\n\t\tunrender: function(context, buffer){\r\n\t\t\treturn buffer;\r\n\t\t},\r\n\t\tclone: function(buffer){\r\n\t\t\treturn new this.constructor(this.text.clone(buffer));\r\n\t\t},\r\n\t\ttoString: function(){ return \"ddtm.DebugNode\"; }\r\n\t});\r\n\r\n\tddtm.FilterNode = lang.extend(function(varnode, nodelist){\r\n\t\tthis._varnode = varnode;\r\n\t\tthis._nodelist = nodelist;\r\n\t},\r\n\t{\r\n\t\trender: function(context, buffer){\r\n\t\t\t// Doing this in HTML requires a different buffer with a fake root node\r\n\t\t\tvar output = this._nodelist.render(context, new dojox.string.Builder());\r\n\t\t\tcontext = context.update({ \"var\": output.toString() });\r\n\t\t\tvar filtered = this._varnode.render(context, buffer);\r\n\t\t\tcontext = context.pop();\r\n\t\t\treturn buffer;\r\n\t\t},\r\n\t\tunrender: function(context, buffer){\r\n\t\t\treturn buffer;\r\n\t\t},\r\n\t\tclone: function(buffer){\r\n\t\t\treturn new this.constructor(this._expression, this._nodelist.clone(buffer));\r\n\t\t}\r\n\t});\r\n\r\n\tddtm.FirstOfNode = lang.extend(function(vars, text){\r\n\t\tthis._vars = vars;\r\n\t\tthis.vars = array.map(vars, function(item){\r\n\t\t\treturn new dojox.dtl._Filter(item);\r\n\t\t});\r\n\t\tthis.contents = text;\r\n\t},\r\n\t{\r\n\t\trender: function(context, buffer){\r\n\t\t\tfor(var i = 0, item; item = this.vars[i]; i++){\r\n\t\t\t\tvar resolved = item.resolve(context);\r\n\t\t\t\tif(typeof resolved != \"undefined\"){\r\n\t\t\t\t\tif(resolved === null){\r\n\t\t\t\t\t\tresolved = \"null\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.contents.set(resolved);\r\n\t\t\t\t\treturn this.contents.render(context, buffer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this.contents.unrender(context, buffer);\r\n\t\t},\r\n\t\tunrender: function(context, buffer){\r\n\t\t\treturn this.contents.unrender(context, buffer);\r\n\t\t},\r\n\t\tclone: function(buffer){\r\n\t\t\treturn new this.constructor(this._vars, this.contents.clone(buffer));\r\n\t\t}\r\n\t});\r\n\r\n\tddtm.SpacelessNode = lang.extend(function(nodelist, text){\r\n\t\tthis.nodelist = nodelist;\r\n\t\tthis.contents = text;\r\n\t},\r\n\t{\r\n\t\trender: function(context, buffer){\r\n\t\t\tif(buffer.getParent){\r\n\t\t\t\t// Unfortunately, we have to branch here\r\n\t\t\t\tvar watch = [\r\n\t\t\t\t\tconnect.connect(buffer, \"onAddNodeComplete\", this, \"_watch\"),\r\n\t\t\t\t\tconnect.connect(buffer, \"onSetParent\", this, \"_watchParent\")\r\n\t\t\t\t];\r\n\t\t\t\tbuffer = this.nodelist.render(context, buffer);\r\n\t\t\t\tconnect.disconnect(watch[0]);\r\n\t\t\t\tconnect.disconnect(watch[1]);\r\n\t\t\t}else{\r\n\t\t\t\tvar value = this.nodelist.dummyRender(context);\r\n\t\t\t\tthis.contents.set(value.replace(/>\\s+</g, '><'));\r\n\t\t\t\tbuffer = this.contents.render(context, buffer);\r\n\t\t\t}\r\n\t\t\treturn buffer;\r\n\t\t},\r\n\t\tunrender: function(context, buffer){\r\n\t\t\treturn this.nodelist.unrender(context, buffer);\r\n\t\t},\r\n\t\tclone: function(buffer){\r\n\t\t\treturn new this.constructor(this.nodelist.clone(buffer), this.contents.clone(buffer));\r\n\t\t},\r\n\t\t_isEmpty: function(node){\r\n\t\t\treturn (node.nodeType == 3 && !node.data.match(/[^\\s\\n]/));\r\n\t\t},\r\n\t\t_watch: function(node){\r\n\t\t\tif(this._isEmpty(node)){\r\n\t\t\t\tvar remove = false;\r\n\t\t\t\tif(node.parentNode.firstChild == node){\r\n\t\t\t\t\tnode.parentNode.removeChild(node);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tvar children = node.parentNode.childNodes;\r\n\t\t\t\tif(node.nodeType == 1 && children.length > 2){\r\n\t\t\t\t\tfor(var i = 2, child; child = children[i]; i++){\r\n\t\t\t\t\t\tif(children[i - 2].nodeType == 1 && this._isEmpty(children[i - 1])){\r\n\t\t\t\t\t\t\tnode.parentNode.removeChild(children[i - 1]);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t_watchParent: function(node){\r\n\t\t\tvar children = node.childNodes;\r\n\t\t\tif(children.length){\r\n\t\t\t\twhile(node.childNodes.length){\r\n\t\t\t\t\tvar last = node.childNodes[node.childNodes.length - 1];\r\n\t\t\t\t\tif(!this._isEmpty(last)){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnode.removeChild(last);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tddtm.TemplateTagNode = lang.extend(function(tag, text){\r\n\t\tthis.tag = tag;\r\n\t\tthis.contents = text;\r\n\t},\r\n\t{\r\n\t\tmapping: {\r\n\t\t\topenblock: \"{%\",\r\n\t\t\tcloseblock: \"%}\",\r\n\t\t\topenvariable: \"{{\",\r\n\t\t\tclosevariable: \"}}\",\r\n\t\t\topenbrace: \"{\",\r\n\t\t\tclosebrace: \"}\",\r\n\t\t\topencomment: \"{#\",\r\n\t\t\tclosecomment: \"#}\"\r\n\t\t},\r\n\t\trender: function(context, buffer){\r\n\t\t\tthis.contents.set(this.mapping[this.tag]);\r\n\t\t\treturn this.contents.render(context, buffer);\r\n\t\t},\r\n\t\tunrender: function(context, buffer){\r\n\t\t\treturn this.contents.unrender(context, buffer);\r\n\t\t},\r\n\t\tclone: function(buffer){\r\n\t\t\treturn new this.constructor(this.tag, this.contents.clone(buffer));\r\n\t\t}\r\n\t});\r\n\r\n\tddtm.WidthRatioNode = lang.extend(function(current, max, width, text){\r\n\t\tthis.current = new dd._Filter(current);\r\n\t\tthis.max = new dd._Filter(max);\r\n\t\tthis.width = width;\r\n\t\tthis.contents = text;\r\n\t},\r\n\t{\r\n\t\trender: function(context, buffer){\r\n\t\t\tvar current = +this.current.resolve(context);\r\n\t\t\tvar max = +this.max.resolve(context);\r\n\t\t\tif(typeof current != \"number\" || typeof max != \"number\" || !max){\r\n\t\t\t\tthis.contents.set(\"\");\r\n\t\t\t}else{\r\n\t\t\t\tthis.contents.set(\"\" + Math.round((current / max) * this.width));\r\n\t\t\t}\r\n\t\t\treturn this.contents.render(context, buffer);\r\n\t\t},\r\n\t\tunrender: function(context, buffer){\r\n\t\t\treturn this.contents.unrender(context, buffer);\r\n\t\t},\r\n\t\tclone: function(buffer){\r\n\t\t\treturn new this.constructor(this.current.getExpression(), this.max.getExpression(), this.width, this.contents.clone(buffer));\r\n\t\t}\r\n\t});\r\n\r\n\tddtm.WithNode = lang.extend(function(target, alias, nodelist){\r\n\t\tthis.target = new dd._Filter(target);\r\n\t\tthis.alias = alias;\r\n\t\tthis.nodelist = nodelist;\r\n\t},\r\n\t{\r\n\t\trender: function(context, buffer){\r\n\t\t\tvar target = this.target.resolve(context);\r\n\t\t\tcontext = context.push();\r\n\t\t\tcontext[this.alias] = target;\r\n\t\t\tbuffer = this.nodelist.render(context, buffer);\r\n\t\t\tcontext = context.pop();\r\n\t\t\treturn buffer;\r\n\t\t},\r\n\t\tunrender: function(context, buffer){\r\n\t\t\treturn buffer;\r\n\t\t},\r\n\t\tclone: function(buffer){\r\n\t\t\treturn new this.constructor(this.target.getExpression(), this.alias, this.nodelist.clone(buffer));\r\n\t\t}\r\n\t});\r\n\r\n\tlang.mixin(ddtm, {\r\n\t\tcomment: function(parser, token){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tIgnore everything between {% comment %} and {% endcomment %}\r\n\t\t\tparser.skip_past(\"endcomment\");\r\n\t\t\treturn dd._noOpNode;\r\n\t\t},\r\n\t\tdebug: function(parser, token){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOutput the current context, maybe add more stuff later.\r\n\t\t\treturn new ddtm.DebugNode(parser.create_text_node());\r\n\t\t},\r\n\t\tfilter: function(parser, token){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFilter the contents of the blog through variable filters.\r\n\t\t\tvar rest = token.contents.split(null, 1)[1];\r\n\t\t\tvar varnode = parser.create_variable_node(\"var|\" + rest);\r\n\t\t\tvar nodelist = parser.parse([\"endfilter\"]);\r\n\t\t\tparser.next_token();\r\n\t\t\treturn new ddtm.FilterNode(varnode, nodelist);\r\n\t\t},\r\n\t\tfirstof: function(parser, token){\r\n\t\t\tvar parts = token.split_contents().slice(1);\r\n\t\t\tif(!parts.length){\r\n\t\t\t\tthrow new Error(\"'firstof' statement requires at least one argument\");\r\n\t\t\t}\r\n\t\t\treturn new ddtm.FirstOfNode(parts, parser.create_text_node());\r\n\t\t},\r\n\t\tspaceless: function(parser, token){\r\n\t\t\tvar nodelist = parser.parse([\"endspaceless\"]);\r\n\t\t\tparser.delete_first_token();\r\n\t\t\treturn new ddtm.SpacelessNode(nodelist, parser.create_text_node());\r\n\t\t},\r\n\t\ttemplatetag: function(parser, token){\r\n\t\t\tvar parts = token.contents.split();\r\n\t\t\tif(parts.length != 2){\r\n\t\t\t\tthrow new Error(\"'templatetag' statement takes one argument\");\r\n\t\t\t}\r\n\t\t\tvar tag = parts[1];\r\n\t\t\tvar mapping = ddtm.TemplateTagNode.prototype.mapping;\r\n\t\t\tif(!mapping[tag]){\r\n\t\t\t\tvar keys = [];\r\n\t\t\t\tfor(var key in mapping){\r\n\t\t\t\t\tkeys.push(key);\r\n\t\t\t\t}\r\n\t\t\t\tthrow new Error(\"Invalid templatetag argument: '\" + tag + \"'. Must be one of: \" + keys.join(\", \"));\r\n\t\t\t}\r\n\t\t\treturn new ddtm.TemplateTagNode(tag, parser.create_text_node());\r\n\t\t},\r\n\t\twidthratio: function(parser, token){\r\n\t\t\tvar parts = token.contents.split();\r\n\t\t\tif(parts.length != 4){\r\n\t\t\t\tthrow new Error(\"widthratio takes three arguments\");\r\n\t\t\t}\r\n\t\t\tvar width = +parts[3];\r\n\t\t\tif(typeof width != \"number\"){\r\n\t\t\t\tthrow new Error(\"widthratio final argument must be an integer\");\r\n\t\t\t}\r\n\t\t\treturn new ddtm.WidthRatioNode(parts[1], parts[2], width, parser.create_text_node());\r\n\t\t},\r\n\t\twith_: function(parser, token){\r\n\t\t\tvar parts = token.split_contents();\r\n\t\t\tif(parts.length != 4 || parts[2] != \"as\"){\r\n\t\t\t\tthrow new Error(\"do_width expected format as 'with value as name'\");\r\n\t\t\t}\r\n\t\t\tvar nodelist = parser.parse([\"endwith\"]);\r\n\t\t\tparser.next_token();\r\n\t\t\treturn new ddtm.WithNode(parts[1], parts[3], nodelist);\r\n\t\t}\r\n\t});\r\n\r\n\treturn ddtm;\r\n});"]}