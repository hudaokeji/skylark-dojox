{"version":3,"sources":["drawing/plugins/drawing/Silverlight.js"],"names":["dojo","provide","dojox","drawing","plugins","Silverlight","util","oo","declare","options","gfx","renderer","this","mouse","stencils","anchors","canvas","connect","item","c1","c2","c3","c4","c5","self","container","evt","superTarget","down","forEach","disconnect","anchor","shape","_down","dim","_getXY","x","origin","y","zoom","startx","starty","_lastx","_lasty","drawingType","attr","id","_getId","obj","console","log","onDown","_clickTime","Date","getTime","_lastClickTime","doublClickSpeed","dnm","eventName","warn","_broadcastEvent","clearTimeout","__downInv","setTimeout","hitch","pageX","pageY","cancelBubble","nm","undefined","elem","prop","value","squelchErrors","t","superClass","target","tagName","toLowerCase","e"],"mappings":"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","file":"../../../../drawing/plugins/drawing/Silverlight.js","sourcesContent":["dojo.provide(\"dojox.drawing.plugins.drawing.Silverlight\");\r\n\r\ndojox.drawing.plugins.drawing.Silverlight = dojox.drawing.util.oo.declare(\r\n\t//\tWARNING: This is not completely implemented. For the most\r\n\t//\tpart, DojoX Drawing does not support Silverlight. This class\r\n\t//\twas created in an attempt for support, but there were too many\r\n\t//\tobstacles and not enough time. The basic functionality is here\r\n\t//\tand there's a good head start if anyone elase wishes to pick up\r\n\t//\twhere I left off.\r\n\r\n\tfunction(options){\r\n\t\t// summary:\r\n\t\t//\t\tThe constructor is the only method in this class.\r\n\t\t//\t\tWhat is happening here is other methods in other\r\n\t\t//\t\tclasses are being overridden to adapt to Silverlight.\r\n\r\n\t\tif(dojox.gfx.renderer != \"silverlight\"){ return; }\r\n\t\tthis.mouse = options.mouse;\r\n\t\tthis.stencils = options.stencils;\r\n\t\tthis.anchors = options.anchors;\r\n\t\tthis.canvas = options.canvas;\r\n\t\tthis.util = options.util;\r\n\t\t\r\n\t\tdojo.connect(this.stencils, \"register\", this, function(item){\r\n\t\t\tvar c1, c2, c3, c4, c5, self = this;\r\n\t\t\tvar conMouse = function(){\r\n\t\t\t\t//console.info(\"------connect shape\", item.id)\r\n\t\t\t\t\r\n\t\t\t\t// Connect to PARENT (SL Canvas) , not SHAPE\r\n\t\t\t\tc1 = item.container.connect(\"onmousedown\", function(evt){\r\n\t\t\t\t\t//console.info(\"----------------------------------SHAPE DOWN\", item.container)\r\n\t\t\t\t\tevt.superTarget = item;\r\n\t\t\t\t\tself.mouse.down(evt);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tconMouse();\r\n\t\t\t\r\n\t\t\tc2 = dojo.connect(item, \"setTransform\", this, function(){\r\n\t\t\t\t//dojo.disconnect(c1);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tc3 = dojo.connect(item, \"onBeforeRender\", function(){\r\n\t\t\t\t//dojo.disconnect(c1);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tc4 = dojo.connect(item, \"onRender\", this, function(){\r\n\t\t\t\t//conMouse();\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tc5 = dojo.connect(item, \"destroy\", this, function(){\r\n\t\t\t\tdojo.forEach([c1,c2,c3,c4,c5], dojo.disconnect, dojo);\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\tdojo.connect(this.anchors, \"onAddAnchor\", this, function(anchor){\r\n\t\t\tvar c1 = anchor.shape.connect(\"onmousedown\", this.mouse, function(evt){\r\n\t\t\t\tevt.superTarget = anchor;\r\n\t\t\t\tthis.down(evt)\r\n\t\t\t});\r\n\t\t\tvar c2 = dojo.connect(anchor, \"disconnectMouse\", this, function(){\r\n\t\t\t\tdojo.disconnect(c1);\r\n\t\t\t\tdojo.disconnect(c2);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t\tthis.mouse._down = function(evt){\r\n\t\t\tvar dim = this._getXY(evt);\r\n\t\t\tvar x = dim.x - this.origin.x;\r\n\t\t\tvar y = dim.y - this.origin.y;\r\n\t\t\t\r\n\t\t\tx*= this.zoom;\r\n\t\t\ty*= this.zoom;\r\n\t\t\t\r\n\t\t\tthis.origin.startx = x;\r\n\t\t\tthis.origin.starty = y;\r\n\t\t\tthis._lastx = x;\r\n\t\t\tthis._lasty = y;\r\n\t\t\t\r\n\t\t\tthis.drawingType = this.util.attr(evt, \"drawingType\") || \"\";\r\n\t\t\tvar id = this._getId(evt);\r\n\t\t\tvar obj = {x:x,y:y, id:id};\r\n\t\t\tconsole.log(\" > > > id:\", id, \"drawingType:\", this.drawingType, \"evt:\", evt)\r\n\t\t\r\n\t\t\tthis.onDown(obj);\r\n\t\t\t\r\n\t\t\tthis._clickTime = new Date().getTime();\r\n\t\t\tif(this._lastClickTime){\r\n\t\t\t\tif(this._clickTime-this._lastClickTime<this.doublClickSpeed){\r\n\t\t\t\t\tvar dnm = this.eventName(\"doubleClick\");\r\n\t\t\t\t\tconsole.warn(\"DOUBLE CLICK\", dnm, obj);\r\n\t\t\t\t\tthis._broadcastEvent(dnm, obj);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t//console.log(\"    slow:\", this._clickTime-this._lastClickTime)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._lastClickTime = this._clickTime;\r\n\t\t\t\r\n\t\t\t// throws errors in IE silverlight. Oddness.\r\n\t\t\t//dojo.stopEvent(evt);\r\n\t\t};\r\n\t\t\r\n\t\tthis.mouse.down = function(evt){\r\n\t\t\tclearTimeout(this.__downInv);\r\n\t\t\tif(this.util.attr(evt, \"drawingType\")==\"surface\"){\r\n\t\t\t\tthis.__downInv = setTimeout(dojo.hitch(this, function(){\r\n\t\t\t\t\tthis._down(evt);\r\n\t\t\t\t}),500);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._down(evt);\r\n\t\t};\r\n\t\t\r\n\t\tthis.mouse._getXY =  function(evt){\r\n\t\t\t\r\n\t\t\tif(evt.pageX){\r\n\t\t\t\treturn {x:evt.pageX, y:evt.pageY, cancelBubble:true};\r\n\t\t\t}\r\n\t\t\tconsole.log(\"EVT\", evt)\r\n\t\t\t//console.log(\"EVT\", evt.pageX)\r\n\t\t\tfor(var nm in evt){\r\n\t\t\t\t//console.log(\"...\"+nm+\"=\"+evt[nm]);\r\n\t\t\t}\r\n\t\t\tconsole.log(\"EVTX\", evt.x)\r\n\t\t\tif(evt.x !== undefined){\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx:evt.x + this.origin.x,\r\n\t\t\t\t\ty:evt.y + this.origin.y\r\n\t\t\t\t};\r\n\t\t\t}else{\r\n\t\t\t\treturn {x:evt.pageX, y:evt.pageY};\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tthis.mouse._getId = function(evt){\r\n\t\t\treturn this.util.attr(evt, \"id\");\r\n\t\t};\r\n\t\t\r\n\t\tthis.util.attr = function(/* Object */ elem, /* property */ prop, /* ? value */ value, squelchErrors){\r\n\t\t\tif(!elem){ return false; }\r\n\t\t\ttry{\r\n\t\t\t\t\r\n\t\t\t\tvar t;\r\n\t\t\t\tif(elem.superTarget){\r\n\t\t\t\t\tt = elem.superTarget;\r\n\t\t\t\t}else if(elem.superClass){\r\n\t\t\t\t\tt = elem.superClass;\r\n\t\t\t\t}else if(elem.target){\r\n\t\t\t\t\tt = elem.target;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tt = elem;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(value!==undefined){\r\n\t\t\t\t\telem[prop] = value;\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(t.tagName){\r\n\t\t\t\t\tif(prop==\"drawingType\" && t.tagName.toLowerCase()==\"object\"){\r\n\t\t\t\t\t\treturn \"surface\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar r =  dojo.attr(t, prop);\r\n\t\t\t\t}\r\n\t\t\t\tvar r = t[prop];\r\n\t\t\t\treturn r\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t}catch(e){\r\n\t\t\t\tif(!squelchErrors){\r\n\t\t\t\t\t// For debugging only. These errors actually cause more errors in IE's console\r\n\t\t\t\t\t//console.error(\"BAD ATTR: prop:\", prop, \"el:\", elem)\r\n\t\t\t\t\t//console.error(e)\r\n\t\t\t\t\t//console.trace();\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t// summary:\r\n\t\t//\t\t\"Plugin\" to allow the Silverlight plugin to work\r\n\t\t//\t\twith DojoX Drawing.\r\n\t}\r\n);"]}