{"version":3,"sources":["drawing/manager/Mouse.js"],"names":["define","dojo","oo","defaults","declare","options","this","util","keys","id","uid","currentNodeId","registered","doublClickSpeed","_lastx","_lasty","__reg","_downOnCanvas","init","node","c","container","setCanvas","_isDown","connect","evt","console","warn","document","body","down","button","mouseButtons","RIGHT","disconnect","up","move","_dragged","pos","position","parentNode","origin","clone","scrollOffset","top","scrollTop","left","scrollLeft","resize","width","height","w","h","register","scope","handle","unregister","_broadcastEvent","strEvt","obj","nm","onDown","eventName","onDrag","_selected","onMove","overName","split","charAt","toUpperCase","substring","clickable","clickMode","onOver","onOut","onUp","info","dojox","gfx","renderer","_clickTime","Date","getTime","_lastClickTime","dnm","zoom","setZoom","setEventMode","mode","name","dt","drawingType","create","sc","dim","_getXY","_lastpagex","x","_lastpagey","y","o","withinCanvas","startx","starty","attr","_getId","preventDefault","stopEvent","mid","pageX","pageY","over","out","outObj","drag","squelchErrors","pagex","pagey","ret","page","orgX","orgY","last","start","scroll","setCursor","cursor","style"],"mappings":"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","file":"../../../drawing/manager/Mouse.js","sourcesContent":["define([\"dojo\", \"../util/oo\", \"../defaults\"], \r\nfunction(dojo, oo, defaults){\r\n\r\n//dojox.drawing.manager.Mouse = \r\nreturn oo.declare(\r\n\tfunction(/* Object */options){\r\n\t\tthis.util = options.util;\r\n\t\tthis.keys = options.keys;\r\n\t\tthis.id = options.id || this.util.uid(\"mouse\");\r\n\t\tthis.currentNodeId = \"\";\r\n\t\tthis.registered = {};\r\n\t},\r\n\t\r\n\t{\r\n\t\t// summary:\r\n\t\t//\t\tMaster object (instance) that tracks mouse\r\n\t\t//\t\tevents. A new instance is created for each\r\n\t\t//\t\tDrawing object.\r\n\t\t// description:\r\n\t\t//\t\tYou could connect to any method or event in this\r\n\t\t//\t\tclass, but it is designed to have the object\r\n\t\t//\t\t'registered'. All objects with the current event\r\n\t\t//\t\twill be called directly.\r\n\t\t//\r\n\t\t//\t\tCustom events are used often. In addition to\r\n\t\t//\t\tstandard events onDown, onUp, onDrag, etc, if\r\n\t\t//\t\ta certain object is clicked upon (or dragged, etc),\r\n\t\t//\t\tthat object's drawingType will create the custom event,\r\n\t\t//\t\tsuch as onAnchorDown, or onStencilDown.\r\n\r\n\r\n\t\t// doublClickSpeed: Number\r\n\t\t//\t\tMilliseconds between clicks to\r\n\t\t//\t\tregister as for onDoubleClick\r\n\t\tdoublClickSpeed:400,\r\n\t\t\r\n\t\t// private properties\r\n\t\t\r\n\t\t_lastx:0,\r\n\t\t_lasty:0,\r\n\t\t__reg:0,\r\n\t\t_downOnCanvas:false,\r\n\t\t\r\n\t\t/*=====\r\n\t\tCustomEventMethod: {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThe custom event methods that an Object that has\r\n\t\t\t//\t\tregistered with manager.Mouse can receive.\r\n\t\t\t//\t\tCan contain any or all of the following methods\r\n\t\t\t//\t\tand they will be called on mouse events. All events\r\n\t\t\t//\t\twill be sent a EventObject event object.\r\n\t\t\t//\r\n\t\t\t//\t\tNOTE:\r\n\t\t\t//\t\tEvents happen anywhere in the document unless\r\n\t\t\t//\t\totherwise noted.\r\n\r\n\t\t\t// onMove: Function\r\n\t\t\t//\t\tFires on mousemove when mouse is up\r\n\t\t\t// onDown: Function\r\n\t\t\t//\t\tFires on mousedown *on the canvas*\r\n\t\t\t// onDrag: Function\r\n\t\t\t//\t\tFires on mousemove when mouse is down\r\n\t\t\t// onUp: Function\r\n\t\t\t//\t\tFires on mouseup, anywhere in the document\r\n\t\t\t// onStencilDown: Function\r\n\t\t\t//\t\tFired on mousedown on a Stencil\r\n\t\t\t// onStencilDrag: Function\r\n\t\t\t//\t\tFired when mouse moves and mose is down on a Stencil\r\n\t\t\t// onStencilUp: Function\r\n\t\t\t//\t\tFired on mouseup off of a Stencil\r\n\t\t\t// on[Custom]Up|Down|Move: Function\r\n\t\t\t//\t\tCustom events can bet set and fired by setting a\r\n\t\t\t//\t\tdifferent drawingType on a Stencil, or by calling\r\n\t\t\t//\t\tsetEventMode(customEventName)\r\n\t\t},\r\n\t\tEventObject: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThe custom event object that is sent to registered objects\r\n\t\t\t//\t\tand their respective methods.\r\n\t\t\t//\r\n\t\t\t//\t\tNOTE: Most event objects are the same with the exception\r\n\t\t\t//\t\tof the onDown events, which have fewer.\r\n\r\n\t\t\t// id: String\r\n\t\t\t//\t\tId of the focused object (included in onDown)\r\n\t\t\t// pageX: Number\r\n\t\t\t//\t\tThe X coordinate of the mouse from the left side of\r\n\t\t\t//\t\tthe document. (included in onDown)\r\n\t\t\t// pageY: Number\r\n\t\t\t//\t\tThe Y coordinate of the mouse from the top of\r\n\t\t\t//\t\tthe document. (included in onDown)\r\n\t\t\t// x: Number\r\n\t\t\t//\t\tThe X coordinate of the mouse from the left side\r\n\t\t\t//\t\tof the canvas (included in onDown)\r\n\t\t\t// y: Number\r\n\t\t\t//\t\tThe Y coordinate of the mouse from the top\r\n\t\t\t//\t\tof the canvas (included in onDown)\r\n\r\n\t\t\t// last:\tObject\r\n\t\t\t//\t\tThe x and y coordinates of the last mousemove\r\n\t\t\t//\t\trelative to the canvas (not included in onDown)\r\n\t\t\t// move: Object\r\n\t\t\t//\t\tThe x and y amounts the mouse moved since the last event\r\n\t\t\t//\t\t(not included in onDown)\r\n\t\t\t// orgX:\tNumber\r\n\t\t\t//\t\tThe left side of the canvas from the side of the document (not included in onDown)\r\n\t\t\t// orgY:\tNumber\r\n\t\t\t//\t\tThe top of the canvas from the top of the document (not included in onDown)\r\n\t\t\t// scroll: Object\r\n\t\t\t//\t\tThe 'top' and 'left' scroll amounts of the canvas. (not included in onDown)\r\n\t\t\t// start:\tObject\r\n\t\t\t//\t\tThe x and y coordinates of the mousedown event (not included in onDown)\r\n\t\t\t// withinCanvas: Boolean\r\n\t\t\t//\t\tWhether the event happened within the Canvas or not (not included in onDown)\r\n\t\t},\r\n\t\t=====*/\r\n\t\t\t\r\n\t\tinit: function(/* HTMLNode*/node){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal. Initializes mouse.\r\n\r\n\t\t\tthis.container = node;\r\n\t\t\tthis.setCanvas();\r\n\t\t\tvar c;\r\n\t\t\tvar _isDown = false;\r\n\t\t\tdojo.connect(this.container, \"rightclick\", this, function(evt){\r\n\t\t\t\tconsole.warn(\"RIGHTCLICK\")\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tdojo.connect(document.body, \"mousedown\", this, function(evt){\r\n\t\t\t\t//evt.preventDefault();\r\n\t\t\t\t//dojo.stopEvent(evt);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tdojo.connect(this.container, \"mousedown\", this, function(evt){\r\n\t\t\t\tthis.down(evt);\r\n\t\t\t\t// Right click shouldn't trigger drag\r\n\t\t\t\tif(evt.button != dojo.mouseButtons.RIGHT){\r\n\t\t\t\t\t_isDown = true;\r\n\t\t\t\t\tc = dojo.connect(document, \"mousemove\", this, \"drag\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tdojo.connect(document, \"mouseup\", this, function(evt){\r\n\t\t\t\tdojo.disconnect(c);\r\n\t\t\t\t_isDown = false;\r\n\t\t\t\tthis.up(evt);\r\n\t\t\t});\r\n\t\t\tdojo.connect(document, \"mousemove\", this, function(evt){\r\n\t\t\t\tif(!_isDown){\r\n\t\t\t\t\tthis.move(evt);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tdojo.connect(this.keys, \"onEsc\", this, function(evt){\r\n\t\t\t\tthis._dragged = false;\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\tsetCanvas: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal. Sets canvas position\r\n\t\t\tvar pos = dojo.position(this.container.parentNode);\r\n\t\t\tthis.origin = dojo.clone(pos);\r\n\t\t},\r\n\t\t\r\n\t\tscrollOffset: function(){\r\n\t\t\t// summary:\r\n\t\t\t// \tGets scroll offset of canvas\r\n\t\t\treturn {\r\n\t\t\t\ttop:this.container.parentNode.scrollTop,\r\n\t\t\t\tleft:this.container.parentNode.scrollLeft\r\n\t\t\t}; // Object\r\n\t\t},\r\n\r\n\t\tresize: function(width,height){\r\n\t\t\tif(this.origin){\r\n\t\t\t\tthis.origin.w=width;\r\n\t\t\t\tthis.origin.h=height;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tregister: function(/* CustomEventMethod*/scope){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tAll objects (Stencils) should register here if they\r\n\t\t\t//\t\tuse mouse events. When registering, the object will\r\n\t\t\t//\t\tbe called if it has that method.\r\n\t\t\t//\t\tSee: CustomEventMethod and EventObject\r\n\t\t\t// scope:\r\n\t\t\t//\t\tThe object to be called\r\n\t\t\t// returns: handle\r\n\t\t\t//\t\tKeep the handle to be used for disconnection.\r\n\r\n\t\t\tvar handle = scope.id || \"reg_\"+(this.__reg++);\r\n\t\t\tif(!this.registered[handle]){ this.registered[handle] = scope; }\r\n\t\t\treturn handle; // String\r\n\t\t},\r\n\t\tunregister: function(handle){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDisconnects object. Mouse events are no longer\r\n\t\t\t//\t\tcalled for it.\r\n\t\t\tif(!this.registered[handle]){ return; }\r\n\t\t\tdelete this.registered[handle];\r\n\t\t},\r\n\t\t\r\n\t\t_broadcastEvent:function(strEvt, obj){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFire events to all registered objects.\r\n\r\n\t\t\t//console.log(\"mouse.broadcast:\", strEvt, obj)\r\n\t\t\tfor(var nm in this.registered){\r\n\t\t\t\tif(this.registered[nm][strEvt]) this.registered[nm][strEvt](obj);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonDown: function(obj){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreate on[xx]Down event and send to broadcaster.\r\n\t\t\t//\t\tCould be connected to.\r\n\t\t\t\r\n\t\t\t//console.info(\"onDown:\", this.eventName(\"down\"))\r\n\t\t\tthis._broadcastEvent(this.eventName(\"down\"), obj);\r\n\t\t},\r\n\t\t\r\n\t\tonDrag: function(obj){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreate on[xx]Drag event and send to broadcaster.\r\n\t\t\t//\t\tCould be connected to.\r\n\r\n\t\t\tvar nm = this.eventName(\"drag\");\r\n\t\t\tif(this._selected && nm == \"onDrag\"){\r\n\t\t\t\tnm = \"onStencilDrag\"\r\n\t\t\t}\r\n\t\t\tthis._broadcastEvent(nm, obj);\r\n\t\t},\r\n\t\t\r\n\t\tonMove: function(obj){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreate onMove event and send to broadcaster.\r\n\t\t\t//\t\tCould be connected to.\r\n\t\t\t//\t\tNote: onMove never uses a custom event\r\n\t\t\t//\t\tNote: onMove is currently not enabled in the app.\r\n\r\n\t\t\tthis._broadcastEvent(\"onMove\", obj);\r\n\t\t},\r\n\t\t\r\n\t\toverName: function(obj,evt){\r\n\t\t\tvar nm = obj.id.split(\".\");\r\n\t\t\tevt = evt.charAt(0).toUpperCase() + evt.substring(1);\r\n\t\t\tif(nm[0] == \"dojox\" && (defaults.clickable || !defaults.clickMode)){\r\n\t\t\t\treturn \"onStencil\"+evt;\r\n\t\t\t}else{\r\n\t\t\t\treturn \"on\"+evt;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\tonOver: function(obj){\r\n\t\t\tthis._broadcastEvent(this.overName(obj,\"over\"), obj);\r\n\t\t},\r\n\t\t\r\n\t\tonOut: function(obj){\r\n\t\t\tthis._broadcastEvent(this.overName(obj,\"out\"), obj);\r\n\t\t},\r\n\t\t\r\n\t\tonUp: function(obj){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreate on[xx]Up event and send to broadcaster.\r\n\t\t\t//\t\tCould be connected to.\r\n\t\t\t\r\n\t\t\t// \tblocking first click-off (deselect), largely for TextBlock\r\n\t\t\t// \tTODO: should have param to make this optional?\r\n\t\t\tvar nm = this.eventName(\"up\");\r\n\t\t\t\r\n\t\t\tif(nm == \"onStencilUp\"){\r\n\t\t\t\tthis._selected  = true;\r\n\t\t\t}else if(this._selected && nm == \"onUp\"){ //////////////////////////////////////////\r\n\t\t\t\tnm = \"onStencilUp\";\r\n\t\t\t\tthis._selected = false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconsole.info(\"Up Event:\", this.id, nm, \"id:\", obj.id);\r\n\t\t\tthis._broadcastEvent(nm, obj);\r\n\t\t\t\r\n\t\t\t// Silverlight double-click handled in Silverlight class\r\n\t\t\tif(dojox.gfx.renderer == \"silverlight\"){ return; }\r\n\t\t\t\r\n\t\t\t// Check Double Click\r\n\t\t\t// If a double click is detected, the onDoubleClick event fires,\r\n\t\t\t// but does not replace the normal event. They both fire.\r\n\t\t\tthis._clickTime = new Date().getTime();\r\n\t\t\tif(this._lastClickTime){\r\n\t\t\t\tif(this._clickTime-this._lastClickTime<this.doublClickSpeed){\r\n\t\t\t\t\tvar dnm = this.eventName(\"doubleClick\");\r\n\t\t\t\t\tconsole.warn(\"DOUBLE CLICK\", dnm, obj);\r\n\t\t\t\t\tthis._broadcastEvent(dnm, obj);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t//console.log(\"    slow:\", this._clickTime-this._lastClickTime)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._lastClickTime = this._clickTime;\r\n\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\tzoom: 1,\r\n\t\tsetZoom: function(zoom){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal. Sets the mouse zoom percentage to\r\n\t\t\t//\t\tthat of the canvas\r\n\t\t\tthis.zoom = 1/zoom;\r\n\t\t},\r\n\t\t\r\n\t\tsetEventMode: function(mode){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSets the mouse mode s that custom events can be called.\r\n\t\t\t//\t\tAlso can 'disable' events by using a bogus mode:\r\n\t\t\t// |\tmouse.setEventMode(\"DISABLED\")\r\n\t\t\t//\t\t(unless any object subscribes to this event,\r\n\t\t\t//\t\tit is effectively disabled)\r\n\r\n\t\t\tthis.mode = mode ? \"on\" + mode.charAt(0).toUpperCase() + mode.substring(1) :  \"\";\r\n\t\t},\r\n\t\t\r\n\t\teventName: function(name){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal. Determine the event name\r\n\r\n\t\t\tname = name.charAt(0).toUpperCase() + name.substring(1);\r\n\t\t\tif(this.mode){\r\n\t\t\t\tif(this.mode == \"onPathEdit\"){\r\n\t\t\t\t\treturn \"on\"+name;\r\n\t\t\t\t}\r\n\t\t\t\tif(this.mode == \"onUI\"){\r\n\t\t\t\t\t//return \"on\"+name;\r\n\t\t\t\t}\r\n\t\t\t\treturn this.mode + name;\r\n\t\t\t}else{\r\n\t\t\t\t//Allow a mode where stencils aren't clickable\r\n\t\t\t\tif(!defaults.clickable && defaults.clickMode){return \"on\"+name;}\r\n\t\t\t\tvar dt = !this.drawingType || this.drawingType==\"surface\" || this.drawingType==\"canvas\" ? \"\" : this.drawingType;\r\n\t\t\t\tvar t = !dt ? \"\" : dt.charAt(0).toUpperCase() + dt.substring(1);\r\n\t\t\t\treturn \"on\"+t+name;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tup: function(evt){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal. Create onUp event\r\n\r\n\t\t\tthis.onUp(this.create(evt));\r\n\t\t},\r\n\t\t\r\n\t\tdown: function(evt){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal. Create onDown event\r\n\r\n\t\t\tthis._downOnCanvas = true;\r\n\t\t\tvar sc = this.scrollOffset();\r\n\t\t\tvar dim = this._getXY(evt);\r\n\t\t\tthis._lastpagex = dim.x;\r\n\t\t\tthis._lastpagey = dim.y;\r\n\t\t\tvar o = this.origin;\r\n\t\t\tvar x = dim.x - o.x + sc.left;\r\n\t\t\tvar y = dim.y - o.y + sc.top;\r\n\t\t\t\r\n\t\t\tvar withinCanvas = x>=0 && y>=0 && x<=o.w && y<=o.h;\r\n\t\t\tx*= this.zoom;\r\n\t\t\ty*= this.zoom;\r\n\t\t\t\r\n\t\t\to.startx = x;\r\n\t\t\to.starty = y;\r\n\t\t\tthis._lastx = x;\r\n\t\t\tthis._lasty = y;\r\n\t\t\t\r\n\t\t\tthis.drawingType = this.util.attr(evt, \"drawingType\") || \"\";\r\n\t\t\tvar id = this._getId(evt);\r\n\t\t\t//console.log(\"DOWN:\", this.id, id, withinCanvas);\r\n\t\t\t//console.log(\"this.drawingType:\", this.drawingType);\r\n\t\t\t\r\n\t\t\tif(evt.button == dojo.mouseButtons.RIGHT && this.id == \"mse\"){\r\n\t\t\t\t//Allow right click events to bubble for context menus\r\n\t\t\t}else{\r\n\t\t\t\tevt.preventDefault();\r\n\t\t\t\tdojo.stopEvent(evt);\r\n\t\t\t}\r\n\t\t\tthis.onDown({\r\n\t\t\t\tmid:this.id,\r\n\t\t\t\tx:x,\r\n\t\t\t\ty:y,\r\n\t\t\t\tpageX:dim.x,\r\n\t\t\t\tpageY:dim.y,\r\n\t\t\t\twithinCanvas:withinCanvas,\r\n\t\t\t\tid:id\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t\tover: function(obj){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal.\r\n\r\n\t\t\tthis.onOver(obj);\r\n\t\t},\r\n\t\tout: function(obj){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal.\r\n\r\n\t\t\tthis.onOut(obj);\r\n\t\t},\r\n\t\tmove: function(evt){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal.\r\n\r\n\t\t\tvar obj = this.create(evt);\r\n\t\t\tif(this.id==\"MUI\"){\r\n\t\t\t\t//console.log(\"obj.id:\", obj.id, \"was:\", this.currentNodeId)\r\n\t\t\t}\r\n\t\t\tif(obj.id != this.currentNodeId){\r\n\t\t\t\t// TODO: I wonder if an ID is good enough\r\n\t\t\t\t//\tthat would avoid the mixin\r\n\t\t\t\tvar outObj = {};\r\n\t\t\t\tfor(var nm in obj){\r\n\t\t\t\t\toutObj[nm] = obj[nm];\r\n\t\t\t\t}\r\n\t\t\t\toutObj.id = this.currentNodeId;\r\n\t\t\t\tthis.currentNodeId && this.out(outObj);\r\n\t\t\t\tobj.id && this.over(obj);\r\n\t\t\t\tthis.currentNodeId = obj.id;\r\n\t\t\t}\r\n\t\t\tthis.onMove(obj);\r\n\t\t},\r\n\t\tdrag: function(evt){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal. Create onDrag event\r\n\t\t\tthis.onDrag(this.create(evt, true));\r\n\t\t},\r\n\t\tcreate: function(evt, squelchErrors){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal. Create EventObject\r\n\r\n\t\t\tvar sc = this.scrollOffset();\r\n\t\t\tvar dim = this._getXY(evt);\r\n\t\t\t\r\n\t\t\tvar pagex = dim.x;\r\n\t\t\tvar pagey = dim.y;\r\n\t\t\t\r\n\t\t\tvar o = this.origin;\r\n\t\t\tvar x = dim.x - o.x + sc.left;\r\n\t\t\tvar y = dim.y - o.y + sc.top;\r\n\r\n\t\t\tvar withinCanvas = x>=0 && y>=0 && x<=o.w && y<=o.h;\r\n\t\t\tx*= this.zoom;\r\n\t\t\ty*= this.zoom;\r\n\t\t\t\r\n\t\t\tvar id = withinCanvas ? this._getId(evt, squelchErrors) : \"\";\r\n\t\t\tvar ret = {\r\n\t\t\t\tmid:this.id,\r\n\t\t\t\tx:x,\r\n\t\t\t\ty:y,\r\n\t\t\t\tpageX:dim.x,\r\n\t\t\t\tpageY:dim.y,\r\n\t\t\t\tpage:{\r\n\t\t\t\t\tx:dim.x,\r\n\t\t\t\t\ty:dim.y\r\n\t\t\t\t},\r\n\t\t\t\torgX:o.x,\r\n\t\t\t\torgY:o.y,\r\n\t\t\t\tlast:{\r\n\t\t\t\t\tx: this._lastx,\r\n\t\t\t\t\ty: this._lasty\r\n\t\t\t\t},\r\n\t\t\t\tstart:{\r\n\t\t\t\t\tx: this.origin.startx, //+ sc.left,\r\n\t\t\t\t\ty: this.origin.starty //+ sc.top\r\n\t\t\t\t},\r\n\t\t\t\tmove:{\r\n\t\t\t\t\tx:pagex - this._lastpagex,\r\n\t\t\t\t\ty:pagey - this._lastpagey\r\n\t\t\t\t},\r\n\t\t\t\tscroll:sc,\r\n\t\t\t\tid:id,\r\n\t\t\t\twithinCanvas:withinCanvas\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t//console.warn(\"MSE LAST:\", x-this._lastx, y-this._lasty)\r\n\t\t\tthis._lastx = x;\r\n\t\t\tthis._lasty = y;\r\n\t\t\tthis._lastpagex = pagex;\r\n\t\t\tthis._lastpagey = pagey;\r\n\t\t\tdojo.stopEvent(evt);\r\n\t\t\treturn ret; //Object\r\n\t\t},\r\n\t\t_getId: function(evt, squelchErrors){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal. Gets ID of focused node.\r\n\t\t\treturn this.util.attr(evt, \"id\", null, squelchErrors); // String\r\n\t\t},\r\n\t\t_getXY: function(evt){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal. Gets mouse coords to page.\r\n\t\t\treturn {x:evt.pageX, y:evt.pageY}; // Object\r\n\t\t},\r\n\t\t\r\n\t\tsetCursor: function(cursor,/* HTMLNode*/node){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSets the cursor for  a given node.  If no\r\n\t\t\t//\t\tnode is specified the containing node is used.\r\n\t\t\tif(!node){\r\n\t\t\t\tdojo.style(this.container, \"cursor\", cursor);\r\n\t\t\t}else{\r\n\t\t\t\tdojo.style(node, \"cursor\", cursor);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n);\r\n});\r\n"]}