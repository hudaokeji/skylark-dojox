{"version":3,"sources":["drawing/manager/Undo.js"],"names":["define","dojo","oo","declare","options","this","keys","undostack","redostack","connect","onKeyDown","evt","cmmd","ctrl","keyCode","shift","redo","undo","add","stack","args","mixin","push","apply","scope","method","hitch","o","pop","console","log","before","after"],"mappings":";;;;;;;AAAAA,QAAQ,OAAQ,cAChB,SAASC,EAAMC,GAGf,OAAOA,EAAGC,QACT,SAASC,GACRC,KAAKC,KAAOF,EAAQE,KACpBD,KAAKE,aACLF,KAAKG,aACLP,EAAKQ,QAAQJ,KAAKC,KAAM,YAAaD,KAAM,eAQ3CK,UAAW,SAASC,IACfA,EAAIC,MAASD,EAAIE,QAEL,IAAbF,EAAIG,SAAgBH,EAAII,OAEF,IAAfJ,EAAIG,SAAiBH,EAAII,OAAuB,IAAbJ,EAAIG,UAChDT,KAAKW,OAFLX,KAAKY,SAMPC,IAAK,SAASC,GAEbA,EAAMC,KAAOnB,EAAKoB,SAAUF,EAAMC,MAClCf,KAAKE,UAAUe,KAAKH,IAErBI,MAAO,SAASC,EAAOC,EAAQL,GAC9BnB,EAAKyB,MAAMF,EAAOC,EAAlBxB,CAA0BmB,IAE3BH,KAAM,WAEL,IAAIU,EAAItB,KAAKE,UAAUqB,MACvBC,QAAQC,IAAI,QAASH,GACjBA,IAEJA,EAAEI,SAEF1B,KAAKG,UAAUc,KAAKK,KAErBX,KAAM,WACLa,QAAQC,IAAI,SACZ,IAAIH,EAAItB,KAAKG,UAAUoB,MACnBD,IACDA,EAAEK,MACJL,EAAEK,QAEFL,EAAEI,SAGH1B,KAAKE,UAAUe,KAAKK","file":"../../../drawing/manager/Undo.js","sourcesContent":["define([\"dojo\", \"../util/oo\"],//, \"../defaults\"], \r\nfunction(dojo, oo){\r\n\r\n//dojox.drawing.manager.Undo = \r\nreturn oo.declare(\r\n\tfunction(options){\r\n\t\tthis.keys = options.keys;\r\n\t\tthis.undostack = [];\r\n\t\tthis.redostack = [];\r\n\t\tdojo.connect(this.keys, \"onKeyDown\", this, \"onKeyDown\");\r\n\t},\r\n\t{\r\n\t\t// summary:\r\n\t\t//\t\tHandles the Undo in drawing.\r\n\t\t//\t\tNOTE: Only partially implemented!!! There is very\r\n\t\t//\t\tlittle actual undo functionality!\r\n\r\n\t\tonKeyDown: function(evt){\r\n\t\t\tif(!evt.cmmd && !evt.ctrl){ return; }\r\n\t\t\t\r\n\t\t\tif(evt.keyCode==90 && !evt.shift){\r\n\t\t\t\tthis.undo();\r\n\t\t\t}else if((evt.keyCode == 90 && evt.shift) || evt.keyCode==89){\r\n\t\t\t\tthis.redo();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tadd: function(stack){\r\n\t\t\t//console.log(\"undo add\", stack)\r\n\t\t\tstack.args = dojo.mixin({}, stack.args);\r\n\t\t\tthis.undostack.push(stack);\r\n\t\t},\r\n\t\tapply: function(scope, method, args){\r\n\t\t\tdojo.hitch(scope, method)(args);\r\n\t\t},\r\n\t\tundo: function(){\r\n\t\t\t\r\n\t\t\tvar o = this.undostack.pop();\r\n\t\t\tconsole.log(\"undo!\", o);\r\n\t\t\tif(!o){ return; }\r\n\t\t\t\r\n\t\t\to.before();\r\n\t\t\t\r\n\t\t\tthis.redostack.push(o);\r\n\t\t},\r\n\t\tredo: function(){\r\n\t\t\tconsole.log(\"redo!\");\r\n\t\t\tvar o = this.redostack.pop();\r\n\t\t\tif(!o){ return; }\r\n\t\t\tif(o.after){\r\n\t\t\t\to.after();\r\n\t\t\t}else{\r\n\t\t\t\to.before(); ///??????\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.undostack.push(o);\r\n\t\t}\r\n\t}\r\n);\r\n});\r\n"]}