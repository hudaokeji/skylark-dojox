{"version":3,"sources":["drawing/annotations/Angle.js"],"names":["define","dojo","oo","positioning","declare","options","this","stencil","util","mouse","connectMult","type","angle","showAngle","selected","created","getRadius","minimumSize","hideAngle","node","getAngleNode","d","pointsToData","pt","x","x1","y","y1","x2","y2","sc","scrollOffset","mx","getTransform","dx","zoom","dy","_offX","left","_offY","top","style","align","getAngle","zAxis","shortType","innerHTML","data","cosphi","Math","ceil","_angleNode","create","body","addClass","fadeOut","duration","onEnd","destroy","play"],"mappings":";;;;;;;AAAAA,QAAQ,OAAQ,aAAc,uBAC9B,SAASC,EAAMC,EAAIC,GAGnB,OAAOD,EAAGE,QACT,SAAoBC,GAInBC,KAAKC,QAAUF,EAAQE,QACvBD,KAAKE,KAAOH,EAAQE,QAAQC,KAC5BF,KAAKG,MAAQJ,EAAQE,QAAQE,MAE7BH,KAAKC,QAAQG,cACX,SAAUJ,KAAM,cAChB,OAAQA,KAAM,cACd,mBAAoBA,KAAM,cAC1B,cAAeA,KAAM,cACrB,iBAAkBA,KAAM,iBAa1BK,KAAK,6BACLC,MAAM,EAENC,UAAW,WAIV,GAAIP,KAAKC,QAAQO,WAAYR,KAAKC,QAAQQ,QAC1C,GAAGT,KAAKC,QAAQS,YAAcV,KAAKC,QAAQU,YAC1CX,KAAKY,gBADN,CAIA,IAAIC,EAAOb,KAAKc,eACZC,EAAIf,KAAKC,QAAQe,eACjBC,EAAKpB,EAAYS,OAAOY,EAAEH,EAAEI,GAAGC,EAAEL,EAAEM,KAAKH,EAAEH,EAAEO,GAAGF,EAAEL,EAAEQ,KACnDC,EAAKxB,KAAKG,MAAMsB,eAChBC,EAAK1B,KAAKC,QAAQ0B,eAClBC,EAAKF,EAAGE,GAAK5B,KAAKG,MAAM0B,KACxBC,EAAKJ,EAAGI,GAAK9B,KAAKG,MAAM0B,KAC5BZ,EAAGC,GAAKlB,KAAKG,MAAM0B,KACnBZ,EAAGG,GAAKpB,KAAKG,MAAM0B,KAKnB,IAAIX,EAAIlB,KAAKC,QAAQ8B,MAAQd,EAAGC,EAAIM,EAAGQ,KAAOJ,EAC1CR,EAAIpB,KAAKC,QAAQgC,MAAQhB,EAAGG,EAAII,EAAGU,IAAMJ,EAC7CnC,EAAKwC,MAAMtB,GACVmB,KAAQd,EAAI,KACZgB,IAAMd,EAAI,KACVgB,MAAMnB,EAAGmB,QAGV,IAAI9B,EAAMN,KAAKC,QAAQoC,WACpBrC,KAAKC,QAAQkC,MAAMG,OAAiC,UAAxBtC,KAAKC,QAAQsC,UAC1C1B,EAAK2B,UAAYxC,KAAKC,QAAQwC,KAAKC,OAAS,EAAI,SAAW,OAC5B,QAAxB1C,KAAKC,QAAQsC,UACpB1B,EAAK2B,UAAYxC,KAAKC,QAAQkC,MAAMG,MAAM,SAASK,KAAKC,KAAKtC,EAAM,KAEnEO,EAAK2B,UAAYG,KAAKC,KAAKtC,KAI9BQ,aAAc,WAQb,OALId,KAAK6C,aACR7C,KAAK6C,WAAalD,EAAKmD,OAAO,OAAQ,KAAMnD,EAAKoD,QACjDpD,EAAKqD,SAAShD,KAAK6C,WAAY,kBAC/BlD,EAAKwC,MAAMnC,KAAK6C,WAAY,UAAW,IAEjC7C,KAAK6C,YAGbjC,UAAW,WAIPZ,KAAK6C,YAAclD,EAAKwC,MAAMnC,KAAK6C,WAAY,WAAW,KAE5DlD,EAAKsD,SAASpC,KAAKb,KAAK6C,WACvBK,SAAS,IACTC,MAAO,SAAStC,GACflB,EAAKyD,QAAQvC,MAEZwC,OACHrD,KAAK6C,WAAa","file":"../../../drawing/annotations/Angle.js","sourcesContent":["define([\"dojo\", \"../util/oo\", \"../util/positioning\"], \r\nfunction(dojo, oo, positioning){\r\n\r\n//dojox.drawing.annotations.Angle = \r\nreturn oo.declare(\r\n\tfunction(/*Object*/ options){\r\n\t\t// options: Object\r\n\t\t//\t\tOne key value: the stencil that called this.\r\n\r\n\t\tthis.stencil = options.stencil;\r\n\t\tthis.util = options.stencil.util;\r\n\t\tthis.mouse = options.stencil.mouse;\r\n\r\n\t\tthis.stencil.connectMult([\r\n\t\t\t[\"onDrag\", this, \"showAngle\"],\r\n\t\t\t[\"onUp\", this, \"hideAngle\"],\r\n\t\t\t[\"onTransformBegin\", this, \"showAngle\"],\r\n\t\t\t[\"onTransform\", this, \"showAngle\"],\r\n\t\t\t[\"onTransformEnd\", this, \"hideAngle\"]\r\n\t\t]);\r\n\t},\r\n\t{\r\n\t\t// summary:\r\n\t\t//\t\tWhen initiated, an HTML box will hover near the Stencil,\r\n\t\t//\t\tdisplaying it's angle while drawn or modified. Currently\r\n\t\t//\t\tonly works with Vector, Line, Arrow, and Axes.\r\n\t\t// description:\r\n\t\t//\t\tAnnotation is positioned with dojox.drawing.util.positioning.angle\r\n\t\t//\t\tThat method should be overwritten for custom placement.\r\n\t\t//\t\tCalled internally.\r\n\r\n\t\ttype:\"dojox.drawing.tools.custom\",\r\n\t\tangle:0,\r\n\r\n\t\tshowAngle: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCalled to display angle\r\n\r\n\t\t\tif(!this.stencil.selected && this.stencil.created){ return; }\r\n\t\t\tif(this.stencil.getRadius() < this.stencil.minimumSize){\r\n\t\t\t\tthis.hideAngle();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar node = this.getAngleNode();\r\n\t\t\tvar d = this.stencil.pointsToData();\r\n\t\t\tvar pt = positioning.angle({x:d.x1,y:d.y1},{x:d.x2,y:d.y2});\r\n\t\t\tvar sc = this.mouse.scrollOffset();\r\n\t\t\tvar mx = this.stencil.getTransform();\r\n\t\t\tvar dx = mx.dx / this.mouse.zoom;\r\n\t\t\tvar dy = mx.dy / this.mouse.zoom;\r\n\t\t\tpt.x /= this.mouse.zoom;\r\n\t\t\tpt.y /= this.mouse.zoom;\r\n\r\n\t\t\t// adding _offX & _offY since this is HTML\r\n\t\t\t// and we are from the page corner, not\r\n\t\t\t// the canvas corner\r\n\t\t\tvar x = this.stencil._offX + pt.x - sc.left + dx;\r\n\t\t\tvar y = this.stencil._offY + pt.y - sc.top + dy;\r\n\t\t\tdojo.style(node, {\r\n\t\t\t\tleft:  \tx + \"px\",\r\n\t\t\t\ttop: \ty + \"px\",\r\n\t\t\t\talign:pt.align\r\n\t\t\t});\r\n\r\n\t\t\tvar angle=this.stencil.getAngle();\r\n\t\t\tif(this.stencil.style.zAxis && this.stencil.shortType==\"vector\"){\r\n\t\t\t  node.innerHTML = this.stencil.data.cosphi > 0 ? \"out of\" : \"into\";\r\n\t\t\t}else if(this.stencil.shortType==\"line\"){\r\n\t\t\t  node.innerHTML = this.stencil.style.zAxis?\"out of\":Math.ceil(angle%180);\r\n\t\t\t}else{\r\n\t\t\t  node.innerHTML = Math.ceil(angle);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetAngleNode: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tGets or creates HTMLNode used for display\r\n\t\t\tif(!this._angleNode){\r\n\t\t\t\tthis._angleNode = dojo.create(\"span\", null, dojo.body());\r\n\t\t\t\tdojo.addClass(this._angleNode, \"textAnnotation\");\r\n\t\t\t\tdojo.style(this._angleNode, \"opacity\", 1);\r\n\t\t\t}\r\n\t\t\treturn this._angleNode; //HTMLNode\r\n\t\t},\r\n\r\n\t\thideAngle: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTurns display off.\r\n\r\n\t\t\tif(this._angleNode && dojo.style(this._angleNode, \"opacity\")>0.9){\r\n\r\n\t\t\t\tdojo.fadeOut({node:this._angleNode,\r\n\t\t\t\t\tduration:500,\r\n\t\t\t\t\tonEnd: function(node){\r\n\t\t\t\t\t\tdojo.destroy(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).play();\r\n\t\t\t\tthis._angleNode = null;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n);\r\n});\r\n"]}