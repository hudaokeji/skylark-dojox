{"version":3,"sources":["drawing/annotations/Label.js"],"names":["define","exports","lang","oo","Text","Label","declare","options","this","master","stencil","labelPosition","isFunction","setLabel","setLabelCustom","text","connect","style","labelSameColor","_align","drawingType","d","hitch","setData","x","y","width","w","minWidth","height","h","_lineHeight","split","getText","render","typesetter","box","getBounds","test","y2","y1","x2","labelWidth","data","beforeAttr","key","value","undefined","k","attr","created"],"mappings":";;;;;;;AAAAA,QAAQ,UAAW,kBAAmB,aAAc,mBACpD,SAASC,EAASC,EAAMC,EAAIC,GAI5BH,EAAQI,MAAQF,EAAGG,QAClBF,EACA,SAAmBG,GAIlBC,KAAKC,OAASF,EAAQG,QACtBF,KAAKG,cAAgBJ,EAAQI,eAAiB,KAC3CT,EAAKU,WAAWJ,KAAKG,iBACvBH,KAAKK,SAAWL,KAAKM,gBAEtBN,KAAKK,SAASN,EAAQQ,MAAQ,IAC9BP,KAAKQ,QAAQR,KAAKC,OAAQ,cAAeD,KAAM,YAC/CA,KAAKQ,QAAQR,KAAKC,OAAQ,UAAWD,KAAM,WAExCA,KAAKS,MAAMC,gBACbV,KAAKQ,QAAQR,KAAKC,OAAQ,OAAQD,KAAM,gBAUzCW,OAAO,QACPC,YAAY,QAEZN,eAAgB,SAAuBC,GAItC,IAAIM,EAAInB,EAAKoB,MAAMd,KAAKC,OAAQD,KAAKG,cAA7BT,GACRM,KAAKe,SACJC,EAAEH,EAAEG,EACJC,EAAEJ,EAAEI,EACJC,MAAML,EAAEM,GAAKnB,KAAKS,MAAMF,KAAKa,SAC7BC,OAAOR,EAAES,GAAKtB,KAAKuB,cAIjBhB,IAASA,EAAKiB,QAAQjB,EAAOP,KAAKyB,WAErCzB,KAAK0B,OAAO1B,KAAK2B,WAAWpB,KAG7BF,SAAU,SAAqBE,GAM9B,IAAIS,EAAGC,EAAGW,EAAM5B,KAAKC,OAAO4B,YAG3BZ,EADE,IAAIa,KAAK9B,KAAKG,eACZyB,EAAIG,GAAK/B,KAAKuB,YAEdK,EAAII,GAGN,IAAIF,KAAK9B,KAAKG,eAChBa,EAAIY,EAAIK,IAERhB,EAAIW,EAAII,GACRhC,KAAKW,OAAS,QAGXX,KAAKkC,YAAe3B,GAAQA,EAAKiB,OAASjB,GAAQP,KAAKyB,WAC1DzB,KAAKe,SACJC,EAAEA,EACFC,EAAEA,EACFI,OAAOrB,KAAKuB,YACZL,MAAMlB,KAAKS,MAAMF,KAAKa,WAGvBpB,KAAKkC,WAAalC,KAAKS,MAAMF,KAAKa,SAClCpB,KAAK0B,OAAO1B,KAAK2B,WAAWpB,MAI5BP,KAAKe,SACJC,EAAEA,EACFC,EAAEA,EACFI,OAAOrB,KAAKmC,KAAKd,OACjBH,MAAMlB,KAAKmC,KAAKjB,QAGjBlB,KAAK0B,WAIPU,WAAY,SAASC,EAAKC,GACzB,QAAWC,IAARD,EAAkB,CAEpB,IAAIE,EAAIH,GAAKA,MAAcG,GAAKF,SAE1BD,EAAIrB,SACJqB,EAAIpB,SACJoB,EAAInB,aACJmB,EAAIhB,OACXrB,KAAKyC,KAAKJ,IAETrC,KAAK0C,SAAW1C,KAAK0B","file":"../../../drawing/annotations/Label.js","sourcesContent":["define([\"exports\", \"dojo/_base/lang\", \"../util/oo\", \"../stencil/Text\"],\r\nfunction(exports, lang, oo, Text){\r\n\r\n// TODO: why not just return Label?\r\n\r\nexports.Label = oo.declare(\r\n\tText,\r\n\tfunction(/*Object*/options){\r\n\t\t// options: Object\r\n\t\t//\t\tOne key value: the stencil that called this.\r\n\r\n\t\tthis.master = options.stencil;\r\n\t\tthis.labelPosition = options.labelPosition || \"BR\"; // TL, TR, BR, BL, or function\r\n\t\tif(lang.isFunction(this.labelPosition)){\r\n\t\t\tthis.setLabel = this.setLabelCustom;\r\n\t\t}\r\n\t\tthis.setLabel(options.text || \"\");\r\n\t\tthis.connect(this.master, \"onTransform\", this, \"setLabel\");\r\n\t\tthis.connect(this.master, \"destroy\", this, \"destroy\");\r\n\t\t\r\n\t\tif(this.style.labelSameColor){\r\n\t\t\tthis.connect(this.master, \"attr\", this, \"beforeAttr\");\r\n\t\t}\r\n\t},{\r\n\t\t// summary:\r\n\t\t//\t\tAn annotation called internally to label an Stencil.\r\n\t\t// description:\r\n\t\t//\t\tAnnotation is positioned with dojox.drawing.util.positioning.label\r\n\t\t//\t\tThat method should be overwritten for custom placement. Or,\r\n\t\t//\t\tadd a 'setLabelCustom' method to the Stencil and it will be used.\r\n\r\n\t\t_align:\"start\",\r\n\t\tdrawingType:\"label\",\r\n\t\t\r\n\t\tsetLabelCustom: function(/* ? String */text){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tAttaches to custom positioning within a Stencil\r\n\r\n\t\t\tvar d = lang.hitch(this.master, this.labelPosition)();\r\n\t\t\tthis.setData({\r\n\t\t\t\tx:d.x,\r\n\t\t\t\ty:d.y,\r\n\t\t\t\twidth:d.w || this.style.text.minWidth,\r\n\t\t\t\theight:d.h || this._lineHeight\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// is an event, not text, so keep the old label:\r\n\t\t\tif(text && !text.split){ text = this.getText(); }\r\n\t\t\t\r\n\t\t\tthis.render(this.typesetter(text));\r\n\t\t},\r\n\t\t\r\n\t\tsetLabel: function(/* String */text){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSets the text of the label. Not called directly. Should\r\n\t\t\t//\t\tbe called within Stencil. See stencil._Base\r\n\r\n\t\t\t// onTransform will pass an object here\r\n\t\t\tvar x, y, box = this.master.getBounds();\r\n\t\t\t\r\n\t\t\tif(/B/.test(this.labelPosition)){\r\n\t\t\t\ty = box.y2 - this._lineHeight;\r\n\t\t\t}else{\r\n\t\t\t\ty = box.y1;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(/R/.test(this.labelPosition)){\r\n\t\t\t\tx = box.x2;\r\n\t\t\t}else{\r\n\t\t\t\ty = box.y1;\r\n\t\t\t\tthis._align = \"end\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(!this.labelWidth || (text && text.split && text != this.getText())){\r\n\t\t\t\tthis.setData({\r\n\t\t\t\t\tx:x,\r\n\t\t\t\t\ty:y,\r\n\t\t\t\t\theight:this._lineHeight,\r\n\t\t\t\t\twidth:this.style.text.minWidth\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tthis.labelWidth = this.style.text.minWidth;\r\n\t\t\t\tthis.render(this.typesetter(text));\r\n\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\t\r\n\t\t\t\tthis.setData({\r\n\t\t\t\t\tx:x,\r\n\t\t\t\t\ty:y,\r\n\t\t\t\t\theight:this.data.height,\r\n\t\t\t\t\twidth:this.data.width\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tthis.render();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tbeforeAttr: function(key, value){\r\n\t\t\tif(value!==undefined){\r\n\t\t\t\t// make it an object\r\n\t\t\t\tvar k = key; key = {}; key[k] = value;\r\n\t\t\t}\r\n\t\t\tdelete key.x;\r\n\t\t\tdelete key.y;\r\n\t\t\tdelete key.width;\r\n\t\t\tdelete key.height;\r\n\t\t\tthis.attr(key);\r\n\t\t\t // FIXME: this.created should already be set, shouldn't it?\r\n\t\t\t!this.created && this.render();\r\n\t\t}\r\n\t}\r\n\r\n);\r\n});\r\n"]}