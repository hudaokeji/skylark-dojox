{"version":3,"sources":["storage/AirFileStorageProvider.js"],"names":["dojo","provide","require","isAIR","air","File","window","runtime","flash","filesystem","FileStream","FileMode","declare","dojox","storage","Provider","initialized","_storagePath","initialize","this","dir","applicationStorageDirectory","resolvePath","exists","createDirectory","e","console","debug","manager","loaded","isAvailable","put","key","value","resultsHandler","namespace","isValidKey","Error","DEFAULT_NAMESPACE","remove","file","stream","open","WRITE","writeObject","close","FAILED","toString","SUCCESS","get","results","isDirectory","READ","readObject","getNamespaces","i","files","getDirectoryListing","length","name","push","getKeys","clear","deleteDirectory","deleteFile","putMultiple","keys","values","isValidKeyArray","Array","_statusHandler","getMultiple","removeMultiple","isPermanent","getMaximumSize","SIZE_NO_LIMIT","hasSettingsUI","showSettingsUI","declaredClass","hideSettingsUI","register","AirFileStorageProvider"],"mappings":"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","file":"../../storage/AirFileStorageProvider.js","sourcesContent":["dojo.provide(\"dojox.storage.AirFileStorageProvider\");\r\ndojo.require(\"dojox.storage.manager\");\r\ndojo.require(\"dojox.storage.Provider\");\r\n\r\nif (dojo.isAIR) {\r\n\t(function(){\r\n\r\n\t\tif (!air) {\r\n\t\t\tvar air = {};\r\n\t\t}\r\n\t\tair.File = window.runtime.flash.filesystem.File;\r\n\t\tair.FileStream = window.runtime.flash.filesystem.FileStream;\r\n\t\tair.FileMode = window.runtime.flash.filesystem.FileMode;\r\n\t\t\r\n\t\t// summary:\r\n\t\t//\t\tStorage provider that uses features in the Adobe AIR runtime to achieve\r\n\t\t//\t\tpermanent storage\r\n\t\tdojo.declare(\"dojox.storage.AirFileStorageProvider\", [ dojox.storage.Provider ], {\r\n\t\t\tinitialized: false,\r\n\t\t\t\r\n\t\t\t_storagePath: \"__DOJO_STORAGE/\",\r\n\t\r\n\t\t\tinitialize: function(){\r\n\t\t\t\tthis.initialized = false;\r\n\r\n\t\t\t\t// need to initialize our storage directory\r\n\t\t\t\ttry{\r\n\t\t\t\t\tvar dir = air.File.applicationStorageDirectory.resolvePath(this._storagePath);\r\n\t\t\t\t\tif (!dir.exists){\r\n\t\t\t\t\t\tdir.createDirectory();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.initialized = true;\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\tconsole.debug(\"dojox.storage.AirFileStorageProvider.initialize:\", e);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// indicate that this storage provider is now loaded\r\n\t\t\t\tdojox.storage.manager.loaded();\r\n\t\t\t},\r\n\t\r\n\t\t\tisAvailable: function(){\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tput: function(key, value, resultsHandler, namespace){\r\n\t\t\t\tif(this.isValidKey(key) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid key given: \" + key);\r\n\t\t\t\t}\r\n\t\t\t\tnamespace = namespace||this.DEFAULT_NAMESPACE;\r\n\t\t\t\tif(this.isValidKey(namespace) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid namespace given: \" + namespace);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// try to store the value\r\n\t\t\t\ttry{\r\n\t\t\t\t\tthis.remove(key, namespace);\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar dir = air.File.applicationStorageDirectory.resolvePath(this._storagePath + namespace);\r\n\t\t\t\t\tif (!dir.exists){\r\n\t\t\t\t\t\tdir.createDirectory();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar file = dir.resolvePath(key);\r\n\t\t\t\t\tvar stream = new air.FileStream();\r\n\t\t\t\t\tstream.open(file, air.FileMode.WRITE);\r\n\t\t\t\t\tstream.writeObject(value);\r\n\t\t\t\t\tstream.close();\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\t// indicate we failed\r\n\t\t\t\t\tconsole.debug(\"dojox.storage.AirFileStorageProvider.put:\", e);\r\n\t\t\t\t\tresultsHandler(this.FAILED, key, e.toString(), namespace);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(resultsHandler){\r\n\t\t\t\t\tresultsHandler(this.SUCCESS, key, null, namespace);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tget: function(key, namespace){\r\n\t\t\t\tif(this.isValidKey(key) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid key given: \" + key);\r\n\t\t\t\t}\r\n\t\t\t\tnamespace = namespace||this.DEFAULT_NAMESPACE;\r\n\t\t\t\t\r\n\t\t\t\tvar results = null;\r\n\t\t\t\t\r\n\t\t\t\tvar file = air.File.applicationStorageDirectory.resolvePath(this._storagePath + namespace + '/' + key);\r\n\t\t\t\tif (file.exists && !file.isDirectory){\r\n\t\t\t\t\tvar stream = new air.FileStream();\r\n\t\t\t\t\tstream.open(file, air.FileMode.READ);\r\n\t\t\t\t\tresults = stream.readObject();\r\n\t\t\t\t\tstream.close();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn results;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tgetNamespaces: function(){\r\n\t\t\t\tvar results = [ this.DEFAULT_NAMESPACE ];\r\n\t\t\t\tvar dir = air.File.applicationStorageDirectory.resolvePath(this._storagePath);\r\n\t\t\t\tvar files = dir.getDirectoryListing(), i;\r\n\t\t\t\tfor (i = 0; i < files.length; i++) {\r\n\t\t\t\t\tif(files[i].isDirectory && files[i].name != this.DEFAULT_NAMESPACE){\r\n\t\t\t\t\t\tresults.push(files[i].name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn results;\r\n\t\t\t},\r\n\r\n\t\t\tgetKeys: function(namespace){\r\n\t\t\t\tnamespace = namespace||this.DEFAULT_NAMESPACE;\r\n\t\t\t\tif(this.isValidKey(namespace) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid namespace given: \" + namespace);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar results = [];\r\n\t\t\t\tvar dir = air.File.applicationStorageDirectory.resolvePath(this._storagePath + namespace);\r\n\t\t\t\tif (dir.exists && dir.isDirectory){\r\n\t\t\t\t\tvar files = dir.getDirectoryListing(), i;\r\n\t\t\t\t\tfor (i = 0; i < files.length; i++) {\r\n\t\t\t\t\t\tresults.push(files[i].name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn results;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tclear: function(namespace){\r\n\t\t\t\tif(this.isValidKey(namespace) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid namespace given: \" + namespace);\r\n\t\t\t\t}\r\n\t\t\t\tvar dir = air.File.applicationStorageDirectory.resolvePath(this._storagePath + namespace);\r\n\t\t\t\tif (dir.exists && dir.isDirectory){\r\n\t\t\t\t\tdir.deleteDirectory(true);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tremove: function(key, namespace){\r\n\t\t\t\tnamespace = namespace||this.DEFAULT_NAMESPACE;\r\n\t\t\t\tvar file = air.File.applicationStorageDirectory.resolvePath(this._storagePath + namespace + '/' + key);\r\n\t\t\t\tif (file.exists && !file.isDirectory){\r\n\t\t\t\t\tfile.deleteFile();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tputMultiple: function(keys, values, resultsHandler, namespace) {\r\n \t\t\t\tif(this.isValidKeyArray(keys) === false\r\n\t\t\t\t\t\t|| ! values instanceof Array\r\n\t\t\t\t\t\t|| keys.length != values.length){\r\n\t\t\t\t\tthrow new Error(\"Invalid arguments: keys = [\" + keys + \"], values = [\" + values + \"]\");\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(namespace == null || typeof namespace == \"undefined\"){\r\n\t\t\t\t\tnamespace = this.DEFAULT_NAMESPACE;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif(this.isValidKey(namespace) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid namespace given: \" + namespace);\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tthis._statusHandler = resultsHandler;\r\n\r\n\t\t\t\t// try to store the value\r\n\t\t\t\ttry{\r\n\t\t\t\t\tfor(var i=0;i<keys.length;i++) {\r\n\t\t\t\t\t\tthis.put(keys[i], values[i], null, namespace);\r\n\t\t\t\t\t}\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\t// indicate we failed\r\n\t\t\t\t\tconsole.debug(\"dojox.storage.AirFileStorageProvider.putMultiple:\", e);\r\n\t\t\t\t\tif(resultsHandler){\r\n\t\t\t\t\t\tresultsHandler(this.FAILED, keys, e.toString(), namespace);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(resultsHandler){\r\n\t\t\t\t\tresultsHandler(this.SUCCESS, keys, null, namespace);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetMultiple: function(keys, namespace){\r\n\t\t\t\tif(this.isValidKeyArray(keys) === false){\r\n\t\t\t\t\tthrow new Error(\"Invalid key array given: \" + keys);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(namespace == null || typeof namespace == \"undefined\"){\r\n\t\t\t\t\tnamespace = this.DEFAULT_NAMESPACE;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(this.isValidKey(namespace) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid namespace given: \" + namespace);\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\tvar results = [];\r\n\t\t\t\tfor(var i=0;i<keys.length;i++){\r\n\t\t\t\t\tresults[i] = this.get(keys[i], namespace);\r\n\t\t\t\t}\r\n\t\t\t\treturn results;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tremoveMultiple: function(keys, namespace){\r\n\t\t\t\tnamespace = namespace||this.DEFAULT_NAMESPACE;\r\n\t\t\t\t\r\n\t\t\t\tfor(var i=0;i<keys.length;i++){\r\n\t\t\t\t\tthis.remove(keys[i], namespace);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tisPermanent: function(){ return true; },\r\n\r\n\t\t\tgetMaximumSize: function(){ return this.SIZE_NO_LIMIT; },\r\n\r\n\t\t\thasSettingsUI: function(){ return false; },\r\n\t\t\t\r\n\t\t\tshowSettingsUI: function(){\r\n\t\t\t\tthrow new Error(this.declaredClass + \" does not support a storage settings user-interface\");\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\thideSettingsUI: function(){\r\n\t\t\t\tthrow new Error(this.declaredClass + \" does not support a storage settings user-interface\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdojox.storage.manager.register(\"dojox.storage.AirFileStorageProvider\", new dojox.storage.AirFileStorageProvider());\r\n\t\tdojox.storage.manager.initialize();\r\n\t})();\r\n}"]}