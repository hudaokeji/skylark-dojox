{"version":3,"sources":["storage/AirEncryptedLocalStorageProvider.js"],"names":["dojo","provide","require","isAIR","air","ByteArray","window","runtime","flash","utils","EncryptedLocalStore","data","declare","dojox","storage","Provider","initialize","manager","loaded","isAvailable","_getItem","key","storedValue","getItem","readUTFBytes","length","_setItem","value","bytes","writeUTFBytes","setItem","_removeItem","removeItem","put","resultsHandler","namespace","this","isValidKey","Error","DEFAULT_NAMESPACE","namespaces","indexOf","keys","e","console","debug","FAILED","toString","SUCCESS","get","getNamespaces","results","split","i","push","getKeys","clear","replace","remove","putMultiple","values","isValidKeyArray","Array","_statusHandler","getMultiple","removeMultiple","isPermanent","getMaximumSize","SIZE_NO_LIMIT","hasSettingsUI","showSettingsUI","declaredClass","hideSettingsUI","register","AirEncryptedLocalStorageProvider"],"mappings":"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","file":"../../storage/AirEncryptedLocalStorageProvider.js","sourcesContent":["dojo.provide(\"dojox.storage.AirEncryptedLocalStorageProvider\");\r\ndojo.require(\"dojox.storage.manager\");\r\ndojo.require(\"dojox.storage.Provider\");\r\n\r\nif (dojo.isAIR) {\r\n\t(function(){\r\n\t\t\r\n\t\tif (!air) {\r\n\t\t\tvar air = {};\r\n\t\t}\r\n\t\tair.ByteArray = window.runtime.flash.utils.ByteArray;\r\n\t\tair.EncryptedLocalStore = window.runtime.flash.data.EncryptedLocalStore,\r\n\r\n\t\t// summary:\r\n\t\t//\t\tStorage provider that uses features in the Adobe AIR runtime to achieve\r\n\t\t//\t\tpermanent storage\r\n\t\tdojo.declare(\"dojox.storage.AirEncryptedLocalStorageProvider\", [ dojox.storage.Provider ], {\r\n\t\t\tinitialize: function(){\r\n\t\t\t\t// indicate that this storage provider is now loaded\r\n\t\t\t\tdojox.storage.manager.loaded();\r\n\t\t\t},\r\n\t\r\n\t\t\tisAvailable: function(){\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t_getItem: function(key){\r\n\t\t\t\tvar storedValue = air.EncryptedLocalStore.getItem(\"__dojo_\" + key);\r\n\t\t\t\treturn storedValue ? storedValue.readUTFBytes(storedValue.length) : \"\";\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t_setItem: function(key, value){\r\n\t\t\t\tvar bytes = new air.ByteArray();\r\n\t\t\t\tbytes.writeUTFBytes(value);\r\n\t\t\t\tair.EncryptedLocalStore.setItem(\"__dojo_\" + key, bytes);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t_removeItem: function(key){\r\n\t\t\t\tair.EncryptedLocalStore.removeItem(\"__dojo_\" + key);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tput: function(key, value, resultsHandler, namespace){\r\n\t\t\t\tif(this.isValidKey(key) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid key given: \" + key);\r\n\t\t\t\t}\r\n\t\t\t\tnamespace = namespace||this.DEFAULT_NAMESPACE;\r\n\t\t\t\tif(this.isValidKey(namespace) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid namespace given: \" + namespace);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// try to store the value\r\n\t\t\t\ttry{\r\n\t\t\t\t\tvar namespaces = this._getItem(\"namespaces\")||'|';\r\n\t\t\t\t\tif(namespaces.indexOf('|'+namespace+'|')==-1){\r\n\t\t\t\t\t\tthis._setItem(\"namespaces\", namespaces + namespace + '|');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar keys = this._getItem(namespace + \"_keys\")||'|';\r\n\t\t\t\t\tif(keys.indexOf('|'+key+'|')==-1){\r\n\t\t\t\t\t\tthis._setItem(namespace + \"_keys\", keys + key + '|');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._setItem('_' + namespace + '_' + key, value);\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\t// indicate we failed\r\n\t\t\t\t\tconsole.debug(\"dojox.storage.AirEncryptedLocalStorageProvider.put:\", e);\r\n\t\t\t\t\tresultsHandler(this.FAILED, key, e.toString(), namespace);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(resultsHandler){\r\n\t\t\t\t\tresultsHandler(this.SUCCESS, key, null, namespace);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tget: function(key, namespace){\r\n\t\t\t\tif(this.isValidKey(key) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid key given: \" + key);\r\n\t\t\t\t}\r\n\t\t\t\tnamespace = namespace||this.DEFAULT_NAMESPACE;\r\n\t\t\t\treturn this._getItem('_' + namespace + '_' + key);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tgetNamespaces: function(){\r\n\t\t\t\tvar results = [ this.DEFAULT_NAMESPACE ];\r\n\t\t\t\tvar namespaces = (this._getItem(\"namespaces\")||'|').split('|');\r\n\t\t\t\tfor (var i=0;i<namespaces.length;i++){\r\n\t\t\t\t\tif(namespaces[i].length && namespaces[i] != this.DEFAULT_NAMESPACE){\r\n\t\t\t\t\t\tresults.push(namespaces[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn results;\r\n\t\t\t},\r\n\r\n\t\t\tgetKeys: function(namespace){\r\n\t\t\t\tnamespace = namespace||this.DEFAULT_NAMESPACE;\r\n\t\t\t\tif(this.isValidKey(namespace) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid namespace given: \" + namespace);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar results = [];\r\n\t\t\t\tvar keys = (this._getItem(namespace + \"_keys\")||'|').split('|');\r\n\t\t\t\tfor (var i=0;i<keys.length;i++){\r\n\t\t\t\t\tif (keys[i].length){\r\n\t\t\t\t\t\tresults.push(keys[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn results;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tclear: function(namespace){\r\n\t\t\t\tif(this.isValidKey(namespace) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid namespace given: \" + namespace);\r\n\t\t\t\t}\r\n\t\t\t\tvar namespaces = this._getItem(\"namespaces\")||'|';\r\n\t\t\t\tif(namespaces.indexOf('|'+namespace+'|')!=-1){\r\n\t\t\t\t\tthis._setItem(\"namespaces\", namespaces.replace('|' + namespace + '|', '|'));\r\n\t\t\t\t}\r\n\t\t\t\tvar keys = (this._getItem(namespace + \"_keys\")||'|').split('|');\r\n\t\t\t\tfor (var i=0;i<keys.length;i++){\r\n\t\t\t\t\tif (keys[i].length){\r\n\t\t\t\t\t\tthis._removeItem(namespace + \"_\" + keys[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis._removeItem(namespace + \"_keys\");\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tremove: function(key, namespace){\r\n\t\t\t\tnamespace = namespace||this.DEFAULT_NAMESPACE;\r\n\t\t\t\t\r\n\t\t\t\tvar keys = this._getItem(namespace + \"_keys\")||'|';\r\n\t\t\t\tif(keys.indexOf('|'+key+'|')!=-1){\r\n\t\t\t\t\tthis._setItem(namespace + \"_keys\", keys.replace('|' + key + '|', '|'));\r\n\t\t\t\t}\r\n\t\t\t\tthis._removeItem('_' + namespace + '_' + key);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tputMultiple: function(keys, values, resultsHandler, namespace) {\r\n \t\t\t\tif(this.isValidKeyArray(keys) === false\r\n\t\t\t\t\t\t|| ! values instanceof Array\r\n\t\t\t\t\t\t|| keys.length != values.length){\r\n\t\t\t\t\tthrow new Error(\"Invalid arguments: keys = [\" + keys + \"], values = [\" + values + \"]\");\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(namespace == null || typeof namespace == \"undefined\"){\r\n\t\t\t\t\tnamespace = this.DEFAULT_NAMESPACE;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif(this.isValidKey(namespace) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid namespace given: \" + namespace);\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tthis._statusHandler = resultsHandler;\r\n\r\n\t\t\t\t// try to store the value\r\n\t\t\t\ttry{\r\n\t\t\t\t\tfor(var i=0;i<keys.length;i++) {\r\n\t\t\t\t\t\tthis.put(keys[i], values[i], null, namespace);\r\n\t\t\t\t\t}\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\t// indicate we failed\r\n\t\t\t\t\tconsole.debug(\"dojox.storage.AirEncryptedLocalStorageProvider.putMultiple:\", e);\r\n\t\t\t\t\tif(resultsHandler){\r\n\t\t\t\t\t\tresultsHandler(this.FAILED, keys, e.toString(), namespace);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(resultsHandler){\r\n\t\t\t\t\tresultsHandler(this.SUCCESS, keys, null);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetMultiple: function(keys, namespace){\r\n\t\t\t\tif(this.isValidKeyArray(keys) === false){\r\n\t\t\t\t\tthrow new Error(\"Invalid key array given: \" + keys);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(namespace == null || typeof namespace == \"undefined\"){\r\n\t\t\t\t\tnamespace = this.DEFAULT_NAMESPACE;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(this.isValidKey(namespace) == false){\r\n\t\t\t\t\tthrow new Error(\"Invalid namespace given: \" + namespace);\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\tvar results = [];\r\n\t\t\t\tfor(var i=0;i<keys.length;i++){\r\n\t\t\t\t\tresults[i] = this.get(keys[i], namespace);\r\n\t\t\t\t}\r\n\t\t\t\treturn results;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tremoveMultiple: function(keys, namespace){\r\n\t\t\t\tnamespace = namespace||this.DEFAULT_NAMESPACE;\r\n\t\t\t\tfor(var i=0;i<keys.length;i++){\r\n\t\t\t\t\tthis.remove(keys[i], namespace);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tisPermanent: function(){ return true; },\r\n\r\n\t\t\tgetMaximumSize: function(){ return this.SIZE_NO_LIMIT; },\r\n\r\n\t\t\thasSettingsUI: function(){ return false; },\r\n\t\t\t\r\n\t\t\tshowSettingsUI: function(){\r\n\t\t\t\tthrow new Error(this.declaredClass + \" does not support a storage settings user-interface\");\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\thideSettingsUI: function(){\r\n\t\t\t\tthrow new Error(this.declaredClass + \" does not support a storage settings user-interface\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdojox.storage.manager.register(\"dojox.storage.AirEncryptedLocalStorageProvider\", new dojox.storage.AirEncryptedLocalStorageProvider());\r\n\t\tdojox.storage.manager.initialize();\r\n\t})();\r\n}"]}