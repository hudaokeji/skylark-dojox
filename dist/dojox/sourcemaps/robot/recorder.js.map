{"version":3,"sources":["robot/recorder.js"],"names":["dojo","provide","experimental","KEYPRESS_MAXIMUM_DELAY","MOUSEMOVE_MAXIMUM_DELAY","MAXIMUM_DELAY","commands","testNumber","startTime","prevTime","start","alert","Date","addCommand","name","args","keys","ENTER","eval","ctrl","alt","dt","Math","max","min","round","getTime","push","_optimize","c","splice","i","length","ALT","CTRL","next","nextdt","temp","cmd","j","typeTime","toggle","stop","console","log","s","div","document","createElement","id","style","backgroundColor","position","scroll","y","window","pageYOffset","documentElement","scrollTop","body","x","pageXOffset","_fixIeBiDiScrollLeft","scrollLeft","undefined","left","top","h1","innerHTML","appendChild","pre","innerText","textContent","button","connect","e","stopEvent","removeChild","disconnect","getSelector","node","nodes","getElementsByTagName","nodeName","getMouseButtonObject","b","getModifierObject","keyCode","ctrlKey","altKey","lastEvent","type","onmousedown","selector","target","coords","clientX","clientY","isIE","onclick","onmouseup","onmousemove","pageX","pageY","onmousewheel","detail","wheelDelta","onkeypress","charCode","charOrCode","SPACE","onkeyup","isMozilla","addOnLoad","widget","event","f","_mine","hitchedf","toLowerCase","hitch","this"],"mappings":"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","file":"../../robot/recorder.js","sourcesContent":["dojo.provide(\"dojox.robot.recorder\");\r\ndojo.experimental(\"dojox.robot.recorder\");\r\n// summary:\r\n// \tGenerates a doh test as you interact with a Web page.\r\n// \tTo record a test, click inside the document body and press CTRL-ALT-ENTER.\r\n// \tTo finish recording a test and to display the autogenerated code, press CTRL-ALT-ENTER again.\r\n//\r\n\r\n\r\n(function(){\r\n\r\n// CONSTANTS\r\n\r\n// consolidate keypresses into one typeKeys if they occur within 1 second of each other\r\nvar KEYPRESS_MAXIMUM_DELAY = 1000;\r\n\r\n// consolidate mouse movements if they occur within .5 seconds of each other\r\nvar MOUSEMOVE_MAXIMUM_DELAY = 500;\r\n\r\n// absolute longest wait between commands\r\n// anything longer gets chopped to 10\r\nvar MAXIMUM_DELAY = 10000;\r\n\r\n// stack of commands recorded from dojo.connects\r\nvar commands = [];\r\n\r\n// number to write next to test name\r\n// goes up after each recording\r\nvar testNumber = 0;\r\n\r\n// time user started test\r\nvar startTime = null;\r\n\r\n// time since last user input\r\n// robot commands work on deltas\r\nvar prevTime = null;\r\n\r\nvar start = function(){\r\n\t// summary:\r\n\t//\tStarts recording the user's input.\r\n\t//\r\n\talert(\"Started recording.\");\r\n\tcommands = [];\r\n\tstartTime = new Date();\r\n\tprevTime = new Date();\r\n}\r\n\r\nvar addCommand = function(name, args){\r\n\t// summary:\r\n\t//\tAdd a command to the stack.\r\n\t//\r\n\t// name:\r\n\t//\tdoh.robot function to call.\r\n\t//\r\n\t// args:\r\n\t//\targuments array to pass to the doh.robot\r\n\t//\r\n\r\n\t// omit start/stop record\r\n\tif(startTime == null\r\n\t\t|| name==\"doh.robot.keyPress\"\r\n\t\t&& args[0]==dojo.keys.ENTER\r\n\t\t&& eval(\"(\"+args[2]+\")\").ctrl\r\n\t\t&& eval(\"(\"+args[2]+\")\").alt){ return; }\r\n\tvar dt = Math.max(Math.min(Math.round((new Date()).getTime() - prevTime.getTime()),MAXIMUM_DELAY),1);\r\n\t// add in dt\r\n\t// is usually args[1] but there are exceptions\r\n\tif(name == \"doh.robot.mouseMove\"){\r\n\t\targs[2]=dt;\r\n\t}else{\r\n\t\targs[1]=dt;\r\n\t}\r\n\tcommands.push({name:name,args:args});\r\n\tprevTime = new Date();\r\n}\r\n\r\nvar _optimize = function(){\r\n\t// make the stack more human-readable and remove any odditites\r\n\tvar c = commands;\r\n\r\n\t// INITIAL OPTIMIZATIONS\r\n\t// remove starting ENTER press\r\n\tif(c[0].name == \"doh.robot.keyPress\"\r\n\t\t&& (c[0].args[0] == dojo.keys.ENTER || c[0].args[0] == 77)){\r\n\t\tc.splice(0,1);\r\n\t}\r\n\t// remove ending CTRL + ALT keypresses in IE\r\n\tfor(var i = c.length-1; (i >= c.length-2) && (i>=0); i-- ){\r\n\t\tif(c[i].name == \"doh.robot.keyPress\"\r\n\t\t\t&& c[i].args[0]==dojo.keys.ALT || c[i].args[0]==dojo.keys.CTRL){\r\n\t\t\tc.splice(i,1);\r\n\t\t}\r\n\t}\r\n\t// ITERATIVE OPTIMIZATIONS\r\n\tfor(i = 0; i<c.length; i++){\r\n\t\tvar next, nextdt;\r\n\t\tif(c[i+1]\r\n\t\t\t&& c[i].name==\"doh.robot.mouseMove\"\r\n\t\t\t&& c[i+1].name==c[i].name\r\n\t\t\t&& c[i+1].args[2]<MOUSEMOVE_MAXIMUM_DELAY){\r\n\t\t\t// mouse movement optimization\r\n\t\t\t// if the movement is temporally close, collapse it\r\n\t\t\t// example: mouseMove(a,b,delay 5)+mouseMove(x,y,delay 10)+mousePress(delay 1) becomes mouseMove(x,y,delay 5)+mousePress(delay 11)\r\n\t\t\t// expected pattern:\r\n\t\t\t// \tc[i]: mouseMove\r\n\t\t\t// \tc[i+1]: mouseMove\r\n\t\t\t// \t...\r\n\t\t\t// \tc[i+n-1]: last mouseMove\r\n\t\t\t// \tc[i+n]: something else\r\n\t\t\t// result:\r\n\t\t\t// \tc[i]: last mouseMove\r\n\t\t\t// \tc[i+1]: something else\r\n\t\t\t// the c[i] mouse location changes to move to c[i+n-1]'s location, c[i+n] gains c[i+1]+c[i+2]+...c[i+n-1] delay so the timing is the same\r\n\r\n\t\t\tnext = c[i+1];\r\n\t\t\tnextdt = 0;\r\n\t\t\twhile(next\r\n\t\t\t\t&& next.name==c[i].name\r\n\t\t\t\t&& next.args[2]<MOUSEMOVE_MAXIMUM_DELAY){\r\n\t\t\t\t// cut out next\r\n\t\t\t\tc.splice(i + 1,1);\r\n\t\t\t\t// add next's delay to the total\r\n\t\t\t\tnextdt += next.args[2];\r\n\t\t\t\t// move to next mouse position\r\n\t\t\t\tc[i].args[0]=next.args[0];\r\n\t\t\t\tc[i].args[1]=next.args[1];\r\n\t\t\t\tnext = c[i+1];\r\n\t\t\t}\r\n\t\t\t// make the total delay the duration\r\n\t\t\tc[i].args[3]=nextdt;\r\n\t\t}else if(c[i+1]\r\n\t\t\t&& c[i].name==\"doh.robot.mouseWheel\"\r\n\t\t\t&& c[i+1].name==c[i].name\r\n\t\t\t&& c[i+1].args[1]<MOUSEMOVE_MAXIMUM_DELAY){\r\n\t\t\t// mouse wheel optimization\r\n\t\t\t// if the movement is temporally close, collapse it\r\n\t\t\t// example: mouseWheel(1,delay 5)+mouseWheel(-2,delay 10) becomes mouseWheel(-1,delay 5, speed 10)\r\n\t\t\t// expected pattern:\r\n\t\t\t// \tc[i]: mouseWheel\r\n\r\n\t\t\t// \tc[i+1]: mouseWheel\r\n\t\t\t// \t...\r\n\t\t\t// \tc[i+n-1]: last mouseWheel\r\n\t\t\t// \tc[i+n]: something else\r\n\t\t\t// result:\r\n\t\t\t// \tc[i]: mouseWheel\r\n\t\t\t// \tc[i+1]: something else\r\n\r\n\t\t\tnext = c[i+1];\r\n\t\t\tnextdt = 0;\r\n\t\t\twhile(next\r\n\t\t\t\t&& next.name==c[i].name\r\n\t\t\t\t&& next.args[1]<MOUSEMOVE_MAXIMUM_DELAY){\r\n\t\t\t\t// cut out next\r\n\t\t\t\tc.splice(i + 1, 1);\r\n\t\t\t\t// add next's delay to the total\r\n\t\t\t\tnextdt += next.args[1];\r\n\t\t\t\t// add in wheel amount\r\n\t\t\t\tc[i].args[0]+=next.args[0];\r\n\t\t\t\tnext = c[i+1];\r\n\t\t\t}\r\n\t\t\t// make the total delay the duration\r\n\t\t\tc[i].args[2]=nextdt;\r\n\t\t}else if(c[i + 2]\r\n\t\t\t&& c[i].name==\"doh.robot.mouseMoveAt\"\r\n\t\t\t&& c[i+2].name==\"doh.robot.scrollIntoView\"){\r\n\t\t\t// swap scrollIntoView of widget and mouseMoveAt\r\n\t\t\t// the recorder traps scrollIntoView after the mouse click registers, but in playback, it is better to go the other way\r\n\t\t\t// expected pattern:\r\n\t\t\t// \tc[i]: mouseMoveAt\r\n\t\t\t// \tc[i+1]: mousePress\r\n\t\t\t// \tc[i+2]: scrollIntoView\r\n\t\t\t// result:\r\n\t\t\t//\tc[i]: scrollIntoView\r\n\t\t\t//\tc[i+1]: mouseMoveAt\r\n\t\t\t//\tc[i+2]: mousePress\r\n\t\t\tvar temp = c.splice(i+2,1)[0];\r\n\t\t\tc.splice(i,0,temp);\r\n\t\t}else if(c[i + 1]\r\n\t\t\t&& c[i].name==\"doh.robot.mousePress\"\r\n\t\t\t&& c[i+1].name==\"doh.robot.mouseRelease\"\r\n\t\t\t&& c[i].args[0]==c[i+1].args[0]){\r\n\t\t\t// convert mousePress+mouseRelease to mouseClick\r\n\t\t\t// expected pattern:\r\n\t\t\t//\tc[i]: mousePress\r\n\t\t\t//\tc[i+1]: mouseRelease\r\n\t\t\t//\tmouse buttons are the same\r\n\t\t\tc[i].name = \"doh.robot.mouseClick\";\r\n\t\t\t// delete extra mouseRelease\r\n\t\t\tc.splice(i + 1,1);\r\n\t\t\t// if this was already a mouse click, get rid of the next (dup) one\r\n\t\t\tif(c[i+1] && c[i+1].name == \"doh.robot.mouseClick\" && c[i].args[0] == c[i+1].args[0]){\r\n\t\t\t\tc.splice(i + 1, 1);\r\n\t\t\t}\r\n\t\t}else if(c[i + 1]\r\n\t\t\t&& c[i - 1]\r\n\t\t\t&& c[i - 1].name==\"doh.robot.mouseMoveAt\"\r\n\t\t\t&& c[i].name==\"doh.robot.mousePress\"\r\n\t\t\t&& c[i+1].name==\"doh.robot.mouseMove\"){\r\n\t\t\t// convert mouseMoveAt+mousePress+mouseMove to mouseMoveAt+mousePress+mouseMoveAt+mouseMove\r\n\t\t\t// this is to kick off dojo.dnd by moving the mouse 1 px\r\n\t\t\t// expected pattern:\r\n\t\t\t//\tc[i-1]: mouseMoveAt\r\n\t\t\t//\tc[i]: mousePress\r\n\t\t\t//\tc[i+1]: mouseMove\r\n\r\n\t\t\t// insert new mouseMoveAt, 1px to the right\r\n\t\t\tvar cmd={name:\"doh.robot.mouseMoveAt\",args:[c[i-1].args[0], 1, 100, c[i-1].args[3]+1,c[i-1].args[4]]};\r\n\t\t\tc.splice(i+1,0,cmd);\r\n\t\t}else if(c[i + 1]\r\n\t\t\t&& ((c[i].name==\"doh.robot.keyPress\"\r\n\t\t\t\t&& typeof c[i].args[0] ==\"string\")\r\n\t\t\t\t|| c[i].name==\"doh.robot.typeKeys\")\r\n\t\t\t&& c[i+1].name==\"doh.robot.keyPress\"\r\n\t\t\t&& typeof c[i+1].args[0] ==\"string\"\r\n\t\t\t&& c[i+1].args[1]<=KEYPRESS_MAXIMUM_DELAY\r\n\t\t\t&& !eval(\"(\"+c[i].args[2]+\")\").ctrl\r\n\t\t\t&& !eval(\"(\"+c[i].args[2]+\")\").alt\r\n\t\t\t&& !eval(\"(\"+c[i+1].args[2]+\")\").ctrl\r\n\t\t\t&& !eval(\"(\"+c[i+1].args[2]+\")\").alt){\r\n\t\t\t// convert keyPress+keyPress+... to typeKeys\r\n\t\t\t// expected pattern:\r\n\t\t\t// \tc[i]: keyPress(a)\r\n\t\t\t// \tc[i+1]: keyPress(b)\r\n\t\t\t// \t...\r\n\t\t\t// \tc[i+n-1]: last keyPress(z)\r\n\t\t\t// \tc[i+n]: something else\r\n\t\t\t// result:\r\n\t\t\t//\tc[i]: typeKeys(ab...z)\r\n\t\t\t//\tc[i+1]: something else\r\n\t\t\t// note: does not convert alt or ctrl keypresses, and does not convert non-character keypresses like enter\r\n\t\t\tc[i].name = \"doh.robot.typeKeys\";\r\n\t\t\tc[i].args.splice(3,1);\r\n\t\t\tnext = c[i+1];\r\n\t\t\tvar typeTime = 0;\r\n\t\t\twhile(next\r\n\t\t\t\t&& next.name == \"doh.robot.keyPress\"\r\n\t\t\t\t&& typeof next.args[0] ==\"string\"\r\n\t\t\t\t&& next.args[1]<=KEYPRESS_MAXIMUM_DELAY\r\n\t\t\t\t&& !eval(\"(\"+next.args[2]+\")\").ctrl\r\n\t\t\t\t&& !eval(\"(\"+next.args[2]+\")\").alt){\r\n\t\t\t\tc.splice(i + 1,1);\r\n\t\t\t\tc[i].args[0] += next.args[0];\r\n\t\t\t\ttypeTime += next.args[1];\r\n\t\t\t\tnext = c[i+1];\r\n\t\t\t}\r\n\t\t\t// set the duration to the total type time\r\n\t\t\tc[i].args[2] = typeTime;\r\n\t\t\t// wrap string in quotes\r\n\t\t\tc[i].args[0] = \"'\"+c[i].args[0]+\"'\";\r\n\t\t}else if(c[i].name == \"doh.robot.keyPress\"){\r\n\t\t\t// take care of standalone keypresses\r\n\t\t\t// characters should be wrapped in quotes.\r\n\t\t\t// non-characters should be replaced with their corresponding dojo.keys constant\r\n\t\t\tif(typeof c[i].args[0] == \"string\"){\r\n\t\t\t\t// one keypress of a character by itself should be wrapped in quotes\r\n\t\t\t\tc[i].args[0] = \"'\"+c[i].args[0]+\"'\";\r\n\t\t\t}else{\r\n\t\t\t\tif(c[i].args[0]==0){\r\n\t\t\t\t\t// toss null keypresses\r\n\t\t\t\t\tc.splice(i,1);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// look up dojo.keys.constant if possible\r\n\t\t\t\t\tfor(var j in dojo.keys){\r\n\t\t\t\t\t\tif(dojo.keys[j] == c[i].args[0]){\r\n\t\t\t\t\t\t\tc[i].args[0] = \"dojo.keys.\"+j;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar toggle = function(){\r\n\t// summary:\r\n\t//\tToggles recording the user's input.\r\n\t//\tHotkey: CTRL- ALT-ENTER\r\n\t//\r\n\tif(!startTime){ start(); }\r\n\telse{ stop(); }\r\n}\r\n\r\nvar stop = function(){\r\n\t// summary:\r\n\t//\tStops recording the user's input,\r\n\t//\tand displays the generated code.\r\n\t//\r\n\r\n\tvar dt = Math.round((new Date()).getTime() - startTime.getTime());\r\n\tstartTime = null;\r\n\t_optimize();\r\n\tvar c = commands;\r\n\tconsole.log(\"Stop called. Commands: \" + c.length);\r\n\tif(c.length){\r\n\t\tvar s = \"doh.register('dojox.robot.AutoGeneratedTestGroup',{\\n\";\r\n\t\ts += \"     name: 'autotest\" + (testNumber++)+\"',\\n\";\r\n\t\ts += \"     timeout: \" + (dt+2000)+\",\\n\";\r\n\t\ts += \"     runTest: function(){\\n\";\r\n\t\ts += \"          var d = new doh.Deferred();\\n\";\r\n\t\tfor(var i = 0; i<c.length; i++){\r\n\t\t\ts += \"          \"+c[i].name+\"(\";\r\n\t\t\tfor(var j = 0; j<c[i].args.length; j++){\r\n\t\t\t\tvar arg = c[i].args[j];\r\n\t\t\t\ts += arg;\r\n\t\t\t\tif(j != c[i].args.length-1){ s += \", \"; }\r\n\t\t\t}\r\n\t\t\ts += \");\\n\";\r\n\t\t}\r\n\t\ts += \"          doh.robot.sequence(function(){\\n\";\r\n\t\ts += \"               if(/*Your condition here*/){\\n\";\r\n\t\ts += \"                    d.callback(true);\\n\";\r\n\t\ts += \"               }else{\\n\";\r\n\t\ts += \"                    d.errback(new Error('We got a failure'));\\n\";\r\n\t\ts += \"               }\\n\";\r\n\t\ts += \"          }, 1000);\\n\";\r\n\t\ts += \"          return d;\\n\";\r\n\t\ts += \"     }\\n\";\r\n\t\ts += \"});\\n\";\r\n\t\tvar div = document.createElement('div');\r\n\t\tdiv.id=\"dojox.robot.recorder\";\r\n\t\tdiv.style.backgroundColor = \"white\";\r\n\t\tdiv.style.position = \"absolute\";\r\n\t\tvar scroll = {y: (window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0),\r\n\t\tx: (window.pageXOffset || (window[\"dojo\"]?dojo._fixIeBiDiScrollLeft(document.documentElement.scrollLeft):undefined) || document.body.scrollLeft || 0)};\r\n\t\tdiv.style.left = scroll.x+\"px\";\r\n\t\tdiv.style.top = scroll.y+\"px\";\r\n\t\tvar h1 = document.createElement('h1');\r\n\t\th1.innerHTML = \"Your code:\";\r\n\t\tdiv.appendChild(h1);\r\n\t\tvar pre = document.createElement('pre');\r\n\t\tif(pre.innerText !== undefined){\r\n\t\t\tpre.innerText = s;\r\n\t\t}else{\r\n\t\t\tpre.textContent = s;\r\n\t\t}\r\n\t\tdiv.appendChild(pre);\r\n\t\tvar button = document.createElement('button');\r\n\t\tbutton.innerHTML = \"Close\";\r\n\t\tvar connect = dojo.connect(button,'onmouseup',function(e){\r\n\t\t\tdojo.stopEvent(e);\r\n\t\t\tdocument.body.removeChild(div);\r\n\t\t\tdojo.disconnect(connect);\r\n\t\t});\r\n\t\tdiv.appendChild(button);\r\n\t\tdocument.body.appendChild(div);\r\n\t\tcommands = [];\r\n\t}\r\n}\r\n\r\nvar getSelector = function(node){\r\n\t// Selenium/Windmill recorders have a concept of a \"selector.\"\r\n\t// The idea is that recorders need some reference to an element that persists even after a page refresh.\r\n\t// For elements with ids, this is easy; just use the id.\r\n\t// For other elements, we have to be more sly.\r\n\r\n\tif(typeof node ==\"string\"){\r\n\t\t// it's already an id to be interpreted by dojo.byId\r\n\t\treturn \"'\" + node+\"'\";\r\n\t}else if(node.id){\r\n\t\t// it has an id\r\n\t\treturn \"'\" + node.id+\"'\";\r\n\t}else{\r\n\t\t// TODO: need a generic selector, like CSS3/dojo.query, for the default return value\r\n\t\t// for now, just do getElementsByTagName\r\n\t\tvar nodes = document.getElementsByTagName(node.nodeName);\r\n\t\tvar i;\r\n\t\tfor(i = 0; i<nodes.length; i++){\r\n\t\t\tif(nodes[i] == node){\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// wrap in a function to defer evaluation\r\n\t\treturn \"function(){ return document.getElementsByTagName('\" + node.nodeName+\"')[\"+i+\"]; }\";\r\n\t}\r\n}\r\n\r\nvar getMouseButtonObject = function(b){\r\n\t// convert native event to doh.robot API\r\n\treturn \"{left:\" + (b==0)+\", middle:\" + (b==1)+\", right:\" + (b==2)+\"}\";\r\n}\r\n\r\n\r\nvar getModifierObject = function(e){\r\n\t// convert native event to doh.robot API\r\n\treturn \"{'shift':\" + (e.shiftKey)+\", 'ctrl':\" + (e.ctrlKey)+\", 'alt':\" + (e.altKey)+\"}\";\r\n}\r\n\r\n// dojo.connects\r\n\r\ndojo.connect(document,\"onkeydown\",function(e){\r\n\t// the CTRL- ALT-ENTER hotkey to activate the recorder\r\n\t//console.log(e.keyCode + \", \" + e.ctrlKey+\", \" + e.altKey);\r\n\tif((e.keyCode == dojo.keys.ENTER || e.keyCode==77) && e.ctrlKey && e.altKey){\r\n\t\tdojo.stopEvent(e);\r\n\t\ttoggle();\r\n\t}\r\n});\r\n\r\nvar lastEvent = {type:\"\"};\r\n\r\nvar onmousedown = function(e){\r\n\t// handler for mouse down\r\n\tif(!e || lastEvent.type==e.type && lastEvent.button==e.button){ return; }\r\n\tlastEvent={type:e.type, button:e.button};\r\n\tvar selector = getSelector(e.target);\r\n\tvar coords = dojo.coords(e.target);\r\n\taddCommand(\"doh.robot.mouseMoveAt\",[selector, 0, 100, e.clientX - coords.x, e.clientY-coords.y]);\r\n\taddCommand(\"doh.robot.mousePress\",[getMouseButtonObject(e.button-(dojo.isIE?1:0)), 0]);\r\n};\r\n\r\nvar onclick = function(e){\r\n\t// handler for mouse up\r\n\tif(!e || lastEvent.type==e.type && lastEvent.button==e.button){ return; }\r\n\tlastEvent={type:e.type, button:e.button};\r\n\tvar selector = getSelector(e.target);\r\n\tvar coords = dojo.coords(e.target);\r\n\taddCommand(\"doh.robot.mouseClick\",[getMouseButtonObject(e.button-(dojo.isIE?1:0)), 0]);\r\n};\r\n\r\nvar onmouseup = function(e){\r\n\t// handler for mouse up\r\n\tif(!e || lastEvent.type==e.type && lastEvent.button==e.button){ return; }\r\n\tlastEvent={type:e.type, button:e.button};\r\n\tvar selector = getSelector(e.target);\r\n\tvar coords = dojo.coords(e.target);\r\n\taddCommand(\"doh.robot.mouseRelease\",[getMouseButtonObject(e.button-(dojo.isIE?1:0)), 0]);\r\n};\r\n\r\nvar onmousemove = function(e){\r\n\t// handler for mouse move\r\n\tif(!e || lastEvent.type==e.type && lastEvent.pageX==e.pageX && lastEvent.pageY==e.pageY){ return; }\r\n\tlastEvent={type:e.type, pageX:e.pageX, pageY:e.pageY};\r\n\taddCommand(\"doh.robot.mouseMove\",[e.pageX, e.pageY, 0, 100, true]);\r\n};\r\n\r\nvar onmousewheel = function(e){\r\n\t// handler for mouse move\r\n\tif(!e || lastEvent.type==e.type && lastEvent.pageX==e.pageX && lastEvent.pageY==e.pageY){ return; }\r\n\tlastEvent={type:e.type, detail:(e.detail ? (e.detail) : (-e.wheelDelta / 120))};\r\n\taddCommand(\"doh.robot.mouseWheel\",[lastEvent.detail]);\r\n};\r\n\r\nvar onkeypress = function(e){\r\n\t// handler for key press\r\n\tif(!e || lastEvent.type==e.type && (lastEvent.charCode == e.charCode && lastEvent.keyCode == e.keyCode)){ return; }\r\n\tlastEvent={type:e.type, charCode:e.charCode, keyCode:e.keyCode};\r\n\taddCommand(\"doh.robot.keyPress\",[e.charOrCode==dojo.keys.SPACE?' ':e.charOrCode, 0, getModifierObject(e)]);\r\n};\r\n\r\nvar onkeyup = function(e){\r\n\tif(!e || lastEvent.type==e.type && (lastEvent.charCode == e.charCode && lastEvent.keyCode == e.keyCode)){ return; }\r\n\tlastEvent={type:e.type, charCode:e.charCode, keyCode:e.keyCode};\r\n}\r\n\r\n// trap all native elements' events\r\ndojo.connect(document,\"onmousedown\",onmousedown);\r\ndojo.connect(document,\"onmouseup\",onmouseup);\r\ndojo.connect(document,\"onclick\",onclick);\r\ndojo.connect(document,\"onkeypress\",onkeypress);\r\ndojo.connect(document,\"onkeyup\",onkeyup);\r\ndojo.connect(document,\"onmousemove\",onmousemove);\r\ndojo.connect(document,!dojo.isMozilla ? \"onmousewheel\" : 'DOMMouseScroll',onmousewheel);\r\n\r\ndojo.addOnLoad(function(){\r\n\t// get scrollIntoView for good measure\r\n\t// catch: dojo.window might not be loaded (yet?) so addonload\r\n\tif(dojo.window){\r\n\t\tdojo.connect(dojo.window,\"scrollIntoView\",function(node){\r\n\t\t\taddCommand(\"doh.robot.scrollIntoView\",[getSelector(node)]);\r\n\t\t});\r\n\t}\r\n});\r\n\r\n// Get Dojo widget events too!\r\ndojo.connect(dojo, \"connect\",\r\n\tfunction(/*dijit._Widget*/ widget, /*String*/ event, /*Function*/ f){\r\n\t\t// kill recursion\r\n\t\t// check for private variable _mine to make sure this isn't a recursive loop\r\n\t\tif(widget && (!f || !f._mine)){\r\n\t\t\tvar hitchedf = null;\r\n\t\t\tif(event.toLowerCase() == \"onmousedown\"){\r\n\t\t\t\thitchedf = dojo.hitch(this,onmousedown);\r\n\t\t\t}else if(event.toLowerCase() == (!dojo.isMozilla ? \"onmousewheel\" : 'dommousescroll')){\r\n\t\t\t\thitchedf = dojo.hitch(this,onmousewheel);\r\n\t\t\t}else if(event.toLowerCase() == \"onclick\"){\r\n\t\t\t\thitchedf = dojo.hitch(this,onclick);\r\n\t\t\t}else if(event.toLowerCase() == \"onmouseup\"){\r\n\t\t\t\thitchedf = dojo.hitch(this,onmouseup);\r\n\t\t\t}else if(event.toLowerCase() == \"onkeypress\"){\r\n\t\t\t\thitchedf = dojo.hitch(this,onkeypress);\r\n\t\t\t}else if(event.toLowerCase() == \"onkeyup\"){\r\n\t\t\t\thitchedf = dojo.hitch(this,onkeyup);\r\n\t\t\t}\r\n\t\t\tif(hitchedf == null){ return; }\r\n\t\t\thitchedf._mine = true;\r\n\t\t\tdojo.connect(widget,event,hitchedf);\r\n\t\t}\r\n\t});\r\n})();\r\n"]}