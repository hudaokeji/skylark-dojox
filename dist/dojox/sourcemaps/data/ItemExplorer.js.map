{"version":3,"sources":["data/ItemExplorer.js"],"names":["dojo","provide","require","getValue","store","item","prop","value","getValues","length","declare","dijit","Tree","useSelect","refSelectSearchAttr","constructor","options","mixin","this","self","initialRootValue","root","rootModelNode","id","_modelNodeIdMap","_modelNodePropMap","nextId","model","getRoot","onItem","mayHaveChildren","modelNode","Date","getChildren","parentModelNode","onComplete","onError","keys","parent","children","isItem","isItemLoaded","loadItem","loadedItem","enumerate","getAttributes","i","hasOwnProperty","push","key","k","property","addNew","parentNode","getIdentity","identity","getLabel","Array","onChildrenChange","onChange","postCreate","inherited","arguments","connect","treeNode","lastFocused","_addProperty","_editProperty","contextMenu","Menu","targetNodeIds","rootNode","domNode","e","node","getEnclosingWidget","target","forEach","widget","attr","label","indexOf","getIdentityAttributes","focusNode","alert","addChild","MenuItem","onClick","hitch","startup","setStore","_editDialog","destroyRecursive","attribute","oldValue","newValue","nodes","undefined","setChildItems","setItem","refreshItem","_createEditDialog","Dialog","title","execute","preload","placeAt","body","pane","doc","createElement","labelProp","style","appendChild","form","ValidationTextBox","name","required","disabled","RadioButton","_enableFields","labelVal","valueDiv","addClass","Textarea","labelRef","refDiv","FilteringSelect","searchAttr","pageSize","promptMessage","isValid","isFocused","buttons","document","setAttribute","Button","type","selection","query","containerNode","_updateItem","vals","val","storeItemVal","editingItem","editDialog","setValue","itemVal","propPath","getParent","concat","pop","validate","itemType","fetchItemByIdentity","_reference","jsonVal","fromJson","toString","show","reset","toJson","_destroyProperty","isArray","splice","unsetAttribute","showDialog"],"mappings":"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","file":"../../data/ItemExplorer.js","sourcesContent":["dojo.provide(\"dojox.data.ItemExplorer\");\r\ndojo.require(\"dijit.Tree\");\r\ndojo.require(\"dijit.Dialog\");\r\ndojo.require(\"dijit.Menu\");\r\ndojo.require(\"dijit.form.ValidationTextBox\");\r\ndojo.require(\"dijit.form.Textarea\");\r\ndojo.require(\"dijit.form.Button\");\r\ndojo.require(\"dijit.form.RadioButton\");\r\ndojo.require(\"dijit.form.FilteringSelect\");\r\n\r\n(function(){\r\n\tvar getValue = function(store, item, prop){\r\n\t\tvar value = store.getValues(item, prop);\r\n\t\tif(value.length < 2){\r\n\t\t\tvalue = store.getValue(item, prop);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\ndojo.declare(\"dojox.data.ItemExplorer\", dijit.Tree, {\r\n\tuseSelect: false,\r\n\trefSelectSearchAttr: null,\r\n\tconstructor: function(options){\r\n\t\tdojo.mixin(this, options);\r\n\t\tvar self = this;\r\n\t\tvar initialRootValue = {};\r\n\t\tvar root = (this.rootModelNode = {value:initialRootValue,id:\"root\"});\r\n\r\n\t\tthis._modelNodeIdMap = {};\r\n\t\tthis._modelNodePropMap = {};\r\n\t\tvar nextId = 1;\r\n\t\tthis.model = {\r\n\t\t\tgetRoot: function(onItem){\r\n\t\t\t\tonItem(root);\r\n\t\t\t},\r\n\t\t\tmayHaveChildren: function(modelNode){\r\n\t\t\t\treturn modelNode.value && typeof modelNode.value == 'object' && !(modelNode.value instanceof Date);\r\n\t\t\t},\r\n\t\t\tgetChildren: function(parentModelNode, onComplete, onError){\r\n\t\t\t\tvar keys, parent, item = parentModelNode.value;\r\n\t\t\t\tvar children = [];\r\n\t\t\t\tif(item == initialRootValue){\r\n\t\t\t\t\tonComplete([]);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar isItem = self.store && self.store.isItem(item, true);\r\n\t\t\t\tif(isItem && !self.store.isItemLoaded(item)){\r\n\t\t\t\t\t// if it is not loaded, do so now.\r\n\t\t\t\t\tself.store.loadItem({\r\n\t\t\t\t\t\titem:item,\r\n\t\t\t\t\t\tonItem:function(loadedItem){\r\n\t\t\t\t\t\t\titem = loadedItem;\r\n\t\t\t\t\t\t\tenumerate();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tenumerate();\r\n\t\t\t\t}\r\n\t\t\t\tfunction enumerate(){\r\n\t\t\t\t\t// once loaded, enumerate the keys\r\n\t\t\t\t\tif(isItem){\r\n\t\t\t\t\t\t// get the properties through the dojo data API\r\n\t\t\t\t\t\tkeys = self.store.getAttributes(item);\r\n\t\t\t\t\t\tparent = item;\r\n\t\t\t\t\t}else if(item && typeof item == 'object'){\r\n\t\t\t\t\t\tparent = parentModelNode.value;\r\n\t\t\t\t\t\tkeys = [];\r\n\t\t\t\t\t\t// also we want to be able to drill down into plain JS objects/arrays\r\n\t\t\t\t\t\tfor(var i in item){\r\n\t\t\t\t\t\t\tif(item.hasOwnProperty(i) && i != '__id' && i != '__clientId'){\r\n\t\t\t\t\t\t\t\tkeys.push(i);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(keys){\r\n\t\t\t\t\t\tfor(var key, k=0; key = keys[k++];){\r\n\t\t\t\t\t\t\tchildren.push({\r\n\t\t\t\t\t\t\t\tproperty:key,\r\n\t\t\t\t\t\t\t\tvalue: isItem ? getValue(self.store, item, key) : item[key],\r\n\t\t\t\t\t\t\t\tparent:\tparent});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tchildren.push({addNew:true, parent: parent, parentNode : parentModelNode});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonComplete(children);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tgetIdentity: function(modelNode){\r\n\t\t\t\tif(!modelNode.id){\r\n\t\t\t\t\tif(modelNode.addNew){\r\n\t\t\t\t\t\tmodelNode.property = \"--addNew\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmodelNode.id = nextId++;\r\n\t\t\t\t\tif(self.store){\r\n\t\t\t\t\t\tif(self.store.isItem(modelNode.value)){\r\n\t\t\t\t\t\t\tvar identity = self.store.getIdentity(modelNode.value);\r\n\t\t\t\t\t\t\t(self._modelNodeIdMap[identity] = self._modelNodeIdMap[identity] || []).push(modelNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(modelNode.parent){\r\n\t\t\t\t\t\t\tidentity = self.store.getIdentity(modelNode.parent) + '.' + modelNode.property;\r\n\t\t\t\t\t\t\t(self._modelNodePropMap[identity] = self._modelNodePropMap[identity] || []).push(modelNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn modelNode.id;\r\n\t\t\t},\r\n\t\t\tgetLabel: function(modelNode){\r\n\t\t\t\treturn modelNode === root ?\r\n\t\t\t\t\t\t\"Object Properties\" :\r\n\t\t\t\t\t\t\tmodelNode.addNew ? (modelNode.parent instanceof Array ? \"Add new value\" : \"Add new property\") :\r\n\t\t\t\t\t\t\t\tmodelNode.property + \": \" +\r\n\t\t\t\t\t\t\t\t\t(modelNode.value instanceof Array ? \"(\" + modelNode.value.length + \" elements)\" : modelNode.value);\r\n\t\t\t},\r\n\t\t\tonChildrenChange: function(modelNode){\r\n\t\t\t},\r\n\t\t\tonChange: function(modelNode){\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tpostCreate: function(){\r\n\t\tthis.inherited(arguments);\r\n\t\t// handle the clicking on the \"add new property item\"\r\n\t\tdojo.connect(this, \"onClick\", function(modelNode, treeNode){\r\n\t\t\tthis.lastFocused = treeNode;\r\n\t\t\tif(modelNode.addNew){\r\n\t\t\t\t//this.focusNode(treeNode.getParent());\r\n\t\t\t\tthis._addProperty();\r\n\t\t\t}else{\r\n\t\t\t\tthis._editProperty();\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar contextMenu = new dijit.Menu({\r\n\t\t\ttargetNodeIds: [this.rootNode.domNode],\r\n\t\t\tid: \"contextMenu\"\r\n\t\t\t});\r\n\t\tdojo.connect(contextMenu, \"_openMyself\", this, function(e){\r\n\t\t\tvar node = dijit.getEnclosingWidget(e.target);\r\n\t\t\tif(node){\r\n\t\t\t\tvar item = node.item;\r\n\t\t\t\tif(this.store.isItem(item.value, true) && !item.parent){\r\n\t\t\t\t\tdojo.forEach(contextMenu.getChildren(), function(widget){\r\n\t\t\t\t\t\twidget.attr(\"disabled\", (widget.label != \"Add\"));\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.lastFocused = node;\r\n\t\t\t\t\t// TODO: Root Node - allow Edit when mutli-value editing is possible\r\n\t\t\t\t}else if(item.value && typeof item.value == 'object' && !(item.value instanceof Date)){\r\n\t\t\t\t\t// an object that's not a Date - could be a store item\r\n\t\t\t\t\tdojo.forEach(contextMenu.getChildren(), function(widget){\r\n\t\t\t\t\t\twidget.attr(\"disabled\", (widget.label != \"Add\") && (widget.label != \"Delete\"));\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.lastFocused = node;\r\n\t\t\t\t\t// TODO: Object - allow Edit when mutli-value editing is possible\r\n\t\t\t\t}else if(item.property && dojo.indexOf(this.store.getIdentityAttributes(), item.property) >= 0){ // id node\r\n\t\t\t\t\tthis.focusNode(node);\r\n\t\t\t\t\talert(\"Cannot modify an Identifier node.\");\r\n\t\t\t\t}else if(item.addNew){\r\n\t\t\t\t\tthis.focusNode(node);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdojo.forEach(contextMenu.getChildren(), function(widget){\r\n\t\t\t\t\t\twidget.attr(\"disabled\", (widget.label != \"Edit\") && (widget.label != \"Delete\"));\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// this won't focus the node but gives us a way to reference the node\r\n\t\t\t\t\tthis.lastFocused = node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tcontextMenu.addChild(new dijit.MenuItem({label: \"Add\", onClick: dojo.hitch(this, \"_addProperty\")}));\r\n\t\tcontextMenu.addChild(new dijit.MenuItem({label: \"Edit\", onClick: dojo.hitch(this, \"_editProperty\")}));\r\n\t\tcontextMenu.addChild(new dijit.MenuItem({label: \"Delete\", onClick: dojo.hitch(this, \"_destroyProperty\")}));\r\n\t\tcontextMenu.startup();\r\n\t},\r\n\tstore: null,\r\n\tsetStore: function(store){\r\n\t\tthis.store = store;\r\n\t\tvar self = this;\r\n\t\tif(this._editDialog){\r\n\t\t\tthis._editDialog.destroyRecursive();\r\n\t\t\tdelete this._editDialog;\r\n\t\t}\r\n\t\t// i think we should just destroy this._editDialog and let _createEditDialog take care of everything\r\n\t\t// once it gets called again by either _editProperty or _addProperty - it will create everything again\r\n\t\t// using the new store.\tthis way we don't need to keep track of what is in the dialog if we change it.\r\n\t\t/*if(this._editDialog && this.useSelect){\r\n\t\t\tdojo.query(\".reference [widgetId]\", this._editDialog.containerNode).forEach(function(node){\r\n\t\t\t\tdijit.getEnclosingWidget(node).attr(\"store\", store);\r\n\t\t\t});\r\n\t\t}*/\r\n\t\tdojo.connect(store, \"onSet\", function(item, attribute, oldValue, newValue){\r\n\t\t\tvar nodes, i, identity = self.store.getIdentity(item);\r\n\t\t\tnodes = self._modelNodeIdMap[identity];\r\n\r\n\t\t\tif(nodes &&\r\n\t\t\t\t\t(oldValue === undefined || newValue === undefined ||\r\n\t\t\t\t\toldValue instanceof Array || newValue instanceof Array || typeof oldValue == 'object' || typeof newValue == 'object')){\r\n\t\t\t\tfor(i = 0; i < nodes.length; i++){\r\n\t\t\t\t\t(function(node){\r\n\t\t\t\t\t\tself.model.getChildren(node, function(children){\r\n\t\t\t\t\t\t\tself.model.onChildrenChange(node, children);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})(nodes[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tnodes = self._modelNodePropMap[identity + \".\" + attribute];\r\n\r\n\t\t\tif(nodes){\r\n\t\t\t\tfor(i = 0; i < nodes.length; i++){\r\n\t\t\t\t\tnodes[i].value = newValue;\r\n\t\t\t\t\tself.model.onChange(nodes[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.rootNode.setChildItems([]);\r\n\t},\r\n\tsetItem: function(item){\r\n\t\t// this is called to show a different item\r\n\r\n\t\t// reset the maps, for the root getIdentity is not called, so we pre-initialize it here\r\n\t\t(this._modelNodeIdMap = {})[this.store.getIdentity(item)] = [this.rootModelNode];\r\n\t\tthis._modelNodePropMap = {};\r\n\r\n\t\tthis.rootModelNode.value = item;\r\n\t\tvar self = this;\r\n\t\tthis.model.getChildren(this.rootModelNode, function(children){\r\n\t\t\tself.rootNode.setChildItems(children);\r\n\t\t});\r\n\r\n\t},\r\n\trefreshItem: function(){\r\n\t\tthis.setItem(this.rootModelNode.value);\r\n\t},\r\n\t_createEditDialog: function(){\r\n\t\tthis._editDialog = new dijit.Dialog({\r\n\t\t\ttitle: \"Edit Property\",\r\n\t\t\texecute: dojo.hitch(this, \"_updateItem\"),\r\n\t\t\tpreload: true\r\n\t\t});\r\n\t\tthis._editDialog.placeAt(dojo.body());\r\n\t\tthis._editDialog.startup();\r\n\r\n\t\t// handle for dialog content\r\n\t\tvar pane = dojo.doc.createElement('div');\r\n\r\n\t\t// label for property\r\n\t\tvar labelProp = dojo.doc.createElement('label');\r\n\t\tdojo.attr(labelProp, \"for\", \"property\");\r\n\t\tdojo.style(labelProp, \"fontWeight\", \"bold\");\r\n\t\tdojo.attr(labelProp, \"innerHTML\", \"Property:\")\r\n\t\tpane.appendChild(labelProp);\r\n\r\n\t\t// property name field\r\n\t\tvar propName = new dijit.form.ValidationTextBox({\r\n\t\t\tname: \"property\",\r\n\t\t\tvalue: \"\",\r\n\t\t\trequired: true,\r\n\t\t\tdisabled: true\r\n\t\t}).placeAt(pane);\r\n\r\n\t\tpane.appendChild(dojo.doc.createElement(\"br\"));\r\n\t\tpane.appendChild(dojo.doc.createElement(\"br\"));\r\n\r\n\t\t// radio button for \"value\"\r\n\t\tvar value = new dijit.form.RadioButton({\r\n\t\t\tname: \"itemType\",\r\n\t\t\tvalue: \"value\",\r\n\t\t\tonClick: dojo.hitch(this, function(){this._enableFields(\"value\");})\r\n\t\t}).placeAt(pane);\r\n\r\n\t\t// label for value\r\n\t\tvar labelVal = dojo.doc.createElement('label');\r\n\t\tdojo.attr(labelVal, \"for\", \"value\");\r\n\t\tdojo.attr(labelVal, \"innerHTML\", \"Value (JSON):\")\r\n\t\tpane.appendChild(labelVal);\r\n\r\n\t\t// container for value fields\r\n\t\tvar valueDiv = dojo.doc.createElement(\"div\");\r\n\t\tdojo.addClass(valueDiv, \"value\");\r\n\r\n\t\t// textarea\r\n\t\tvar textarea = new dijit.form.Textarea({\r\n\t\t\tname: \"jsonVal\"\r\n\t\t}).placeAt(valueDiv);\r\n\t\tpane.appendChild(valueDiv);\r\n\r\n\t\t// radio button for \"reference\"\r\n\t\tvar reference = new dijit.form.RadioButton({\r\n\t\t\tname: \"itemType\",\r\n\t\t\tvalue: \"reference\",\r\n\t\t\tonClick: dojo.hitch(this, function(){this._enableFields(\"reference\");})\r\n\t\t}).placeAt(pane);\r\n\r\n\t\t// label for reference\r\n\t\tvar labelRef = dojo.doc.createElement('label');\r\n\t\tdojo.attr(labelRef, \"for\", \"_reference\");\r\n\t\tdojo.attr(labelRef, \"innerHTML\", \"Reference (ID):\")\r\n\t\tpane.appendChild(labelRef);\r\n\t\tpane.appendChild(dojo.doc.createElement(\"br\"));\r\n\r\n\t\t// container for reference fields\r\n\t\tvar refDiv = dojo.doc.createElement(\"div\");\r\n\t\tdojo.addClass(refDiv, \"reference\");\r\n\r\n\t\tif(this.useSelect){\r\n\t\t\t// filteringselect\r\n\t\t\t// TODO: see if there is a way to sort the items in this list\r\n\t\t\tvar refSelect = new dijit.form.FilteringSelect({\r\n\t\t\t\tname: \"_reference\",\r\n\t\t\t\tstore: this.store,\r\n\t\t\t\tsearchAttr: this.refSelectSearchAttr || this.store.getIdentityAttributes()[0],\r\n\t\t\t\trequired: false,\r\n\t\t\t\tvalue: null,\t\t// need to file a ticket about the fetch that happens when declared with value: null\r\n\t\t\t\tpageSize: 10\r\n\t\t\t}).placeAt(refDiv);\r\n\t\t}else{\r\n\t\t\tvar refTextbox = new dijit.form.ValidationTextBox({\r\n\t\t\t\tname: \"_reference\",\r\n\t\t\t\tvalue: \"\",\r\n\t\t\t\tpromptMessage: \"Enter the ID of the item to reference\",\r\n\t\t\t\tisValid: dojo.hitch(this, function(isFocused){\r\n\t\t\t\t\t// don't validate while it's focused\r\n\t\t\t\t\treturn true;//isFocused || this.store.getItemByIdentity(this._editDialog.attr(\"value\")._reference);\r\n\t\t\t\t})\r\n\t\t\t}).placeAt(refDiv);\r\n\t\t}\r\n\t\tpane.appendChild(refDiv);\r\n\t\tpane.appendChild(dojo.doc.createElement(\"br\"));\r\n\t\tpane.appendChild(dojo.doc.createElement(\"br\"));\r\n\r\n\t\t// buttons\r\n\t\tvar buttons = document.createElement('div');\r\n\t\tbuttons.setAttribute(\"dir\", \"rtl\");\r\n\t\tvar cancelButton = new dijit.form.Button({type: \"reset\", label: \"Cancel\"}).placeAt(buttons);\r\n\t\tcancelButton.onClick = dojo.hitch(this._editDialog, \"onCancel\");\r\n\t\tvar okButton = new dijit.form.Button({type: \"submit\", label: \"OK\"}).placeAt(buttons);\r\n\t\tpane.appendChild(buttons);\r\n\r\n\t\tthis._editDialog.attr(\"content\", pane);\r\n\t},\r\n\t_enableFields: function(selection){\r\n\t\t// enables/disables fields based on whether the value in this._editDialog is a reference or a primitive value\r\n\t\tswitch(selection){\r\n\t\t\tcase \"reference\":\r\n\t\t\t\tdojo.query(\".value [widgetId]\", this._editDialog.containerNode).forEach(function(node){\r\n\t\t\t\t\tdijit.getEnclosingWidget(node).attr(\"disabled\", true);\r\n\t\t\t\t});\r\n\t\t\t\tdojo.query(\".reference [widgetId]\", this._editDialog.containerNode).forEach(function(node){\r\n\t\t\t\t\tdijit.getEnclosingWidget(node).attr(\"disabled\", false);\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"value\":\r\n\t\t\t\tdojo.query(\".value [widgetId]\", this._editDialog.containerNode).forEach(function(node){\r\n\t\t\t\t\tdijit.getEnclosingWidget(node).attr(\"disabled\", false);\r\n\t\t\t\t});\r\n\t\t\t\tdojo.query(\".reference [widgetId]\", this._editDialog.containerNode).forEach(function(node){\r\n\t\t\t\t\tdijit.getEnclosingWidget(node).attr(\"disabled\", true);\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\t_updateItem: function(vals){\r\n\t\t// a single \"execute\" function that handles adding and editing of values and references.\r\n\t\tvar node, item, val, storeItemVal, editingItem = this._editDialog.attr(\"title\") == \"Edit Property\";\r\n\t\tvar editDialog = this._editDialog;\r\n\t\tvar store = this.store;\r\n\t\tfunction setValue(){\r\n\t\t\ttry{\r\n\t\t\t\tvar itemVal, propPath = [];\r\n\t\t\t\tvar prop = vals.property;\r\n\t\t\t\tif(editingItem){\r\n\t\t\t\t\twhile(!store.isItem(item.parent, true)){\r\n\t\t\t\t\t\tnode = node.getParent();\r\n\t\t\t\t\t\tpropPath.push(item.property);\r\n\t\t\t\t\t\titem = node.item;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(propPath.length == 0){\r\n\t\t\t\t\t\t// working with an item attribute already\r\n\t\t\t\t\t\tstore.setValue(item.parent, item.property, val);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t// need to walk back down the item property to the object\r\n\t\t\t\t\t\tstoreItemVal = getValue(store, item.parent, item.property);\r\n\t\t\t\t\t\tif(storeItemVal instanceof Array){\r\n\t\t\t\t\t\t\t// create a copy for modification\r\n\t\t\t\t\t\t\tstoreItemVal = storeItemVal.concat();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titemVal = storeItemVal;\r\n\t\t\t\t\t\twhile(propPath.length > 1){\r\n\t\t\t\t\t\t\titemVal = itemVal[propPath.pop()];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titemVal[propPath] = val; // this change is reflected in storeItemVal as well\r\n\t\t\t\t\t\tstore.setValue(item.parent, item.property, storeItemVal);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// adding a property\r\n\t\t\t\t\tif(store.isItem(value, true)){\r\n\t\t\t\t\t\t// adding a top-level property to an item\r\n\t\t\t\t\t\tif(!store.isItemLoaded(value)){\r\n\t\t\t\t\t\t\t// fetch the value and see if it is an array\r\n\t\t\t\t\t\t\tstore.loadItem({\r\n\t\t\t\t\t\t\t\titem: value,\r\n\t\t\t\t\t\t\t\tonItem: function(loadedItem){\r\n\t\t\t\t\t\t\t\t\tif(loadedItem instanceof Array){\r\n\t\t\t\t\t\t\t\t\t\tprop = loadedItem.length;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tstore.setValue(loadedItem, prop, val);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tif(value instanceof Array){\r\n\t\t\t\t\t\t\t\tprop = value.length;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tstore.setValue(value, prop, val);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t// adding a property to a lower level in an item\r\n\t\t\t\t\t\tif(item.value instanceof Array){\r\n\t\t\t\t\t\t\tpropPath.push(item.value.length);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tpropPath.push(vals.property);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\twhile(!store.isItem(item.parent, true)){\r\n\t\t\t\t\t\t\tnode = node.getParent();\r\n\t\t\t\t\t\t\tpropPath.push(item.property);\r\n\t\t\t\t\t\t\titem = node.item;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tstoreItemVal = getValue(store, item.parent, item.property);\r\n\t\t\t\t\t\titemVal = storeItemVal;\r\n\t\t\t\t\t\twhile(propPath.length > 1){\r\n\t\t\t\t\t\t\titemVal = itemVal[propPath.pop()];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titemVal[propPath] = val;\r\n\t\t\t\t\t\tstore.setValue(item.parent, item.property, storeItemVal);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}catch(e){\r\n\t\t\t\talert(e);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(editDialog.validate()){\r\n\t\t\tnode = this.lastFocused;\r\n\t\t\titem = node.item;\r\n\t\t\tvar value = item.value;\r\n\t\t\t// var property = null;\r\n\t\t\tif(item.addNew){\r\n\t\t\t\t// we are adding a property to the parent item\r\n\t\t\t\t// the real value of the parent is in the parent property of the lastFocused item\r\n\t\t\t\t// this.lastFocused.getParent().item.value may be a reference to an item\r\n\t\t\t\tvalue = node.item.parent;\r\n\t\t\t\tnode = node.getParent();\r\n\t\t\t\titem = node.item;\r\n\t\t\t}\r\n\t\t\tval = null;\r\n\t\t\tswitch(vals.itemType){\r\n\t\t\t\tcase \"reference\":\r\n\t\t\t\t\tthis.store.fetchItemByIdentity({identity:vals._reference,\r\n\t\t\t\t\t\tonItem:function(item){\r\n\t\t\t\t\t\t\tval = item;\r\n\t\t\t\t\t\t\tsetValue();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonError:function(){\r\n\t\t\t\t\t\t\talert(\"The id could not be found\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"value\":\r\n\t\t\t\t\tvar jsonVal = vals.jsonVal;\r\n\t\t\t\t\tval = dojo.fromJson(jsonVal);\r\n\t\t\t\t\t// ifit is a function we want to preserve the source (comments, et al)\r\n\t\t\t\t\tif(typeof val == 'function'){\r\n\t\t\t\t\t\tval.toString = function(){\r\n\t\t\t\t\t\t\treturn jsonVal;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsetValue();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\t// the form didn't validate - show it again.\r\n\t\t\teditDialog.show();\r\n\t\t}\r\n\t},\r\n\t_editProperty: function(){\r\n\t\t// this mixin stops us polluting the tree item with jsonVal etc.\r\n\t\t// FIXME: if a store identifies items by instanceof checks, this will fail\r\n\t\tvar item = dojo.mixin({}, this.lastFocused.item);\r\n\t\t// create the dialog or reset it if it already exists\r\n\t\tif(!this._editDialog){\r\n\t\t\tthis._createEditDialog();\r\n\t\t}else{\r\n\t\t\tthis._editDialog.reset();\r\n\t\t}\r\n\t\t// not allowed to edit an item's id - so check for that and stop it.\r\n\t\tif(dojo.indexOf(this.store.getIdentityAttributes(), item.property) >= 0){\r\n\t\t\talert(\"Cannot Edit an Identifier!\");\r\n\t\t}else{\r\n\t\t\tthis._editDialog.attr(\"title\", \"Edit Property\");\r\n\t\t\t// make sure the property input is disabled\r\n\t\t\tdijit.getEnclosingWidget(dojo.query(\"input\", this._editDialog.containerNode)[0]).attr(\"disabled\", true);\r\n\t\t\tif(this.store.isItem(item.value, true)){\r\n\t\t\t\t// root node || Item reference\r\n\t\t\t\tif(item.parent){\r\n\t\t\t\t\t// Item reference\r\n\t\t\t\t\titem.itemType = \"reference\";\r\n\t\t\t\t\tthis._enableFields(item.itemType);\r\n\t\t\t\t\titem._reference = this.store.getIdentity(item.value);\r\n\t\t\t\t\tthis._editDialog.attr(\"value\", item);\r\n\t\t\t\t\tthis._editDialog.show();\r\n\t\t\t\t} // else root node\r\n\t\t\t}else{\r\n\t\t\t\tif(item.value && typeof item.value == 'object' && !(item.value instanceof Date)){\r\n\t\t\t\t\t// item.value is an object but it's NOT an item from the store - no-op\r\n\t\t\t\t\t// only allow editing on a property not on the node that represents the object/array\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// this is a primitive\r\n\t\t\t\t\titem.itemType = \"value\";\r\n\t\t\t\t\tthis._enableFields(item.itemType);\r\n\t\t\t\t\titem.jsonVal = typeof item.value == 'function' ?\r\n\t\t\t\t\t\t\t// use the plain toString for functions, dojo.toJson doesn't support functions\r\n\t\t\t\t\t\t\titem.value.toString() :\r\n\t\t\t\t\t\t\t\titem.value instanceof Date ?\r\n\t\t\t\t\t\t\t\t\t// A json-ish form of a date:\r\n\t\t\t\t\t\t\t\t\t'new Date(\"' + item.value + '\")' :\r\n\t\t\t\t\t\t\t\t\tdojo.toJson(item.value);\r\n\t\t\t\t\tthis._editDialog.attr(\"value\", item);\r\n\t\t\t\t\tthis._editDialog.show();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_destroyProperty: function(){\r\n\t\tvar node = this.lastFocused;\r\n\t\tvar item = node.item;\r\n\t\tvar propPath = [];\r\n\t\t// we have to walk up the tree to the item before we can know if we're working with the identifier\r\n\t\twhile(!this.store.isItem(item.parent, true) || item.parent instanceof Array){\r\n\t\t\tnode = node.getParent();\r\n\t\t\tpropPath.push(item.property);\r\n\t\t\titem = node.item;\r\n\t\t}\r\n\t\t// this will prevent any part of the identifier from being changed\r\n\t\tif(dojo.indexOf(this.store.getIdentityAttributes(), item.property) >= 0){\r\n\t\t\talert(\"Cannot Delete an Identifier!\");\r\n\t\t}else{\r\n\t\t\ttry{\r\n\t\t\t\tif(propPath.length > 0){\r\n\t\t\t\t\t// not deleting a top-level property of an item so get the top-level store item to change\r\n\t\t\t\t\tvar itemVal, storeItemVal = getValue(this.store, item.parent, item.property);\r\n\t\t\t\t\titemVal = storeItemVal;\r\n\t\t\t\t\t// walk back down the object if needed\r\n\t\t\t\t\twhile(propPath.length > 1){\r\n\t\t\t\t\t\titemVal = itemVal[propPath.pop()];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// delete the property\r\n\t\t\t\t\tif(dojo.isArray(itemVal)){\r\n\t\t\t\t\t\t// the value being deleted represents an array element\r\n\t\t\t\t\t\titemVal.splice(propPath, 1);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t// object property\r\n\t\t\t\t\t\tdelete itemVal[propPath];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// save it back to the store\r\n\t\t\t\t\tthis.store.setValue(item.parent, item.property, storeItemVal);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// deleting an item property\r\n\t\t\t\t\tthis.store.unsetAttribute(item.parent, item.property);\r\n\t\t\t\t}\r\n\t\t\t}catch(e){\r\n\t\t\t\talert(e);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_addProperty: function(){\r\n\t\t// item is what we are adding a property to\r\n\t\tvar item = this.lastFocused.item;\r\n\t\t// value is the real value of the item - not a reference to a store item\r\n\t\tvar value = item.value;\r\n\t\tvar showDialog = dojo.hitch(this, function(){\r\n\t\t\tvar property = null;\r\n\t\t\tif(!this._editDialog){\r\n\t\t\t\tthis._createEditDialog();\r\n\t\t\t}else{\r\n\t\t\t\tthis._editDialog.reset();\r\n\t\t\t}\r\n\t\t\t// are we adding another item to an array?\r\n\t\t\tif(value instanceof Array){\r\n\t\t\t\t// preset the property to the next index in the array and disable the property field\r\n\t\t\t\tproperty = value.length;\r\n\t\t\t\tdijit.getEnclosingWidget(dojo.query(\"input\", this._editDialog.containerNode)[0]).attr(\"disabled\", true);\r\n\t\t\t}else{\r\n\t\t\t\t// enable the property TextBox\r\n\t\t\t\tdijit.getEnclosingWidget(dojo.query(\"input\", this._editDialog.containerNode)[0]).attr(\"disabled\", false);\r\n\t\t\t}\r\n\t\t\tthis._editDialog.attr(\"title\", \"Add Property\");\r\n\t\t\t// default to a value type\r\n\t\t\tthis._enableFields(\"value\");\r\n\t\t\tthis._editDialog.attr(\"value\", {itemType: \"value\", property: property});\r\n\t\t\tthis._editDialog.show();\r\n\t\t});\r\n\r\n\t\tif(item.addNew){\r\n\t\t\t// we are adding a property to the parent item\r\n\t\t\titem = this.lastFocused.getParent().item;\r\n\t\t\t// the real value of the parent is in the parent property of the lastFocused item\r\n\t\t\t// this.lastFocused.getParent().item.value may be a reference to an item\r\n\t\t\tvalue = this.lastFocused.item.parent;\r\n\t\t}\r\n\t\tif(item.property && dojo.indexOf(this.store.getIdentityAttributes(), item.property) >= 0){\r\n\t\t\talert(\"Cannot add properties to an ID node!\");\r\n\t\t}else{\r\n\t\t\t// ifthe value is an item then we need to get the item's value\r\n\t\t\tif(this.store.isItem(value, true) && !this.store.isItemLoaded(value)){\r\n\t\t\t\t// fetch the value and see if it is an array\r\n\t\t\t\tthis.store.loadItem({\r\n\t\t\t\t\titem: value,\r\n\t\t\t\t\tonItem: function(loadedItem){\r\n\t\t\t\t\t\tvalue = loadedItem;\r\n\t\t\t\t\t\tshowDialog();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tshowDialog();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n})();\r\n\r\n"]}