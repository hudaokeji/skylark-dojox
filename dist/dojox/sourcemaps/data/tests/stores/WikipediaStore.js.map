{"version":3,"sources":["data/tests/stores/WikipediaStore.js"],"names":["dojo","provide","require","dojox","data","tests","stores","WikipediaStore","getStore","error","t","d","errData","errback","doh","register","name","timeout","runTest","ws","Deferred","fetch","query","title","onComplete","items","length","is","containsValue","callback","onError","partial","onItem","item","request","action","text","count","start","isItem","getAttributes","getLabel","labels","getLabelAttributes","isArray","i","getValue","getValues","hasAttribute","loadItem","loadedItem","loadedRequest","isItemLoaded","f","getIdentity","getIdentityAttributes","firstItem","fetchItemByIdentity","identity","features","getFeatures","assertTrue","identityApi","api","Identity","passed","toString","charAt","console","log"],"mappings":"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","file":"../../../../data/tests/stores/WikipediaStore.js","sourcesContent":["dojo.provide(\"dojox.data.tests.stores.WikipediaStore\");\r\n\r\ndojo.require(\"dojox.data.WikipediaStore\");\r\ndojo.require(\"dojo.data.api.Read\");\r\ndojo.require(\"dojo.data.api.Identity\");\r\n\r\ndojox.data.tests.stores.WikipediaStore.getStore = function(){\r\n\treturn new dojox.data.WikipediaStore();\r\n};\r\n\r\ndojox.data.tests.stores.WikipediaStore.error = function(t, d, errData){\r\n\t// summary:\r\n\t//\t\tOur shared error callback\r\n\td.errback(errData);\r\n};\r\n\r\ndoh.register(\"dojox.data.tests.stores.WikipediaStore\",[\r\n\t{\r\n\t\tname: \"ReadAPI: containsValue\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tVerify the containsValue method functions correctly.\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\t// hopefully Wikipedia doesn't rename the Main Page!\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { title: \"Main Page\" },\r\n\t\t\t\tonComplete: function(items, length){\r\n\t\t\t\t\tt.is(1, items.length);\r\n\t\t\t\t\tt.t(ws.containsValue(items[0], \"title\", \"Main Page\"));\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: fetch (one)\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTest a single page fetch from Wikipedia\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { title: \"Main Page\" },\r\n\t\t\t\tonItem: function(item, request){\r\n\t\t\t\t\tt.t(item.title && item.title.length && item.title.length > 0);\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, doh, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: fetch (query 30)\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTest a full text search from Wikipedia\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { action: \"query\", text: \"dojo\" },\r\n\t\t\t\tcount: 30,\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(30, items.length);\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: fetch (paged)\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTest multiple fetches on a single full text search.\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\t\t\tvar count = 0;\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { action: \"query\", text: \"dojo\" },\r\n\t\t\t\tcount: 15,\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(15, items.length);\r\n\t\t\t\t\tcount = items.length;\r\n\t\t\t\t\tws.fetch({\r\n\t\t\t\t\t\tquery: { action: \"query\", text: \"dojo\" },\r\n\t\t\t\t\t\tstart: count+1,\r\n\t\t\t\t\t\tcount: 15,\r\n\t\t\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\t\t\tt.is(30, count + items.length);\r\n\t\t\t\t\t\t\td.callback(true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: getAttributes\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tVerify the getAttributes method functions correctly\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { title: \"Main Page\" },\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(1, items.length);\r\n\t\t\t\t\tt.t(ws.isItem(items[0]));\r\n\t\t\t\t\tt.t(ws.getAttributes(items[0]).length > 0);\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: getLabel\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTest that the store correctly sets a label.\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { action: \"query\", text: \"dojo\" },\r\n\t\t\t\tcount: 1,\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(1, items.length);\r\n\t\t\t\t\tt.t(ws.getLabel(items[0]) !== null);\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: getLabelAttributes\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTest that the store correctly enumerates the label attributes.\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { action: \"query\", text: \"dojo\" },\r\n\t\t\t\tcount: 1,\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(1, items.length);\r\n\t\t\t\t\tvar labels = ws.getLabelAttributes(items[0]);\r\n\t\t\t\t\tt.t(dojo.isArray(labels));\r\n\t\t\t\t\tt.is(\"title\", labels[0]);\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: getValue\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tVerify that getValue does what it should.\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { title: \"Main Page\" },\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(1, items.length);\r\n\t\t\t\t\tvar i = items[0];\r\n\t\t\t\t\tt.t(ws.getValue(i, \"text\") !== null);\r\n\t\t\t\t\tt.t(ws.getValue(i, \"links\") !== null);\r\n\t\t\t\t\tt.t(ws.getValue(i, \"categories\") !== null);\r\n\t\t\t\t\tt.t(ws.getValue(i, \"images\") !== null);\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: getValues\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tVerify that getValues does what it should\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { title: \"Main Page\" },\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(1, items.length);\r\n\t\t\t\t\tvar i = items[0];\r\n\t\t\t\t\tt.t(dojo.isArray(ws.getValues(i, \"text\")));\r\n\t\t\t\t\tt.t(dojo.isArray(ws.getValues(i, \"links\")));\r\n\t\t\t\t\tt.t(dojo.isArray(ws.getValues(i, \"categories\")));\r\n\t\t\t\t\tt.t(dojo.isArray(ws.getValues(i, \"images\")));\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: hasAttribute\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tVerify the hasAttribute method\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { title: \"Main Page\" },\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(1, items.length);\r\n\t\t\t\t\tvar i = items[0];\r\n\t\t\t\t\tt.t(i !== null);\r\n\t\t\t\t\tt.t(ws.hasAttribute(i, \"title\"));\r\n\t\t\t\t\tt.t(ws.hasAttribute(i, \"text\"));\r\n\t\t\t\t\tt.t(ws.hasAttribute(i, \"links\"));\r\n\t\t\t\t\tt.t(ws.hasAttribute(i, \"categories\"));\r\n\t\t\t\t\tt.t(ws.hasAttribute(i, \"images\"));\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: isItem\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tVerify the isItem method\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { action: \"query\", text: \"dojo\" },\r\n\t\t\t\tcount: 10,\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(10, items.length);\r\n\t\t\t\t\tfor(var i=0; i<items.length; i++){\r\n\t\t\t\t\t\tt.t(ws.isItem(items[i]));\r\n\t\t\t\t\t}\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: isItemLoaded\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tVerify the isItemLoaded method\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { action: \"query\", text: \"dojo\" },\r\n\t\t\t\tcount: 5,\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(5, items.length);\r\n\t\t\t\t\tws.loadItem({\r\n\t\t\t\t\t\titem: items[0],\r\n\t\t\t\t\t\tonItem: function(loadedItem, loadedRequest){\r\n\t\t\t\t\t\t\tt.t(ws.isItemLoaded(loadedItem));\r\n\t\t\t\t\t\t\tt.f(ws.isItemLoaded(items[1])); // test an invalid item\r\n\t\t\t\t\t\t\td.callback(true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"IdentityAPI: getIdentity\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tVerify the getIdentity method returns the correct value\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { title: \"Main Page\" },\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(1, items.length);\r\n\t\t\t\t\tt.t(ws.isItem(items[0]));\r\n\t\t\t\t\tt.t(ws.getIdentity(items[0]) === \"Main Page\");\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"ReadAPI: loadItem\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tVerify the loadItem method\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { action: \"query\", text: \"dojo\" },\r\n\t\t\t\tcount: 5,\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(5, items.length);\r\n\t\t\t\t\tt.t(ws.isItem(items[0]));\r\n\t\t\t\t\tt.t(ws.getIdentityAttributes(items[0]).length > 0);\r\n\t\t\t\t\tws.loadItem({\r\n\t\t\t\t\t\titem: items[0],\r\n\t\t\t\t\t\tonItem: function(item, request){\r\n\t\t\t\t\t\t\tt.t(ws.isItem(item));\r\n\t\t\t\t\t\t\tt.t(ws.isItemLoaded(item));\r\n\t\t\t\t\t\t\td.callback(true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"IdentityAPI: getIdentityAttributes\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tVerify the getIdentityAttributes method functions correctly\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { title: \"Main Page\" },\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tt.is(1, items.length);\r\n\t\t\t\t\tt.t(ws.isItem(items[0]));\r\n\t\t\t\t\tt.t(ws.getIdentityAttributes(items[0]).length > 0);\r\n\t\t\t\t\td.callback(true);\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"IdentityAPI: fetchItemByIdentity\",\r\n\t\ttimeout: 30000,\r\n\t\trunTest: function(t) {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tVerify the fetchItemByIdentity method works\r\n\t\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\t\tvar d = new doh.Deferred();\r\n\r\n\t\t\tws.fetch({\r\n\t\t\t\tquery: { title: \"Main Page\" },\r\n\t\t\t\tonComplete: function(items, request){\r\n\t\t\t\t\tvar firstItem = items[0];\r\n\t\t\t\t\tt.is(1, items.length);\r\n\t\t\t\t\tt.t(ws.isItem(firstItem));\r\n\t\t\t\t\tws.fetchItemByIdentity({\r\n\t\t\t\t\t\tidentity: \"Main Page\",\r\n\t\t\t\t\t\tonItem: function(item, request){\r\n\t\t\t\t\t\t\tt.t(ws.isItem(item));\r\n\t\t\t\t\t\t\tt.t(ws.getValue(firstItem, \"title\") === ws.getValue(item, \"title\"));\r\n\t\t\t\t\t\t\td.callback(true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tonError: dojo.partial(dojox.data.tests.stores.WikipediaStore.error, t, d)\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t}\r\n\t},\r\n\t\r\n\r\n\tfunction testIdentityAPI_getFeatures(t){\r\n\t\t// summary:\r\n\t\t//\t\tTest that the store correctly advertises its capabilities\r\n\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\r\n\t\tvar features = ws.getFeatures();\r\n\t\tvar count = 0;\r\n\t\tfor(var i in features){\r\n\t\t\tif(i === \"dojo.data.api.Read\") count++;\r\n\t\t\tif(i === \"dojo.data.api.Identity\") count++;\r\n\t\t}\r\n\t\tt.assertTrue(count === 2);\r\n\t},\r\n\r\n\tfunction testIdentityAPI_functionConformance(t){\r\n\t\t// summary:\r\n\t\t//\t\tTests for Identity API conformance by checking to see that all declared functions are actual functions on the instances.\r\n\t\tvar ws = dojox.data.tests.stores.WikipediaStore.getStore();\r\n\t\tvar identityApi = new dojo.data.api.Identity();\r\n\t\tvar passed = true;\r\n\t\tfor(var i in identityApi){\r\n\t\t\tif(i.toString().charAt(0) === '_'){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t// check that every function defined in the Identity API is defined on the store\r\n\t\t\tif(typeof identityApi[i] === \"function\"){\r\n\t\t\t\tif(!(typeof ws[i] === \"function\")){\r\n\t\t\t\t\tconsole.log(\"Error:\" + i + \" should be a function but is: \" + typeof ws[i]);\r\n\t\t\t\t\tpassed = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tt.assertTrue(passed);\r\n\t}\r\n]);\r\n"]}