{"version":3,"sources":["rails.js"],"names":["dojo","provide","require","dojox","rails","live","selector","evtName","fn","isIE","match","evt","target","tag","tagName","toLowerCase","attr","form","query","closest","length","h","connect","disconnect","call","body","nl","ready","d","dr","dg","q","csrfToken","csrfParam","createFormForLink","url","method","place","typeMap","text","json","json-comment-optional","json-comment-filtered","javascript","xml","handleRemote","el","content","formToObject","type","preventDefault","publish","xhr","headers","Accept","handleAs","load","response","ioArgs","error","handle","confirm","subscribe","forEach","node","value","href","submit","elements","message","originalValue","disable","global"],"mappings":"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","file":"../rails.js","sourcesContent":["dojo.provide(\"dojox.rails\");\r\ndojo.require(\"dojo.NodeList-traverse\");\r\n\r\ndojox.rails.live = function(selector, evtName, fn){\r\n\tif (dojo.isIE && evtName.match(/^(on)?submit$/i)){\r\n\t\tdojox.rails.live(selector, \"click\", function(evt){\r\n\t\t\tvar target = evt.target, tag = target.tagName.toLowerCase();\r\n\t\t\tif ((tag == \"input\" || tag == \"button\") && dojo.attr(target, \"type\").toLowerCase() == \"submit\"){\r\n\t\t\t\t var form = dojo.query(target).closest(\"form\");\r\n\t\t\t\t if (form.length){\r\n\t\t\t\t\tvar h = dojo.connect(form[0], \"submit\", function(evt){\r\n\t\t\t\t\t \tdojo.disconnect(h);\r\n\t\t\t\t\t \tfn.call(evt.target, evt);\r\n\t\t\t\t \t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}else{\r\n\t\tdojo.connect(dojo.body(), evtName, function(evt){\r\n\t\t\tvar nl = dojo.query(evt.target).closest(selector);\r\n\t\t\tif (nl.length){\r\n\t\t\t\tfn.call(nl[0], evt);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n};\r\n\r\ndojo.ready((function(d, dr, dg){\r\n\treturn function() {\r\n\t\tvar q = d.query, live = dr.live,\r\n\t\t\t\tcsrfToken = q(\"meta[name=csrf-token]\").attr(\"content\"),\r\n\t\t    csrfParam = q(\"meta[name=csrf-param]\").attr(\"content\");\r\n\r\n\t\tvar createFormForLink = function(url, method){\r\n\t\t\tvar form = '<form style=\"display:none\" method=\"post\" action=\"'+ url +'\">' +\r\n\t\t\t\t'<input type=\"hidden\" name=\"_method\" value=\"'+ method +'\" />' +\r\n\t\t\t\t'<input type=\"hidden\" name=\"'+ csrfParam +'\" value=\"'+ csrfToken +'\" />' +\r\n\t\t\t\t'</form>';\r\n\t\t\treturn dojo.place(form, dojo.body());\r\n\t\t};\r\n\r\n\t\tvar disable = function(elements){\r\n\t\t\td.forEach(elements, function(node){\r\n\t\t\t\tif (!d.attr(node, \"disabled\")){\r\n\t\t\t\t\tvar attr = node.tagName.toLowerCase() == \"input\" ? \"value\" : \"innerHTML\";\r\n\t\t\t\t\tvar message = d.attr(node, \"data-disable-with\");\r\n\t\t\t\t\tvar originalValue = d.attr(node, attr);\r\n\t\t\t\t\td.attr(node, \"disabled\", true);\r\n\t\t\t\t\td.attr(node, \"data-original-value\", originalValue);\r\n\t\t\t\t\td.attr(node, attr, message);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvar typeMap = {\r\n\t\t\t\"text\":                  \"text\",\r\n\t\t\t\"json\":                  \"application/json\",\r\n\t\t\t\"json-comment-optional\": \"text\",\r\n\t\t\t\"json-comment-filtered\": \"text\",\r\n\t\t\t\"javascript\":            \"application/javascript\",\r\n\t\t\t\"xml\":                   \"text/xml\"\r\n\t\t};\r\n\r\n\t\tvar handleRemote = function(evt){\r\n\t\t\tvar el = evt.target, tag = el.tagName.toLowerCase();\r\n\t\t\tvar content = tag.toLowerCase() == \"form\" ? d.formToObject(el) : {},\r\n\t\t\t\t\ttype   =  d.attr(el, \"data-type\") || \"javascript\",\r\n\t\t\t\t\tmethod = (d.attr(el, \"method\")    || d.attr(el, \"data-method\") || \"get\").toLowerCase(),\r\n\t\t\t\t\turl    =  d.attr(el, \"action\")    || d.attr(el, \"href\");\r\n\r\n\t\t\tif (tag != \"form\" && method != \"get\"){\r\n\t\t\t\t\tel = createFormForLink(url, method);\r\n\t\t\t\t\tmethod = \"POST\";\r\n\t\t\t}\r\n\t\t\tevt.preventDefault();\r\n\r\n\r\n\t\t\t// ajax:loading, ajax:loaded, and ajax:interactive are not supported\r\n\t\t\td.publish(\"ajax:before\", [el]);\r\n\t\t\tvar deferred = d.xhr(method, {\r\n\t\t\t\turl:      url,\r\n\t\t\t\theaders:  { \"Accept\": typeMap[type] },\r\n\t\t\t\tcontent:  content,\r\n\t\t\t\thandleAs: type,\r\n\t\t\t\tload:\t\t  function(response, ioArgs) {d.publish(\"ajax:success\",\t [el, response, ioArgs]);},\r\n\t\t\t\terror:\t  function(response, ioArgs) {d.publish(\"ajax:failure\",  [el, response, ioArgs]);},\r\n\t\t\t\thandle:   function(response, ioArgs) {d.publish(\"ajax:complete\", [el, response, ioArgs]);}\r\n\t\t\t});\r\n\t\t\td.publish(\"ajax:after\", [el]);\r\n\t\t};\r\n\r\n\t\tvar handleEnable\t= function(el){\r\n\t\t\tq(\"*[data-disable-with][disabled]\", el).forEach(function(node){\r\n\t\t\t\tvar attr = node.tagName.toLowerCase() == \"input\" ? \"value\" : \"innerHTML\";\r\n\t\t\t\tvar value = d.attr(node, \"data-original-value\");\r\n\t\t\t\td.attr(node, \"disabled\", false);\r\n\t\t\t\td.attr(node, \"data-original-value\", null);\r\n\t\t\t\td.attr(node, attr, value);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvar handleDataMethod = function(evt){\r\n\t\t\tvar el = evt.target, form = createFormForLink(el.href, dojo.attr(el, \"data-method\"));\r\n\t\t\tevt.preventDefault();\r\n\t\t\tform.submit();\r\n\t\t};\r\n\r\n\t\tvar handleFormSubmit = function(evt){\r\n\t\t\tvar el = evt.target, elements = q(\"*[data-disable-with]\", el);\r\n\t\t\tif (elements.length){ disable(elements); }\r\n\t\t\tif (d.attr(el, \"data-remote\")){\r\n\t\t\t\tevt.preventDefault();\r\n\t\t\t\thandleRemote(evt);\r\n \t\t\t}\r\n\t\t};\r\n\r\n\t\tvar handleConfirm = function(evt){\r\n\t\t\tvar proceed = dg.confirm(d.attr(evt.target, \"data-confirm\"));\r\n\t\t\tif (!proceed){\r\n\t\t\t\tevt.preventDefault();\r\n\t\t\t}else if (d.attr(evt.target, \"data-remote\")){\r\n\t\t\t\thandleRemote(evt);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Register data-{action} elements.\t Order is important since the return values\r\n\t\t// from previously called functions in the connect chain influence whether\r\n\t\t// or not the next function in the chain is called.\r\n\r\n\t\t// Register data-confirm elements\r\n\t\tlive(\"*[data-confirm]\", \"click\", handleConfirm);\r\n\r\n\t\t// data-disable-with only applies to forms\r\n\t\td.subscribe(\"ajax:complete\", handleEnable);\r\n\r\n\t\t// Register data-remote elements\r\n\t\tlive(\"a[data-remote]:not([data-confirm])\", \"click\", handleRemote);\r\n\t\tlive(\"a[data-method]:not([data-remote])\", \"click\", handleDataMethod);\r\n\r\n\t\t// Handle form submits\r\n\t\tlive(\"form\", \"submit\", handleFormSubmit);\r\n\t};\r\n})(dojo, dojox.rails, dojo.global));\r\n"]}