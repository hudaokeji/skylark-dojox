{"version":3,"sources":["lang/async.js"],"names":["dojo","provide","d","Deferred","each","forEach","some","async","dojox","lang","aps","Array","prototype","slice","opts","Object","toString","seq","x","fs","call","arguments","init","f","addCallback","callback","par","results","length","cancel","v","fired","ready","i","e","Error","errback","addCallbacks","any","noResult","index","addBoth","select","cond","ifThen","ifTrue","ifFalse","loop","body","y","ifErr","setUp","addErrback"],"mappings":"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","file":"../../lang/async.js","sourcesContent":["dojo.provide(\"dojox.lang.async\");\r\n\r\n(function(){\r\n\tvar d = dojo, Deferred = d.Deferred, each = d.forEach, some = d.some,\r\n\t\tasync = dojox.lang.async, aps = Array.prototype.slice,\r\n\t\topts = Object.prototype.toString;\r\n\r\n\tasync.seq = function(x){\r\n\t\t// summary:\r\n\t\t//\t\tExecutes functions sequentially. Waits if any of them returns Deferred.\r\n\t\tvar fs = opts.call(x) == \"[object Array]\" ? x : arguments;\r\n\t\treturn function(init){\r\n\t\t\tvar x = new Deferred();\r\n\t\t\teach(fs, function(f){ x.addCallback(f); });\r\n\t\t\tx.callback(init);\r\n\t\t\treturn x;\r\n\t\t};\r\n\t};\r\n\r\n\tasync.par = function(x){\r\n\t\t// summary:\r\n\t\t//\t\tExecutes functions in parallel. Waits for all of them to finish.\r\n\t\tvar fs = opts.call(x) == \"[object Array]\" ? x : arguments;\r\n\t\treturn function(init){\r\n\t\t\tvar results = new Array(fs.length),\r\n\t\t\t\tcancel = function(){\r\n\t\t\t\t\teach(results, function(v){\r\n\t\t\t\t\t\tif(v instanceof Deferred && v.fired < 0){\r\n\t\t\t\t\t\t\tv.cancel();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tx = new Deferred(cancel),\r\n\t\t\t\tready = fs.length;\r\n\t\t\teach(fs, function(f, i){\r\n\t\t\t\tvar x;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tx = f(init);\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\tx = e;\r\n\t\t\t\t}\r\n\t\t\t\tresults[i] = x;\r\n\t\t\t});\r\n\t\t\tvar failed = some(results, function(v){\r\n\t\t\t\tif(v instanceof Error){\r\n\t\t\t\t\tcancel();\r\n\t\t\t\t\tx.errback(v);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\tif(!failed){\r\n\t\t\t\teach(results, function(v, i){\r\n\t\t\t\t\tif(v instanceof Deferred){\r\n\t\t\t\t\t\tv.addCallbacks(\r\n\t\t\t\t\t\t\tfunction(v){\r\n\t\t\t\t\t\t\t\tresults[i] = v;\r\n\t\t\t\t\t\t\t\tif(!--ready){\r\n\t\t\t\t\t\t\t\t\tx.callback(results);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfunction(v){\r\n\t\t\t\t\t\t\t\tcancel();\r\n\t\t\t\t\t\t\t\tx.errback(v);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t--ready;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif(!ready){\r\n\t\t\t\tx.callback(results);\r\n\t\t\t}\r\n\t\t\treturn x;\r\n\t\t};\r\n\t};\r\n\r\n\tasync.any = function(x){\r\n\t\t// summary:\r\n\t\t//\t\tExecutes functions in parallel. As soon as one of them finishes\r\n\t\t//\t\tcancels the rest.\r\n\t\tvar fs = opts.call(x) == \"[object Array]\" ? x : arguments;\r\n\t\treturn function(init){\r\n\t\t\tvar results = new Array(fs.length), noResult = true;\r\n\t\t\t\tcancel = function(index){\r\n\t\t\t\t\teach(results, function(v, i){\r\n\t\t\t\t\t\tif(i != index && v instanceof Deferred && v.fired < 0){\r\n\t\t\t\t\t\t\tv.cancel();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tx = new Deferred(cancel);\r\n\t\t\teach(fs, function(f, i){\r\n\t\t\t\tvar x;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tx = f(init);\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\tx = e;\r\n\t\t\t\t}\r\n\t\t\t\tresults[i] = x;\r\n\t\t\t});\r\n\t\t\tvar done = some(results, function(v, i){\r\n\t\t\t\tif(!(v instanceof Deferred)){\r\n\t\t\t\t\tcancel(i);\r\n\t\t\t\t\tx.callback(v);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\tif(!done){\r\n\t\t\t\teach(results, function(v, i){\r\n\t\t\t\t\tv.addBoth(\r\n\t\t\t\t\t\tfunction(v){\r\n\t\t\t\t\t\t\tif(noResult){\r\n\t\t\t\t\t\t\t\tnoResult = false;\r\n\t\t\t\t\t\t\t\tcancel(i);\r\n\t\t\t\t\t\t\t\tx.callback(v);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn x;\r\n\t\t};\r\n\t};\r\n\r\n\tasync.select = function(cond, x){\r\n\t\t// summary:\r\n\t\t//\t\tExecutes a condition, waits for it if necessary, and executes\r\n\t\t//\t\tNth function from list.\r\n\t\tvar fs = opts.call(x) == \"[object Array]\" ? x : aps.call(arguments, 1);\r\n\t\treturn function(init){\r\n\t\t\treturn new Deferred().addCallback(cond).addCallback(function(v){\r\n\t\t\t\tif(typeof v == \"number\" && v >= 0 && v < fs.length){\r\n\t\t\t\t\treturn fs[v](init);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn new Error(\"async.select: out of range\");\r\n\t\t\t\t}\r\n\t\t\t}).callback(init);\r\n\t\t};\r\n\t};\r\n\r\n\tasync.ifThen = function(cond, ifTrue, ifFalse){\r\n\t\t// summary:\r\n\t\t//\t\tExecutes a condition, waits for it if necessary, and executes\r\n\t\t//\t\tone of two functions.\r\n\t\treturn function(init){\r\n\t\t\treturn new Deferred().addCallback(cond).addCallback(function(v){\r\n\t\t\t\treturn (v ? ifTrue : ifFalse)(init);\r\n\t\t\t}).callback(init);\r\n\t\t};\r\n\t};\r\n\r\n\tasync.loop = function(cond, body){\r\n\t\t// summary:\r\n\t\t//\t\tExecutes a condition, waits for it if necessary, and executes\r\n\t\t//\t\tthe body, if truthy value was returned.\r\n\t\t//\t\tThen it repeats the cycle until the condition function returns\r\n\t\t//\t\ta falsy value.\r\n\t\treturn function(init){\r\n\t\t\tvar x, y = new Deferred(function(){ x.cancel(); });\r\n\t\t\tfunction ifErr(v){ y.errback(v); }\r\n\t\t\tfunction loop(v){\r\n\t\t\t\tif(v){\r\n\t\t\t\t\tx.addCallback(body).addCallback(setUp);\r\n\t\t\t\t}else{\r\n\t\t\t\t\ty.callback(v);\r\n\t\t\t\t}\r\n\t\t\t\treturn v;\r\n\t\t\t}\r\n\t\t\tfunction setUp(init){\r\n\t\t\t\tx = new Deferred().\r\n\t\t\t\t\taddCallback(cond).\r\n\t\t\t\t\taddCallback(loop).\r\n\t\t\t\t\taddErrback(ifErr);\r\n\t\t\t\tx.callback(init);\r\n\t\t\t}\r\n\t\t\tsetUp(init);\r\n\t\t\treturn y;\r\n\t\t};\r\n\t};\r\n})();\r\n\r\n/*\r\nDesign decisions:\r\n\r\nseq() - behaves like the normal Deferred callback chain.\r\n\r\npar() - if error, all pending Deferreds are cancelled and the error is signaled,\r\notherwise return an array of all results.\r\n\r\nany() - just like par() but only one result is returned.\r\n\r\nselect() - any error is returned, otherwise the selected result is returned.\r\n\r\nloop() - any error is returned, otherwise the last result is returned.\r\n\r\n*/\r\n"]}