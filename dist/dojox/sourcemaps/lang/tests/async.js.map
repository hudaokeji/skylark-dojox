{"version":3,"sources":["lang/tests/async.js"],"names":["dojo","provide","require","async","dojox","lang","wait","timeout","from","QUANT","MAX_TICKS","randomTimes","n","a","i","push","Math","floor","random","waitAndExpect","expected","ms","value","console","log","Error","identity","x","waitFor0","waitFor1","waitFor2","tests","register","r","Deferred","addCallback","callback","fs","map","seq","length","par","is","b","visited","Object","prototype","toString","call","akeys","bkeys","sort","min","apply","getMin","any","select","ifThen","counter","loop"],"mappings":"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","file":"../../../lang/tests/async.js","sourcesContent":["dojo.provide(\"dojox.lang.tests.async\");\r\n\r\ndojo.require(\"dojox.lang.async\");\r\ndojo.require(\"dojox.lang.async.timeout\");\r\ndojo.require(\"dojox.lang.async.topic\");\r\n\r\n(function(){\r\n\tvar async = dojox.lang.async,\r\n\t\twait = async.timeout.from,\r\n\t\tQUANT     = 50, // ms\r\n\t\tMAX_TICKS = 5;\r\n\r\n\tfunction randomTimes(n){\r\n\t\tvar a = [];\r\n\t\tfor(var i = 0; i < n; ++i){\r\n\t\t\ta.push((Math.floor(Math.random() * MAX_TICKS) + 1) * QUANT);\r\n\t\t}\r\n\t\treturn a;\r\n\t}\r\n\r\n\tfunction getMin(a){\r\n\t\treturn Math.min.apply(Math, a);\r\n\t}\r\n\r\n\tfunction getMax(a){\r\n\t\treturn Math.max.apply(Math, a);\r\n\t}\r\n\r\n\tfunction waitAndExpect(expected, ms){\r\n\t\treturn function(value){\r\n\t\t\tconsole.log(\"waitAndExpect: \", value, \", expected: \", expected);\r\n\t\t\tif(expected !== value){\r\n\t\t\t\tconsole.log(\"ERROR: unexpected value\");\r\n\t\t\t\tthrow new Error(\"Unexpected value\");\r\n\t\t\t}\r\n\t\t\treturn wait(ms)();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction identity(x){\r\n\t\treturn x;\r\n\t}\r\n\r\n\tfunction is(a, b, visited){\r\n\t\tif(a === b){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif(typeof a != typeof b){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(Object.prototype.toString.call(a) != Object.prototype.toString.call(b)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(Object.prototype.toString.call(a) == \"[object Function]\"){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(Object.prototype.toString.call(a) == \"[object Array]\"){\r\n\t\t\tif(a.length !== b.length){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tfor(var i = 0; i < a.length; ++i){\r\n\t\t\t\tif(!is(a[i], b[i], visited)){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(typeof a == \"object\"){\r\n\t\t\tif(visited){\r\n\t\t\t\tfor(var i = 0; i < visited.length; ++i){\r\n\t\t\t\t\tif(visited[i] === a || visited[i] === b){\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvisited.push(a, b);\r\n\t\t\t}else{\r\n\t\t\t\tvisited = [a, b];\r\n}\r\n\t\t\tvar akeys = [];\r\n\t\t\tfor(var i in a){\r\n\t\t\t\takeys.push(i);\r\n\t\t\t}\r\n\t\t\tvar bkeys = [];\r\n\t\t\tfor(var i in b){\r\n\t\t\t\tbkeys.push(i);\r\n\t\t\t}\r\n\t\t\takeys.sort();\r\n\t\t\tbkeys.sort();\r\n\t\t\tif(!is(akeys, bkeys)){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tfor(var i = 0; i < akeys.length; ++i){\r\n\t\t\t\tif(!is(a[akeys[i]], b[bkeys[i]])){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar waitFor0 = waitAndExpect(0, 20),\r\n\t\twaitFor1 = waitAndExpect(1, 20),\r\n\t\twaitFor2 = waitAndExpect(2, 20);\r\n\r\n\ttests.register(\"dojox.lang.tests.async\", [\r\n\t\tfunction smokeTest(){\r\n\t\t\tvar a = randomTimes(1),\r\n\t\t\t\tr = new dojo.Deferred();\r\n\t\t\twait(a[0])().addCallback(function(x){\r\n\t\t\t\tif(r == a[0]){\r\n\t\t\t\t\tconsole.log(\"ERROR: smokeTest: wrong result\");\r\n\t\t\t\t\tthrow new Error(\"smokeTest: wrong result\");\r\n\t\t\t\t}\r\n\t\t\t\tr.callback();\r\n\t\t\t});\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tfunction testSeq(){\r\n\t\t\tvar a = randomTimes(5),\r\n\t\t\t\tfs = dojo.map(a, function(ms, i){\r\n\t\t\t\t\treturn waitAndExpect(i && a[i - 1], ms);\r\n\t\t\t\t});\r\n\t\t\treturn async.seq(fs)(0).addCallback(function(value){\r\n\t\t\t\tif(a[a.length - 1] !== value){\r\n\t\t\t\t\tconsole.log(\"ERROR: testSeq: wrong time\");\r\n\t\t\t\t\tthrow new Error(\"testSeq: wrong time\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tfunction testPar(){\r\n\t\t\tvar a = randomTimes(5),\r\n\t\t\t\tfs = dojo.map(a, function(ms){\r\n\t\t\t\t\treturn waitAndExpect(0, ms);\r\n\t\t\t\t});\r\n\t\t\treturn async.par(fs)(0).addCallback(function(value){\r\n\t\t\t\tconsole.log(a, \" - \", value);\r\n\t\t\t\tif(!is(a, value)){\r\n\t\t\t\t\tconsole.log(\"ERROR: testPar: wrong time\");\r\n\t\t\t\t\tthrow new Error(\"testPar: wrong time\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tfunction testAny(){\r\n\t\t\tvar a = randomTimes(5),\r\n\t\t\t\tmin = getMin(a),\r\n\t\t\t\tfs = dojo.map(a, function(ms){\r\n\t\t\t\t\treturn waitAndExpect(0, ms);\r\n\t\t\t\t});\r\n\t\t\treturn async.any(fs)(0).addCallback(function(value){\r\n\t\t\t\tconsole.log(min, \" - \", value);\r\n\t\t\t\tif(min !== value){\r\n\t\t\t\t\tconsole.log(\"ERROR: testAny: wrong time\");\r\n\t\t\t\t\tthrow new Error(\"testAny: wrong time\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tfunction testSelect0(){\r\n\t\t\treturn async.select(\r\n\t\t\t\tidentity,\r\n\t\t\t\twaitFor0,\r\n\t\t\t\twaitFor1,\r\n\t\t\t\twaitFor2\r\n\t\t\t)(0);\r\n\t\t},\r\n\t\tfunction testSelect1(){\r\n\t\t\treturn async.select(\r\n\t\t\t\tidentity,\r\n\t\t\t\twaitFor0,\r\n\t\t\t\twaitFor1,\r\n\t\t\t\twaitFor2\r\n\t\t\t)(1);\r\n\t\t},\r\n\t\tfunction testSelect2(){\r\n\t\t\treturn async.select(\r\n\t\t\t\tidentity,\r\n\t\t\t\twaitFor0,\r\n\t\t\t\twaitFor1,\r\n\t\t\t\twaitFor2\r\n\t\t\t)(2);\r\n\t\t},\r\n\t\tfunction testIfThenT(){\r\n\t\t\treturn async.ifThen(\r\n\t\t\t\tidentity,\r\n\t\t\t\twaitFor1,\r\n\t\t\t\twaitFor0\r\n\t\t\t)(1);\r\n\t\t},\r\n\t\tfunction testIfThenF(){\r\n\t\t\treturn async.ifThen(\r\n\t\t\t\tidentity,\r\n\t\t\t\twaitFor1,\r\n\t\t\t\twaitFor0\r\n\t\t\t)(0);\r\n\t\t},\r\n\t\tfunction testLoop(){\r\n\t\t\tvar counter = 0;\r\n\t\t\treturn async.seq(\r\n\t\t\t\tasync.loop(\r\n\t\t\t\t\tidentity,\r\n\t\t\t\t\tfunction(ms){\r\n\t\t\t\t\t\t++counter;\r\n\t\t\t\t\t\treturn wait(ms - 10)();\r\n\t\t\t\t\t}\r\n\t\t\t\t),\r\n\t\t\t\tfunction(){\r\n\t\t\t\t\tconsole.log(counter, \" - \", 3);\r\n\t\t\t\t\tif(counter !== 3){\r\n\t\t\t\t\t\tconsole.log(\"ERROR: testLoop: wrong number of iterations\");\r\n\t\t\t\t\t\tthrow new Error(\"testLoop: wrong number of iterations\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t)(30);\r\n\t\t}\r\n\t]);\r\n})();\r\n"]}