{"version":3,"sources":["secure/tests/DOM.js"],"names":["violater","func","name","runTest","t","insecure","e","console","log","f","dojo","provide","require","doh","register","div","document","createElement","body","appendChild","innerHTML","style","position","top","left","backgroundColor","color","container","wrap","dojox","secure","DOM","securedElement","securedDoc","ownerDocument","assertEqual","data__","write","close","match","newDiv","addEventListener","event","alert","parentNode","bad","script","createTextNode","isIE","MozBinding","behavior"],"mappings":"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","file":"../../../secure/tests/DOM.js","sourcesContent":["dojo.provide(\"dojox.secure.tests.DOM\");\r\ndojo.require(\"dojox.secure.DOM\");\r\n\r\ndoh.register(\"dojox.secure.tests.DOM.good\",\r\n\t[\r\n\t\tfunction setup(){\r\n\t\t\tvar div = document.createElement(\"div\");\r\n\t\t\tdocument.body.appendChild(div);\r\n\t\t\tdiv.innerHTML = \"Sandboxed div:\";\r\n\t\t\tdiv.style.position = \"absolute\";\r\n\t\t\tdiv.style.top = \"100px\";\r\n\t\t\tdiv.style.left = \"100px\";\r\n\t\t\tdiv.style.backgroundColor = \"red\";\r\n\t\t\tdiv.style.color = \"white\";\r\n\t\t\tvar container = document.createElement(\"div\");\r\n\t\t\tcontainer.style.backgroundColor = \"cyan\";\r\n\t\t\tcontainer.style.color = \"black\";\r\n\t\t\tdiv.appendChild(container);\r\n\t\t\twrap = dojox.secure.DOM(container);\r\n\t\t\tsecuredElement = wrap(container);\r\n\t\t\tconsole.log(\"securedElement\",securedElement);\r\n\t\t\tsecuredDoc = securedElement.ownerDocument;\r\n\t\t\tconsole.log(\"securedDoc\",securedDoc);\r\n\t\t},\r\n\t\tfunction innerHTML(t){\r\n\t\t\tsecuredElement.innerHTML = \"Hi there\";\r\n\t\t\tt.assertEqual(\"Hi there\",securedElement.data__.innerHTML);\r\n\t\t},\r\n\t\tfunction docWrite(t){\r\n\t\t\tsecuredDoc.write(\"<div style='color:red'>written</div>\");\r\n\t\t\tconsole.log(\"wrote\");\r\n\t\t\tsecuredDoc.close();\r\n\t\t\tt.t(securedElement.data__.innerHTML.match(/written/));\r\n\t\t},\r\n\t\tfunction addNode(t){\r\n\t\t\tvar newDiv = securedDoc.createElement(\"div\");\r\n\t\t\tconsole.log(\"wrapped \",newDiv.data__);\r\n\t\t\tnewDiv.innerHTML = \"inner div\";\r\n\t\t\tconsole.log(\"style \",newDiv.style.data__);\r\n\t\t\tnewDiv.style.color=\"blue\";\r\n\t\t\tconsole.log('appendChild ' + securedElement.appendChild);\r\n\t\t\tsecuredElement.appendChild(newDiv);\r\n\t\t\tt.t(securedElement.data__.innerHTML.match(/inner/));\r\n\t\t},\r\n\t\t/*function addStyleTag(t){\r\n\t\t\tsecuredElement.innerHTML = \"<style>div {color:green}</style><div>should be green</div>\";\r\n\t\t\tconsole.log('after style tag' + securedElement.innerHTML);\r\n\t\t\tt.t(securedElement.innerHTML.match(/color/));\r\n\t\t},*/\r\n\t\tfunction addOnclickHandler(t){\r\n\t\t\tsecuredElement.addEventListener(\"click\",function(event) {\r\n\t\t\t\talert('proper click handler');\r\n\t\t\t});\r\n\t\t\t\r\n\t\t}\r\n\t]);\r\n\r\nfunction violater(func) {\r\n\treturn {name: func.name,\r\n\trunTest: function(t) {\r\n\t\tvar insecure;\r\n\t\ttry {\r\n\t\t\tfunc(t);\r\n\t\t\tinsecure = true;\r\n\t\t}catch(e){\r\n\t\t\tconsole.log(\"successfully threw error\",e);\r\n\t\t}\r\n\t\tt.f(insecure);\r\n\t}};\r\n}\r\ndoh.register(\"dojox.secure.tests.DOM.bad\",\r\n\t[\r\n\t\tfunction parentNode(t){\r\n\t\t\tt.f(securedElement.parentNode);\r\n\t\t},\r\n\t\tfunction innerHTMLScript(t){\r\n\t\t\ttry {\r\n\t\t\t\tsecuredElement.innerHTML = \"<script>bad=true</script>\";\r\n\t\t\t}catch(e){}\r\n\t\t\t\tt.t(typeof bad == 'undefined');\r\n\t\t},\r\n\t\tfunction innerHTMLScript2(t){\r\n\t\t\ttry{\r\n\t\t\t\tsecuredElement.innerHTML = '</script><script>bad=true;//';\r\n\t\t\t}catch(e){}\r\n\t\t\t\tt.t(typeof bad == 'undefined');\r\n\t\t},\r\n\t\tfunction writeScript(t){\r\n\t\t\ttry{\r\n\t\t\t\tsecuredDoc.write(\"<script>bad=true;</script>\");\r\n\t\t\t}catch(e){}\r\n\t\t\t\tt.t(typeof bad == 'undefined');\r\n\t\t},\r\n\t\tfunction appendScript(t){\r\n\t\t\ttry {\r\n\t\t\t\tvar script = securedDoc.createElement('script');\r\n\t\t\t\tscript.appendChild(securedDoc.createTextNode(\r\n\t\t\t\t        'bad=true'));\r\n\t\t\t\tsecuredElement.appendChild(script);\r\n\t\t\t}\r\n\t\t\tcatch(e) {\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\tt.t(typeof bad == 'undefined');\r\n\t\t},\r\n\t\tfunction cssExpression(t) {\r\n\t\t\tif (dojo.isIE) {\r\n\t\t\t\tsecuredElement.innerHTML = '<div id=\"oDiv\" style=\"left:expression((bad=true), 0)\">Example DIV</div>';\r\n\t\t\t\tt.t(typeof bad == 'undefined');\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttry{\r\n\t\t\t\t\tsecuredElement.innerHTML = '<input style=\\'-moz-binding: url(\"http://www.mozilla.org/xbl/htmlBindings.xml#checkbox\");\\'>';\r\n\t\t\t\t}catch(e){}\r\n\t\t\t\t\r\n\t\t\t\tt.f(securedElement.innerHTML.match(/mozilla/))\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t},\r\n\t\tfunction cssExpression2(t) {\r\n\t\t\tif (dojo.isIE) {\r\n\t\t\t\tsecuredElement.style.left = 'expression(alert(\"hello\"), 0)';\r\n\t\t\t\tt.f(securedElement.style.left.match(/alert/));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tsecuredElement.style.MozBinding = 'url(\"http://www.mozilla.org/xbl/htmlBindings.xml#checkbox\")';\r\n\t\t\t\t}catch(e){}\r\n\t\t\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\t\tfunction cssExpression3(t) {\r\n\t\t\tif (dojo.isIE) {\r\n\t\t\t\tsecuredElement.style.behavior = 'url(a1.htc)';\r\n\t\t\t\tt.f(securedElement.style.behavior);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\t\t/*violater(function addStyleTag(t) {\r\n\t\t\tsecuredElement.innerHTML = \"<style>div {color:expression(alert(\\\"hello\\\")}</style><div>test</div>\";\r\n\t\t}),\r\n\t\tviolater(function addStyleTag2(t) {\r\n\t\t\tsecuredElement.innerHTML = \"<style>@import 'unsafe.css'</style><div>unsafe css</div>\";\r\n\t\t}),*/\r\n\t\tfunction addJavaScriptHref(t) {\r\n\t\t\tsecuredElement.innerHTML = \"<a href='javascript:alert(3)'>illegal link</a>\";\r\n\t\t},\r\n\t\t/*violater(function addNullCharSrc(t) {\r\n\t\t\tsecuredElement.innerHTML = \"<a href='java&#65533;script:alert(3)'>illegal link</a>\";\r\n\t\t}),*/\r\n\t\tfunction addOnclickHandler(t) {\r\n\t\t\ttry{\r\n\t\t\t\tsecuredElement.innerHTML = \"<div onclick='alert(4)'>illegal link</div>\";\r\n\t\t\t}catch(e){}\r\n\t\t\t\r\n\t\t\tt.f(securedElement.innerHTML.match(/alert/));\r\n\t\t},\r\n\t\tfunction confusingHTML(t) {\r\n\t\t\ttry {\r\n\t\t\t\tsecuredElement.innerHTML = '<div x=\"\\\"><img onload=alert(42)src=http://json.org/img/json160.gif>\"></div>';\r\n\t\t\t}catch(e){}\r\n\t\t\t\r\n\t\t\tt.f(securedElement.innerHTML.match(/alert/));\r\n\t\t},\r\n\t\tfunction confusingHTML2(t) {\r\n\t\t\ttry {\r\n\t\t\t\tsecuredElement.innerHTML = '<iframe/src=\"javascript:alert(42)\"></iframe>';\r\n\t\t\t}catch(e){}\r\n\t\t\t\r\n\t\t\tt.f(securedElement.innerHTML.match(/alert/));\r\n\t\t},\r\n\t\tfunction confusingHTML2(t) {\r\n\t\t\ttry{\r\n\t\t\t\tsecuredElement.innerHTML = '<iframe/ \"onload=alert(/XSS/)></iframe>';\r\n\t\t\t}catch(e){}\r\n\t\t\t\r\n\t\t\tt.f(securedElement.innerHTML.match(/alert/));\r\n\t\t}\r\n\t\t\r\n\t]);\r\n\t"]}