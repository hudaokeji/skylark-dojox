{"version":3,"sources":["form/FilePickerTextBox.js"],"names":["define","lang","array","event","windowUtils","focus","registry","_TextBoxMixin","ValidationTextBox","_HasDropDown","FilePicker","template","declare","keys","baseClass","templateString","searchDelay","valueItem","numPanes","postMixInProperties","this","inherited","arguments","dropDown","constraints","postCreate","connect","_onWidgetChange","focusNode","selectInputText","_setValueAttr","value","priorityChange","fromWidget","_searchInProgress","get","_skip","fx","hitch","_setPathValueAttr","_settingBlurValue","item","_hasValidPath","_getPathValueAttr","undefined","validate","startup","_started","openDropDown","domNode","style","width","set","offsetWidth","toggleDropDown","_opened","_focusBlur","e","explicitOriginalTarget","_allowBlur","_menuFocus","_updateClass","Hover","window","setTimeout","_focusFocus","curNode","byNode","_onBlur","_savedFocus","_setBlurValue","parse","_hasSelection","dd","topDir","sep","pathSeparator","ddVal","norm","v","length","indexOf","substring","_startSearchFromInput","fn","val","oVal","dirs","split","setFromChain","idx","conn","dir","child","getChildren","_cleanup","disconnect","children","_menu","exact","filter","i","label","first","onItemClick","type","stopPropagation","preventDefault","_setSelected","_setInProgress","_removeAfter","targetString","scrollIntoView","Focus","isLoaded","_onKey","disabled","readOnly","c","charOrCode","DOWN_ARROW","ENTER","onExecute","stop","RIGHT_ARROW","LEFT_ARROW","TAB","doSearch","BACKSPACE","DELETE","keyChar","_searchTimer","clearTimeout"],"mappings":"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","file":"../../form/FilePickerTextBox.js","sourcesContent":["define([\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/window\",\r\n\t\"dijit/focus\",\r\n\t\"dijit/registry\",\r\n\t\"dijit/form/_TextBoxMixin\",\r\n\t\"dijit/form/ValidationTextBox\",\r\n\t\"dijit/_HasDropDown\",\r\n\t\"dojox/widget/FilePicker\",\r\n\t\"dojo/text!./resources/FilePickerTextBox.html\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/keys\" // keys\r\n], function(lang, array, event, windowUtils, focus, registry, _TextBoxMixin, ValidationTextBox, _HasDropDown, FilePicker, template, declare, keys){\r\n\r\n\treturn declare( \"dojox.form.FilePickerTextBox\", [ValidationTextBox, _HasDropDown], {\r\n\t\t// summary:\r\n\t\t//\t\tA validating text box tied to a file picker popup\r\n\r\n\t\tbaseClass: \"dojoxFilePickerTextBox\",\r\n\r\n\t\ttemplateString: template,\r\n\r\n\t\t// searchDelay: Integer\r\n\t\t//\t\tDelay in milliseconds between when user types something and we start\r\n\t\t//\t\tsearching based on that value\r\n\t\tsearchDelay: 500,\r\n\r\n\t\t// valueItem: item\r\n\t\t//\t\tThe item, in our store, of the directory relating to our value\r\n\t\tvalueItem: null,\r\n\r\n\t\t// numPanes: number\r\n\t\t//\t\tThe number of panes to display in our box (if we don't have any\r\n\t\t//\t\tminPaneWidth specified by our constraints)\r\n\t\tnumPanes: 2.25,\r\n\r\n\t\tpostMixInProperties: function(){\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\tthis.dropDown = new FilePicker(this.constraints);\r\n\t\t},\r\n\r\n\t\tpostCreate: function(){\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\t// Make our connections we want\r\n\t\t\tthis.connect(this.dropDown, \"onChange\", this._onWidgetChange);\r\n\t\t\tthis.connect(this.focusNode, \"onblur\", \"_focusBlur\");\r\n\t\t\tthis.connect(this.focusNode, \"onfocus\", \"_focusFocus\");\r\n\t\t\tthis.connect(this.focusNode, \"ondblclick\", function(){\r\n\t\t\t\t_TextBoxMixin.selectInputText(this.focusNode);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_setValueAttr: function(/*String*/ value, priorityChange, fromWidget){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tsets the value of this widget\r\n\t\t\tif(!this._searchInProgress){\r\n\t\t\t\tthis.inherited(arguments);\r\n\t\t\t\tvalue = value || \"\";\r\n\t\t\t\tvar tVal = this.dropDown.get(\"pathValue\") || \"\";\r\n\t\t\t\tif(value !== tVal){\r\n\t\t\t\t\tthis._skip = true;\r\n\t\t\t\t\tvar fx = lang.hitch(this, \"_setBlurValue\");\r\n\t\t\t\t\tthis.dropDown._setPathValueAttr(value, !fromWidget,\r\n\t\t\t\t\t\t\t\t\t\t\tthis._settingBlurValue ? fx : null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onWidgetChange: function(/*item*/ item){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tcalled when the path gets changed in the dropdown\r\n\t\t\tif(!item && this.focusNode.value){\r\n\t\t\t\tthis._hasValidPath = false;\r\n\t\t\t\tthis.focusNode.value = \"\";\r\n\t\t\t}else{\r\n\t\t\t\tthis.valueItem = item;\r\n\t\t\t\tvar value = this.dropDown._getPathValueAttr(item);\r\n\t\t\t\tif(value){\r\n\t\t\t\t\tthis._hasValidPath = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(!this._skip){\r\n\t\t\t\t\tthis._setValueAttr(value, undefined, true);\r\n\t\t\t\t}\r\n\t\t\t\tdelete this._skip;\r\n\t\t\t}\r\n\t\t\tthis.validate();\r\n\t\t},\r\n\r\n\t\tstartup: function(){\r\n\t\t\tif(!this.dropDown._started){\r\n\t\t\t\tthis.dropDown.startup();\r\n\t\t\t}\r\n\t\t\tthis.inherited(arguments);\r\n\t\t},\r\n\r\n\t\topenDropDown: function(){\r\n\t\t\t// set width to 0 so that it will resize automatically\r\n\t\t\tthis.dropDown.domNode.style.width=\"0px\";\r\n\t\t\tif(!(\"minPaneWidth\" in (this.constraints||{}))){\r\n\t\t\t\tthis.dropDown.set(\"minPaneWidth\", (this.domNode.offsetWidth / this.numPanes));\r\n\t\t\t}\r\n\t\t\tthis.inherited(arguments);\r\n\t\t},\r\n\r\n\t\ttoggleDropDown: function(){\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\t// Make sure our display is up-to-date with our value\r\n\t\t\tif(this._opened){\r\n\t\t\t\tthis.dropDown.set(\"pathValue\", this.get(\"value\"));\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_focusBlur: function(/*Event*/ e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tcalled when the focus node gets blurred\r\n\t\t\tif(e.explicitOriginalTarget == this.focusNode && !this._allowBlur){\r\n\t\t\t\twindow.setTimeout(lang.hitch(this, function(){\r\n\t\t\t\t\tif(!this._allowBlur){\r\n\t\t\t\t\t\tthis.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}), 1);\r\n\t\t\t}else if(this._menuFocus){\r\n\t\t\t\tthis.dropDown._updateClass(this._menuFocus, \"Item\", {\"Hover\": false});\r\n\t\t\t\tdelete this._menuFocus;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_focusFocus: function(/*Event*/ e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tcalled when the focus node gets focus\r\n\t\t\tif(this._menuFocus){\r\n\t\t\t\tthis.dropDown._updateClass(this._menuFocus, \"Item\", {\"Hover\": false});\r\n\t\t\t}\r\n\t\t\tdelete this._menuFocus;\r\n\t\t\tvar focusNode = focus.curNode;\r\n\t\t\tif(focusNode){\r\n\t\t\t\tfocusNode = registry.byNode(focusNode);\r\n\t\t\t\tif(focusNode){\r\n\t\t\t\t\tthis._menuFocus = focusNode.domNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this._menuFocus){\r\n\t\t\t\tthis.dropDown._updateClass(this._menuFocus, \"Item\", {\"Hover\": true});\r\n\t\t\t}\r\n\t\t\tdelete this._allowBlur;\r\n\t\t},\r\n\r\n\t\t_onBlur: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tcalled when focus is shifted away from this widget\r\n\t\t\tthis._allowBlur = true;\r\n\t\t\tdelete this.dropDown._savedFocus;\r\n\t\t\tthis.inherited(arguments);\r\n\t\t},\r\n\r\n\t\t_setBlurValue: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tsets the value of the widget once focus has left\r\n\t\t\tif(this.dropDown && !this._settingBlurValue){\r\n\t\t\t\tthis._settingBlurValue = true;\r\n\t\t\t\tthis.set(\"value\", this.focusNode.value);\r\n\t\t\t}else{\r\n\t\t\t\tdelete this._settingBlurValue;\r\n\t\t\t\tthis.inherited(arguments);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tparse: function(/*String*/ value, /*Object*/ constraints){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to convert a formatted string to a value - we use\r\n\t\t\t//\t\tit to verify that it *really* is a valid value\r\n\t\t\tif(this._hasValidPath || this._hasSelection){\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\tvar dd = this.dropDown, topDir = dd.topDir, sep = dd.pathSeparator;\r\n\t\t\tvar ddVal = dd.get(\"pathValue\");\r\n\t\t\tvar norm = function(v){\r\n\t\t\t\tif(topDir.length && v.indexOf(topDir) === 0){\r\n\t\t\t\t\tv = v.substring(topDir.length);\r\n\t\t\t\t}\r\n\t\t\t\tif(sep && v[v.length - 1] == sep){\r\n\t\t\t\t\tv = v.substring(0, v.length - 1);\r\n\t\t\t\t}\r\n\t\t\t\treturn v;\r\n\t\t\t};\r\n\t\t\tddVal = norm(ddVal);\r\n\t\t\tvar val = norm(value);\r\n\t\t\tif(val == ddVal){\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t},\r\n\r\n\t\t_startSearchFromInput: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tkicks off a search based off the current text value of the widget\r\n\t\t\tvar dd = this.dropDown, fn = this.focusNode;\r\n\t\t\tvar val = fn.value, oVal = val, topDir = dd.topDir;\r\n\t\t\tif(this._hasSelection){\r\n\t\t\t\t_TextBoxMixin.selectInputText(fn, oVal.length);\r\n\t\t\t}\r\n\t\t\tthis._hasSelection = false;\r\n\t\t\tif(topDir.length && val.indexOf(topDir) === 0){\r\n\t\t\t\tval = val.substring(topDir.length);\r\n\t\t\t}\r\n\t\t\tvar dirs = val.split(dd.pathSeparator);\r\n\t\t\tvar setFromChain = lang.hitch(this, function(idx){\r\n\t\t\t\tvar dir = dirs[idx];\r\n\t\t\t\tvar child = dd.getChildren()[idx];\r\n\t\t\t\tvar conn;\r\n\t\t\t\tthis._searchInProgress = true;\r\n\t\t\t\tvar _cleanup = lang.hitch(this, function(){\r\n\t\t\t\t\tdelete this._searchInProgress;\r\n\t\t\t\t});\r\n\t\t\t\tif((dir || child) && !this._opened){\r\n\t\t\t\t\tthis.toggleDropDown();\r\n\t\t\t\t}\r\n\t\t\t\tif(dir && child){\r\n\t\t\t\t\tvar fx = lang.hitch(this, function(){\r\n\t\t\t\t\t\tif(conn){\r\n\t\t\t\t\t\t\tthis.disconnect(conn);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdelete conn;\r\n\t\t\t\t\t\tvar children = child._menu.getChildren();\r\n\t\t\t\t\t\tvar exact = array.filter(children, function(i){\r\n\t\t\t\t\t\t\treturn i.label == dir;\r\n\t\t\t\t\t\t})[0];\r\n\t\t\t\t\t\tvar first = array.filter(children, function(i){\r\n\t\t\t\t\t\t\treturn (i.label.indexOf(dir) === 0);\r\n\t\t\t\t\t\t})[0];\r\n\t\t\t\t\t\tif(exact &&\r\n\t\t\t\t\t\t\t((dirs.length > idx + 1 && exact.children) ||\r\n\t\t\t\t\t\t\t(!exact.children))){\r\n\t\t\t\t\t\t\tidx++;\r\n\t\t\t\t\t\t\tchild._menu.onItemClick(exact, {type: \"internal\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstopPropagation: function(){},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpreventDefault: function(){}});\r\n\t\t\t\t\t\t\tif(dirs[idx]){\r\n\t\t\t\t\t\t\t\tsetFromChain(idx);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t_cleanup();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tchild._setSelected(null);\r\n\t\t\t\t\t\t\tif(first && dirs.length === idx + 1){\r\n\t\t\t\t\t\t\t\tdd._setInProgress = true;\r\n\t\t\t\t\t\t\t\tdd._removeAfter(child);\r\n\t\t\t\t\t\t\t\tdelete dd._setInProgress;\r\n\t\t\t\t\t\t\t\tvar targetString = first.label;\r\n\t\t\t\t\t\t\t\tif(first.children){\r\n\t\t\t\t\t\t\t\t\ttargetString += dd.pathSeparator;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\ttargetString = targetString.substring(dir.length);\r\n\t\t\t\t\t\t\t\twindow.setTimeout(function(){\r\n\t\t\t\t\t\t\t\t\twindowUtils.scrollIntoView(first.domNode);\r\n\t\t\t\t\t\t\t\t}, 1);\r\n\t\t\t\t\t\t\t\tfn.value = oVal + targetString;\r\n\t\t\t\t\t\t\t\t_TextBoxMixin.selectInputText(fn, oVal.length);\r\n\t\t\t\t\t\t\t\tthis._hasSelection = true;\r\n\t\t\t\t\t\t\t\ttry{first.focusNode.focus();}catch(e){}\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tif(this._menuFocus){\r\n\t\t\t\t\t\t\t\t\tthis.dropDown._updateClass(this._menuFocus, \"Item\", {\"Hover\": false, \"Focus\": false});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tdelete this._menuFocus;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t_cleanup();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif(!child.isLoaded){\r\n\t\t\t\t\t\tconn = this.connect(child, \"onLoad\", fx);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tfx();\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(child){\r\n\t\t\t\t\t\tchild._setSelected(null);\r\n\t\t\t\t\t\tdd._setInProgress = true;\r\n\t\t\t\t\t\tdd._removeAfter(child);\r\n\t\t\t\t\t\tdelete dd._setInProgress;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_cleanup();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tsetFromChain(0);\r\n\t\t},\r\n\r\n\t\t_onKey: function(/*Event*/ e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tcallback when the user presses a key on menu popup node\r\n\t\t\tif(this.disabled || this.readOnly){ return; }\r\n\t\t\tvar c = e.charOrCode;\r\n\t\t\tif(c==keys.DOWN_ARROW){\r\n\t\t\t\tthis._allowBlur = true;\r\n\t\t\t}\r\n\t\t\tif(c==keys.ENTER && this._opened){\r\n\t\t\t\tthis.dropDown.onExecute();\r\n\t\t\t\t_TextBoxMixin.selectInputText(this.focusNode, this.focusNode.value.length);\r\n\t\t\t\tthis._hasSelection = false;\r\n\t\t\t\tevent.stop(e);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif((c==keys.RIGHT_ARROW || c==keys.LEFT_ARROW || c==keys.TAB) && this._hasSelection){\r\n\t\t\t\tthis._startSearchFromInput();\r\n\t\t\t\tevent.stop(e);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\tvar doSearch = false;\r\n\t\t\tif((c==keys.BACKSPACE || c==keys.DELETE) && this._hasSelection){\r\n\t\t\t\tthis._hasSelection = false;\r\n\t\t\t}else if(c==keys.BACKSPACE || c==keys.DELETE || c==\" \"){\r\n\t\t\t\tdoSearch = true;\r\n\t\t\t}else{\r\n\t\t\t\tdoSearch = e.keyChar !== \"\";\r\n\t\t\t}\r\n\t\t\tif(this._searchTimer){\r\n\t\t\t\twindow.clearTimeout(this._searchTimer);\r\n\t\t\t}\r\n\t\t\tdelete this._searchTimer;\r\n\t\t\tif(doSearch){\r\n\t\t\t\tthis._hasValidPath = false;\r\n\t\t\t\tthis._hasSelection = false;\r\n\t\t\t\tthis._searchTimer = window.setTimeout(lang.hitch(this, \"_startSearchFromInput\"), this.searchDelay + 1);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n});"]}