{"version":3,"sources":["form/FileUploader.js"],"names":["define","kernel","declare","lang","array","connect","win","has","query","dom","domStyle","domGeometry","domAttr","domClass","domConstruct","domForm","config","manager","ioIframe","Color","unloadUtils","Widget","TemplatedMixin","Contained","embedFlash","embedFlashVars","htmlStyles","deprecated","swfPath","uploaderPath","require","toUrl","templateString","uploadUrl","isDebug","devMode","baseClass","hoverClass","activeClass","disabledClass","force","uploaderType","flashObject","flashMovie","insideNode","deferredUploading","fileListId","uploadOnChange","selectMultipleFiles","htmlFieldName","flashFieldName","fileMask","minFlashVersion","tabIndex","showProgress","progressMessage","progressBackgroundUrl","progressBackgroundColor","progressWidgetId","skipServerCheck","serverTimeout","log","this","console","Array","prototype","slice","call","arguments","join","constructor","_subs","postMixInProperties","fileList","_cons","fileInputs","fileCount","flashReady","_disabled","toLowerCase","available","_refNode","srcNodeRef","getButtonStyle","startup","postCreate","createMethod","inherited","setButtonStyle","byId","evt","p","target","parentNode","id","indexOf","removeFile","split","addOnUnload","destroy","getHiddenNode","node","hidden","tagName","get","refNode","_hiddenNode","set","button","domNode","isDijitButton","cls","className","txt","getText","domTxt","place","pressClass","norm","getStyle","width","w","height","h","over","getTempNodeStyle","down","dsbl","fhtml","cn","nr","ov","dn","ds","va","lh","padding","lineHeight","position","progTextNode","innerHTML","margin","left","progNode","display","backgroundImage","backgroundPosition","backgroundRepeat","backgroundColor","top","add","d","e","removeChild","body","appendChild","c","disconnect","document","createTextNode","onChange","dataArray","onProgress","onComplete","onCancel","onError","evtObject","onReady","uploader","onLoad","submit","form","data","toObject","upload","length","warn","restoreProgDisplay","postData","i","f","bytesLoaded","bytesTotal","size","percent","uploadFlash","uploadHTML","name","noListEdit","splice","_renumberInputs","forEach","unsubscribe","dojo","scrollConnect","_fileInput","_formNode","push","_displayProgress","_animateProgress","_uploadDone","interval","setInterval","hitch","clearInterval","setTimeout","_error","Error","_addToFileList","str","Math","ceil","_change","concat","_buildFileInput","_connectInput","_complete","isArray","ERROR","_progress","_resetHTML","dataObject","total","loaded","update","progress","_getDisabledAttr","_setDisabledAttr","disabled","_fc","doDisable","toggle","_onFlashBlur","blur","nextFocusObject","nodes","Number","focus","_disconnect","_setHtmlPostData","send","url","toString","handleAs","error","err","message","load","ioArgs","widgetRef","createHtmlUploader","_buildForm","_setFormStyle","_styleContent","onMouseOver","remove","onMouseOut","_checkHtmlCancel","onMouseDown","onMouseUp","onClick","value","type","mouseType","dialogIsOpen","o","textAlign","ta","paddingTop","paddingRight","paddingBottom","paddingLeft","n","createElement","encoding","getUniqueId","create","enctype","method","nm","real","getMarginBox","opacity","inp","max","insertCssRule","overflow","doUpload","createFlashUploader","loc","window","location","href","pop","args","expressInstall","path","uri","allowScriptAccess","allowNetworking","vars","uploadDataFieldName","uploadOnSelect","flashButton","serialize","noReturnCheck","params","scale","wmode","msg","mov","_connectFlash","_doSub","doFocus","subStr","funcStr","subscribe","urlencode","replace","isButton","tn","getTextStyle","ff","fw","fi","fs","parseInt","fc","toHex","substring","Infinity","trim","escape","dim","getContentBox","pad","getPadExtents","t","l","clr","bc","a","bi","rp","pos","rx","ry","mixin","_class","temp","style","first","firstChild"],"mappings":"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","file":"../../form/FileUploader.js","sourcesContent":["define([\r\n\t\"dojo/_base/kernel\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/_base/sniff\",\r\n\t\"dojo/query\",\r\n\t\"dojo/dom\",\r\n\t\"dojo/dom-style\",\r\n\t\"dojo/dom-geometry\",\r\n\t\"dojo/dom-attr\",\r\n\t\"dojo/dom-class\",\r\n\t\"dojo/dom-construct\",\r\n\t\"dojo/dom-form\",\r\n\t\"dojo/_base/config\",\r\n\t\"dijit/_base/manager\",\r\n\t\"dojo/io/iframe\",\r\n\t\"dojo/_base/Color\",\r\n\t\"dojo/_base/unload\",\r\n\t\"dijit/_Widget\",\r\n\t\"dijit/_TemplatedMixin\",\r\n\t\"dijit/_Contained\",\r\n\t\"dojox/embed/Flash\",\r\n\t\"dojox/embed/flashVars\",\r\n\t\"dojox/html/styles\"\r\n],function(kernel, declare, lang, array, connect, win, has, query, dom, domStyle, domGeometry, domAttr, domClass, domConstruct, domForm, config, manager, ioIframe, Color, unloadUtils, Widget, TemplatedMixin, Contained, embedFlash, embedFlashVars, htmlStyles){\r\n\r\nkernel.deprecated(\"dojox.form.FileUploader\", \"Use dojox.form.Uploader\", \"2.0\");\r\n\r\n\t//\tUsage Notes:\r\n\t//\t\tTo center text vertically, use vertical-align:middle;\r\n\t//\t\twhich emulates a boxModel button. Using line-height to center text\r\n\t//\t\tcan cause height problems in IE6\r\n\r\nreturn declare(\"dojox.form.FileUploader\", [Widget, TemplatedMixin, Contained], {\r\n\t// version:\r\n\t//\t\t1.5 (deprecated)\r\n\t// summary:\r\n\t//\t\tHandles File Uploading to a server (PHP script included for testing)\r\n\t//\r\n\t//\t\tFileUploader is now a WIDGET. You do not have to pass a button\r\n\t//\t\tin. Passing a button is still supported until version 1.5 to maintain\r\n\t//\t\tbackwards compatibility, but it is not recommended. Just create your\r\n\t//\t\tuploader like any other widget.\r\n\t// description:\r\n\t//\t\tIf the correct version of Flash Player is available (> 9.0) , a SWF\r\n\t//\t\tis used. If Flash Player is not installed or is outdated, a typical\r\n\t//\t\thtml fileInput is used. This process can be overridden with\r\n\t//\t\tforce:\"flash\" or force:\"html\".\r\n\t//\r\n\t//\t\tFileUploader works with Flash 10.\r\n\t//\r\n\t//\t\tThe button styles are now recreated in Flash, so there is no longer\r\n\t//\t\tusing an invisible Flash movie with wmode=transparent. This way the Flash button\r\n\t//\t\tis actually placed inline with the DOM, not floating above it and constantly\r\n\t//\t\tresetting its position. The \"Windows Firefox clickable bug\" should be fixed (and\r\n\t//\t\thopefully some Linux problems).\r\n\t//\r\n\t//\t\tThe HTML button is created in a new way and it is now inline as is the\r\n\t//\t\tFLash button. Styling is much easier and more versatile.\r\n\t//\r\n\t//\t\t###Dependencies\r\n\t//\r\n\t//\t\tFileUploader no longer uses FileInput.css. It now uses FileUploader.css\r\n\t//\t\tSee requires for JavaScript dependencies.\r\n\t//\r\n\t//\t\t###NEW FEATURES\r\n\t//\r\n\t//\t\tThere are a ton of features and fixes in this version:\r\n\t//\r\n\t//\t\t- Disabled: Can be toggled with widget.set(\"disabled\", true|false)\r\n\t//\t\t- Submit: A convenience method has been added for if the uploader is in a form.\r\n\t//\t\t\tInstead of submitting the form, call uploader.submit(theForm), and the\r\n\t//\t\t\tUploader will handle all of the form values and post the data.\r\n\t//\t\t- Selected List: If passing the ID of a container, the Uploaders will populate it\r\n\t//\t\t\twith the selected files.\r\n\t//\t\t- Deleting Files: You can now delete pending files.\r\n\t//\t\t- Progress Built in: showProgress:true will change the button to a progress\r\n\t//\t\t\tbar on upload.\r\n\t//\t\t- Progress Attach: Passing progressWidgetId will tell the Uploader of a progress\r\n\t//\t\t\twidget. If the Progress widget is initially hidden, it will change to\r\n\t//\t\t\tvisible and then restored after upload.\r\n\t//\t\t- A11Y: The Flash button can be accessed with the TAB key. (The HTML cannot due\r\n\t//\t\t\tto browser limitations)\r\n\t//\t\t- Deferred Uploading: (Flash only) throttles the upload to one file at a time\r\n\t//\r\n\t//\t\t###CDN USERS\r\n\t//\r\n\t//\t\tFileUpload now works with the CDN but with limitations. The SWF must\r\n\t//\t\tbe from the same domain as the HTML page. 'swfPath' has been exposed\r\n\t//\t\tso that you may link to that file (could of course be the same SWF in\r\n\t//\t\tdojox resource folder). The SWF will *NOT* work from the\r\n\t//\t\tCDN server. This would require a special XML file that would allow\r\n\t//\t\taccess to your server, and the logistics to that is impossible.\r\n\t//\r\n\t//\t\t###LIMITATIONS\r\n\t//\r\n\t//\t\t- This is not designed to be a part of a form, it contains its own. (See submit())\r\n\t//\t\t- Currently does not in a Dialog box or a Tab where it is not initially visible,\r\n\t//\t\t- The default style inherits font sizes - but a parent container should have a font size\r\n\t//\t\t\tset somewhere of the results could be inconsistent.\r\n\t//\r\n\t//\t\t###OPERA USERS\r\n\t//\r\n\t//\t\tIt works better than the 1.3 version. fileInputs apperantly can't have opacity\r\n\t//\t\tset to zero. The Flash uploader works but files are auto-uploaded. Must be a\r\n\t//\t\tflashVar problem.\r\n\t//\r\n\t//\t\t###Safari Bug note:\r\n\t//\r\n\t//\t\tThe bug is in the way Safari handles the connection:\r\n\t//\t\thttps://bugs.webkit.org/show_bug.cgi?id=5760\r\n\t//\t\tI added this to the virtual host in the Apache conf file, and now it\r\n\t//\t\tworks like a charm:\r\n\t//\t|\tBrowserMatch Safari nokeepalive\r\n\r\n\tswfPath: config.uploaderPath || require.toUrl(\"dojox/form/resources/fileuploader.swf\"),\r\n\r\n\r\n\ttemplateString:'<div><div dojoAttachPoint=\"progNode\"><div dojoAttachPoint=\"progTextNode\"></div></div><div dojoAttachPoint=\"insideNode\" class=\"uploaderInsideNode\"></div></div>',\r\n\r\n\t// uploadUrl: String\r\n\t//\t\tThe url targeted for upload. An absolute URL is preferred. Relative URLs are\r\n\t//\t\tchanged to absolute.\r\n\tuploadUrl: \"\",\r\n\r\n\t// isDebug: Boolean\r\n\t//\t\tIf true, outputs traces from the SWF to console. What exactly gets passed\r\n\t//\t\tis very relative, and depends upon what traces have been left in the DEFT SWF.\r\n\tisDebug:false,\r\n\r\n\t// devMode: Boolean\r\n\t//\t\tRe-implemented. devMode increases the logging, adding style tracing from the SWF.\r\n\tdevMode:false,\r\n\r\n\t/*=====\r\n\t// id: String\r\n\t//\t\tThe object id, just like any other widget in Dojo. However, this id\r\n\t//\t\tis also used as a reference for the SWF\r\n\tid: \"\",\r\n\t=====*/\r\n\r\n\t// baseClass: String\r\n\t//\t\tThe name of the class that will style the button in a \"normal\" state.\r\n\t//\t\tIf baseClass is not defined, 'class' will be used.\r\n\t//\t\tNOTE: By default the uploader will be styled like a dijit buttons and\r\n\t//\t\tadhere to the the themes. Tundra, Soria, and Nihilo are supported.\r\n\t//\t\tYou can cascade the existing style by using 'class' or 'style'. If you\r\n\t//\t\toverwrite baseClass, you should overwrite the remaing state classes\r\n\t//\t\tthat follow) as well.\r\n\tbaseClass:\"dojoxUploaderNorm\",\r\n\r\n\t// hoverClass: String\r\n\t//\t\tThe name of the class that will style the button in a \"hover\" state. A specific\r\n\t//\t\tclass should be made to do this. Do not rely on a target like button:hover{...}\r\n\thoverClass:\"dojoxUploaderHover\",\r\n\r\n\t// activeClass: String\r\n\t//\t\tThe name of the class that will style the button in a \"press\" state. A specific\r\n\t//\t\tclass should be made to do this. Do not rely on a target like button:active{...}\r\n\tactiveClass:\"dojoxUploaderActive\",\r\n\r\n\t// disabledClass: String\r\n\t//\t\tThe name of the class that will style the button when its disabled.\r\n\tdisabledClass:\"dojoxUploaderDisabled\",\r\n\r\n\t// force: String\r\n\t//\t\tUse \"flash\" to always use Flash (and hopefully force the user to download the plugin\r\n\t//\t\tif they don't have it). Use \"html\" to always use the HTML uploader. An empty string\r\n\t//\t\t(default) will check for the right version of Flash and use HTML if not available.\r\n\tforce:\"\",\r\n\r\n\t// uploaderType: [readonly] String\r\n\t//\t\tInternal. What type of uploader is being used: \"flash\" or \"html\"\r\n\tuploaderType:\"\",\r\n\r\n\t// flashObject: [readonly] dojox.embed.Flash\r\n\t//\t\tThe object that creates the SWF embed object. Mostly Internal.\r\n\tflashObject: null,\r\n\r\n\t// flashMovie: [readonly] Function\r\n\t//\t\tThe SWF. Mostly Internal.\r\n\tflashMovie: null,\r\n\r\n\t// insideNode: [readonly] HTMLNode\r\n\t//\t\tThe div that holds the SWF and form/fileInput\r\n\tinsideNode: null,\r\n\r\n\t// deferredUploading: Number (1 - X)\r\n\t//\t\t(Flash only) throttles the upload to a certain amount of files at a time.\r\n\t//\t\tBy default, Flash uploads file one at a time to the server, but in parallel.\r\n\t//\t\tFirefox will try to queue all files at once, leading to problems. Set this\r\n\t//\t\tto the amount to upload in parallel at a time.\r\n\t//\t\tGenerally, 1 should work fine, but you can experiment with queuing more than\r\n\t//\t\tone at a time.\r\n\t//\t\tThis is of course ignored if selectMultipleFiles equals false.\r\n\tdeferredUploading: 1,\r\n\r\n\t// fileListId: String\r\n\t//\t\tThe id of a dom node to be used as a container for the pending file list.\r\n\tfileListId:\"\",\r\n\r\n\t// uploadOnChange: Boolean\r\n\t//\t\tIf true, uploads immediately after a file has been selected. If false,\r\n\t//\t\twaits for upload() to be called.\r\n\tuploadOnChange: false,\r\n\r\n\t// selectMultipleFiles: Boolean\r\n\t//\t\tIf true and flash mode, multiple files may be selected from the dialog.\r\n\t//\t\tIf html mode, files are not uploaded until upload() is called. The references\r\n\t//\t\tto each file is incremented:uploadedfile0, uploadedfile1, uploadedfile2... etc.\r\n\tselectMultipleFiles: true,\r\n\r\n\t// htmlFieldName: String\r\n\t//\t\tThe name of the field of the fileInput that the server is expecting\r\n\thtmlFieldName:\"uploadedfile\",\r\n\r\n\t// flashFieldName: String\r\n\t//\t\tThe name of the field of the flash uploaded files that the server is expecting\r\n\tflashFieldName:\"flashUploadFiles\",\r\n\r\n\t// fileMask:  Array[ Array[Description, FileTypes], Array[...]...]\r\n\t//\t\t(an array, or an array of arrays)\r\n\t//\t\tRestrict file selection to certain file types\r\n\t//\t\tEmpty array defaults to \"All Files\"\r\n\t//\r\n\t//\t\texample:\r\n\t//\r\n\t//\t|\tfileMask = [\"Images\", \"*.jpg;*.jpeg;*.gif;*.png\"]\r\n\t//\t\tor\r\n\t//\t|\tfileMask = [\r\n\t//\t|\t\t[\"Jpeg File\", \t\"*.jpg;*.jpeg\"],\r\n\t//\t|\t\t[\"GIF File\", \t\"*.gif\"],\r\n\t//\t|\t\t[\"PNG File\", \t\"*.png\"],\r\n\t//\t|\t\t[\"All Images\", \t\"*.jpg;*.jpeg;*.gif;*.png\"],\r\n\t//\t|\t]\r\n\t//\r\n\t//\t\tNOTE: MacType is not supported, as it does not work very well.\r\n\t//\t\tfileMask will work on a Mac, but differently than\r\n\t//\t\tWindows.\r\n\tfileMask: null,\r\n\r\n\t// minFlashVersion: Number\r\n\t//\t\tThe minimum of version of Flash player to target. 0 would always install Flash, 100\r\n\t//\t\twould never install it. The Flash Player has supported multiple uploads since\r\n\t//\t\tversion 8, so it could go as low as that safely.\r\n\tminFlashVersion:9,\r\n\r\n\t// tabIndex: Number|String\r\n\t//\t\tThe tab order in the DOM. Only supported by Flash. HTML Uploaders have security\r\n\t//\t\tprotection to prevent you from tabbing to the uploader. Stupid.\r\n\ttabIndex:-1,\r\n\r\n\t// showProgress: Boolean\r\n\t//\t\tIf true, the button changes to a progress bar during upload.\r\n\tshowProgress:false,\r\n\r\n\t// progressMessage: String\r\n\t//\t\tThe message shown while the button is changed to a progress bar\r\n\tprogressMessage:\"Loading\",\r\n\r\n\t// progressBackgroundUrl: String|Uri\r\n\t//\t\tThe background image to use for the button-progress\r\n\tprogressBackgroundUrl:require.toUrl(\"dijit/themes/tundra/images/buttonActive.png\"),\r\n\r\n\t// progressBackgroundColor: String|Number\r\n\t//\t\tThe background color to use for the button-progress\r\n\tprogressBackgroundColor:\"#ededed\",\r\n\r\n\t// progressWidgetId:String\r\n\t//\t\tThe widget id of a Dijit Progress bar. The Uploader will bind to it and update it\r\n\t//\t\tautomatically.\r\n\tprogressWidgetId:\"\",\r\n\r\n\t// skipServerCheck: Boolean\r\n\t//\t\tIf true, will not verify that the server was sent the correct format.\r\n\t//\t\tThis can be safely set to true. The purpose of the server side check\r\n\t//\t\tis mainly to show the dev if they've implemented the different returns\r\n\t//\t\tcorrectly.\r\n\tskipServerCheck:false,\r\n\r\n\t// serverTimeout:Number (milliseconds)\r\n\t//\t\tThe amount of time given to the uploaded file\r\n\t//\t\tto wait for a server response. After this amount\r\n\t//\t\tof time, the onComplete is fired but with a 'server timeout'\r\n\t//\t\terror in the returned item.\r\n\tserverTimeout: 5000,\r\n\r\n\r\n\tlog: function(){\r\n\t\t// summary:\r\n\t\t//\t\tDue to the excessive logging necessary to make this code happen,\r\n\t\t//\t\tIt's easier to turn it on and off here in one place.\r\n\t\t//\t\tAlso helpful if there are multiple uploaders on one page.\r\n\t\tif(this.isDebug){\r\n\t\t\tconsole[\"log\"](Array.prototype.slice.call(arguments).join(\" \"));\r\n\t\t}\r\n\t},\r\n\r\n\tconstructor: function(){\r\n\t\tthis._subs = [];\r\n\t},\r\n\r\n\tpostMixInProperties: function(){\r\n\t\t// internal stuff:\r\n\t\tthis.fileList = [];\r\n\t\tthis._cons = [];\r\n\t\tthis.fileMask = this.fileMask || [];\r\n\t\tthis.fileInputs = [];\r\n\t\tthis.fileCount = 0;\r\n\t\tthis.flashReady = false;\r\n\t\tthis._disabled = false;\r\n\t\tthis.force = this.force.toLowerCase(); // Pete FTW.\r\n\t\tthis.uploaderType = ((embedFlash.available >= this.minFlashVersion || this.force==\"flash\") && this.force != \"html\") ? \"flash\" : \"html\";\r\n\t\tthis.deferredUploading = this.deferredUploading===true ? 1 : this.deferredUploading;\r\n\r\n\t\tthis._refNode = this.srcNodeRef;\r\n\r\n\t\tthis.getButtonStyle();\r\n\t},\r\n\r\n\tstartup: function(){\r\n\t},\r\n\r\n\tpostCreate: function(){\r\n\t\tthis.inherited(arguments);\r\n\r\n\t\t// internal stuff:\r\n\t\tthis.setButtonStyle();\r\n\t\tvar createMethod;\r\n\t\tif(this.uploaderType == \"flash\"){\r\n\t\t\tcreateMethod = \"createFlashUploader\";\r\n\t\t}else{\r\n\t\t\tthis.uploaderType = \"html\";\r\n\t\t\tcreateMethod = \"createHtmlUploader\";\r\n\r\n\t\t}\r\n\r\n\t\tthis[createMethod]();\r\n\r\n\t\tif(this.fileListId){\r\n\t\t\tthis.connect(dom.byId(this.fileListId), \"click\", function(evt){\r\n\t\t\t\tvar p = evt.target.parentNode.parentNode.parentNode; // in a table\r\n\t\t\t\tif(p.id && p.id.indexOf(\"file_\")>-1){\r\n\t\t\t\t\tthis.removeFile(p.id.split(\"file_\")[1]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// cleaning up solves memory leak issues in the HTML version\r\n\t\tunloadUtils.addOnUnload(this, this.destroy);\r\n\t},\r\n\r\n\tgetHiddenNode: function(/*DomNode*/ node){\r\n\t\t// summary:\r\n\t\t//\t\tInternal.\r\n\t\t//\t\tIf a parent node is styled as display:none,\r\n\t\t//\t\treturns that node. This node will be temporarilly\r\n\t\t//\t\tchanged to display:block. Note if the node is in\r\n\t\t//\t\ta widget that has an onShow event, this is\r\n\t\t//\t\toverridden.\r\n\r\n\t\tif(!node){ return null; }\r\n\t\tvar hidden = null;\r\n\t\tvar p = node.parentNode;\r\n\t\twhile(p && p.tagName.toLowerCase() != \"body\"){\r\n\t\t\tvar d = domStyle.get(p, \"display\");\r\n\t\t\tif(d == \"none\"){\r\n\t\t\t\thidden = p;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tp = p.parentNode;\r\n\t\t}\r\n\t\treturn hidden;\r\n\t},\r\n\r\n\tgetButtonStyle: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal.\r\n\t\t//\t\tGet necessary style information from srcRefNode and\r\n\t\t//\t\tassigned styles\r\n\t\t//\r\n\r\n\r\n\t\t// TODO:\r\n\t\t//\t\tTo call this from postCreate....\r\n\t\t//\t\tcould do the style stuff initially, but if hidden they will be bad sizes\r\n\t\t//\t\tcould then redo the sizes\r\n\t\t//\t\talt is to create a genuine button and copy THAT\tinstead of how doing now\r\n\r\n\t\tvar refNode = this.srcNodeRef;\r\n\t\tthis._hiddenNode = this.getHiddenNode(refNode);\r\n\t\tif(this._hiddenNode){\r\n\t\t\tdomStyle.set(this._hiddenNode, \"display\", \"block\");\r\n\t\t}\r\n\r\n\t\tif(!refNode && this.button && this.button.domNode){\r\n\t\t\t// backwards compat for a Dijit button\r\n\t\t\tvar isDijitButton = true;\r\n\t\t\tvar cls = this.button.domNode.className + \" dijitButtonNode\";\r\n\t\t\tvar txt = this.getText(query(\".dijitButtonText\", this.button.domNode)[0]);\r\n\t\t\tvar domTxt = '<button id=\"'+this.button.id+'\" class=\"'+cls+'\">'+txt+'</button>';\r\n\t\t\trefNode = domConstruct.place(domTxt, this.button.domNode, \"after\");\t /// Pete doesn't like this?\r\n\t\t\tthis.srcNodeRef = refNode;\r\n\t\t\tthis.button.destroy();\r\n\r\n\t\t\tthis.baseClass = \"dijitButton\";\r\n\t\t\tthis.hoverClass = \"dijitButtonHover\";\r\n\t\t\tthis.pressClass = \"dijitButtonActive\";\r\n\t\t\tthis.disabledClass = \"dijitButtonDisabled\";\r\n\r\n\t\t}else if(!this.srcNodeRef && this.button){\r\n\t\t\trefNode = this.button;\r\n\t\t}\r\n\r\n\t\tif(domAttr.get(refNode, \"class\")){\r\n\t\t\tthis.baseClass += \" \" + domAttr.get(refNode, \"class\");\r\n\t\t}\r\n\t\tdomAttr.set(refNode, \"class\", this.baseClass);\r\n\r\n\r\n\t\tthis.norm = this.getStyle(refNode);\r\n\t\tthis.width = this.norm.w;\r\n\t\tthis.height = this.norm.h;\r\n\r\n\t\tif(this.uploaderType == \"flash\"){\r\n\r\n\t\t\tthis.over = this.getTempNodeStyle(refNode, this.baseClass+\" \"+this.hoverClass, isDijitButton);\r\n\t\t\tthis.down = this.getTempNodeStyle(refNode, this.baseClass+\" \"+this.activeClass, isDijitButton);\r\n\t\t\tthis.dsbl = this.getTempNodeStyle(refNode, this.baseClass+\" \"+this.disabledClass, isDijitButton);\r\n\r\n\t\t\tthis.fhtml = {\r\n\t\t\t\tcn:this.getText(refNode),\r\n\t\t\t\tnr:this.norm,\r\n\t\t\t\tov:this.over,\r\n\t\t\t\tdn:this.down,\r\n\t\t\t\tds:this.dsbl\r\n\t\t\t};\r\n\t\t}else{\r\n\t\t\tthis.fhtml = {\r\n\t\t\t\tcn:this.getText(refNode),\r\n\t\t\t\tnr:this.norm\r\n\t\t\t}\r\n\t\t\tif(this.norm.va == \"middle\"){\r\n\t\t\t\tthis.norm.lh = this.norm.h;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(this.devMode){\r\n\t\t\tthis.log(\"classes - base:\", this.baseClass, \" hover:\", this.hoverClass, \"active:\", this.activeClass);\r\n\t\t\tthis.log(\"fhtml:\", this.fhtml)\r\n\t\t\tthis.log(\"norm:\", this.norm)\r\n\t\t\tthis.log(\"over:\", this.over)\r\n\t\t\tthis.log(\"down:\", this.down)\r\n\t\t}\r\n\t},\r\n\r\n\tsetButtonStyle: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal.\r\n\t\t//\t\tSet up internal dom nodes for button construction.\r\n\r\n\t\tdomStyle.set(this.domNode, {\r\n\t\t\twidth:this.fhtml.nr.w+\"px\",\r\n\t\t\theight:(this.fhtml.nr.h)+\"px\",\r\n\t\t\tpadding:\"0px\",\r\n\t\t\tlineHeight: \"normal\",\r\n\t\t\tposition:\"relative\"\r\n\t\t});\r\n\t\tif(this.uploaderType == \"html\" && this.norm.va == \"middle\"){\r\n\t\t\tdomStyle.set(this.domNode, \"lineHeight\", this.norm.lh + \"px\");\r\n\t\t}\r\n\t\tif(this.showProgress){\r\n\t\t\tthis.progTextNode.innerHTML = this.progressMessage;\r\n\t\t\tdomStyle.set(this.progTextNode, {\r\n\t\t\t\twidth:this.fhtml.nr.w+\"px\",\r\n\t\t\t\theight:(this.fhtml.nr.h+0)+\"px\",\r\n\t\t\t\tpadding:\"0px\",\r\n\t\t\t\tmargin:\"0px\",\r\n\t\t\t\tleft:\"0px\",\r\n\t\t\t\tlineHeight:(this.fhtml.nr.h+0)+\"px\",\r\n\t\t\t\tposition:\"absolute\"\r\n\t\t\t});\r\n\t\t\tdomStyle.set(this.progNode, {\r\n\t\t\t\twidth:this.fhtml.nr.w+\"px\",\r\n\t\t\t\theight:(this.fhtml.nr.h+0)+\"px\",\r\n\t\t\t\tpadding:\"0px\",\r\n\t\t\t\tmargin:\"0px\",\r\n\t\t\t\tleft:\"0px\",\r\n\t\t\t\tposition:\"absolute\",\r\n\t\t\t\tdisplay:\"none\",\r\n\t\t\t\tbackgroundImage:\"url(\"+this.progressBackgroundUrl+\")\",\r\n\t\t\t\tbackgroundPosition:\"bottom\",\r\n\t\t\t\tbackgroundRepeat:\"repeat-x\",\r\n\t\t\t\tbackgroundColor:this.progressBackgroundColor\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tdomConstruct.destroy(this.progNode);\r\n\t\t}\r\n\t\tdomStyle.set(this.insideNode,{\r\n\t\t\tposition:\"absolute\",\r\n\t\t\ttop:\"0px\",\r\n\t\t\tleft:\"0px\",\r\n\t\t\tdisplay:\"\"\r\n\t\t});\r\n\t\tdomClass.add(this.domNode, this.srcNodeRef.className);\r\n\t\tif(this.fhtml.nr.d.indexOf(\"inline\")>-1){\r\n\t\t\tdomClass.add(this.domNode, \"dijitInline\");\r\n\t\t}\r\n\r\n\t\ttry{\r\n\t\t\tthis.insideNode.innerHTML = this.fhtml.cn;\r\n\t\t}catch(e){\r\n\t\t\t// You have got to be kidding me. IE does us he favor of checking that\r\n\t\t\t// we aren't inserting the improper type of content with innerHTML into\r\n\t\t\t// an inline element. Alert us with an \"Unknown Runtime Error\". You can't\r\n\t\t\t// MAKE this stuff up.\r\n\r\n\t\t\tif(this.uploaderType == \"flash\"){\r\n\t\t\tthis.insideNode = this.insideNode.parentNode.removeChild(this.insideNode);\r\n\t\t\t\twin.body().appendChild(this.insideNode);\r\n\t\t\t\tthis.insideNode.innerHTML = this.fhtml.cn;\r\n\t\t\t\tvar c = connect.connect(this, \"onReady\", this, function(){ connect.disconnect(c);\r\n\t\t\t\t\tthis.insideNode = this.insideNode.parentNode.removeChild(this.insideNode);\r\n\t\t\t\t\tthis.domNode.appendChild(this.insideNode);\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tthis.insideNode.appendChild(document.createTextNode(this.fhtml.cn));\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(this._hiddenNode){\r\n\t\t\tdomStyle.set(this._hiddenNode, \"display\", \"none\");\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/*************************\r\n\t *\t   Public Events\t *\r\n\t *************************/\r\n\r\n\t// The following events are inherited from _Widget and still may be connected:\r\n\t// onClick\r\n\t// onMouseUp\r\n\t// onMouseDown\r\n\t// onMouseOver\r\n\t// onMouseOut\r\n\r\n\tonChange: function(dataArray){\r\n\t\t// summary:\r\n\t\t//\t\tstub to connect\r\n\t\t//\t\tFires when files are selected\r\n\t\t//\t\tEvent is an array of last files selected\r\n\t},\r\n\r\n\tonProgress: function(dataArray){\r\n\t\t// summary:\r\n\t\t//\t\tStub to connect\r\n\t\t//\t\tFires as progress returns from SWF\r\n\t\t//\t\tEvent is an array of all files uploading\r\n\t\t//\t\tCan be connected to for HTML uploader,\r\n\t\t//\t\tbut will not return anything.\r\n\t},\r\n\r\n\tonComplete: function(dataArray){\r\n\t\t// summary:\r\n\t\t//\t\tstub to connect\r\n\t\t//\t\tFires when all files have uploaded\r\n\t\t//\t\tEvent is an array of all files\r\n\t},\r\n\r\n\tonCancel: function(){\r\n\t\t// summary:\r\n\t\t//\t\tStub to connect\r\n\t\t//\t\tFires when dialog box has been closed\r\n\t\t//\t\twithout a file selection\r\n\t},\r\n\r\n\tonError: function(/*Object or String*/ evtObject){\r\n\t\t// summary:\r\n\t\t//\t\tFires on errors\r\n\r\n\t\t// FIXME: Unsure of a standard form for receiving errors\r\n\t},\r\n\r\n\tonReady: function(/*dojox.form.FileUploader*/ uploader){\r\n\t\t// summary:\r\n\t\t//\t\tStub - Fired when embedFlash has created the\r\n\t\t//\t\tFlash object, but it has not necessarilly finished\r\n\t\t//\t\tdownloading, and is ready to be communicated with.\r\n\t},\r\n\r\n\tonLoad: function(/*dojox.form.FileUploader*/ uploader){\r\n\t\t// summary:\r\n\t\t//\t\tStub - SWF has been downloaded 100%.\r\n\t},\r\n\r\n\t/*************************\r\n\t *\t   Public Methods\t *\r\n\t *************************/\r\n\tsubmit: function(/*form node ?*/ form){\r\n\t\t// summary:\r\n\t\t//\t\tIf FileUploader is in a form, and other data should be sent\r\n\t\t//\t\talong with the files, use this instead of form submit.\r\n\r\n\t\tvar data = form ? domForm.toObject(form) : null;\r\n\t\tthis.upload(data);\r\n\t\treturn false; // Boolean\r\n\t},\r\n\tupload: function(/*Object ? */ data){\r\n\t\t// summary:\r\n\t\t//\t\tWhen called, begins file upload\r\n\t\t// data: Object\r\n\t\t//\t\tpostData to be sent to server\r\n\r\n\t\tif(!this.fileList.length){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(!this.uploadUrl){\r\n\t\t\tconsole.warn(\"uploadUrl not provided. Aborting.\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(!this.showProgress){\r\n\t\t\tthis.set(\"disabled\", true);\r\n\t\t}\r\n\r\n\t\tif(this.progressWidgetId){\r\n\r\n\t\t\tvar node = manager.byId(this.progressWidgetId).domNode;\r\n\t\t\tif(domStyle.get(node, \"display\") == \"none\"){\r\n\t\t\t\tthis.restoreProgDisplay = \"none\";\r\n\t\t\t\tdomStyle.set(node, \"display\", \"block\");\r\n\t\t\t}\r\n\t\t\tif(domStyle.get(node, \"visibility\") == \"hidden\"){\r\n\t\t\t\tthis.restoreProgDisplay = \"hidden\";\r\n\t\t\t\tdomStyle.set(node, \"visibility\", \"visible\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(data && !data.target){\r\n\t\t\tthis.postData = data;\r\n\t\t}\r\n\t\tthis.log(\"upload type:\", this.uploaderType, \" - postData:\", this.postData);\r\n\r\n\t\tfor(var i = 0; i < this.fileList.length; i++){\r\n\t\t\tvar f = this.fileList[i];\r\n\t\t\tf.bytesLoaded = 0;\r\n\t\t\tf.bytesTotal = f.size || 100000;\r\n\t\t\tf.percent = 0;\r\n\t\t}\r\n\t\tif(this.uploaderType == \"flash\"){\r\n\t\t\tthis.uploadFlash();\r\n\t\t}else{\r\n\t\t\tthis.uploadHTML();\r\n\t\t}\r\n\t\t// prevent form submit\r\n\t\treturn false;\r\n\t},\r\n\tremoveFile: function(/*String*/ name, /*Boolean*/ noListEdit){\r\n\t\t// summary:\r\n\t\t//\t\tRemoves a file from the pending file list.\r\n\t\t//\t\tRemoves pending data from the Flash movie\r\n\t\t//\t\tand fileInputes from the HTML uploader.\r\n\t\t//\t\tIf a file container node is bound, the file\r\n\t\t//\t\twill also be removed.\r\n\t\t// name: String\r\n\t\t//\t\tThe name of the file to be removed. Typically the file name,\r\n\t\t//\t\tsuch as: picture01.png\r\n\t\t// noListEdit: Boolean\r\n\t\t//\t\tInternal. If true don't remove files from list.\r\n\r\n\t\tvar i;\r\n\t\tfor(i = 0; i < this.fileList.length; i++){\r\n\t\t\tif(this.fileList[i].name == name){\r\n\t\t\t\tif(!noListEdit){ // if onComplete, don't do this\r\n\t\t\t\t\tthis.fileList.splice(i,1);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(this.uploaderType == \"flash\"){\r\n\t\t\tthis.flashMovie.removeFile(name);\r\n\t\t}else if(!noListEdit){\r\n\t\t\tdomConstruct.destroy(this.fileInputs[i]);\r\n\t\t\tthis.fileInputs.splice(i,1);\r\n\t\t\tthis._renumberInputs();\r\n\t\t}\r\n\t\tif(this.fileListId){\r\n\t\t\tdomConstruct.destroy(\"file_\"+name);\r\n\t\t}\r\n\t},\r\n\r\n\tdestroy: function(){\r\n\t\t// summary:\r\n\t\t//\t\tDestroys uploader button\r\n\t\tif(this.uploaderType == \"flash\" && !this.flashMovie){\r\n\t\t\tthis._cons.push(connect.connect(this, \"onLoad\", this, \"destroy\"));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tarray.forEach(this._subs, connect.unsubscribe, dojo);\r\n\t\tarray.forEach(this._cons, connect.disconnect, dojo);\r\n\t\tif(this.scrollConnect){\r\n\t\t\tconnect.disconnect(this.scrollConnect);\r\n\t\t}\r\n\t\tif(this.uploaderType == \"flash\"){\r\n\t\t\tthis.flashObject.destroy();\r\n\t\t\tdelete this.flashObject;\r\n\t\t}else{\r\n\t\t\tdomConstruct.destroy(this._fileInput);\r\n\t\t\tdomConstruct.destroy(this._formNode);\r\n\t\t}\r\n\t\tthis.inherited(arguments);\r\n\t},\r\n\r\n\t/*************************\r\n\t *\t   Private Events\t *\r\n\t *************************/\r\n\t_displayProgress: function(/*Boolean or Number */ display){\r\n\t\t// summary:\r\n\t\t//\t\tShows and updates the built-in progress bar.\r\n\r\n\t\tif(display === true){\r\n\t\t\tif(this.uploaderType == \"flash\"){\r\n\t\t\t\tdomStyle.set(this.insideNode,\"top\", \"-2500px\");\r\n\t\t\t}else{\r\n\t\t\t\tdomStyle.set(this.insideNode,\"display\", \"none\");\r\n\t\t\t}\r\n\t\t\tdomStyle.set(this.progNode,\"display\",\"\");\r\n\t\t}else if(display === false){\r\n\t\t\tdomStyle.set(this.insideNode,{\r\n\t\t\t\tdisplay: \"\",\r\n\t\t\t\ttop: \"0\"\r\n\t\t\t});\r\n\t\t\tdomStyle.set(this.progNode,\"display\",\"none\");\r\n\t\t}else{\r\n\t\t\tvar w = display * this.fhtml.nr.w;\r\n\t\t\tdomStyle.set(this.progNode, \"width\", w + \"px\");\r\n\t\t}\r\n\t},\r\n\t_animateProgress: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. Animated the built-in progress bar\r\n\t\tthis._displayProgress(true);\r\n\t\tvar _uploadDone = false;\r\n\t\tvar c = connect.connect(this, \"_complete\", function(){\r\n\t\t\tconnect.disconnect(c);\r\n\t\t\t_uploadDone = true;\r\n\t\t});\r\n\t\tvar w = 0;\r\n\t\tvar interval = setInterval(lang.hitch(this, function(){\r\n\t\t\tw+=5;\r\n\t\t\tif(w>this.fhtml.nr.w){\r\n\t\t\t\tw = 0;\r\n\t\t\t\t_uploadDone = true;\r\n\t\t\t}\r\n\t\t\tthis._displayProgress(w/this.fhtml.nr.w);\r\n\r\n\t\t\tif(_uploadDone){\r\n\t\t\t\tclearInterval(interval);\r\n\t\t\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\t\t\tthis._displayProgress(false);\r\n\t\t\t\t}), 500);\r\n\t\t\t}\r\n\r\n\t\t}),50);\r\n\t},\r\n\r\n\t_error: function(evt){\r\n\t\t//var type = evtObject.type ? evtObject.type.toUpperCase() : \"ERROR\";\r\n\t\t//var msg = evtObject.msg ? evtObject.msg : evtObject;\r\n\t\tif(typeof(evt)==\"string\"){\r\n\t\t\tevt = new Error(evt);\r\n\t\t}\r\n\t\tthis.onError(evt);\r\n\t},\r\n\r\n\t_addToFileList: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal only. If there is a file list, adds a file to it.\r\n\t\t//\t\tIf you need to use a function such as this, connect to\r\n\t\t//\t\tonChange and update outside of this widget.\r\n\r\n\t\tif(this.fileListId){\r\n\t\t\tvar str = '';\r\n\t\t\tarray.forEach(this.fileList, function(d){\r\n\t\t\t\t// have to use tables because of IE. Grumble.\r\n\t\t\t\tstr += '<table id=\"file_'+d.name+'\" class=\"fileToUpload\"><tr><td class=\"fileToUploadClose\"></td><td class=\"fileToUploadName\">'+d.name+'</td><td class=\"fileToUploadSize\">'+(d.size ? Math.ceil(d.size*.001) +\"kb\" : \"\")+'</td></tr></table>'\r\n\t\t\t}, this);\r\n\t\t\tdom.byId(this.fileListId).innerHTML = str;\r\n\t\t}\r\n\t},\r\n\r\n\t_change: function(dataArray){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. Updates uploader selection\r\n\t\tif(has(\"ie\")){\r\n\t\t\t//IE6 uses the entire path in the name, which isn't terrible, but much different\r\n\t\t\t// than everything else\r\n\t\t\tarray.forEach(dataArray, function(f){\r\n\t\t\t\tf.name = f.name.split(\"\\\\\")[f.name.split(\"\\\\\").length-1];\r\n\t\t\t});\r\n\t\t}\r\n\t\tif(this.selectMultipleFiles){\r\n\t\t\tthis.fileList = this.fileList.concat(dataArray);\r\n\t\t}else{\r\n\t\t\tif(this.fileList[0]){\r\n\t\t\t\tthis.removeFile(this.fileList[0].name, true);\r\n\t\t\t}\r\n\t\t\tthis.fileList = dataArray;\r\n\t\t}\r\n\t\tthis._addToFileList();\r\n\t\tthis.onChange(dataArray);\r\n\t\tif(this.uploadOnChange){\r\n\t\t\tif(this.uploaderType == \"html\"){\r\n\t\t\t\tthis._buildFileInput();\r\n\t\t\t}\r\n\t\t\tthis.upload();\r\n\t\t}else if(this.uploaderType == \"html\" && this.selectMultipleFiles){\r\n\t\t\tthis._buildFileInput();\r\n\t\t\tthis._connectInput();\r\n\t\t}\r\n\t},\r\n\r\n\t_complete: function(dataArray){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. Handles tasks after files have finished uploading\r\n\r\n\t\tdataArray = lang.isArray(dataArray) ? dataArray : [dataArray];\r\n\r\n\t\t// Yes. Yes I do have to do three loops here. ugh.\r\n\t\t//\r\n\t\t// Check if one of the files had an error\r\n\t\tarray.forEach(dataArray, function(f){\r\n\t\t\tif(f.ERROR){ this._error(f.ERROR); }\r\n\t\t}, this);\r\n\r\n\t\t// Have to be set them all too 100%, because\r\n\t\t// onProgress does not always fire\r\n\t\tarray.forEach(this.fileList, function(f){\r\n\t\t\tf.bytesLoaded = 1;\r\n\t\t\tf.bytesTotal = 1;\r\n\t\t\tf.percent = 100;\r\n\t\t\tthis._progress(f);\r\n\t\t}, this);\r\n\t\t// we're done. remove files.\r\n\t\tarray.forEach(this.fileList, function(f){\r\n\t\t\tthis.removeFile(f.name, true);\r\n\t\t}, this);\r\n\r\n\t\tthis.onComplete(dataArray);\r\n\r\n\t\tthis.fileList = [];\r\n\t\tthis._resetHTML();\r\n\t\tthis.set(\"disabled\", false);\r\n\r\n\r\n\t\tif(this.restoreProgDisplay){\r\n\t\t\t// using timeout so prog shows on screen for at least a short time\r\n\t\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\t\tdomStyle.set(manager.byId(this.progressWidgetId).domNode,\r\n\t\t\t\t\tthis.restoreProgDisplay == \"none\" ? \"display\" : \"visibility\",\r\n\t\t\t\t\tthis.restoreProgDisplay\r\n\t\t\t\t);\r\n\t\t\t}), 500);\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_progress: function(dataObject){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. Calculate progress\r\n\t\tvar total = 0;\r\n\t\tvar loaded = 0;\r\n\t\tfor(var i = 0; i < this.fileList.length; i++){\r\n\t\t\tvar f = this.fileList[i];\r\n\t\t\tif(f.name == dataObject.name){\r\n\t\t\t\tf.bytesLoaded = dataObject.bytesLoaded;\r\n\t\t\t\tf.bytesTotal = dataObject.bytesTotal;\r\n\t\t\t\tf.percent = Math.ceil(f.bytesLoaded / f.bytesTotal * 100);\r\n\t\t\t\tthis.log(f.name, \"percent:\", f.percent)\r\n\t\t\t}\r\n\t\t\tloaded += Math.ceil(.001 * f.bytesLoaded);\r\n\t\t\ttotal += Math.ceil(.001 * f.bytesTotal);\r\n\t\t}\r\n\t\tvar percent = Math.ceil(loaded / total * 100);\r\n\t\tif(this.progressWidgetId){\r\n\t\t\tmanager.byId(this.progressWidgetId).update({progress:percent+\"%\"});\r\n\t\t}\r\n\t\tif(this.showProgress){\r\n\t\t\tthis._displayProgress(percent * .01);\r\n\t\t}\r\n\t\tthis.onProgress(this.fileList);\r\n\r\n\t},\r\n\t_getDisabledAttr: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. To get disabled use: widget.get(\"disabled\");\r\n\t\treturn this._disabled;\r\n\t},\r\n\r\n\t_setDisabledAttr: function(disabled){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. To set disabled use: widget.set(\"disabled\", true | false);\r\n\t\tif(this._disabled == disabled){ return; }\r\n\r\n\t\tif(this.uploaderType == \"flash\"){\r\n\t\t\tif(!this.flashReady){\r\n\t\t\t\tvar _fc = connect.connect(this, \"onLoad\", this, function(){\r\n\t\t\t\t\tconnect.disconnect(_fc);\r\n\t\t\t\t\tthis._setDisabledAttr(disabled);\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._disabled = disabled;\r\n\t\t\tthis.flashMovie.doDisable(disabled);\r\n\t\t}else{\r\n\t\t\tthis._disabled = disabled;\r\n\t\t\tdomStyle.set(this._fileInput, \"display\", this._disabled ? \"none\" : \"\");\r\n\t\t}\r\n\t\tdomClass.toggle(this.domNode, this.disabledClass, disabled);\r\n\t},\r\n\r\n\t_onFlashBlur: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. Detects when Flash movies reliquishes focus.\r\n\t\t//\t\tWe have to find all the tabIndexes in the doc and figure\r\n\t\t//\t\tout whom to give focus to next.\r\n\t\tthis.flashMovie.blur();\r\n\t\tif(!this.nextFocusObject && this.tabIndex){\r\n\t\t\tvar nodes = query(\"[tabIndex]\");\r\n\t\t\tfor(var i = 0; i<nodes.length; i++){\r\n\t\t\t\tif(nodes[i].tabIndex >= Number(this.tabIndex)+1){\r\n\t\t\t\t\tthis.nextFocusObject = nodes[i];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.nextFocusObject.focus();\r\n\t},\r\n\t_disconnect: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. Disconnects fileInput in favor of new one.\r\n\t\tarray.forEach(this._cons, connect.disconnect, dojo);\r\n\t},\r\n\r\n\t/*************************\r\n\t *\t\t\tHTML\t\t *\r\n\t *************************/\r\n\tuploadHTML: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. You could use this, but you should use upload() or submit();\r\n\t\t//\t\twhich can also handle the post data.\r\n\r\n\t\t// NOTE on deferredUploading:\r\n\t\t//\t\tThis is not enabled for HTML. Workaround would be to force\r\n\t\t//\t\tsingleFile uploads.\r\n\t\t// TODO:\r\n\t\t//\t\tInvestigate removing fileInputs and resending form\r\n\t\t//\t\tmultiple times adding each fileInput\r\n\t\t//\r\n\t\tif(this.selectMultipleFiles){\r\n\t\t\tdomConstruct.destroy(this._fileInput);\r\n\t\t}\r\n\t\tthis._setHtmlPostData();\r\n\t\tif(this.showProgress){\r\n\t\t\tthis._animateProgress();\r\n\t\t}\r\n\t\tvar dfd = ioIframe.send({\r\n\t\t\turl: this.uploadUrl.toString(),\r\n\t\t\tform: this._formNode,\r\n\t\t\thandleAs: \"json\",\r\n\t\t\terror: lang.hitch(this, function(err){\r\n\t\t\t\tthis._error(\"HTML Upload Error:\" + err.message);\r\n\t\t\t}),\r\n\t\t\tload: lang.hitch(this, function(data, ioArgs, widgetRef){\r\n\t\t\t\tthis._complete(data);\r\n\t\t\t})\r\n\t\t});\r\n\t},\r\n\r\n\tcreateHtmlUploader: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. Fires of methods to build HTML Uploader.\r\n\t\tthis._buildForm();\r\n\t\tthis._setFormStyle();\r\n\t\tthis._buildFileInput();\r\n\t\tthis._connectInput();\r\n\t\tthis._styleContent();\r\n\t\tdomStyle.set(this.insideNode, \"visibility\", \"visible\");\r\n\t\tthis.onReady();\r\n\t},\r\n\r\n\t_connectInput: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. HTML Uploader connections. These get disconnected\r\n\t\t//\t\tafter upload or if multi upload.\r\n\t\tthis._disconnect();\r\n\t\tthis._cons.push(connect.connect(this._fileInput, \"mouseover\", this, function(evt){\r\n\t\t\tdomClass.add(this.domNode, this.hoverClass);\r\n\t\t\tthis.onMouseOver(evt);\r\n\t\t}));\r\n\t\tthis._cons.push(connect.connect(this._fileInput, \"mouseout\", this, function(evt){\r\n\t\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\t\tdomClass.remove(this.domNode, this.activeClass);\r\n\t\t\t\tdomClass.remove(this.domNode, this.hoverClass);\r\n\t\t\t\tthis.onMouseOut(evt);\r\n\t\t\t\tthis._checkHtmlCancel(\"off\");\r\n\t\t\t}), 0);\r\n\t\t}));\r\n\t\tthis._cons.push(connect.connect(this._fileInput, \"mousedown\", this, function(evt){\r\n\t\t\tdomClass.add(this.domNode, this.activeClass);\r\n\t\t\tdomClass.remove(this.domNode, this.hoverClass);\r\n\t\t\tthis.onMouseDown(evt);\r\n\t\t}));\r\n\t\tthis._cons.push(connect.connect(this._fileInput, \"mouseup\", this, function(evt){\r\n\t\t\tdomClass.remove(this.domNode, this.activeClass);\r\n\t\t\tthis.onMouseUp(evt);\r\n\t\t\tthis.onClick(evt);\r\n\t\t\tthis._checkHtmlCancel(\"up\");\r\n\t\t}));\r\n\t\tthis._cons.push(connect.connect(this._fileInput, \"change\", this, function(){\r\n\t\t\tthis._checkHtmlCancel(\"change\");\r\n\t\t\tthis._change([{\r\n\t\t\t\tname: this._fileInput.value,\r\n\t\t\t\ttype: \"\",\r\n\t\t\t\tsize: 0\r\n\t\t\t}]);\r\n\t\t}));\r\n\t\tif(this.tabIndex>=0){\r\n\t\t\tdomAttr.set(this.domNode, \"tabIndex\", this.tabIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_checkHtmlCancel: function(mouseType){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. Check if the dialog was opened and canceled without file selection.\r\n\t\tif(mouseType == \"change\"){\r\n\t\t\tthis.dialogIsOpen = false;\r\n\t\t}\r\n\t\tif(mouseType == \"up\"){\r\n\t\t\tthis.dialogIsOpen = true;\r\n\t\t}\r\n\t\tif(mouseType == \"off\"){\r\n\t\t\tif(this.dialogIsOpen){\r\n\t\t\t\tthis.onCancel();\r\n\t\t\t}\r\n\t\t\tthis.dialogIsOpen = false;\r\n\t\t}\r\n\t},\r\n\r\n\t_styleContent: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal.Apply style to node\r\n\t\tvar o = this.fhtml.nr;\r\n\r\n\t\tdomStyle.set(this.insideNode, {\r\n\t\t\twidth:o.w+\"px\",\r\n\t\t\theight:o.va == \"middle\"?o.h+\"px\":\"auto\",\r\n\t\t\ttextAlign:o.ta,\r\n\t\t\tpaddingTop:o.p[0]+\"px\",\r\n\t\t\tpaddingRight:o.p[1]+\"px\",\r\n\t\t\tpaddingBottom:o.p[2]+\"px\",\r\n\t\t\tpaddingLeft:o.p[3]+\"px\"\r\n\t\t});\r\n\r\n\t\ttry{\r\n\t\t\tdomStyle.set(this.insideNode, \"lineHeight\", \"inherit\");\r\n\t\t}catch(e){\r\n\t\t\t// There are certain cases where IE refuses to set lineHeight.\r\n\t\t\t// For the life of me I cannot figure out the combination of\r\n\t\t\t// styles that IE doesn't like. Steaming... Pile...\r\n\t\t}\r\n\r\n\t},\r\n\t_resetHTML: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. After upload, this is called to clear the form and build a new\r\n\t\t//\t\tfileInput.\r\n\t\tif(this.uploaderType == \"html\" && this._formNode){\r\n\t\t\tthis.fileInputs = [];\r\n\t\t\tquery(\"*\", this._formNode).forEach(function(n){\r\n\t\t\t\tdomConstruct.destroy(n);\r\n\t\t\t});\r\n\t\t\tthis.fileCount = 0;\r\n\t\t\tthis._buildFileInput();\r\n\t\t\tthis._connectInput();\r\n\t\t}\r\n\t},\r\n\t_buildForm: function(){\r\n\t\t// summary:\r\n\t\t//\t\tBuild the form that holds the fileInput\r\n\r\n\t\tif(this._formNode){ return; }\r\n\r\n\t\tif(has(\"ie\") < 9 || (has(\"ie\") && has(\"quirks\"))){\r\n\t\t\tthis._formNode = document.createElement('<form enctype=\"multipart/form-data\" method=\"post\">');\r\n\t\t\tthis._formNode.encoding = \"multipart/form-data\";\r\n\t\t\tthis._formNode.id = manager.getUniqueId(\"FileUploaderForm\"); // needed for dynamic style\r\n\t\t\tthis.domNode.appendChild(this._formNode);\r\n\t\t}else{\r\n\t\t\tthis._formNode = domConstruct.create('form', {\r\n\t\t\t\tenctype:\"multipart/form-data\",\r\n\t\t\t\tmethod:\"post\",\r\n\t\t\t\tid:manager.getUniqueId(\"FileUploaderForm\")\r\n\t\t\t}, this.domNode);\r\n\t\t}\r\n\t},\r\n\r\n\t_buildFileInput: function(){\r\n\t\t// summary:\r\n\t\t//\t\tBuild the fileInput field\r\n\r\n\t\tif(this._fileInput){\r\n\t\t\tthis._disconnect();\r\n\t\t\t// FIXME:\r\n\t\t\t//\tJust hiding it which works, but we lose\r\n\t\t\t//\treference to it and can't remove it from\r\n\t\t\t//\tthe upload list.\r\n\t\t\tthis._fileInput.id = this._fileInput.id + this.fileCount;\r\n\t\t\tdomStyle.set(this._fileInput, \"display\", \"none\");\r\n\t\t}\r\n\t\tthis._fileInput = document.createElement('input');\r\n\t\tthis.fileInputs.push(this._fileInput);\r\n\t\t// server will need to know this variable:\r\n\t\tvar nm = this.htmlFieldName;\r\n\t\tvar _id = this.id;\r\n\t\tif(this.selectMultipleFiles){\r\n\t\t\tnm += this.fileCount;\r\n\t\t\t_id += this.fileCount;\r\n\t\t\tthis.fileCount++;\r\n\t\t}\r\n\r\n\t\tdomAttr.set(this._fileInput, {\r\n\t\t\tid:this.id,\r\n\t\t\tname:nm,\r\n\t\t\ttype:\"file\"\r\n\t\t});\r\n\r\n\t\tdomClass.add(this._fileInput, \"dijitFileInputReal\");\r\n\t\tthis._formNode.appendChild(this._fileInput);\r\n\t\tvar real = domGeometry.getMarginBox(this._fileInput);\r\n\t\tdomStyle.set(this._fileInput, {\r\n\t\t\tposition:\"relative\",\r\n\t\t\tleft:(this.fhtml.nr.w - real.w) + \"px\",\r\n\t\t\topacity:0\r\n\t\t});\r\n\t},\r\n\r\n\t_renumberInputs: function(){\r\n\t\tif(!this.selectMultipleFiles){ return; }\r\n\t\tvar nm;\r\n\t\tthis.fileCount = 0;\r\n\t\tarray.forEach(this.fileInputs, function(inp){\r\n\t\t\tnm = this.htmlFieldName + this.fileCount;\r\n\t\t\tthis.fileCount++;\r\n\t\t\tdomAttr.set(inp, \"name\", nm);\r\n\t\t}, this);\r\n\t},\r\n\r\n\t_setFormStyle: function(){\r\n\t\t// summary:\r\n\t\t//\t\tApply a dynamic style to the form and input\r\n\t\tvar size = Math.max(2, Math.max(Math.ceil(this.fhtml.nr.w / 60), Math.ceil(this.fhtml.nr.h / 15)));\r\n\t\t// Now create a style associated with the form ID\r\n\t\thtmlStyles.insertCssRule(\"#\" + this._formNode.id + \" input\", \"font-size:\" + size + \"em\");\r\n\t\tdomStyle.set(this.domNode, {\r\n\t\t\toverflow:\"hidden\",\r\n\t\t\tposition:\"relative\"\r\n\t\t});\r\n\t\tdomStyle.set(this.insideNode, \"position\", \"absolute\");\r\n\t},\r\n\r\n\t_setHtmlPostData: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal.Apply postData to hidden fields in form\r\n\t\tif(this.postData){\r\n\t\t\tfor(var nm in this.postData){\r\n\t\t\t\tdomConstruct.create(\"input\", {\r\n\t\t\t\t\ttype: \"hidden\",\r\n\t\t\t\t\tname: nm,\r\n\t\t\t\t\tvalue: this.postData[nm]\r\n\t\t\t\t}, this._formNode);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/*************************\r\n\t *\t\t\tFLASH\t\t *\r\n\t *************************/\r\n\tuploadFlash: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. You should use upload() or submit();\r\n\t\ttry{\r\n\t\t\tif(this.showProgress){\r\n\t\t\t\tthis._displayProgress(true);\r\n\t\t\t\tvar c = connect.connect(this, \"_complete\", this, function(){\r\n\t\t\t\t\tconnect.disconnect(c);\r\n\t\t\t\t\tthis._displayProgress(false);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tvar o = {};\r\n\t\t\tfor(var nm in this.postData){\r\n\t\t\t\to[nm] = this.postData[nm];\r\n\t\t\t}\r\n\t\t\tthis.flashMovie.doUpload(o);\r\n\r\n\t\t}catch(err){\r\n\t\t\tthis._error(\"FileUploader - Sorry, the SWF failed to initialize.\" + err);\r\n\t\t}\r\n\t},\r\n\r\n\tcreateFlashUploader: function(){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. Creates Flash Uploader\r\n\t\tthis.uploadUrl = this.uploadUrl.toString();\r\n\t\tif(this.uploadUrl){\r\n\t\t\tif(this.uploadUrl.toLowerCase().indexOf(\"http\")<0 && this.uploadUrl.indexOf(\"/\")!=0){\r\n\t\t\t\t// Appears to be a relative path. Attempt to\r\n\t\t\t\t// convert it to absolute, so it will better\r\n\t\t\t\t// target the SWF.\r\n\t\t\t\tvar loc = window.location.href.split(\"/\");\r\n\t\t\t\tloc.pop();\r\n\t\t\t\tloc = loc.join(\"/\")+\"/\";\r\n\t\t\t\tthis.uploadUrl = loc+this.uploadUrl;\r\n\t\t\t\tthis.log(\"SWF Fixed - Relative loc:\", loc, \" abs loc:\", this.uploadUrl);\r\n\t\t\t}else{\r\n\t\t\t\tthis.log(\"SWF URL unmodified:\", this.uploadUrl)\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tconsole.warn(\"Warning: no uploadUrl provided.\");\r\n\t\t}\r\n\r\n\t\tvar w = this.fhtml.nr.w;\r\n\t\tvar h = this.fhtml.nr.h;\r\n\r\n\t\tvar args = {\r\n\t\t\texpressInstall:true,\r\n\t\t\tpath: this.swfPath.uri || this.swfPath,\r\n\t\t\twidth: w,\r\n\t\t\theight: h,\r\n\t\t\tallowScriptAccess:\"always\",\r\n\t\t\tallowNetworking:\"all\",\r\n\t\t\tvars: {\r\n\t\t\t\tuploadDataFieldName: this.flashFieldName,\r\n\t\t\t\tuploadUrl: this.uploadUrl,\r\n\t\t\t\tuploadOnSelect: this.uploadOnChange,\r\n\t\t\t\tdeferredUploading:this.deferredUploading || 0,\r\n\t\t\t\tselectMultipleFiles: this.selectMultipleFiles,\r\n\t\t\t\tid: this.id,\r\n\t\t\t\tisDebug: this.isDebug,\r\n\t\t\t\tdevMode:this.devMode,\r\n\t\t\t\tflashButton:embedFlashVars.serialize(\"fh\", this.fhtml),\r\n\t\t\t\tfileMask:embedFlashVars.serialize(\"fm\", this.fileMask),\r\n\t\t\t\tnoReturnCheck: this.skipServerCheck,\r\n\t\t\t\tserverTimeout:this.serverTimeout\r\n\t\t\t},\r\n\t\t\tparams: {\r\n\t\t\t\tscale:\"noscale\",\r\n\t\t\t\twmode:\"opaque\",\r\n\t\t\t\tallowScriptAccess:\"always\",\r\n\t\t\t\tallowNetworking:\"all\"\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tthis.flashObject = new embedFlash(args, this.insideNode);\r\n\t\tthis.flashObject.onError = lang.hitch(function(msg){\r\n\t\t\tthis._error(\"Flash Error: \" + msg);\r\n\t\t});\r\n\t\tthis.flashObject.onReady = lang.hitch(this, function(){\r\n\t\t\tdomStyle.set(this.insideNode, \"visibility\", \"visible\");\r\n\t\t\tthis.log(\"FileUploader flash object ready\");\r\n\t\t\tthis.onReady(this);\r\n\t\t});\r\n\t\tthis.flashObject.onLoad = lang.hitch(this, function(mov){\r\n\t\t\tthis.flashMovie = mov;\r\n\t\t\tthis.flashReady = true;\r\n\r\n\t\t\tthis.onLoad(this);\r\n\t\t});\r\n\t\tthis._connectFlash();\r\n\r\n\t},\r\n\r\n\t_connectFlash: function(){\r\n\t\t// summary:\r\n\t\t//\t\tSubscribing to published topics coming from the\r\n\t\t//\t\tFlash uploader.\r\n\t\t//\r\n\t\t//\t\tSacrificing some readability for compactness. this.id\r\n\t\t//\t\twill be on the beginning of the topic, so more than\r\n\t\t//\t\tone uploader can be on a page and can have unique calls.\r\n\r\n\t\tthis._doSub(\"/filesSelected\", \"_change\");\r\n\t\tthis._doSub(\"/filesUploaded\", \"_complete\");\r\n\t\tthis._doSub(\"/filesProgress\", \"_progress\");\r\n\t\tthis._doSub(\"/filesError\", \"_error\");\r\n\t\tthis._doSub(\"/filesCanceled\", \"onCancel\");\r\n\t\tthis._doSub(\"/stageBlur\", \"_onFlashBlur\");\r\n\t\tthis._doSub(\"/up\", \"onMouseUp\");\r\n\t\tthis._doSub(\"/down\", \"onMouseDown\");\r\n\t\tthis._doSub(\"/over\", \"onMouseOver\");\r\n\t\tthis._doSub(\"/out\", \"onMouseOut\");\r\n\r\n\t\tthis.connect(this.domNode, \"focus\", function(){\r\n\t\t\t// TODO: some kind of indicator that the Flash button is in focus\r\n\t\t\tthis.flashMovie.focus();\r\n\t\t\tthis.flashMovie.doFocus();\r\n\t\t});\r\n\t\tif(this.tabIndex>=0){\r\n\t\t\tdomAttr.set(this.domNode, \"tabIndex\", this.tabIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_doSub: function(subStr, funcStr){\r\n\t\t// summary:\r\n\t\t//\t\tInternal. Shortcut for subscribes to Flash movie\r\n\t\tthis._subs.push(connect.subscribe(this.id + subStr, this, funcStr));\r\n\t},\r\n\r\n\t/*************************************\r\n\t *\t\tDOM INSPECTION METHODS\t\t *\r\n\t *************************************/\r\n\r\n\turlencode: function(url){\r\n\t\t// Using symbols in place of URL chars that will break in Flash serialization.\r\n\t\tif(!url || url == \"none\"){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn url.replace(/:/g,\"||\").replace(/\\./g,\"^^\").replace(\"url(\", \"\").replace(\")\",\"\").replace(/'/g,\"\").replace(/\"/g,\"\");\r\n\t},\r\n\r\n\tisButton: function(node){\r\n\t\t// testing if button for styling purposes\r\n\t\tvar tn = node.tagName.toLowerCase();\r\n\t\treturn tn == \"button\" || tn == \"input\";\r\n\t},\r\n\r\n\tgetTextStyle: function(node){\r\n\t\t// getting font info\r\n\t\tvar o = {};\r\n\t\to.ff = domStyle.get(node, \"fontFamily\");\r\n\t\tif(o.ff){\r\n\t\t\to.ff = o.ff.replace(\", \", \",\"); // remove spaces. IE in Flash no likee\r\n\t\t\to.ff = o.ff.replace(/\\\"|\\'/g, \"\");\r\n\t\t\to.ff = o.ff == \"sans-serif\" ? \"Arial\" : o.ff; // Flash doesn't know what sans-serif is\r\n\t\t\to.fw = domStyle.get(node, \"fontWeight\");\r\n\t\t\to.fi = domStyle.get(node, \"fontStyle\");\r\n\t\t\to.fs = parseInt(domStyle.get(node, \"fontSize\"), 10);\r\n\t\t\tif(domStyle.get(node, \"fontSize\").indexOf(\"%\") > -1){\r\n\t\t\t\t// IE doesn't convert % to px. For god sakes.\r\n\t\t\t\tvar n = node;\r\n\t\t\t\twhile(n.tagName){\r\n\t\t\t\t\tif(domStyle.get(n, \"fontSize\").indexOf(\"%\") == -1){\r\n\t\t\t\t\t\to.fs = parseInt(domStyle.get(n, \"fontSize\"), 10);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(n.tagName.toLowerCase()==\"body\"){\r\n\t\t\t\t\t\t// if everyting is %, the the font size is 16px * the %\r\n\t\t\t\t\t\to.fs = 16 * .01 * parseInt(domStyle.get(n, \"fontSize\"), 10);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tn = n.parentNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\to.fc = new Color(domStyle.get(node, \"color\")).toHex();\r\n\t\t\to.fc = parseInt(o.fc.substring(1,Infinity),16);\r\n\t\t}\r\n\t\to.lh = domStyle.get(node, \"lineHeight\");\r\n\t\to.ta = domStyle.get(node, \"textAlign\");\r\n\t\to.ta = o.ta == \"start\" || !o.ta ? \"left\" : o.ta;\r\n\t\to.va = this.isButton(node) ? \"middle\" : o.lh == o.h ? \"middle\" : domStyle.get(node, \"verticalAlign\");\r\n\t\treturn o;\r\n\t},\r\n\r\n\tgetText: function(node){\r\n\t\t// Get the text of the button. It's possible to use HTML in the Flash Button,\r\n\t\t// but the results are not spectacular.\r\n\t\tvar cn = lang.trim(node.innerHTML);\r\n\t\tif(cn.indexOf(\"<\") >- 1){\r\n\t\t\tcn = escape(cn);\r\n\t\t}\r\n\t\treturn cn;\r\n\t},\r\n\r\n\tgetStyle: function(node){\r\n\t\t// getting the style of a node. Using very abbreviated characters which the\r\n\t\t// Flash movie understands.\r\n\t\tvar o = {};\r\n\t\tvar dim = domGeometry.getContentBox(node);\r\n\t\tvar pad = domGeometry.getPadExtents(node);\r\n\t\to.p = [pad.t, pad.w-pad.l, pad.h-pad.t, pad.l];\r\n\t\to.w = dim.w + pad.w;\r\n\t\to.h = dim.h + pad.h;\r\n\t\to.d = domStyle.get(node, \"display\");\r\n\t\tvar clr = new Color(domStyle.get(node, \"backgroundColor\"));\r\n\t\t// if no color, Safari sets #000000 and alpha=0 since we don't support alpha,\r\n\t\t// it makes black - make it white\r\n\t\to.bc = clr.a == 0 ? \"#ffffff\" : clr.toHex();\r\n\t\to.bc = parseInt(o.bc.substring(1,Infinity),16);\r\n\t\tvar url = this.urlencode(domStyle.get(node, \"backgroundImage\"));\r\n\t\tif(url){\r\n\t\t\to.bi = {\r\n\t\t\t\turl:url,\r\n\t\t\t\trp:domStyle.get(node, \"backgroundRepeat\"),\r\n\t\t\t\tpos: escape(domStyle.get(node, \"backgroundPosition\"))\r\n\t\t\t};\r\n\t\t\tif(!o.bi.pos){\r\n\t\t\t\t// IE does Xpx and Ypx, not \"X% Y%\"\r\n\t\t\t\tvar rx = domStyle.get(node, \"backgroundPositionX\");\r\n\t\t\t\tvar ry = domStyle.get(node, \"backgroundPositionY\");\r\n\t\t\t\trx = (rx == \"left\") ? \"0%\" : (rx == \"right\") ? \"100%\" : rx;\r\n\t\t\t\try = (ry == \"top\") ? \"0%\" : (ry == \"bottom\") ? \"100%\" : ry;\r\n\t\t\t\to.bi.pos = escape(rx+\" \"+ry);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn lang.mixin(o, this.getTextStyle(node));\r\n\t},\r\n\r\n\tgetTempNodeStyle: function(node, _class, isDijitButton){\r\n\t\t// This sets up a temp node to get the style of the hover, active, and disabled states\r\n\t\tvar temp, style;\r\n\t\tif(isDijitButton){\r\n\t\t\t// backwards compat until dojo 1.5\r\n\t\t\ttemp = domConstruct.place(\"<\"+node.tagName+\"><span>\"+node.innerHTML+\"</span></\"+node.tagName+\">\", node.parentNode); //+\" \"+_class+\"\r\n\t\t\tvar first = temp.firstChild;\r\n\t\t\tdomClass.add(first, node.className);\r\n\t\t\tdomClass.add(temp, _class);\r\n\t\t\tstyle = this.getStyle(first);\r\n\t\t}else{\r\n\t\t\ttemp = domConstruct.place(\"<\"+node.tagName+\">\"+node.innerHTML+\"</\"+node.tagName+\">\", node.parentNode);\r\n\t\t\tdomClass.add(temp, node.className);\r\n\t\t\tdomClass.add(temp, _class);\r\n\t\t\ttemp.id = node.id;\r\n\t\t\tstyle = this.getStyle(temp);\r\n\t\t}\r\n\t\t// dev note: comment out this line to see what the\r\n\t\t// button states look like to the FileUploader\r\n\t\tdomConstruct.destroy(temp);\r\n\t\treturn style;\r\n\t}\r\n});\r\n\r\n});\r\n"]}