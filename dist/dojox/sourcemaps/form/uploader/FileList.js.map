{"version":3,"sources":["form/uploader/FileList.js"],"names":["define","fx","domStyle","domClass","declare","lang","arrayUtil","manager","Base","template","uploaderId","uploader","headerIndex","headerType","headerFilename","headerFilesize","_upCheckCnt","rowAmt","templateString","postCreate","this","setUploader","hideProgress","reset","i","listNode","deleteRow","byId","console","warn","connect","showProgress","setTimeout","hitch","_fileSizeAvail","html5","flash","uploadType","sizeHeader","style","display","animate","o","ani","endDisp","beg","end","_hideShowProgress","_progress","customEvent","percentTextNode","innerHTML","percent","set","percentBarNode","node","progressNode","onEnd","animateProperty","properties","height","start","units","play","_onUploaderChange","fileArray","forEach","f","_addRow","getFileType","name","size","index","type","c","r","insertRow","insertCell","add","convertBytes","value"],"mappings":"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","file":"../../../form/uploader/FileList.js","sourcesContent":["define([\r\n\t\"dojo/_base/fx\",\r\n\t\"dojo/dom-style\",\r\n\t\"dojo/dom-class\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/array\",\r\n\t\"dijit/_base/manager\",\r\n\t\"dojox/form/uploader/_Base\",\r\n\t\"dojo/text!../resources/UploaderFileList.html\"\r\n],function(fx, domStyle, domClass, declare, lang, arrayUtil, manager, Base, template){\r\n\r\nreturn declare(\"dojox.form.uploader.FileList\", Base, {\r\n\t// summary:\r\n\t//\t\tA simple widget that provides a list of the files currently selected by\r\n\t//\t\tdojox/form/Uploader\r\n\t// description:\r\n\t//\t\tThere is a required CSS file: resources/UploaderFileList.css.\r\n\t//\t\tThis is a very simple widget, and not beautifully styled. It is here mainly for test\r\n\t//\t\tcases, but could very easily be used, extended, modified, or copied.\r\n\r\n\t// uploaderId: String\r\n\t//\t\tThe id of the dojox.form.Uploader to connect to.\r\n\tuploaderId:\"\",\r\n\r\n\t// uploader: dojox.form.Uploader\r\n\t//\t\tThe dojox.form.Uploader to connect to. Use either this property of unploaderId. This\r\n\t//\t\tproperty is populated if uploaderId is used.\r\n\tuploader:null,\r\n\r\n\t// headerIndex: String\r\n\t//\t\tThe label for the index column.\r\n\theaderIndex:\"#\",\r\n\r\n\t// headerType: String\r\n\t//\t\tThe label for the file type column.\r\n\theaderType:\"Type\",\r\n\r\n\t// headerFilename: String\r\n\t//\t\tThe label for the file name column.\r\n\theaderFilename:\"File Name\",\r\n\r\n\t// headerFilesize: String\r\n\t//\t\tThe label for the file size column.\r\n\theaderFilesize:\"Size\",\r\n\r\n\t_upCheckCnt:0,\r\n\trowAmt:0,\r\n\r\n\ttemplateString:template,\r\n\r\n\tpostCreate: function(){\r\n\t\tthis.setUploader();\r\n\t\tthis.hideProgress();\r\n\t},\r\n\r\n\treset: function(){\r\n\t\t// summary:\r\n\t\t//\t\tClears all rows of items. Happens automatically if Uploader is reset, but you\r\n\t\t//\t\tcould call this directly.\r\n\r\n\t\tfor(var i=0;i<this.rowAmt;i++){\r\n\t\t\tthis.listNode.deleteRow(0);\r\n\t\t}\r\n\t\tthis.rowAmt = 0;\r\n\t},\r\n\r\n\tsetUploader: function(){\r\n\t\t// summary:\r\n\t\t//\t\tConnects to the Uploader based on the uploader or the uploaderId properties.\r\n\r\n\t\tif(!this.uploaderId && !this.uploader){\r\n\t\t\tconsole.warn(\"uploaderId not passed to UploaderFileList\");\r\n\t\t}else if(this.uploaderId && !this.uploader){\r\n\t\t\tthis.uploader = manager.byId(this.uploaderId);\r\n\t\t}else if(this._upCheckCnt>4){\r\n\t\t\tconsole.warn(\"uploader not found for ID \", this.uploaderId);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(this.uploader){\r\n\t\t\tthis.connect(this.uploader, \"onChange\", \"_onUploaderChange\");\r\n\t\t\tthis.connect(this.uploader, \"reset\", \"reset\");\r\n\t\t\tthis.connect(this.uploader, \"onBegin\", function(){\r\n\t\t\t\tthis.showProgress(true);\r\n\t\t\t});\r\n\t\t\tthis.connect(this.uploader, \"onProgress\", \"_progress\");\r\n\t\t\tthis.connect(this.uploader, \"onComplete\", function(){\r\n\t\t\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\t\t\tthis.hideProgress(true);\r\n\t\t\t\t}), 1250);\r\n\t\t\t});\r\n\t\t\tif(!(this._fileSizeAvail = {'html5':1,'flash':1}[this.uploader.uploadType])){\r\n\t\t\t\t//if uploadType is neither html5 nor flash, file size is not available\r\n\t\t\t\t//hide the size header\r\n\t\t\t\tthis.sizeHeader.style.display=\"none\";\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tthis._upCheckCnt++;\r\n\t\t\tsetTimeout(lang.hitch(this, \"setUploader\"), 250);\r\n\t\t}\r\n\t},\r\n\r\n\thideProgress: function(/*Boolean*/ animate){\r\n\t\tvar o = animate ? {\r\n\t\t\tani:true,\r\n\t\t\tendDisp:\"none\",\r\n\t\t\tbeg:15,\r\n\t\t\tend:0\r\n\t\t} : {\r\n\t\t\tendDisp:\"none\",\r\n\t\t\tani:false\r\n\t\t};\r\n\t\tthis._hideShowProgress(o);\r\n\t},\r\n\r\n\tshowProgress: function(/*Boolean*/ animate){\r\n\t\tvar o = animate ? {\r\n\t\t\tani:true,\r\n\t\t\tendDisp:\"block\",\r\n\t\t\tbeg:0,\r\n\t\t\tend:15\r\n\t\t} : {\r\n\t\t\tendDisp:\"block\",\r\n\t\t\tani:false\r\n\t\t};\r\n\t\tthis._hideShowProgress(o);\r\n\t},\r\n\r\n\t_progress: function(/*Object*/ customEvent){\r\n\t\tthis.percentTextNode.innerHTML = customEvent.percent;\r\n\t\tdomStyle.set(this.percentBarNode, \"width\", customEvent.percent);\r\n\t},\r\n\r\n\t_hideShowProgress: function(o){\r\n\t\tvar node = this.progressNode;\r\n\t\tvar onEnd = function(){\r\n\t\t\tdomStyle.set(node, \"display\", o.endDisp);\r\n\t\t};\r\n\t\tif(o.ani){\r\n\t\t\tdomStyle.set(node, \"display\", \"block\");\r\n\t\t\tfx.animateProperty({\r\n\t\t\t\tnode: node,\r\n\t\t\t\tproperties:{\r\n\t\t\t\t\theight:{\r\n\t\t\t\t\t\tstart:o.beg,\r\n\t\t\t\t\t\tend:o.end,\r\n\t\t\t\t\t\tunits:\"px\"\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonEnd:onEnd\r\n\t\t\t}).play();\r\n\t\t}else{\r\n\t\t\tonEnd();\r\n\t\t}\r\n\t},\r\n\r\n\t_onUploaderChange: function(fileArray){\r\n\t\tthis.reset();\r\n\t\tarrayUtil.forEach(fileArray, function(f, i){\r\n\t\t\tthis._addRow(i+1, this.getFileType(f.name), f.name, f.size);\r\n\t\t}, this)\r\n\t},\r\n\r\n\t_addRow: function(index, type, name, size){\r\n\r\n\t\tvar c, r = this.listNode.insertRow(-1);\r\n\t\tc = r.insertCell(-1);\r\n\t\tdomClass.add(c, \"dojoxUploaderIndex\");\r\n\t\tc.innerHTML = index;\r\n\r\n\t\tc = r.insertCell(-1);\r\n\t\tdomClass.add(c, \"dojoxUploaderIcon\");\r\n\t\tc.innerHTML = type;\r\n\r\n\t\tc = r.insertCell(-1);\r\n\t\tdomClass.add(c, \"dojoxUploaderFileName\");\r\n\t\tc.innerHTML = name;\r\n\t\tif(this._fileSizeAvail){\r\n\t\t\tc = r.insertCell(-1);\r\n\t\t\tdomClass.add(c, \"dojoxUploaderSize\");\r\n\t\t\tc.innerHTML = this.convertBytes(size).value;\r\n\t\t}\r\n\r\n\t\tthis.rowAmt++;\r\n\t}\r\n});\r\n});\r\n"]}