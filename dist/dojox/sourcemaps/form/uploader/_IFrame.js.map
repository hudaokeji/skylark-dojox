{"version":3,"sources":["form/uploader/_IFrame.js"],"names":["define","query","domConstruct","declare","lang","arrayUtil","domForm","request","postMixInProperties","this","inherited","arguments","uploadType","upload","uploadIFrame","data","sendForm","formObject","url","getForm","getUrl","self","place","domNode","forEach","_inputs","n","i","value","appendChild","name","nm","undefined","create","type","post","form","handleAs","content","then","result","destroy","onError","onComplete","err","console","error"],"mappings":";;;;;;;AAAAA,QACC,aACA,qBACA,qBACA,kBACA,mBACA,gBACA,uBACC,SAASC,EAAOC,EAAcC,EAASC,EAAMC,EAAWC,EAASC,GAGlE,OAAOJ,EAAQ,kCAUdK,oBAAqB,WACpBC,KAAKC,UAAUC,WACQ,WAApBF,KAAKG,aACPH,KAAKG,WAAa,SAClBH,KAAKI,OAASJ,KAAKK,eAIrBA,aAAc,SAASC,GAKtB,IAECC,EADAC,KAGAC,GADOT,KAAKU,UACNV,KAAKW,UACXC,EAAOZ,KAiBR,IAhBAM,EAAOA,OACFH,WAAaH,KAAKG,WAIvBI,EAAWd,EAAaoB,MAAM,4DAA6Db,KAAKc,SAChGlB,EAAUmB,QAAQf,KAAKgB,QAAS,SAASC,EAAGC,GAE5B,KAAZD,EAAEE,QACJZ,EAASa,YAAYH,GACrBT,EAAWS,EAAEI,MAAQJ,EAAEE,QAEtBnB,MAIAM,EAEF,IAAIgB,MAAMhB,OACaiB,IAAnBf,EAAWc,KACb7B,EAAa+B,OAAO,SAAUH,KAAKC,GAAIH,MAAMb,EAAKgB,IAAKG,KAAK,UAAWlB,GAM1ET,EAAQ4B,KAAKjB,GACZkB,KAAMpB,EACNqB,SAAU,OACVC,QAASvB,IACPwB,KAAK,SAASC,GAChBtC,EAAauC,QAAQzB,GAClBwB,EAAc,OAAKA,EAAc,MACnCnB,EAAKqB,QAAQF,GAEbnB,EAAKsB,WAAWH,IAEf,SAASI,GACXC,QAAQC,MAAM,8BAA+BF,GAC7C1C,EAAauC,QAAQzB,GACrBK,EAAKqB,QAAQE","file":"../../../form/uploader/_IFrame.js","sourcesContent":["define([\r\n\t\"dojo/query\",\r\n\t\"dojo/dom-construct\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/dom-form\",\r\n\t\"dojo/request/iframe\"\r\n],function(query, domConstruct, declare, lang, arrayUtil, domForm, request){\r\n\t\r\n\r\n\treturn declare(\"dojox.form.uploader._IFrame\", [], {\r\n\t\t// summary:\r\n\t\t//\t\tA mixin for dojox/form/Uploader that adds Ajax upload capabilities via an iframe.\r\n\t\t//\r\n\t\t// description:\r\n\t\t//\t\tOnly supported by IE, due to the specific iFrame hack used.  Progress events are not\r\n\t\t//\t\tsupported.\r\n\t\t//\t\t\r\n\t\t//\r\n\t\r\n\t\tpostMixInProperties: function(){\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\tif(this.uploadType === \"iframe\"){\r\n\t\t\t\tthis.uploadType = \"iframe\";\r\n\t\t\t\tthis.upload = this.uploadIFrame;\r\n\t\t\t}\r\n\t\t},\r\n\t\r\n\t\tuploadIFrame: function(data){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal. You could use this, but you should use upload() or submit();\r\n\t\t\t//\t\twhich can also handle the post data.\r\n\t\r\n\t\t\tvar\r\n\t\t\t\tformObject = {},\r\n\t\t\t\tsendForm,\r\n\t\t\t\tform = this.getForm(),\r\n\t\t\t\turl = this.getUrl(),\r\n\t\t\t\tself = this;\r\n\t\t\tdata = data || {};\r\n\t\t\tdata.uploadType = this.uploadType;\r\n\t\t\t\r\n\t\t\t// create a temp form for which to send data\r\n\t\t\t//enctype can't be changed once a form element is created\r\n\t\t\tsendForm = domConstruct.place('<form enctype=\"multipart/form-data\" method=\"post\"></form>', this.domNode);\r\n\t\t\tarrayUtil.forEach(this._inputs, function(n, i){\r\n\t\t\t\t// don't send blank inputs\r\n\t\t\t\tif(n.value !== ''){\r\n\t\t\t\t\tsendForm.appendChild(n);\r\n\t\t\t\t\tformObject[n.name] = n.value;\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// add any extra data as form inputs\t\t\r\n\t\t\tif(data){\r\n\t\t\t\t//formObject = domForm.toObject(form);\r\n\t\t\t\tfor(nm in data){\r\n\t\t\t\t\tif(formObject[nm] === undefined){\r\n\t\t\t\t\t\tdomConstruct.create('input', {name:nm, value:data[nm], type:'hidden'}, sendForm);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\t\r\n\t\t\trequest.post(url, {\r\n\t\t\t\tform: sendForm,\r\n\t\t\t\thandleAs: \"json\",\r\n\t\t\t\tcontent: data\r\n\t\t\t}).then(function(result){\r\n\t\t\t\tdomConstruct.destroy(sendForm);\r\n\t\t\t\tif(result[\"ERROR\"] || result[\"error\"]){\r\n\t\t\t\t\tself.onError(result);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tself.onComplete(result);\r\n\t\t\t\t}\r\n\t\t\t}, function(err){\r\n\t\t\t\tconsole.error('error parsing server result', err);\r\n\t\t\t\tdomConstruct.destroy(sendForm); \r\n\t\t\t\tself.onError(err);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n});\r\n"]}