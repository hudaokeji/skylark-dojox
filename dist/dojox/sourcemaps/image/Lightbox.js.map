{"version":3,"sources":["image/Lightbox.js"],"names":["define","dojo","dijit","dojox","template","experimental","getObject","Lightbox","declare","_Widget","group","title","href","duration","modal","_allowPassthru","_attachedDialog","startup","this","inherited","arguments","tmp","byId","image","LightboxDialog","id","store","_addSelf","connect","domNode","addImage","_handleClick","e","preventDefault","show","hide","disable","enable","onClick","destroy","removeImage","Dialog","inGroup","imgUrl","prototype","_blankGif","errorMessage","adjust","imageClass","errorImg","moduleUrl","templateString","constructor","args","_groups","XnoGroupX","_animConnects","nextButtonNode","prevButtonNode","closeButtonNode","_makeAnims","_vp","window","getBox","groupData","_t","_lastGroup","open","_modalconnects","push","global","body","_underlay","_wasStyled","tmpImg","create","className","imgNode","style","titleNode","src","forEach","g","i","_index","sr","groupCount","innerHTML","Math","max","length","visibility","leaveTitle","textNode","_ready","_imgError","disconnect","_imgConnect","resizeTo","w","width","h","height","_nextImage","_loadImage","_prevImage","_loadingAnim","play","_prepNodes","_imageReady","_calcTitleSize","sizes","map","query","position","s","apply","size","forceTitle","adjustSize","boxModel","_getBorderExtents","titleSize","_lastTitleSize","_lastSize","_scaleToFit","_currentSize","_sizeAnim","fx","sizeTo","node","containerNode","ns","nvp","viewportAspect","imageAspect","_setImageSize","_size","_position","type","_showImage","_showImageAnim","_showNav","titleSizeNow","marginBox","_showNavAnim","fadeOut","onEnd","hitch","child","every","item","ar","splice","removeGroup","_handleKey","dk","keys","charOrCode","ESCAPE","DOWN_ARROW","RIGHT_ARROW","UP_ARROW","LEFT_ARROW","fadeIn","combine","_onImageClick","target","declaredClass"],"mappings":"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","file":"../../image/Lightbox.js","sourcesContent":["define([\"dojo\", \"dijit\", \"dojox\", \"dojo/text!./resources/Lightbox.html\", \"dijit/Dialog\", \"dojox/fx/_base\"], function(dojo, dijit, dojox, template){\r\n\r\n\tdojo.experimental(\"dojox.image.Lightbox\");\r\n\tdojo.getObject(\"image\", true, dojox);\r\n\r\n\tvar Lightbox = dojo.declare(\"dojox.image.Lightbox\", dijit._Widget, {\r\n\t\t// summary:\r\n\t\t//\t\tA dojo-based Lightbox implementation.\r\n\t\t// description:\r\n\t\t//\t\tAn Elegant, keyboard accessible, markup and store capable Lightbox widget to show images\r\n\t\t//\t\tin a modal dialog-esque format. Can show individual images as Modal dialog, or can group\r\n\t\t//\t\timages with multiple entry points, all using a single \"master\" Dialog for visualization\r\n\t\t//\r\n\t\t//\t\tkey controls:\r\n\t\t//\r\n\t\t//\t\t- ESC - close\r\n\t\t//\t\t- Down Arrow / Rt Arrow / N - Next Image\r\n\t\t//\t\t- Up Arrow / Lf Arrow / P - Previous Image\r\n\t\t// example:\r\n\t\t// |\t<a href=\"image1.jpg\" dojoType=\"dojox.image.Lightbox\">show lightbox</a>\r\n\t\t// example:\r\n\t\t// |\t<a href=\"image2.jpg\" dojoType=\"dojox.image.Lightbox\" group=\"one\">show group lightbox</a>\r\n\t\t// |\t<a href=\"image3.jpg\" dojoType=\"dojox.image.Lightbox\" group=\"one\">show group lightbox</a>\r\n\t\t// example:\r\n\t\t// |\tnot implemented fully yet, though works with basic datastore access. need to manually call\r\n\t\t// |\twidget._attachedDialog.addImage(item,\"fromStore\") for each item in a store result set.\r\n\t\t// |\t<div dojoType=\"dojox.image.Lightbox\" group=\"fromStore\" store=\"storeName\"></div>\r\n\r\n\t\t// group: String\r\n\t\t//\t\tGrouping images in a page with similar tags will provide a 'slideshow' like grouping of images\r\n\t\tgroup: \"\",\r\n\r\n\t\t// title: String\r\n\t\t//\t\tA string of text to be shown in the Lightbox beneath the image (empty if using a store)\r\n\t\ttitle: \"\",\r\n\r\n\t\t// href; String\r\n\t\t//\t\tLink to image to use for this Lightbox node (empty if using a store).\r\n\t\thref: \"\",\r\n\r\n\t\t// duration: Integer\r\n\t\t//\t\tGeneric time in MS to adjust the feel of widget. could possibly add various\r\n\t\t//\t\tdurations for the various actions (dialog fadein, sizeing, img fadein ...)\r\n\t\tduration: 500,\r\n\r\n\t\t// modal: Boolean\r\n\t\t//\t\tIf true, this Dialog instance will be truly modal and prevent closing until\r\n\t\t//\t\texplicitly told to by calling hide() or clicking the (x) - Defaults to false\r\n\t\t//\t\tto preserve previous behaviors. (aka: enable click-to-close on the underlay)\r\n\t\tmodal: false,\r\n\r\n\t\t// _allowPassthru: Boolean\r\n\t\t//\t\tPrivately set this to disable/enable natural link of anchor tags\r\n\t\t_allowPassthru: false,\r\n\r\n\t\t// _attachedDialog: dojox.image._LightboxDialog\r\n\t\t//\t\tThe pointer to the global lightbox dialog for this widget\r\n\t\t_attachedDialog: null, // try to share a single underlay per page?\r\n\r\n\t\tstartup: function(){\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\t// setup an attachment to the masterDialog (or create the masterDialog)\r\n\t\t\tvar tmp = dijit.byId('dojoxLightboxDialog');\r\n\t\t\tif(tmp){\r\n\t\t\t\tthis._attachedDialog = tmp;\r\n\t\t\t}else{\r\n\t\t\t\t// this is the first instance to start, so we make the masterDialog\r\n\t\t\t\tthis._attachedDialog = new dojox.image.LightboxDialog({ id: \"dojoxLightboxDialog\" });\r\n\t\t\t\tthis._attachedDialog.startup();\r\n\t\t\t}\r\n\t\t\tif(!this.store){\r\n\t\t\t\t// FIXME: full store support lacking, have to manually call this._attachedDialog.addImage(imgage,group) as it stands\r\n\t\t\t\tthis._addSelf();\r\n\t\t\t\tthis.connect(this.domNode, \"onclick\", \"_handleClick\");\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t_addSelf: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tAdd this instance to the master LightBoxDialog\r\n\t\t\tthis._attachedDialog.addImage({\r\n\t\t\t\thref: this.href,\r\n\t\t\t\ttitle: this.title\r\n\t\t\t}, this.group || null);\r\n\t\t},\r\n\r\n\t\t_handleClick: function(/* Event */e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandle the click on the link\r\n\t\t\tif(!this._allowPassthru){ e.preventDefault(); }\r\n\t\t\telse{ return; }\r\n\t\t\tthis.show();\r\n\t\t},\r\n\r\n\t\tshow: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tShow the Lightbox with this instance as the starting point\r\n\t\t\tthis._attachedDialog.show(this);\r\n\t\t},\r\n\r\n\t\thide: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHide the Lightbox currently showing\r\n\t\t\tthis._attachedDialog.hide();\r\n\t\t},\r\n\r\n\t\t// FIXME: switch to .attr, deprecate eventually.\r\n\t\tdisable: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDisables event clobbering and dialog, and follows natural link\r\n\t\t\tthis._allowPassthru = true;\r\n\t\t},\r\n\r\n\t\tenable: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEnables the dialog (prevents default link)\r\n\t\t\tthis._allowPassthru = false;\r\n\t\t},\r\n\r\n\t\tonClick: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStub fired when the image in the lightbox is clicked.\r\n\t\t},\r\n\r\n\t\tdestroy: function(){\r\n\t\t\tthis._attachedDialog.removeImage(this);\r\n\t\t\tthis.inherited(arguments);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tLightbox.LightboxDialog = dojo.declare(\"dojox.image.LightboxDialog\",\r\n\t\tdijit.Dialog, {\r\n\t\t// summary:\r\n\t\t//\t\tThe \"dialog\" shared\t between any Lightbox instances on the page, publically available\r\n\t\t//\t\tfor programmatic manipulation.\r\n\t\t// description:\r\n\t\t//\t\tA widget that intercepts anchor links (typically around images)\r\n\t\t//\t\tand displays a modal Dialog. this is the actual Dialog, which you can\r\n\t\t//\t\tcreate and populate manually, though should use simple Lightbox's\r\n\t\t//\t\tunless you need the direct access.\r\n\t\t//\r\n\t\t//\t\tThere should only be one of these on a page, so all dojox.image.Lightbox's will us it\r\n\t\t//\t\t(the first instance of a Lightbox to be show()'n will create me If i do not exist)\r\n\t\t// example:\r\n\t\t//\t|\t// show a single image from a url\r\n\t\t//\t|\tvar url = \"http://dojotoolkit.org/logo.png\";\r\n\t\t//\t|\tvar dialog = new dojox.image.LightboxDialog().startup();\r\n\t\t//\t|\tdialog.show({ href: url, title:\"My Remote Image\"});\r\n\r\n\t\t// title: String\r\n\t\t//\t\tThe current title, read from object passed to show()\r\n\t\ttitle: \"\",\r\n\r\n\t\t// FIXME: implement titleTemplate\r\n\r\n\t\t// inGroup: Array\r\n\t\t//\t\tArray of objects. this is populated by from the JSON object _groups, and\r\n\t\t//\t\tshould not be populate manually. it is a placeholder for the currently\r\n\t\t//\t\tshowing group of images in this master dialog\r\n\t\tinGroup: null,\r\n\r\n\t\t// imgUrl: String\r\n\t\t//\t\tThe src=\"\" attribute of our imageNode (can be null at statup)\r\n\t\timgUrl: dijit._Widget.prototype._blankGif,\r\n\r\n\t\t// errorMessage: String\r\n\t\t//\t\tThe text to display when an unreachable image is linked\r\n\t\terrorMessage: \"Image not found.\",\r\n\r\n\t\t// adjust: Boolean\r\n\t\t//\t\tIf true, ensure the image always stays within the viewport\r\n\t\t//\t\tmore difficult than necessary to disable, but enabled by default\r\n\t\t//\t\tseems sane in most use cases.\r\n\t\tadjust: true,\r\n\r\n\t\t// modal: Boolean\r\n\t\t//\t\tIf true, this Dialog instance will be truly modal and prevent closing until\r\n\t\t//\t\texplicitly told to by calling hide() or clicking the (x) - Defaults to false\r\n\t\t//\t\tto preserve previous behaviors. (aka: enable click-to-close on the underlay)\r\n\t\tmodal: false,\r\n\t\t\r\n\t\t// imageClass: String\r\n\t\t//\t\tThe classname to apply to the image node in the dialog (for extra styling)\r\n\t\timageClass: \"dojoxLightboxImage\",\r\n\r\n\t/*=====\r\n\t\t// _groups: Object\r\n\t\t//\t\tan object of arrays, each array (of objects) being a unique 'group'\r\n\t\t_groups: { XnoGroupX: [] },\r\n\r\n\t=====*/\r\n\r\n\t\t// errorImg: Url\r\n\t\t//\t\tPath to the image used when a 404 is encountered\r\n\t\terrorImg: dojo.moduleUrl(\"dojox.image\",\"resources/images/warning.png\"),\r\n\r\n\t\ttemplateString: template, \r\n\t\t\r\n\t\tconstructor: function(args){\r\n\t\t\tthis._groups = this._groups || (args && args._groups) || { XnoGroupX:[] };\r\n\t\t},\r\n\r\n\t\tstartup: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tAdd some extra event handlers, and startup our superclass.\r\n\t\t\t// returns: dijit._Widget\r\n\t\t\t//\t\tPerhaps the only `dijit._Widget` that returns itself to allow\r\n\t\t\t//\t\t'chaining' or var referencing with .startup()\r\n\r\n\t\t\tthis.inherited(arguments);\r\n\r\n\t\t\tthis._animConnects = [];\r\n\t\t\tthis.connect(this.nextButtonNode, \"onclick\", \"_nextImage\");\r\n\t\t\tthis.connect(this.prevButtonNode, \"onclick\", \"_prevImage\");\r\n\t\t\tthis.connect(this.closeButtonNode, \"onclick\", \"hide\");\r\n\t\t\tthis._makeAnims();\r\n\t\t\tthis._vp = dojo.window.getBox();\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tshow: function(/* Object */groupData){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tShow the Master Dialog. Starts the chain of events to show\r\n\t\t\t//\t\tan image in the dialog, including showing the dialog if it is\r\n\t\t\t//\t\tnot already visible\r\n\t\t\t// groupData: Object\r\n\t\t\t//\t\tneeds href and title attributes. the values for this image.\r\n\r\n\t\t\tvar _t = this; // size\r\n\t\t\tthis._lastGroup = groupData;\r\n\r\n\t\t\t// we only need to call dijit.Dialog.show() if we're not already open.\r\n\t\t\tif(!_t.open){\r\n\t\t\t\t_t.inherited(arguments);\r\n\t\t\t\t_t._modalconnects.push(\r\n\t\t\t\t\tdojo.connect(dojo.global, \"onscroll\", this, \"_position\"),\r\n\t\t\t\t\tdojo.connect(dojo.global, \"onresize\", this, \"_position\"),\r\n\t\t\t\t\tdojo.connect(dojo.body(), \"onkeypress\", this, \"_handleKey\")\r\n\t\t\t\t);\r\n\t\t\t\tif(!groupData.modal){\r\n\t\t\t\t\t_t._modalconnects.push(\r\n\t\t\t\t\t\tdojo.connect(dijit._underlay.domNode, \"onclick\", this, \"onCancel\")\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(this._wasStyled){\r\n\t\t\t\t// ugly fix for IE being stupid. place the new image relative to the old\r\n\t\t\t\t// image to allow for overriden templates to adjust the location of the\r\n\t\t\t\t// titlebar. DOM will remain \"unchanged\" between views.\r\n\t\t\t\tvar tmpImg = dojo.create(\"img\", {\r\n\t\t\t\t\tclassName: _t.imageClass\r\n\t\t\t\t}, _t.imgNode, \"after\");\r\n\t\t\t\tdojo.destroy(_t.imgNode);\r\n\t\t\t\t_t.imgNode = tmpImg;\r\n\t\t\t\t_t._makeAnims();\r\n\t\t\t\t_t._wasStyled = false;\r\n\t\t\t}\r\n\r\n\t\t\tdojo.style(_t.imgNode,\"opacity\",\"0\");\r\n\t\t\tdojo.style(_t.titleNode,\"opacity\",\"0\");\r\n\r\n\t\t\tvar src = groupData.href;\r\n\r\n\t\t\tif((groupData.group && groupData !== \"XnoGroupX\") || _t.inGroup){\r\n\t\t\t\tif(!_t.inGroup){\r\n\t\t\t\t\t_t.inGroup = _t._groups[(groupData.group)];\r\n\t\t\t\t\t// determine where we were or are in the show\r\n\t\t\t\t\tdojo.forEach(_t.inGroup, function(g, i){\r\n\t\t\t\t\t\tif(g.href == groupData.href){\r\n\t\t\t\t\t\t\t_t._index = i;\r\n\t\t\t\t\t\t\t//return false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//return true;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif(!_t._index){\r\n\t\t\t\t\t_t._index = 0;\r\n\t\t\t\t\tvar sr = _t.inGroup[_t._index];\r\n\t\t\t\t\tsrc = (sr && sr.href) || _t.errorImg;\r\n\t\t\t\t}\r\n\t\t\t\t// FIXME: implement titleTemplate\r\n\t\t\t\t_t.groupCount.innerHTML = \" (\" + (_t._index + 1) + \" of \" + Math.max(1, _t.inGroup.length) + \")\";\r\n\t\t\t\t_t.prevButtonNode.style.visibility = \"visible\";\r\n\t\t\t\t_t.nextButtonNode.style.visibility = \"visible\";\r\n\t\t\t}else{\r\n\t\t\t\t// single images don't have buttons, or counters:\r\n\t\t\t\t_t.groupCount.innerHTML = \"\";\r\n\t\t\t\t_t.prevButtonNode.style.visibility = \"hidden\";\r\n\t\t\t\t_t.nextButtonNode.style.visibility = \"hidden\";\r\n\t\t\t}\r\n\t\t\tif(!groupData.leaveTitle){\r\n\t\t\t\t_t.textNode.innerHTML = groupData.title;\r\n\t\t\t}\r\n\t\t\t_t._ready(src);\r\n\t\t},\r\n\r\n\t\t_ready: function(src){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA function to trigger all 'real' showing of some src\r\n\r\n\t\t\tvar _t = this;\r\n\r\n\t\t\t// listen for 404's:\r\n\t\t\t_t._imgError = dojo.connect(_t.imgNode, \"error\", _t, function(){\r\n\t\t\t\tdojo.disconnect(_t._imgError);\r\n\t\t\t\t// trigger the above onload with a new src:\r\n\t\t\t\t_t.imgNode.src = _t.errorImg;\r\n\t\t\t\t_t.textNode.innerHTML = _t.errorMessage;\r\n\t\t\t});\r\n\r\n\t\t\t// connect to the onload of the image\r\n\t\t\t_t._imgConnect = dojo.connect(_t.imgNode, \"load\", _t, function(e){\r\n\t\t\t\t_t.resizeTo({\r\n\t\t\t\t\tw: _t.imgNode.width,\r\n\t\t\t\t\th: _t.imgNode.height,\r\n\t\t\t\t\tduration:_t.duration\r\n\t\t\t\t});\r\n\t\t\t\t// cleanup\r\n\t\t\t\tdojo.disconnect(_t._imgConnect);\r\n\t\t\t\tif(_t._imgError){\r\n\t\t\t\t\tdojo.disconnect(_t._imgError);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t_t.imgNode.src = src;\r\n\t\t},\r\n\r\n\t\t_nextImage: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tLoad next image in group\r\n\t\t\tif(!this.inGroup){ return; }\r\n\t\t\tif(this._index + 1 < this.inGroup.length){\r\n\t\t\t\tthis._index++;\r\n\t\t\t}else{\r\n\t\t\t\tthis._index = 0;\r\n\t\t\t}\r\n\t\t\tthis._loadImage();\r\n\t\t},\r\n\r\n\t\t_prevImage: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tLoad previous image in group\r\n\t\t\tif(this.inGroup){\r\n\t\t\t\tif(this._index == 0){\r\n\t\t\t\t\tthis._index = this.inGroup.length - 1;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._index--;\r\n\t\t\t\t}\r\n\t\t\t\tthis._loadImage();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_loadImage: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDo the prep work before we can show another image\r\n\t\t\tthis._loadingAnim.play(1);\r\n\t\t},\r\n\r\n\t\t_prepNodes: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA localized hook to accompany _loadImage\r\n\t\t\tthis._imageReady = false;\r\n\t\t\tif(this.inGroup && this.inGroup[this._index]){\r\n\t\t\t\tthis.show({\r\n\t\t\t\t\thref: this.inGroup[this._index].href,\r\n\t\t\t\t\ttitle: this.inGroup[this._index].title\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tthis.show({\r\n\t\t\t\t\ttitle: this.errorMessage,\r\n\t\t\t\t\thref: this.errorImg\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t_calcTitleSize: function(){\r\n\t\t\tvar sizes = dojo.map(dojo.query(\"> *\", this.titleNode).position(), function(s){ return s.h; });\r\n\t\t\treturn { h: Math.max.apply(Math, sizes) };\r\n\t\t},\r\n\r\n\t\tresizeTo: function(/* Object */size, forceTitle){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tResize our dialog container, and fire _showImage\r\n\r\n\t\t\tvar adjustSize = dojo.boxModel == \"border-box\" ?\r\n\t\t\t\tdojo._getBorderExtents(this.domNode).w : 0,\r\n\t\t\t\ttitleSize = forceTitle || this._calcTitleSize()\r\n\t\t\t;\r\n\r\n\t\t\tthis._lastTitleSize = titleSize;\r\n\r\n\t\t\tif(this.adjust &&\r\n\t\t\t\t(size.h + titleSize.h + adjustSize + 80 > this._vp.h ||\r\n\t\t\t\t size.w + adjustSize + 60 > this._vp.w\r\n\t\t\t\t)\r\n\t\t\t){\r\n\t\t\t\tthis._lastSize = size;\r\n\t\t\t\tsize = this._scaleToFit(size);\r\n\t\t\t}\r\n\t\t\tthis._currentSize = size;\r\n\r\n\t\t\tvar _sizeAnim = dojox.fx.sizeTo({\r\n\t\t\t\tnode: this.containerNode,\r\n\t\t\t\tduration: size.duration||this.duration,\r\n\t\t\t\twidth: size.w + adjustSize,\r\n\t\t\t\theight: size.h + titleSize.h + adjustSize\r\n\t\t\t});\r\n\t\t\tthis.connect(_sizeAnim, \"onEnd\", \"_showImage\");\r\n\t\t\t_sizeAnim.play(15);\r\n\t\t},\r\n\r\n\t\t_scaleToFit: function(/* Object */size){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tresize an image to fit within the bounds of the viewport\r\n\t\t\t// size: Object\r\n\t\t\t//\t\tThe 'size' object passed around for this image\r\n\r\n\t\t\tvar ns = {},   // New size\r\n\t\t\t\tnvp = {\r\n\t\t\t\t\tw: this._vp.w - 80,\r\n\t\t\t\t\th: this._vp.h - 60 - this._lastTitleSize.h\r\n\t\t\t\t};\t// New viewport\r\n\r\n\t\t\t// Calculate aspect ratio\r\n\t\t\tvar viewportAspect = nvp.w / nvp.h,\r\n\t\t\t\timageAspect = size.w / size.h;\r\n\r\n\t\t\t// Calculate new image size\r\n\t\t\tif(imageAspect >= viewportAspect){\r\n\t\t\t\tns.h = nvp.w / imageAspect;\r\n\t\t\t\tns.w = nvp.w;\r\n\t\t\t}else{\r\n\t\t\t\tns.w = imageAspect * nvp.h;\r\n\t\t\t\tns.h = nvp.h;\r\n\t\t\t}\r\n\r\n\t\t\t// we actually have to style this image, it's too big\r\n\t\t\tthis._wasStyled = true;\r\n\t\t\tthis._setImageSize(ns);\r\n\r\n\t\t\tns.duration = size.duration;\r\n\t\t\treturn ns; // Object\r\n\t\t},\r\n\r\n\t\t_setImageSize: function(size){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReset the image size to some actual size.\r\n\t\t\tvar s = this.imgNode;\r\n\t\t\ts.height = size.h;\r\n\t\t\ts.width = size.w;\r\n\t\t},\r\n\r\n\t\t// clobber inherited function, it is useless.\r\n\t\t_size: function(){},\r\n\r\n\t\t_position: function(/* Event */e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\twe want to know the viewport size any time it changes\r\n\t\t\tthis._vp = dojo.window.getBox();\r\n\t\t\tthis.inherited(arguments);\r\n\r\n\t\t\t// determine if we need to scale up or down, if at all.\r\n\t\t\tif(e && e.type == \"resize\"){\r\n\t\t\t\tif(this._wasStyled){\r\n\t\t\t\t\tthis._setImageSize(this._lastSize);\r\n\t\t\t\t\tthis.resizeTo(this._lastSize);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(this.imgNode.height + 80 > this._vp.h || this.imgNode.width + 60 > this._vp.h){\r\n\t\t\t\t\t\tthis.resizeTo({\r\n\t\t\t\t\t\t\tw: this.imgNode.width, h: this.imgNode.height\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_showImage: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFade in the image, and fire showNav\r\n\t\t\tthis._showImageAnim.play(1);\r\n\t\t},\r\n\r\n\t\t_showNav: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFade in the footer, and setup our connections.\r\n\t\t\tvar titleSizeNow = dojo.marginBox(this.titleNode);\r\n\t\t\tif(titleSizeNow.h > this._lastTitleSize.h){\r\n\t\t\t\tthis.resizeTo(this._wasStyled ? this._lastSize : this._currentSize, titleSizeNow);\r\n\t\t\t}else{\r\n\t\t\t\tthis._showNavAnim.play(1);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\thide: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHide the Master Lightbox\r\n\t\t\tdojo.fadeOut({\r\n\t\t\t\tnode: this.titleNode,\r\n\t\t\t\tduration: 200,\r\n\t\t\t\t// #5112 - if you _don't_ change the .src, safari will\r\n\t\t\t\t// _never_ fire onload for this image\r\n\t\t\t\tonEnd: dojo.hitch(this, function(){\r\n\t\t\t\t\tthis.imgNode.src = this._blankGif;\r\n\t\t\t\t})\r\n\t\t\t}).play(5);\r\n\r\n\t\t\tthis.inherited(arguments);\r\n\r\n\t\t\tthis.inGroup = null;\r\n\t\t\tthis._index = null;\r\n\t\t},\r\n\r\n\t\taddImage: function(child, group){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tAdd an image to this Master Lightbox\r\n\t\t\t// child: Object\r\n\t\t\t//\t\tThe image information to add.\r\n\t\t\t//\r\n\t\t\t//\t\t- href: String - link to image (required)\r\n\t\t\t//\t\t- title: String - title to display\r\n\t\t\t// group: String?\r\n\t\t\t//\t\tattach to group of similar tag or null for individual image instance\r\n\r\n\t\t\tvar g = group;\r\n\t\t\tif(!child.href){ return; }\r\n\t\t\tif(g){\r\n\t\t\t\tif(!this._groups[g]){\r\n\t\t\t\t\tthis._groups[g] = [];\r\n\t\t\t\t}\r\n\t\t\t\tthis._groups[g].push(child);\r\n\t\t\t}else{ this._groups[\"XnoGroupX\"].push(child); }\r\n\t\t},\r\n\r\n\t\tremoveImage: function(/* Widget */child){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRemove an image instance from this LightboxDialog.\r\n\t\t\t// child: Object\r\n\t\t\t//\t\tA reference to the Lightbox child that was added (or an object literal)\r\n\t\t\t//\t\tonly the .href member is compared for uniqueness. The object may contain\r\n\t\t\t//\t\ta .group member as well.\r\n\r\n\t\t\tvar g = child.group || \"XnoGroupX\";\r\n\t\t\tdojo.every(this._groups[g], function(item, i, ar){\r\n\t\t\t\tif(item.href == child.href){\r\n\t\t\t\t\tar.splice(i, 1);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tremoveGroup: function(group){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRemove all images in a passed group\r\n\t\t\tif(this._groups[group]){ this._groups[group] = []; }\r\n\t\t},\r\n\r\n\t\t_handleKey: function(/* Event */e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandle keyboard navigation internally\r\n\t\t\tif(!this.open){ return; }\r\n\r\n\t\t\tvar dk = dojo.keys;\r\n\t\t\tswitch(e.charOrCode){\r\n\r\n\t\t\t\tcase dk.ESCAPE:\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase dk.DOWN_ARROW:\r\n\t\t\t\tcase dk.RIGHT_ARROW:\r\n\t\t\t\tcase 78: // key \"n\"\r\n\t\t\t\t\tthis._nextImage();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase dk.UP_ARROW:\r\n\t\t\t\tcase dk.LEFT_ARROW:\r\n\t\t\t\tcase 80: // key \"p\"\r\n\t\t\t\t\tthis._prevImage();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_makeAnims: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tmake and cleanup animation and animation connections\r\n\r\n\t\t\tdojo.forEach(this._animConnects, dojo.disconnect);\r\n\t\t\tthis._animConnects = [];\r\n\t\t\tthis._showImageAnim = dojo.fadeIn({\r\n\t\t\t\t\tnode: this.imgNode,\r\n\t\t\t\t\tduration: this.duration\r\n\t\t\t\t});\r\n\t\t\tthis._animConnects.push(dojo.connect(this._showImageAnim, \"onEnd\", this, \"_showNav\"));\r\n\t\t\tthis._loadingAnim = dojo.fx.combine([\r\n\t\t\t\t\tdojo.fadeOut({ node:this.imgNode, duration:175 }),\r\n\t\t\t\t\tdojo.fadeOut({ node:this.titleNode, duration:175 })\r\n\t\t\t\t]);\r\n\t\t\tthis._animConnects.push(dojo.connect(this._loadingAnim, \"onEnd\", this, \"_prepNodes\"));\r\n\t\t\tthis._showNavAnim = dojo.fadeIn({ node: this.titleNode, duration:225 });\r\n\t\t},\r\n\r\n\t\tonClick: function(groupData){\r\n\t\t\t// summary:\r\n\t\t\t//\t\ta stub function, called with the currently displayed image as the only argument\r\n\t\t},\r\n\r\n\t\t_onImageClick: function(e){\r\n\t\t\tif(e && e.target == this.imgNode){\r\n\t\t\t\tthis.onClick(this._lastGroup);\r\n\t\t\t\t// also fire the onclick for the Lightbox widget which triggered, if you\r\n\t\t\t\t// aren't working directly with the LBDialog\r\n\t\t\t\tif(this._lastGroup.declaredClass){\r\n\t\t\t\t\tthis._lastGroup.onClick(this._lastGroup);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\treturn Lightbox;\r\n});\r\n\r\n"]}