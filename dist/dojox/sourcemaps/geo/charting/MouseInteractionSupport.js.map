{"version":3,"sources":["geo/charting/MouseInteractionSupport.js"],"names":["define","lang","declare","event","connect","win","html","dom","has","_map","_mapClickLocation","_screenClickLocation","_mouseDragListener","_mouseUpListener","_mouseUpClickListener","_mouseDownListener","_mouseMoveListener","_mouseWheelListener","_currentFeature","_cancelMouseClick","_zoomEnabled","_panEnabled","_onDragStartListener","_onSelectStartListener","mouseClickThreshold","constructor","map","options","this","x","y","enableZoom","enablePan","setEnableZoom","enable","wheelEventName","surface","_mouseWheelHandler","disconnect","setEnablePan","_mouseMoveHandler","_mouseDownHandler","doc","stop","isZoom","_mouseClickHandler","mouseEvent","feature","_getFeatureFromMouseEvent","_onclickHandler","name","mapObj","features","select","onFeatureClick","focused","pageX","pageY","containerBounds","_getContainerBounds","offX","offY","mapPoint","screenCoordsToMapCoords","node","byId","container","_mouseDragHandler","_mouseUpClickHandler","_mouseUpHandler","rawNode","setCapture","marker","_needTooltipRefresh","releaseCapture","gfxTarget","getParent","id","_onmouseoutHandler","_onmouseoverHandler","_onmousemoveHandler","dx","Math","abs","dy","hide","cBounds","mapOffsetX","mapOffsetY","currentMapCenter","getMapCenter","setMapCenter","invariantMapPoint","power","scaleFactor","pow","setMapScaleAt","getMapScale"],"mappings":"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","file":"../../../geo/charting/MouseInteractionSupport.js","sourcesContent":["define([\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/_base/html\",\r\n\t\"dojo/dom\",\r\n\t\"dojo/_base/sniff\"\r\n], function(lang, declare, event, connect, win, html, dom, has){\r\n\r\n\t/*=====\r\n\tdojox.geo.charting.__MouseInteractionSupportCtorArgs = {\r\n\t\t// summary:\r\n\t\t//\t\tThe keyword arguments that can be passed in a MouseInteractionSupport constructor.\r\n\t\t// enableZoom: Boolean?\r\n\t\t//\t\tIndicates whether zooming is enabled.\r\n\t\t// enablePan: Boolean?\r\n\t\t//\t\tIndicates whether panning is enabled.\r\n\t\t// mouseClickThreshold: Number?\r\n\t\t//\t\tThe threshold (in pixel) that differentiates a drag from a click.\r\n\t};\r\n\t=====*/\r\n\r\n\treturn declare(\"dojox.geo.charting.MouseInteractionSupport\", null, {\r\n\t\t// summary:\r\n\t\t//\t\tclass to handle mouse interactions on a dojox.geo.charting.Map widget\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\r\n\t\t_map: null,\r\n\t\t_mapClickLocation: null,\r\n\t\t_screenClickLocation: null,\r\n\t\t_mouseDragListener: null,\r\n\t\t_mouseUpListener: null,\r\n\t\t_mouseUpClickListener: null,\r\n\t\t_mouseDownListener: null,\r\n\t\t_mouseMoveListener: null,\r\n\t\t_mouseWheelListener: null,\r\n\t\t_currentFeature: null,\r\n\t\t_cancelMouseClick: null,\r\n\t\t_zoomEnabled: false,\r\n\t\t_panEnabled: false,\r\n\t\t_onDragStartListener: null,\r\n\t\t_onSelectStartListener: null,\r\n\r\n\r\n\t\tmouseClickThreshold: 2,\r\n\r\n\t\tconstructor : function(map, options){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tConstructs a new _MouseInteractionSupport instance\r\n\t\t\t// map: dojox/geo/charting/Map\r\n\t\t\t//\t\tthe Map widget this class provides touch navigation for.\r\n\t\t\t// options: dojox.geo.charting.__MouseInteractionSupportCtorArgs?\r\n\t\t\t//\t\tAn object defining additional configuration properties.\r\n\t\t\tthis._map = map;\r\n\t\t\tthis._mapClickLocation = {x: 0,y: 0};\r\n\t\t\tthis._screenClickLocation = {x: 0,y: 0};\r\n\t\t\tthis._cancelMouseClick = false;\r\n\t\t\tif(options){\r\n\t\t\t\tthis._zoomEnabled = options.enableZoom;\r\n\t\t\t\tthis._panEnabled = options.enablePan;\r\n\t\t\t\tif(options.mouseClickThreshold && options.mouseClickThreshold > 0){\r\n\t\t\t\t\tthis.mouseClickThreshold = options.mouseClickThreshold;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsetEnableZoom: function(enable){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tenables mouse zoom on the map\r\n\t\t\t// enable: Boolean\r\n\t\t\t//\t\tIndicates whether mouse zoom is enabled.\r\n\t\t\tif(enable && !this._mouseWheelListener){\r\n\t\t\t\t// enable\r\n\t\t\t\tvar wheelEventName = !has(\"mozilla\") ? \"onmousewheel\" : \"DOMMouseScroll\";\r\n\t\t\t\tthis._mouseWheelListener = this._map.surface.connect(wheelEventName, this, this._mouseWheelHandler);\r\n\t\t\t}else if(!enable && this._mouseWheelListener){\r\n\t\t\t\t// disable\r\n\t\t\t\tconnect.disconnect(this._mouseWheelListener);\r\n\t\t\t\tthis._mouseWheelListener = null;\r\n\t\t\t}\r\n\t\t\tthis._zoomEnabled = enable;\r\n\t\t},\r\n\r\n\t\tsetEnablePan: function(enable){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tenables mouse panning on the map\r\n\t\t\t// enable: Boolean\r\n\t\t\t//\t\tIndicates whether mouse zoom is enabled.\r\n\t\t\tthis._panEnabled = enable;\r\n\t\t},\r\n\r\n\t\tconnect: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tconnects this mouse support class to the Map component\r\n\r\n\t\t\t// install mouse listeners\r\n\t\t\tthis._mouseMoveListener = this._map.surface.connect(\"onmousemove\", this, this._mouseMoveHandler);\r\n\t\t\tthis._mouseDownListener = this._map.surface.connect(\"onmousedown\", this, this._mouseDownHandler);\r\n\r\n\t\t\tif(has(\"ie\")){\r\n\t\t\t\t_onDragStartListener = connect.connect(win.doc,\"ondragstart\",this,event.stop);\r\n\t\t\t\t_onSelectStartListener = connect.connect(win.doc,\"onselectstart\",this,event.stop);\r\n\t\t\t}\r\n\r\n\t\t\tthis.setEnableZoom(this._zoomEnabled);\r\n\t\t\tthis.setEnablePan(this._panEnabled);\r\n\t\t},\r\n\r\n\t\tdisconnect: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tdisconnects any installed listeners\r\n\r\n\t\t\t// store zoomPan state\r\n\t\t\tvar isZoom = this._zoomEnabled;\r\n\r\n\t\t\t// disable zoom (disconnects listeners..)\r\n\t\t\tthis.setEnableZoom(false);\r\n\r\n\t\t\t// restore value\r\n\t\t\tthis._zoomEnabled = isZoom;\r\n\r\n\t\t\t// disconnect remaining listeners\r\n\t\t\tif(this._mouseMoveListener){\r\n\t\t\t\tconnect.disconnect(this._mouseMoveListener);\r\n\t\t\t\tthis._mouseMoveListener = null;\r\n\t\t\t\tconnect.disconnect(this._mouseDownListener);\r\n\t\t\t\tthis._mouseDownListener = null;\r\n\t\t\t}\r\n\t\t\tif(this._onDragStartListener){\r\n\t\t\t\tconnect.disconnect(this._onDragStartListener);\r\n\t\t\t\tthis._onDragStartListener = null;\r\n\t\t\t\tconnect.disconnect(this._onSelectStartListener);\r\n\t\t\t\tthis._onSelectStartListener = null;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t_mouseClickHandler: function(mouseEvent){\r\n\t\t\t// summary:\r\n\t\t\t//\t\taction performed on the map when a mouse click was performed\r\n\t\t\t// mouseEvent: MouseEvent\r\n\t\t\t//\t\tthe mouse event\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar feature = this._getFeatureFromMouseEvent(mouseEvent);\r\n\r\n\t\t\tif(feature){\r\n\t\t\t\t// call feature handler\r\n\t\t\t\tfeature._onclickHandler(mouseEvent);\r\n\t\t\t}else{\r\n\t\t\t\t// unselect all\r\n\t\t\t\tfor(var name in this._map.mapObj.features){\r\n\t\t\t\t\tthis._map.mapObj.features[name].select(false);\r\n\t\t\t\t}\r\n\t\t\t\tthis._map.onFeatureClick(null);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t_mouseDownHandler: function(mouseEvent){\r\n\t\t\t// summary:\r\n\t\t\t//\t\taction performed on the map when a mouse down was performed\r\n\t\t\t// mouseEvent: MouseEvent\r\n\t\t\t//\t\tthe mouse event\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\r\n\t\t\tevent.stop(mouseEvent);\r\n\r\n\t\t\tthis._map.focused = true;\r\n\t\t\t// set various status parameters\r\n\t\t\tthis._cancelMouseClick = false;\r\n\t\t\tthis._screenClickLocation.x =  mouseEvent.pageX;\r\n\t\t\tthis._screenClickLocation.y =  mouseEvent.pageY;\r\n\r\n\t\t\t// store map location where mouse down occurred\r\n\t\t\tvar containerBounds = this._map._getContainerBounds();\r\n\t\t\tvar offX = mouseEvent.pageX\t- containerBounds.x,\r\n\t\t\t\toffY = mouseEvent.pageY - containerBounds.y;\r\n\t\t\tvar mapPoint = this._map.screenCoordsToMapCoords(offX,offY);\r\n\t\t\tthis._mapClickLocation.x = mapPoint.x;\r\n\t\t\tthis._mapClickLocation.y = mapPoint.y;\r\n\r\n\t\t\t// install drag listener if pan is enabled\r\n\t\t\tif(!has(\"ie\")){\r\n\t\t\t\tthis._mouseDragListener = connect.connect(win.doc,\"onmousemove\",this,this._mouseDragHandler);\r\n\t\t\t\tthis._mouseUpClickListener = this._map.surface.connect(\"onmouseup\", this, this._mouseUpClickHandler);\r\n\t\t\t\tthis._mouseUpListener = connect.connect(win.doc,\"onmouseup\",this, this._mouseUpHandler);\r\n\t\t\t}else{\r\n\t\t\t\tvar node = dom.byId(this._map.container);\r\n\t\t\t\tthis._mouseDragListener = connect.connect(node,\"onmousemove\",this,this._mouseDragHandler);\r\n\t\t\t\tthis._mouseUpClickListener = this._map.surface.connect(\"onmouseup\", this, this._mouseUpClickHandler);\r\n\t\t\t\tthis._mouseUpListener = this._map.surface.connect(\"onmouseup\", this, this._mouseUpHandler);\r\n\t\t\t\tthis._map.surface.rawNode.setCapture();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_mouseUpClickHandler: function(mouseEvent){\r\n\r\n\t\t\tif(!this._cancelMouseClick){\r\n\t\t\t\t// execute mouse click handler\r\n\t\t\t\tthis._mouseClickHandler(mouseEvent);\r\n\t\t\t}\r\n\t\t\tthis._cancelMouseClick = false;\r\n\r\n\t\t},\r\n\r\n\t\t_mouseUpHandler: function(mouseEvent){\r\n\t\t\t// summary:\r\n\t\t\t//\t\taction performed on the map when a mouse up was performed\r\n\t\t\t// mouseEvent: MouseEvent\r\n\t\t\t//\t\tthe mouse event\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tevent.stop(mouseEvent);\r\n\r\n\t\t\tthis._map.mapObj.marker._needTooltipRefresh = true;\r\n\r\n\t\t\t// disconnect listeners\r\n\t\t\tif(this._mouseDragListener){\r\n\t\t\t\tconnect.disconnect(this._mouseDragListener);\r\n\t\t\t\tthis._mouseDragListener = null;\r\n\t\t\t}\r\n\t\t\tif(this._mouseUpClickListener){\r\n\t\t\t\tconnect.disconnect(this._mouseUpClickListener);\r\n\t\t\t\tthis._mouseUpClickListener = null;\r\n\t\t\t}\r\n\t\t\tif(this._mouseUpListener){\r\n\t\t\t\tconnect.disconnect(this._mouseUpListener);\r\n\t\t\t\tthis._mouseUpListener = null;\r\n\t\t\t}\r\n\r\n\t\t\tif(has(\"ie\")){\r\n\t\t\t\tthis._map.surface.rawNode.releaseCapture();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_getFeatureFromMouseEvent: function(mouseEvent){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tutility function to return the feature located at this mouse event location\r\n\t\t\t// mouseEvent: MouseEvent\r\n\t\t\t//\t\tthe mouse event\r\n\t\t\t// returns:\r\n\t\t\t//\t\tthe feature found if any, null otherwise.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar feature = null;\r\n\t\t\tif(mouseEvent.gfxTarget && mouseEvent.gfxTarget.getParent){\r\n\t\t\t\tfeature = this._map.mapObj.features[mouseEvent.gfxTarget.getParent().id];\r\n\t\t\t}\r\n\t\t\treturn feature; // dojox/geo/charting/Feature\r\n\t\t},\r\n\r\n\t\t_mouseMoveHandler: function(mouseEvent){\r\n\t\t\t// summary:\r\n\t\t\t//\t\taction performed on the map when a mouse move was performed\r\n\t\t\t// mouseEvent: MouseEvent\r\n\t\t\t//\t\tthe mouse event\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\r\n\t\t\t// do nothing more if dragging\r\n\t\t\tif(this._mouseDragListener && this._panEnabled){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// hover and highlight\r\n\t\t\tvar feature = this._getFeatureFromMouseEvent(mouseEvent);\r\n\r\n\t\t\t// set/unset highlight\r\n\t\t\tif(feature != this._currentFeature){\r\n\t\t\t\tif(this._currentFeature){\r\n\t\t\t\t\t// mouse leaving component\r\n\t\t\t\t\tthis._currentFeature._onmouseoutHandler();\r\n\t\t\t\t}\r\n\t\t\t\tthis._currentFeature = feature;\r\n\r\n\t\t\t\tif(feature){\r\n\t\t\t\t\tfeature._onmouseoverHandler();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(feature){\r\n\t\t\t\tfeature._onmousemoveHandler(mouseEvent);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_mouseDragHandler: function(mouseEvent){\r\n\t\t\t// summary:\r\n\t\t\t//\t\taction performed on the map when a mouse drag was performed\r\n\t\t\t// mouseEvent: MouseEvent\r\n\t\t\t//\t\tthe mouse event\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\t// prevent browser interaction\r\n\t\t\tevent.stop(mouseEvent);\r\n\r\n\r\n\t\t\t// find out if this the movement discards the \"mouse click\" gesture\r\n\t\t\tvar dx = Math.abs(mouseEvent.pageX - this._screenClickLocation.x);\r\n\t\t\tvar dy = Math.abs(mouseEvent.pageY - this._screenClickLocation.y);\r\n\t\t\tif(!this._cancelMouseClick && (dx > this.mouseClickThreshold || dy > this.mouseClickThreshold)){\r\n\t\t\t\t// cancel mouse click\r\n\t\t\t\tthis._cancelMouseClick = true;\r\n\t\t\t\tif(this._panEnabled){\r\n\t\t\t\t\tthis._map.mapObj.marker.hide();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!this._panEnabled){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar cBounds = this._map._getContainerBounds();\r\n\t\t\tvar offX = mouseEvent.pageX - cBounds.x,\r\n\t\t\toffY = mouseEvent.pageY - cBounds.y;\r\n\r\n\t\t\t// compute map offset\r\n\t\t\tvar mapPoint = this._map.screenCoordsToMapCoords(offX,offY);\r\n\t\t\tvar mapOffsetX = mapPoint.x - this._mapClickLocation.x;\r\n\t\t\tvar mapOffsetY = mapPoint.y - this._mapClickLocation.y;\r\n\r\n\t\t\t// adjust map center\r\n\t\t\tvar currentMapCenter = this._map.getMapCenter();\r\n\t\t\tthis._map.setMapCenter(currentMapCenter.x - mapOffsetX, currentMapCenter.y - mapOffsetY);\r\n\r\n\t\t},\r\n\r\n\t\t_mouseWheelHandler: function(mouseEvent){\r\n\t\t\t// summary:\r\n\t\t\t//\t\taction performed on the map when a mouse wheel up/down was performed\r\n\t\t\t// mouseEvent: MouseEvent\r\n\t\t\t//\t\tthe mouse event\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\t// prevent browser interaction\r\n\t\t\tevent.stop(mouseEvent);\r\n\r\n\t\t\t// hide tooltip\r\n\t\t\tthis._map.mapObj.marker.hide();\r\n\r\n\t\t\t// event coords within component\r\n\t\t\tvar containerBounds = this._map._getContainerBounds();\r\n\t\t\tvar offX = mouseEvent.pageX - containerBounds.x,\r\n\t\t\t\toffY = mouseEvent.pageY - containerBounds.y;\r\n\r\n\t\t\t// current map point before zooming\r\n\t\t\tvar invariantMapPoint = this._map.screenCoordsToMapCoords(offX,offY);\r\n\r\n\t\t\t// zoom increment power\r\n\t\t\tvar power  = mouseEvent[(has(\"mozilla\") ? \"detail\" : \"wheelDelta\")] / (has(\"mozilla\") ? - 3 : 120) ;\r\n\t\t\tvar scaleFactor = Math.pow(1.2,power);\r\n\t\t\tthis._map.setMapScaleAt(this._map.getMapScale()*scaleFactor ,invariantMapPoint.x,invariantMapPoint.y,false);\r\n\t\t\tthis._map.mapObj.marker._needTooltipRefresh = true;\r\n\t\t}\r\n\t});\r\n});\r\n"]}