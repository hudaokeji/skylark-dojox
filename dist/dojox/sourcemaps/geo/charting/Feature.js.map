{"version":3,"sources":["geo/charting/Feature.js"],"names":["define","lang","declare","arr","html","dom","event","fx","color","_isZoomIn","isSelected","markerText","constructor","parent","name","shapeData","this","id","shape","mapObj","createGroup","_bbox","bbox","_center","center","_defaultFill","defaultColor","_highlightFill","highlightColor","_defaultStroke","width","_normalizeStrokeWeight","shapes","isArray","forEach","points","createPolyline","setStroke","unsetValue","value","unsetColor","col","Color","toHsl","l","fromHsl","_setFillWith","setValue","series","length","i","range","min","max","toHsv","v","fromHsv","borders","children","hitch","item","colorAnimationDuration","animateFill","start","getFill","end","duration","play","setFill","_setStrokeWith","stroke","join","weight","_getRealMatrix","dojox","gfx","renderer","xx","_onmouseoverHandler","evt","onFeatureOver","marker","show","_onmouseoutHandler","hide","style","_onmousemoveHandler","_needTooltipRefresh","enableFeatureZoom","fix","window","pageX","pageY","byId","className","_onclickHandler","onFeatureClick","_zoomOut","_zoomIn","deselectAll","select","selected","moveToFront","selectedFeature","fitToMapArea","onZoomEnd","fitToMapContents","init","tooltip"],"mappings":"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","file":"../../../geo/charting/Feature.js","sourcesContent":["define([\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/html\",\r\n\t\"dojo/dom\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojox/gfx/fx\",\r\n\t\"dojox/color\"\r\n], function(lang, declare,arr, html,dom, event, fx,color){\r\n\r\n\treturn declare(\"dojox.geo.charting.Feature\", null, {\r\n\t\t// summary:\r\n\t\t//\t\tA class to encapsulate a map element.\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\r\n\t\t_isZoomIn: false,\r\n\t\tisSelected: false,\r\n\t\tmarkerText:null,\r\n\r\n\r\n\t\tconstructor: function(parent, name, shapeData){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tconstructs a new Feature.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tthis.id = name;\r\n\t\t\tthis.shape = parent.mapObj.createGroup();\r\n\t\t\tthis.parent = parent;\r\n\t\t\tthis.mapObj = parent.mapObj;\r\n\t\t\tthis._bbox = shapeData.bbox;\r\n\t\t\tthis._center = shapeData.center;\r\n\t\t\t//TODO: fill color would be defined by charting data and legend\r\n\t//\t\tthis._highlightFill = [\"#FFCE52\", \"#CE6342\", \"#63A584\"][Math.floor(Math.random() * 3)];\r\n\t\t\tthis._defaultFill = parent.defaultColor;\r\n\t\t\tthis._highlightFill = parent.highlightColor;\r\n\t\t\tthis._defaultStroke = {\r\n\t\t\t\twidth: this._normalizeStrokeWeight(.5),\r\n\t\t\t\tcolor: \"white\"\r\n\t\t\t};\r\n\r\n\t\t\tvar shapes = (lang.isArray(shapeData.shape[0])) ? shapeData.shape : [shapeData.shape];\r\n\t\t\tarr.forEach(shapes, function(points){\r\n\t\t\t\tthis.shape.createPolyline(points).setStroke(this._defaultStroke);\r\n\t\t\t}, this);\r\n\t\t\tthis.unsetValue();\r\n\t\t},\r\n\t\tunsetValue:function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tclears the numeric value on this Feature object (removes color).\r\n\r\n\t\t\tthis.value = null;\r\n\t\t\tthis.unsetColor();\r\n\t\t},\r\n\t\tunsetColor:function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tclears the colors on this Feature object.\r\n\r\n\t\t\tthis._defaultFill = this.parent.defaultColor;\r\n\t\t\tvar col = new color.Color(this.parent.defaultColor).toHsl();\r\n\t\t\tcol.l = 1.2 * col.l;\r\n\t\t\tthis._highlightFill = color.fromHsl(col);\r\n\t\t\tthis._setFillWith(this._defaultFill);\r\n\t\t},\r\n\t\tsetValue:function(value){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tsets a numeric value on this Feature object (used together with series to apply a color).\r\n\t\t\t// value: Number\r\n\t\t\t//\t\tA numeric value.\r\n\r\n\t\t\tthis.value = value;\r\n\t\t\tif(value == null){\r\n\t\t\t\tthis.unsetValue();\r\n\t\t\t}else{\r\n\t\t\t\tif(this.parent.series.length != 0){\r\n\t\t\t\t\tfor(var i = 0; i < this.parent.series.length; i++){\r\n\t\t\t\t\t\tvar range = this.parent.series[i];\r\n\t\t\t\t\t\tif((value >= range.min) && (value < range.max)){\r\n\t\t\t\t\t\t\tthis._setFillWith(range.color);\r\n\t\t\t\t\t\t\tthis._defaultFill = range.color;\r\n\t\t\t\t\t\t\tvar col = new color.Color(range.color).toHsv();\r\n\t\t\t\t\t\t\tcol.v = (col.v + 20);\r\n\t\t\t\t\t\t\tthis._highlightFill = color.fromHsv(col);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// did not found a range : unset color\r\n\t\t\t\t\tthis.unsetColor();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t_setFillWith: function(color){\r\n\t\t\tvar borders = (lang.isArray(this.shape.children)) ? this.shape.children : [this.shape.children];\r\n\t\t\tarr.forEach(borders, lang.hitch(this,function(item){\r\n\t\t\t\tif(this.parent.colorAnimationDuration > 0){\r\n\t\t\t\t\tvar anim1 = fx.animateFill({\r\n\t\t\t\t\t\tshape: item,\r\n\t\t\t\t\t\tcolor: {\r\n\t\t\t\t\t\t\tstart: item.getFill(),\r\n\t\t\t\t\t\t\tend: color\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tduration: this.parent.colorAnimationDuration\r\n\t\t\t\t\t});\r\n\t\t\t\t\tanim1.play();\r\n\t\t\t\t}else{\r\n\t\t\t\t\titem.setFill(color);\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t},\r\n\t\t_setStrokeWith: function(stroke){\r\n\t\t\tvar borders = (lang.isArray(this.shape.children)) ? this.shape.children : [this.shape.children];\r\n\t\t\tarr.forEach(borders, function(item){\r\n\t\t\t\titem.setStroke({\r\n\t\t\t\t\tcolor: stroke.color,\r\n\t\t\t\t\twidth: stroke.width,\r\n\t\t\t\t\tjoin: \"round\"\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\t_normalizeStrokeWeight: function(weight){\r\n\t\t\tvar matrix = this.shape._getRealMatrix();\r\n\t\t\treturn (dojox.gfx.renderer != \"vml\")?weight/(this.shape._getRealMatrix()||{xx:1}).xx:weight;\r\n\t\t},\r\n\t\t_onmouseoverHandler: function(evt){\r\n\t\t\tthis.parent.onFeatureOver(this);\r\n\t\t\tthis._setFillWith(this._highlightFill);\r\n\t\t\tthis.mapObj.marker.show(this.id, evt);\r\n\t\t},\r\n\t\t_onmouseoutHandler: function(){\r\n\t\t\tthis._setFillWith(this._defaultFill);\r\n\t\t\tthis.mapObj.marker.hide();\r\n\t\t\thtml.style(\"mapZoomCursor\", \"display\", \"none\");\r\n\t\t},\r\n\t\t_onmousemoveHandler: function(evt){\r\n\t\t\tif(this.mapObj.marker._needTooltipRefresh){\r\n\t\t\t\tthis.mapObj.marker.show(this.id, evt);\r\n\t\t\t}\r\n\t\t\tif(this.isSelected && evt){\r\n\t\t\t\tif(this.parent.enableFeatureZoom){\r\n\t\t\t\t\tevt = event.fix(evt || window.event);\r\n\t\t\t\t\thtml.style(\"mapZoomCursor\", \"left\", evt.pageX + 12 + \"px\");\r\n\t\t\t\t\thtml.style(\"mapZoomCursor\", \"top\", evt.pageY + \"px\");\r\n\t\t\t\t\thtml.byId(\"mapZoomCursor\").className = this._isZoomIn ? \"mapZoomOut\":\"mapZoomIn\";\r\n\t\t\t\t\thtml.style(\"mapZoomCursor\", \"display\", \"block\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\thtml.style(\"mapZoomCursor\", \"display\", \"none\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t_onclickHandler: function(evt){\r\n\t\t\tthis.parent.onFeatureClick(this);\r\n\t\t\tif(!this.isSelected){\r\n\t\t\t\tthis.parent.deselectAll();\r\n\t\t\t\tthis.select(true);\r\n\t\t\t\tthis._onmousemoveHandler(evt);\r\n\t\t\t}else if(this.parent.enableFeatureZoom){\r\n\t\t\t\tif(this._isZoomIn){\r\n\t\t\t\t\tthis._zoomOut();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._zoomIn();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tselect: function(selected){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSets the selected state of this feature to the given value.\r\n\t\t\t// selected: Boolean\r\n\t\t\t//\t\tA Boolean value indicating the selected state.\r\n\r\n\t\t\tif(selected){\r\n\t\t\t\tthis.shape.moveToFront();\r\n\t\t\t\tthis._setStrokeWith({color:\"black\",width:this._normalizeStrokeWeight(2)});\r\n\t\t\t\tthis._setFillWith(this._highlightFill);\r\n\t\t\t\tthis.isSelected = true;\r\n\t\t\t\tthis.parent.selectedFeature = this;\r\n\t\t\t}else{\r\n\t\t\t\tthis._setStrokeWith(this._defaultStroke);\r\n\t\t\t\tthis._setFillWith(this._defaultFill);\r\n\t\t\t\tthis.isSelected = false;\r\n\t\t\t\tthis._isZoomIn = false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_zoomIn: function(){\r\n\t\t\tvar marker = this.mapObj.marker;\r\n\t\t\tmarker.hide();\r\n\t\t\tthis.parent.fitToMapArea(this._bbox, 15,true,lang.hitch(this,function(){\r\n\t\t\t\tthis._setStrokeWith({color:\"black\",width:this._normalizeStrokeWeight(2)});\r\n\t\t\t\tmarker._needTooltipRefresh = true;\r\n\t\t\t\tthis.parent.onZoomEnd(this);\r\n\t\t\t}));\r\n\t\t\tthis._isZoomIn = true;\r\n\t\t\tdom.byId(\"mapZoomCursor\").className = \"\";\r\n\t\t},\r\n\t\t_zoomOut: function(){\r\n\t\t\tvar marker = this.mapObj.marker;\r\n\t\t\tmarker.hide();\r\n\t\t\tthis.parent.fitToMapContents(3,true,lang.hitch(this,function(){\r\n\t\t\t\tthis._setStrokeWith({color:\"black\",width:this._normalizeStrokeWeight(2)});\r\n\t\t\t\tmarker._needTooltipRefresh = true;\r\n\t\t\t\tthis.parent.onZoomEnd(this);\r\n\t\t\t}));\r\n\t\t\tthis._isZoomIn = false;\r\n\t\t\tdom.byId(\"mapZoomCursor\").className = \"\";\r\n\t\t},\r\n\r\n\t\tinit: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInitializes this feature.\r\n\r\n\t\t\tthis.shape.id = this.id;\r\n\t\t\tthis.tooltip = null;\r\n\t\t}\r\n\t});\r\n});"]}