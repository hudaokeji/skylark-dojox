{"version":3,"sources":["geo/charting/KeyboardInteractionSupport.js"],"names":["define","lang","declare","event","connect","html","dom","functional","keys","_map","_zoomEnabled","constructor","map","options","this","enableZoom","container","byId","attr","tabindex","role","aria-label","_keydownListener","_onFocusListener","_onBlurListener","disconnect","keydownHandler","e","keyCode","LEFT_ARROW","_directTo","RIGHT_ARROW","UP_ARROW","DOWN_ARROW","SPACE","selectedFeature","_isZoomIn","_zoomIn","ESCAPE","_zoomOut","stop","onFocus","focused","leadingRegion","needClick","lastSelectedFeature","mapCenter","getMapCenter","minDistance","Infinity","forIn","mapObj","features","feature","distance","Math","sqrt","pow","_center","x","y","_onclickHandler","marker","show","id","onBlur","up","down","left","right","currentSelected","centerX","centerY","minMargin","nextSelected","paddingX","abs","paddingY","paddingSum","hide"],"mappings":"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","file":"../../../geo/charting/KeyboardInteractionSupport.js","sourcesContent":["define([\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/_base/connect\",\r\n\t\"dojo/_base/html\",\r\n\t\"dojo/dom\",\r\n\t\"dojox/lang/functional\",\r\n\t\"dojo/keys\"\r\n], function(lang, declare, event, connect, html, dom, functional, keys){\r\n\r\n\treturn declare(\"dojox.geo.charting.KeyboardInteractionSupport\", null, {\r\n\t\t// summary:\r\n\t\t//\t\tclass to handle keyboard interactions on a dojox.geo.charting.Map component.\r\n\t\t//\r\n\t\t//\t\tThe sections on the leading edge should receive the focus in response to a TAB event.\r\n\t\t//\t\tThen use cursor keys to the peer sections. The cursor event should go the adjacent section\r\n\t\t//\t\tin that direction. With the focus, the section zooms in upon SPACE. The map should zoom out\r\n\t\t//\t\ton ESC. Finally, while it has the focus, the map should lose the focus on TAB.\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\t\t_map: null,\r\n\t\t_zoomEnabled: false,\r\n\r\n\t\tconstructor: function(/*dojox/geo/charting/Map*/ map, /*Object?*/ options){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tConstructs a new _KeyboardInteractionSupport instance\r\n\t\t\t// map: dojox/geo/charting/Map\r\n\t\t\t//\t\tthe Map component this class provides touch navigation for.\r\n\t\t\t// options: Object?\r\n\t\t\t//\t\tAn object defining additional configuration properties. Currently,\r\n\t\t\t//\t\tonly the enableZoom property of this object is taken into account to enable/disable\r\n\t\t\t//\t\tthe Map zooming capability.\r\n\t\t\tthis._map = map;\r\n\t\t\tif(options){\r\n\t\t\t\tthis._zoomEnabled = options.enableZoom;\r\n\t\t\t}\r\n\t\t},\r\n\t\tconnect: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tconnects this keyboard support class to the Map component\r\n\t\t\tvar container = dom.byId(this._map.container);\r\n\t\t\t//\ttab accessing enable\r\n\t\t\thtml.attr(container, {\r\n\t\t\t\ttabindex: 0,\r\n\t\t\t\trole: \"presentation\",\r\n\t\t\t\t\"aria-label\": \"map\"\r\n\t\t\t});\r\n\t\t\t// install listeners\r\n\t\t\tthis._keydownListener = connect.connect(container, \"keydown\", this, \"keydownHandler\");\r\n\t\t\tthis._onFocusListener = connect.connect(container, \"focus\", this, \"onFocus\");\r\n\t\t\tthis._onBlurListener = connect.connect(container, \"blur\", this, \"onBlur\");\r\n\t\t},\r\n\t\tdisconnect: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tdisconnects any installed listeners\r\n\t\t\tconnect.disconnect(this._keydownListener);\r\n\t\t\tthis._keydownListener = null;\r\n\t\t\tconnect.disconnect(this._onFocusListener);\r\n\t\t\tthis._onFocusListener = null;\r\n\t\t\tconnect.disconnect(this._onBlurListener);\r\n\t\t\tthis._onBlurListener = null\r\n\t\t},\r\n\t\tkeydownHandler: function(/*KeyboardEvent*/e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandles a keydown event.\r\n\t\t\t// e: KeyboardEvent\r\n\t\t\t//\t\tAn event.\r\n\t\t\tswitch(e.keyCode){\r\n\t\t\t\tcase keys.LEFT_ARROW:\r\n\t\t\t\t\tthis._directTo(-1,-1,1,-1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keys.RIGHT_ARROW:\r\n\t\t\t\t\tthis._directTo(-1,-1,-1,1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keys.UP_ARROW:\r\n\t\t\t\t\tthis._directTo(1,-1,-1,-1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keys.DOWN_ARROW:\r\n\t\t\t\t\tthis._directTo(-1,1,-1,-1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keys.SPACE:\r\n\t\t\t\t\tif(this._map.selectedFeature && !this._map.selectedFeature._isZoomIn && this._zoomEnabled){\r\n\t\t\t\t\t\tthis._map.selectedFeature._zoomIn();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keys.ESCAPE:\r\n\t\t\t\t\tif(this._map.selectedFeature && this._map.selectedFeature._isZoomIn && this._zoomEnabled){\r\n\t\t\t\t\t\tthis._map.selectedFeature._zoomOut();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent.stop(e);\r\n\t\t},\r\n\t\tonFocus: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandles the onFocus event.\r\n\t\t\t// e: Event\r\n\t\t\t//\t\tAn event.\r\n\r\n\t\t\t// select the leading region at the map center\r\n\t\t\tif(this._map.selectedFeature || this._map.focused){return;}\r\n\t\t\tthis._map.focused = true;\r\n\t\t\tvar leadingRegion,\r\n\t\t\t\tneedClick = false;\r\n\t\t\tif(this._map.lastSelectedFeature){\r\n\t\t\t\tleadingRegion = this._map.lastSelectedFeature;\r\n\t\t\t}else{\r\n\t\t\t\tvar mapCenter = this._map.getMapCenter(),\r\n\t\t\t\t\tminDistance = Infinity;\r\n\t\t\t\t// find the region most closing to the map center\r\n\t\t\t\tfunctional.forIn(this._map.mapObj.features, function(feature){\r\n\t\t\t\t\tvar distance = Math.sqrt(Math.pow(feature._center[0] - mapCenter.x, 2) + Math.pow(feature._center[1] - mapCenter.y, 2));\r\n\t\t\t\t\tif(distance < minDistance){\r\n\t\t\t\t\t\tminDistance = distance;\r\n\t\t\t\t\t\tleadingRegion = feature;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tneedClick = true;\r\n\t\t\t}\r\n\t\t\tif(leadingRegion){\r\n\t\t\t\tif(needClick){\r\n\t\t\t\t\tleadingRegion._onclickHandler(null);\r\n\t\t\t\t}\r\n\t\t\t\tthis._map.mapObj.marker.show(leadingRegion.id);\r\n\t\t\t}\r\n\t\t},\r\n\t\tonBlur: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandles the onBlur event.\r\n\t\t\tthis._map.lastSelectedFeature = this._map.selectedFeature;\r\n\t\t},\r\n\t\t_directTo: function(up, down, left, right){\r\n\t\t\tvar currentSelected = this._map.selectedFeature,\r\n\t\t\tcenterX = currentSelected._center[0],\r\n\t\t\tcenterY = currentSelected._center[1],\r\n\t\t\tminMargin = Infinity,\r\n\t\t\tnextSelected = null;\r\n\t\t\tfunctional.forIn(this._map.mapObj.features, function(feature){\r\n\t\t\t\tvar paddingX = Math.abs(centerX - feature._center[0]),\r\n\t\t\t\tpaddingY = Math.abs(centerY - feature._center[1]),\r\n\t\t\t\tpaddingSum = paddingX + paddingY;\r\n\t\t\t\tif((up - down) * (centerY - feature._center[1]) > 0){\r\n\t\t\t\t\tif(paddingX < paddingY && minMargin > paddingSum){\r\n\t\t\t\t\t\tminMargin = paddingSum;\r\n\t\t\t\t\t\tnextSelected = feature;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif((left - right) * (centerX - feature._center[0]) > 0){\r\n\t\t\t\t\tif(paddingX > paddingY && minMargin > paddingSum){\r\n\t\t\t\t\t\tminMargin = paddingSum;\r\n\t\t\t\t\t\tnextSelected = feature;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif(nextSelected){\r\n\t\t\t\tthis._map.mapObj.marker.hide();\r\n\t\t\t\tnextSelected._onclickHandler(null);\r\n\t\t\t\tthis._map.mapObj.marker.show(nextSelected.id);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n});"]}