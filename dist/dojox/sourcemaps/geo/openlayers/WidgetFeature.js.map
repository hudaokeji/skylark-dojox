{"version":3,"sources":["geo/openlayers/WidgetFeature.js"],"names":["define","declare","style","lang","registry","Feature","_widget","_bbox","constructor","params","this","_params","setParameters","getParameters","_getWidget","w","createWidget","call","dojoType","dojo","getObject","dijitId","byId","widget","startup","n","domNode","set","position","_getWidgetWidth","p","width","get","_getWidgetHeight","height","render","layer","getLayer","lon","longitude","lat","latitude","from","getCoordinateSystem","getDojoMap","transformXY","a","_getLocalXY","x","y","dom","pa","olLayer","div","parentNode","removeChild","appendChild","_updateWidgetPosition","box","left","top","srcNodeRef","isFunction","resize","h","remove"],"mappings":"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","file":"../../../geo/openlayers/WidgetFeature.js","sourcesContent":["define([\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/dom-style\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dijit/registry\",\r\n\t\"./Feature\"\r\n], function(declare, style, lang, registry, Feature){\r\n\t/*=====\r\n\tdojox.geo.openlayers.__WidgetFeatureArgs = {\r\n\t\t// summary:\r\n\t\t//\t\tThe keyword arguments that can be passed in a WidgetFeature constructor.\r\n\t\t//\t\tYou must define a least one widget retrieval parameter and the geo-localization parameters.\r\n\t\t// createWidget: Function?\r\n\t\t//\t\tFunction for widget creation. Must return a `dijit._Widget.\r\n\t\t// dojoType: String?\r\n\t\t//\t\tThe class of a widget to create.\r\n\t\t// dijitId: String?\r\n\t\t//\t\tThe digitId of an existing widget.\r\n\t\t// widget: dijit._Widget?\r\n\t\t//\t\tAn already created widget.\r\n\t\t// width: Number?\r\n\t\t//\t\tThe width of the widget.\r\n\t\t// height: Number?\r\n\t\t//\t\tThe height of the widget.\r\n\t\t// longitude: Number\r\n\t\t//\t\tThe longitude, in decimal degrees where to place the widget.\r\n\t\t// latitude: Number\r\n\t\t//\t\tThe latitude, in decimal degrees where to place the widget.\r\n\t};\r\n\t=====*/\r\n\r\n\t\treturn declare(\"dojox.geo.openlayers.WidgetFeature\", Feature, {\r\n\t\t\t// summary:\r\n\t\t\t//\t\tWraps a Dojo widget, provide geolocalisation of the widget and interface\r\n\t\t\t//\t\tto Layer class.\r\n\t\t\t// description:\r\n\t\t\t//\t\tThis class allows to add a widget in a `dojox.geo.openlayers.Layer`.\r\n\r\n\t\t\t_widget: null,\r\n\t\t\t_bbox: null,\r\n\r\n\t\t\tconstructor: function(params){\r\n\t\t\t\t// summary:\r\n\t\t\t\t//\t\tConstructs a new `dojox.geo.openlayers.WidgetFeature`\r\n\t\t\t\t// params: dojox.geo.openlayers.__WidgetFeatureArgs\r\n\t\t\t\t//\t\tThe parameters describing the widget.\r\n\t\t\t\tthis._params = params;\r\n\t\t\t},\r\n\r\n\t\t\tsetParameters: function(params){\r\n\t\t\t\t// summary:\r\n\t\t\t\t//\t\tSets the parameters describing the widget.\r\n\t\t\t\t// params: dojox.geo.openlayers.__WidgetFeatureArgs\r\n\t\t\t\t//\t\tThe parameters describing the widget.\r\n\t\t\t\tthis._params = params;\r\n\t\t\t},\r\n\r\n\t\t\tgetParameters: function(){\r\n\t\t\t\t// summary:\r\n\t\t\t\t//\t\tReturns the parameters describing the widget.\r\n\t\t\t\t// returns: dojox.geo.openlayers.__WidgetFeatureArgs\r\n\t\t\t\t//\t\tThe parameters describing the widget.\r\n\t\t\t\treturn this._params;\r\n\t\t\t},\r\n\r\n\t\t\t_getWidget: function(){\r\n\t\t\t\t// summary:\r\n\t\t\t\t//\t\tCreates, if necessary the widget and returns it\r\n\t\t\t\t// tags:\r\n\t\t\t\t//\t\tprivate\r\n\t\t\t\tvar params = this._params;\r\n\r\n\t\t\t\tif((this._widget == null) && (params != null)){\r\n\t\t\t\t\tvar w = null;\r\n\r\n\t\t\t\t\tif(typeof (params.createWidget) == \"function\"){\r\n\t\t\t\t\t\tw = params.createWidget.call(this);\r\n\t\t\t\t\t}else if(params.dojoType){\r\n\t\t\t\t\t\tdojo[\"require\"](params.dojoType);\r\n\t\t\t\t\t\tvar c = lang.getObject(params.dojoType);\r\n\t\t\t\t\t\tw = new c(params);\r\n\t\t\t\t\t}else if(params.dijitId){\r\n\t\t\t\t\t\tw = registry.byId(params.dijitId);\r\n\t\t\t\t\t}else if(params.widget){\r\n\t\t\t\t\t\tw = params.widget;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(w != null){\r\n\t\t\t\t\t\tthis._widget = w;\r\n\t\t\t\t\t\tif(typeof (w.startup) == \"function\"){\r\n\t\t\t\t\t\t\tw.startup();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar n = w.domNode;\r\n\t\t\t\t\t\tif(n != null){\r\n\t\t\t\t\t\t\tstyle.set(n, {\r\n\t\t\t\t\t\t\t\tposition: \"absolute\"\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._widget = w;\r\n\t\t\t\t}\r\n\t\t\t\treturn this._widget;\r\n\t\t\t},\r\n\r\n\t\t\t_getWidgetWidth: function(){\r\n\t\t\t\t// summary:\r\n\t\t\t\t//\t\tgets the widget width\r\n\t\t\t\t// tags:\r\n\t\t\t\t//\t\tprivate\r\n\t\t\t\tvar p = this._params;\r\n\t\t\t\tif(p.width){\r\n\t\t\t\t\treturn p.width;\r\n\t\t\t\t}\r\n\t\t\t\tvar w = this._getWidget();\r\n\t\t\t\tif(w){\r\n\t\t\t\t\treturn style.get(w.domNode, \"width\");\r\n\t\t\t\t}\r\n\t\t\t\treturn 10;\r\n\t\t\t},\r\n\r\n\t\t\t_getWidgetHeight: function(){\r\n\t\t\t\t// summary:\r\n\t\t\t\t//\t\tgets the widget height\r\n\t\t\t\t// tags:\r\n\t\t\t\t//\t\tprivate\r\n\t\t\t\tvar p = this._params;\r\n\t\t\t\tif(p.height){\r\n\t\t\t\t\treturn p.height;\r\n\t\t\t\t}\r\n\t\t\t\tvar w = this._getWidget();\r\n\t\t\t\tif(w){\r\n\t\t\t\t\treturn style.get(w.domNode, \"height\");\r\n\t\t\t\t}\r\n\t\t\t\treturn 10;\r\n\t\t\t},\r\n\r\n\t\t\trender: function(){\r\n\t\t\t\t// summary:\r\n\t\t\t\t//\t\trenders the widget.\r\n\t\t\t\t// description:\r\n\t\t\t\t//\t\tPlaces the widget accordingly to longitude and latitude defined in parameters.\r\n\t\t\t\t//\t\tThis function is called when the center of the maps or zoom factor changes.\r\n\t\t\t\tvar layer = this.getLayer();\r\n\r\n\t\t\t\tvar widget = this._getWidget();\r\n\t\t\t\tif(widget == null){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar params = this._params;\r\n\t\t\t\tvar lon = params.longitude;\r\n\t\t\t\tvar lat = params.latitude;\r\n\t\t\t\tvar from = this.getCoordinateSystem();\r\n\t\t\t\tvar map = layer.getDojoMap();\r\n\t\t\t\tvar p = map.transformXY(lon, lat, from);\r\n\t\t\t\tvar a = this._getLocalXY(p);\r\n\r\n\t\t\t\tvar width = this._getWidgetWidth();\r\n\t\t\t\tvar height = this._getWidgetHeight();\r\n\r\n\t\t\t\tvar x = a[0] - width / 2;\r\n\t\t\t\tvar y = a[1] - height / 2;\r\n\t\t\t\tvar dom = widget.domNode;\r\n\r\n\t\t\t\tvar pa = layer.olLayer.div;\r\n\t\t\t\tif(dom.parentNode != pa){\r\n\t\t\t\t\tif(dom.parentNode){\r\n\t\t\t\t\t\tdom.parentNode.removeChild(dom);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpa.appendChild(dom);\r\n\t\t\t\t}\r\n\t\t\t\tthis._updateWidgetPosition({\r\n\t\t\t\t\tx: x,\r\n\t\t\t\t\ty: y,\r\n\t\t\t\t\twidth: width,\r\n\t\t\t\t\theight: height\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t_updateWidgetPosition: function(box){\r\n\t\t\t\t// summary:\r\n\t\t\t\t//\t\tPlaces the widget with the computed x and y values\r\n\t\t\t\t// tags:\r\n\t\t\t\t//\t\tprivate\r\n\t\t\t\t\r\n\t\t\t\t// var box = this._params;\r\n\r\n\t\t\t\tvar w = this._widget;\r\n\t\t\t\tvar dom = w.domNode;\r\n\r\n\t\t\t\tstyle.set(dom, {\r\n\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\tleft: box.x + \"px\",\r\n\t\t\t\t\ttop: box.y + \"px\",\r\n\t\t\t\t\twidth: box.width + \"px\",\r\n\t\t\t\t\theight: box.height + \"px\"\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(w.srcNodeRef){\r\n\t\t\t\t\tstyle.set(w.srcNodeRef, {\r\n\t\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\t\tleft: box.x + \"px\",\r\n\t\t\t\t\t\ttop: box.y + \"px\",\r\n\t\t\t\t\t\twidth: box.width + \"px\",\r\n\t\t\t\t\t\theight: box.height + \"px\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(lang.isFunction(w.resize)){\r\n\t\t\t\t\tw.resize({\r\n\t\t\t\t\t\tw: box.width,\r\n\t\t\t\t\t\th: box.height\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tremove: function(){\r\n\t\t\t\t// summary:\r\n\t\t\t\t//\t\tremoves this feature.\r\n\t\t\t\t// description:\r\n\t\t\t\t//\t\tRemove this feature by disconnecting the widget from the dom.\r\n\t\t\t\tvar w = this._getWidget();\r\n\t\t\t\tif(!w){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar dom = w.domNode;\r\n\t\t\t\tif(dom.parentNode){\r\n\t\t\t\t\tdom.parentNode.removeChild(dom);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n"]}