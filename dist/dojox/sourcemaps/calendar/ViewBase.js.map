{"version":3,"sources":["calendar/ViewBase.js"],"names":["define","declare","lang","arr","win","event","html","has","query","dom","domStyle","domClass","domConstruct","domGeometry","on","date","locale","when","_WidgetBase","_Invalidating","Selection","timeUtil","StoreMixin","StoreManager","RendererManager","datePackage","_calendar","viewKind","_layoutStep","_layoutUnit","resizeCursor","formatItemTimeFunc","_cssDays","_getFormatItemTimeFuncAttr","this","owner","get","_viewHandles","doubleTapDelay","constructor","args","substr","lastIndexOf","dateModule","getObject","dateClassObj","Date","dateLocaleModule","storeManager","_ownerItemsProperty","hitch","_refreshItemsRendering","items","set","rendererManager","_onRendererCreated","_onRendererReused","_onRendererRecycled","_onRendererDestroyed","item","updateRenderers","decorationStoreManager","_refreshDecorationItemsRendering","decorationRendererManager","destroy","preserveDom","length","pop","remove","inherited","arguments","resize","changeSize","setMarginBox","domNode","beforeActivate","afterActivate","beforeDeactivate","afterDeactivate","_getTopOwner","p","undefined","_createRenderData","_validateProperties","_setText","node","text","allowHTML","hasChildNodes","childNodes","nodeValue","removeChild","lastChild","tNode","doc","createElement","applyTextDir","innerHTML","appendChild","createTextNode","isAscendantHasClass","ancestor","className","document","contains","parentNode","isWeekEnd","isWeekend","getWeekNumberLabel","toGregorian","format","selector","datePattern","addAndFloor","unit","steps","d","add","getHours","floorToDay","reuse","floorToMonth","floorDate","floor","isToday","isStartOfDay","isOverlapping","renderData","start1","end1","start2","end2","includeLimits","computeRangeOverlap","cal","comp1","compare","comp2","newDate","isSameDay","date1","date2","getFullYear","getMonth","getDate","computeProjectionOnDate","refDate","max","minH","minHours","maxH","maxHours","res","gt","getMinutes","getSeconds","referenceDate","maxTime","clone","minTime","setHours","delta","d2","dp1","getTime","e","x","y","touchIndex","getSubColumn","getSubColumnIndex","value","subColumns","i","obj","_isItemInView","rd","startTime","endTime","_ensureItemInView","duration","Math","abs","difference","fixed","scrollable","autoScroll","_autoScroll","gx","gy","orientation","scrollMethod","_setScrollMethodAttr","_domScroll","sheetContainer","_cssPrefix","scrollContainer","scrollTop","pos","_getScrollPosition","_scrollPos","_setScrollPosition","_startAutoScroll","step","sp","_scrollProps","scrollStep","isScrolling","scrollTimer","setInterval","_onScrollTimer_tick","_stopAutoScroll","clearInterval","_hscrollPos","getCSSPrefix","_hScrollNodes","_setScrollPositionBase","vertical","_hScrollPos","sm","containerSize","getMarginBox","h","gridSize","grid","gridTable","w","rtl","isLeftToRight","forEach","elt","cssProp","css","_setHScrollPosition","_setHScrollPositionImpl","useDom","cssProperty","scrollLeft","_getHScrollPosition","scrollView","dir","ensureVisibility","start","end","margin","visibilityTarget","_getStoreAttr","store","_setItemsAttr","_set","displayedItemsInvalidated","_computeVisibleItems","_layoutRenderers","_layoutDecorationRenderers","invalidateLayout","_setDecorationItemsAttr","displayedDecorationItemsInvalidated","_getDecorationStoreAttr","decorationStore","_setDecorationStoreAttr","computeOverlapping","layoutItems","func","numLanes","addedPassRes","lanes","layoutItem","_layoutPass1","stop","lane","j","extent","push","_layoutInterval","index","layoutPriorityFunction","_sortItemsFunction","a","b","_layoutRenderersImpl","decorationItems","itemType","recycleItemRenderers","endDate","events","startDate","itemsTemp","concat","processing","filter","r","id","sort","_onRenderersLayoutDone","_recycleItemRenderers","getRenderers","itemToRendererKindFunc","_itemToRendererKind","_defaultItemToRendererKindFunc","_createRenderer","kind","rendererClass","cssClass","createRenderer","source","onRendererCreated","onRendererRecycled","onRendererReused","onRendererDestroyed","view","onRenderersLayoutDone","_recycleRenderer","renderer","recycleRenderer","_destroyRenderer","destroyRenderer","_destroyRenderersByKind","destroyRenderersByKind","_updateEditingCapabilities","moveEnabled","isItemMoveEnabled","rendererKind","resizeEnabled","isItemResizeEnabled","changed","updateRendering","stateOnly","isArray","list","itemToRenderer","selected","isItemSelected","hovered","isItemHovered","edited","isItemBeingEdited","focused","showFocus","isItemFocused","getItemStoreState","applyRendererZIndex","container","zIndex","getIdentity","_setHoveredItem","hoveredItem","old","_item","_isEditing","_edProps","editedItem","_isItemFocused","_setSelectionModeAttr","_getSelectionModeAttr","_setSelectedItemAttr","_getSelectedItemAttr","selectedItem","_setSelectedItemsAttr","_getSelectedItemsAttr","selectFromEvent","dispatch","setItemSelected","createItemFunc","_getCreateItemFuncAttr","createOnGridClick","_getCreateOnGridClickAttr","_gridMouseDown","_tempIdCount","_tempItemsMap","_onGridMouseDown","_endItemEditing","_doEndItemEditing","_setTabIndexAttr","focus","_onRendererHandleMouseDown","f","newItem","_createdEvent","idProperty","newRenderItem","itemToRenderItem","_setItemStoreState","renderers","_startItemEditing","_onGridMouseMove","_onGridMouseUp","_onGridTouchStart","_gridProps","fromItem","target","eventContainer","editingOnStart","mixin","_getTouchesOnRenderers","touchesLen","endEditingTimer","clearTimeout","eventSource","_onGridTouchEnd","_onGridTouchMove","__fixEvt","_dispatchCalendarEvt","name","_onGridClick","triggerEvent","onGridClick","_onGridDoubleClick","onGridDoubleClick","_onItemClick","onItemClick","_onItemDoubleClick","onItemDoubleClick","_onItemContextMenu","onItemContextMenu","_getStartEndRenderers","resizeStartFound","resizeEndFound","ir","range","editable","isItemEditable","_setEditingProperties","props","storeItem","secItem","_secondarySheet","_findRenderItem","ownerItem","liveLayout","editSaveStartTime","editSaveEndTime","editItemToRenderer","editItems","editRendererList","rendererList","editRendererIndices","_onItemEditBegin","_editStartTimeSave","_editEndTimeSave","onItemEditBegin","canceled","_editingGesture","_endItemEditingGesture","handles","handle","_onItemEditEnd","_createItemEditEvent","completed","isDefaultPrevented","renderItemToItem","s","_getItemStoreStateObj","state","oldID","options","temporaryId","isObject","_removeRenderItem","put","found","splice","_cleanItemStoreState","onItemEditEnd","cancelable","bubbles","__defaultPrevent","preventDefault","__defaultPrevented","_startItemEditingGesture","dates","editKind","_onItemEditBeginGesture","itemBeginDispatched","editingTimeFrom","editingItemRefTime","inViewOnce","roundToDay","_itemEditBeginSave","_itemEditEndSave","_initDuration","allDay","cursor","editLayer","create","style","_blankGif","onresizestart","onselectstart","onItemEditBeginGesture","_waDojoxAddIssue","gd","_computeItemEditingTimes","times","diff","_moveOrResizeItemGesture","subColumn","newTimes","newTime","moveOrResizeDone","oldStart","oldEnd","oldSubColumn","allowSwap","allowStartEndSwap","allowSubColumnMove","resizeEndTouchIndex","resizeStartTouchIndex","setMinutes","setSeconds","t","evt","_onItemEditMoveGesture","_onItemEditResizeGesture","tmp","newStartTime","newEndTime","snapUnit","snapSteps","stayInView","_DAY_IN_MILLISECONDS","onItemEditMoveGesture","minimalDay","allowResizeLessThan24H","ensureMinimalDuration","minDurationUnit","minDurationSteps","onItemEditResizeGesture","_onItemEditEndGesture","setTimeout","onItemEditEndGesture"],"mappings":"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","file":"../../calendar/ViewBase.js","sourcesContent":["define([\r\n\t\"dojo/_base/declare\",\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/_base/array\",\r\n\t\"dojo/_base/window\",\r\n\t\"dojo/_base/event\",\r\n\t\"dojo/_base/html\",\r\n\t\"dojo/sniff\",\r\n\t\"dojo/query\",\r\n\t\"dojo/dom\",\r\n\t\"dojo/dom-style\",\r\n\t\"dojo/dom-class\",\r\n\t\"dojo/dom-construct\",\r\n\t\"dojo/dom-geometry\",\r\n\t\"dojo/on\",\r\n\t\"dojo/date\",\r\n\t\"dojo/date/locale\",\r\n\t\"dojo/when\",\r\n\t\"dijit/_WidgetBase\",\r\n\t\"dojox/widget/_Invalidating\",\r\n\t\"dojox/widget/Selection\",\r\n\t\"dojox/calendar/time\",\r\n\t\"./StoreMixin\",\r\n\t\"./StoreManager\",\r\n\t\"./RendererManager\"],\r\n\r\n\tfunction(\r\n\t\tdeclare,\r\n\t\tlang,\r\n\t\tarr,\r\n\t\twin,\r\n\t\tevent,\r\n\t\thtml,\r\n\t\thas,\r\n\t\tquery,\r\n\t\tdom,\r\n\t\tdomStyle,\r\n\t\tdomClass,\r\n\t\tdomConstruct,\r\n\t\tdomGeometry,\r\n\t\ton,\r\n\t\tdate,\r\n\t\tlocale,\r\n\t\twhen,\r\n\t\t_WidgetBase,\r\n\t\t_Invalidating,\r\n\t\tSelection,\r\n\t\ttimeUtil,\r\n\t\tStoreMixin,\r\n\t\tStoreManager,\r\n\t\tRendererManager){\r\n\t\r\n\t/*=====\r\n\tvar __GridClickEventArgs = {\r\n\t\t// summary:\r\n\t\t//\t\tThe event dispatched when the grid is clicked or double-clicked.\r\n\t\t// date: Date\r\n\t\t//\t\tThe start of the previously displayed time interval, if any. \r\n\t\t// triggerEvent: Event\r\n\t\t//\t\tThe event at the origin of this event.\r\n\t};\r\n\t=====*/\r\n\t\r\n\t/*=====\r\n\tvar __ItemMouseEventArgs = {\r\n\t\t// summary:\r\n\t\t//\t\tThe event dispatched when an item is clicked, double-clicked or context-clicked.\r\n\t\t// item: Object\r\n\t\t//\t\tThe item clicked.\r\n\t\t// renderer: dojox/calendar/_RendererMixin\r\n\t\t//\t\tThe item renderer clicked.\r\n\t\t// triggerEvent: Event\r\n\t\t//\t\tThe event at the origin of this event.\r\n\t};\r\n\t=====*/\r\n\t\r\n\t/*=====\r\n\tvar __itemEditingEventArgs = {\r\n\t\t// summary:\r\n\t\t//\t\tAn item editing event.\r\n\t\t// item: Object\r\n\t\t//\t\tThe render item that is being edited. Set/get the startTime and/or endTime properties to customize editing behavior.\r\n\t\t// storeItem: Object\r\n\t\t//\t\tThe real data from the store. DO NOT change properties, but you may use properties of this item in the editing behavior logic.\r\n\t\t// editKind: String\r\n\t\t//\t\tKind of edit: \"resizeBoth\", \"resizeStart\", \"resizeEnd\" or \"move\".\r\n\t\t// dates: Date[]\r\n\t\t//\t\tThe computed date/time of the during the event editing. One entry per edited date (touch use case).\r\n\t\t// startTime: Date?\r\n\t\t//\t\tThe start time of data item.\r\n\t\t// endTime: Date?\r\n\t\t//\t\tThe end time of data item.\r\n\t\t// sheet: String\r\n\t\t//\t\tFor views with several sheets (columns view for example), the sheet when the event occurred.\r\n\t\t// source: dojox/calendar/ViewBase\r\n\t\t//\t\tThe view where the event occurred.\r\n\t\t// eventSource: String\r\n\t\t//\t\tThe device that triggered the event. This property can take the following values:\r\n\t\t//\r\n\t\t//\t\t- \"mouse\", \r\n\t\t//\t\t- \"keyboard\", \r\n\t\t//\t\t- \"touch\"\t\t\r\n\t\t// triggerEvent: Event\r\n\t\t//\t\tThe event at the origin of this event.\r\n\t};\r\n\t=====*/\r\n\t\r\n\t/*=====\r\n\tvar __rendererLifecycleEventArgs = {\r\n\t\t// summary:\r\n\t\t//\t\tAn renderer lifecycle event.\r\n\t\t// renderer: Object\r\n\t\t//\t\tThe renderer.\t\t\r\n\t\t// source: dojox/calendar/ViewBase\r\n\t\t//\t\tThe view where the event occurred.\r\n\t\t// item:Object?\r\n\t\t//\t\tThe item that will be displayed by the renderer for the \"rendererCreated\" and \"rendererReused\" events. \r\n\t};\r\n\t=====*/\r\n\t\t\r\n\treturn declare(\"dojox.calendar.ViewBase\", [_WidgetBase, StoreMixin, _Invalidating, Selection], {\r\n\t\t\r\n\t\t// summary:\r\n\t\t//\t\tThe dojox.calendar.ViewBase widget is the base of calendar view widgets\r\n\t\t\r\n\t\t// datePackage: Object\r\n\t\t//\t\tJavaScript namespace to find Calendar routines. Uses Gregorian Calendar routines at dojo.date by default.\r\n\t\tdatePackage: date,\r\n\t\t\r\n\t\t_calendar: \"gregorian\",\r\n\t\t\r\n\t\t// viewKind: String\r\n\t\t//\t\tKind of the view. Used by the calendar widget to determine how to configure the view.\r\n\t\tviewKind: null,\r\n\t\t\r\n\t\t// _layoutStep: [protected] Integer\r\n\t\t//\t\tThe number of units displayed by a visual layout unit (i.e. a column or a row)\r\n\t\t_layoutStep: 1,\r\n\t\t\r\n\t\t// _layoutStep: [protected] Integer\r\n\t\t//\t\tThe unit displayed by a visual layout unit (i.e. a column or a row)\r\n\t\t_layoutUnit: \"day\",\r\n\t\t\r\n\t\t// resizeCursor: String\r\n\t\t//\t\tCSS value to apply to the cursor while resizing an item renderer. \r\n\t\tresizeCursor: \"n-resize\",\r\n\t\t\r\n\t\t// formatItemTimeFunc: Function\r\n\t\t//\t\tOptional function to format the time of day of the item renderers.\r\n\t\t//\t\tThe function takes the date, the render data object, the view and the data item as arguments and returns a String.\r\n\t\tformatItemTimeFunc: null,\r\n\t\t\r\n\t\t_cssDays: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\r\n\t\t\t\t\r\n\t\t_getFormatItemTimeFuncAttr: function(){\t\t\t\r\n\t\t\tif(this.formatItemTimeFunc){\r\n\t\t\t\treturn this.formatItemTimeFunc;\r\n\t\t\t}\t\t\t\r\n\t\t\tif(this.owner != null){\r\n\t\t\t\treturn this.owner.get(\"formatItemTimeFunc\");\r\n\t\t\t}\t\t\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t// The listeners added by the view itself.\r\n\t\t_viewHandles: null,\r\n\t\t\r\n\t\t// doubleTapDelay: Integer\r\n\t\t//\t\tThe maximum time amount in milliseconds between to touchstart events that trigger a double-tap event.  \r\n\t\tdoubleTapDelay: 300,\r\n\t\t\r\n\t\tconstructor: function(/*Object*/ args){\r\n\t\t\targs = args || {};\r\n\t\t\t\r\n\t\t\tthis._calendar = args.datePackage ? args.datePackage.substr(args.datePackage.lastIndexOf(\".\")+1) : this._calendar; \r\n\t\t\tthis.dateModule = args.datePackage ? lang.getObject(args.datePackage, false) : date; \r\n\t\t\tthis.dateClassObj = this.dateModule.Date || Date; \r\n\t\t\tthis.dateLocaleModule = args.datePackage ? lang.getObject(args.datePackage+\".locale\", false) : locale; \r\n\t\t\t\t\t\t\r\n\t\t\tthis._viewHandles = [];\r\n\t\t\t\r\n\t\t\tthis.storeManager = new StoreManager({owner: this, _ownerItemsProperty: \"items\"});\r\n\t\t\tthis.storeManager.on(\"layoutInvalidated\", lang.hitch(this, this._refreshItemsRendering));\r\n\t\t\tthis.storeManager.on(\"dataLoaded\", lang.hitch(this, function(items){\r\n\t\t\t\tthis.set(\"items\", items);\r\n\t\t\t}));\r\n\t\t\t\r\n\t\t\tthis.rendererManager = new RendererManager({owner: this});\r\n\t\t\tthis.rendererManager.on(\"rendererCreated\", lang.hitch(this, this._onRendererCreated));\r\n\t\t\tthis.rendererManager.on(\"rendererReused\", lang.hitch(this, this._onRendererReused));\r\n\t\t\tthis.rendererManager.on(\"rendererRecycled\", lang.hitch(this, this._onRendererRecycled));\r\n\t\t\tthis.rendererManager.on(\"rendererDestroyed\", lang.hitch(this, this._onRendererDestroyed));\r\n\t\t\tthis.rendererManager.on(\"layoutInvalidated\", lang.hitch(this, this._refreshItemsRendering));\r\n\t\t\tthis.rendererManager.on(\"renderersInvalidated\", lang.hitch(this, function(item){\r\n\t\t\t\tthis.updateRenderers(item);}\r\n\t\t\t));\r\n\t\t\t\r\n\t\t\tthis.decorationStoreManager = new StoreManager({owner: this, _ownerItemsProperty: \"decorationItems\"});\r\n\t\t\tthis.decorationStoreManager.on(\"layoutInvalidated\", lang.hitch(this, this._refreshDecorationItemsRendering));\r\n\t\t\tthis.decorationStoreManager.on(\"dataLoaded\", lang.hitch(this, function(items){\r\n\t\t\t\tthis.set(\"decorationItems\", items);\r\n\t\t\t}));\r\n\t\t\tthis.decorationRendererManager = new RendererManager({owner: this});\r\n\t\t},\r\n\t\t\r\n\t\tdestroy: function(preserveDom){\r\n\t\t\t\r\n\t\t\tthis.rendererManager.destroy();\r\n\t\t\tthis.decorationRendererManager.destroy();\r\n\t\t\t\r\n\t\t\twhile(this._viewHandles.length > 0){\r\n\t\t\t\tthis._viewHandles.pop().remove();\r\n\t\t\t}\r\n\t\t\r\n\t\t\tthis.inherited(arguments);\r\n\t\t},\r\n\t\t\r\n\t\tresize: function(changeSize){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to call when the view is resized. \r\n\t\t\t//\t\tIf the view is in a Dijit container or in a Dojo mobile container, it will be automatically called.\r\n\t\t\t//\t\tOn other use cases, this method must called when the window is resized and/or when the orientation has changed.\r\n\t\t\tif(changeSize){\r\n\t\t\t\tdomGeometry.setMarginBox(this.domNode, changeSize);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// view lifecycle methods\r\n\t\tbeforeActivate: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction invoked just before the view is displayed by the calendar.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\t\t\r\n\t\t},\r\n\t\t\r\n\t\tafterActivate: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction invoked just after the view is displayed by the calendar.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t},\r\n\t\t\r\n\t\tbeforeDeactivate: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction invoked just before the view is hidden or removed by the calendar.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t},\r\n\t\t\r\n\t\tafterDeactivate: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction invoked just after the view is the view is hidden or removed by the calendar.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t},\r\n\t\t\r\n\t\t_getTopOwner: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns the top owner: the calendar or the parent view.\r\n\t\t\tvar p = this;\r\n\t\t\twhile(p.owner != undefined){\r\n\t\t\t\tp = p.owner;\r\n\t\t\t}\r\n\t\t\treturn p;\r\n\t\t},\r\n\t\t\r\n\t\t_createRenderData: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreates the object that contains all the data needed to render this widget.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t},\r\n\t\t\r\n\t\t_validateProperties: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tValidates the widget properties before the rendering pass.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t},\r\n\r\n\t\t_setText: function(node, text, allowHTML){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreates a text node under the parent node after having removed children nodes if any.\r\n\t\t\t// node: Node\r\n\t\t\t//\t\tThe node that will contain the text node.\r\n\t\t\t// text: String\r\n\t\t\t//\t\tThe text to set to the text node.\r\n\t\t\tif(text != null){\t\t\t\r\n\t\t\t\tif(!allowHTML && node.hasChildNodes()){\r\n\t\t\t\t\t// span > textNode\r\n\t\t\t\t\tnode.childNodes[0].childNodes[0].nodeValue = text;\r\n\t\t\t\t}else{\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\r\n\t\t\t\t\twhile(node.hasChildNodes()){\r\n\t\t\t\t\t\tnode.removeChild(node.lastChild);\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\r\n\t\t\t\t\tvar tNode = win.doc.createElement(\"span\");\r\n\t\t\t\t\tif(has(\"dojo-bidi\")){\r\n\t\t\t\t\t\tthis.applyTextDir(tNode, text);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(allowHTML){\r\n\t\t\t\t\t\ttNode.innerHTML = text;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\ttNode.appendChild(win.doc.createTextNode(text));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnode.appendChild(tNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tisAscendantHasClass: function(node, ancestor, className){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDetermines if a node has an ascendant node that has the css class specified.\r\n\t\t\t// node: Node\r\n\t\t\t//\t\tThe DOM node.\r\n\t\t\t// ancestor: Node\r\n\t\t\t//\t\tThe ancestor node used to limit the search in hierarchy.\r\n\t\t\t// className: String\r\n\t\t\t//\t\tThe css class name.\r\n\t\t\t// returns: Boolean\r\n\t\t\t\r\n\t\t\twhile(node != ancestor && node != document){\r\n\t\t\t\t\r\n\t\t\t\tif(domClass.contains(node, className)){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tnode = node.parentNode;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t\r\n\t\tisWeekEnd: function(date){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDetermines whether the specified date is a week-end.\r\n\t\t\t//\t\tThis method is using dojo.date.locale.isWeekend() method as\r\n\t\t\t//\t\tdojox.date.XXXX calendars are not supporting this method.\r\n\t\t\t// date: Date\r\n\t\t\t//\t\tThe date to test.  \r\n\t\t\treturn locale.isWeekend(date);\r\n\t\t},\r\n\t\t\r\n\t\tgetWeekNumberLabel: function(date){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns the week number string from dojo.date.locale.format() method as\r\n\t\t\t//\t\tdojox.date.XXXX calendar are not supporting the \"w\" pattern.\r\n\t\t\t// date: Date\r\n\t\t\t//\t\tThe date to format.\r\n\t\t\tif(date.toGregorian){\r\n\t\t\t\tdate = date.toGregorian();\r\n\t\t\t}\r\n\t\t\treturn locale.format(date, {\r\n\t\t\t\tselector: \"date\", \r\n\t\t\t\tdatePattern: \"w\"});\r\n\t\t},\r\n\t\t\r\n\t\taddAndFloor: function(date, unit, steps){\r\n\t\t\t// date must be floored!!\r\n\t\t\t// unit >= day\r\n\t\t\tvar d = this.dateModule.add(date, unit, steps);\r\n\t\t\tif(d.getHours() == 23){\r\n\t\t\t\td = this.dateModule.add(d, \"hour\", 2); // go to 1am\r\n\t\t\t}else{\r\n\t\t\t\td = timeUtil.floorToDay(d, true, this.dateClassObj);\r\n\t\t\t}\t\t\t\t\t\t\t\t\t\t\r\n\t\t\treturn d;\r\n\t\t},\r\n\t\t\r\n\t\tfloorToDay: function(date, reuse){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFloors the specified date to the start of day.\r\n\t\t\t// date: Date\r\n\t\t\t//\t\tThe date to floor.\r\n\t\t\t// reuse: Boolean\r\n\t\t\t//\t\tWhether use the specified instance or create a new one. Default is false.\r\n\t\t\t// returns: Date\t\t\t\r\n\t\t\treturn timeUtil.floorToDay(date, reuse, this.dateClassObj);\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\tfloorToMonth: function(date, reuse){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFloors the specified date to the start of the date's month.\r\n\t\t\t// date: Date\r\n\t\t\t//\t\tThe date to floor.\r\n\t\t\t// reuse: Boolean\r\n\t\t\t//\t\tWhether use the specified instance or create a new one. Default is false.\r\n\t\t\t// returns: Date\r\n\t\t\treturn timeUtil.floorToMonth(date, reuse, this.dateClassObj);\r\n\t\t},\r\n\t\t\r\n\t\t\t\t\r\n\t\tfloorDate: function(date, unit, steps, reuse){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tfloors the date to the unit.\r\n\t\t\t// date: Date\r\n\t\t\t//\t\tThe date/time to floor.\r\n\t\t\t// unit: String\r\n\t\t\t//\t\tThe unit. Valid values are \"minute\", \"hour\", \"day\".\r\n\t\t\t// steps: Integer\r\n\t\t\t//\t\tFor \"day\" only 1 is valid.\r\n\t\t\t// reuse: Boolean\r\n\t\t\t//\t\tWhether use the specified instance or create a new one. Default is false.\t\t\t\r\n\t\t\t// returns: Date\r\n\t\t\treturn timeUtil.floor(date, unit, steps, reuse, this.dateClassObj);\r\n\t\t},\r\n\r\n\t\tisToday: function(date){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns whether the specified date is in the current day.\r\n\t\t\t// date: Date\r\n\t\t\t//\t\tThe date to test.\r\n\t\t\t// renderData: Object\r\n\t\t\t//\t\tThe current renderData\r\n\t\t\t// returns: Boolean\r\n\t\t\treturn timeUtil.isToday(date, this.dateClassObj);\r\n\t\t},\r\n\t\t\r\n\t\tisStartOfDay: function(d){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTests if the specified date represents the starts of day. \r\n\t\t\t// d:Date\r\n\t\t\t//\t\tThe date to test.\r\n\t\t\t// returns: Boolean\r\n\t\t\treturn timeUtil.isStartOfDay(d, this.dateClassObj, this.dateModule);\r\n\t\t},\r\n\t\t\r\n\t\tisOverlapping: function(renderData, start1, end1, start2, end2, includeLimits){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tComputes if the first time range defined by the start1 and end1 parameters \r\n\t\t\t//\t\tis overlapping the second time range defined by the start2 and end2 parameters.\r\n\t\t\t// renderData: Object\r\n\t\t\t//\t\tThe render data.\r\n\t\t\t// start1: Date\r\n\t\t\t//\t\tThe start time of the first time range.\r\n\t\t\t// end1: Date\r\n\t\t\t//\t\tThe end time of the first time range.\r\n\t\t\t// start2: Date\r\n\t\t\t//\t\tThe start time of the second time range.\r\n\t\t\t// end2: Date\r\n\t\t\t//\t\tThe end time of the second time range.\r\n\t\t\t// includeLimits: Boolean\r\n\t\t\t//\t\tWhether include the end time or not.\r\n\t\t\t// returns: Boolean\r\n\t\t\treturn timeUtil.isOverlapping(renderData, start1, end1, start2, end2, includeLimits);\r\n\t\t},\r\n\t\t\t \r\n\t\tcomputeRangeOverlap: function(renderData, start1, end1, start2, end2, includeLimits){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tComputes the overlap time range of the time ranges.\r\n\t\t\t//\t\tReturns a vector of Date with at index 0 the start time and at index 1 the end time.\r\n\t\t\t// renderData: Object.\r\n\t\t\t//\t\tThe render data.\r\n\t\t\t// start1: Date\r\n\t\t\t//\t\tThe start time of the first time range.\r\n\t\t\t// end1: Date\r\n\t\t\t//\t\tThe end time of the first time range.\r\n\t\t\t// start2: Date\r\n\t\t\t//\t\tThe start time of the second time range.\r\n\t\t\t// end2: Date\r\n\t\t\t//\t\tThe end time of the second time range.\r\n\t\t\t// includeLimits: Boolean\r\n\t\t\t//\t\tWhether include the end time or not.\r\n\t\t\t// returns: Date[]\r\n\t\t\tvar cal = renderData.dateModule;\r\n\t\t\t\r\n\t\t\tif(start1 == null || start2 == null || end1 == null || end2 == null){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar comp1 = cal.compare(start1, end2);\r\n\t\t\tvar comp2 = cal.compare(start2, end1);\r\n\t\t\t\r\n\t\t\tif(includeLimits){\r\n\t\t\t\t\r\n\t\t\t\tif(comp1 == 0 || comp1 == 1 || comp2 == 0 || comp2 == 1){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t} else if(comp1 == 1 || comp2 == 1){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn [\r\n\t\t\t\tthis.newDate(cal.compare(start1, start2)>0 ? start1: start2, renderData),\r\n\t\t\t\tthis.newDate(cal.compare(end1, end2)>0 ? end2: end1, renderData)\r\n\t\t\t];\r\n\t\t},\r\n\t\t\r\n\t\tisSameDay : function(date1, date2){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTests if the specified dates are in the same day.\r\n\t\t\t// date1: Date\r\n\t\t\t//\t\tThe first date.\r\n\t\t\t// date2: Date\r\n\t\t\t//\t\tThe second date.\r\n\t\t\t// returns: Boolean\r\n\t\t\tif(date1 == null || date2 == null){\r\n\t\t\t\treturn false; \r\n\t\t\t}\r\n\t\t\r\n\t\t\treturn date1.getFullYear() == date2.getFullYear() &&\r\n\t\t\t\t\t\t date1.getMonth() == date2.getMonth() &&\r\n\t\t\t\t\t\t date1.getDate() == date2.getDate();\r\n\t\t\t \r\n\t\t},\r\n\t\t\r\n\t\tcomputeProjectionOnDate: function(renderData, refDate, date, max){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tComputes the time to pixel projection in a day.\r\n\t\t\t// renderData: Object\r\n\t\t\t//\t\tThe render data.\r\n\t\t\t// refDate: Date\r\n\t\t\t//\t\tThe reference date that defines the destination date.\r\n\t\t\t// date: Date\r\n\t\t\t//\t\tThe date to project.\r\n\t\t\t// max: Integer\r\n\t\t\t//\t\tThe size in pixels of the representation of a day.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\t// returns: Number\r\n\r\n\t\t\t\r\n\t\t\tvar cal = renderData.dateModule;\r\n\t\t\tvar minH = renderData.minHours;\r\n\t\t\tvar maxH = renderData.maxHours;\r\n\t\t\t\r\n\t\t\tif(max <= 0 || cal.compare(date, refDate) == -1){\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar gt = function(d){\r\n\t\t\t\treturn d.getHours() * 3600 + d.getMinutes() * 60 + d.getSeconds();\t\t\t\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tvar referenceDate = this.floorToDay(refDate, false, renderData);\r\n\r\n\t\t\tif(date.getDate() != referenceDate.getDate()){\r\n\t\t\t\tif(date.getMonth() == referenceDate.getMonth()){\r\n\t\t\t\t\tif(date.getDate() < referenceDate.getDate()){\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t} else if(date.getDate() > referenceDate.getDate() && maxH < 24){\r\n\t\t\t\t\t\treturn max;\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(date.getFullYear() == referenceDate.getFullYear()){\r\n\t\t\t\t\t\tif(date.getMonth() < referenceDate.getMonth()){\r\n\t\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t\t} else if(date.getMonth() > referenceDate.getMonth()){\r\n\t\t\t\t\t\t\treturn max;\r\n\t\t\t\t\t\t}\t\t\t\t\t\t \r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif(date.getFullYear() < referenceDate.getFullYear()){\r\n\t\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t\t} else if(date.getFullYear() > referenceDate.getFullYear()){\r\n\t\t\t\t\t\t\treturn max;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar res;\r\n\t\t\tvar ONE_DAY = 86400; // 24h x 60m x 60s\r\n\r\n\t\t\tif(this.isSameDay(refDate, date) || maxH > 24){\r\n\t\t\t\t\r\n\t\t\t\tvar d = lang.clone(refDate);\r\n\t\t\t\tvar minTime = 0;\r\n\t\t\t\t\r\n\t\t\t\tif(minH != null && minH != 0){\r\n\t\t\t\t\td.setHours(minH);\r\n\t\t\t\t\tminTime = gt(d);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\td = lang.clone(refDate);\r\n\t\t\t\td.setHours(maxH);\r\n\t\t\t\t\r\n\t\t\t\tvar maxTime;\r\n\t\t\t\tif(maxH == null || maxH == 24){\r\n\t\t\t\t\tmaxTime = ONE_DAY; \r\n\t\t\t\t}else if(maxH > 24){\r\n\t\t\t\t\tmaxTime = ONE_DAY + gt(d);\r\n\t\t\t\t}else{\t\t\t\t\t\r\n\t\t\t\t\tmaxTime = gt(d);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//precision is the second\r\n\t\t\t\t//use this API for daylight time issues.\r\n\t\t\t\t\r\n\t\t\t\tvar delta = 0;\r\n\t\t\t\t\r\n\t\t\t\tif(maxH > 24 && refDate.getDate() != date.getDate()){\r\n\t\t\t\t\tdelta = ONE_DAY + gt(date);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdelta = gt(date);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(delta < minTime){\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t\tif(delta > maxTime){\r\n\t\t\t\t\treturn max;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tdelta -= minTime;\r\n\r\n\t\t\t\tres = (max * delta)/(maxTime - minTime);\r\n\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\t\r\n\t\t\t\tif(date.getDate() < refDate.getDate() && \r\n\t\t\t\t\t\tdate.getMonth() == refDate.getMonth()){\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar d2 = this.floorToDay(date);\r\n\t\t\t\tvar dp1 = renderData.dateModule.add(refDate, \"day\", 1);\r\n\t\t\t\tdp1 = this.floorToDay(dp1, false, renderData);\r\n\t\t\t\t\r\n\t\t\t\tif(cal.compare(d2, refDate) == 1 && cal.compare(d2, dp1) == 0 || cal.compare(d2, dp1) == 1){\r\n\t\t\t\t\tres =\tmax;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tres = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\treturn res;\r\n\t\t},\t\r\n\t\t\r\n\t\tgetTime: function(e, x, y, touchIndex){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns the time displayed at the specified point by this component.\r\n\t\t\t// e: Event\r\n\t\t\t//\t\tOptional mouse event.\r\n\t\t\t// x: Number\r\n\t\t\t//\t\tPosition along the x-axis with respect to the sheet container used if event is not defined.\r\n\t\t\t// y: Number\r\n\t\t\t//\t\tPosition along the y-axis with respect to the sheet container (scroll included) used if event is not defined.\r\n\t\t\t// touchIndex: Integer\r\n\t\t\t//\t\tIf parameter 'e' is not null and a touch event, the index of the touch to use.\r\n\t\t\t// returns: Date\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\t\r\n\t\tgetSubColumn: function(e, x, y, touchIndex){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns the sub column at the specified point by this component.\r\n\t\t\t// e: Event\r\n\t\t\t//\t\tOptional mouse event.\r\n\t\t\t// x: Number\r\n\t\t\t//\t\tPosition along the x-axis with respect to the sheet container used if event is not defined.\r\n\t\t\t// y: Number\r\n\t\t\t//\t\tPosition along the y-axis with respect to the sheet container (scroll included) used if event is not defined.\r\n\t\t\t// touchIndex: Integer\r\n\t\t\t//\t\tIf parameter 'e' is not null and a touch event, the index of the touch to use.\r\n\t\t\t// returns: Object\r\n\t\t\t\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\t\r\n\t\tgetSubColumnIndex: function(value){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns the sub column index that has the specified value, if any. -1 otherwise. \r\n\t\t\t// value: String\r\n\t\t\t//\t\tThe sub column index.\r\n\t\t\tif(this.subColumns){\r\n\t\t\t\tfor(var i=0; i<this.subColumns.length; i++){\r\n\t\t\t\t\tif(this.subColumns[i] == value){\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t},\r\n\t\t\r\n\t\tnewDate: function(obj){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreates a new Date object.\r\n\t\t\t// obj: Object\r\n\t\t\t//\t\tThis object can have several values:\r\n\t\t\t//\r\n\t\t\t//\t\t- the time in milliseconds since gregorian epoch.\r\n\t\t\t//\t\t- a Date instance\r\n\t\t\t// returns: Date\r\n\t\t\treturn timeUtil.newDate(obj, this.dateClassObj);\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_isItemInView: function(item){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tComputes whether the specified item is entirely in the view or not.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe item to test\r\n\t\t\t// returns: Boolean\t\r\n\t\t\tvar rd = this.renderData;\r\n\t\t\tvar cal = rd.dateModule;\r\n\t\t\t\r\n\t\t\tif(cal.compare(item.startTime, rd.startTime) == -1){\r\n\t\t\t\treturn false;\r\n\t\t\t} \t\t\t\r\n\t\t\t\r\n\t\t\treturn cal.compare(item.endTime, rd.endTime) != 1;\r\n\t\t},\r\n\t\t\r\n\t\t_ensureItemInView: function(item){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tIf needed, moves the item to be entirely in view.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe item to test\r\n\t\t\t// returns: Boolean\r\n\t\t\t//\t\tWhether the item has been moved to be in view or not.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tvar rd = this.renderData;\r\n\t\t\tvar cal = rd.dateModule;\r\n\t\t\t\r\n\t\t\tvar duration = Math.abs(cal.difference(item.startTime, item.endTime, \"millisecond\"));\r\n\t\t\tvar fixed = false;\r\n\t\t\t\r\n\t\t\tif(cal.compare(item.startTime, rd.startTime) == -1){\r\n\t\t\t\titem.startTime = rd.startTime;\r\n\t\t\t\titem.endTime = cal.add(item.startTime, \"millisecond\", duration);\r\n\t\t\t\tfixed = true;\r\n\t\t\t}else if(cal.compare(item.endTime, rd.endTime) == 1){\r\n\t\t\t\titem.endTime = rd.endTime;\r\n\t\t\t\titem.startTime = cal.add(item.endTime, \"millisecond\", -duration);\r\n\t\t\t\tfixed = true;\r\n\t\t\t}\t\t\t\r\n\t\t\treturn fixed;\r\n\t\t},\r\n\t\t\r\n\t\t/////////////////////////////////////////////////////////\r\n\t\t//\r\n\t\t// Scrollable\r\n\t\t//\r\n\t\t/////////////////////////////////////////////////////////\r\n\t\t\t\t\r\n\t\t// scrollable: Boolean\r\n\t\t//\t\tIndicates whether the view can be scrolled or not.\r\n\t\tscrollable: true,\r\n\t\t\r\n\t\t// autoScroll: Boolean\r\n\t\t//\t\tIndicates whether the view can be scrolled automatically. \r\n\t\t//\t\tAuto scrolling is used when moving focus to a non visible renderer using keyboard \r\n\t\t//\t\tand while editing an item. \r\n\t\tautoScroll: true,\t\t\t\t\r\n\t\t\r\n\t\t_autoScroll: function(gx, gy, orientation){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStarts or stops the auto scroll according to the mouse cursor position during an item editing.\r\n\t\t\t// gx: Integer\r\n\t\t\t//\t\tThe position of the mouse cursor along the x-axis.\r\n\t\t\t// gy: Integer\r\n\t\t\t//\t\tThe position of the mouse cursor along the y-axis.\t\t\t\r\n\t\t\t// tags:\r\n\t\t\t//\t\textension\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t\t\r\n\t\t// scrollMethod: String\r\n\t\t//\t\tMethod used to scroll the view, for example the scroll of column view.\r\n\t\t//\t\tValid value are:\r\n\t\t//\r\n\t\t//\t\t- \"auto\": let the view decide (default),\r\n\t\t//\t\t- \"css\": use css 3d transform,\r\n\t\t//\t\t- \"dom\": use the scrollTop property.\r\n\t\tscrollMethod: \"auto\",\r\n\t\t\r\n\t\t_setScrollMethodAttr: function(value){\r\n\t\t\tif(this.scrollMethod != value){\r\n\t\t\t\tthis.scrollMethod = value;\r\n\t\t\t\t\r\n\t\t\t\t// reset\r\n\t\t\t\tif(this._domScroll !== undefined){\r\n\t\t\t\t\tif(this._domScroll){\r\n\t\t\t\t\t\tdomStyle.set(this.sheetContainer, this._cssPrefix+\"transform\", \"translateY(0px)\");\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.scrollContainer.scrollTop = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tdelete this._domScroll;\r\n\t\t\t\tvar pos = this._getScrollPosition();\r\n\t\t\t\tdelete this._scrollPos;\r\n\t\t\t\t\r\n\t\t\t\tthis._setScrollPosition(pos);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_startAutoScroll: function(step){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStarts the auto scroll of the view (if it's scrollable). Used only during editing.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar sp = this._scrollProps;\r\n\t\t\tif(!sp){\r\n\t\t\t\tsp = this._scrollProps = {};\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tsp.scrollStep = step;\r\n\t\t\t\r\n\t\t\tif (!sp.isScrolling){\r\n\t\t\t\tsp.isScrolling = true;\r\n\t\t\t\tsp.scrollTimer = setInterval(lang.hitch(this, this._onScrollTimer_tick), 10);\r\n\t\t\t}\t\t\r\n\t\t},\r\n\t\t\t\t\r\n\t\t_stopAutoScroll: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStops the auto scroll of the view (if it's scrollable). Used only during editing.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar sp = this._scrollProps;\r\n\t\t\t\r\n\t\t\tif (sp && sp.isScrolling) {\r\n\t\t\t\tclearInterval(sp.scrollTimer);\r\n\t\t\t\tsp.scrollTimer = null;\r\n\t\t\t}\r\n\t\t\tthis._scrollProps = null;\r\n\t\t},\r\n\t\t\r\n\t\t_onScrollTimer_tick: function(pos){\r\n\t\t},\r\n\t\t\r\n\t\t_scrollPos: 0,\r\n\t\t_hscrollPos: 0,\r\n\t\t\r\n\t\tgetCSSPrefix: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tUtility method that return the specific CSS prefix\r\n\t\t\t//\t\tfor non standard CSS properties. Ex: -moz-border-radius.\r\n\t\t\tif(has(\"ie\")){\r\n\t\t\t\treturn \"-ms-\";\r\n\t\t\t}\r\n\t\t\tif(has(\"webkit\")){\r\n\t\t\t\treturn \"-webkit-\";\r\n\t\t\t}\r\n\t\t\tif(has(\"mozilla\")){\r\n\t\t\t\treturn \"-moz-\";\r\n\t\t\t}\r\n\t\t\tif(has(\"opera\")){\r\n\t\t\t\treturn \"-o-\";\r\n\t\t\t}\r\n            return \"\";\r\n\t\t},\r\n\t\t\r\n\t\t//\t_hScrollNodes: DOMNodes[]\r\n\t\t//\t\tArray of nodes that will be scrolled horizontally.\r\n\t\t//\t\tMust be set by sub class on buildRendering.\r\n\t\t\r\n\t\t_hScrollNodes: null,\r\n\t\t\r\n\t\t_setScrollPositionBase: function(pos, vertical){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSets the scroll position (if the view is scrollable), using the scroll method defined.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tif(vertical && this._scrollPos == pos || \r\n\t\t\t   !vertical && this._hScrollPos == pos){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// determine scroll method once.\r\n\t\t\tif(this._domScroll === undefined){\r\n\t\t\t\r\n\t\t\t\tvar sm = this.get(\"scrollMethod\");\r\n\t\t\t\tif(sm === \"auto\"){\t\t\t\t\t\r\n\t\t\t\t\tthis._domScroll = !has(\"ios\") && !has(\"android\") && !has(\"webkit\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._domScroll = sm === \"dom\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar max = 0;\r\n\t\t\tif(vertical){\r\n\t\t\t\tvar containerSize = domGeometry.getMarginBox(this.scrollContainer);\r\n\t\t\t\tvar sheetSize = domGeometry.getMarginBox(this.sheetContainer);\r\n\t\t\t\tmax = sheetSize.h - containerSize.h;\r\n\t\t\t}else{\t\t\t\t\r\n\t\t\t\tvar gridSize = domGeometry.getMarginBox(this.grid);\r\n\t\t\t\tvar gridTableSize = domGeometry.getMarginBox(this.gridTable);\r\n\t\t\t\tmax = gridTableSize.w - gridSize.w;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(pos < 0){\r\n\t\t\t\tpos = 0;\r\n\t\t\t}else if(pos > max){\r\n\t\t\t\tpos = max;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(vertical){\r\n\t\t\t\tthis._scrollPos = pos;\r\n\t\t\t}else{\r\n\t\t\t\tthis._hScrollPos = pos;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar rtl = !this.isLeftToRight();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\tif(this._domScroll){\r\n\t\t\t\tif(vertical){\r\n\t\t\t\t\tthis.scrollContainer.scrollTop = pos;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tarr.forEach(this._hScrollNodes, function(elt){\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tdomStyle.set(elt, \"left\", ((rtl?1:-1) * pos) + \"px\");\t\t\t\t\t\t\r\n\t\t\t\t\t}, this);\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t}else{\t\t\t\r\n\t\t\t\tif(!this._cssPrefix){\r\n\t\t\t\t\tthis._cssPrefix =  this.getCSSPrefix();\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tvar cssProp = this._cssPrefix+\"transform\";\r\n\t\t\t\t\r\n\t\t\t\tif(vertical){\r\n\t\t\t\t\tdomStyle.set(this.sheetContainer, cssProp, \"translateY(-\"+pos+\"px)\");\r\n\t\t\t\t}else{\t\t\t\t\t\r\n\t\t\t\t\tvar css = \"translateX(\"+(rtl?\"\":\"-\")+pos+\"px)\";\r\n\t\t\t\t\tarr.forEach(this._hScrollNodes, function(elt){\t\t\t\t\t\t\r\n\t\t\t\t\t\tdomStyle.set(elt, cssProp, css);\t\t\t\t\t\t\r\n\t\t\t\t\t}, this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t_setScrollPosition: function(pos){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSets the verical scroll position (if the view is scrollable), using the scroll method defined.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\t\t\t\r\n\t\t\tthis._setScrollPositionBase(pos, true);\t\t\t\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_getScrollPosition: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns the vertical scroll position (if the view is scrollable), using the scroll method defined.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\treturn this._scrollPos; \r\n\t\t},\r\n\t\t\t\t\r\n\t\t_setHScrollPosition: function(pos){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSets the horizontal scroll position (if the view is scrollable), using the scroll method defined.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\t\r\n\t\t\tthis._setScrollPositionBase(pos, false);\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_setHScrollPositionImpl: function(pos, useDom, cssProperty){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSets the horizontal scroll position on sub elements (if the view is scrollable), using the scroll method defined.\r\n\t\t\t//\t\tImportant: must be implemented by sub classes and not called directly. Use _setHScrollPosition() method instead.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\t\r\n\t\t\tvar css = useDom ? null : \"translateX(-\"+pos+\"px)\";\r\n\t\t\tarr.forEach(this._hScrollNodes, function(elt){\r\n\t\t\t\tif(useDom){\r\n\t\t\t\t\telt.scrollLeft = pos;\r\n\t\t\t\t\tdomStyle.set(elt, \"left\", (-pos) + \"px\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdomStyle.set(elt, cssProp, css);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\t\r\n\t\t_hScrollPos: 0,\r\n\t\t\r\n\t\t_getHScrollPosition: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns the horizontal scroll position (if the view is scrollable), using the scroll method defined.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\treturn this._hScrollPos; \r\n\t\t},\r\n\t\t\r\n\t\tscrollView: function(dir){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tIf the view is scrollable, scrolls it vertically to the specified direction.\r\n\t\t\t// dir: Integer\r\n\t\t\t//\t\tDirection of the scroll. Valid values are -1 and 1.\r\n\t\t\t// tags:\r\n\t\t\t//\t\textension\r\n\t\t},\r\n\t\t\r\n\t\tensureVisibility: function(start, end, margin, visibilityTarget, duration){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tScrolls the view if the [start, end] time range is not visible or only partially visible.\r\n\t\t\t// start: Date\r\n\t\t\t//\t\tStart time of the range of interest.\r\n\t\t\t// end: Date\r\n\t\t\t//\t\tEnd time of the range of interest.\r\n\t\t\t// margin: int\r\n\t\t\t//\t\tMargin in minutes around the time range.\r\n\t\t\t// visibilityTarget: String\r\n\t\t\t//\t\tThe end(s) of the time range to make visible.\r\n\t\t\t//\t\tValid values are: \"start\", \"end\", \"both\".\t\r\n\t\t\t// duration: Number\r\n\t\t\t//\t\tOptional, the maximum duration of the scroll animation.\r\n\t\t\t// tags:\r\n\t\t\t//\t\textension\r\n\r\n\t\t},\r\n\r\n\t  \t////////////////////////////////////////////////////////\r\n\t\t//\r\n\t\t// Store & Items\r\n\t\t//\r\n\t\t////////////////////////////////////////////////////////\r\n\t\t\r\n\t\t_getStoreAttr: function(){\r\n\t\t\tif(this.owner){\r\n\t\t\t\treturn this.owner.get(\"store\");\r\n\t\t\t}\r\n\t\t\treturn this.store;\r\n\t\t},\r\n\r\n\t\t_setItemsAttr: function(value){\r\n\t\t\tthis._set(\"items\", value);\r\n\t\t\tthis.displayedItemsInvalidated = true;\r\n\t\t},\r\n\r\n\t\t_refreshItemsRendering: function(){\r\n\t\t\tvar rd = this.renderData;\r\n\t\t\tthis._computeVisibleItems(rd);\r\n\t\t\tthis._layoutRenderers(rd);\r\n\t\t},\r\n\t\t\r\n\t\t_refreshDecorationItemsRendering: function(){\r\n\t\t\tvar rd = this.renderData;\r\n\t\t\tthis._computeVisibleItems(rd);\r\n\t\t\tthis._layoutDecorationRenderers(rd);\r\n\t\t},\r\n\t\t\r\n\t\tinvalidateLayout: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTriggers a re-layout of the renderers.\r\n\t\t\tthis._layoutRenderers(this.renderData);\r\n\t\t\tthis._layoutDecorationRenderers(this.renderData);\r\n\t\t},\r\n\t\t\r\n\t\t_setDecorationItemsAttr: function(value){\r\n\t\t\tthis._set(\"decorationItems\", value);\r\n\t\t\tthis.displayedDecorationItemsInvalidated = true;\r\n\t\t},\r\n\t\t\t\t\t\r\n\t\t_getDecorationStoreAttr: function(){\r\n\t\t\tif(this.owner){\r\n\t\t\t\treturn this.owner.get(\"decorationStore\");\r\n\t\t\t}\r\n\t\t\treturn this.decorationStore;\r\n\t\t},\r\n\t\t\r\n\t\t_setDecorationStoreAttr: function(value){\r\n\t\t\tthis.decorationStore = value;\r\n\t\t\tthis.decorationStoreManager.set(\"store\", value);\r\n\t\t},\r\n\t\t\r\n\t\t////////////////////////////////////////////////////////\r\n\t\t//\r\n\t\t// Layout\r\n\t\t//\r\n\t\t////////////////////////////////////////////////////////\r\n\t\t\t\t\r\n\t\tcomputeOverlapping: function(layoutItems, func){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tComputes the overlap layout of a list of items. A lane and extent properties are added to each layout item.\r\n\t\t\t// layoutItems: Object[]\r\n\t\t\t//\t\tList of layout items, each item must have a start and end properties.\r\n\t\t\t// addedPass: Function\r\n\t\t\t//\t\tWhether computes the extent of each item renderer on free sibling lanes.\r\n\t\t\t// returns: Object\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\t\r\n\t\t\tif(layoutItems.length == 0){\r\n\t\t\t\treturn {\r\n\t\t\t\t\tnumLanes: 0,\r\n\t\t\t\t\taddedPassRes: [1]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar lanes = [];\r\n\r\n\t\t\tfor(var i=0; i<layoutItems.length; i++){\r\n\t\t\t\tvar layoutItem = layoutItems[i];\r\n\t\t\t\tthis._layoutPass1(layoutItem, lanes);\r\n\t\t\t}\r\n\r\n\t\t\tvar addedPassRes = null;\r\n\t\t\tif(func){\r\n\t\t\t\taddedPassRes = lang.hitch(this, func)(lanes);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn {\r\n\t\t\t\tnumLanes: lanes.length,\r\n\t\t\t\taddedPassRes: addedPassRes\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t_layoutPass1: function (layoutItem, lanes){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFirst pass of the overlap layout. Find a lane where the item can be placed or create a new one.\r\n\t\t\t// layoutItem: Object\r\n\t\t\t//\t\tAn object that contains a start and end properties at least.\r\n\t\t\t// lanes:\r\n\t\t\t//\t\tThe array of lanes.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar stop = true;\r\n\t\t\t\r\n\t\t\tfor(var i=0; i<lanes.length; i++){\r\n\t\t\t\tvar lane = lanes[i]; \r\n\t\t\t\tstop = false;\r\n\t\t\t\tfor(var j=0; j<lane.length && !stop; j++){\r\n\t\t\t\t\tif(lane[j].start < layoutItem.end && layoutItem.start < lane[j].end){\r\n\t\t\t\t\t\t// one already placed item is overlapping\r\n\t\t\t\t\t\tstop = true;\r\n\t\t\t\t\t\tlane[j].extent = 1;\r\n\t\t\t\t\t} \r\n\t\t\t\t}\r\n\t\t\t\tif(!stop){\r\n\t\t\t\t\t//we have found a place\r\n\t\t\t\t\tlayoutItem.lane = i;\r\n\t\t\t\t\tlayoutItem.extent = -1;\r\n\t\t\t\t\tlane.push(layoutItem);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//no place found -> add a lane\r\n\t\t\tlanes.push([layoutItem]);\r\n\t\t\tlayoutItem.lane = lanes.length-1;\t\t\t \r\n\t\t\tlayoutItem.extent = -1;\r\n\t\t},\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t\t_layoutInterval: function(renderData, index, start, end, items){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFor each item in the items list: retrieve a renderer, compute its location and size and add it to the DOM.\r\n\t\t\t// renderData: Object\r\n\t\t\t//\t\tThe render data.\r\n\t\t\t// index: Integer\r\n\t\t\t//\t\tThe index of the interval.\r\n\t\t\t// start: Date\r\n\t\t\t//\t\tThe start time of the displayed date interval.\r\n\t\t\t// end: Date\r\n\t\t\t//\t\tThe end time of the displayed date interval.\r\n\t\t\t// items: Object[]\r\n\t\t\t//\t\tThe list of the items to represent.\r\n\t\t\t// tags:\r\n\t\t\t//\t\textension\r\n\t\t},\r\n\t\t\r\n\t\t// layoutPriorityFunction: Function\r\n\t\t//\t\tAn optional comparison function use to determine the order the item will be laid out\r\n\t\t//\t\tThe function is used to sort an array and must, as any sorting function, take two items \r\n\t\t//\t\tas argument and must return an integer whose sign define order between arguments.\r\n\t\t//\t\tBy default, a comparison by start time then end time is used.\r\n\t\tlayoutPriorityFunction: null,\r\n\t\t\r\n\t\t_sortItemsFunction: function(a, b){\r\n\t\t\tvar res = this.dateModule.compare(a.startTime, b.startTime);\r\n\t\t\tif(res == 0){\r\n\t\t\t\tres = -1 * this.dateModule.compare(a.endTime, b.endTime);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t},\r\n\t\t\r\n\t\t\r\n\t\t_layoutRenderers: function(renderData){\r\n\t\t\tthis._layoutRenderersImpl(renderData, this.rendererManager, renderData.items, \"dataItems\");\r\n\t\t},\r\n\t\t\r\n\t\t_layoutDecorationRenderers: function(renderData){\r\n\t\t\tthis._layoutRenderersImpl(renderData, this.decorationRendererManager, renderData.decorationItems, \"decorationItems\");\r\n\t\t},\r\n\t\t\r\n\t\t_layoutRenderersImpl: function(renderData, rendererManager, items, itemType){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRenders the data items. This method will call the _layoutInterval() method.\r\n\t\t\t// renderData: Object\r\n\t\t\t//\t\tThe render data.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tif(!items){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t// recycle renderers first\r\n\t\t\trendererManager.recycleItemRenderers();\r\n\t\t\t\r\n\t\t\tvar cal = renderData.dateModule; \r\n\t\t\t\r\n\t\t\t// Date\r\n\t\t\tvar startDate = this.newDate(renderData.startTime);\r\n\t\t\t\r\n\t\t\t// Date and time\r\n\t\t\tvar startTime = lang.clone(startDate);\r\n\t\t\t\r\n\t\t\tvar endDate;\r\n\t\t\t\r\n\t\t\tvar items = items.concat();\r\n\r\n\t\t\tvar itemsTemp = [], events;\r\n\t\t\tvar processing = {};\r\n\t\t\t\r\n\t\t\tvar index = 0;\r\n\t\t\t\r\n\t\t\twhile(cal.compare(startDate, renderData.endTime) == -1 && items.length > 0){\r\n\t\t\t\r\n\t\t\t\tendDate = this.addAndFloor(startDate, this._layoutUnit, this._layoutStep);\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tvar endTime = lang.clone(endDate);\r\n\t\t\t\t\r\n\t\t\t\tif(renderData.minHours){\r\n\t\t\t\t\tstartTime.setHours(renderData.minHours);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(renderData.maxHours != undefined && renderData.maxHours != 24){\t\t\t\t\t\r\n\t\t\t\t\tif(renderData.maxHours < 24){\t\t\t\t\r\n\t\t\t\t\t\tendTime = cal.add(endDate, \"day\", -1);\r\n\t\t\t\t\t} // else > 24\r\n\t\t\t\t\tendTime = this.floorToDay(endTime, true, renderData);\r\n\t\t\t\t\tendTime.setHours(renderData.maxHours - (renderData.maxHours < 24 ? 0 : 24));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// look for events that overlap the current sub interval\r\n\t\t\t\tevents = arr.filter(items, function(item){\r\n\t\t\t\t\tvar r = this.isOverlapping(renderData, item.startTime, item.endTime, startTime, endTime);\r\n\t\t\t\t\tif(r){\r\n\t\t\t\t\t\tprocessing[item.id] = true;\t\t\t\t\t\t\r\n\t\t\t\t\t\titemsTemp.push(item);\t\t\t\t\t\t\t\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif(processing[item.id]){\r\n\t\t\t\t\t\t\tdelete processing[item.id];\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\titemsTemp.push(item);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn r;\r\n\t\t\t\t}, this);\r\n\r\n\t\t\t\titems = itemsTemp;\r\n\t\t\t\titemsTemp = [];\r\n\t\t\t\t\r\n\t\t\t\t// if event are in the current sub interval, layout them\r\n\t\t\t\tif(events.length > 0){\r\n\t\t\t\t\t// Sort the item according a sorting function, by default start time then end time comparison are used.\r\n\t\t\t\t\tevents.sort(lang.hitch(this, this.layoutPriorityFunction ? this.layoutPriorityFunction : this._sortItemsFunction));\r\n\t\t\t\t\tthis._layoutInterval(renderData, index, startTime, endTime, events, itemType);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstartDate = endDate;\r\n\t\t\t\tstartTime = lang.clone(startDate);\r\n\r\n\t\t\t\tindex++;\r\n\t\t\t}\t\t\t\r\n\t\t\t\r\n\t\t\tthis._onRenderersLayoutDone(this);\r\n\t\t},\r\n\t\r\n\t\t/////////////////////////////////////////////////////////////////\r\n\t\t//\r\n\t\t//\tRenderers management\r\n\t\t//\r\n\t\t////////////////////////////////////////////////////////////////\r\n\t\t\r\n\t\t_recycleItemRenderers: function(remove){\r\n\t\t\tthis.rendererManager.recycleItemRenderers(remove);\r\n\t\t},\r\n\t\t\t\t\t\t\t\r\n\t\tgetRenderers: function(item){\t\t\t\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns the renderers that are currently used to displayed the speficied item.\r\n\t\t\t//\t\tReturns an array of objects that contains two properties:\r\n\t\t\t//\t\t- container: The DOM node that contains the renderer.\r\n\t\t\t//\t\t- renderer: The dojox.calendar._RendererMixin instance.\r\n\t\t\t//\t\tDo not keep references on the renderers are they are recycled and reused for other items.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe data or render item.\r\n\t\t\t// returns: Object[]\r\n\t\t\t\r\n\t\t\treturn this.rendererManager.getRenderers(item);\t\t\t\r\n\t\t},\r\n\t\t\t\t\r\n\t\t// itemToRendererKindFunc: Function\r\n\t\t//\t\tAn optional function to associate a kind of renderer (\"horizontal\", \"label\" or null) with the specified item.\r\n\t\t//\t\tBy default, if an item is lasting more that 24 hours an horizontal item is used, otherwise a label is used.\r\n\t\titemToRendererKindFunc: null,\r\n\t\t\r\n\t\t_itemToRendererKind: function(item){\r\n\t\t\t// summary: \r\n\t\t\t//\t\tAssociates a kind of renderer with a data item.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe data item.\r\n\t\t\t// returns: String\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\t\t\t\r\n\t\t\tif(this.itemToRendererKindFunc){\r\n\t\t\t\treturn this.itemToRendererKindFunc(item);\r\n\t\t\t}\r\n\t\t\treturn this._defaultItemToRendererKindFunc(item); // String\r\n\t\t},\r\n\t\t\r\n\t\t_defaultItemToRendererKindFunc:function(item){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\t_createRenderer: function(item, kind, rendererClass, cssClass){\t\t\t\r\n\t\t\t// summary: \r\n\t\t\t//\t\tCreates an item renderer of the specified kind. A renderer is an object with the \"container\" and \"instance\" properties.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe data item.\r\n\t\t\t// kind: String\r\n\t\t\t//\t\tThe kind of renderer.\r\n\t\t\t// rendererClass: Object\r\n\t\t\t//\t\tThe class to instantiate to create the renderer.\r\n\t\t\t// returns: Object\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\treturn this.rendererManager.createRenderer(item, kind, rendererClass, cssClass);\r\n\t\t},\r\n\t\t\r\n\t\t_onRendererCreated: function(e){\r\n\t\t\tif(e.source == this){\r\n\t\t\t\tthis.onRendererCreated(e);\r\n\t\t\t}\r\n\t\t\tif(this.owner != null){\r\n\t\t\t\tthis.owner._onRendererCreated(e);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonRendererCreated: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when an item renderer has been created.\r\n\t\t\t// e: __rendererLifecycleEventArgs\r\n\t\t\t//\t\tThe renderer lifecycle event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\t\t},\t\r\n\t\t\r\n\t\t_onRendererRecycled: function(e){\r\n\t\t\tif(e.source == this){\r\n\t\t\t\tthis.onRendererRecycled(e);\r\n\t\t\t}\r\n\t\t\tif(this.owner != null){\r\n\t\t\t\tthis.owner._onRendererRecycled(e);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonRendererRecycled: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when an item renderer has been recycled.\r\n\t\t\t// e: __rendererLifecycleEventArgs\r\n\t\t\t//\t\tThe renderer lifecycle event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\r\n\t\t},\r\n\t\t\t\t\t\t\r\n\t\t_onRendererReused: function(e){\r\n\t\t\tif(e.source == this){\r\n\t\t\t\tthis.onRendererReused(e);\r\n\t\t\t}\r\n\t\t\tif(this.owner != null){\r\n\t\t\t\tthis.owner._onRendererReused(e);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonRendererReused: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when an item renderer that was recycled is reused.\r\n\t\t\t// e: __rendererLifecycleEventArgs\r\n\t\t\t//\t\tThe renderer lifecycle event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\t\t},\r\n\t\t\r\n\t\t_onRendererDestroyed: function(e){\r\n\t\t\tif(e.source == this){\r\n\t\t\t\tthis.onRendererDestroyed(e);\r\n\t\t\t}\r\n\t\t\tif(this.owner != null){\r\n\t\t\t\tthis.owner._onRendererDestroyed(e);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonRendererDestroyed: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when an item renderer is destroyed.\r\n\t\t\t// e: __rendererLifecycleEventArgs\r\n\t\t\t//\t\tThe renderer lifecycle event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\t\t},\r\n\t\t\t\t\r\n\t\t_onRenderersLayoutDone: function(view){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tthis.onRenderersLayoutDone(view);\r\n\t\t\tif(this.owner != null){\r\n\t\t\t\tthis.owner._onRenderersLayoutDone(view);\r\n\t\t\t}\t\t\t\t\r\n\t\t},\r\n\t\t\t\t\t\t\t\t\t\r\n\t\tonRenderersLayoutDone: function(view){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent triggered when item renderers layout has been done.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\t\t},\r\n\r\n\t\t_recycleRenderer: function(renderer, remove){\r\n\t\t\t// summary: \r\n\t\t\t//\t\tRecycles the item renderer to be reused in the future.\r\n\t\t\t// renderer: dojox/calendar/_RendererMixin\r\n\t\t\t//\t\tThe item renderer to recycle.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\tthis.rendererManager.recycleRenderer(renderer, remove);\r\n\t\t},\r\n\t\t\t\t\t\t\t\r\n\t\t_destroyRenderer: function(renderer){\r\n\t\t\t// summary: \r\n\t\t\t//\t\tDestroys the item renderer.\r\n\t\t\t// renderer: dojox/calendar/_RendererMixin\r\n\t\t\t//\t\tThe item renderer to destroy.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\t\r\n\t\t\tthis.rendererManager.destroyRenderer(renderer);\t\t\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_destroyRenderersByKind: function(kind){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tthis.rendererManager.destroyRenderersByKind(kind);\t\t\t\r\n\t\t},\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t_updateEditingCapabilities: function(item, renderer){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tUpdate the moveEnabled and resizeEnabled properties of a renderer according to its event current editing state.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe store data item.\r\n\t\t\t// renderer: dojox/calendar/_RendererMixin\r\n\t\t\t//\t\tThe item renderer.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tvar moveEnabled = this.isItemMoveEnabled(item, renderer.rendererKind);\r\n\t\t\tvar resizeEnabled = this.isItemResizeEnabled(item, renderer.rendererKind);\r\n\t\t\tvar changed = false;\r\n\t\t\t\r\n\t\t\tif(moveEnabled != renderer.get(\"moveEnabled\")){\r\n\t\t\t\trenderer.set(\"moveEnabled\", moveEnabled);\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t\tif(resizeEnabled != renderer.get(\"resizeEnabled\")){\r\n\t\t\t\trenderer.set(\"resizeEnabled\", resizeEnabled);\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(changed){\r\n\t\t\t\trenderer.updateRendering();\r\n\t\t\t}\r\n\t\t},\r\n\t\r\n\t\tupdateRenderers: function(obj, stateOnly){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tUpdates all the renderers that represents the specified item(s).\r\n\t\t\t// obj: Object\r\n\t\t\t//\t\tA render item or an array of render items.\r\n\t\t\t// stateOnly: Boolean\r\n\t\t\t//\t\tWhether only the state of the item has changed (selected, edited, edited, focused) or a more global change has occured.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tif(obj == null){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar items = lang.isArray(obj) ? obj : [obj];\r\n\t\t\t\r\n\t\t\tfor(var i=0; i<items.length; i++){\r\n\t\t\t\t\r\n\t\t\t\tvar item = items[i];\r\n\t\t\t\t\r\n\t\t\t\tif(item == null || item.id == null){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\tvar list = this.rendererManager.itemToRenderer[item.id];\r\n\t\t\t\t\r\n\t\t\t\tif(list == null){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar selected = this.isItemSelected(item);\r\n\t\t\t\tvar hovered = this.isItemHovered(item);\r\n\t\t\t\tvar edited = this.isItemBeingEdited(item);\r\n\t\t\t\tvar focused = this.showFocus ? this.isItemFocused(item) : false;\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tfor(var j = 0; j < list.length; j++){\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar renderer = list[j].renderer;\r\n\t\t\t\t\trenderer.set(\"hovered\", hovered);\r\n\t\t\t\t\trenderer.set(\"selected\", selected);\r\n\t\t\t\t\trenderer.set(\"edited\", edited);\r\n\t\t\t\t\trenderer.set(\"focused\", focused);\r\n\t\t\t\t\trenderer.set(\"storeState\", this.getItemStoreState(item));\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.applyRendererZIndex(item, list[j], hovered, selected, edited, focused);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(!stateOnly){\r\n\t\t\t\t\t\trenderer.set(\"item\", item); // force content refresh\r\n\t\t\t\t\t\tif(renderer.updateRendering){\r\n\t\t\t\t\t\t\trenderer.updateRendering(); // reuse previously set dimensions\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tapplyRendererZIndex: function(item, renderer, hovered, selected, edited, focused){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tApplies the z-index to the renderer based on the state of the item.\r\n\t\t\t//\t\tThis methods is setting a z-index of 20 is the item is selected or edited \r\n\t\t\t//\t\tand the current lane value computed by the overlap layout (i.e. the renderers \r\n\t\t\t//\t\tare stacked according to their lane).\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe render item.\r\n\t\t\t// renderer: Object\r\n\t\t\t//\t\tA renderer associated with the render item.\r\n\t\t\t// hovered: Boolean\r\n\t\t\t//\t\tWhether the item is hovered or not.\r\n\t\t\t// selected: Boolean\r\n\t\t\t//\t\tWhether the item is selected or not.\r\n\t\t\t// edited: Boolean\r\n\t\t\t//\t\tWhether the item is being edited not not.\r\n\t\t\t// focused: Boolean\r\n\t\t\t//\t\tWhether the item is focused not not.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\t\t\t\t\r\n\t\t\tdomStyle.set(renderer.container, {\"zIndex\": edited || selected ? 20: item.lane == undefined ? 0 : item.lane});\r\n\t\t},\r\n\t\t\r\n\t\tgetIdentity: function(item){\r\n\t\t\treturn this.owner ? this.owner.getIdentity(item) : item.id; \r\n\t\t},\t\t\r\n\t\t\r\n\t\t/////////////////////////////////////////////////////\r\n\t\t//\r\n\t\t// Hovered item\r\n\t\t//\r\n\t\t////////////////////////////////////////////////////\r\n\r\n\t\t_setHoveredItem: function(item, renderer){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSets the current hovered item.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe data item.\r\n\t\t\t// renderer: dojox/calendar/_RendererMixin\r\n\t\t\t//\t\tThe item renderer.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tif(this.owner){\r\n\t\t\t\tthis.owner._setHoveredItem(item, renderer);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(this.hoveredItem && item && this.hoveredItem.id != item.id || \r\n\t\t\t\titem == null || this.hoveredItem == null){\r\n\t\t\t\tvar old = this.hoveredItem;\r\n\t\t\t\tthis.hoveredItem = item;\r\n\t\t\t\t\r\n\t\t\t\tthis.updateRenderers([old, this.hoveredItem], true);\r\n\t\t\t\t\r\n\t\t\t\tif(item && renderer){\r\n\t\t\t\t\tthis._updateEditingCapabilities(item._item ? item._item : item, renderer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// hoveredItem: Object\r\n\t\t//\t\tThe currently hovered data item.\r\n\t\thoveredItem: null,\r\n\t\t\r\n\t\tisItemHovered: function(item){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns whether the specified item is hovered or not.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe item.\r\n\t\t\t// returns: Boolean\r\n\t\t\tif (this._isEditing && this._edProps){\r\n\t\t\t\treturn item.id == this._edProps.editedItem.id;\r\n\t\t\t}\r\n\t\t\treturn this.owner ?  \r\n\t\t\t\tthis.owner.isItemHovered(item) : \r\n\t\t\t\tthis.hoveredItem != null && this.hoveredItem.id == item.id;\r\n\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\tisItemFocused: function(item){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns whether the specified item is focused or not.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe item.\r\n\t\t\t// returns: Boolean\r\n\t\t\treturn this._isItemFocused ? this._isItemFocused(item) : false;\r\n\t\t},\r\n\t\t\r\n\t\t////////////////////////////////////////////////////////////////////\r\n\t\t//\r\n\t\t// Selection delegation\r\n\t\t//\r\n\t\t///////////////////////////////////////////////////////////////////\r\n\t\t\r\n\t\t_setSelectionModeAttr: function(value){\r\n\t\t\tif(this.owner){\r\n\t\t\t\tthis.owner.set(\"selectionMode\", value);\r\n\t\t\t}else{\r\n\t\t\t\tthis.inherited(arguments);\r\n\t\t\t}\t\t\t\r\n\t\t},\t\t\t\t\t\r\n\t\t\r\n\t\t_getSelectionModeAttr: function(value){\t\t\t\r\n\t\t\tif(this.owner){\r\n\t\t\t\treturn this.owner.get(\"selectionMode\");\r\n\t\t\t}\r\n\t\t\treturn this.inherited(arguments);\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_setSelectedItemAttr: function(value){\t\t\t\r\n\t\t\tif(this.owner){\r\n\t\t\t\tthis.owner.set(\"selectedItem\", value);\r\n\t\t\t}else{\r\n\t\t\t\tthis.inherited(arguments);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t_getSelectedItemAttr: function(value){\t\t\t\r\n\t\t\tif(this.owner){\r\n\t\t\t\treturn this.owner.get(\"selectedItem\");\r\n\t\t\t}\r\n\t\t\treturn this.selectedItem; // no getter on super class (dojox.widget.Selection)\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_setSelectedItemsAttr: function(value){\t\t\t\r\n\t\t\tif(this.owner){\r\n\t\t\t\tthis.owner.set(\"selectedItems\", value);\r\n\t\t\t}else{\r\n\t\t\t\tthis.inherited(arguments);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t_getSelectedItemsAttr: function(){\t\t\t\r\n\t\t\tif(this.owner){\r\n\t\t\t\treturn this.owner.get(\"selectedItems\");\r\n\t\t\t}\r\n\t\t\treturn this.inherited(arguments);\r\n\t\t},\r\n\t\t\r\n\t\tisItemSelected: function(item){\t\t\t\r\n\t\t\tif(this.owner){\r\n\t\t\t\treturn this.owner.isItemSelected(item);\r\n\t\t\t}\r\n\t\t\treturn this.inherited(arguments);\r\n\t\t},\r\n\t\t\r\n\t\tselectFromEvent: function(e, item, renderer, dispatch){\t\t\t\r\n\t\t\tif(this.owner){\r\n\t\t\t\tthis.owner.selectFromEvent(e, item, renderer, dispatch);\r\n\t\t\t}else{\r\n\t\t\t\tthis.inherited(arguments);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tsetItemSelected: function(item, value){\r\n\t\t\tif(this.owner){\r\n\t\t\t\tthis.owner.setItemSelected(item, value);\r\n\t\t\t}else{\r\n\t\t\t\tthis.inherited(arguments);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t////////////////////////////////////////////////////////////////////\r\n\t\t//\r\n\t\t// Event creation\r\n\t\t//\r\n\t\t///////////////////////////////////////////////////////////////////\r\n\t\t\r\n\t\tcreateItemFunc: null,\r\n\t\t/*=====\r\n\t\tcreateItemFunc: function(view, d, e){\r\n\t\t \t// summary:\r\n\t\t\t//\t\tA user supplied function that creates a new event.\r\n\t\t\t// view: ViewBase\r\n\t\t\t//\t\tthe current view,\r\n\t\t\t// d: Date\r\n\t\t\t//\t\tthe date at the clicked location.\r\n\t\t\t// e: MouseEvemt\r\n\t\t\t//\t\tthe mouse event (can be used to return null for example)\r\n\t\t\t// subColumn: Object\r\n\t\t\t//\t\tthe subcolumn at clicked location (can return null)\r\n\t\t},\r\n\t\t=====*/\r\n\r\n\t\t\t\t\r\n\t\t_getCreateItemFuncAttr: function(){\t\t\t\r\n\t\t\tif(this.owner){\r\n\t\t\t\treturn this.owner.get(\"createItemFunc\");\r\n\t\t\t}\r\n\t\t\treturn this.createItemFunc;\r\n\t\t},\r\n\t\t\r\n\t\t// createOnGridClick: Boolean\r\n\t\t//\t\tIndicates whether the user can create new event by clicking and dragging the grid.\r\n\t\t//\t\tA createItem function must be defined on the view or the calendar object.\r\n\t\tcreateOnGridClick: false,\r\n\t\t\r\n\t\t_getCreateOnGridClickAttr: function(){\r\n\t\t\tif(this.owner){\r\n\t\t\t\treturn this.owner.get(\"createOnGridClick\");\r\n\t\t\t}\r\n\t\t\treturn this.createOnGridClick;\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t////////////////////////////////////////////////////////////////////\r\n\t\t//\r\n\t\t// Event creation\r\n\t\t//\r\n\t\t///////////////////////////////////////////////////////////////////\t\r\n\t\t\r\n\t\t_gridMouseDown: false,\r\n\t\t\r\n\t\t_tempIdCount: 0,\r\n\t\t_tempItemsMap: null,\r\n\t\t\t\t\r\n\t\t_onGridMouseDown: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tthis._gridMouseDown = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\tthis.showFocus = false;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\tif(this._isEditing){\t\r\n\t\t\t\tthis._endItemEditing(\"mouse\", false);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._doEndItemEditing(this.owner, \"mouse\");\t\t\t\r\n\t\t\t\r\n\t\t\tthis.set(\"focusedItem\", null);\r\n\t\t\tthis.selectFromEvent(e, null, null, true);\r\n\t\t\t\r\n\t\t\tif(this._setTabIndexAttr){\r\n\t\t\t\tthis[this._setTabIndexAttr].focus();\r\n\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\tif(this._onRendererHandleMouseDown){\r\n\t\t\t\t\r\n\t\t\t\tvar f = this.get(\"createItemFunc\");\r\n\t\t\t\t\r\n\t\t\t\tif(!f){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar newItem = this._createdEvent = f(this, this.getTime(e), e, this.getSubColumn(e));\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tvar store = this.get(\"store\");\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tif(!newItem || store == null){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// calendar needs an ID to work with\r\n\t\t\t\tif(store.getIdentity(newItem) == undefined){\r\n\t\t\t\t\tvar id = \"_tempId_\" + (this._tempIdCount++);\r\n\t\t\t\t\tnewItem[store.idProperty] = id;\r\n\t\t\t\t\tif(this._tempItemsMap == null){\r\n\t\t\t\t\t\tthis._tempItemsMap = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._tempItemsMap[id] = true;\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tvar newRenderItem = this.itemToRenderItem(newItem, store);\t\t\t\t\r\n\t\t\t\tnewRenderItem._item = newItem;\r\n\t\t\t\tthis._setItemStoreState(newItem, \"unstored\");\r\n\t\t\t\t\r\n\t\t\t\t// add the new temporary item to the displayed list and force view refresh\r\n\t\t\t\tvar owner = this._getTopOwner();\r\n\t\t\t\tvar items = owner.get(\"items\");\r\n\t\t\t\t\r\n\t\t\t\towner.set(\"items\", items ? items.concat([newRenderItem]) : [newRenderItem]);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tthis._refreshItemsRendering();\r\n\t\t\t\t\r\n\t\t\t\t// renderer created in _refreshItemsRenderering()\r\n\t\t\t\tvar renderers = this.getRenderers(newItem);\t\t\t\t\r\n\t\t\t\tif(renderers && renderers.length>0){\r\n\t\t\t\t\tvar renderer = renderers[0];\t\t\t\t\t\r\n\t\t\t\t\tif(renderer){\r\n\t\t\t\t\t\t// trigger editing\r\n\t\t\t\t\t\tthis._onRendererHandleMouseDown(e, renderer.renderer, \"resizeEnd\");\r\n\t\t\t\t\t\tthis._startItemEditing(newRenderItem, \"mouse\");\t\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t_onGridMouseMove: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t},\r\n\t\t\r\n\t\t_onGridMouseUp: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t},\r\n\t\t\r\n\t\t_onGridTouchStart: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar p = this._edProps;\r\n\r\n\t\t\tthis._gridProps = {\r\n\t\t\t\tevent: e,\t\t\t\t\r\n\t\t\t\tfromItem: this.isAscendantHasClass(e.target, this.eventContainer, \"dojoxCalendarEvent\")\r\n\t\t\t};\t\t\t\r\n\t\r\n\t\t\tif(this._isEditing){\r\n\t\t\t\t\r\n\t\t\t\tif(this._gridProps){\r\n\t\t\t\t\tthis._gridProps.editingOnStart = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlang.mixin(p, this._getTouchesOnRenderers(e, p.editedItem));\r\n\t\t\t\t\r\n\t\t\t\tif(p.touchesLen == 0){\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(p && p.endEditingTimer){\r\n\t\t\t\t\t\tclearTimeout(p.endEditingTimer);\r\n\t\t\t\t\t\tp.endEditingTimer = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._endItemEditing(\"touch\", false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._doEndItemEditing(this.owner, \"touch\");\t\t\r\n\r\n\t\t\tevent.stop(e);\r\n\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_doEndItemEditing: function(obj, eventSource){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tif(obj && obj._isEditing){\r\n\t\t\t\tvar p = obj._edProps;\r\n\t\t\t\tif(p && p.endEditingTimer){\r\n\t\t\t\t\tclearTimeout(p.endEditingTimer);\r\n\t\t\t\t\tp.endEditingTimer = null;\r\n\t\t\t\t}\r\n\t\t\t\tobj._endItemEditing(eventSource, false);\r\n\t\t\t}\t\r\n\t\t},\r\n\t\t\t\t\t\r\n\t\t_onGridTouchEnd: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t},\r\n\t\t\r\n\t\t_onGridTouchMove: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t},\r\n\t\t\r\n\t\t__fixEvt: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tExtension point for a view to add some event properties to a calendar event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\t\t\treturn e;\r\n\t\t},\r\n\t\t\r\n\t\t_dispatchCalendarEvt: function(e, name){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tAdds view properties to event and enable bubbling at owner level.\r\n\t\t\t// e: Event\r\n\t\t\t//\t\tThe dispatched event.\r\n\t\t\t// name: String\r\n\t\t\t//\t\tThe event name.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\t\r\n\t\t\te = this.__fixEvt(e);\r\n\t\t\tthis[name](e);\r\n\t\t\tif(this.owner){\r\n\t\t\t\tthis.owner[name](e);\r\n\t\t\t}\r\n\t\t\treturn e;\r\n\t\t},\r\n\r\n\t\t_onGridClick: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(!e.triggerEvent){\r\n\t\t\t\te = {\r\n\t\t\t\t\tdate: this.getTime(e),\r\n\t\t\t\t\ttriggerEvent: e\r\n\t\t\t\t};\r\n\t\t\t}\t\r\n\t\t\t\r\n\t\t\tthis._dispatchCalendarEvt(e, \"onGridClick\");\r\n\t\t},\r\n\t\t\r\n\t\tonGridClick: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when the grid has been clicked.\r\n\t\t\t// e: __GridClickEventArgs\r\n\t\t\t//\t\tThe event dispatched when the grid is clicked.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\t\t},\r\n\t\t\r\n\t\t_onGridDoubleClick: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tif(!e.triggerEvent){\r\n\t\t\t\te = {\r\n\t\t\t\t\tdate: this.getTime(e),\r\n\t\t\t\t\ttriggerEvent: e\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\tthis._dispatchCalendarEvt(e, \"onGridDoubleClick\");\r\n\t\t},\r\n\t\t\t\t\r\n\t\tonGridDoubleClick: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when the grid has been double-clicked.\r\n\t\t\t// e: __GridClickEventArgs\r\n\t\t\t//\t\tThe event dispatched when the grid is double-clicked.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t},\r\n\t\t\r\n\t\t_onItemClick: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tthis._dispatchCalendarEvt(e, \"onItemClick\");\r\n\t\t},\r\n\t\t\r\n\t\tonItemClick: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when an item renderer has been clicked.\r\n\t\t\t// e: __ItemMouseEventArgs\r\n\t\t\t//\t\tThe event dispatched when an item is clicked.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\r\n\t\t},\r\n\t\t\r\n\t\t_onItemDoubleClick: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tthis._dispatchCalendarEvt(e, \"onItemDoubleClick\");\t\r\n\t\t},\r\n\t\t\r\n\t\tonItemDoubleClick: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when an item renderer has been double-clicked.\r\n\t\t\t// e: __ItemMouseEventArgs\r\n\t\t\t//\t\tThe event dispatched when an item is double-clicked.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\r\n\t\t},\r\n\r\n\t\t_onItemContextMenu: function(e){\r\n\t\t\tthis._dispatchCalendarEvt(e, \"onItemContextMenu\");\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t},\r\n\t\t\r\n\t\tonItemContextMenu: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when an item renderer has been context-clicked.\r\n\t\t\t// e: __ItemMouseEventArgs\r\n\t\t\t//\t\tThe event dispatched when an item is context-clicked.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\r\n\t\t},\r\n\t\t\r\n\t\t//////////////////////////////////////////////////////////\r\n\t\t//\r\n\t\t//\tEditing\r\n\t\t//\r\n\t\t//////////////////////////////////////////////////////////\r\n\r\n\t\t_getStartEndRenderers: function(item){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns an array that contains the first and last renderers of an item \t\t\t\r\n\t\t\t//\t\tthat are currently displayed. They could be the same renderer if only one renderer is used.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe render item.\r\n\t\t\t// returns: Object[]\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\r\n\t\t\tvar list = this.rendererManager.itemToRenderer[item.id];\r\n\r\n\t\t\tif(list == null){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\t// trivial and most common use case.\r\n\t\t\tif(list.length == 1){\r\n\t\t\t\tvar node = list[0].renderer;\r\n\t\t\t\treturn [node, node];\r\n\t\t\t}\r\n\r\n\t\t\tvar rd = this.renderData;\r\n\t\t\tvar resizeStartFound = false;\r\n\t\t\tvar resizeEndFound = false;\r\n\r\n\t\t\tvar res = [];\r\n\r\n\t\t\tfor(var i=0; i<list.length; i++){\r\n\r\n\t\t\t\tvar ir = list[i].renderer;\r\n\r\n\t\t\t\tif (!resizeStartFound){\r\n\t\t\t\t\tresizeStartFound = rd.dateModule.compare(ir.item.range[0], ir.item.startTime) == 0;\r\n\t\t\t\t\tres[0] = ir;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!resizeEndFound){\r\n\t\t\t\t\tresizeEndFound =  rd.dateModule.compare(ir.item.range[1], ir.item.endTime) == 0;\r\n\t\t\t\t\tres[1] = ir;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (resizeStartFound && resizeEndFound){\r\n\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn res;\t\t\t\r\n\t\t},\r\n\t\t\t\t\t\t\t\t\r\n\t\t// editable: Boolean\r\n\t\t//\t\tA flag that indicates whether or not the user can edit\r\n\t\t//\t\titems in the data provider.\r\n\t\t//\t\tIf <code>true</code>, the item renderers in the control are editable.\r\n\t\t//\t\tThe user can click on an item renderer, or use the keyboard or touch devices, to move or resize the associated event.\r\n\t\teditable: true,\r\n\r\n\t\t// moveEnabled: Boolean\r\n\t\t//\t\tA flag that indicates whether the user can move items displayed.\r\n\t\t//\t\tIf <code>true</code>, the user can move the items.\r\n\t\tmoveEnabled: true,\r\n\r\n\t\t// resizeEnabled: Boolean\r\n\t\t//\t\tA flag that indicates whether the items can be resized.\r\n\t\t//\t\tIf `true`, the control supports resizing of items.\r\n\t\tresizeEnabled: true,\r\n\t\t\r\n\t\tisItemEditable: function(item, rendererKind){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tComputes whether particular item renderer can be edited or not.\r\n\t\t\t//\t\tBy default it is using the editable property value.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe item represented by the renderer.\r\n\t\t\t// rendererKind: String\r\n\t\t\t//\t\tThe kind of renderer.\r\n\t\t\t// returns: Boolean\t\t\t\r\n\t\t\treturn this.getItemStoreState(item) != \"storing\" && this.editable && (this.owner ? this.owner.isItemEditable(item, rendererKind) : true);\r\n\t\t},\r\n\r\n\t\tisItemMoveEnabled: function(item, rendererKind){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tComputes whether particular item renderer can be moved.\r\n\t\t\t//\t\tBy default it is using the moveEnabled property value.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe item represented by the renderer.\r\n\t\t\t// rendererKind: String\r\n\t\t\t//\t\tThe kind of renderer.\r\n\t\t\t// returns: Boolean\r\n\t\t\treturn this.isItemEditable(item, rendererKind) && this.moveEnabled && \r\n\t\t\t\t(this.owner ? this.owner.isItemMoveEnabled(item, rendererKind): true);\r\n\t\t},\r\n\t\t\r\n\t\tisItemResizeEnabled: function(item, rendererKind){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tComputes whether particular item renderer can be resized.\r\n\t\t\t//\t\tBy default it is using the resizedEnabled property value.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe item represented by the renderer.\r\n\t\t\t// rendererKind: String\r\n\t\t\t//\t\tThe kind of renderer.\r\n\t\t\t// returns: Boolean\r\n\t\t\t\r\n\t\t\treturn this.isItemEditable(item, rendererKind) && this.resizeEnabled && \r\n\t\t\t\t(this.owner ? this.owner.isItemResizeEnabled(item, rendererKind): true);\r\n\t\t},\r\n\r\n\t\t// _isEditing: Boolean\r\n\t\t//\t\tWhether an item is being edited or not.\r\n\t\t_isEditing: false,\r\n\t\t\r\n\t\tisItemBeingEdited: function(item){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns whether an item is being edited or not.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe item to test.\r\n\t\t\t// returns: Boolean\r\n\t\t\treturn this._isEditing && this._edProps && this._edProps.editedItem && this._edProps.editedItem.id == item.id;\r\n\t\t},\r\n\t\t\r\n\t\t_setEditingProperties: function(props){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRegisters the editing properties used by the editing functions.\r\n\t\t\t//\t\tThis method should only be called by editing interaction mixins like Mouse, Keyboard and Touch.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tthis._edProps = props;\r\n\t\t},\r\n\t\t\r\n\t\t_startItemEditing: function(item, eventSource){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tConfigures the component, renderers to start one (mouse) of several (touch, keyboard) editing gestures.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe item that will be edited.\r\n\t\t\t// eventSource: String\r\n\t\t\t//\t\t\"mouse\", \"keyboard\", \"touch\"\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tthis._isEditing = true;\r\n\t\t\tthis._getTopOwner()._isEditing = true;\r\n\t\t\tvar p = this._edProps;\r\n\t\t\t\r\n\t\t\tp.editedItem = item;\r\n\t\t\tp.storeItem = item._item;\r\n\t\t\tp.eventSource = eventSource;\r\n\t\t\t\r\n\t\t\tp.secItem = this._secondarySheet ? this._findRenderItem(item.id, this._secondarySheet.renderData.items) : null;\r\n\t\t\tp.ownerItem = this.owner ? this._findRenderItem(item.id, this.items) : null;\r\n\t\t\t\t\t\t\r\n\t\t\tif (!p.liveLayout){\r\n\t\t\t\tp.editSaveStartTime = item.startTime;\r\n\t\t\t\tp.editSaveEndTime = item.endTime;\r\n\t\t\t\t\r\n\t\t\t\tp.editItemToRenderer = this.rendererManager.itemToRenderer;\r\n\t\t\t\tp.editItems = this.renderData.items;\r\n\t\t\t\tp.editRendererList = this.rendererManager.rendererList;\r\n\t\t\t\t\r\n\t\t\t\tthis.renderData.items = [p.editedItem];\r\n\t\t\t\tvar id = p.editedItem.id;\r\n\t\t\t\r\n\t\t\t\tthis.rendererManager.itemToRenderer = {};\r\n\t\t\t\tthis.rendererManager.rendererList = [];\r\n\t\t\t\tvar list = p.editItemToRenderer[id];\r\n\t\t\t\t\r\n\t\t\t\tp.editRendererIndices = [];\r\n\t\t\t\t\r\n\t\t\t\tarr.forEach(list, lang.hitch(this, function(ir, i){\r\n\t\t\t\t\tif(this.rendererManager.itemToRenderer[id] == null){\r\n\t\t\t\t\t\tthis.rendererManager.itemToRenderer[id] = [ir];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.rendererManager.itemToRenderer[id].push(ir);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.rendererManager.rendererList.push(ir);\r\n\t\t\t\t}));\r\n\t\t\t\t\r\n\t\t\t\t// remove in old map & list the occurrence used by the edited item\r\n\t\t\t\tp.editRendererList = arr.filter(p.editRendererList, function(ir){\r\n\t\t\t\t\treturn ir != null && ir.renderer.item.id != id;\r\n\t\t\t\t});\r\n\t\t\t\tdelete p.editItemToRenderer[id];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// graphic feedback refresh\r\n\t\t\tthis._layoutRenderers(this.renderData);\r\n\t\t\t\r\n\t\t\tthis._onItemEditBegin({\r\n\t\t\t\titem: item,\r\n\t\t\t\tstoreItem: p.storeItem,\r\n\t\t\t\teventSource: eventSource\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\t_onItemEditBegin: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tthis._editStartTimeSave = this.newDate(e.item.startTime);\r\n\t\t\tthis._editEndTimeSave = this.newDate(e.item.endTime);\r\n\t\t\t\r\n\t\t\tthis._dispatchCalendarEvt(e, \"onItemEditBegin\");\r\n\t\t},\r\n\t\t\r\n\t\tonItemEditBegin: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when the item is entering the editing mode.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\r\n\t\t},\r\n\t\t\r\n\t\t_endItemEditing: function(/*String*/eventSource, /*Boolean*/canceled){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tLeaves the item editing mode.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe item that was edited.\r\n\t\t\t// eventSource: String\r\n\t\t\t//\t\t\"mouse\", \"keyboard\", \"touch\"\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\t\r\n\t\t\tif(this._editingGesture){\r\n\t\t\t\t// make sure to stop the current gesture if any\r\n\t\t\t\tthis._endItemEditingGesture(eventSource);\r\n\t\t\t}\r\n\r\n\t\t\tthis._isEditing = false;\r\n\t\t\tthis._getTopOwner()._isEditing = false;\r\n\t\t\t\r\n\t\t\tvar p = this._edProps;\r\n\t\t\t\r\n\t\t\tarr.forEach(p.handles, function(handle){\r\n\t\t\t\thandle.remove();\r\n\t\t\t});\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\tif (!p.liveLayout){\r\n\t\t\t\tthis.renderData.items = p.editItems;\r\n\t\t\t\tthis.rendererManager.rendererList = p.editRendererList.concat(this.rendererManager.rendererList);\r\n\t\t\t\tlang.mixin(this.rendererManager.itemToRenderer, p.editItemToRenderer);\r\n\t\t\t}\r\n\r\n\t\t\tthis._onItemEditEnd(lang.mixin(this._createItemEditEvent(), {\r\n\t\t\t\titem: p.editedItem,\r\n\t\t\t\tstoreItem: p.storeItem,\r\n\t\t\t\teventSource: eventSource,\r\n\t\t\t\tcompleted: !canceled\r\n\t\t\t}));\r\n\t\t\t\r\n\t\t\tthis._layoutRenderers(this.renderData);\t\t\t\t\r\n\t\t\t\r\n\t\t\tthis._edProps = null;\r\n\t\t},\r\n\t\t\r\n\t\t_onItemEditEnd: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\t\t\t\t\t\t\r\n\t\t\tthis._dispatchCalendarEvt(e, \"onItemEditEnd\");\r\n\t\t\t\r\n\t\t\tif(!e.isDefaultPrevented()){\r\n\t\t\t\t\r\n\t\t\t\tvar store = this.get(\"store\");\r\n\t\t\t\t\r\n\t\t\t\t// updated store item\r\n\t\t\t\tvar storeItem = this.renderItemToItem(e.item, store);\r\n\t\t\t\t\r\n\t\t\t\tvar s = this._getItemStoreStateObj(e.item);\r\n\t\t\t\t\r\n\t\t\t\tif(s != null && s.state == \"unstored\"){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tif(e.completed){\r\n\t\t\t\t\t\t// renderItemToItem cannot find the original data item\r\n\t\t\t\t\t\t// (as it does not exist in the store yet) to mixin with.\r\n\t\t\t\t\t\t// so we must do it here.\r\n\t\t\t\t\t\tstoreItem = lang.mixin(s.item, storeItem);\r\n\t\t\t\t\t\tthis._setItemStoreState(storeItem, \"storing\");\r\n\t\t\t\t\t\tvar oldID = store.getIdentity(storeItem);\r\n\t\t\t\t\t\tvar options = null;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(this._tempItemsMap && this._tempItemsMap[oldID]){\r\n\t\t\t\t\t\t\toptions = {temporaryId: oldID}; \r\n\t\t\t\t\t\t\tdelete this._tempItemsMap[oldID];\r\n\t\t\t\t\t\t\tdelete storeItem[store.idProperty];\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// add to the store.\r\n\t\t\t\t\t\twhen(store.add(storeItem, options), lang.hitch(this, function(res){\r\n\t\t\t\t\t\t\tvar id;\r\n\t\t\t\t\t\t\tif(lang.isObject(res)){\r\n\t\t\t\t\t\t\t\tid = store.getIdentity(res);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tid = res;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif(id != oldID){\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis._removeRenderItem(oldID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}else{ // creation canceled\r\n\t\t\t\t\t\t// cleanup items list\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis._removeRenderItem(s.id);\t\t\t\t\t\r\n\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t} else if(e.completed){\r\n\t\t\t\t\t// Inject new properties in data store item\t\t\t\t\r\n\t\t\t\t\t// and apply data changes\t\t\r\n\t\t\t\t\tthis._setItemStoreState(storeItem, \"storing\");\r\n\t\t\t\t\tstore.put(storeItem);\t\t\t\t\t\t\t\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\te.item.startTime = this._editStartTimeSave; \r\n\t\t\t\t\te.item.endTime = this._editEndTimeSave;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t_removeRenderItem: function(id){\r\n\t\t\t\r\n\t\t\tvar owner = this._getTopOwner();\r\n\t\t\tvar items = owner.get(\"items\");\r\n\t\t\tvar l = items.length; \r\n\t\t\tvar found = false;\r\n\t\t\tfor(var i=l-1; i>=0; i--){\r\n\t\t\t\tif(items[i].id == id){\r\n\t\t\t\t\titems.splice(i, 1);\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._cleanItemStoreState(id);\r\n\t\t\tif(found){\r\n\t\t\t\towner.set(\"items\", items); //force a complete relayout\t\r\n\t\t\t\tthis.invalidateLayout();\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonItemEditEnd: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when the item is leaving the editing mode.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t},\r\n\t\t\r\n\t\t_createItemEditEvent: function(){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar e = {\r\n\t\t\t\tcancelable: true,\r\n\t\t\t\tbubbles: false,\r\n\t\t\t\t__defaultPrevent: false\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\te.preventDefault = function(){\r\n\t\t\t\tthis.__defaultPrevented = true;\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\te.isDefaultPrevented = function(){\r\n\t\t\t\treturn this.__defaultPrevented;\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\treturn e;\r\n\t\t},\r\n\r\n\t\t\r\n\t\t_startItemEditingGesture: function(dates, editKind, eventSource, e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tStarts the editing gesture.\r\n\t\t\t// date: Date[]\r\n\t\t\t//\t\tThe reference dates (at least one). \r\n\t\t\t// editKind: String\r\n\t\t\t//\t\tKind of edit: \"resizeBoth\", \"resizeStart\", \"resizeEnd\" or \"move\".\r\n\t\t\t// eventSource: String\r\n\t\t\t//\t\t\"mouse\", \"keyboard\", \"touch\"\r\n\t\t\t// e: Event\r\n\t\t\t//\t\tThe event at the origin of the editing gesture.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\t\r\n\t\t\tvar p = this._edProps;\r\n\t\t\t\r\n\t\t\tif(!p || p.editedItem == null){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._editingGesture = true;\r\n\t\t\t\r\n\t\t\tvar item = p.editedItem;\r\n\t\t\t\r\n\t\t\tp.editKind = editKind; \r\n\t\t\t\r\n\t\t\tthis._onItemEditBeginGesture(this.__fixEvt(lang.mixin(this._createItemEditEvent(), {\r\n\t\t\t\titem: item,\r\n\t\t\t\tstoreItem: p.storeItem,\r\n\t\t\t\tstartTime: item.startTime,\r\n\t\t\t\tendTime: item.endTime,\r\n\t\t\t\teditKind: editKind,\r\n\t\t\t\trendererKind: p.rendererKind,\r\n\t\t\t\ttriggerEvent: e,\r\n\t\t\t\tdates: dates,\r\n\t\t\t\teventSource: eventSource\r\n\t\t\t})));\r\n\t\t\t\r\n\t\t\tp.itemBeginDispatched = true;\r\n\r\n\t\t},\r\n\t\t\r\n\t\t\r\n\t\t_onItemEditBeginGesture: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar p = this._edProps;\r\n\t\t\t\r\n\t\t\tvar item = p.editedItem;\r\n\t\t\tvar dates = e.dates;\r\n\t\t\t\r\n\t\t\tp.editingTimeFrom = [];\t\t\t\r\n\t\t\tp.editingTimeFrom[0] = dates[0];\t\t\t\r\n\t\t\t\r\n\t\t\tp.editingItemRefTime = [];\r\n\t\t\tp.editingItemRefTime[0] = this.newDate(p.editKind == \"resizeEnd\" ? item.endTime : item.startTime);\r\n\t\t\t\r\n\t\t\tif (p.editKind == \"resizeBoth\"){\r\n\t\t\t\tp.editingTimeFrom[1] = dates[1];\r\n\t\t\t\tp.editingItemRefTime[1] = this.newDate(item.endTime);\t\t\t\t\r\n\t\t\t}\t\t\r\n\t\t\t\r\n\t\t\tvar cal = this.renderData.dateModule;\r\n\t\t\t\r\n\t\t\tp.inViewOnce = this._isItemInView(item);\r\n\t\t\t\r\n\t\t\tif(p.rendererKind == \"label\" || this.roundToDay){\r\n\t\t\t\tp._itemEditBeginSave = this.newDate(item.startTime);\r\n\t\t\t\tp._itemEditEndSave = this.newDate(item.endTime);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tp._initDuration = cal.difference(item.startTime, item.endTime, item.allDay?\"day\":\"millisecond\");\t\r\n\t\t\t\r\n\t\t\tthis._dispatchCalendarEvt(e, \"onItemEditBeginGesture\");\r\n\r\n\t\t\tif (!e.isDefaultPrevented()){\r\n\t\t\t\t\r\n\t\t\t\tif (e.eventSource == \"mouse\"){\r\n\t\t\t\t\tvar cursor = e.editKind==\"move\"?\"move\":this.resizeCursor;\r\n\t\t\t\t\tp.editLayer = domConstruct.create(\"div\", {\r\n\t\t\t\t\t\tstyle: \"position: absolute; left:0; right:0; bottom:0; top:0; z-index:30; tabIndex:-1; background-image:url('\"+this._blankGif+\"'); cursor: \"+cursor,\r\n\t\t\t\t\t\tonresizestart: function(e){return false;},\r\n\t\t\t\t\t\tonselectstart: function(e){return false;}\r\n\t\t\t\t\t}, this.domNode);\r\n\t\t\t\t\tp.editLayer.focus();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonItemEditBeginGesture: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when an editing gesture is beginning.\r\n\t\t\t// e: __itemEditingEventArgs\r\n\t\t\t//\t\tThe editing event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\r\n\t\t},\r\n\t\t\r\n\t\t_waDojoxAddIssue: function(d, unit, steps){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tWorkaround an issue of dojox.date.XXXXX.date.add() function \r\n\t\t\t//\t\tthat does not support the subtraction of time correctly (normalization issues). \r\n\t\t\t// d: Date\r\n\t\t\t//\t\tReference date.\r\n\t\t\t// unit: String\r\n\t\t\t//\t\tUnit to add.\r\n\t\t\t// steps: Integer\r\n\t\t\t//\t\tNumber of units to add.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tvar cal = this.renderData.dateModule;\r\n\t\t\tif(this._calendar != \"gregorian\" && steps < 0){\r\n\t\t\t\tvar gd = d.toGregorian();\r\n\t\t\t\tgd = date.add(gd, unit, steps);\r\n\t\t\t\treturn new this.renderData.dateClassObj(gd);\r\n\t\t\t}else{\r\n\t\t\t\treturn cal.add(d, unit, steps);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\t\t\t\t\r\n\t\t_computeItemEditingTimes: function(item, editKind, rendererKind, times, eventSource){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar cal = this.renderData.dateModule;\r\n\t\t\tvar p = this._edProps;\r\n\t\t\tif(editKind == \"move\"){\r\n\t\t\t\tvar diff = cal.difference(p.editingTimeFrom[0], times[0], \"millisecond\");\r\n\t\t\t\ttimes[0] = this._waDojoxAddIssue(p.editingItemRefTime[0], \"millisecond\", diff);\r\n\t\t\t}\t\t\t\t\t\r\n\t\t\treturn times;\r\n\t\t},\r\n\t\t\r\n\t\t_moveOrResizeItemGesture: function(dates, eventSource, e, subColumn){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tMoves or resizes an item.\r\n\t\t\t// dates: Date[]\r\n\t\t\t//\t\tThe reference dates.\r\n\t\t\t// editKind: String\r\n\t\t\t//\t\tKind of edit: \"resizeStart\", \"resizeEnd\", \"resizeBoth\" or \"move\".\r\n\t\t\t// eventSource: String\r\n\t\t\t//\t\t\"mouse\", \"keyboard\", \"touch\"\r\n\t\t\t// e: Event\r\n\t\t\t//\t\tThe event at the origin of the editing gesture.\r\n\t\t\t// subColumn: String\r\n\t\t\t//\t\tThe sub column value, if any, or null.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tif(!this._isEditing || dates[0] == null){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar p = this._edProps;\r\n\t\t\tvar item = p.editedItem;\r\n\t\t\tvar rd = this.renderData;\r\n\t\t\tvar cal = rd.dateModule;\r\n\t\t\tvar editKind = p.editKind;\r\n\t\t\t\t\t\r\n\t\t\tvar newTimes = [dates[0]];\r\n\t\t\t\r\n\t\t\tif(editKind == \"resizeBoth\"){\r\n\t\t\t\tnewTimes[1] = dates[1];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tnewTimes = this._computeItemEditingTimes(item, p.editKind, p.rendererKind, newTimes, eventSource);\r\n\t\t\t\t\t\t\t\r\n\t\t\tvar newTime = newTimes[0]; // usual use case\r\n\t\t\t\t\t\r\n\t\t\tvar moveOrResizeDone = false;\r\n\t\t\t\r\n\t\t\tvar oldStart = lang.clone(item.startTime);\r\n\t\t\tvar oldEnd = lang.clone(item.endTime);\r\n\t\t\tvar oldSubColumn = item.subColumn;\r\n\t\t\t\r\n\t\t\t// swap cannot used using keyboard as a gesture is made of one single change (loss of start/end context).\r\n\t\t\tvar allowSwap = p.eventSource == \"keyboard\" ? false : this.allowStartEndSwap;\r\n\r\n\t\t\t// Update the Calendar with the edited value.\r\n\t\t\tif(editKind == \"move\"){\r\n\t\t\t\tif(subColumn != null && item.subColumn != subColumn && this.allowSubColumnMove){\r\n\t\t\t\t\t// TODO abstract change?\r\n\t\t\t\t\titem.subColumn = subColumn;\r\n\t\t\t\t\t// refresh the other properties that depends on this one (especially cssClass)\r\n\t\t\t\t\tvar store = this.get(\"store\");\r\n\t\t\t\t\tvar storeItem = this.renderItemToItem(item, store);\r\n\t\t\t\t\tlang.mixin(item, this.itemToRenderItem(storeItem, store));\r\n\t\t\t\t\tmoveOrResizeDone = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(cal.compare(item.startTime, newTime) != 0){\r\n\t\t\t\t\tvar duration = cal.difference(item.startTime, item.endTime, \"millisecond\");\r\n\t\t\t\t\titem.startTime = this.newDate(newTime);\r\n\t\t\t\t\titem.endTime = cal.add(item.startTime, \"millisecond\", duration);\r\n\t\t\t\t\tmoveOrResizeDone = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}else if(editKind == \"resizeStart\"){\r\n\t\t\t\t\r\n\t\t\t\tif(cal.compare(item.startTime, newTime) != 0){\t\r\n\t\t\t\t\tif(cal.compare(item.endTime, newTime) != -1){\t\t\t\t\r\n\t\t\t\t\t\titem.startTime = this.newDate(newTime);\r\n\t\t\t\t\t}else{ // swap detected\r\n\t\t\t\t\t\tif(allowSwap){\r\n\t\t\t\t\t\t\titem.startTime = this.newDate(item.endTime);\r\n\t\t\t\t\t\t\titem.endTime = this.newDate(newTime);\t\r\n\t\t\t\t\t\t\tp.editKind = editKind = \"resizeEnd\";\r\n\t\t\t\t\t\t\tif(eventSource == \"touch\"){ // invert touches as well!\r\n\t\t\t\t\t\t\t\tp.resizeEndTouchIndex = p.resizeStartTouchIndex;\r\n\t\t\t\t\t\t\t\tp.resizeStartTouchIndex = -1;\r\n\t\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\t}else{ // block the swap but keep the time of day\r\n\t\t\t\t\t\t\titem.startTime = this.newDate(item.endTime);\r\n\t\t\t\t\t\t\titem.startTime.setHours(newTime.getHours());\r\n\t\t\t\t\t\t\titem.startTime.setMinutes(newTime.getMinutes());\r\n\t\t\t\t\t\t\titem.startTime.setSeconds(newTime.getSeconds());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmoveOrResizeDone = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}else if(editKind == \"resizeEnd\"){\r\n\t\t\t\t\r\n\t\t\t\tif(cal.compare(item.endTime, newTime) != 0){\r\n\t\t\t\t\tif(cal.compare(item.startTime, newTime) != 1){\r\n\t\t\t\t\t\titem.endTime = this.newDate(newTime);\t\r\n\t\t\t\t\t}else{ // swap detected\r\n\r\n\t\t\t\t\t\tif(allowSwap){\r\n\t\t\t\t\t\t\titem.endTime = this.newDate(item.startTime);\r\n\t\t\t\t\t\t\titem.startTime = this.newDate(newTime);\t\r\n\t\t\t\t\t\t\tp.editKind = editKind = \"resizeStart\";\r\n\t\t\t\t\t\t\tif(eventSource == \"touch\"){ // invert touches as well!\r\n\t\t\t\t\t\t\t\tp.resizeStartTouchIndex = p.resizeEndTouchIndex;\r\n\t\t\t\t\t\t\t\tp.resizeEndTouchIndex = -1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else{ // block the swap but keep the time of day\r\n\t\t\t\t\t\t\titem.endTime = this.newDate(item.startTime);\r\n\t\t\t\t\t\t\titem.endTime.setHours(newTime.getHours());\r\n\t\t\t\t\t\t\titem.endTime.setMinutes(newTime.getMinutes());\r\n\t\t\t\t\t\t\titem.endTime.setSeconds(newTime.getSeconds());\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmoveOrResizeDone = true;\r\n\t\t\t\t}\r\n\t\t\t}else if(editKind == \"resizeBoth\"){\r\n\t\t\t\t\r\n\t\t\t\t\tmoveOrResizeDone = true;\r\n\r\n\t\t\t\t\tvar start =  this.newDate(newTime);\r\n\t\t\t\t\tvar end = this.newDate(newTimes[1]);\t\t\r\n\r\n\t\t\t\t\tif(cal.compare(start, end) != -1){ // swap detected\r\n\t\t\t\t\t\tif(allowSwap){\r\n\t\t\t\t\t\t\tvar t = start;\r\n\t\t\t\t\t\t\tstart = end;\r\n\t\t\t\t\t\t\tend = t;\r\n\t\t\t\t\t\t}else{ // as both ends are moved, the simple way is to forbid the move gesture.\r\n\t\t\t\t\t\t\tmoveOrResizeDone = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(moveOrResizeDone){\r\n\t\t\t\t\t\titem.startTime = start;\r\n\t\t\t\t\t\titem.endTime = end; \r\n\t\t\t\t\t}\r\n\r\n\t\t\t}else{\t\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif(!moveOrResizeDone){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar evt = lang.mixin(this._createItemEditEvent(), {\r\n\t\t\t\titem: item,\r\n\t\t\t\tstoreItem: p.storeItem,\r\n\t\t\t\tstartTime: item.startTime,\r\n\t\t\t\tendTime: item.endTime,\r\n\t\t\t\teditKind: editKind,\r\n\t\t\t\trendererKind: p.rendererKind,\r\n\t\t\t\ttriggerEvent: e,\r\n\t\t\t\teventSource: eventSource\r\n\t\t\t}); \r\n\t\t\t\r\n\t\t\t// trigger snapping, rounding, minimal duration, boundaries checks etc.\r\n\t\t\tif(editKind == \"move\"){\r\n\t\t\t\tthis._onItemEditMoveGesture(evt);\r\n\t\t\t}else{\r\n\t\t\t\tthis._onItemEditResizeGesture(evt);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// prevent invalid range\r\n\t\t\tif(cal.compare(item.startTime, item.endTime) == 1){\r\n\t\t\t\tvar tmp = item.startTime;\r\n\t\t\t\titem.startTime = item.endTime;\r\n\t\t\t\titem.endTime = tmp;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tmoveOrResizeDone = \r\n\t\t\t\toldSubColumn != item.subColumn ||\r\n\t\t\t\tcal.compare(oldStart, item.startTime) != 0 || \r\n\t\t\t\tcal.compare(oldEnd, item.endTime) != 0;\r\n\t\t\t\r\n\t\t\tif(!moveOrResizeDone){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis._layoutRenderers(this.renderData);\t\r\n\r\n\t\t\tif(p.liveLayout && p.secItem != null){\r\n\t\t\t\tp.secItem.startTime = item.startTime;\r\n\t\t\t\tp.secItem.endTime = item.endTime;\r\n\t\t\t\tthis._secondarySheet._layoutRenderers(this._secondarySheet.renderData);\r\n\t\t\t}else if(p.ownerItem != null && this.owner.liveLayout){\r\n\t\t\t\tp.ownerItem.startTime = item.startTime;\r\n\t\t\t\tp.ownerItem.endTime = item.endTime;\r\n\t\t\t\tthis.owner._layoutRenderers(this.owner.renderData);\r\n\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\t\r\n\t\t_findRenderItem: function(id, list){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tlist = list || this.renderData.items;\r\n\t\t\tfor(var i=0; i<list.length; i++){\r\n\t\t\t\tif(list[i].id == id){\r\n\t\t\t\t\treturn list[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\t_onItemEditMoveGesture: function(e){\t\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tthis._dispatchCalendarEvt(e, \"onItemEditMoveGesture\");\r\n\r\n\t\t\tif(!e.isDefaultPrevented()){\r\n\t\t\t\t\r\n\t\t\t\tvar p = e.source._edProps;\r\n\t\t\t\tvar rd = this.renderData;\r\n\t\t\t\tvar cal = rd.dateModule;\r\n\t\t\t\tvar newStartTime, newEndTime;\r\n\t\t\t\t\r\n\t\t\t\tif(p.rendererKind == \"label\" || (this.roundToDay && !e.item.allDay)){\r\n\t\t\t\t\t\r\n\t\t\t\t\tnewStartTime = this.floorToDay(e.item.startTime, false, rd);\r\n\t\t\t\t\tnewStartTime.setHours(p._itemEditBeginSave.getHours());\r\n\t\t\t\t\tnewStartTime.setMinutes(p._itemEditBeginSave.getMinutes());\r\n\t\t\t\t\t\r\n\t\t\t\t\tnewEndTime = cal.add(newStartTime, \"millisecond\", p._initDuration);\r\n\t\t\t\t\t\r\n\t\t\t\t}else if(e.item.allDay){\r\n\t\t\t\t\tnewStartTime = this.floorToDay(e.item.startTime, true);\r\n\t\t\t\t\tnewEndTime = cal.add(newStartTime, \"day\", p._initDuration);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tnewStartTime = this.floorDate(e.item.startTime, this.snapUnit, this.snapSteps);\r\n\t\t\t\t\tnewEndTime = cal.add(newStartTime, \"millisecond\", p._initDuration);\r\n\t\t\t\t} \r\n\r\n\t\t\t\te.item.startTime = newStartTime;\r\n\t\t\t\te.item.endTime = newEndTime;\r\n\t\t\t\t\r\n\t\t\t\tif(!p.inViewOnce){\r\n\t\t\t\t\tp.inViewOnce = this._isItemInView(e.item);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// to prevent strange behaviors use constraint in items already fully in view.\r\n\t\t\t\tif(p.inViewOnce && this.stayInView){\r\n\t\t\t\t\tthis._ensureItemInView(e.item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t_DAY_IN_MILLISECONDS: 24 * 60 * 60 * 1000,\r\n\t\t\r\n\t\tonItemEditMoveGesture: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched during a move editing gesture.\r\n\t\t\t// e: __itemEditingEventArgs\r\n\t\t\t//\t\tThe editing event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\r\n\t\t},\r\n\t\t\t\t\r\n\t\t_onItemEditResizeGesture: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tthis._dispatchCalendarEvt(e, \"onItemEditResizeGesture\");\r\n\t\t\t\r\n\t\t\tif(!e.isDefaultPrevented()){\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tvar p = e.source._edProps;\r\n\t\t\t\tvar rd = this.renderData;\r\n\t\t\t\tvar cal = rd.dateModule;\r\n\t\t\t\t\r\n\t\t\t\tvar newStartTime = e.item.startTime;\r\n\t\t\t\tvar newEndTime = e.item.endTime;\r\n\t\t\t\t\r\n\t\t\t\tif(e.editKind == \"resizeStart\"){\r\n\t\t\t\t\tif(e.item.allDay){\r\n\t\t\t\t\t\tnewStartTime = this.floorToDay(e.item.startTime, false, this.renderData);\r\n\t\t\t\t\t}else if(this.roundToDay){\r\n\t\t\t\t\t\tnewStartTime = this.floorToDay(e.item.startTime, false, rd);\r\n\t\t\t\t\t\tnewStartTime.setHours(p._itemEditBeginSave.getHours());\r\n\t\t\t\t\t\tnewStartTime.setMinutes(p._itemEditBeginSave.getMinutes());\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tnewStartTime = this.floorDate(e.item.startTime, this.snapUnit, this.snapSteps);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else if(e.editKind == \"resizeEnd\"){\r\n\t\t\t\t\tif(e.item.allDay){\r\n\t\t\t\t\t\tif(!this.isStartOfDay(e.item.endTime)){\r\n\t\t\t\t\t\t\tnewEndTime = this.floorToDay(e.item.endTime, false, this.renderData);\r\n\t\t\t\t\t\t\tnewEndTime = cal.add(newEndTime, \"day\", 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else if(this.roundToDay){\r\n\t\t\t\t\t\tnewEndTime = this.floorToDay(e.item.endTime, false, rd);\r\n\t\t\t\t\t\tnewEndTime.setHours(p._itemEditEndSave.getHours());\r\n\t\t\t\t\t\tnewEndTime.setMinutes(p._itemEditEndSave.getMinutes());\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tnewEndTime = this.floorDate(e.item.endTime, this.snapUnit, this.snapSteps);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tif(e.eventSource == \"mouse\"){\r\n\t\t\t\t\t\t\tnewEndTime = cal.add(newEndTime, this.snapUnit, this.snapSteps);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{ // Resize both\r\n\t\t\t\t\tnewStartTime = this.floorDate(e.item.startTime, this.snapUnit, this.snapSteps);\r\n\t\t\t\t\tnewEndTime = this.floorDate(e.item.endTime, this.snapUnit, this.snapSteps);\r\n\t\t\t\t\tnewEndTime = cal.add(newEndTime, this.snapUnit, this.snapSteps);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\te.item.startTime = newStartTime;\r\n\t\t\t\te.item.endTime = newEndTime;\r\n\t\t\t\t\r\n\t\t\t\tvar minimalDay = e.item.allDay || p._initDuration >= this._DAY_IN_MILLISECONDS && !this.allowResizeLessThan24H;\r\n\t\t\t\t\r\n\t\t\t\tthis.ensureMinimalDuration(this.renderData, e.item, \r\n\t\t\t\t\tminimalDay ? \"day\" : this.minDurationUnit, \r\n\t\t\t\t\tminimalDay ? 1 : this.minDurationSteps, \r\n\t\t\t\t\te.editKind);\r\n\t\t\t\t\t\r\n\t\t\t\tif(!p.inViewOnce){\r\n\t\t\t\t\tp.inViewOnce = this._isItemInView(e.item);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// to prevent strange behaviors use constraint in items already fully in view.\r\n\t\t\t\tif(p.inViewOnce && this.stayInView){\r\n\t\t\t\t\tthis._ensureItemInView(e.item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonItemEditResizeGesture: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched during a resize editing gesture.\r\n\t\t\t// e: __itemEditingEventArgs\r\n\t\t\t//\t\tThe editing event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\r\n\t\t},\r\n\t\t\r\n\t\t_endItemEditingGesture: function(/*String*/eventSource,\t/*Event*/e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tif(!this._isEditing){\r\n\t\t\t\treturn;\r\n\t\t\t}\t\t\t\t\t\r\n\t\t\t\r\n\t\t\tthis._editingGesture = false;\r\n\t\t\t\r\n\t\t\tvar p = this._edProps;\r\n\t\t\tvar item = p.editedItem;\r\n\t\t\t\r\n\t\t\tp.itemBeginDispatched = false;\t\t\t\t\t\t\t\r\n\t\t\t\r\n\t\t\tthis._onItemEditEndGesture(lang.mixin(this._createItemEditEvent(), {\r\n\t\t\t\titem: item,\r\n\t\t\t\tstoreItem: p.storeItem,\r\n\t\t\t\tstartTime: item.startTime,\r\n\t\t\t\tendTime: item.endTime,\r\n\t\t\t\teditKind: p.editKind,\r\n\t\t\t\trendererKind: p.rendererKind,\r\n\t\t\t\ttriggerEvent: e,\r\n\t\t\t\teventSource: eventSource\r\n\t\t\t}));\r\n\r\n\t\t},\r\n\t\t\r\n\t\t_onItemEditEndGesture: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar p = this._edProps;\r\n\t\t\t\r\n\t\t\tdelete p._itemEditBeginSave;\r\n\t\t\tdelete p._itemEditEndSave;\r\n\t\t\t\t\t\r\n\t\t\tthis._dispatchCalendarEvt(e, \"onItemEditEndGesture\");\r\n\t\t\t\r\n\t\t\tif (!e.isDefaultPrevented()){\r\n\t\t\t\tif(p.editLayer){\r\n\t\t\t\t\tif(has(\"ie\")){\r\n\t\t\t\t\t\tp.editLayer.style.cursor = \"default\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\t\t\t\tif(this.domNode){ // for unit tests\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis.domNode.focus();\r\n\t\t\t\t\t\t\tp.editLayer.parentNode.removeChild(p.editLayer);\r\n\t\t\t\t\t\t\tp.editLayer = null;\r\n\t\t\t\t\t\t}\t\t\r\n\t\t\t\t\t}), 10);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonItemEditEndGesture: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched at the end of an editing gesture.\r\n\t\t\t// e: __itemEditingEventArgs\r\n\t\t\t//\t\tThe editing event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\r\n\t\t},\r\n\t\t\r\n\t\tensureMinimalDuration: function(renderData, item, unit, steps, editKind){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDuring the resize editing gesture, ensures that the item has the specified minimal duration.\r\n\t\t\t// renderData: Object\r\n\t\t\t//\t\tThe render data.\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe edited item.\r\n\t\t\t// unit: String\r\n\t\t\t//\t\tThe unit used to define the minimal duration.\r\n\t\t\t// steps: Integer\r\n\t\t\t//\t\tThe number of time units.\r\n\t\t\t// editKind: String\r\n\t\t\t//\t\tThe edit kind: \"resizeStart\" or \"resizeEnd\".\r\n\t\t\tvar minTime;\r\n\t\t\tvar cal = renderData.dateModule;\r\n\t\t\t\r\n\t\t\tif(editKind == \"resizeStart\"){\r\n\t\t\t\tminTime = cal.add(item.endTime, unit, -steps);\r\n\t\t\t\tif(cal.compare(item.startTime, minTime) == 1){\r\n\t\t\t\t\titem.startTime = minTime;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tminTime = cal.add(item.startTime, unit, steps);\r\n\t\t\t\tif(cal.compare(item.endTime, minTime) == -1){\r\n\t\t\t\t\titem.endTime = minTime;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// doubleTapDelay: Integer\r\n\t\t//\t\tThe maximum delay between two taps needed to trigger an \"itemDoubleClick\" event, in touch context.\t\t\r\n\t\tdoubleTapDelay: 300,\r\n\t\t\r\n\t\t// snapUnit: String\r\n\t\t//\t\tThe unit of the snapping to apply during the editing of an event.\r\n\t\t//\t\t\"day\", \"hour\" and \"minute\" are valid values. \r\n\t\tsnapUnit: \"minute\",\r\n\t\t\r\n\t\t// snapSteps: Integer\r\n\t\t//\t\tThe number of units used to compute the snapping of the edited item.\r\n\t\tsnapSteps: 15,\r\n\t\t\r\n\t\t// minDurationUnit: \"String\"\r\n\t\t//\t\tThe unit used to define the minimal duration of the edited item.\r\n\t\t//\t\t\"day\", \"hour\" and \"minute\" are valid values.\r\n\t\tminDurationUnit: \"hour\",\r\n\t\t\r\n\t\t// minDurationSteps: Integer\r\n\t\t//\t\tThe number of units used to define the minimal duration of the edited item.\r\n\t\tminDurationSteps: 1,\r\n\t\t\r\n\t\t// liveLayout: Boolean\r\n\t\t//\t\tIf true, all the events are laid out during the editing gesture. If false, only the edited event is laid out.\r\n\t\tliveLayout: false,\t\t\t\r\n\t\t\r\n\t\t// stayInView: Boolean\r\n\t\t//\t\tSpecifies during editing, if the item is already in view, if the item must stay in the time range defined by the view or not.\t\t\r\n\t\tstayInView: true,\r\n\t\t\r\n\t\t// allowStartEndSwap: Boolean\r\n\t\t//\t\tSpecifies if the start and end time of an item can be swapped during an editing gesture. Note that using the keyboard this property is ignored.\t\r\n\t\tallowStartEndSwap: true,\t\t\t\r\n\t\t\r\n\t\t// allowResizeLessThan24H: Boolean\r\n\t\t//\t\tIf an event has a duration greater than 24 hours, indicates if using a resize gesture, it can be resized to last less than 24 hours.\r\n\t\t//\t\tThis flag is usually used when two different kind of renderers are used (MatrixView) to prevent changing the kind of renderer during an editing gesture.\r\n\t\tallowResizeLessThan24H: false,\r\n\r\n\t\t// allowSubColumnMove: Boolean\r\n\t\t//\t\tIf several sub columns are displayed, indicated if the data item can be reassigned to another sub column by an editing gesture.\r\n\t\tallowSubColumnMove: true\r\n\t\t\r\n\t});\r\n});\r\n"]}