{"version":3,"sources":["calendar/Keyboard.js"],"names":["define","arr","lang","declare","on","event","keys","keyboardUpDownUnit","keyboardUpDownSteps","keyboardLeftRightUnit","keyboardLeftRightSteps","allDayKeyboardUpDownUnit","allDayKeyboardUpDownSteps","allDayKeyboardLeftRightUnit","allDayKeyboardLeftRightSteps","postCreate","this","inherited","arguments","_viewHandles","push","domNode","hitch","_onKeyDown","resizeModifier","maxScrollAnimationDuration","tabIndex","focusedItem","_isItemFocused","item","id","_setFocusedItemAttr","value","old","_set","updateRenderers","onFocusChange","oldValue","newValue","owner","get","set","_secondarySheet","e","showFocus","_focusNextItem","dir","renderData","items","length","index","list","max","some","i","found","_focusNextItemImpl","reachedOnce","itemToRenderer","_handlePrevNextKeyCode","isLeftToRight","ctrlKey","ensureVisibility","startTime","endTime","undefined","_checkDir","_keyboardItemEditing","stop","unit","steps","p","_edProps","editedItem","allDay","roundToDay","rendererKind","editKind","d","newTime","subColumn","subColumns","idx","getSubColumnIndex","updateTime","dateModule","add","_startItemEditingGesture","_moveOrResizeItemGesture","_endItemEditingGesture","compare","keyCode","ESCAPE","_isEditing","_editingGesture","_endItemEditing","SPACE","setItemSelected","isItemSelected","ENTER","renderers","isItemEditable","kind","renderer","tempEditedItem","liveLayout","_startItemEditing","LEFT_ARROW","RIGHT_ARROW","UP_ARROW","scrollable","scrollView","DOWN_ARROW"],"mappings":"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","file":"../../calendar/Keyboard.js","sourcesContent":["define([\"dojo/_base/array\", \"dojo/_base/lang\", \"dojo/_base/declare\", \"dojo/on\", \"dojo/_base/event\", \"dojo/keys\"],\r\n\tfunction(arr, lang, declare, on, event, keys){\r\n\t\r\n\treturn declare(\"dojox.calendar.Keyboard\", null, {\r\n\r\n\t\t// summary:\r\n\t\t//\t\tThis mixin is managing the keyboard interactions on a calendar view.\r\n\t\t\r\n\t\t// keyboardUpDownUnit: String\r\n\t\t//\t\tUnit used during editing of an event using the keyboard and the up or down keys were pressed. Valid values are \"week\", \"day\", \"hours\" \"minute\".\r\n\t\tkeyboardUpDownUnit: \"minute\",\r\n\t\t\r\n\t\t// keyboardUpDownSteps: Integer\r\n\t\t//\t\tSteps used during editing of an event using the keyboard and the up or down keys were pressed.\t\t\r\n\t\tkeyboardUpDownSteps: 15,\t\t\r\n\t\t\r\n\t\t// keyboardLeftRightUnit: String\r\n\t\t//\t\tUnit used during editing of an event using the keyboard and the left or right keys were pressed. Valid values are \"week\", \"day\", \"hours\" \"minute\".\r\n\t\tkeyboardLeftRightUnit: \"day\",\r\n\t\t\r\n\t\t// keyboardLeftRightSteps: Integer\r\n\t\t//\t\tUnit used during editing of an event using the keyboard and the left or right keys were pressed.\t\t\r\n\t\tkeyboardLeftRightSteps: 1,\r\n\r\n\t\t// allDayKeyboardUpDownUnit: Integer\r\n\t\t//\t\tSteps used during editing of an all day event using the keyboard and the up or down keys were pressed.\r\n\t\tallDayKeyboardUpDownUnit: \"day\",\r\n\t\t\r\n\t\t// allDayKeyboardUpDownSteps: String\r\n\t\t//\t\tUnit used during editing of an all day event using the keyboard and the up or down keys were pressed. Valid values are \"week\", \"day\", \"hours\" \"minute\".\t\t\r\n\t\tallDayKeyboardUpDownSteps: 7,\r\n\t\t\r\n\t\t// allDayKeyboardLeftRightUnit: Integer\r\n\t\t//\t\tSteps used during editing of an all day event using the keyboard and the up or down keys were pressed.\r\n\t\tallDayKeyboardLeftRightUnit: \"day\",\r\n\t\t\r\n\t\t// allDayKeyboardLeftRightSteps: String\r\n\t\t//\t\tUnit used during editing of an all day event using the keyboard and the left or right keys were pressed. Valid values are \"week\", \"day\", \"hours\" \"minute\".\r\n\t\tallDayKeyboardLeftRightSteps: 1,\r\n\r\n\t\tpostCreate: function(){\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\tthis._viewHandles.push(on(this.domNode, \"keydown\", lang.hitch(this, this._onKeyDown)));\r\n\t\t},\r\n\t\t\r\n\t\t// resizeModfier: String\r\n\t\t//\t\tThe modifier used to determine if the item is resized instead moved during the editing on an item.\r\n\t\tresizeModifier: \"ctrl\",\r\n\r\n\t\t// maxScrollAnimationDuration: Number\r\n\t\t//\t\tThe duration in milliseconds to scroll the entire view. \r\n\t\t//\t\tThe scroll speed is constant when scrolling to show an item renderer. \r\n\t\tmaxScrollAnimationDuration: 1000,\r\n\t\t\r\n\t\t///////////////////////////////////////////////////////////////\r\n\t\t//\r\n\t\t// Focus management\r\n\t\t//\r\n\t\t//////////////////////////////////////////////////////////////\r\n\t\t\r\n\t\t// tabIndex: String\r\n\t\t//\t\tOrder fields are traversed when user hits the tab key\r\n\t\ttabIndex: \"0\",\r\n\t\t\r\n\t\t// focusedItem: Object\r\n\t\t//\t\tThe data item that currently has the focus.\r\n\t\tfocusedItem: null,\r\n\t\t\r\n\t\t_isItemFocused: function(item){\r\n\t\t\treturn this.focusedItem != null && this.focusedItem.id == item.id;\r\n\t\t},\r\n\r\n\t\t_setFocusedItemAttr: function(value){\r\n\t\t\tif(value != this.focusedItem){\r\n\t\t\t\tvar old = this.focusedItem;\r\n\t\t\t\tthis._set(\"focusedItem\", value);\r\n\t\t\t\tthis.updateRenderers([old, this.focusedItem], true);\r\n\t\t\t\tthis.onFocusChange({\r\n\t\t\t\t\toldValue: old,\r\n\t\t\t\t\tnewValue: value\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif(value != null){\r\n\t\t\t\tif(this.owner != null && this.owner.get(\"focusedItem\") != null){\r\n\t\t\t\t\tthis.owner.set(\"focusedItem\", null);\r\n\t\t\t\t}\r\n\t\t\t\tif(this._secondarySheet != null && this._secondarySheet.set(\"focusedItem\") != null){\r\n\t\t\t\t\tthis._secondarySheet.set(\"focusedItem\", null);\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\tonFocusChange: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEvent dispatched when the focus has changed.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\r\n\t\t},\r\n\r\n\t\t// showFocus: Boolean\r\n\t\t//\t\tShow or hide the focus graphic feedback on item renderers.\r\n\t\tshowFocus: false,\t\t\r\n\t\t\r\n\t\t_focusNextItem: function(dir){\t\t\t\r\n\t\t\t// summary:\r\n\t\t\t//\t\tMoves the focus to the next item in the specified direction.\r\n\t\t\t//\t\tIf there is no current child focused, the first (dir == 1) or last (dir == -1) is focused.\r\n\t\t\t// dir: Integer\r\n\t\t\t//\t\tThe direction of the next child to focus.\r\n\t\t\t//\r\n\t\t\t//\t\t- 1: Move focus to the next item in the list.\r\n\t\t\t//\t\t- -1: Move focus to the previous item in the list.\r\n\t\t\t\r\n\t\t\tif(!this.renderData || !this.renderData.items || this.renderData.items.length == 0){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar index = -1;\r\n\t\t\tvar list = this.renderData.items;\r\n\t\t\tvar max = list.length - 1;\r\n\t\t\tvar focusedItem = this.get(\"focusedItem\");\r\n\t\t\t\r\n\t\t\t// find current index.\r\n\t\t\tif(focusedItem == null){\r\n\t\t\t\tindex = dir > 0 ? 0 : max;\r\n\t\t\t}else{\r\n\t\t\t\tarr.some(list, lang.hitch(this, function(item, i){\r\n\t\t\t\t\tvar found = item.id == focusedItem.id;\r\n\t\t\t\t\tif(found){\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn found;\r\n\t\t\t\t}));\r\n\t\t\t\tindex = this._focusNextItemImpl(dir, index, max);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// find the first item with renderers.\r\n\t\t\tvar reachedOnce = false;\r\n\t\t\tvar old = -1;\r\n\t\t\t\r\n\t\t\twhile(old != index && (!reachedOnce || index != 0)){\r\n\t\t\t\t\r\n\t\t\t\tif(!reachedOnce && index == 0){\r\n\t\t\t\t\treachedOnce = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar item = list[index];\r\n\t\t\t\t\r\n\t\t\t\tif(this.itemToRenderer[item.id] != null){\r\n\t\t\t\t\t// found item\r\n\t\t\t\t\tthis.set(\"focusedItem\", item);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\told = index;\t\t\t\t\r\n\t\t\t\tindex = this._focusNextItemImpl(dir, index, max);\r\n\t\t\t\t\r\n\t\t\t}\t\t\t\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_focusNextItemImpl: function(dir, index, max){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tif(index == -1){ // not found should not occur\r\n\t\t\t\tindex = dir > 0 ? 0 : max;\r\n\t\t\t}else{\t\t\t\t\r\n\t\t\t\tif(index == 0 && dir == -1 || index == max && dir == 1){\r\n\t\t\t\t\treturn index;\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\tindex = dir > 0 ? ++index : --index;\t\t\t\t\t\r\n\t\t\t}\t\t\t\r\n\t\t\treturn index; \t\r\n\t\t},\r\n\t\t\r\n\t\t///////////////////////////////////////////////////////////\r\n\t\t//\r\n\t\t// Keyboard\r\n\t\t//\r\n\t\t//////////////////////////////////////////////////////////\r\n\r\n\t\t_handlePrevNextKeyCode: function(e, dir){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tif(!this.isLeftToRight()){\r\n\t\t\t\tdir = dir == 1 ? -1 : 1;\r\n\t\t\t}\r\n\t\t\tthis.showFocus = true;\r\n\t\t\tthis._focusNextItem(dir);\r\n\t\t\t\r\n\t\t\tvar focusedItem = this.get(\"focusedItem\");\r\n\t\t\t\r\n\t\t\tif(!e.ctrlKey && focusedItem){\r\n\t\t\t\tthis.set(\"selectedItem\", focusedItem);\r\n\t\t\t}\r\n\r\n\t\t\tif(focusedItem){\r\n\t\t\t\tthis.ensureVisibility(focusedItem.startTime, focusedItem.endTime, \"both\", undefined, this.maxScrollAnimationDuration);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t_checkDir: function(dir, value){\t\t\t\r\n\t\t\treturn this.isLeftToRight() && dir == value || !this.isLeftToRight() && dir == (value==\"left\"?\"right\":\"left\");\r\n\t\t},\r\n\r\n\t\t_keyboardItemEditing: function(e, dir){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tevent.stop(e);\r\n\r\n\t\t\tvar p = this._edProps;\r\n\r\n\t\t\tvar unit, steps; \r\n\r\n\t\t\tif(p.editedItem.allDay || this.roundToDay || p.rendererKind == \"label\"){\r\n\t\t\t\tunit = dir == \"up\" || dir == \"down\" ? this.allDayKeyboardUpDownUnit : this.allDayKeyboardLeftRightUnit; \r\n\t\t\t\tsteps = dir == \"up\" || dir == \"down\" ? this.allDayKeyboardUpDownSteps : this.allDayKeyboardLeftRightSteps;\r\n\t\t\t}else{\r\n\t\t\t\tunit = dir == \"up\" || dir == \"down\" ? this.keyboardUpDownUnit : this.keyboardLeftRightUnit; \r\n\t\t\t\tsteps = dir == \"up\" || dir == \"down\" ? this.keyboardUpDownSteps : this.keyboardLeftRightSteps;\r\n\t\t\t}\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\tif(dir == \"up\" || this._checkDir(dir, \"left\")){\r\n\t\t\t\tsteps = -steps;\r\n\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\tvar editKind = e[this.resizeModifier+\"Key\"] ? \"resizeEnd\" : \"move\";\r\n\t\t\t\r\n\t\t\tvar d = editKind == \"resizeEnd\" ? p.editedItem.endTime : p.editedItem.startTime;\r\n\t\t\t\r\n\t\t\tvar newTime = d;\r\n\t\t\tvar subColumn = p.editedItem.subColumn;\r\n\t\t\t\r\n\t\t\tif(editKind == \"move\" && this.subColumns && this.subColumns.length > 1){\t\t\r\n\t\t\t\tvar idx = this.getSubColumnIndex(subColumn);\r\n\t\t\t\tvar updateTime = true;\r\n\t\t\t\tif(idx != -1){\r\n\t\t\t\t\tif(this._checkDir(dir, \"left\")){\r\n\t\t\t\t\t\tif(idx == 0){\r\n\t\t\t\t\t\t\tsubColumn = this.subColumns[this.subColumns.length-1];\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tupdateTime = false;\r\n\t\t\t\t\t\t\tsubColumn = this.subColumns[idx-1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else if(this._checkDir(dir, \"right\")){\r\n\t\t\t\t\t\tif(idx == this.subColumns.length-1){\r\n\t\t\t\t\t\t\tsubColumn = this.subColumns[0];\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tupdateTime = false;\r\n\t\t\t\t\t\t\tsubColumn = this.subColumns[idx+1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(updateTime){\r\n\t\t\t\t\t\tnewTime = this.renderData.dateModule.add(d, unit, steps);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tnewTime = this.renderData.dateModule.add(d, unit, steps);\r\n\t\t\t}\t\t\t\r\n\t\t\t\r\n\t\t\tthis._startItemEditingGesture([d], editKind, \"keyboard\", e);\r\n\t\t\tthis._moveOrResizeItemGesture([newTime], \"keyboard\", e, subColumn);\r\n\t\t\tthis._endItemEditingGesture(editKind, \"keyboard\", e, false);\r\n\t\t\t\r\n\t\t\tif(editKind == \"move\"){\r\n\t\t\t\tif(this.renderData.dateModule.compare(newTime, d) == -1){\r\n\t\t\t\t\tthis.ensureVisibility(p.editedItem.startTime, p.editedItem.endTime, \"start\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.ensureVisibility(p.editedItem.startTime, p.editedItem.endTime, \"end\");\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}else{ // resize end only\r\n\t\t\t\tthis.ensureVisibility(p.editedItem.startTime, p.editedItem.endTime, \"end\");\t\r\n\t\t\t}\t\t\t\t\t\t\r\n\t\t},\r\n\t\t\t\t\t\t\r\n\t\t_onKeyDown: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar focusedItem = this.get(\"focusedItem\");\r\n\t\t\t\r\n\t\t\tswitch(e.keyCode){\r\n\r\n\t\t\t\tcase keys.ESCAPE:\r\n\r\n\t\t\t\t\tif(this._isEditing){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(this._editingGesture){\r\n\t\t\t\t\t\t\tthis._endItemEditingGesture(\"keyboard\", e, true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis._endItemEditing(\"keyboard\", true);\r\n\r\n\t\t\t\t\t\tthis._edProps = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase keys.SPACE:\r\n\r\n\t\t\t\t\tevent.stop(e); // prevent browser shortcut\r\n\r\n\t\t\t\t\tif(focusedItem != null){\r\n\t\t\t\t\t\tthis.setItemSelected(focusedItem, e.ctrlKey ? !this.isItemSelected(focusedItem) : true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase keys.ENTER:\r\n\r\n\t\t\t\t\tevent.stop(e); // prevent browser shortcut\r\n\r\n\t\t\t\t\tif(focusedItem != null){\r\n\r\n\t\t\t\t\t\tif(this._isEditing){\r\n\t\t\t\t\t\t\tthis._endItemEditing(\"keyboard\", false);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar renderers = this.itemToRenderer[focusedItem.id];\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif(renderers && renderers.length > 0 && this.isItemEditable(focusedItem, renderers[0].kind)){\r\n\r\n\t\t\t\t\t\t\t\tthis._edProps = {\r\n\t\t\t\t\t\t\t\t\trenderer: renderers[0],\r\n\t\t\t\t\t\t\t\t\trendererKind: renderers[0].kind,\r\n\t\t\t\t\t\t\t\t\ttempEditedItem: focusedItem,\r\n\t\t\t\t\t\t\t\t\tliveLayout: this.liveLayout\r\n\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\tthis.set(\"selectedItem\", focusedItem);\r\n\r\n\t\t\t\t\t\t\t\tthis._startItemEditing(focusedItem, \"keyboard\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase keys.LEFT_ARROW:\r\n\t\t\t\t\r\n\t\t\t\t\tevent.stop(e); // prevent browser shortcut\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(this._isEditing){\r\n\t\t\t\t\t\tthis._keyboardItemEditing(e, \"left\");\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis._handlePrevNextKeyCode(e, -1);\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\t\r\n\t\t\t\tcase keys.RIGHT_ARROW:\r\n\t\t\t\t\r\n\t\t\t\t\tevent.stop(e); // prevent browser shortcut\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(this._isEditing){\r\n\t\t\t\t\t\tthis._keyboardItemEditing(e, \"right\");\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis._handlePrevNextKeyCode(e, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\t\tcase keys.UP_ARROW:\r\n\t\t\t\t\tif(this._isEditing){\r\n\t\t\t\t\t\tthis._keyboardItemEditing(e, \"up\");\r\n\t\t\t\t\t}else if(this.scrollable){\r\n\t\t\t\t\t\tthis.scrollView(-1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\t\r\n\t\t\t\tcase keys.DOWN_ARROW:\r\n\t\t\t\t\tif(this._isEditing){\r\n\t\t\t\t\t\tthis._keyboardItemEditing(e, \"down\");\r\n\t\t\t\t\t}else if(this.scrollable){\r\n\t\t\t\t\t\tthis.scrollView(1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n});\r\n"]}