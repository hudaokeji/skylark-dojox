{"version":3,"sources":["calendar/Touch.js"],"names":["define","arr","lang","declare","dom","domGeometry","win","on","event","keys","touchStartEditingTimer","touchEndEditingTimer","postMixInProperties","this","hitch","irEvent","renderer","own","domNode","e","_onRendererTouchStart","p","_edProps","endEditingTimer","clearTimeout","theItem","item","startEditingTimer","_endItemEditing","handles","push","doc","_docEditingTouchEndHandler","itemContainer","_docEditingTouchMoveHandler","_setEditingProperties","touchMoved","rendererKind","liveLayout","_isEditing","mixin","_getTouchesOnRenderers","editedItem","_startTouchItemEditingGesture","touches","length","stop","_touchSelectionTimer","setTimeout","_saveSelectedItems","get","selectFromEvent","_item","_pendingSelectedItem","start","x","screenX","y","screenY","isItemEditable","_touchSelectionTime","dispatchChange","_startItemEditing","moveTouchIndex","_startItemEditingGesture","getTime","touch","Math","abs","_editingGesture","itemBeginDispatched","times","d","editKind","endTime","startTime","subColumn","touchIndex","getSubColumn","resizeStartTouchIndex","resizeEndTouchIndex","_moveOrResizeItemGesture","renderData","dateModule","compare","ensureVisibility","autoScrollTouchMargin","touchesLen","_endItemEditingGesture","set","forEach","handle","remove","_pendingDoubleTap","_onItemDoubleClick","triggerEvent","timer","doubleTapDelay","_onItemClick","fromResizeStart","fromResizeEnd","irs","_getStartEndRenderers","hasResizeStart","resizeStartHandle","hasResizeEnd","resizeEndHandle","len","list","rendererManager","itemToRenderer","id","i","isDescendant","target","j","container"],"mappings":"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","file":"../../calendar/Touch.js","sourcesContent":["define([\"dojo/_base/array\", \"dojo/_base/lang\", \"dojo/_base/declare\", \"dojo/dom\", \"dojo/dom-geometry\", \"dojo/_base/window\", \"dojo/on\", \"dojo/_base/event\", \"dojo/keys\"],\r\n\r\n\tfunction(arr, lang, declare, dom, domGeometry, win, on, event, keys){\r\n\t\t\t\r\n\treturn declare(\"dojox.calendar.Touch\", null, {\r\n\t\t\r\n\t\t// summary:\r\n\t\t//\t\tThis plugin is managing the touch interactions on item renderers displayed by a calendar view.\t\t\r\n\t\t\t\t\r\n\t\t// touchStartEditingTimer: Integer\r\n\t\t//\t\tThe delay of one touch over the renderer before setting the item in editing mode.\t\t\r\n\t\ttouchStartEditingTimer: 500,\r\n\t\t\r\n\t\t// touchEndEditingTimer: Integer\r\n\t\t//\t\tThe delay after which the item is leaving the editing mode after the previous editing gesture, in touch context.\r\n\t\ttouchEndEditingTimer: 10000,\r\n\t\t\r\n\t\tpostMixInProperties: function(){\r\n\t\t\t\r\n\t\t\tthis.on(\"rendererCreated\", lang.hitch(this, function(irEvent){\r\n\t\t\t\t\r\n\t\t\t\tvar renderer = irEvent.renderer.renderer;\r\n\t\t\t\t\t\t\r\n\t\t\t\tthis.own(on(renderer.domNode, \"touchstart\", lang.hitch(this, function(e){\r\n\t\t\t\t\tthis._onRendererTouchStart(e, renderer);\r\n\t\t\t\t})));\r\n\t\t\t\t\r\n\t\t\t}));\r\n\t\t},\r\n\t\t\r\n\t\t_onRendererTouchStart: function(e, renderer){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar p = this._edProps;\t\r\n\t\t\t\r\n\t\t\tif(p && p.endEditingTimer){\r\n\t\t\t\tclearTimeout(p.endEditingTimer);\r\n\t\t\t\tp.endEditingTimer = null;\r\n\t\t\t}\t\t\t\t\r\n\r\n\t\t\tvar theItem = renderer.item.item;\r\n\r\n\t\t\tif(p && p.endEditingTimer){\r\n\t\t\t\tclearTimeout(p.endEditingTimer);\r\n\t\t\t\tp.endEditingTimer = null;\r\n\t\t\t}\r\n\r\n\t\t\tif(p != null && p.item != theItem){\r\n\t\t\t\t// another item is edited.\r\n\t\t\t\t// stop previous item\r\n\t\t\t\tif(p.startEditingTimer){\r\n\t\t\t\t\tclearTimeout(p.startEditingTimer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._endItemEditing(\"touch\", false);\r\n\t\t\t\tp = null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// initialize editing properties\r\n\t\t\tif(!p){\r\n\t\t\t\t\r\n\t\t\t\t// register event listeners to manage gestures.\r\n\t\t\t\tvar handles = [];\r\n\t\t\t\t\r\n\t\t\t\thandles.push(on(win.doc, \"touchend\", lang.hitch(this, this._docEditingTouchEndHandler)));\r\n\t\t\t\thandles.push(on(this.itemContainer, \"touchmove\", lang.hitch(this, this._docEditingTouchMoveHandler)));\t\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tthis._setEditingProperties({\r\n\t\t\t\t\ttouchMoved: false,\r\n\t\t\t\t\titem: theItem,\r\n\t\t\t\t\trenderer: renderer,\r\n\t\t\t\t\trendererKind: renderer.rendererKind,\r\n\t\t\t\t\tevent: e,\r\n\t\t\t\t\thandles: handles,\r\n\t\t\t\t\tliveLayout: this.liveLayout\r\n\t\t\t\t});\r\n\r\n\t\t\t\tp = this._edProps;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._isEditing){\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t// get info on touches \r\n\t\t\t\tlang.mixin(p, this._getTouchesOnRenderers(e, p.editedItem));\r\n\t\t\t\t\r\n\t\t\t\t// start an editing gesture.\r\n\t\t\t\tthis._startTouchItemEditingGesture(e);\r\n\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\t\r\n\t\t\t\t// initial touch that will trigger or not the editing\r\n\t\t\t\r\n\t\t\t\tif(e.touches.length > 1){\r\n\t\t\t\t\tevent.stop(e);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// set the selection state without dispatching (on touch end) after a short amount of time.\r\n\t\t\t\t// to allow a bit of time to scroll without selecting (graphically at least) \t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tthis._touchSelectionTimer = setTimeout(lang.hitch(this, function(){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis._saveSelectedItems = this.get(\"selectedItems\");\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\tvar changed = this.selectFromEvent(e, theItem._item, renderer, false);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(changed){\t\t\t\t\t\r\n\t\t\t\t\t\tthis._pendingSelectedItem = theItem;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdelete this._saveSelectedItems;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._touchSelectionTimer = null;\r\n\t\t\t\t}), 200);\r\n\t\t\t\t\r\n\t\t\t\tp.start = {x: e.touches[0].screenX, y: e.touches[0].screenY};\r\n\t\t\t\t\r\n\t\t\t\tif(this.isItemEditable(p.item, p.rendererKind)){\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t// editing gesture timer\r\n\t\t\t\t\tthis._edProps.startEditingTimer = setTimeout(lang.hitch(this, function(){\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// we are editing, so the item *must* be selected.\r\n\t\t\t\t\t\tif(this._touchSelectionTimer){\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tclearTimeout(this._touchSelectionTimer);\r\n\t\t\t\t\t\t\tdelete this._touchSelectionTime; \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(this._pendingSelectedItem){\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis.dispatchChange(this._saveSelectedItems == null ? null : this._saveSelectedItems[0], this._pendingSelectedItem, null, e);\r\n\t\t\t\t\t\t\tdelete this._saveSelectedItems;\r\n\t\t\t\t\t\t\tdelete this._pendingSelectedItem;\r\n\t\t\t\t\t\t}else{\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis.selectFromEvent(e, theItem._item, renderer);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis._startItemEditing(p.item, \"touch\", e);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tp.moveTouchIndex = 0;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// A move gesture is initiated even if we don't move \r\n\t\t\t\t\t\tthis._startItemEditingGesture([this.getTime(e)], \"move\", \"touch\", e);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}), this.touchStartEditingTimer);\r\n\t\t\t\t\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\t\t\t\t\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_docEditingTouchMoveHandler: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar p = this._edProps;\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t// When the screen is touched, it can dispatch move events if the \r\n\t\t\t// user press the finger a little more...\r\n\t\t\tvar touch = {x: e.touches[0].screenX, y: e.touches[0].screenY};\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\tif(p.startEditingTimer && \r\n\t\t\t\t\t(Math.abs(touch.x - p.start.x) > 25 || \r\n\t\t\t\t\t Math.abs(touch.y - p.start.y) > 25)) {\r\n\t\t\t\t\t \t\r\n\t\t\t\t// scroll use case, do not edit\r\n\t\t\t\tclearTimeout(p.startEditingTimer);\r\n\t\t\t\tp.startEditingTimer = null;\r\n\t\t\t\t\r\n\t\t\t\tclearTimeout(this._touchSelectionTimer);\r\n\t\t\t\tthis._touchSelectionTimer = null;\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif(this._pendingSelectedItem){\t\t\t\t\t\r\n\t\t\t\t\tdelete this._pendingSelectedItem;\r\n\t\t\t\t\tthis.selectFromEvent(e, null, null, false);\r\n\t\t\t\t}\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tp.touchMoved = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\tif(this._editingGesture){\t\t\t\t\r\n\t\t\t\r\n\t\t\t\tevent.stop(e);\r\n\t\t\t\t\r\n\t\t\t\tif(p.itemBeginDispatched){\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar times = [];\r\n\t\t\t\t\tvar d = p.editKind == \"resizeEnd\" ? p.editedItem.endTime : p.editedItem.startTime;\r\n\t\t\t\t\tvar subColumn = p.editedItem.subColumn;\r\n\t\t\t\t\t\r\n\t\t\t\t\tswitch(p.editKind){\r\n\t\t\t\t\t\tcase \"move\":\r\n\t\t\t\t\t\t  var touchIndex = p.moveTouchIndex == null || p.moveTouchIndex < 0 ? 0 : p.moveTouchIndex;\r\n\t\t\t\t\t\t\ttimes[0] = this.getTime(e, -1, -1, touchIndex);\r\n\t\t\t\t\t\t\tsubColumn = this.getSubColumn(e, -1, -1, touchIndex);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"resizeStart\":\r\n\t\t\t\t\t\t\ttimes[0] = this.getTime(e, -1, -1, p.resizeStartTouchIndex);\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"resizeEnd\":\r\n\t\t\t\t\t\t\ttimes[0] = this.getTime(e, -1, -1, p.resizeEndTouchIndex);\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"resizeBoth\":\r\n\t\t\t\t\t\t\ttimes[0] = this.getTime(e, -1, -1, p.resizeStartTouchIndex);\r\n\t\t\t\t\t\t\ttimes[1] = this.getTime(e, -1, -1, p.resizeEndTouchIndex);\r\n\t\t\t\t\t\t\tbreak;\t\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tthis._moveOrResizeItemGesture(times, \"touch\", e, subColumn);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(p.editKind == \"move\"){\r\n\t\t\t\t\t\tif(this.renderData.dateModule.compare(p.editedItem.startTime, d) == -1){\r\n\t\t\t\t\t\t\tthis.ensureVisibility(p.editedItem.startTime, p.editedItem.endTime, \"start\", this.autoScrollTouchMargin);\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tthis.ensureVisibility(p.editedItem.startTime, p.editedItem.endTime, \"end\", this.autoScrollTouchMargin);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else if(e.editKind == \"resizeStart\" || e.editKind == \"resizeBoth\"){\r\n\t\t\t\t\t\tthis.ensureVisibility(p.editedItem.startTime, p.editedItem.endTime, \"start\", this.autoScrollTouchMargin);\t\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.ensureVisibility(p.editedItem.startTime, p.editedItem.endTime, \"end\", this.autoScrollTouchMargin);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t}\t\t\t\r\n\t\t\t} // else scroll, if any, is delegated to sub class\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t// autoScrollTouchMargin: Integer\r\n\t\t//\t\tThe minimum number of minutes of margin around the edited event. \r\n\t\tautoScrollTouchMargin: 10,\r\n\t\t\r\n\t\t_docEditingTouchEndHandler: function(e){\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tevent.stop(e);\r\n\t\t\t\r\n\t\t\tvar p = this._edProps;\r\n\t\t\t\r\n\t\t\tif(p.startEditingTimer){\r\n\t\t\t\tclearTimeout(p.startEditingTimer);\r\n\t\t\t\tp.startEditingTimer = null;\r\n\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\tif(this._isEditing){\r\n\t\t\t\t\r\n\t\t\t\tlang.mixin(p, this._getTouchesOnRenderers(e, p.editedItem));\r\n\t\t\t\t\r\n\t\t\t\tif(this._editingGesture){\r\n\t\t\t\t\r\n\t\t\t\t\tif(p.touchesLen == 0){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// all touches were removed => end of editing gesture\r\n\t\t\t\t\t\tthis._endItemEditingGesture(\"touch\", e);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(this.touchEndEditingTimer > 0){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Timer that trigger the end of the item editing mode.\r\n\t\t\t\t\t\t\tp.endEditingTimer = setTimeout(lang.hitch(this, function(){\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis._endItemEditing(\"touch\", false);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}), this.touchEndEditingTimer);\r\n\t\t\t\t\t\t} // else validation must be explicit\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(this._editingGesture){\r\n\t\t\t\t\t\t\tthis._endItemEditingGesture(\"touch\", e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// there touches of interest on item, process them.\r\n\t\t\t\t\t\tthis._startTouchItemEditingGesture(e);\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}else if(!p.touchMoved){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tevent.stop(e);\r\n\t\t\t\t\t\r\n\t\t\t\tarr.forEach(p.handles, function(handle){\r\n\t\t\t\t\thandle.remove();\r\n\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tif(this._touchSelectionTimer){\t\t\t\t\t\r\n\t\t\t\t\t// selection timer was not reached to a proper selection.\r\n\t\t\t\t\tclearTimeout(this._touchSelectionTimer);\r\n\t\t\t\t\tthis.selectFromEvent(e, p.item._item, p.renderer, true);\r\n\t\t\t\t\t\r\n\t\t\t\t}else if(this._pendingSelectedItem){\r\n\t\t\t\t\t// selection timer was reached, dispatch change event\r\n\t\t\t\t\tthis.dispatchChange(this._saveSelectedItems.length == 0 ? null : this._saveSelectedItems[0], \r\n\t\t\t\t\t\tthis._pendingSelectedItem, null, e); // todo renderer ?\r\n\t\t\t\t\tdelete this._saveSelectedItems;\r\n\t\t\t\t\tdelete this._pendingSelectedItem;\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tif(this._pendingDoubleTap && this._pendingDoubleTap.item == p.item){\t\t\t\t\t\t\t\r\n\t\t\t\t\tthis._onItemDoubleClick({\r\n\t\t\t\t\t\ttriggerEvent: e,\r\n\t\t\t\t\t\trenderer: p.renderer,\r\n\t\t\t\t\t\titem: p.item._item\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tclearTimeout(this._pendingDoubleTap.timer);\r\n\t\t\t\t\t\r\n\t\t\t\t\tdelete this._pendingDoubleTap;\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis._pendingDoubleTap = {\r\n\t\t\t\t\t\titem: p.item,\r\n\t\t\t\t\t\ttimer: setTimeout(lang.hitch(this, function(){\r\n\t\t\t\t\t\t\t\tdelete this._pendingDoubleTap;\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}), this.doubleTapDelay)\r\n\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tthis._onItemClick({\r\n\t\t\t\t\t\ttriggerEvent: e,\r\n\t\t\t\t\t\trenderer: p.renderer,\r\n\t\t\t\t\t\titem: p.item._item\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tthis._edProps = null;\r\n\t\t\t\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\t// scroll view has finished.\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif(this._saveSelectedItems){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t// selection without dipatching was done, but the view scrolled, \r\n\t\t\t\t\t// so revert last selection\r\n\t\t\t\t  this.set(\"selectedItems\", this._saveSelectedItems);\t\t\t\t\t\r\n\t\t\t\t\tdelete this._saveSelectedItems;\r\n\t\t\t\t\tdelete this._pendingSelectedItem;\r\n\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tarr.forEach(p.handles, function(handle){\r\n\t\t\t\t\thandle.remove();\r\n\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tthis._edProps = null;\t\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t_startTouchItemEditingGesture: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDetermines if a editing gesture is starting according to touches.  \r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar p = this._edProps;\r\n\r\n\t\t\tvar fromResizeStart = p.resizeStartTouchIndex != -1;\r\n\t\t\tvar fromResizeEnd = p.resizeEndTouchIndex != -1;\r\n\r\n\t\t\tif(fromResizeStart && fromResizeEnd || // initial gesture using two touches \r\n\t\t\t\t\tthis._editingGesture && p.touchesLen == 2 && \r\n\t\t\t\t\t(fromResizeEnd && p.editKind == \"resizeStart\" || \r\n\t\t\t\t\t fromResizeStart && p.editKind ==\"resizeEnd\")){ // gesture one after the other touch\r\n\r\n\t\t\t\tif(this._editingGesture && p.editKind != \"resizeBoth\"){ // stop ongoing gesture\r\n\t\t\t\t\tthis._endItemEditingGesture(\"touch\", e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tp.editKind = \"resizeBoth\";\r\n\r\n\t\t\t\tthis._startItemEditingGesture([this.getTime(e, -1, -1, p.resizeStartTouchIndex), \r\n\t\t\t\t\tthis.getTime(e, -1, -1, p.resizeEndTouchIndex)], \r\n\t\t\t\t\tp.editKind, \"touch\", e);\r\n\r\n\t\t\t}else if(fromResizeStart && p.touchesLen == 1 && !this._editingGesture){\r\n\r\n\t\t\t\tthis._startItemEditingGesture([this.getTime(e, -1, -1, p.resizeStartTouchIndex)], \r\n\t\t\t\t\t\"resizeStart\", \"touch\", e);\r\n\r\n\t\t\t}else if(fromResizeEnd && p.touchesLen == 1 && !this._editingGesture){\r\n\r\n\t\t\t\tthis._startItemEditingGesture([this.getTime(e, -1, -1, p.resizeEndTouchIndex)], \r\n\t\t\t\t\t\"resizeEnd\", \"touch\", e);\r\n\r\n\t\t\t} else {\r\n\t\t\t\t// A move gesture is initiated even if we don't move \r\n\t\t\t\tthis._startItemEditingGesture([this.getTime(e)], \"move\", \"touch\", e);\r\n\t\t\t}\t\t\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_getTouchesOnRenderers: function(e, item){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturns the touch indices that are on a editing handles or body of the renderers \r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\t// item: Object\r\n\t\t\t//\t\tThe render item.\r\n\t\t\t// e: Event\r\n\t\t\t//\t\tThe touch event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\t\r\n\t\t\tvar irs = this._getStartEndRenderers(item);\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\tvar resizeStartTouchIndex = -1;\t\t\t\r\n\t\t\tvar resizeEndTouchIndex = -1;\t\t\t\r\n\t\t\tvar moveTouchIndex = -1;\r\n\t\t\tvar hasResizeStart = irs[0] != null && irs[0].resizeStartHandle != null;\r\n\t\t\tvar hasResizeEnd = irs[1] != null && irs[1].resizeEndHandle != null;\r\n\t\t\tvar len = 0;\r\n\t\t\tvar touched = false;\t\t\t\r\n\t\t\tvar list = this.rendererManager.itemToRenderer[item.id];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\tfor(var i=0; i<e.touches.length; i++){\r\n\t\t\t\t\r\n\t\t\t\tif(resizeStartTouchIndex == -1 && hasResizeStart){\r\n\t\t\t\t\ttouched = dom.isDescendant(e.touches[i].target, irs[0].resizeStartHandle);\r\n\t\t\t\t\tif(touched){\r\n\t\t\t\t\t\tresizeStartTouchIndex = i;\r\n\t\t\t\t\t\tlen++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(resizeEndTouchIndex == -1 && hasResizeEnd){\r\n\t\t\t\t\ttouched = dom.isDescendant(e.touches[i].target, irs[1].resizeEndHandle);\r\n\t\t\t\t\tif(touched){\r\n\t\t\t\t\t\tresizeEndTouchIndex = i;\r\n\t\t\t\t\t\tlen++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(resizeStartTouchIndex == -1 && resizeEndTouchIndex == -1){ \r\n\r\n\t\t\t\t\tfor (var j=0; j<list.length; j++){\r\n\t\t\t\t\t  touched = dom.isDescendant(e.touches[i].target, list[j].container);\r\n\t\t\t\t\t\tif(touched){\r\n\t\t\t\t\t\t\tmoveTouchIndex = i;\r\n\t\t\t\t\t\t\tlen++;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(resizeStartTouchIndex != -1 && resizeEndTouchIndex != -1 && moveTouchIndex != -1){\r\n\t\t\t\t\t// all touches of interest were found, ignore other ones.\r\n\t\t\t\t  break;\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttouchesLen: len,\r\n\t\t\t\tresizeStartTouchIndex: resizeStartTouchIndex,\r\n\t\t\t\tresizeEndTouchIndex: resizeEndTouchIndex,\r\n\t\t\t\tmoveTouchIndex: moveTouchIndex\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t});\r\n\r\n});\r\n"]}