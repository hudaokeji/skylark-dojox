/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
dojo.require("dojox.mobile.app.SceneAssistant"),dojo.declare("FlickrImageThumbViewAssistant",dojox.mobile.app.SceneAssistant,{apiKey:"8c6803164dbc395fb7131c9d54843627",setup:function(){this.controller.parse(),this.handlePhotoLoad=dojo.hitch(this,this.handlePhotoLoad),this.search=dojo.hitch(this,this.search),this.resizeViewer=dojo.hitch(this,this.resizeViewer),this.textWidget=dijit.byId("searchTextThumbInput");var e=this.viewer=dijit.byId("flickrImageThumbView");e.labelParam="ownername";var t,i=this;this.connect(e,"onSelect",function(e,t){console.log("selected ",e,t),i.controller.stageController.pushScene("flickr-image-view",{type:"data",images:i.urls,index:t})}),this.connect(this.textWidget,"onChange",function(e){e&&0!=e.length?i.timer||(i.timer=setTimeout(i.search,1e3)):i.viewer.set("items",[])}),this.connect(dijit.byId("btnSmall"),"onClick",function(){i.setThumbSize("small")}),this.connect(dijit.byId("btnMedium"),"onClick",function(){i.setThumbSize("medium")}),this.connect(dijit.byId("btnLarge"),"onClick",function(){i.setThumbSize("large")}),this.connect(window,"resize",function(){t&&clearTimeout(t),t=setTimeout(i.resizeViewer,300)})},activate:function(e){if(!this.dataType)switch(this.dataType=e?e.type:"interesting",this.dataType){case"interesting":dojo.style(this.textWidget.domNode,"display","none"),this.loadInteresting();break;case"text":dojo.style(this.textWidget.domNode,"visibility","visible"),this.loadText(this.textWidget.set("value"));break;case"tag":dojo.style(this.textWidget.domNode,"visibility","visible"),this.loadTags(this.textWidget.set("value"));break;default:console.log("unknown type "+this.dataType,e)}},setThumbSize:function(e){dojo.removeClass(this.viewer.domNode,["small","medium","large"]),dojo.addClass(this.viewer.domNode,e),this.resizeViewer()},resizeViewer:function(){this.viewer.resize()},search:function(){this.timer&&(clearTimeout(this.timer),this.timer=null);var e=this.textWidget.set("value");if(!e||dojo.trim(e).length<1)return this.viewer.set("items",[]),void console.log("NOT SEARCHING");switch(console.log("search",e),this.dataType){case"text":this.loadText(e);break;case"tag":this.loadTags(e)}},loadInteresting:function(){console.log("loading interesting");dojo.io.script.get({url:"http://api.flickr.com/services/rest/?method=flickr.interestingness.getList",content:{api_key:this.apiKey,format:"json",per_page:20},jsonp:"jsoncallback"}).addBoth(this.handlePhotoLoad)},loadText:function(e){console.log("loading text ",e);dojo.io.script.get({url:"http://api.flickr.com/services/rest/?method=flickr.photos.search",content:{api_key:this.apiKey,format:"json",text:e,extras:"owner_name",per_page:20},jsonp:"jsoncallback"}).addBoth(this.handlePhotoLoad)},loadTags:function(e){console.log("loading tags ",e);dojo.io.script.get({url:"http://api.flickr.com/services/rest/?method=flickr.photos.search",content:{api_key:this.apiKey,format:"json",tags:e,per_page:20},jsonp:"jsoncallback"}).addBoth(this.handlePhotoLoad)},handlePhotoLoad:function(e){if(console.log("got photos",e),e&&e.photos&&e.photos.photo){for(var t,i=this.images=e.photos.photo,o=[],s=0;s<i.length;s++)t="http://farm"+i[s].farm+".static.flickr.com/"+i[s].server+"/"+i[s].id+"_"+i[s].secret,o.push({large:t+".jpg",small:t+"_t.jpg",thumb:t+"_s.jpg",ownername:i[s].ownername,title:i[s].title});this.urls=o,this.index=0,this.viewer.set("selectedIndex",this.index),this.viewer.set("items",o)}else this.viewer.set("items",[]),console.log("didn't get photos")}});
//# sourceMappingURL=../../../../../sourcemaps/mobile/tests/imageControlsApp/app/assistants/flickr-image-thumb-view-assistant.js.map
