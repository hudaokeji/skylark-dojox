/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
var fs=require("fs"),path=require("path"),less=require("less"),themeFolders=["../android","../iphone","../blackberry","../holodark","../windows","../custom","../ios7"],commonFolders=["../common/domButtons","../common/transitions"],batchQueue=[],batchIndex=0,processProgress=0;function batch(){batchIndex<batchQueue.length&&(batchQueue[batchIndex](),batchIndex++)}function beginProcess(){processProgress++}function endProcess(){0==--processProgress&&batch()}function processFolder(e,s){var r=getLessFiles(e);if(s){var o,n=getLessFiles("../common");n.array.forEach(function(s){var c=r.dic[n.dic[s]];if(c)applyLess(c,null,o=c.replace(".less",".css"));else{var t=n.dic[s];o=e+"/"+t.replace(".less",".css"),-1==t.indexOf("_rtl")?applyLess(s,'@import "'+e+'/variables.less";',o):applyLess(s,'@import "'+e+'/variables_rtl.less";',o)}})}else r.array.forEach(function(e){applyLess(e,null,e.replace(".less",".css"))})}function applyLess(e,s,r){beginProcess(),console.log("compiling:",e);var o=new less.Parser({paths:[path.dirname(e)],filename:e,optimization:1}),n=fs.readFileSync(e,"utf-8");s&&(n=s+n),o.parse(n,function(e,s){e&&(less.writeError(e),process.exit(1));var o=fs.openSync(r,"w");fs.write(o,s.toCSS({compress:!1}).replace(/\n/g,"\r\n"),0,"utf-8",function(e){fs.close(o),console.log("writing:",r),endProcess()})})}function getLessFiles(e){var s={},r=fs.readdirSync(e);return{array:r=(r=r.filter(function(e){return e&&/\.less$/.test(e)&&!/variables\.less$/.test(e)&&!/css3\.less$/.test(e)&&!/variables_rtl\.less$/.test(e)})).map(function(r){return s[r]=e+"/"+r,s[e+"/"+r]=r,s[r]}),dic:s}}themeFolders.forEach(function(e){batchQueue.push(function(){processFolder(e,!0),processFolder(e+"/dijit",!1)})}),commonFolders.forEach(function(e){batchQueue.push(function(){processFolder(e,!1)})}),batch();
//# sourceMappingURL=../../../sourcemaps/mobile/themes/utils/compile.js.map
