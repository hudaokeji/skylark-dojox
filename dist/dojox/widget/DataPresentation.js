/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
dojo.provide("dojox.widget.DataPresentation"),dojo.experimental("dojox.widget.DataPresentation"),dojo.require("dojox.grid.DataGrid"),dojo.require("dojox.charting.Chart2D"),dojo.require("dojox.charting.widget.Legend"),dojo.require("dojox.charting.action2d.Tooltip"),dojo.require("dojox.charting.action2d.Highlight"),dojo.require("dojo.colors"),dojo.require("dojo.data.ItemFileWriteStore"),function(){var e=function(e,t,r,i){var s={vertical:!0,fixLower:"major",fixUpper:"major",natural:!0};return"secondary"===t&&(s.leftBottom=!1),"ClusteredBars"!==e&&"StackedBars"!==e||(s.vertical=!1),r==i&&(s.min=r-1,s.max=i+1),s},t=function(e,t,r){var i={type:e,hAxis:"independent",vAxis:"dependent-"+t,gap:4,lines:!1,areas:!1,markers:!1};return"ClusteredBars"!==e&&"StackedBars"!==e||(i.hAxis=i.vAxis,i.vAxis="independent"),"Lines"!==e&&"Hybrid-Lines"!==e&&"Areas"!==e&&"StackedAreas"!==e||(i.lines=!0),"Areas"!==e&&"StackedAreas"!==e||(i.areas=!0),"Lines"===e&&(i.markers=!0),"Hybrid-Lines"===e&&(i.shadows={dx:2,dy:2,dw:2},i.type="Lines"),"Hybrid-ClusteredColumns"===e&&(i.type="ClusteredColumns"),r&&(i.animate=r),i},r=function(e,t){var r=e;if(t)for(var i=t.split(/[.\[\]]+/),s=0,a=i.length;s<a;s++)r&&(r=r[i[s]]);return r};dojo.declare("dojox.widget.DataPresentation",null,{type:"chart",chartType:"clusteredBars",reverse:!1,animate:null,labelMod:1,legendHorizontal:!0,constructor:function(e,t){dojo.mixin(this,t),this.domNode=dojo.byId(e),this[this.type+"Node"]=this.domNode,"string"==typeof this.theme&&(this.theme=dojo.getObject(this.theme)),this.chartNode=dojo.byId(this.chartNode),this.legendNode=dojo.byId(this.legendNode),this.gridNode=dojo.byId(this.gridNode),this.titleNode=dojo.byId(this.titleNode),this.footerNode=dojo.byId(this.footerNode),this.legendVertical&&(this.legendHorizontal=!this.legendVertical),this.url?this.setURL(null,null,this.refreshInterval):this.data?this.setData(null,this.refreshInterval):this.setStore()},setURL:function(e,t,r){r&&this.cancelRefresh(),this.url=e||this.url,this.urlContent=t||this.urlContent,this.refreshInterval=r||this.refreshInterval;var i=this;dojo.xhrGet({url:this.url,content:this.urlContent,handleAs:"json-comment-optional",load:function(e,t){i.setData(e)},error:function(e,t){i.urlError&&"function"==typeof i.urlError&&i.urlError(e,t)}}),r&&this.refreshInterval>0&&(this.refreshIntervalPending=setInterval(function(){i.setURL()},this.refreshInterval))},setData:function(e,t){t&&this.cancelRefresh(),this.data=e||this.data,this.refreshInterval=t||this.refreshInterval;for(var i,s,a,n,o="function"==typeof this.series?this.series(this.data):this.series,d=[],h=[],l=[],c=[],g=[],u=[],f=[],p=[],v=[],m=0,y=0;y<o.length;y++)d[y]=r(this.data,o[y].datapoints),d[y]&&d[y].length>m&&(m=d[y].length),h[y]=[],l[y]=o[y].name||(o[y].namefield?r(this.data,o[y].namefield):null)||"series "+y,c[y]=!1!==o[y].chart,g[y]=o[y].charttype||"bar",u[y]=o[y].linestyle,f[y]=o[y].axis||"primary",p[y]=!1!==o[y].grid,v[y]=o[y].gridformatter;var x=[];for(i=0;i<m;i++){for(s={index:i},y=0;y<o.length;y++)d[y]&&d[y].length>i&&(a=r(d[y][i],o[y].field),c[y]&&(n=parseFloat(a),isNaN(n)||(a=n)),s["data."+y]=a,h[y].push(a));x.push(s)}m<=0&&x.push({index:0});var j=new dojo.data.ItemFileWriteStore({data:{identifier:"index",items:x}});if(this.data.title&&(j.title=this.data.title),this.data.footer&&(j.footer=this.data.footer),j.series_data=h,j.series_name=l,j.series_chart=c,j.series_charttype=g,j.series_linestyle=u,j.series_axis=f,j.series_grid=p,j.series_gridformatter=v,this.setPreparedStore(j),t&&this.refreshInterval>0){var N=this;this.refreshIntervalPending=setInterval(function(){N.setData()},this.refreshInterval)}},refresh:function(){this.url?this.setURL(this.url,this.urlContent,this.refreshInterval):this.data&&this.setData(this.data,this.refreshInterval)},cancelRefresh:function(){this.refreshIntervalPending&&(clearInterval(this.refreshIntervalPending),this.refreshIntervalPending=void 0)},setStore:function(e,t,r){this.setPreparedStore(e,t,r)},setPreparedStore:function(r,i,s){var a,n,o,d,h;this.preparedstore=r||this.store,this.query=i||this.query,this.queryOptions=s||this.queryOptions,this.preparedstore&&(this.chartNode&&(this.chartWidget=function(r,i,s,a,n,o,d,h,l,c,g){var u=i;u||(r.innerHTML="",u=new dojox.charting.Chart2D(r)),d&&(d._clone=function(){var e=new dojox.charting.Theme({chart:this.chart,plotarea:this.plotarea,axis:this.axis,series:this.series,marker:this.marker,antiAlias:this.antiAlias,assignColors:this.assignColors,assignMarkers:this.assigneMarkers,colors:dojo.delegate(this.colors)});return e.markers=this.markers,e._buildMarkerArray(),e},u.setTheme(d));var f=l.series_data[0].slice(0);a&&f.reverse();var p=function(e,t,r,i){var s=[];s[0]={value:0,text:""};var a=e.length;if("ClusteredBars"!==r&&"StackedBars"!==r){var n=i.offsetWidth,o=(""+e[0]).length*e.length*7;if(1==t)for(var d=1;d<500&&!(o/d<n);++d)++t}for(var h=0;h<a;h++)s.push({value:h+1,text:!t||h%t?"":e[h]});return s.push({value:a+1,text:""}),s}(f,o,s,r),v={},m=null,y=null,x={};for(var j in u.runs)x[j]=!0;for(var N=l.series_name.length,W=0;W<N;W++)if(l.series_chart[W]&&l.series_data[W].length>0){var I=s,_=l.series_axis[W];if("Hybrid"==I&&(I="line"==l.series_charttype[W]?"Hybrid-Lines":"Hybrid-ClusteredColumns"),v[_]||(v[_]={}),!v[_][I]){var L=_+"-"+I;u.addPlot(L,t(I,_,n));var C={};"string"==typeof h?C.text=function(e){var t=[e.element,e.run.name,f[e.index],"ClusteredBars"===I||"StackedBars"===I?e.x:e.y];return dojo.replace(h,t)}:"function"==typeof h&&(C.text=h),new dojox.charting.action2d.Tooltip(u,L,C),"Lines"!==I&&"Hybrid-Lines"!==I&&new dojox.charting.action2d.Highlight(u,L),v[_][I]=!0}for(var S=[],k=l.series_data[W].length,H=0;H<k;H++){var b=l.series_data[W][H];S.push(b),(null===m||b>m)&&(m=b),(null===y||b<y)&&(y=b)}a&&S.reverse();var A={plot:_+"-"+I};l.series_linestyle[W]&&(A.stroke={style:l.series_linestyle[W]}),u.addSeries(l.series_name[W],S,A),delete x[l.series_name[W]]}for(j in x)u.removeSeries(j);return u.addAxis("independent",function(e,t){var r={vertical:!1,labels:t,min:0,max:t.length-1,majorTickStep:1,minorTickStep:1};return"ClusteredBars"!==e&&"StackedBars"!==e||(r.vertical=!0),"Lines"!==e&&"Areas"!==e&&"StackedAreas"!==e||(r.min++,r.max--),r}(s,p)),u.addAxis("dependent-primary",e(s,"primary",y,m)),u.addAxis("dependent-secondary",e(s,"secondary",y,m)),u}(this.chartNode,this.chartWidget,this.chartType,this.reverse,this.animate,this.labelMod,this.theme,this.tooltip,this.preparedstore,this.query,this.queryOptions),this.renderChartWidget()),this.legendNode&&(this.legendWidget=(a=this.legendNode,n=this.legendWidget,o=this.chartWidget,d=this.legendHorizontal,(h=n)?h.refresh():h=new dojox.charting.widget.Legend({chart:o,horizontal:d},a),h)),this.gridNode&&(this.gridWidget=function(e,t,r,i,s){var a=t||new dojox.grid.DataGrid({},e);a.startup(),a.setStore(r,i,s);for(var n=[],o=0;o<r.series_name.length;o++)r.series_grid[o]&&r.series_data[o].length>0&&n.push({field:"data."+o,name:r.series_name[o],width:"auto",formatter:r.series_gridformatter[o]});return a.setStructure(n),a}(this.gridNode,this.gridWidget,this.preparedstore,this.query,this.queryOptions),this.renderGridWidget()),this.titleNode&&function(e,t){t.title&&(e.innerHTML=t.title)}(this.titleNode,this.preparedstore),this.footerNode&&function(e,t){t.footer&&(e.innerHTML=t.footer)}(this.footerNode,this.preparedstore))},renderChartWidget:function(){this.chartWidget&&this.chartWidget.render()},renderGridWidget:function(){this.gridWidget&&this.gridWidget.render()},getChartWidget:function(){return this.chartWidget},getGridWidget:function(){return this.gridWidget},destroy:function(){this.cancelRefresh(),this.chartWidget&&(this.chartWidget.destroy(),delete this.chartWidget),this.legendWidget&&delete this.legendWidget,this.gridWidget&&delete this.gridWidget,this.chartNode&&(this.chartNode.innerHTML=""),this.legendNode&&(this.legendNode.innerHTML=""),this.gridNode&&(this.gridNode.innerHTML=""),this.titleNode&&(this.titleNode.innerHTML=""),this.footerNode&&(this.footerNode.innerHTML="")}})}();
//# sourceMappingURL=../sourcemaps/widget/DataPresentation.js.map
