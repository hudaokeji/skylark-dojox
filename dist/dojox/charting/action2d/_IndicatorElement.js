/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","../plot2d/Indicator","dojo/has","../plot2d/common","../axis2d/common","dojox/gfx"],function(t,i,e,o,r){var s=function(t,i,e){var o,r=t?{x:i[0],y:e[0][0]}:{x:e[0][0],y:i[0]};return i.length>1&&(o=t?{x:i[1],y:e[1][0]}:{x:e[1][0],y:i[1]}),[r,o]},a=e("dojox.charting.action2d._IndicatorElement",o,{constructor:function(t,i){i||(i={}),this.inter=i.inter},_updateVisibility:function(t,i,e){var o="x"==e?this._hAxis:this._vAxis,r=o.getWindowScale();this.chart.setAxisWindow(o.name,r,o.getWindowOffset()+(t[e]-i[e])/r),this._noDirty=!0,this.chart.render(),this._noDirty=!1,this._initTrack()},_trackMove:function(){this._updateIndicator(this.pageCoord),this._tracker=setTimeout(t.hitch(this,this._trackMove),100)},_initTrack:function(){this._tracker||(this._tracker=setTimeout(t.hitch(this,this._trackMove),500))},stopTrack:function(){this._tracker&&(clearTimeout(this._tracker),this._tracker=null)},render:function(){if(this.isDirty()){var i=this.inter,e=i.plot,o=i.opt.vertical;this.opt.offset=i.opt.offset||(o?{x:0,y:5}:{x:5,y:0}),i.opt.labelFunc&&(this.opt.labelFunc=function(t,e,r,a,n){var h=s(o,e,r);return i.opt.labelFunc(h[0],h[1],a,n)}),i.opt.fillFunc&&(this.opt.fillFunc=function(t,e,r){var a=s(o,e,r);return i.opt.fillFunc(a[0],a[1])}),this.opt=t.delegate(i.opt,this.opt),this.pageCoord?(this.opt.values=[],this.opt.labels=this.secondCoord?"trend":"markers"):(this.opt.values=null,this.inter.onChange({})),this.hAxis=e.hAxis,this.vAxis=e.vAxis,this.inherited(arguments)}},_updateIndicator:function(){var t=this._updateCoordinates(this.pageCoord,this.secondCoord);if(t.length>1){var e=this.opt.vertical;this._data=[],this.opt.values=[],i.forEach(t,function(t){t&&(this.opt.values.push(e?t.x:t.y),this._data.push([e?t.y:t.x]))},this),this.inherited(arguments)}else this.inter.onChange({})},_renderText:function(t,i,e,o,r,a,n,h){this.inter.opt.labels&&this.inherited(arguments);var c=s(this.opt.vertical,n,h);this.inter.onChange({start:c[0],end:c[1],label:i})},_updateCoordinates:function(t,i){r("dojo-bidi")&&this._checkXCoords(t,i);var e,o=this.inter,s=o.plot,a=o.opt.vertical,n=this.chart.getAxis(s.hAxis),h=this.chart.getAxis(s.vAxis),c=n.name,u=h.name,l=n.getScaler().bounds,d=h.getScaler().bounds,f=a?"x":"y",p=a?c:u,v=a?l:d;i&&(a?t.x>i.x&&(e=i,i=t,t=e):t.y>i.y&&(e=i,i=t,t=e));var x,_=s.toData(t);i&&(x=s.toData(i));var y={};y[c]=l.from,y[u]=d.from;var m=s.toPage(y);y[c]=l.to,y[u]=d.to;var g=s.toPage(y);if(_[p]<v.from){if(!x&&o.opt.autoScroll&&!o.opt.mouseOver)return this._updateVisibility(t,m,f),[];if(o.opt.mouseOver)return[];t[f]=m[f],_=s.toData(t)}else if(_[p]>v.to){if(!x&&o.opt.autoScroll&&!o.opt.mouseOver)return this._updateVisibility(t,g,f),[];if(o.opt.mouseOver)return[];t[f]=g[f],_=s.toData(t)}var b,k=this._snapData(_,f,a);return null==k.y?[]:(i&&(x[p]<v.from?(i[f]=m[f],x=s.toData(i)):x[p]>v.to&&(i[f]=g[f],x=s.toData(i)),null==(b=this._snapData(x,f,a)).y&&(b=null)),[k,b])},_snapData:function(t,i,e){var o,r,s,a,n,h,c=this.chart.getSeries(this.inter.opt.series).data,u=c.length;for(o=0;o<u;++o)if(null==(r=c[o]));else if("number"==typeof r){if(o+1>t[i])break}else if(r[i]>t[i])break;if("number"==typeof r?(s=o+1,a=r,o>0&&(n=o,h=c[o-1])):(s=r.x,a=r.y,o>0&&(n=c[o-1].x,h=c[o-1].y)),o>0){var l=e?(s+n)/2:(a+h)/2;t[i]<=l&&(s=n,a=h)}return{x:s,y:a}},cleanGroup:function(t){return this.inherited(arguments),this.group.moveToFront(),this},isDirty:function(){return!this._noDirty&&(this.dirty||this.inter.plot.isDirty())}});return r("dojo-bidi")&&a.extend({_checkXCoords:function(t,i){this.chart.isRightToLeft()&&(t&&(t.x=this.chart.dim.width+(this.chart.offsets.l-this.chart.offsets.r)-t.x),i&&(i.x=this.chart.dim.width+(this.chart.offsets.l-this.chart.offsets.r)-i.x))}}),a});
//# sourceMappingURL=../../sourcemaps/charting/action2d/_IndicatorElement.js.map
