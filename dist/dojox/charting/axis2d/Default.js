/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo/_base/lang","dojo/_base/array","dojo/sniff","dojo/_base/declare","dojo/_base/connect","dojo/dom-geometry","./Invisible","../scaler/linear","./common","dojox/gfx","dojox/lang/utils","dojox/lang/functional","dojo/has!dojo-bidi?../bidi/axis2d/Default"],function(t,e,i,a,l,r,n,o,h,s,c,m,x){var b=a(i("dojo-bidi")?"dojox.charting.axis2d.NonBidiDefault":"dojox.charting.axis2d.Default",n,{defaultParams:{vertical:!1,fixUpper:"none",fixLower:"none",natural:!1,leftBottom:!0,includeZero:!1,fixed:!0,majorLabels:!0,minorTicks:!0,minorLabels:!0,microTicks:!1,rotation:0,htmlLabels:!0,enableCache:!1,dropLabels:!0,labelSizeChange:!1,position:"leftOrBottom"},optionalParams:{min:0,max:1,from:0,to:1,majorTickStep:4,minorTickStep:2,microTickStep:1,labels:[],labelFunc:null,maxLabelSize:0,maxLabelCharCount:0,trailingSymbol:null,stroke:{},majorTick:{},minorTick:{},microTick:{},tick:{},font:"",fontColor:"",title:"",titleGap:0,titleFont:"",titleFontColor:"",titleOrientation:""},constructor:function(e,i){this.opt=t.clone(this.defaultParams),c.updateWithObject(this.opt,i),c.updateWithPattern(this.opt,i,this.optionalParams),this.opt.enableCache&&(this._textFreePool=[],this._lineFreePool=[],this._textUsePool=[],this._lineUsePool=[]),this._invalidMaxLabelSize=!0,i&&"position"in i||(this.opt.position=this.opt.leftBottom?"leftOrBottom":"rightOrTop"),this.renderingOptions={"shape-rendering":"crispEdges"}},setWindow:function(t,e){return t!=this.scale&&(this._invalidMaxLabelSize=!0),this.inherited(arguments)},_groupLabelWidth:function(e,i,a){if(!e.length)return 0;e.length>50&&(e.length=50),t.isObject(e[0])&&(e=m.map(e,function(t){return t.text})),a&&(e=m.map(e,function(e){return 0==t.trim(e).length?"":e.substring(0,a)+this.trailingSymbol},this));var l=e.join("<br>");return s._base._getTextBox(l,{font:i}).w||0},_getMaxLabelSize:function(i,a,l,r,n,h){if(null==this._maxLabelSize&&6==arguments.length){var s=this.opt;this.scaler.minMinorStep=this._prevMinMinorStep=0;var c=t.clone(s);delete c.to,delete c.from;var m=o.buildScaler(i,a,l,c,s.to-s.from);m.minMinorStep=0,this._majorStart=m.major.start;var x=o.buildTicks(m,s);if(h&&x){var b=0,d=0,u=function(t){t.label&&this.push(t.label)},p=[];this.opt.majorLabels&&(e.forEach(x.major,u,p),b=this._groupLabelWidth(p,n,c.maxLabelCharCount),c.maxLabelSize&&(b=Math.min(c.maxLabelSize,b))),p=[],this.opt.dropLabels&&this.opt.minorLabels&&(e.forEach(x.minor,u,p),d=this._groupLabelWidth(p,n,c.maxLabelCharCount),c.maxLabelSize&&(d=Math.min(c.maxLabelSize,d))),this._maxLabelSize={majLabelW:b,minLabelW:d,majLabelH:h,minLabelH:h}}else this._maxLabelSize=null}return this._maxLabelSize},calculate:function(t,e,i){if(this.inherited(arguments),this.scaler.minMinorStep=this._prevMinMinorStep,(this._invalidMaxLabelSize||i!=this._oldSpan)&&t!=1/0&&e!=-1/0){this._invalidMaxLabelSize=!1,this.opt.labelSizeChange&&(this._maxLabelSize=null),this._oldSpan=i;var a=this.opt,l=this.chart.theme.axis,r=a.rotation%360,n=this.chart.theme.axis.tick.labelGap,h=a.font||l.majorTick&&l.majorTick.font||l.tick&&l.tick.font,c=h?s.normalizedLength(s.splitFontString(h).size):0,m=this._getMaxLabelSize(t,e,i,r,h,c);if("number"!=typeof n&&(n=4),m&&a.dropLabels){var x,b,d=Math.abs(Math.cos(r*Math.PI/180)),u=Math.abs(Math.sin(r*Math.PI/180));switch(r<0&&(r+=360),r){case 0:case 180:this.vertical?x=b=c:(x=m.majLabelW,b=m.minLabelW);break;case 90:case 270:this.vertical?(x=m.majLabelW,b=m.minLabelW):x=b=c;break;default:x=this.vertical?Math.min(m.majLabelW,c/d):Math.min(m.majLabelW,c/u);var p=Math.sqrt(m.minLabelW*m.minLabelW+c*c),g=this.vertical?c*d+m.minLabelW*u:m.minLabelW*d+c*u;b=Math.min(p,g)}this.scaler.minMinorStep=this._prevMinMinorStep=Math.max(x,b)+n;var f=this.scaler.minMinorStep<=this.scaler.minor.tick*this.scaler.bounds.scale;this._skipInterval=f?0:Math.floor((x+n)/(this.scaler.major.tick*this.scaler.bounds.scale))}else this._skipInterval=0}return this.ticks=o.buildTicks(this.scaler,this.opt),this},getOffsets:function(){var t={l:0,r:0,t:0,b:0};if(!this.scaler)return t;var e=this.opt,i=this.chart.theme.axis,a=this.chart.theme.axis.tick.labelGap,l=e.titleFont||i.title&&i.title.font,r=0==e.titleGap?0:e.titleGap||i.title&&i.title.gap,n=this.chart.theme.getTick("major",e),o=this.chart.theme.getTick("minor",e),h=l?s.normalizedLength(s.splitFontString(l).size):0,c=e.rotation%360,m=e.position,x="rightOrTop"!==m,b=Math.abs(Math.cos(c*Math.PI/180)),d=Math.abs(Math.sin(c*Math.PI/180));this.trailingSymbol=void 0===e.trailingSymbol||null===e.trailingSymbol?this.trailingSymbol:e.trailingSymbol,"number"!=typeof a&&(a=4),c<0&&(c+=360);var u=this._getMaxLabelSize();if(u){var p,g=Math.ceil(Math.max(u.majLabelW,u.minLabelW))+1,f=Math.ceil(Math.max(u.majLabelH,u.minLabelH))+1;if(this.vertical){switch(p=x?"l":"r",c){case 0:case 180:t[p]="center"===m?0:g,t.t=t.b=f/2;break;case 90:case 270:t[p]=f,t.t=t.b=g/2;break;default:c<=45||180<c&&c<=225?(t[p]=f*d/2+g*b,t[x?"t":"b"]=f*b/2+g*d,t[x?"b":"t"]=f*b/2):c>315||180>c&&c>135?(t[p]=f*d/2+g*b,t[x?"b":"t"]=f*b/2+g*d,t[x?"t":"b"]=f*b/2):c<90||180<c&&c<270?(t[p]=f*d+g*b,t[x?"t":"b"]=f*b+g*d):(t[p]=f*d+g*b,t[x?"b":"t"]=f*b+g*d)}"center"===m?t[p]=0:t[p]+=a+Math.max(n.length>0?n.length:0,o.length>0?o.length:0)+(e.title?h+r:0)}else{switch(p=x?"b":"t",c){case 0:case 180:t[p]="center"===m?0:f,t.l=t.r=g/2;break;case 90:case 270:t[p]=g,t.l=t.r=f/2;break;default:45<=c&&c<=90||225<=c&&c<=270?(t[p]=f*b/2+g*d,t[x?"r":"l"]=f*d/2+g*b,t[x?"l":"r"]=f*d/2):90<=c&&c<=135||270<=c&&c<=315?(t[p]=f*b/2+g*d,t[x?"l":"r"]=f*d/2+g*b,t[x?"r":"l"]=f*d/2):c<45||180<c&&c<225?(t[p]=f*b+g*d,t[x?"r":"l"]=f*d+g*b):(t[p]=f*b+g*d,t[x?"l":"r"]=f*d+g*b)}"center"===m?t[p]=0:t[p]+=a+Math.max(n.length>0?n.length:0,o.length>0?o.length:0)+(e.title?h+r:0)}}return t},cleanGroup:function(t){this.opt.enableCache&&this.group&&(this._lineFreePool=this._lineFreePool.concat(this._lineUsePool),this._lineUsePool=[],this._textFreePool=this._textFreePool.concat(this._textUsePool),this._textUsePool=[]),this.inherited(arguments)},createText:function(t,e,i,a,l,r,n,o,s){return this.opt.enableCache&&"html"!=t?(this._textFreePool.length>0?((c=this._textFreePool.pop()).setShape({x:i,y:a,text:r,align:l}),e.add(c)):c=h.createText[t](this.chart,e,i,a,l,r,n,o),this._textUsePool.push(c),c):h.createText[t](this.chart,e,i,a,l,r,n,o,s);var c},createLine:function(t,e){var i;return this.opt.enableCache&&this._lineFreePool.length>0?((i=this._lineFreePool.pop()).setShape(e),t.add(i)):i=t.createLine(e),this.opt.enableCache&&this._lineUsePool.push(i),i},render:function(t,a){var l=this._isRtl();if(!this.dirty||!this.scaler)return this;var r,n,c,m,x,b,d,u,p,g=this.opt,f=this.chart.theme.axis,y=g.position,L="rightOrTop"!==y,k=g.rotation%360,M=0,v=this.chart.theme.axis.tick.labelGap,S=g.font||f.majorTick&&f.majorTick.font||f.tick&&f.tick.font,_=g.titleFont||f.title&&f.title.font,j=g.fontColor||f.majorTick&&f.majorTick.fontColor||f.tick&&f.tick.fontColor||"black",T=g.titleFontColor||f.title&&f.title.fontColor||"black",C=0==g.titleGap?0:g.titleGap||f.title&&f.title.gap||15,z=g.titleOrientation||f.title&&f.title.orientation||"axis",P=this.chart.theme.getTick("major",g),W=this.chart.theme.getTick("minor",g),w=this.chart.theme.getTick("micro",g),F="stroke"in g?g.stroke:f.stroke,O=S?s.normalizedLength(s.splitFontString(S).size):0,G=Math.abs(Math.cos(k*Math.PI/180)),I=Math.abs(Math.sin(k*Math.PI/180)),E=_?s.normalizedLength(s.splitFontString(_).size):0;"number"!=typeof v&&(v=4),k<0&&(k+=360);var U=this._getMaxLabelSize();if(U=U&&U.majLabelW,this.vertical){switch(r={y:t.height-a.b},n={y:a.t},c={y:(t.height-a.b+a.t)/2},m=O*I+(U||0)*G+v+Math.max(P.length>0?P.length:0,W.length>0?W.length:0)+E+C,x={x:0,y:-1},u={x:0,y:0},b={x:1,y:0},d={x:v,y:0},k){case 0:p="end",u.y=.4*O;break;case 90:p="middle",u.x=-O;break;case 180:p="start",u.y=.4*-O;break;case 270:p="middle";break;default:k<45?(p="end",u.y=.4*O):k<90?(p="end",u.y=.4*O):k<135?p="start":k<225?(p="start",u.y=.4*-O):k<270?(p="start",u.x=L?0:.4*O):k<315?(p="end",u.x=L?0:.4*O):(p="end",u.y=.4*O)}if(L)r.x=n.x="center"===y?t.width/2:a.l,M=z&&"away"==z?90:270,c.x=a.l-m+(270==M?E:0),b.x=-1,d.x=-d.x;else switch(r.x=n.x=t.width-a.r,M=z&&"axis"==z?90:270,c.x=t.width-a.r+m-(270==M?0:E),p){case"start":p="end";break;case"end":p="start";break;case"middle":u.x+=O}}else{switch(r={x:a.l},n={x:t.width-a.r},c={x:(t.width-a.r+a.l)/2},m=O*G+(U||0)*I+v+Math.max(P.length>0?P.length:0,W.length>0?W.length:0)+E+C,x={x:l?-1:1,y:0},u={x:0,y:0},b={x:0,y:1},d={x:0,y:v},k){case 0:p="middle",u.y=O;break;case 90:p="start",u.x=.4*-O;break;case 180:p="middle";break;case 270:p="end",u.x=.4*O;break;default:k<45?(p="start",u.y=L?O:0):k<135?(p="start",u.x=.4*-O):k<180?(p="start",u.y=L?0:-O):k<225?(p="end",u.y=L?0:-O):k<315?(p="end",u.y=L?.4*O:0):(p="end",u.y=L?O:0)}if(L)r.y=n.y="center"===y?t.height/2:t.height-a.b,M=z&&"axis"==z?180:0,c.y=t.height-a.b+m-(M?E:0);else switch(r.y=n.y=a.t,M=z&&"away"==z?180:0,c.y=a.t-m+(M?0:E),b.y=-1,d.y=-d.y,p){case"start":p="end";break;case"end":p="start";break;case"middle":u.y-=O}}this.cleanGroup();var B=this.group,q=this.scaler,D=this.ticks,H=o.getTransformerFromModel(this.scaler),A=g.title&&M||k||!this.opt.htmlLabels||i("ie")||i("opera")?"gfx":"html",R=b.x*P.length,N=b.y*P.length,Z=this._skipInterval;if(B.createLine({x1:r.x,y1:r.y,x2:n.x,y2:n.y}).setStroke(F),g.title){var J=h.createText[A](this.chart,B,c.x,c.y,"middle",g.title,_,T);"html"==A?this.htmlElements.push(J):J.setTransform(s.matrix.rotategAt(M,c.x,c.y))}if(null==D)return this.dirty=!1,this;var K=D.major.length>0?(D.major[0].value-this._majorStart)/q.major.tick:0,Q=this.opt.majorLabels;return e.forEach(D.major,function(t,e){var i,a=H(t.value),o=(l?n.x:r.x)+x.x*a,h=r.y+x.y*a;if(e+=K,this.createLine(B,{x1:o,y1:h,x2:o+R,y2:h+N}).setStroke(P),t.label&&(!Z||(e-(1+Z))%(1+Z)==0)){var c=g.maxLabelCharCount?this.getTextWithLimitCharCount(t.label,S,g.maxLabelCharCount):{text:t.label,truncated:!1};c=g.maxLabelSize?this.getTextWithLimitLength(c.text,S,g.maxLabelSize,c.truncated):c,i=this.createText(A,B,o+(P.length>0?R:0)+d.x+(k?0:u.x),h+(P.length>0?N:0)+d.y+(k?0:u.y),p,c.text,S,j),c.truncated&&this.chart.formatTruncatedLabel(i,t.label,A),c.truncated&&this.labelTooltip(i,this.chart,t.label,c.text,S,A),"html"==A?this.htmlElements.push(i):k&&i.setTransform([{dx:u.x,dy:u.y},s.matrix.rotategAt(k,o+(P.length>0?R:0)+d.x,h+(P.length>0?N:0)+d.y)])}},this),R=b.x*W.length,N=b.y*W.length,Q=this.opt.minorLabels&&q.minMinorStep<=q.minor.tick*q.bounds.scale,e.forEach(D.minor,function(t){var e,i=H(t.value),a=(l?n.x:r.x)+x.x*i,o=r.y+x.y*i;if(this.createLine(B,{x1:a,y1:o,x2:a+R,y2:o+N}).setStroke(W),Q&&t.label){var h=g.maxLabelCharCount?this.getTextWithLimitCharCount(t.label,S,g.maxLabelCharCount):{text:t.label,truncated:!1};h=g.maxLabelSize?this.getTextWithLimitLength(h.text,S,g.maxLabelSize,h.truncated):h,e=this.createText(A,B,a+(W.length>0?R:0)+d.x+(k?0:u.x),o+(W.length>0?N:0)+d.y+(k?0:u.y),p,h.text,S,j),h.truncated&&this.chart.formatTruncatedLabel(e,t.label,A),h.truncated&&this.labelTooltip(e,this.chart,t.label,h.text,S,A),"html"==A?this.htmlElements.push(e):k&&e.setTransform([{dx:u.x,dy:u.y},s.matrix.rotategAt(k,a+(W.length>0?R:0)+d.x,o+(W.length>0?N:0)+d.y)])}},this),R=b.x*w.length,N=b.y*w.length,e.forEach(D.micro,function(t){var e=H(t.value),i=r.x+x.x*e,a=r.y+x.y*e;this.createLine(B,{x1:i,y1:a,x2:i+R,y2:a+N}).setStroke(w)},this),this.dirty=!1,this},labelTooltip:function(e,i,a,n,o,h){var c=["dijit/Tooltip"],m={type:"rect"},x=["above","below"],b=s._base._getTextBox(n,{font:o}).w||0,d=o?s.normalizedLength(s.splitFontString(o).size):0;if("html"==h)t.mixin(m,r.position(e.firstChild,!0)),m.width=Math.ceil(b),m.height=Math.ceil(d),this._events.push({shape:dojo,handle:l.connect(e.firstChild,"onmouseover",this,function(t){require(c,function(t){t.show(a,m,x)})})}),this._events.push({shape:dojo,handle:l.connect(e.firstChild,"onmouseout",this,function(t){require(c,function(t){t.hide(m)})})});else{var u=e.getShape(),p=i.getCoords();(m=t.mixin(m,{x:u.x-b/2,y:u.y})).x+=p.x,m.y+=p.y,m.x=Math.round(m.x),m.y=Math.round(m.y),m.width=Math.ceil(b),m.height=Math.ceil(d),this._events.push({shape:e,handle:e.connect("onmouseenter",this,function(t){require(c,function(t){t.show(a,m,x)})})}),this._events.push({shape:e,handle:e.connect("onmouseleave",this,function(t){require(c,function(t){t.hide(m)})})})}},_isRtl:function(){return!1}});return i("dojo-bidi")?a("dojox.charting.axis2d.Default",[b,x]):b});
//# sourceMappingURL=../../sourcemaps/charting/axis2d/Default.js.map
