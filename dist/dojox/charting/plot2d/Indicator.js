/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./CartesianBase","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/lang/utils","dojox/gfx/fx","dojo/has"],function(t,i,e,a,o,r,s,h,n,l,d){var p=function(i,e){var a,o,r=i.declaredClass;if(-1!=r.indexOf("svg"))try{return t.mixin({},i.rawNode.getBBox())}catch(t){return null}else{if(-1!=r.indexOf("vml")){var s=i.rawNode,n=s.style.display;s.style.display="inline";var l={x:0,y:0,width:a=h.pt2px(parseFloat(s.currentStyle.width)),height:o=h.pt2px(parseFloat(s.currentStyle.height))};return c(i,l),s.style.display=n,l}if(-1!=r.indexOf("silverlight")){var d={width:i.rawNode.actualWidth,height:i.rawNode.actualHeight};return c(i,d,.75)}if(i.getTextWidth){a=i.getTextWidth();var p=i.getFont(),u=p?p.size:h.defaultFont.size;return o=h.normalizedLength(u),c(i,l={width:a,height:o},.75),l}}return null},c=function(t,i,e){var a=i.width,o=i.height,r=t.getShape();switch(r.align){case"end":i.x=r.x-a;break;case"middle":i.x=r.x-a/2;break;case"start":default:i.x=r.x}return e=e||1,i.y=r.y-o*e,i},u=e("dojox.charting.plot2d.Indicator",[a,o],{defaultParams:{vertical:!0,fixed:!0,precision:0,lines:!0,labels:"line",markers:!0},optionalParams:{lineStroke:{},outlineStroke:{},shadowStroke:{},lineFill:{},stroke:{},outline:{},shadow:{},fill:{},fillFunc:null,labelFunc:null,font:"",fontColor:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerSymbol:"",values:[],offset:{},start:!1,animate:!1},constructor:function(i,e){this.opt=t.clone(this.defaultParams),n.updateWithObject(this.opt,e),"number"==typeof e.values&&(e.values=[e.values]),n.updateWithPattern(this.opt,e,this.optionalParams),this.animate=this.opt.animate},render:function(t,i){return this.zoom?this.performZoom(t,i):this.isDirty()?(this.cleanGroup(null,!0),this.opt.values?(this._updateIndicator(),this):this):this},_updateIndicator:function(){var t=this.chart.theme,e=this._hAxis.name,a=this._vAxis.name,o=this._hAxis.getScaler().bounds,s=this._vAxis.getScaler().bounds,h={};h[e]=o.from,h[a]=s.from;var n=this.toPage(h);h[e]=o.to,h[a]=s.to;var l=this.toPage(h),d=this.events(),p=i.map(this.opt.values,function(t,i){return this._renderIndicator(t,i,e,a,n,l,d,this.animate)},this),c=p.length;if("trend"==this.opt.labels){var u=this.opt.vertical,x=this._data[0][0],m=this._data[c-1][0]-x,f=this.opt.labelFunc?this.opt.labelFunc(-1,this.values,this._data,this.opt.fixed,this.opt.precision):r.getLabel(m,this.opt.fixed,this.opt.precision)+" ("+r.getLabel(100*m/x,!0,2)+"%)";this._renderText(this.getGroup(),f,this.chart.theme,u?(p[0].x+p[c-1].x)/2:p[1].x,u?p[0].y:(p[1].y+p[c-1].y)/2,-1,this.opt.values,this._data)}var y=void 0!=this.opt.lineFill?this.opt.lineFill:t.indicator.lineFill;if(y&&c>1){var k=Math.min(p[0].x1,p[c-1].x1),v=Math.min(p[0].y1,p[c-1].y1);this.getGroup().createRect({x:k,y:v,width:Math.max(p[0].x2,p[c-1].x2)-k,height:Math.max(p[0].y2,p[c-1].y2)-v}).setFill(y).moveToBack()}},_renderIndicator:function(e,a,o,s,h,n,l,p){var c=this.chart.theme,u=this.chart.getCoords(),x=this.opt.vertical,m=this.getGroup().createGroup(),f={};f[o]=x?e:0,f[s]=x?0:e,d("dojo-bidi")&&(f.x=this._getMarkX(f.x)),f=this.toPage(f);var y,k,v,g=x?f.x>=h.x&&f.x<=n.x:f.y>=n.y&&f.y<=h.y,S=f.x-u.x,w=f.y-u.y,b=x?S:h.x-u.x,_=x?h.y-u.y:w,F=x?b:n.x-u.x,P=x?n.y-u.y:_;if(this.opt.lines&&g){var O=this.opt.hasOwnProperty("lineShadow")?this.opt.lineShadow:c.indicator.lineShadow,j=this.opt.hasOwnProperty("lineStroke")?this.opt.lineStroke:c.indicator.lineStroke,T=this.opt.hasOwnProperty("lineOutline")?this.opt.lineOutline:c.indicator.lineOutline;O&&m.createLine({x1:b+O.dx,y1:_+O.dy,x2:F+O.dx,y2:P+O.dy}).setStroke(O),T&&((T=r.makeStroke(T)).width=2*T.width+(j?j.width:0),m.createLine({x1:b,y1:_,x2:F,y2:P}).setStroke(T)),m.createLine({x1:b,y1:_,x2:F,y2:P}).setStroke(j)}if(this.opt.markers&&g){var L=this._data[a],M=this;L&&(y=i.map(L,function(t,i){if(f[o]=x?e:t,f[s]=x?t:e,d("dojo-bidi")&&(f.x=M._getMarkX(f.x)),f=this.toPage(f),x?f.y<=h.y&&f.y>=n.y:f.x>=h.x&&f.x<=n.x){S=f.x-u.x,w=f.y-u.y;var a=this.opt.markerSymbol?this.opt.markerSymbol:c.indicator.markerSymbol,l="M"+S+" "+w+" "+a;if(O=void 0!=this.opt.markerShadow?this.opt.markerShadow:c.indicator.markerShadow,j=void 0!=this.opt.markerStroke?this.opt.markerStroke:c.indicator.markerStroke,T=void 0!=this.opt.markerOutline?this.opt.markerOutline:c.indicator.markerOutline,O){var p="M"+(S+O.dx)+" "+(w+O.dy)+" "+a;m.createPath(p).setFill(O.color).setStroke(O)}T&&((T=r.makeStroke(T)).width=2*T.width+(j?j.width:0),m.createPath(l).setStroke(T));var y=m.createPath(l),k=this._shapeFill(void 0!=this.opt.markerFill?this.opt.markerFill:c.indicator.markerFill,y.getBoundingBox());y.setFill(k).setStroke(j)}return t},this))}(k=this.opt.start?{x:b,y:x?_:P}:{x:x?b:F,y:x?P:_},this.opt.labels&&"trend"!=this.opt.labels&&g)&&(v=this.opt.labelFunc?this.opt.labelFunc(a,this.opt.values,this._data,this.opt.fixed,this.opt.precision,this.opt.labels):"markers"==this.opt.labels?1!=(v=i.map(y,function(t){return r.getLabel(t,this.opt.fixed,this.opt.precision)},this)).length?"[ "+v.join(", ")+" ]":v[0]:r.getLabel(e,this.opt.fixed,this.opt.precision),this._renderText(m,v,c,k.x,k.y,a,this.opt.values,this._data));return l&&this._connectEvents({element:"indicator",run:this.run?this.run[a]:void 0,shape:m,value:e}),p&&this._animateIndicator(m,x,x?_:b,x?_+P:b+F,p),t.mixin(k,{x1:b,y1:_,x2:F,y2:P})},_animateIndicator:function(i,e,a,o,r){var s=e?[0,a]:[a,0],h=e?[1,1/o]:[1/o,1];l.animateTransform(t.delegate({shape:i,duration:1200,transform:[{name:"translate",start:s,end:[0,0]},{name:"scale",start:h,end:[1,1]},{name:"original"}]},r)).play()},clear:function(){this.inherited(arguments),this._data=[]},addSeries:function(t){this.inherited(arguments),this._data.push(t.data)},_renderText:function(t,i,e,a,o,h,n,l){this.opt.offset&&(a+=this.opt.offset.x,o+=this.opt.offset.y);var d,c=s.createText.gfx(this.chart,t,a,o,"middle",i,this.opt.font?this.opt.font:e.indicator.font,this.opt.fontColor?this.opt.fontColor:e.indicator.fontColor),u=p(d=c,d.getShape().text);u.x-=2,u.y-=1,u.width+=4,u.height+=2,u.r=this.opt.radius?this.opt.radius:e.indicator.radius;var x=void 0!=this.opt.shadow?this.opt.shadow:e.indicator.shadow,m=void 0!=this.opt.stroke?this.opt.stroke:e.indicator.stroke,f=void 0!=this.opt.outline?this.opt.outline:e.indicator.outline;x&&t.createRect(u).setFill(x.color).setStroke(x),f&&((f=r.makeStroke(f)).width=2*f.width+(m?m.width:0),t.createRect(u).setStroke(f));var y=this.opt.fillFunc?this.opt.fillFunc(h,n,l):void 0!=this.opt.fill?this.opt.fill:e.indicator.fill;t.createRect(u).setFill(this._shapeFill(y,u)).setStroke(m),c.moveToFront()},getSeriesStats:function(){return t.delegate(r.defaultStats)}});return d("dojo-bidi")&&u.extend({_getMarkX:function(t){return this.chart.isRightToLeft()?this.chart.axes.x.scaler.bounds.to+this.chart.axes.x.scaler.bounds.from-t:t}}),u});
//# sourceMappingURL=../../sourcemaps/charting/plot2d/Indicator.js.map
