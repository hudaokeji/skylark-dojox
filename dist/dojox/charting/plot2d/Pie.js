/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./Base","./_PlotEvents","./common","dojox/gfx","dojox/gfx/matrix","dojox/lang/functional","dojox/lang/utils","dojo/has"],function(t,e,i,s,r,a,l,n,h,o,c){return i("dojox.charting.plot2d.Pie",[s,r],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:!0,radGrad:"native",fanSize:5,startAngle:0},optionalParams:{radius:0,omitLabels:!1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",labelWiring:{}},constructor:function(e,i){this.opt=t.clone(this.defaultParams),o.updateWithObject(this.opt,i),o.updateWithPattern(this.opt,i,this.optionalParams),this.axes=[],this.run=null,this.dyn=[],this.runFilter=[]},clear:function(){return this.inherited(arguments),this.dyn=[],this.run=null,this},setAxis:function(t){return this},addSeries:function(t){return this.run=t,this},getSeriesStats:function(){return t.delegate(a.defaultStats)},getRequiredColors:function(){return this.run?this.run.data.length:0},render:function(i,s){if(!this.dirty)return this;this.resetEvents(),this.dirty=!1,this._eventSeries={},this.cleanGroup();var r=this.group,a=this.chart.theme;if(!this.run||!this.run.data.length)return this;var o,f,u,d,p,x,y=(i.width-s.l-s.r)/2,b=(i.height-s.t-s.b)/2,g=Math.min(y,b),m="font"in this.opt?this.opt.font:a.series.font,v=n._degToRad(this.opt.startAngle),M=v,_=this.events(),P=e.map(this.run.data,function(t,i){return"number"!=typeof t&&t.hidden&&(this.runFilter.push(i),t.hidden=!1),e.some(this.runFilter,function(t){return t==i})?"number"==typeof t?0:{y:0,text:t.text}:t},this);this.dyn=[],"radius"in this.opt&&(g=this.opt.radius,x=g-this.opt.labelOffset);var R={cx:s.l+y,cy:s.t+b,r:g};if(this.opt.shadow||a.shadow){var F=this.opt.shadow||a.shadow,k=t.clone(R);k.cx+=F.dx,k.cy+=F.dy,r.createCircle(k).setFill(F.color).setStroke(F)}if(r.setFilter&&(this.opt.filter||a.filter)&&r.createCircle(R).setFill(a.series.stroke).setFilter(this.opt.filter||a.filter),"number"==typeof P[0]){if(f=h.map(P,"x ? Math.max(x, 0) : 0"),h.every(f,"<= 0"))return r.createCircle(R).setStroke(a.series.stroke),this.dyn=e.map(f,function(){return{}}),this;u=h.map(f,"/this",h.foldl(f,"+",0)),this.opt.labels&&(d=e.map(u,function(t){return t>0?this._getLabel(100*t)+"%":""},this))}else{if(f=h.map(P,"x ? Math.max(x.y, 0) : 0"),h.every(f,"<= 0"))return r.createCircle(R).setStroke(a.series.stroke),this.dyn=e.map(f,function(){return{}}),this;u=h.map(f,"/this",h.foldl(f,"+",0)),this.opt.labels&&(d=e.map(u,function(t,e){if(t<0)return"";var i=P[e];return"text"in i?i.text:this._getLabel(100*t)+"%"},this))}var T=h.map(P,function(t,e){var i=[this.opt,this.run];return null!==t&&"number"!=typeof t&&i.push(t),this.opt.styleFunc&&i.push(this.opt.styleFunc(t)),a.next("slice",i,!0)},this);this.opt.labels&&(o=m?l.normalizedLength(l.splitFontString(m).size):0,p=h.foldl1(h.map(d,function(t,e){var i=T[e].series.font;return l._base._getTextBox(t,{font:i}).w},this),"Math.max(a, b)")/2,this.opt.labelOffset<0&&(g=Math.min(y-2*p,b-o)+this.opt.labelOffset),x=g-this.opt.labelOffset);var S=new Array(u.length);if(e.some(u,function(t,e){if(t<0)return!1;var a,l,h=P[e],o=T[e];if(0==t)return this.dyn.push({fill:o.series.fill,stroke:o.series.stroke}),!1;if(t>=1){a=this._plotFill(o.series.fill,i,s),a=this._shapeFill(a,{x:R.cx-R.r,y:R.cy-R.r,width:2*R.r,height:2*R.r}),a=this._pseudoRadialFill(a,{x:R.cx,y:R.cy},R.r);var c=r.createCircle(R).setFill(a).setStroke(o.series.stroke);return this.dyn.push({fill:a,stroke:o.series.stroke}),_&&(l={element:"slice",index:e,run:this.run,shape:c,x:e,y:"number"==typeof h?h:h.y,cx:R.cx,cy:R.cy,cr:g},this._connectEvents(l),S[e]=l),!1}var f=M+2*t*Math.PI;e+1==u.length&&(f=v+2*Math.PI);var d=f-M,p=R.cx+g*Math.cos(M),x=R.cy+g*Math.sin(M),y=R.cx+g*Math.cos(f),b=R.cy+g*Math.sin(f),m=n._degToRad(this.opt.fanSize);if(o.series.fill&&"radial"===o.series.fill.type&&"fan"===this.opt.radGrad&&d>m){var F=r.createGroup(),k=Math.ceil(d/m),L=d/k;a=this._shapeFill(o.series.fill,{x:R.cx-R.r,y:R.cy-R.r,width:2*R.r,height:2*R.r});for(var w=0;w<k;++w){var j=0==w?p:R.cx+g*Math.cos(M+(w-.2)*L),I=0==w?x:R.cy+g*Math.sin(M+(w-.2)*L),O=w==k-1?y:R.cx+g*Math.cos(M+(w+1+.2)*L),C=w==k-1?b:R.cy+g*Math.sin(M+(w+1+.2)*L);F.createPath().moveTo(R.cx,R.cy).lineTo(j,I).arcTo(g,g,0,L>Math.PI,!0,O,C).lineTo(R.cx,R.cy).closePath().setFill(this._pseudoRadialFill(a,{x:R.cx,y:R.cy},g,M+(w+.5)*L,M+(w+.5)*L))}F.createPath().moveTo(R.cx,R.cy).lineTo(p,x).arcTo(g,g,0,d>Math.PI,!0,y,b).lineTo(R.cx,R.cy).closePath().setStroke(o.series.stroke),c=F}else c=r.createPath().moveTo(R.cx,R.cy).lineTo(p,x).arcTo(g,g,0,d>Math.PI,!0,y,b).lineTo(R.cx,R.cy).closePath().setStroke(o.series.stroke),(a=o.series.fill)&&"radial"===a.type?(a=this._shapeFill(a,{x:R.cx-R.r,y:R.cy-R.r,width:2*R.r,height:2*R.r}),"linear"===this.opt.radGrad&&(a=this._pseudoRadialFill(a,{x:R.cx,y:R.cy},g,M,f))):a&&"linear"===a.type&&(a=this._plotFill(a,i,s),a=this._shapeFill(a,c.getBoundingBox())),c.setFill(a);return this.dyn.push({fill:a,stroke:o.series.stroke}),_&&(l={element:"slice",index:e,run:this.run,shape:c,x:e,y:"number"==typeof h?h:h.y,cx:R.cx,cy:R.cy,cr:g},this._connectEvents(l),S[e]=l),M=f,!1},this),this.opt.labels){var L=c("dojo-bidi")&&this.chart.isRightToLeft();if("default"==this.opt.labelStyle)M=v,e.some(u,function(t,e){if(t<=0)return!1;var s=T[e];if(t>=1)return this.renderLabel(r,R.cx,R.cy+o/2,d[e],s,this.opt.labelOffset>0),!0;var a=M+2*t*Math.PI;if(e+1==u.length&&(a=v+2*Math.PI),this.opt.omitLabels&&a-M<.001)return!1;var l=(M+a)/2,n=R.cx+x*Math.cos(l),h=R.cy+x*Math.sin(l)+o/2;return this.renderLabel(r,L?i.width-n:n,h,d[e],s,this.opt.labelOffset>0),M=a,!1},this);else if("columns"==this.opt.labelStyle){M=v;var w=this.opt.omitLabels,j=[];e.forEach(u,function(t,e){var i=M+2*t*Math.PI;e+1==u.length&&(i=v+2*Math.PI);var s=(M+i)/2;j.push({angle:s,left:Math.cos(s)<0,theme:T[e],index:e,omit:!!w&&i-M<.001}),M=i});var I=l._base._getTextBox("a",{font:m}).h;this._getProperLabelRadius(j,I,1.1*R.r),e.forEach(j,function(t,e){if(!t.omit){var s=R.cx-2*R.r,a=R.cx+2*R.r,n=l._base._getTextBox(d[e],{font:t.theme.series.font}).w,h=R.cx+t.labelR*Math.cos(t.angle),o=R.cy+t.labelR*Math.sin(t.angle),c=t.left?s+n:a-n,f=t.left?s:c,u=r.createPath().moveTo(R.cx+R.r*Math.cos(t.angle),R.cy+R.r*Math.sin(t.angle));Math.abs(t.labelR*Math.cos(t.angle))<2*R.r-n&&u.lineTo(h,o),u.lineTo(c,o).setStroke(t.theme.series.labelWiring),this.renderLabel(r,L?i.width-n-f:f,o,d[e],t.theme,!1,"left")}},this)}}var O=0;return this._eventSeries[this.run.name]=h.map(P,function(t){return t<=0?null:S[O++]}),c("dojo-bidi")&&this._checkOrientation(this.group,i,s),this},_getProperLabelRadius:function(t,e,i){var s,r,a=1,l=1;if(1!=t.length){for(var n=0;n<t.length;n++){var h=Math.abs(Math.sin(t[n].angle));t[n].left?a>=h&&(a=h,s=t[n]):l>=h&&(l=h,r=t[n])}s.labelR=r.labelR=i,this._calculateLabelR(s,t,e),this._calculateLabelR(r,t,e)}else t[0].labelR=i},_calculateLabelR:function(t,e,i){for(var s,r=t.index,a=e.length,l=t.labelR;!(e[r%a].left^e[(r+1)%a].left);)e[(r+1)%a].omit||(l=(s=(Math.sin(e[r%a].angle)*l+(e[r%a].left?-i:i))/Math.sin(e[(r+1)%a].angle))<t.labelR?t.labelR:s,e[(r+1)%a].labelR=l),r++;for(var n=0==(r=t.index)?a-1:r-1;!(e[r].left^e[n].left);)e[n].omit||(l=(s=(Math.sin(e[r].angle)*l+(e[r].left?i:-i))/Math.sin(e[n].angle))<t.labelR?t.labelR:s,e[n].labelR=l),n--,r=--r<0?r+e.length:r,n=n<0?n+e.length:n}})});
//# sourceMappingURL=../../sourcemaps/charting/plot2d/Pie.js.map
