/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["intern!object","intern/chai!assert","../transaction","dojo/Deferred","dojo/promise/all","dojo/_base/declare","dojo/store/Memory","dojo/store/util/QueryResults"],function(t,e,n,a,r,i,o,u){function d(t){return function(){0;var e=this.inherited(arguments);if(e&&e.then)return e;var n=new a;return setTimeout(function(){n.resolve(e)},10),t?new u(n):n}}var s=i(o,{get:d(),put:d(),add:d(),query:d(!0)}),c=new s({data:[{id:1,name:"one",prime:!1,mappedTo:"E",words:["banana"]},{id:2,name:"two",even:!0,prime:!0,mappedTo:"D",words:["banana","orange"]},{id:3,name:"three",prime:!0,mappedTo:"C",words:["apple","orange"]},{id:4,name:"four",even:!0,prime:!1,mappedTo:null},{id:5,name:"five",prime:!0,mappedTo:"A"}]}),h=new s,m=new s({data:[]}),p=new s,l=new s,f=n({masterStore:c,cachingStore:h,transactionLogStore:l}),g=n({masterStore:m,cachingStore:p,transactionLogStore:l});t({name:"transaction","auto-commit":function(){var t=[];return t.push(f.add({id:6,name:"six"})),e.strictEqual(c.data.length,6),t.push(f.remove(6)),e.strictEqual(c.data.length,5),r(t)},"commit transaction":function(){var t=[],n=f.transaction();return t.push(f.put({id:6,name:"six",perfect:!0})),t.push(f.add({id:7,name:"seven"})),t.push(f.remove(3)),e.strictEqual(c.data.length,5),r(t).then(function(){return t.push(f.get(6).then(function(t){e.deepEqual(t,{id:6,name:"six",perfect:!0})})),e.strictEqual(h.data.length,2),e.strictEqual(l.data.length,3),n.commit().then(function(){return(t=[]).push(f.get(6).then(function(t){e.deepEqual(t,{id:6,name:"six",perfect:!0})})),t.push(f.get(7).then(function(t){e.deepEqual(t,{id:7,name:"seven"})})),t.push(f.get(3).then(function(t){e.strictEqual(t,void 0)})),r(t)})})},"multi-store transaction":function(){var t=[],n=f.transaction();return g.transaction(),e.strictEqual(l.data.length,0),t.push(f.add({id:8,name:"eight"})),t.push(g.put({id:"a",name:"A"})),e.strictEqual(c.data.length,6),e.strictEqual(m.data.length,0),r(t).then(function(){return e.strictEqual(p.data.length,1),e.strictEqual(l.data.length,2),n.commit().then(function(){return(t=[]).push(f.get(8).then(function(t){e.deepEqual(t,{id:8,name:"eight"})})),t.push(g.get("a").then(function(t){e.deepEqual(t,{id:"a",name:"A"})})),r(t)})})}})});
//# sourceMappingURL=../../sourcemaps/store/tests/transaction.js.map
