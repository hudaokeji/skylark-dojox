/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
dojo.provide("dojox.jsonPath.query"),dojox.jsonPath.query=function(obj,expr,arg){var re=dojox.jsonPath._regularExpressions;arg||(arg={});var strs=[];function _str(r){return strs[r]}var _strName=_str.name,acc;if("PATH"==arg.resultType&&"RESULT"==arg.evalType)throw Error("RESULT based evaluation not supported with PATH based results");var P={resultType:arg.resultType||"VALUE",normalize:function(expr){var subx=[];expr=expr.replace(/'([^']|'')*'/g,function(t){return _strName+"("+(strs.push(eval(t))-1)+")"});for(var ll=-1;ll!=subx.length;)ll=subx.length,expr=expr.replace(/(\??\([^\(\)]*\))/g,function(r){return"#"+(subx.push(r)-1)});for(expr=expr.replace(/[\['](#[0-9]+)[\]']/g,"[$1]").replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,""),ll=-1;ll!=expr;)ll=expr,expr=expr.replace(/#([0-9]+)/g,function(r,e){return subx[e]});return expr.split(";")},asPaths:function(r){for(var e=0;e<r.length;e++){for(var t="$",a=r[e],n=1,s=a.length;n<s;n++)t+=/^[0-9*]+$/.test(a[n])?"["+a[n]+"]":"['"+a[n]+"']";r[e]=t}return r},exec:function(r,e,t){var a=["$"],n=t?e:[e],s=[a];function o(r,e,t){r&&r.hasOwnProperty(e)&&"VALUE"!=P.resultType&&s.push(a.concat([e])),t?n=r[e]:r&&r.hasOwnProperty(e)&&n.push(r[e])}function l(r){var e=p.match(/^_str\(([0-9]+)\)$/);return e?strs[e[1]]:r}function u(r){if(/^\(.*?\)$/.test(p))o(r,P.eval(p,r),t);else if("*"===p)P.walk(r,t&&r instanceof Array?function(e){P.walk(r[e],function(t){o(r[e],t)})}:function(e){o(r,e)});else if(".."===p)!function r(e){n.push(e),s.push(a),P.walk(e,function(t){if("object"==typeof e[t]){var n=a;a=a.concat(t),r(e[t]),a=n}})}(r);else if(/,/.test(p))for(var e=p.split(/'?,'?/),u=0,c=e.length;u<c;u++)o(r,l(e[u]));else/^\?\(.*?\)$/.test(p)?P.walk(r,function(e){P.eval(p.replace(/^\?\((.*?)\)$/,"$1"),r[e])&&o(r,e)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(p)?function(r,e){if(e instanceof Array){var t=e.length,a=0,n=t,s=1;r.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(r,e,t,o){a=parseInt(e||a),n=parseInt(t||n),s=parseInt(o||s)}),a=a<0?Math.max(0,a+t):Math.min(t,a),n=n<0?Math.max(0,n+t):Math.min(t,n);for(var l=a;l<n;l+=s)o(e,l)}}(p,r):(p=l(p),t&&r instanceof Array&&!/^[0-9*]+$/.test(p)?P.walk(r,function(e){o(r[e],p)}):o(r,p,t))}for(;r.length;){var p=r.shift();if(null===(e=n)||void 0===e)return e;n=[];var c=s;s=[],t?u(e):P.walk(e,function(r){a=c[r]||a,u(e[r])})}if("BOTH"==P.resultType){s=P.asPaths(s);for(var i=[],f=0;f<s.length;f++)i.push({path:s[f],value:n[f]});return i}return"PATH"==P.resultType?P.asPaths(s):n},walk:function(r,e){if(r instanceof Array)for(var t=0,a=r.length;t<a;t++)t in r&&e(t);else if("object"==typeof r)for(var n in r)r.hasOwnProperty(n)&&e(n)},eval:function(x,v){try{return $&&v&&eval(x.replace(/@/g,"v"))}catch(r){throw new SyntaxError("jsonPath: "+r.message+": "+x.replace(/@/g,"v").replace(/\^/g,"_a"))}}},$=obj;return!(!expr||!obj)&&P.exec(P.normalize(expr).slice(1),obj,"RESULT"==arg.evalType)};
//# sourceMappingURL=../sourcemaps/jsonPath/query.js.map
