/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
dojo.require("dojox.flash");var flashLoaded=!1,pageLoaded=!1,testXML=testBook=null;function flashReady(){console.debug("flashReady"),flashLoaded||(flashLoaded=!0,isReady()&&run())}function pageReady(){console.debug("pageReady"),pageLoaded||(pageLoaded=!0,loadResources(),isReady()&&run())}function isReady(){return testXML&&testBook&&pageLoaded&&flashLoaded}function loadResources(){console.debug("Trying to load resources");var e=dojo.xhrGet({url:"../../storage/tests/resources/testXML.xml",handleAs:"text"});e.addCallback(function(e){console.debug("testXML loaded"),testXML=e,isReady()&&run()}),e.addErrback(function(e){console.debug("Unable to load testXML.xml: "+e)}),(e=dojo.xhrGet({url:"../../storage/tests/resources/testBook.txt",handleAs:"text"})).addCallback(function(e){console.debug("testBook loaded"),testBook=e,isReady()&&run()}),e.addErrback(function(e){console.debug("Unable to load testXML.xml: "+e)})}function run(){console.debug("run");try{var e;console.debug("Setting simple message..."),e="hello world",dojox.flash.comm.setMessage(e),assert(e,dojox.flash.comm.getMessage(),"Setting/getting simple message did not work"),chop(e),console.debug("Setting message with evil characters...");var t="\\";e="hello world\n\n\nasdfasdf!@#$@#%^[]{}&amp;<xml>"+(t=t.charAt(0))+"<div>$%^&%^&*^&()<><><>,./;\0\r\f'][`~=\"+-]\\0MORE!\n\rLESS";var o=dojox.flash.comm.setMessage(e);assert(o,e.length,"Failed putting. Correct length = "+e.length+", Flash length = "+o),dojox.flash.comm.setMessage(e),assert(e,dojox.flash.comm.getMessage(),"Setting/getting message with evil characters did not work"),chop(e),console.debug("Setting testXML..."),e=testXML,dojox.flash.comm.setMessage(e),assert(e,dojox.flash.comm.getMessage(),"Setting/getting testXML did not work"),chop(e),console.debug("Setting testBook(~300K)..."),e=testBook,dojox.flash.comm.setMessage(e),assert(e,dojox.flash.comm.getMessage(),"Setting/getting testBook did not work"),console.debug("Setting testBook 3 times (~900K)..."),e=testBook+testBook+testBook,dojox.flash.comm.setMessage(e),assert(e,dojox.flash.comm.getMessage(),"Setting/getting testBook X 3 did not work"),console.debug("Setting JSON...");e=dojo.toJson({type:"car",color:"red",model:"Ford",year:"2008",features:["A/C","automatic","4-wheel drive"]},!0),dojox.flash.comm.setMessage(e),assert(e,dojox.flash.comm.getMessage(),"Setting/getting JSON did not work"),chop(e),console.debug("Calling method that takes multiple values..."),assert("namespacekeyvalue",dojox.flash.comm.multipleValues("key","value","namespace"),"Setting/getting multiple values did not work");var s=document.createElement("p");s.style.backgroundColor="green",s.style.color="white",s.style.fontSize="24pt",s.appendChild(document.createTextNode("All tests passed")),document.getElementsByTagName("body")[0].appendChild(s)}catch(e){console.debug(e.message||e)}}function chop(e){console.debug("chopping '"+e+"'");for(var t=0;t<Math.min(e.length,100);t++)testSlice(e,0,t+1)}function testSlice(e,t,o){var s=dojox.flash.comm.setMessageSlice(e,t,o),a=dojox.flash.comm.getMessage(),d=e.slice(t,o),l="Put a string with "+e.length+" chars, but it got with "+s+" chars in the Flash layer";assert(s,e.length,l),assert(d,a,l="I got '"+a+"' instead of '"+d+"'")}function assert(e,t,o){if(e!=t){var s=document.createElement("p");throw s.style.backgroundColor="red",s.style.color="white",s.style.fontSize="24pt",s.appendChild(document.createTextNode("Test failed: "+o)),document.getElementsByTagName("body")[0].appendChild(s),new Error("ASSERTION FAILED: "+o)}}console.debug("adding listeners..."),dojox.flash.addLoadedListener(flashReady),dojox.flash.setSwf("TestFlash.swf",!1),dojo.connect(dojo,"loaded",pageReady);
//# sourceMappingURL=../../sourcemaps/flash/tests/test_flash.js.map
