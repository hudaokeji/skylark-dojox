/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define("dojox/rpc/Rest",["dojo","dojox"],function(t,e){var n;function r(t,e,n,r){return t.addCallback(function(e){return t.ioArgs.xhr&&n&&(n=t.ioArgs.xhr.getResponseHeader("Content-Range"),t.fullLength=n&&(n=n.match(/\/(.*)/))&&parseInt(n[1])),e}),t}return t.getObject("rpc.Rest",!0,e),e.rpc&&e.rpc.transportRegistry&&e.rpc.transportRegistry.register("REST",function(t){return"REST"==t},{getExecutor:function(t,n,r){return new e.rpc.Rest(n.name,(n.contentType||r._smd.contentType||"").match(/json|javascript/),null,function(t,e){var o=r._getRequest(n,[t]);return o.url=o.target+(o.data?"?"+o.data:""),e&&(e.start>=0||e.count>=0)&&(o.headers=o.headers||{},o.headers.Range="items="+(e.start||"0")+"-"+("count"in e&&e.count!=1/0?e.count+(e.start||0)-1:"")),o})}}),(n=e.rpc.Rest=function(r,o,a,c){var s;function u(t){s[t]=function(e,r){return n._change(t,s,e,r)}}return(s=function(t,e){return n._get(s,t,e)}).isJson=o,s._schema=a,s.cache={serialize:o?(e.json&&e.json.ref||t).toJson:function(t){return t}},s._getRequest=c||function(n,a){if(t.isObject(n)&&(n=(n=t.objectToQuery(n))?"?"+n:""),a&&a.sort&&!a.queryStr){n+=(n?"&":"?")+"sort(";for(var c=0;c<a.sort.length;c++){var s=a.sort[c];n+=(c>0?",":"")+(s.descending?"-":"+")+encodeURIComponent(s.attribute)}n+=")"}var u={url:r+(null==n?"":n),handleAs:o?"json":"text",contentType:o?"application/json":"text/plain",sync:e.rpc._sync,headers:{Accept:o?"application/json,application/javascript":"*/*"}};return a&&(a.start>=0||a.count>=0)&&(u.headers.Range="items="+(a.start||"0")+"-"+("count"in a&&a.count!=1/0?a.count+(a.start||0)-1:"")),e.rpc._sync=!1,u},u("put"),u("post"),u("delete"),s.servicePath=r,s})._index={},n._timeStamps={},n._change=function(e,n,o,a){var c=n._getRequest(o);return c[e+"Data"]=a,r(t.xhr(e.toUpperCase(),c,!0))},n._get=function(e,n,o){return o=o||{},r(t.xhrGet(e._getRequest(n,o)),0,o.start>=0||o.count>=0)},n});
//# sourceMappingURL=../sourcemaps/rpc/Rest.js.map
