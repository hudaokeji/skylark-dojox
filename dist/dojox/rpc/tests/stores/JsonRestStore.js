/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
dojo.provide("dojox.rpc.tests.stores.JsonRestStore"),dojo.require("dojox.data.JsonRestStore"),dojo.require("dojo.data.api.Read"),dojo.require("dojox.rpc.Service"),dojox.rpc.tests.stores.JsonRestStore.error=function(e,o,t){o.errback(t)};var testServices=new dojox.rpc.Service(dojo.moduleUrl("dojox.rpc.tests.resources","test.smd")),jsonStore=new dojox.data.JsonRestStore({service:testServices.jsonRestStore});doh.register("dojox.rpc.tests.stores.JsonRestStore",[{name:"Fetch some items",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"query",onComplete:function(t,r){e.is(4,t.length),o.callback(!0)},onError:dojo.partial(dojox.rpc.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"fetch by id",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"obj1",onComplete:function(t,r){e.is("Object 1",t.name),e.t(jsonStore.hasAttribute(t,"name")),e.is(jsonStore.getValues(t,"name").length,1),e.t(jsonStore.isItem(t)),o.callback(!0)},onError:dojo.partial(dojox.rpc.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"Modify,save, check by id",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"query",onComplete:function(t,r){var n=(new Date).getTime();jsonStore.setValue(t[0],"updated",n),jsonStore.setValue(t[0],"obj",{foo:"bar"}),jsonStore.setValue(t[0],"obj dup",t[0].obj),jsonStore.setValue(t[0],"testArray",[1,2,3,4]),jsonStore.save(),jsonStore.fetch({query:"obj1",onComplete:function(t,r){e.is("Object 1",t.name),e.is(n,t.updated),e.is("bar",t.obj.foo),e.is(t.obj,t["obj dup"]),o.callback(!0)},onError:dojo.partial(dojox.rpc.tests.stores.JsonRestStore.error,doh,o)})},onError:dojo.partial(dojox.rpc.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"Post, delete, and put",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"obj1",onComplete:function(e,t){(new Date).getTime();var r=e.testArray,n={name:"new object"};r.push(n),jsonStore.save(),jsonStore.deleteItem(n,{parent:r}),jsonStore.save(),r.sort(function(e,o){return e<o}),jsonStore.save(),r.sort(function(e,o){return e>o}),jsonStore.save(),o.callback(!0)},onError:dojo.partial(dojox.rpc.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"Revert",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"obj1",onComplete:function(t,r){jsonStore.setValue(t,"name","new name"),jsonStore.setValue(t,"newProp","new value"),jsonStore.unsetAttribute(t,"updated"),e.is(jsonStore.getValue(t,"name"),"new name"),e.is(jsonStore.getValue(t,"newProp"),"new value"),e.is(jsonStore.getValue(t,"updated"),void 0),jsonStore.revert(),e.is(jsonStore.getValue(t,"name"),"Object 1"),e.is(jsonStore.getValue(t,"newProp"),void 0),e.t("number"==typeof jsonStore.getValue(t,"updated")),o.callback(!0)},onError:dojo.partial(dojox.rpc.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"Lazy loading",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"query",onComplete:function(t,r){jsonStore.getValue(t,3,function(t){e.is(t.name,"Object 4"),o.callback(!0)})},onError:dojo.partial(dojox.rpc.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"Array manipulation",timeout:1e4,runTest:function(e){var o=new doh.Deferred;return jsonStore.fetch({query:"obj1",onComplete:function(t,r){var n=t.testArray;n.reverse(),n.unshift(n.pop()),jsonStore.onSave=function(t){e.is(t.length,1),o.callback(!0),jsonStore.onSave=function(){}},jsonStore.save()},onError:dojo.partial(dojox.rpc.tests.stores.JsonRestStore.error,doh,o)}),o}},{name:"ReadAPI:  Fetch_20_Streaming",timeout:1e4,runTest:function(e){var o=new doh.Deferred,t=0;return jsonStore.fetch({query:"bigQuery",onBegin:null,count:5,onItem:function(o,r){e.assertTrue("number"==typeof o),t++},onComplete:function(r,n){e.is(5,t),e.is(null,r),o.callback(!0)},onError:dojo.partial(dojox.rpc.tests.stores.JsonRestStore.error,e,o)}),o}},function(e){var o=new dojo.data.api.Read;for(i in o){if("_"!==i.toString().charAt(0))if("function"==typeof o[i])if("function"!=typeof jsonStore[i]){!1;break}}}]);
//# sourceMappingURL=../../../sourcemaps/rpc/tests/stores/JsonRestStore.js.map
