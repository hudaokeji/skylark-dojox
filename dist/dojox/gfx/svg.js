/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/dom","dojo/_base/declare","dojo/_base/array","dojo/dom-geometry","dojo/dom-attr","dojo/_base/Color","./_base","./shape","./path"],function(t,e,i,r,s,a,o,n,h,d,l,u){var p=d.svg={};p.useSvgWeb=void 0!==window.svgweb;var f=navigator.userAgent,c=e("ios"),g=e("android"),b=e("chrome")||g&&g>=4?"auto":"optimizeLegibility";function x(t,e){return i.doc.createElementNS?i.doc.createElementNS(t,e):i.doc.createElement(e)}function v(t,e,i,r){return t.setAttributeNS?t.setAttributeNS(e,i,r):t.setAttribute(i,r)}function m(t){return p.useSvgWeb?i.doc.createTextNode(t,!0):i.doc.createTextNode(t)}p.xmlns={xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"},p.getRef=function(t){return t&&"none"!=t?t.match(/^url\(#.+\)$/)?r.byId(t.slice(5,-1)):t.match(/^#dojoUnique\d+$/)?r.byId(t.slice(1)):null:null},p.dasharray={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};var w=0;p.Shape=s("dojox.gfx.svg.Shape",l.Shape,{destroy:function(){if(this.fillStyle&&"type"in this.fillStyle){var t=this.rawNode.getAttribute("fill"),e=p.getRef(t);e&&e.parentNode.removeChild(e)}if(this.clip){var i=this.rawNode.getAttribute("clip-path");if(i){var s=r.byId(i.match(/gfx_clip[\d]+/)[0]);s&&s.parentNode.removeChild(s)}}l.Shape.prototype.destroy.apply(this,arguments)},setFill:function(t){if(!t)return this.fillStyle=null,this.rawNode.setAttribute("fill","none"),this.rawNode.setAttribute("fill-opacity",0),this;var e,i=function(t){this.setAttribute(t,e[t].toFixed(8))};if("object"==typeof t&&"type"in t){switch(t.type){case"linear":e=d.makeParameters(d.defaultLinearGradient,t);var r=this._setFillObject(e,"linearGradient");a.forEach(["x1","y1","x2","y2"],i,r);break;case"radial":e=d.makeParameters(d.defaultRadialGradient,t);var s=this._setFillObject(e,"radialGradient");a.forEach(["cx","cy","r"],i,s);break;case"pattern":e=d.makeParameters(d.defaultPattern,t);var o=this._setFillObject(e,"pattern");a.forEach(["x","y","width","height"],i,o)}return this.fillStyle=e,this}return e=d.normalizeColor(t),this.fillStyle=e,this.rawNode.setAttribute("fill",e.toCss()),this.rawNode.setAttribute("fill-opacity",e.a),this.rawNode.setAttribute("fill-rule","evenodd"),this},setStroke:function(e){var i=this.rawNode;if(!e)return this.strokeStyle=null,i.setAttribute("stroke","none"),i.setAttribute("stroke-opacity",0),this;("string"==typeof e||t.isArray(e)||e instanceof h)&&(e={color:e});var r=this.strokeStyle=d.makeParameters(d.defaultStroke,e);if(r.color=d.normalizeColor(r.color),r){i.setAttribute("stroke",r.color.toCss()),i.setAttribute("stroke-opacity",r.color.a),i.setAttribute("stroke-width",r.width),i.setAttribute("stroke-linecap",r.cap),"number"==typeof r.join?(i.setAttribute("stroke-linejoin","miter"),i.setAttribute("stroke-miterlimit",r.join)):i.setAttribute("stroke-linejoin",r.join);var s=r.style.toLowerCase();if(s in p.dasharray&&(s=p.dasharray[s]),s instanceof Array){var a;for(s=t._toArray(s),a=0;a<s.length;++a)s[a]*=r.width;if("butt"!=r.cap){for(a=0;a<s.length;a+=2)s[a]-=r.width,s[a]<1&&(s[a]=1);for(a=1;a<s.length;a+=2)s[a]+=r.width}s=s.join(",")}i.setAttribute("stroke-dasharray",s),i.setAttribute("dojoGfxStrokeStyle",r.style)}return this},_getParentSurface:function(){for(var t=this.parent;t&&!(t instanceof d.Surface);t=t.parent);return t},_setFillObject:function(t,e){var i=p.xmlns.svg;this.fillStyle=t;var r=this._getParentSurface().defNode,s=this.rawNode.getAttribute("fill"),a=p.getRef(s);if(a)if((s=a).tagName.toLowerCase()!=e.toLowerCase()){var o=s.id;s.parentNode.removeChild(s),(s=x(i,e)).setAttribute("id",o),r.appendChild(s)}else for(;s.childNodes.length;)s.removeChild(s.lastChild);else(s=x(i,e)).setAttribute("id",d._base._getUniqueId()),r.appendChild(s);if("pattern"==e){s.setAttribute("patternUnits","userSpaceOnUse");var n=x(i,"image");n.setAttribute("x",0),n.setAttribute("y",0),n.setAttribute("width",t.width.toFixed(8)),n.setAttribute("height",t.height.toFixed(8)),v(n,p.xmlns.xlink,"xlink:href",t.src),s.appendChild(n)}else{s.setAttribute("gradientUnits","userSpaceOnUse");for(var h=0;h<t.colors.length;++h){var l=t.colors[h],u=x(i,"stop"),f=l.color=d.normalizeColor(l.color);u.setAttribute("offset",l.offset.toFixed(8)),u.setAttribute("stop-color",f.toCss()),u.setAttribute("stop-opacity",f.a),s.appendChild(u)}}return this.rawNode.setAttribute("fill","url(#"+s.getAttribute("id")+")"),this.rawNode.removeAttribute("fill-opacity"),this.rawNode.setAttribute("fill-rule","evenodd"),s},_applyTransform:function(){if(this.matrix){var t=this.matrix;this.rawNode.setAttribute("transform","matrix("+t.xx.toFixed(8)+","+t.yx.toFixed(8)+","+t.xy.toFixed(8)+","+t.yy.toFixed(8)+","+t.dx.toFixed(8)+","+t.dy.toFixed(8)+")")}else this.rawNode.removeAttribute("transform");return this},setRawNode:function(t){var e=this.rawNode=t;"image"!=this.shape.type&&e.setAttribute("fill","none"),e.setAttribute("fill-opacity",0),e.setAttribute("stroke","none"),e.setAttribute("stroke-opacity",0),e.setAttribute("stroke-width",1),e.setAttribute("stroke-linecap","butt"),e.setAttribute("stroke-linejoin","miter"),e.setAttribute("stroke-miterlimit",4),e.__gfxObject__=this},setShape:function(t){for(var e in this.shape=d.makeParameters(this.shape,t),this.shape)"type"!=e&&this.rawNode.setAttribute(e,this.shape[e]);return this.bbox=null,this},_moveToFront:function(){return this.rawNode.parentNode.appendChild(this.rawNode),this},_moveToBack:function(){return this.rawNode.parentNode.insertBefore(this.rawNode,this.rawNode.parentNode.firstChild),this},setClip:function(e){this.inherited(arguments);var i=e?"width"in e?"rect":"cx"in e?"ellipse":"points"in e?"polyline":"d"in e?"path":null:null;if(e&&!i)return this;"polyline"===i&&((e=t.clone(e)).points=e.points.join(","));var s,a,o=n.get(this.rawNode,"clip-path");if(o&&(s=r.byId(o.match(/gfx_clip[\d]+/)[0]))&&s.removeChild(s.childNodes[0]),e){if(s)a=x(p.xmlns.svg,i),s.appendChild(a);else{var h="gfx_clip"+ ++w,d="url(#"+h+")";this.rawNode.setAttribute("clip-path",d),s=x(p.xmlns.svg,"clipPath"),a=x(p.xmlns.svg,i),s.appendChild(a),this.rawNode.parentNode.insertBefore(s,this.rawNode),n.set(s,"id",h)}n.set(a,e)}else this.rawNode.removeAttribute("clip-path"),s&&s.parentNode.removeChild(s);return this},_removeClipNode:function(){var t,e=n.get(this.rawNode,"clip-path");return e&&(t=r.byId(e.match(/gfx_clip[\d]+/)[0]))&&t.parentNode.removeChild(t),t}}),p.Group=s("dojox.gfx.svg.Group",p.Shape,{constructor:function(){l.Container._init.call(this)},setRawNode:function(t){this.rawNode=t,this.rawNode.__gfxObject__=this},destroy:function(){this.clear(!0),p.Shape.prototype.destroy.apply(this,arguments)}}),p.Group.nodeType="g",p.Rect=s("dojox.gfx.svg.Rect",[p.Shape,l.Rect],{setShape:function(t){for(var e in this.shape=d.makeParameters(this.shape,t),this.bbox=null,this.shape)"type"!=e&&"r"!=e&&this.rawNode.setAttribute(e,this.shape[e]);return null!=this.shape.r&&(this.rawNode.setAttribute("ry",this.shape.r),this.rawNode.setAttribute("rx",this.shape.r)),this}}),p.Rect.nodeType="rect",p.Ellipse=s("dojox.gfx.svg.Ellipse",[p.Shape,l.Ellipse],{}),p.Ellipse.nodeType="ellipse",p.Circle=s("dojox.gfx.svg.Circle",[p.Shape,l.Circle],{}),p.Circle.nodeType="circle",p.Line=s("dojox.gfx.svg.Line",[p.Shape,l.Line],{}),p.Line.nodeType="line",p.Polyline=s("dojox.gfx.svg.Polyline",[p.Shape,l.Polyline],{setShape:function(t,e){t&&t instanceof Array?(this.shape=d.makeParameters(this.shape,{points:t}),e&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.shape=d.makeParameters(this.shape,t),this.bbox=null,this._normalizePoints();for(var i=[],r=this.shape.points,s=0;s<r.length;++s)i.push(r[s].x.toFixed(8),r[s].y.toFixed(8));return this.rawNode.setAttribute("points",i.join(" ")),this}}),p.Polyline.nodeType="polyline",p.Image=s("dojox.gfx.svg.Image",[p.Shape,l.Image],{setShape:function(t){this.shape=d.makeParameters(this.shape,t),this.bbox=null;var e=this.rawNode;for(var i in this.shape)"type"!=i&&"src"!=i&&e.setAttribute(i,this.shape[i]);return e.setAttribute("preserveAspectRatio","none"),v(e,p.xmlns.xlink,"xlink:href",this.shape.src),e.__gfxObject__=this,this}}),p.Image.nodeType="image",p.Text=s("dojox.gfx.svg.Text",[p.Shape,l.Text],{setShape:function(t){this.shape=d.makeParameters(this.shape,t),this.bbox=null;var e=this.rawNode,i=this.shape;return e.setAttribute("x",i.x),e.setAttribute("y",i.y),e.setAttribute("text-anchor",i.align),e.setAttribute("text-decoration",i.decoration),e.setAttribute("rotate",i.rotated?90:0),e.setAttribute("kerning",i.kerning?"auto":0),e.setAttribute("text-rendering",b),e.firstChild?e.firstChild.nodeValue=i.text:e.appendChild(m(i.text)),this},getTextWidth:function(){var t=this.rawNode,e=t.parentNode,i=t.cloneNode(!0);i.style.visibility="hidden";var r=0,s=i.firstChild.nodeValue;if(e.appendChild(i),""!=s)for(;!r;)r=i.getBBox?parseInt(i.getBBox().width):68;return e.removeChild(i),r},getBoundingBox:function(){var t=null;if(this.getShape().text)try{t=this.rawNode.getBBox()}catch(e){t={x:0,y:0,width:0,height:0}}return t}}),p.Text.nodeType="text",p.Path=s("dojox.gfx.svg.Path",[p.Shape,u.Path],{_updateWithSegment:function(t){this.inherited(arguments),"string"==typeof this.shape.path&&this.rawNode.setAttribute("d",this.shape.path)},setShape:function(t){return this.inherited(arguments),this.shape.path?this.rawNode.setAttribute("d",this.shape.path):this.rawNode.removeAttribute("d"),this}}),p.Path.nodeType="path",p.TextPath=s("dojox.gfx.svg.TextPath",[p.Shape,u.TextPath],{_updateWithSegment:function(t){this.inherited(arguments),this._setTextPath()},setShape:function(t){return this.inherited(arguments),this._setTextPath(),this},_setTextPath:function(){if("string"==typeof this.shape.path){var t=this.rawNode;if(!t.firstChild){var e=x(p.xmlns.svg,"textPath"),i=m("");e.appendChild(i),t.appendChild(e)}var r=t.firstChild.getAttributeNS(p.xmlns.xlink,"href"),s=r&&p.getRef(r);if(!s){var a=this._getParentSurface();if(a){var o=a.defNode;s=x(p.xmlns.svg,"path");var n=d._base._getUniqueId();s.setAttribute("id",n),o.appendChild(s),v(t.firstChild,p.xmlns.xlink,"xlink:href","#"+n)}}s&&s.setAttribute("d",this.shape.path)}},_setText:function(){var t=this.rawNode;if(!t.firstChild){var e=x(p.xmlns.svg,"textPath"),i=m("");e.appendChild(i),t.appendChild(e)}t=t.firstChild;var r=this.text;switch(t.setAttribute("alignment-baseline","middle"),r.align){case"middle":t.setAttribute("text-anchor","middle"),t.setAttribute("startOffset","50%");break;case"end":t.setAttribute("text-anchor","end"),t.setAttribute("startOffset","100%");break;default:t.setAttribute("text-anchor","start"),t.setAttribute("startOffset","0%")}t.setAttribute("baseline-shift","0.5ex"),t.setAttribute("text-decoration",r.decoration),t.setAttribute("rotate",r.rotated?90:0),t.setAttribute("kerning",r.kerning?"auto":0),t.firstChild.data=r.text}}),p.TextPath.nodeType="text";var N,y=((N=/WebKit\/(\d*)/.exec(f))?N[1]:0)>534;p.Surface=s("dojox.gfx.svg.Surface",l.Surface,{constructor:function(){l.Container._init.call(this)},destroy:function(){l.Container.clear.call(this,!0),this.defNode=null,this.inherited(arguments)},setDimensions:function(t,e){return this.rawNode?(this.rawNode.setAttribute("width",t),this.rawNode.setAttribute("height",e),y&&(this.rawNode.style.width=t,this.rawNode.style.height=e),this):this},getDimensions:function(){return this.rawNode?{width:d.normalizedLength(this.rawNode.getAttribute("width")),height:d.normalizedLength(this.rawNode.getAttribute("height"))}:null}}),p.createSurface=function(t,e,i){var s=new p.Surface;s.rawNode=x(p.xmlns.svg,"svg"),s.rawNode.setAttribute("overflow","hidden"),e&&s.rawNode.setAttribute("width",e),i&&s.rawNode.setAttribute("height",i);var a=x(p.xmlns.svg,"defs");return s.rawNode.appendChild(a),s.defNode=a,s._parent=r.byId(t),s._parent.appendChild(s.rawNode),d._base._fixMsTouchAction(s),s};var A={_setFont:function(){var t=this.fontStyle;this.rawNode.setAttribute("font-style",t.style),this.rawNode.setAttribute("font-variant",t.variant),this.rawNode.setAttribute("font-weight",t.weight),this.rawNode.setAttribute("font-size",t.size),this.rawNode.setAttribute("font-family",t.family)}},C=l.Container,_=p.Container={openBatch:function(){return this._batch||(this.fragment=p.useSvgWeb?i.doc.createDocumentFragment(!0):i.doc.createDocumentFragment()),++this._batch,this},closeBatch:function(){return this._batch=this._batch>0?--this._batch:0,this.fragment&&!this._batch&&(this.rawNode.appendChild(this.fragment),delete this.fragment),this},add:function(t){return this!=t.getParent()&&(this.fragment?this.fragment.appendChild(t.rawNode):this.rawNode.appendChild(t.rawNode),C.add.apply(this,arguments),t.setClip(t.clip)),this},remove:function(t,e){return this==t.getParent()&&(this.rawNode==t.rawNode.parentNode&&this.rawNode.removeChild(t.rawNode),this.fragment&&this.fragment==t.rawNode.parentNode&&this.fragment.removeChild(t.rawNode),t._removeClipNode(),C.remove.apply(this,arguments)),this},clear:function(){for(var t=this.rawNode;t.lastChild;)t.removeChild(t.lastChild);var e=this.defNode;if(e){for(;e.lastChild;)e.removeChild(e.lastChild);t.appendChild(e)}return C.clear.apply(this,arguments)},getBoundingBox:C.getBoundingBox,_moveChildToFront:C._moveChildToFront,_moveChildToBack:C._moveChildToBack},S=p.Creator={createObject:function(t,e){if(!this.rawNode)return null;var i=new t,r=x(p.xmlns.svg,t.nodeType);return i.setRawNode(r),i.setShape(e),this.add(i),i}};if(t.extend(p.Text,A),t.extend(p.TextPath,A),t.extend(p.Group,_),t.extend(p.Group,l.Creator),t.extend(p.Group,S),t.extend(p.Surface,_),t.extend(p.Surface,l.Creator),t.extend(p.Surface,S),p.fixTarget=function(t,e){return t.gfxTarget||(c&&t.target.wholeText?t.gfxTarget=t.target.parentElement.__gfxObject__:t.gfxTarget=t.target.__gfxObject__),!0},p.useSvgWeb){p.createSurface=function(t,e,i){var s=new p.Surface;if(!e||!i){var a=o.position(t);e=e||a.w,i=i||a.h}var n=(t=r.byId(t)).id?t.id+"_svgweb":d._base._getUniqueId(),h=x(p.xmlns.svg,"svg");return h.id=n,h.setAttribute("width",e),h.setAttribute("height",i),svgweb.appendChild(h,t),h.addEventListener("SVGLoad",function(){s.rawNode=this,s.isLoaded=!0;var t=x(p.xmlns.svg,"defs");s.rawNode.appendChild(t),s.defNode=t,s.onLoad&&s.onLoad(s)},!1),s.isLoaded=!1,s},p.Surface.extend({destroy:function(){var t=this.rawNode;svgweb.removeChild(t,t.parentNode)}});var k={connect:function(e,i,r){return"on"===e.substring(0,2)&&(e=e.substring(2)),r=2==arguments.length?i:t.hitch(i,r),this.getEventSource().addEventListener(e,r,!1),[this,e,r]},disconnect:function(t){this.getEventSource().removeEventListener(t[1],t[2],!1),delete t[0]}};t.extend(p.Shape,k),t.extend(p.Surface,k)}return p});
//# sourceMappingURL=../sourcemaps/gfx/svg.js.map
