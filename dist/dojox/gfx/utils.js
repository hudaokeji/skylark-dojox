/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
define(["dojo/_base/kernel","dojo/_base/lang","./_base","dojo/_base/html","dojo/_base/array","dojo/_base/window","dojo/_base/json","dojo/_base/Deferred","dojo/_base/sniff","require","dojo/_base/config"],function(e,n,o,r,i,t,a,l,c,s,f){var d=o.utils={};return n.mixin(d,{forEach:function(n,r,t){t=t||e.global,r.call(t,n),(n instanceof o.Surface||n instanceof o.Group)&&i.forEach(n.children,function(e){d.forEach(e,r,t)})},serialize:function(e){var n,r={},t=e instanceof o.Surface;if(t||e instanceof o.Group){if(r.children=i.map(e.children,d.serialize),t)return r.children}else r.shape=e.getShape();return e.getTransform&&(n=e.getTransform())&&(r.transform=n),e.getStroke&&(n=e.getStroke())&&(r.stroke=n),e.getFill&&(n=e.getFill())&&(r.fill=n),e.getFont&&(n=e.getFont())&&(r.font=n),r},toJson:function(e,n){return a.toJson(d.serialize(e),n)},deserialize:function(e,o){if(o instanceof Array)return i.map(o,n.hitch(null,d.deserialize,e));var r="shape"in o?e.createShape(o.shape):e.createGroup();return"transform"in o&&r.setTransform(o.transform),"stroke"in o&&r.setStroke(o.stroke),"fill"in o&&r.setFill(o.fill),"font"in o&&r.setFont(o.font),"children"in o&&i.forEach(o.children,n.hitch(null,d.deserialize,r)),r},fromJson:function(e,n){return d.deserialize(e,a.fromJson(n))},toSvg:function(e){var n=new l;if("svg"===o.renderer)try{var i=d._cleanSvg(d._innerXML(e.rawNode));n.callback(i)}catch(e){n.errback(e)}else{d._initSvgSerializerDeferred||d._initSvgSerializer();var a=d.toJson(e),c=function(){try{var o=e.getDimensions(),i=o.width,l=o.height,c=d._gfxSvgProxy.document.createElement("div");d._gfxSvgProxy.document.body.appendChild(c),t.withDoc(d._gfxSvgProxy.document,function(){r.style(c,"width",i),r.style(c,"height",l)},this);var s=d._gfxSvgProxy[dojox._scopeName].gfx.createSurface(c,i,l);s.whenLoaded(null,function(e){try{d._gfxSvgProxy[dojox._scopeName].gfx.utils.fromJson(e,a);var o=d._cleanSvg(c.innerHTML);e.clear(),e.destroy(),d._gfxSvgProxy.document.body.removeChild(c),n.callback(o)}catch(e){n.errback(e)}})}catch(e){n.errback(e)}};d._initSvgSerializerDeferred.fired>0?c():d._initSvgSerializerDeferred.addCallback(c)}return n},_gfxSvgProxy:null,_initSvgSerializerDeferred:null,_svgSerializerInitialized:function(){d._initSvgSerializerDeferred.callback(!0)},_initSvgSerializer:function(){if(!d._initSvgSerializerDeferred){d._initSvgSerializerDeferred=new l;var n,o=t.doc.createElement("iframe");r.style(o,{display:"none",position:"absolute",width:"1em",height:"1em",top:"-10000px"}),c("ie")?o.onreadystatechange=function(){"complete"==o.contentWindow.document.readyState&&(o.onreadystatechange=function(){},n=setInterval(function(){o.contentWindow[e.scopeMap.dojo[1]._scopeName]&&o.contentWindow[e.scopeMap.dojox[1]._scopeName].gfx&&o.contentWindow[e.scopeMap.dojox[1]._scopeName].gfx.utils&&(clearInterval(n),o.contentWindow.parent[e.scopeMap.dojox[1]._scopeName].gfx.utils._gfxSvgProxy=o.contentWindow,o.contentWindow.parent[e.scopeMap.dojox[1]._scopeName].gfx.utils._svgSerializerInitialized())},50))}:o.onload=function(){o.onload=function(){},n=setInterval(function(){o.contentWindow[e.scopeMap.dojo[1]._scopeName]&&o.contentWindow[e.scopeMap.dojox[1]._scopeName].gfx&&o.contentWindow[e.scopeMap.dojox[1]._scopeName].gfx.utils&&(clearInterval(n),o.contentWindow.parent[e.scopeMap.dojox[1]._scopeName].gfx.utils._gfxSvgProxy=o.contentWindow,o.contentWindow.parent[e.scopeMap.dojox[1]._scopeName].gfx.utils._svgSerializerInitialized())},50)};var i=f.dojoxGfxSvgProxyFrameUrl||s.toUrl("dojox/gfx/resources/gfxSvgProxyFrame.html");o.setAttribute("src",i.toString()),t.body().appendChild(o)}},_innerXML:function(e){return e.innerXML?e.innerXML:e.xml?e.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(e):null},_cleanSvg:function(e){return e&&(-1==e.indexOf('xmlns="http://www.w3.org/2000/svg"')&&(e='<svg xmlns="http://www.w3.org/2000/svg"'+(e=e.substring(4,e.length))),-1==e.indexOf('xmlns:xlink="http://www.w3.org/1999/xlink"')&&(e='<svg xmlns:xlink="http://www.w3.org/1999/xlink"'+(e=e.substring(4,e.length))),-1===e.indexOf("xlink:href")&&(e=e.replace(/href\s*=/g,"xlink:href=")),e=(e=(e=(e=(e=e.replace(/<img\b([^>]*)>/gi,"<image $1 />")).replace(/\bdojoGfx\w*\s*=\s*(['"])\w*\1/g,"")).replace(/\b__gfxObject__\s*=\s*(['"])\w*\1/g,"")).replace(/[=]([^"']+?)(\s|>)/g,'="$1"$2')).replace(/\bstroke-opacity\w*\s*=\s*(['"])undefined\1/g,"")),e}}),d});
//# sourceMappingURL=../sourcemaps/gfx/utils.js.map
