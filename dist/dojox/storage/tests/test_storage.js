/**
 * dojox - A version of dojox.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojox/
 * @license MIT
 */
dojo.require("dojox.storage");var TestStorage={currentProvider:"default",currentNamespace:null,initialize:function(){if(0==dojox.storage.manager.available){var e=document.createElement("option");e.appendChild(document.createTextNode("None")),e.value="None",e.selected=!0;var o=dojo.byId("currentStorageProvider");return o.disabled=!0,o.appendChild(e),void alert("No storage provider is available on this browser")}this._determineCurrentNamespace(),dojo.byId("storageNamespace").value=this.currentNamespace,dojo.byId("storageNamespace").disabled=!1,dojo.byId("storageKey").value="",dojo.byId("storageKey").disabled=!1,dojo.byId("storageValue").value="",dojo.byId("storageValue").disabled=!1,this._printAvailableProviders(),this._printAvailableNamespaces(),this._printAvailableKeys();var t=dojo.byId("currentStorageProvider");dojo.connect(t,"onchange",this,this.providerChange);var a=dojo.byId("namespaceDirectory");dojo.connect(a,"onchange",this,this.namespaceChange);var r=dojo.byId("directory");dojo.connect(r,"onchange",this,this.directoryChange);var n=dojo.byId("storageValue");dojo.connect(n,"onkeyup",this,this.printValueSize);var s=dojo.byId("storageKey");dojo.connect(s,"onfocus",function(e){r.selectedIndex=-1});for(var i=dojo.byId("buttonContainer").firstChild;null!=i.nextSibling;){if(1==i.nodeType){var d=i.id.match(/^(.*)Button$/)[1];dojo.connect(i,"onclick",this,this[d]),i.disabled=!1}i=i.nextSibling}this._printProviderMetadata(),0==dojox.storage.hasSettingsUI()&&(dojo.byId("configureButton").disabled=!0)},providerChange:function(e){var o=e.target.value,t="";t=-1==window.location.href.indexOf("forceStorageProvider")?"?":"&",window.location.href+=t+"forceStorageProvider="+o},namespaceChange:function(e){var o=e.target.value;this.currentNamespace=o,this._printAvailableKeys(),dojo.byId("storageNamespace").value=this.currentNamespace,dojo.byId("storageKey").value="",dojo.byId("storageValue").value=""},directoryChange:function(e){var o=e.target.value;dojo.byId("storageKey").value=o,this._handleLoad(o)},load:function(e){e.preventDefault(),e.stopPropagation();var o=dojo.byId("storageKey").value;null!=o&&void 0!==o&&""!=o?this._handleLoad(o):alert("Please enter a key name")},loadMultiple:function(e){e.preventDefault(),e.stopPropagation();var o=dojo.byId("directory");if(o.selectedIndex<0)alert("Please select a key from the 'All Keys' list");else{var t,a=[o.value];for(t=o.options.selectedIndex+1;t<o.options.length&&a.length<10;t++)a.push(o.options[t].value);for(t=o.options.selectedIndex-1;t>=0&&a.length<10;t--)a.push(o.options[t].value);this._handleLoadMultiple(a)}},save:function(e){e.preventDefault(),e.stopPropagation();var o=dojo.byId("storageKey").value,t=dojo.byId("storageValue").value,a=dojo.byId("storageNamespace").value;null!=o&&void 0!==o&&""!=o?null!=t&&void 0!==t&&""!=t?(this.printValueSize(),this._save(o,t,a)):alert("Please enter a key value"):alert("Please enter a key name")},saveMultiple:function(e){e.preventDefault(),e.stopPropagation();var o=dojo.byId("storageKey").value,t=dojo.byId("storageValue").value,a=dojo.byId("storageNamespace").value;if(null!=o&&void 0!==o&&""!=o)if(null!=t&&void 0!==t&&""!=t){this.printValueSize();for(var r=[],n=[],s=0;s<10;s++)r.push(o+s),n.push(s+") "+t);this._saveMultiple(r,n,a)}else alert("Please enter a key value");else alert("Please enter a key name")},clearNamespace:function(e){e.preventDefault(),e.stopPropagation(),dojox.storage.clear(this.currentNamespace),this._printAvailableNamespaces(),this._printAvailableKeys()},_saveMultiple:function(e,o,t){this._printStatus("Saving 10 keys, starting with '"+e[0]+"'...");var a=this,r=function(o,r){o==dojox.storage.FAILED?alert("You do not have permission to store data for this web site. Press the Configure button to grant permission."):o==dojox.storage.SUCCESS&&(dojo.byId("storageKey").value="",dojo.byId("storageValue").value="",a._printStatus("Saved '"+e[0]+"' and "+(e.length-1)+" others"),void 0!==t&&null!=t&&(a.currentNamespace=t),a._printAvailableKeys(),a._printAvailableNamespaces())};try{t==dojox.storage.DEFAULT_NAMESPACE?dojox.storage.putMultiple(e,o,r):dojox.storage.putMultiple(e,o,r,t)}catch(e){alert(e)}},configure:function(e){if(e.preventDefault(),e.stopPropagation(),dojox.storage.hasSettingsUI()){var o=this;dojox.storage.onHideSettingsUI=function(){o._printAvailableKeys()},dojox.storage.showSettingsUI()}},remove:function(e){e.preventDefault(),e.stopPropagation();var o,t=dojo.byId("directory"),a=dojo.byId("storageKey"),r=dojo.byId("storageValue");if(-1!=t.selectedIndex){o=t.value;for(var n=t.childNodes,s=0;s<n.length;s++)if(1==n[s].nodeType&&n[s].value==o){t.removeChild(n[s]);break}}else o=a.value;a.value="",r.value="",this._printStatus("Removing '"+o+"'..."),this.currentNamespace==dojox.storage.DEFAULT_NAMESPACE?dojox.storage.remove(o):dojox.storage.remove(o,this.currentNamespace),this._printAvailableNamespaces(),this._printStatus("Removed '"+o)},removeMultiple:function(e){if(e.preventDefault(),e.stopPropagation(),confirm("Are you sure you want to delete the entry for the selected key and up to 10 more entries?")){var o=dojo.byId("directory");if(o.selectedIndex<0)return void alert("Please select a key from the 'All Keys' list");for(var t=[],a=o.options.selectedIndex;a<o.options.length&&t.length<10;a++)t.push(o.options[a].value);this._printStatus("Removing '"+(o.options.selectedIndex-a)+"' keys starting with '"+o.options[o.options.selectedIndex].value+"' ..."),this.currentNamespace==dojox.storage.DEFAULT_NAMESPACE?dojox.storage.removeMultiple(t):dojox.storage.removeMultiple(t,this.currentNamespace);var r=directory.childNodes;for(a=o.options.selectedIndex;a<o.options.length&&a-o.options.selectedIndex<10;a++)directory.removeChild(r[a])}},printValueSize:function(){var e,o=dojo.byId("storageValue").value,t=0;null!=o&&void 0!==o&&(t=o.length),t<1024?e=" bytes":(e=" K",t/=1024,t=Math.round(t)),t+=e,dojo.byId("valueSize").innerHTML=t},saveBook:function(e){this._printStatus("Loading book...");var o=dojo.xhrGet({url:"resources/testBook.txt",handleAs:"text"});return o.addCallback(dojo.hitch(this,function(e){this._printStatus("Book loaded"),this._save("testBook",e)})),o.addErrback(dojo.hitch(this,function(e){alert("Unable to load testBook.txt: "+e)})),null!=e&&(e.preventDefault(),e.stopPropagation()),!1},saveXML:function(e){this._printStatus("Loading XML...");var o=dojo.xhrGet({url:"resources/testXML.xml",handleAs:"text"});return o.addCallback(dojo.hitch(this,function(e){this._printStatus("XML loaded"),this._save("testXML",e)})),o.addErrback(dojo.hitch(this,function(e){alert("Unable to load testXML.xml: "+e)})),null!=e&&(e.preventDefault(),e.stopPropagation()),!1},_save:function(e,o,t){this._printStatus("Saving '"+e+"'...");var a=this,r=function(o,r){o==dojox.storage.FAILED?alert("You do not have permission to store data for this web site. Press the Configure button to grant permission."):o==dojox.storage.SUCCESS&&(dojo.byId("storageKey").value="",dojo.byId("storageValue").value="",a._printStatus("Saved '"+e+"'"),void 0!==t&&null!=t&&(a.currentNamespace=t),a._printAvailableKeys(),a._printAvailableNamespaces())};try{t==dojox.storage.DEFAULT_NAMESPACE?dojox.storage.put(e,o,r):dojox.storage.put(e,o,r,t)}catch(e){alert(e)}},_printAvailableKeys:function(){var e,o=dojo.byId("directory");o.innerHTML="",e=this.currentNamespace==dojox.storage.DEFAULT_NAMESPACE?dojox.storage.getKeys():dojox.storage.getKeys(this.currentNamespace);for(var t=0;t<e.length;t++){var a=document.createElement("option");a.appendChild(document.createTextNode(e[t])),a.value=e[t],o.appendChild(a)}},_handleLoadMultiple:function(e){var o;this._printStatus("Loading '"+e+"'..."),o=this.currentNamespace==dojox.storage.DEFAULT_NAMESPACE?dojox.storage.getMultiple(e):dojox.storage.getMultiple(e,this.currentNamespace);for(var t=0;t<o.length;t++)"string"!=typeof o[t]&&(o[t]=dojo.toJson(o[t]));for(this._printStatus("Loaded '"+e[0]+"' and "+(e.length-1)+" others"),dojo.byId("storageValue").value="",t=0;t<o.length;t++)dojo.byId("storageValue").value+=o[t]+"\n----\n";this.printValueSize()},_printAvailableNamespaces:function(){var e=dojo.byId("namespaceDirectory");e.innerHTML="";for(var o=dojox.storage.getNamespaces(),t=0;t<o.length;t++){var a=document.createElement("option");a.appendChild(document.createTextNode(o[t])),a.value=o[t],this.currentNamespace==o[t]&&(a.selected=!0),e.appendChild(a)}},_handleLoad:function(e){var o;this._printStatus("Loading '"+e+"'..."),"string"!=typeof(o=this.currentNamespace==dojox.storage.DEFAULT_NAMESPACE?dojox.storage.get(e):dojox.storage.get(e,this.currentNamespace))&&(o=dojo.toJson(o)),this._printStatus("Loaded '"+e+"'"),dojo.byId("storageValue").value=o,this.printValueSize()},_printProviderMetadata:function(){var e=dojox.storage.manager.currentProvider.declaredClass,o=dojox.storage.isAvailable(),t=dojox.storage.getMaximumSize(),a=dojox.storage.isPermanent(),r=dojox.storage.hasSettingsUI(),n="";"dojox.storage.FlashStorageProvider"==dojox.storage.manager.currentProvider.declaredClass&&(n="Flash Version "+dojox.flash.info.version),dojo.byId("currentStorageProvider").innerHTML=e,dojo.byId("isSupported").innerHTML=o,dojo.byId("isPersistent").innerHTML=a,dojo.byId("hasUIConfig").innerHTML=r,dojo.byId("maximumSize").innerHTML=t,dojo.byId("moreInfo").innerHTML=n},_printStatus:function(e){for(var o=dojo.byId("top"),t=0;t<o.childNodes.length;t++){var a=o.childNodes[t];1==a.nodeType&&"status"==a.className&&o.removeChild(a)}var r=document.createElement("span");r.className="status",r.innerHTML=e,o.appendChild(r),dojo.fadeOut({node:r,duration:2e3}).play()},_determineCurrentNamespace:function(){this.currentNamespace=dojox.storage.DEFAULT_NAMESPACE;var e=dojox.storage.getNamespaces();if(this.currentNamespace==dojox.storage.DEFAULT_NAMESPACE){for(var o=!1,t=0;t<e.length;t++)e[t]==dojox.storage.DEFAULT_NAMESPACE&&(o=!0);!o&&e.length&&(this.currentNamespace=e[0])}},_printAvailableProviders:function(){window.setTimeout(function(){for(var e=dojo.byId("currentStorageProvider"),o=dojox.storage.manager.providers,t=0;t<o.length;t++){var a=o[t].declaredClass,r=document.createElement("option");r.appendChild(document.createTextNode(a)),r.value=a,dojox.storage.manager.currentProvider==o[t]&&(r.selected=!0),e.appendChild(r)}},1)}};dojo.addOnLoad(function(){0==dojox.storage.manager.isInitialized()?dojo.connect(dojox.storage.manager,"loaded",TestStorage,TestStorage.initialize):dojo.connect(dojo,"loaded",TestStorage,TestStorage.initialize)});
//# sourceMappingURL=../../sourcemaps/storage/tests/test_storage.js.map
